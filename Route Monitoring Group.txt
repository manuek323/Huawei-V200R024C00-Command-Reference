13 Route Monitoring Group
Configuration
13.1 Overview of Route Monitoring Groups
13.2 Application Scenarios for Route Monitoring Groups
13.3 Understanding Route Monitoring Groups
13.4 Licensing Requirements and Limitations for Route Monitoring Group
13.5 Configuring Association Between IPv4 Static Routes and a Route Monitoring
Group
13.6 Example for Configuring Association Between IPv4 Static Routes and a Route
Monitoring Group
13.1 Overview of Route Monitoring Groups
Definition
Route monitoring groups monitor the connectivity of network-side IPv4 routes,
and their status is associated with IPv4 static routes. By leveraging route
monitoring groups, access-side service modules can perform active/standby link
switchovers upon changes to the connectivity status of network-side IP routes,
preventing network congestion or traffic loss.
Purpose
To improve network reliability, device-level redundancy is used on live networks.
This involves two devices that back up each other and operate in load balancing
mode. If one device fails, the other device takes over services from the faulty
device. Inter-device link reliability and load balancing issues need to be resolved
when one device is dual-homed to two devices that operate in active/standby
mode.
In a two-node hot standby scenario, if some or all network-side links fail, the
bandwidth of the network-side links decreases accordingly. Network congestion or
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1069
traffic loss will occur if the access side cannot promptly detect link failures. To
prevent these problems from arising, you can configure a route monitoring group
and associate its status with the status of IPv4 static routes. This allows status
changes of network-side routes to trigger switching between the active and
standby links of access-side service modules.
13.2 Application Scenarios for Route Monitoring
Groups
13.2.1 Preventing Network Congestion
On the network shown in Figure 13-1, AGG_Switch_A and AGG_Switch_B back up
each other, and several ACC_Switches are dual-homed to the two AGG_Switches to
implement load balancing. If some network-side links between AGG_Switch_A and
the core network fail, the available bandwidth of links between them decreases
accordingly. However, ACC_Switches cannot detect link failures and still forward
packets destined for the core network to AGG_Switch_A. In this scenario,
congestion will occur on the links between AGG_Switch_A and the core network.
To prevent network congestion, you can deploy route monitoring groups on
ACC_Switches to quickly detect the connectivity of IP routes on the network. This
will allow ACC_Switches to promptly perform access-side link switching when
there are changes to the status of IP routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1070
Figure 13-1 Typical networking diagram of route monitoring groups
13.2.2 Preventing Traffic Loss
On the network shown in Figure 13-2, AGG_Switch_A and AGG_Switch_B back up
each other, and several ACC_Switches are dual-homed to the two AGG_Switches to
implement load balancing. If all the links between AGG_Switch_A and the core
network fail, only the links between AGG_Switch_B and the core network are
available on the network side. However, ACC_Switches cannot detect link failures
and still forward packets destined for the core network to AGG_Switch_A. In this
scenario, the packets transmitted from ACC_Switches are lost because all the links
between AGG_Switch_A and the core network are unavailable.
To prevent traffic loss, you can configure route monitoring groups on
ACC_Switches to quickly detect the connectivity of IP routes on the network. This
will allow ACC_Switches to promptly perform access-side link switching when
there are changes to the status of IP routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1071
Figure 13-2 Typical networking diagram of route monitoring groups
13.3 Understanding Route Monitoring Groups
Monitored routes of the same type on the network side can be added to a route
monitoring group. Each route monitoring group is identified by a unique name.
The status of a route monitoring group depends on the status of its member
routes. Service modules will switch links if the status of the route monitoring
group changes.
A route monitoring group monitors the status of all its member routes. You can
set the logical relationship between the monitored routes in a group to AND or
OR.
● When the logical relationship between the monitored routes in a route
monitoring group is set to AND, the group status changes to Down as long as
one route in the group goes Down. The route management (RM) module
then instructs the service modules to switch links.
● When the logical relationship between the monitored routes in a route
monitoring group is set to OR, the group status only changes to Down when
all the routes in the group go Down. The RM module then instructs the
service modules to switch links.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1072
13.4 Licensing Requirements and Limitations for Route
Monitoring Group
Involved Network Elements
Other network elements are not required.
Licensing Requirements
Route monitoring group is a basic feature of a switch and is not under license
control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support Route Monitoring Group.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
Feature Limitations
None
13.5 Configuring Association Between IPv4 Static
Routes and a Route Monitoring Group
Context
To quickly detect link quality changes for static routes and ensure timely link
switching, you can associate the IPv4 static routes with a route monitoring group.
If a network-side link fails, the route monitoring group detects the status change
of the corresponding network-side route and triggers switching between the active
and standby links on the access side. This prevents network congestion and traffic
loss and ensures service continuity.
Pre-configuration Tasks
Before configuring association between IPv4 static routes and a route monitoring
group, configure link-layer protocol parameters and IP addresses for interfaces to
ensure that the link-layer protocol status of the interfaces is Up.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1073
Procedure
1. Configure a route monitoring group.
a. Run system-view
The system view is displayed.
b. Run ip route-monitor-group
group-name
A route monitoring group is created and the route monitoring group view
is displayed.
By default, no route monitoring group is created on a switch.
c. Run track ip route [ vpn-instance
vpn-instance-name ]
dest-address
{
mask |
mask-length }
A route is added to the route monitoring group.
By default, no route is added to a route monitoring group.
To add more routes to the route monitoring group, repeat this step. A
route monitoring group can monitor a maximum of 16 routes.
d. (Optional) Run operator and
The relationship between routes in the route monitoring group is set to
AND.
By default, the status of routes in a route monitoring group is of the OR
relationship. That is, the status of the route monitoring group is Up as
long as one route in the group is Up. The status of the monitoring group
is Down only when all routes in the group are Down.
e. (Optional) Run trigger-down-delay
delay-value
A delay after which the RM module instructs the associated service
modules to perform link switchovers is configured.
By default, the delay is 0s.
f. (Optional) Run trigger-up-delay
delay-value
A delay after which the RM module instructs the associated service
modules to perform link switchbacks is configured.
By default, the delay is 5s.
g. Run monitor enable
The route monitoring group is enabled.
2. Configure association between IPv4 static routes and the route monitoring
group.
a. Run system-view
The system view is displayed.
b. Run ip route-static
ip-address {
mask |
mask-length } {
nexthop-address |
interface-type interface-number [
nexthop-address ] | vpn-instance
vpn-
instance-name nexthop-address } [ preference
preference | tag
tag ]
track route-monitor-group
route-monitor-group-name [ description
text ]
Association between IPv4 static routes and the route monitoring group is
configured.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1074
NOTE
The destination address of a route monitored by a route monitoring group cannot be
the destination address of an associated static route.
Verifying the Configuration
● Run the display ip route-monitor-group [
group-name ] command to check
information about the route monitoring group.
● Run the display ip route-monitor-group track-route [ vpn-instance
vpn-
instance-name ]
dest-address {
mask |
mask-length } command to check
information about all route monitoring groups to which a route is added.
● Run the display current-configuration | include track route-monitor-group
command to check the configuration of the association between IPv4 static
routes and route monitoring groups.
13.6 Example for Configuring Association Between IPv4
Static Routes and a Route Monitoring Group
Networking Requirements
On a company's network shown in Figure 13-3, SwitchC at the access layer
connects to SwitchB and SwitchD at the aggregation layer through static routes.
SwitchB and SwitchD work in redundancy mode. The customer requirements are
as follows:
● A link failure detection mechanism is deployed for static routes, so that traffic
can be switched from a faulty link to a normal link in a timely manner to
prevent service interruption for a long time.
● In normal situations, service traffic from the access side is forwarded to the IP
network through SwitchB.
● If the link between SwitchB and SwitchA fails, only the link between SwitchD
and the IP network is available. In this case, service traffic from the access
side is switched to SwitchD to prevent traffic loss.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1075
Figure 13-3 Configuring association between IPv4 static routes and a route
monitoring group
Device Name Interface IP Address
SwitchA
VLANIF 10 192.168.10.1/24
VLANIF 20 192.168.20.1/24
VLANIF 100 192.168.100.1/24
SwitchB
VLANIF 10 192.168.10.2/24
VLANIF 40 192.168.40.1/24
SwitchC
VLANIF 30 192.168.30.2/24
VLANIF 40 192.168.40.2/24
VLANIF 50 192.168.50.1/24
SwitchD VLANIF 20 192.168.20.2/24
VLANIF 30 192.168.30.1/24
Configuration Roadmap
The configuration roadmap is as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1076
1. Create VLANs, add interfaces to the VLANs, and configure IP addresses for
VLANIF interfaces, so that neighboring devices can communicate with each
other.
2. Configure static routes and bind them to a route monitoring group. On
SwitchC, configure static routes, set a low cost for the route corresponding to
the active link, and bind the static routes to a route monitoring group. In this
way, the links can work in active/standby mode, and IPv4 static routes are
associated with the route monitoring group.
Procedure
1. Configure VLANs to which interfaces belong.
# Configure SwitchC. The configurations of other devices are similar to those
of SwitchC.
<HUAWEI> system-view
[HUAWEI] sysname SwitchC
[SwitchC] vlan batch 30 40 50
[SwitchC] interface gigabitethernet 0/0/1
[SwitchC-gigabitethernet0/0/1] port link-type trunk
[SwitchC-gigabitethernet0/0/1] port trunk allow-pass vlan 30
[SwitchC-gigabitethernet0/0/1] quit
[SwitchC] interface gigabitethernet 0/0/2
[SwitchC-gigabitethernet0/0/2] port link-type trunk
[SwitchC-gigabitethernet0/0/2] port trunk allow-pass vlan 40
[SwitchC-gigabitethernet0/0/2] quit
[SwitchC] interface gigabitethernet 0/0/3
[SwitchC-gigabitethernet0/0/3] port link-type trunk
[SwitchC-gigabitethernet0/0/3] port trunk allow-pass vlan 50
[SwitchC-gigabitethernet0/0/3] quit
2. Configure an IP address for each VLANIF interface.
# Configure SwitchC. The configurations of other devices are similar to those
of SwitchC.
[SwitchC] interface vlanif 30
[SwitchC-Vlanif10] ip address 192.168.30.2 24
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] ip address 192.168.40.2 24
[SwitchC-Vlanif40] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] ip address 192.168.50.1 24
[SwitchC-Vlanif50] quit
3. Configure static routes and bind them to a route monitoring group.
# On SwitchC, create the route monitoring group uplink.
[SwitchC] ip route-monitor-group uplink
# On SwitchC, add routes to be monitored to the route monitoring group
uplink.
[SwitchC-route-monitor-group-uplink] track ip route 192.168.100.0 255.255.255.0
# On SwitchC, enable the route monitoring group.
[SwitchC-route-monitor-group-uplink] monitor enable
[SwitchC-route-monitor-group-uplink] quit
# On SwitchC, configure static routes to the external network and bind the
static routes to the route monitoring group uplink.
[SwitchC] ip route-static 0.0.0.0 0.0.0.0 192.168.40.1 preference 50 track route-monitor-group
uplink
[SwitchC] ip route-static 0.0.0.0 0.0.0.0 192.168.30.1
# On SwitchB, configure a static route to Client1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1077
<HUAWEI> system-view
[HUAWEI] sysname SwitchB
[SwitchB] ip route-static 192.168.50.0 255.255.255.0 192.168.40.2
# On SwitchD, configure a static route to Client1.
<HUAWEI> system-view
[HUAWEI] sysname SwitchD
[SwitchD] ip route-static 192.168.50.0 255.255.255.0 192.168.30.2
4. Verify the configuration.
# Check information about the route monitoring group uplink on SwitchC.
The command output shows that the route monitoring group has been
enabled and the route to 192.168.100.0/24 is an active route.
[SwitchC] display ip route-monitor-group uplink
route monitor group uplink
State : Enabled
-------------------------------------------------------
route monitor group tracking route number : 1
-------------------------------------------------------
VPN name : Public
Destination : 192.168.100.0
Mask : 255.255.255.0
State : Active
# Check information about static routes on SwitchC to determine the active
and standby links.
[SwitchC] display ip routing-table protocol static
Route Flags: R - relay, D - download to fib, T - to vpn-
instance
------------------------------------------------------------------------------
Public routing table : Static
Destinations : 1 Routes : 2 Configured Routes : 6
Static routing table status : <Active>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 50 0 D 192.168.40.1 Vlanif40
Static routing table status : <Inactive>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 192.168.30.1 Vlanif30
# Disable gigabitethernet0/0/1 on SwitchB to simulate a link failure.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-gigabitethernet0/0/1] shutdown
[SwitchB-gigabitethernet0/0/1] quit
# Check information about the route monitoring group uplink on SwitchC.
The command output shows that the route status corresponding to the faulty
link is Inactive.
[SwitchC] display ip route-monitor-group uplink
route monitor group uplink
State : Enabled
-------------------------------------------------------
route monitor group tracking route number : 1
-------------------------------------------------------
VPN name : Public
Destination : 192.168.100.0
Mask : 255.255.255.0
State : Inactive
# Check information about static routes on SwitchC. The command output
shows that static routes on SwitchC have been bound to a route monitoring
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1078
group. If the route monitoring group detects a link failure, the RM module
immediately notifies the access device that the corresponding route is
unavailable.
[SwitchC] display ip routing-table protocol static
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Public routing table : Static
Destinations : 1 Routes : 2 Configured Routes : 6
Static routing table status : <Active>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 D 192.168.30.1 Vlanif40
Static routing table status : <Inactive>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 50 0 192.168.40.1 Vlanif30
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20 100
#
interface Vlanif10
ip address 192.168.100.1 255.255.255.0
#
interface Vlanif20
ip address 192.168.20.1 255.255.255.0
#
interface Vlanif100
ip address 192.168.100.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 100
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 40
#
interface Vlanif10
ip address 192.168.10.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.40.1 255.255.255.0
#
interface GigabitEthernet0/0/1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1079
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
ip route-static 192.168.50.0 255.255.255.0 192.168.40.2
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 30 40 50
#
interface Vlanif30
ip address 192.168.30.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.40.2 255.255.255.0
#
interface Vlanif50
ip address 192.168.50.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
ip route-monitor-group uplink
track ip route 192.168.100.0 255.255.255.0
monitor enable
#
ip route-static 0.0.0.0 0.0.0.0 192.168.40.1 preference 50 track route-monitor-group uplink
ip route-static 0.0.0.0 0.0.0.0 192.168.30.1
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 20 30
#
interface Vlanif20
ip address 192.168.20.2 255.255.255.0
#
interface Vlanif30
ip address 192.168.30.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ip route-static 192.168.50.0 255.255.255.0 192.168.30.2
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1080