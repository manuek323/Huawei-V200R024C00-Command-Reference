IPv6 over IPv4 Tunnel Configuration Commands

    Command Support
    destination
    interface tunnel
    source
    tunnel-protocol

Command Support

Only the following switch models support the IPv6 over IPv4 Tunnel:

S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
destination
Function

The destination command specifies the destination IP address of a tunnel interface.

The undo destination command deletes the destination IP address of a tunnel interface.

By default, no destination address is configured.
Format

destination [ vpn-instance vpn-instance-name ] dest-ip-address

undo destination
Parameters
Parameter 	Description 	Value
vpn-instance vpn-instance-name 	Specifies the name of the VPN instance that the destination address of a tunnel belongs to. When the tunnel interface uses GRE, you can specify vpn-instance vpn-instance-name. 	

The value is the name of an existing VPN instance.
dest-ip-address 	Specifies the destination IP address of a tunnel interface. 	

The IPv4 address is in dotted decimal notation.

The IPv6 address is a 32-digit hexadecimal number, in the format X:X:X:X:X:X:X:X.
Views

Tunnel interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

When configuring a GRE, MPLS TE, IPv4 over IPv6 tunnel or manual IPv6 over IPv4 tunnel, create a tunnel interface. After a tunnel interface is created, run the destination command to specify the destination IP address for the tunnel interface.

When using the destination command on a PE to specify the destination address of a GRE tunnel bound for a CE, you need to set vpn-instance vpn-instance-name in the command to specify the name of the VPN instance to which the destination address belongs.

Prerequisites

A tunnel interface has been created using the interface tunnel command, and the encapsulation mode is set to GRE, MPLS TE, IPv4 over IPv6 or IPv6 over IPv4 of manual mode using the tunnel-protocol command.

Precautions

Two tunnel interfaces with the same encapsulation mode, source address, and destination address cannot be configured simultaneously.

You can configure a main interface working in Layer 3 mode as the source tunnel interface.

On the GRE, MPLS TE, IPv4 over IPv6 tunnel or manual IPv6 over IPv4 tunnel, the destination address of the local tunnel interface is the source address of the remote tunnel interface, and the source address of the local tunnel interface is the destination address of the remote tunnel interface.
Example
# Establish a manual IPv6 over IPv4 tunnel between VLANIF 10 at 10.1.1.1 on switch HUAWEI1 and VLANIF 20 at 10.2.1.1 on switch HUAWEI2.

<HUAWEI1> system-view
[HUAWEI1] interface tunnel 1
[HUAWEI1-Tunnel1] tunnel-protocol ipv6-ipv4
[HUAWEI1-Tunnel1] source 10.1.1.1
[HUAWEI1-Tunnel1] destination 10.2.1.1

<HUAWEI2> system-view
[HUAWEI2] interface tunnel 1
[HUAWEI2-Tunnel1] tunnel-protocol ipv6-ipv4
[HUAWEI2-Tunnel1] source 10.2.1.1
[HUAWEI2-Tunnel1] destination 10.1.1.1

# Set the destination address of the GRE tunnel Tunnel1 to 10.1.1.1 that belongs to vpn1.

<HUAWEI> system-view
[HUAWEI] ip vpn-instance vpn1
[HUAWEI-vpn-instance-vpn1] ipv4-family
[HUAWEI-vpn-instance-vpn1-af-ipv4] route-distinguisher 100:1
[HUAWEI-vpn-instance-vpn1-af-ipv4] quit
[HUAWEI-vpn-instance-vpn1] quit
[HUAWEI] interface tunnel 1
[HUAWEI-Tunnel1] tunnel-protocol gre
[HUAWEI-Tunnel1] destination vpn-instance vpn1 10.1.1.1

interface tunnel
Function

The interface tunnel command creates a tunnel interface.

The undo interface tunnel command deletes the configured tunnel interface.

By default, no tunnel interface is configured.
Format

interface tunnel interface-number

undo interface tunnel interface-number
Parameters

Parameter
	

Description
	

Value

interface-number
	

Specifies the number of the tunnel interface.
	

The value is an integer that ranges from 0 to

2047

.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario
To forward data over a tunnel, ensure that the tunnel has been created. The system supports the following types of tunnels:

    LSP (Static LSP, BGP LSP, LDP LSP)

    MPLS TE

    GRE

    IPv6 over IPv4

    IPv4 over IPv6

You must use the interface tunnel command to create a tunnel interface when creating a tunnel except for LSP tunnels.

Precautions

Tunnel interface numbers are valid on the local device only. You can configure different numbers for the tunnel interfaces on the two ends.

Follow-up Procedure

After a tunnel interface is created, you need to configure an IP address and encapsulation type for the tunnel interface.

To save IP addresses, run the ip address unnumbered command to configure the tunnel interface to borrow an IP address of another interface.
The tunnel-protocol command configures an encapsulation protocol for the tunnel interface. Then basic configurations are performed based on the encapsulation protocol:

    On an MPLS TE tunnel, run the destination, mpls te tunnel-id, mpls te signal-protocol, and mpls te commit commands.
    On the GRE, IPv4 over IPv6 tunnel or manual IPv6 over IPv4 tunnel, run the source and destination commands.

Example

# Create a tunnel interface.

<HUAWEI> system-view
[HUAWEI] interface tunnel 1
[HUAWEI-Tunnel1]

source
Function

The source command configures the source address or source interface of the tunnel.

The undo source command deletes the configured source address or source interface.

The source address and source interface of a tunnel are not specified by default.
Format

source { source-ip-address | interface-type interface-number }

undo source
Parameters

Parameter
	

Description
	

Value

source-ip-address
	

Specifies the source address of a tunnel interface. If a tunnel interface works in IPv4-IPv6 mode, specify an IPv6 address as the source address of the tunnel interface.
	

The IPv4 address is in dotted decimal notation.

The IPv6 address is a 32-digit hexadecimal number, in the format X:X:X:X:X:X:X:X.

interface-type interface-number
	

Specifies the type and the number of the source interface of the tunnel. The following types of interfaces are often used: VLANIF and loopback.
	

-
Views

Tunnel interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

When configuring a GRE, MPLS TE, IPv4 over IPv6 tunnel or manual IPv6 over IPv4 tunnel, create a tunnel interface. After a tunnel interface is created, run the source command to specify the source IP address for the tunnel interface.

Prerequisites

A tunnel interface has been created using the interface tunnel command, and the encapsulation mode is set to GRE, MPLS TE, IPv4 over IPv6 or IPv6 over IPv4 of manual mode using the tunnel-protocol command.

Precautions

Two tunnel interfaces with the same encapsulation mode, source address, and destination address cannot be configured simultaneously.

You can configure a main interface working in Layer 3 mode as the source tunnel interface.

On the GRE, MPLS TE, IPv4 over IPv6 tunnel or manual IPv6 over IPv4 tunnel, the source address of the local tunnel interface is the destination address of the remote tunnel interface, and the destination address of the local tunnel interface is the source address of the remote tunnel interface.
Example
# Set the tunnel type of Tunnel1 to IPv6 over IPv4 of manual mode and configure the source IP address of Tunnel1 as 10.1.1.1.

<HUAWEI> system-view
[HUAWEI] interface tunnel 1
[HUAWEI-Tunnel1] tunnel-protocol ipv6-ipv4
[HUAWEI-Tunnel1] source 10.1.1.1

# Configure Tunnel1 of GRE and use Loopback1 address as the interface address.

<HUAWEI> system-view
[HUAWEI] interface Loopback 1
[HUAWEI-LoopBack1] ip address 10.2.1.1 32
[HUAWEI-LoopBack1] quit
[HUAWEI] interface tunnel 1
[HUAWEI-Tunnel1] tunnel-protocol gre
[HUAWEI-Tunnel1] source loopback 1

tunnel-protocol
Function

The tunnel-protocol command configures the tunnel protocol on a tunnel interface.

The undo tunnel-protocol command restores the tunnel protocol to the default configuration.

By default, no tunnel protocol is used on a tunnel interface.
Format

tunnel-protocol { gre | ipv6-ipv4 [ 6to4 | isatap ] | ipv4-ipv6 | mpls te | none }

undo tunnel-protocol
Parameters
Parameter 	Description 	Value

gre
	

Indicate that the GRE tunnel protocol is configured on a tunnel interface.
NOTE:

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support the parameters.
	

-

ipv4-ipv6
	

Indicate that the IPv4 to IPv6 tunnel protocol is configured on a tunnel interface.
NOTE:

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S support the parameter.
	

-

ipv6-ipv4 [ 6to4 | isatap ]
	

Configure the tunnel protocol of the tunnel interface as ipv6-ipv4:

    ipv6-ipv4: use a manual IPv6 over IPv4 tunnel
    ipv6-ipv4 6to4 : using 6to4 tunnel
    ipv6-ipv4 isatap : using isatap tunnel

NOTE:

Only the S5720I-SI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support these parameters.
	

-

mpls te
	

Indicate that the MPLS TE tunnel protocol is configured on a tunnel interface.
NOTE:

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730-S, S6730S-S, and S6730S-H support the parameter.
	

-

none
	

Indicate that no tunnel protocol is configured on a tunnel interface.
	

-
Views

Tunnel interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

After creating a tunnel interface using the interface tunnel command, run the tunnel-protocol command to configure the tunnel encapsulation mode for the tunnel interface.
The following tunnel encapsulation modes are available:

    GRE: encapsulates packets of some network layer protocols such as IP or IPX to enable these encapsulated packets to be transmitted on networks running other protocols such as IP.
    IPv4-IPv6: creates tunnels on the IPv6 networks to connect IPv4 isolated sites so that IPv4 isolated sites can access other IPv4 networks through the IPv6 public network.
    IPv6-IPv4: creates tunnels on the IPv4 networks to connect IPv6 isolated sites so that IPv6 packets can be transmitted on IPv4 networks.
    MPLS TE: integrates the MPLS technology with traffic engineering. It can reserve resources by setting up LSP tunnels for a specified path in an attempt to avoid network congestion and balance network traffic.

Precautions

    The none mode indicates the initial configuration, that is, no tunnel encapsulation mode is configured. In practice, you must select another tunnel encapsulation mode.
    You must configure the tunnel encapsulation mode before setting the source IP address or other parameters for a tunnel interface. Changing the encapsulation mode of a tunnel interface deletes other parameters of the tunnel interface.

Example
# Set the tunnel encapsulation mode of Tunnel2 to GRE.

<HUAWEI> system-view
[HUAWEI] interface tunnel 2
[HUAWEI-Tunnel2] tunnel-protocol gre

