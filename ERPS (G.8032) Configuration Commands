ERPS (G.8032) Configuration Commands

    Command Support
    clear (ERPS ring view)
    control-vlan (ERPS ring view)
    description (ERPS ring view)
    display erps
    display erps interface
    display erps statistics
    encapsulate-ring-id enable
    erps ring
    erps ring (interface view)
    erps ring protect-switch
    erps track cfm
    erps vpls-subinterface enable
    guard-timer (ERPS ring view)
    holdoff-timer (ERPS ring view)
    port (ERPS ring view)
    protected-instance (ERPS ring view)
    raps-mel
    reset erps statistics
    revertive
    sub-ring
    tc-notify erps ring
    tc-notify sep
    tc-protection interval (ERPS ring view)
    tc-protection threshold (ERPS ring view)
    version (ERPS ring view)
    virtual-channel
    wtr-timer (ERPS ring view)

Command Support

Commands provided in this section and all the parameters in the commands are supported by all switch models (except the S5751-L, S5731-L, and S5731S-L), unless otherwise specified. For details, see specific commands.
clear (ERPS ring view)
Function

The clear command clears the port blocking mode of an ERPS ring.
Format

clear
Parameters

None
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario
To clear the FS or MS mode configured by the erps ring protect-switch command, run the clear command. The clear command also provides the following functions:

    Triggers revertive switching before the WTR or WTB timer expires in the case of revertive switching operations.
    Triggers revertive switching in the case of non-revertive operations.

Precautions

The clear command is supported in both ERPSv1 and ERPSv2.
Example

# Clear the port blocking mode of ERPS ring 5.

<HUAWEI> system-view
[HUAWEI] erps ring 5
[HUAWEI-erps-ring5] clear

control-vlan (ERPS ring view)
Function

The control-vlan command configures a control VLAN for an ERPS ring to forward RAPS PDUs.

The undo control-vlan command deletes the configured control VLAN.

By default, no control VLAN is configured in an ERPS ring.
Format

control-vlan vlan-id

undo control-vlan
Parameters
Parameter 	Description 	Value
vlan-id 	Specifies the ID of a control VLAN for an ERPS ring. 	The value is an integer that ranges from 1 to 4094.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

After an ERPS ring is created, run the control-vlan command to create the control VLAN. Unlike a data VLAN, a control VLAN is used only to forward ERPS protocol packets but not forward service packets in an ERPS ring, which improves the security of the ERPS protocol.

Precautions

    If you run the control-vlan command multiple times, only the latest configuration takes effect.

    After a control VLAN is created, the vlan batch { vlan-id1 [ to vlan-id2 ] } &<1-10> command used to create common VLANs is displayed in the configuration file.
    After a port is added to an ERPS ring configured with a control VLAN, the port is added to the control VLAN.
        If the port is a trunk port, the port trunk allow-pass vlan vlan-id command is displayed in the record of the port that has been added to the ERPS ring in the configuration file.
        If the port is a hybrid port, the port hybrid tagged vlan vlan-id command is displayed in the record of the port that has been added to the ERPS ring in the configuration file.

    All the devices in an ERPS ring must use the same control VLAN in an ERPS ring, and different ERPS rings must use different control VLANs.

    The control VLAN must be not created, and is not used by other features. In addition, no interface is added to the control VLAN.

    If ports have been added to an ERPS ring, the control VLAN cannot be modified. To delete the configured control VLAN, run the undo erps ring command in the interface view or the undo port command in the ERPS ring view to delete ports from the ERPS ring, and run the undo control-vlan command to delete the control VLAN.

    Run the display erps command to check whether the control VLAN is configured or which VLAN is configured as the control VLAN.

Example

# Configure control VLAN 5 in ERPS ring 1.

<HUAWEI> system-view
[HUAWEI] erps ring 1
[HUAWEI-erps-ring1] control-vlan 5

description (ERPS ring view)
Function

The description command configures the description of an ERPS ring.

The undo description command restores the default description of an ERPS ring.

By default, the description of an ERPS ring is the name of the ERPS ring. For example, if the name of an ERPS ring is Ring1, the default description of the ring is Ring 1.
Format

description text

undo description
Parameters
Parameter 	Description 	Value

text
	

Specifies the description of an ERPS ring.
	

The value is a string of 1 to 80 case-sensitive characters.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

You can run the description command on the ERPS-enabled device to configure the description of an ERPS ring. The description contains information such as the ID of the ERPS ring, which facilitates maintenance.

Precautions

If you run the description command multiple times, only the latest configuration takes effect.

After the description is configured in the ERPS ring view, the description only takes effect on the device.
Example

# Configure the description of the ERPS ring 10 as huawei Ring 1 on the device.

<HUAWEI> system-view
[HUAWEI] erps ring 10
[HUAWEI-erps-ring10] description huawei Ring 1

display erps
Function

The display erps command displays ports that are added to an ERPS ring and information about the ERPS ring.
Format

display erps [ ring ring-id ] [ verbose ]
Parameters
Parameter 	Description 	Value
ring ring-id 	Displays information about an ERPS ring and the ports that are added to the ERPS ring. 	The value is an integer that ranges from 1 to 255.
verbose 	Displays detailed information about an ERPS ring and the ports that are added to the ERPS ring. 	-
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

You can run the display erps command on the ERPS-enabled device to view ports added to the ERPS ring and information about the ERPS ring. The command output facilitates ERPS management and helps you learn the running status of ports.

Prerequisites

To view information about ports that have been added to a specified ERPS ring and the ERPS ring, ensure that the ERPS ring has already been created.

Precautions

If ring ring-id is not specified, information about all the ERPS rings and ports added to the ERPS rings is displayed.
Example

# Display information about all ERPS rings and ports that are added to the ERPS rings.

<HUAWEI> display erps

D  : Discarding
F  : Forwarding
R  : RPL Owner
N  : RPL Neighbour
FS : Forced Switch
MS : Manual Switch
Total number of rings configured = 4
Ring  Control  WTR Timer  Guard Timer  Port 1               Port 2              
ID    VLAN     (min)      (csec)
--------------------------------------------------------------------------------
   1      100          1           50  (D)GE0/0/1           (F,R)GE0/0/2                      
   2      200          2           50  (D)GE0/0/3           (F)GE0/0/4
   3      300          3           50  (F)ETH-TRUNK3        (D)ETH-TRUNK4
   4      400          5           50  (F,R)ETH-TRUNK1      (D)ETH-TRUNK2
--------------------------------------------------------------------------------

# Display information about ERPS ring 1 and ports that are added to ERPS ring 1.

<HUAWEI> display erps ring 1

D  : Discarding
F  : Forwarding
R  : RPL Owner
N  : RPL Neighbour
FS : Forced Switch
MS : Manual Switch
Ring  Control  WTR Timer  Guard Timer  Port 1               Port 2              
ID    VLAN     (min)      (csec)
--------------------------------------------------------------------------------
   1      100          1           50  (D)GE0/0/1           (F,R)GE0/0/2
--------------------------------------------------------------------------------

# Display detailed information about all ERPS rings and ports that are added to the ERPS rings.

<HUAWEI> display erps verbose

Ring ID                             : 101
Description                         : Ring 101
Control Vlan                        : 1001
Protected Instance                  : 4091 
Service Vlan                        : 200 to 400
WTR Timer Setting (min)             : 1      Running (s)           : 0  
Guard Timer Setting (csec)          : 200    Running (csec)        : 0  
Holdoff Timer Setting (deciseconds) : 0      Running (deciseconds) : 0  
WTB Timer Running (csec)            : 0  
Ring State                          : Idle
RAPS_MEL                            : 7
Revertive Mode                      : Revertive
R-APS Channel Mode                  : -
Version                             : 2
Sub-ring                            : No 
Forced Switch Port                  : -
Manual Switch Port                  : -
TC-Notify                           : -
Time since last topology change     : 0 days 0h:31m:49s
--------------------------------------------------------------------------------
Port                Port Role     Port Status     Signal Status
--------------------------------------------------------------------------------
GE0/0/1             Common        Discarding      Non-failed      
GE0/0/2             Common        Forwarding      Non-failed      

Ring ID                             : 102
Description                         : Ring 102
Control Vlan                        : 1002
Protected Instance                  : 4092 
Service Vlan                        : 500 to 600
WTR Timer Setting (min)             : 1      Running (s)           : 0  
Guard Timer Setting (csec)          : 200    Running (csec)        : 0  
Holdoff Timer Setting (deciseconds) : 0      Running (deciseconds) : 0  
WTB Timer Running (csec)            : 0  
Ring State                          : Idle
RAPS_MEL                            : 7
Revertive Mode                      : Revertive
R-APS Channel Mode                  : -
Version                             : 2
Sub-ring                            : No 
Forced Switch Port                  : -
Manual Switch Port                  : -
TC-Notify                           : -
Time since last topology change     : 0 days 4h:12m:20s
--------------------------------------------------------------------------------
Port                Port Role     Port Status     Signal Status
--------------------------------------------------------------------------------
GE0/0/1             Common        Forwarding      Non-failed      
GE0/0/2             RPL Owner     Discarding      Non-failed

# Display detailed information about ERPS ring 1 and ports that are added to ERPS ring 1.

<HUAWEI> display erps ring 1 verbose

Ring ID                             : 1
Description                         : Ring 102
Control Vlan                        : 1002
Protected Instance                  : 4092 
Service Vlan                        : 500 to 600
WTR Timer Setting (min)             : 1      Running (s)           : 0  
Guard Timer Setting (csec)          : 200    Running (csec)        : 0  
Holdoff Timer Setting (deciseconds) : 0      Running (deciseconds) : 0  
WTB Timer Running (csec)            : 0  
Ring State                          : Idle
RAPS_MEL                            : 7
Revertive Mode                      : Revertive
R-APS Channel Mode                  : -
Version                             : 2
Sub-ring                            : No 
Forced Switch Port                  : -
Manual Switch Port                  : -
TC-Notify                           : -
Time since last topology change     : 0 days 4h:13m:40s
--------------------------------------------------------------------------------
Port                Port Role     Port Status     Signal Status
--------------------------------------------------------------------------------
GE0/0/1             Common        Forwarding      Non-failed      
GE0/0/2             RPL Owner     Discarding      Non-failed      

Table 5-103 Description of the display erps command output

Item
	

Description

D: Discarding
	

The port is in discarding state.

F: Forwarding
	

The port is in forwarding state.

R: RPL Owner
	

The port is the RPL Owner port.

N : RPL Neighbour
	

The port is the RPL neighbor port.

FS : Forced Switch
	

The port is blocked by an FS operation.

MS : Manual Switch
	

The port is blocked by an MS operation.

Total number of rings configured
	

Number of ERPS rings.

Ring ID
	

ID of the ERPS ring. To configure an ERPS ring, run the erps ring command.

Control VLAN
	

Control VLAN. To configure a control VLAN, run the control-vlan command.

WTR Timer (min)
	

Value of the WTR timer. To set the value of the WTR timer, run the wtr-timer command.

Guard Timer (csec)
	

Value of the Guard timer. To set the value of the Guard timer, run the guard-timer command.

Port 1
	

A port that is added to the specified ERPS ring.

Port 2
	

Another port that is added to the specified ERPS ring.

Description
	

Description of an ERPS ring. To configure the description, run the description command.

Protected Instance
	

ERPS instance. To configure an ERP instance, run the protected-instance command.

Service Vlan
	

Service VLAN associated with ERPS.

A service VLAN is mapped to an ERP instance, and is not the control VLAN.

WTR Timer Setting (min)

Running (s)
	

Value of the WTR timer. Setting indicates the configured value and Running indicates the actual value. To set the value of the WTR timer, run the wtr-timer command.

Guard Timer Setting (csec)

Running (csec)
	

Value of the Guard timer. Setting indicates the configured value and Running indicates the actual value. To set the value of the Guard timer, run the guard-timer command.

Holdoff Timer Setting (deciseconds)

Running (deciseconds)
	

Value of the Holdoff timer. Setting indicates the configured value and Running indicates the actual value. To set the value of the Holdoff timer, run the holdoff-timer command.

WTB Timer Running (csec)
	

Value of the WTB timer.

Ring State
	
Status of the ERPS ring:

    Idle: indicates that the current blocking point is the RPL Owner port.
    Protection: indicates that a fault has occurred on a link or a device.
    Pending: indicates a transition state during ERPS ring negotiation. For example, the blocking point is being switched back to the RPL Owner port.
    ForcedSwitch: The FS mode is used to block an ERPS port.
    ManualSwitch: The MS mode is used to block an ERPS port.

RAPS_MEL
	

MEL value. To set the MEL value, run the raps-mel command.

Revertive Mode
	
Revertive or non-revertive switching mode to be used after a faulty ERPS link recovers:

    Revertive: re-blocks the RPL owner port after a faulty ERPS link recovers.
    Non-revertive: retains the RPL owner port status and still blocks the port of the faulty link after a faulty ERPS link recovers.

To configure the revertive or non-revertive switching mode, run the revertive command.

R-APS Channel Mode
	
RAPS PDU transmission mode in a sub-ring:

    -: The current ring is not a sub-ring.
    Virtual Channel: VCs are used to transmit RAPS PDUs.
    Non-virtual-channel: NVCs are used to transmit RAPS PDUs.

To configure an RAPS PDU transmission mode in a sub-ring, run the virtual-channel command.

Version
	
ERPS version:

    1: ERPSv1
    2: ERPSv2

To configure an ERPS version, run the version command.

Sub-ring
	

ERPS sub-ring ID. To configure an ERPS sub-ring ID, run the sub-ring command.

Forced Switch Port
	

Port that has been blocked by an FS operation. A hyphen (-) indicates that no port has been blocked by an FS operation.

To configure an FS mode, run the erps ring protect-switch command.

Manual Switch Port
	

Port that has been blocked by an MS operation. A hyphen (-) indicates that no port has been blocked by an MS operation.

To configure a port blocking mode for an ERPS port, run the erps ring protect-switch command.

TC-Notify
	

The ERPS ring is configured to notify other ERPS rings of its topology change. A hyphen (-) indicates that the ERPS ring does not notify other ERPS rings when its topology changes.

To configure an ERPS ring to notify other ERPS rings of its topology change, run the tc-notify erps ring command.

Time since last topology change
	

Period since the last ERPS ring topology change.

Port
	

Port that is added to the ERPS ring.

Port Role
	
Port role:

    RPL Owner
    Common
    RPL Neighbour

Port Status
	
Port status:

    Forwarding
    Discarding

Signal Status
	
Signal status:

    Failed: A fault occurs.
    Non-failed: No fault occurs.

display erps interface
Function

The display erps interface command displays ERPS information of a port that has been added to an ERPS ring.
Format

display erps interface interface-type interface-number [ ring ring-id ]
Parameters
Parameter 	Description 	Value
interface-type interface-number 	Displays ERPS information of a specified port that has been added to an ERPS ring.

    interface-type specifies the interface type.
    interface-number specifies the interface number.

	-
ring ring-id 	Specifies the ID of the ERPS ring to which the port has been added. 	The value is an integer that ranges from 1 to 255.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To check the running status of ports that have been added to an ERPS ring, run the display erps interface command.
Example

# Display ERPS information about GigabitEthernet0/0/1.

<HUAWEI> display erps interface gigabitethernet 0/0/1

Interface State                    : Up
--------------------------------------------------------------------------------
Ring ID                            : 1                                          
Flush Logic                                                                     
    Remote Node ID                 : 0000-0000-0000                             
    Remote BPR                     : 0                                          
Track Link Detect Protocol         : 1AG                                        
    MD Name                        : 1                                          
    MA Name                        : 1                                          
    MEP ID                         : 2270                                       
    RMEP ID                        : 2260                                       
    CFM State                      : Failed

Table 5-104 Description of the display erps interface command output

Item
	

Description

Interface State
	

Physical status of the port.

Ring ID
	

ID of the ERPS ring to which the port has been added.

Flush Logic
	

Whether the FDB logic is updated.

Remote Node ID
	

ID of the remote node.

Remote BPR
	

Blocked port reference of the remote node.

Track Link Detect Protocol
	

Protocol associated with ERPS on the port. The hyphen (-) indicates that no protocol is associated with ERPS on the port.

MD Name
	

Name of the maintenance domain for which Ethernet CFM is associated with ERPS.

MA Name
	

Name of the maintenance association (MA) where Ethernet CFM is associated with ERPS.

MEP ID
	

ID of the maintenance association end point (MEP) where Ethernet CFM is associated with ERPS.

RMEP ID
	

ID of the remote maintenance association end point (RMEP) where Ethernet CFM is associated with ERPS.

CFM State
	

Status of the protocol associated with ERPS on the port.
display erps statistics
Function

The display erps statistics command displays statistics about sent and received ring auto protection switching (RAPS) protocol data units (PDUs) on the ports that have been added to ERPS rings.
Format

display erps [ ring ring-id ] statistics
Parameters
Parameter 	Description 	Value
ring ring-id 	Specifies the ID of an ERPS ring. If this parameter is not specified, this command displays statistics about sent and received RAPS PDUs on ports that are added to all ERPS rings. 	The value is an integer that ranges from 1 to 255.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

On a Layer 2 network running ERPS, the display erps statistics command displays statistics about sent and received RAPS PDUs on the ports that are added to ERPS rings. The command output helps you analyze the network situation, learn the network running status, and maintain devices.

Prerequisites

To query statistics about sent and received RAPS PDUs on the ports that have been added to a specified ERPS ring, ensure that the ERPS ring has been created.
Example

# Display statistics about sent and received RAPS PDUs on the ports that are added to ERPS rings.

<HUAWEI> display erps statistics

--------------------------------------------------------------------------------
Ring Port            RX/TX       SF       NR     NRRB       FS       MS    EVENT
--------------------------------------------------------------------------------
   1 Eth-Trunk1      RX           0        0      552        0        0        0
   1 Eth-Trunk1      TX           0       68        0      326        0        6
   1 GE0/0/1         RX           0        6      552        0        0        0
   1 GE0/0/1         TX           4       63        0      326        0        6
  10 GE0/0/2         RX           0        1        0        0        0        0
  10 GE0/0/2         TX           4       74        0        0        0        0

# Display statistics about sent and received RAPS PDUs on the ports that are added to ERPS ring 2.

<HUAWEI> display erps ring 2 statistics

--------------------------------------------------------------------------------
Ring  Port           RX/TX       SF       NR     NRRB       FS       MS    EVENT
--------------------------------------------------------------------------------
   2  GE0/0/1       RX           0        1        0        0        0        0
   2  GE0/0/1       TX           4       74        0        0        0        0

Table 5-105 Description of the display erps statistics command output

Item
	

Description

Ring
	

ID of the ERPS ring. To configure an ERPS ring, run the erps ring command.

Port
	

Port that is added to the ERPS ring.

RX/TX
	
RAPS PDU forwarding:

    RX: RAPS PDUs are received.
    TX: RAPS PDUs are sent.

SF
	

Statistics about RAPS (SF) messages.

NR
	

Statistics about RAPS (NR) messages.

NRRB
	

Statistics about RAPS (NR, RB) messages.

FS
	

Statistics about RAPS (FS) messages.

MS
	

Statistics about RAPS (MS) messages.

EVENT
	

Statistics about RAPS Event messages.
encapsulate-ring-id enable
Function

The encapsulate-ring-id enable command enables ERPS ring ID encapsulation in the destination MAC addresses of ERPS protocol packets.

The undo encapsulate-ring-id enable command disables ERPS ring ID encapsulation in the destination MAC addresses of ERPS protocol packets.

By default, ERPS ring ID encapsulation in the destination MAC addresses of ERPS protocol packets is disabled.
Format

encapsulate-ring-id enable

undo encapsulate-ring-id enable
Parameters

None
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

A Huawei device cannot communicate with a non-Huawei device that sends ERPS protocol packets whose destination MAC addresses carry ERPS ring IDs. To enable the Huawei device to communicate with such a non-Huawei device, run the encapsulate-ring-id enable command to enable ERPS ring ID encapsulation in the destination MAC addresses of ERPS protocol packets sent by the Huawei device.

Precautions

The encapsulate-ring-id enable command and its undo form fail to be run in the view of an ERPS ring that has an interface added. To resolve this issue, remove the interface from the ERPS ring by running the undo erps ring ring-id command in the interface view or undo port interface-type interface-number command in the ERPS ring view.
Example

# Enable ERPS ring ID encapsulation in the destination MAC addresses of ERPS protocol packets.

<HUAWEI> system-view
[HUAWEI] erps ring 1
[HUAWEI-erps-ring1] encapsulate-ring-id enable

erps ring
Function

The erps ring command creates an ERPS ring and displays the view of the ERPS ring, or directly displays the view of an existing ERPS ring.

The undo erps ring command deletes a created ERPS ring.

By default, no ERPS ring is created.
Format

erps ring ring-id

undo erps ring ring-id
Parameters
Parameter 	Description 	Value
ring-id 	Specifies the ID of an ERPS ring. 	The value is an integer that ranges from 1 to 255.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

Ethernet Ring Protection Switching (ERPS) is a standard protocol issued by the ITU-T to prevent loops on ring networks. ERPS implements fast convergence of carrier-class reliability standards. It allows all ERPS-capable devices on a ring network to communicate.

To enable ERPS on the device, run the erps ring command to create an ERPS ring and enter the ERPS ring view.

To configure parameters such as the control VLAN and the protected instance for an ERPS ring, run the erps ring command to enter the ERPS ring view.

Follow-up Procedure

Run the control-vlan (ERPS ring view) command to configure a control VLAN for the ERPS ring.

Run the protected-instance (ERPS ring view) command to configure an ERP instance for the ERPS ring.

Precautions

To delete an ERPS ring, ensure that no ports are added to the ERPS ring. If any port is added to the ERPS ring, the system displays a message indicating a failure to delete the ERPS ring. To delete an ERPS ring where ports are added, run the undo erps ring command in the interface view or the undo port command in the ERPS ring view to remove the port, and run the undo erps ring command to delete the ERPS ring.
Example

# Create ERPS ring 1.

<HUAWEI> system-view
[HUAWEI] erps ring 1
[HUAWEI-erps-ring1]

erps ring (interface view)
Function

The erps ring command adds a port to an ERPS ring and specifies a role for the port.

The undo erps ring command deletes a port from an ERPS ring and cancels the port role.

By default, a port is not added to an ERPS ring, and no port role is specified.
Format

erps ring ring-id [ rpl { owner | neighbour } ]

undo erps ring ring-id
Parameters
Parameter 	Description 	Value

ring-id
	

Specifies the ID of an ERPS ring.
	

The value is an integer that ranges from 1 to 255.

rpl { owner | neighbour }
	

Specifies the port to be added to an ERPS ring as the RPL owner port or RPL neighbor port.
	

-
Views

Ethernet interface view, GE interface view, XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view, MultiGE interface view, Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

After an ERPS ring is created, run the erps ring command in the interface view to add Layer 2 ports to the ERPS ring so that RAPS PDUs can be correctly forwarded. Each device in an ERPS ring is a node, and a maximum of two Layer 2 ports on each node can be added to the same ERPS ring.
ERPS defines three port roles: RPL owner port, RPL neighbor port (only in ERPSv2), and common port.

    RPL owner port

    An RPL owner port is responsible for blocking traffic over the Ring Protection Link (RPL) to prevent loops. An ERPS ring has only one RPL owner port.

    When the node on which the RPL owner port resides receives an RAPS PDU indicating a link or node fault in an ERPS ring, the node unblocks the RPL owner port. Then the RPL owner port can send and receive traffic to ensure nonstop traffic forwarding.

    The link where the RPL owner port resides is the RPL.

    RPL neighbor port

    An RPL neighbor port is directly connected to an RPL owner port.

    Both the RPL owner port and RPL neighbor ports are blocked in normal situations to prevent loops.

    If an ERPS ring fails, both the RPL owner and neighbor ports are unblocked.

    The RPL neighbor port helps reduce the number of FDB entry updates on the device where the RPL neighbor port resides.

    Common port

    Common ports are ring ports other than the RPL owner and neighbor ports.

    A common port monitors the status of the directly connected ERPS link and sends RAPS PDUs to notify the other ports of its link status changes.

Prerequisites

An ERPS ring has been created using the erps ring command.

    The control VLAN and ERP instance have been configured using the control-vlan and protected-instance commands respectively in the ERPS ring view.

    The port is not a Layer 3 port. If the port is a Layer 3 port, run the portswitch command to switch the port to the Layer 2 mode.
    Spanning Tree Protocol (STP), Rapid Ring Protection Protocol (RRPP), Smart Ethernet Protection (SEP), or Smart Link is not enabled on the port.
        If the port has STP enabled, run the stp disable command in the interface view to disable STP.
        If the port has RRPP enabled, run the undo ring ring-id command in the RRPP domain view to disable RRPP.
        If the port has SEP enabled, run the undo sep segment segment-id command in the interface view to disable SEP.
        If the port has Smart Link enabled, run the undo port command in the Smart Link group view to disable Smart Link.
    ERPSv2 has been specified in the ERPS ring using the version v2 command if the port is specified as an RPL neighbor port.

Precautions

    Before running the undo erps ring command to delete a port from an ERPS ring, run the shutdown (interface view) command to shut down the port. The port can be enabled again according to the actual situation.

    If ports added to an ERPS ring are all ordinary ports, any port on the device with the largest MAC address will be blocked.

    If an RPL neighbor port is configured for a non-virtual channel of a sub-ring, network convergence may fail to meet requirements because SF packets are discarded on the port in the case of a link fault.

Example
# Add GE0/0/1 to ERPS ring 2.

<HUAWEI> system-view
[HUAWEI] interface gigabitethernet 0/0/1
[HUAWEI-GigabitEthernet0/0/1] erps ring 2

erps ring protect-switch
Function

The erps ring protect-switch command configures a port blocking mode for an ERPS port.
Format

erps ring ring-id protect-switch { force | manual }
Parameters
Parameter 	Description 	Value

ring-id
	

Specifies the ID of an ERPS ring.
	

The value is an integer that ranges from 1 to 255.

force
	

Forcibly blocks a port immediately after FS is configured, irrespective of whether link failures have occurred.
	

-

manual
	

Indicates the MS mode for blocking an ERPS port.
	

-
Views

Ethernet interface view, GE interface view, XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view, MultiGE interface view, Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario
Because the Ring Protection Link (RPL) may have high bandwidth, you can block the low-bandwidth link so that user traffic can be transmitted on the RPL. ERPSv2 supports both Forced Switch (FS) and Manual Switch (MS) modes for blocking an ERPS port:

    FS: forcibly blocks a port immediately after FS is configured, irrespective of whether link failures have occurred.
    MS: blocks a port on which MS is configured when the ERPS ring is in Idle or Pending state.

FS takes precedence over MS.

Prerequisites

    The erps ring or port (ERPS ring view) command has been executed to add the port to an ERPS ring.
    The version v2 command has been executed to specify ERPSv2.

Configuration Impact

After an ERPS port is blocked in FS or MS mode, the node on which the ERPS port resides sends RAPS (FS) or RAPS (MS) messages to the other nodes in the ERPS ring. As a result, ERPS performs recalculation and finally unblocks the RPL owner port.

Precautions

The ERPS ring specified by ring-id must be the one to which the port belongs; otherwise, the command does not take effect.

To change the port blocking mode from MS to FS, run the erps ring ring-id protect-switch force command to set the FS mode. To change the port blocking mode from FS to MS, run the clear command in the ERPS ring view to delete the FS mode, and then run the erps ring ring-id protect-switch manual command to set the MS mode.

You can delete the manual port blocking mode only by using the clear command in the ERPS ring view.

The erps ring protect-switch command is not saved in the configuration file.
Example

# Specify the FS mode to block GigabitEthernet0/0/1 in ERPS ring 5.

<HUAWEI> system-view
[HUAWEI] interface gigabitethernet 0/0/1
[HUAWEI-GigabitEthernet0/0/1] erps ring 5
[HUAWEI-GigabitEthernet0/0/1] erps ring 5 protect-switch force

erps track cfm
Function

The erps track cfm command associates ERPS with Ethernet CFM to fast detect link failures.

The undo erps track cfm command disassociates ERPS from Ethernet CFM.

By default, ERPS is not associated with Ethernet CFM.
Format

erps ring ring-id track cfm md md-name ma ma-name mep mep-id remote-mep rmep-id

undo erps ring ring-id [ track cfm ]
Parameters
Parameter 	Description 	Value

ring ring-id
	

Specifies the ID of an ERPS ring.
	

The value is an integer that ranges from 1 to 255.

md md-name
	

Specifies the name of a maintenance domain (MD).
	
The value is a string of 1 to 43 case-sensitive characters. Spaces and question marks (?) are not supported. MD names on a device must be unique.
NOTE:

When double quotation marks are used around the string, spaces are allowed in the string.

ma ma-name
	

Specifies the name of a maintenance association (MA).
	
The value is a string of 1 to 43 case-sensitive characters. Spaces and question marks (?) are not supported.
NOTE:

When double quotation marks are used around the string, spaces are allowed in the string.

mep mep-id
	

Specifies the ID of a maintenance association end point (MEP).
	

The value is an integer that ranges from 1 to 8191.

remote-mep rmep-id
	

Specifies the ID of a remote maintenance association end point (RMEP).
	

The value is an integer that ranges from 1 to 8191.
Views

Ethernet interface view, GE interface view, XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view, MultiGE interface view, Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

To fast detect faults, implement fast convergence, and shorten traffic interruptions, run the erps track cfm command to associate ERPS with Ethernet CFM on a port added to an ERPS ring.

Prerequisites

    STP, RRPP, or SEP is not enabled on the port.
        If the port has STP enabled, run the stp disable command in the interface view to disable STP.
        If the port has RRPP enabled, run the undo ring ring-id command in the RRPP domain view to disable RRPP.
        If the port has SEP enabled, run the undo sep segment segment-id command in the interface view to disable SEP.

    The port is not a Layer 3 port. If the port is a Layer 3 port, run the portswitch command to switch the port to the Layer 2 mode.

    The ERPS ring specified by ring ring-id must be the one to which the port belongs.

    Ethernet CFM has not been applied to other ports in the ERPS ring.

Precautions

This command is supported in both ERPSv1 and ERPSv2.

The association between ERPS and CFM takes effect only when the interface has ERPS associated with CFM and has an interface-based MEP created using the mep mep-id command.
Example

# Associate ERPS with Ethernet CFM on GigabitEthernet0/0/1.

<HUAWEI> system-view

[HUAWEI] interface gigabitethernet 0/0/1

[HUAWEI-GigabitEthernet0/0/1] erps ring 5

[HUAWEI-GigabitEthernet0/0/1] erps ring 5 track cfm md md1 ma ma1 mep 1 remote-mep 2

erps vpls-subinterface enable
Function

The erps vpls-subinterface enable command enables topology change notification of an interface to instruct VSI-bound sub-interfaces or VLANIF interfaces to update MAC address entries promptly after the ERPS ring topology changes.

The undo erps vpls-subinterface enable command disables topology change notification of an interface.

By default, the interface does not instruct VSI-bound sub-interfaces or VLANIF interfaces to update MAC address entries promptly after the ERPS ring topology changes.

Only the S5731-H, S5731S-H, S5732-H, S5731-S, S5731S-S, S6730-S, S6730S-S, S6730S-H, S6730-H support this command.
Format

erps vpls-subinterface enable

undo erps vpls-subinterface enable
Parameters

None
Views

GE interface view, XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view, Eth-Trunk interface view, MultiGE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

In normal situations, when an ERPS ring topology changes, the ERPS ring reselects a blocked interface, and accordingly all devices will update MAC address entries. However, if an ERPS-enabled interface has VSI-bound sub-interfaces or VLANIF interfaces, which cannot detect topology changes immediately, the MAC address entries will not be updated on the VPLS network in time. To resolve this problem, run the erps vpls-subinterface enable command to enable an interface to instruct VSI-bound sub-interfaces or VLANIF interfaces to update MAC address entries promptly after the ERPS ring topology changes.

Prerequisites

An interface has been added to an ERPS ring using the erps ring (interface view) command.

Configuration Impact

After the erps vpls-subinterface enable command has been run, when the forwarding status of an interface changes to Discarding, its VSI-bound sub-interfaces or VLANIF interfaces will change to the Flowdown state to prevent loops on the VPLS network on which a CE is dual-homed to PEs.

Precautions

The erps vpls-subinterface enable and stp vpls-subinterface enable commands are mutually exclusive on the same interface.

If an interface is deleted from all ERPS rings using the undo erps ring command, the erps vpls-subinterface enable command configuration on the interface is also deleted.

If a user is delivering the ERPS configuration, the erps vpls-subinterface enable command fails to be run.
Example

# Enable GE0/0/1 to instruct VSI-bound sub-interfaces or VLANIF interfaces to update MAC address entries promptly after the ERPS ring topology changes.

<HUAWEI> system-view
[HUAWEI] interface gigabitethernet 0/0/1
[HUAWEI-GigabitEthernet0/0/1] erps ring 1
[HUAWEI-GigabitEthernet0/0/1] erps vpls-subinterface enable

guard-timer (ERPS ring view)
Function

The guard-timer command sets the Guard timer in an ERPS ring.

The undo guard-timer command restores the default value of the Guard timer.

By default, the Guard timer is 200 centiseconds in an ERPS ring.
Format

guard-timer time-value

undo guard-timer
Parameters
Parameter 	Description 	Value
time-value 	Specifies the value of the Guard timer in an ERPS ring. 	The value is an integer that ranges from 1 to 200, in centiseconds.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

On a Layer 2 network running ERPS, after a faulty link or node recovers, the device sends RAPS PDUs to inform the other nodes of link or node recovery and starts the Guard timer. Before the Guard timer expires, the device does not receive any RAPS PDU. If the device receives out-of-date RAPS PDUs indicating that the link or node fails, the local port may be blocked again. After the Guard timer expires, if the device receives an RAPS PDU indicating that another port fails, the local port enters the Forwarding state.

Precautions

If the value of the Guard timer is too small, network loops may occur. The default value (200 centiseconds) is recommended.
Example

# Set the Guard timer to 180 centiseconds in ERPS ring 10.

<HUAWEI> system-view
[HUAWEI] erps ring 10
[HUAWEI-erps-ring10] guard-timer 180

holdoff-timer (ERPS ring view)
Function

The holdoff-timer command sets the Holdoff timer in an ERPS ring.

The undo holdoff-timer command restores the default value of the Holdoff timer.

By default, the Holdoff timer is 0 deciseconds in an ERPS ring.
Format

holdoff-timer time-value

undo holdoff-timer
Parameters
Parameter 	Description 	Value
time-value 	Specifies the value of the Holdoff timer in an ERPS ring. 	The value is an integer that ranges from 0 to 100, in deciseconds.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

On Layer 2 networks running ERPS, there may be different requirements for protection switching. For example, on a network where multi-layer services are provided, after a server fails, users may require a period of time to rectify the server fault so that clients do not detect the fault. That is, protection switching is not performed immediately.

You can run the holdoff-timer command to set the Holdoff timer. When a fault occurs, the fault is not immediately reported to ERPS. Instead, the Holdoff timer starts. If the fault persists after the timer expires, the fault will be reported to ERPS.

Precautions

If you run the holdoff-timer command multiple times, only the latest configuration takes effect.
Example

# Set the Holdoff timer to 10 in ERPS ring 10.

<HUAWEI> system-view
[HUAWEI] erps ring 10
[HUAWEI-erps-ring10] holdoff-timer 10

port (ERPS ring view)
Function

The port command adds a port to an ERPS ring and specifies a role for the port.

The undo port command deletes a port from an ERPS ring and cancels the port role.

By default, a port is not added to an ERPS ring, and no port role is specified.
Format

port interface-type interface-number [ rpl { owner | neighbour } ]

undo port interface-type interface-number
Parameters
Parameter 	Description 	Value
interface-type interface-number 	Specifies the port to be added to an ERPS ring.

interface-type specifies the interface type and interface-number specifies the interface number.
	-
rpl { owner | neighbour } 	

Specifies the port to be added to an ERPS ring as the RPL owner port or RPL neighbor port.
	-
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

After an ERPS ring is created, run the port command to add Layer 2 ports to the ERPS ring so that RAPS PDUs can be correctly forwarded. Each device in an ERPS ring is a node, and a maximum of two Layer 2 ports on each node can be added to the same ERPS ring.
ERPS defines three port roles: RPL owner port, RPL neighbor port (only in ERPSv2), and common port.

    RPL owner port

    An RPL owner port is responsible for blocking traffic over the Ring Protection Link (RPL) to prevent loops. An ERPS ring has only one RPL owner port.

    When the node on which the RPL owner port resides receives an RAPS PDU indicating a link or node fault in an ERPS ring, the node unblocks the RPL owner port. Then the RPL owner port can send and receive traffic to ensure nonstop traffic forwarding.

    The link where the RPL owner port resides is the RPL.

    RPL neighbor port

    An RPL neighbor port is directly connected to an RPL owner port.

    Both the RPL owner port and RPL neighbor ports are blocked in normal situations to prevent loops.

    If an ERPS ring fails, both the RPL owner and neighbor ports are unblocked.

    The RPL neighbor port helps reduce the number of FDB entry updates on the device where the RPL neighbor port resides.

    Common port

    Common ports are ring ports other than the RPL owner and neighbor ports.

    A common port monitors the status of the directly connected ERPS link and sends RAPS PDUs to notify the other ports of its link status changes.

Prerequisites

    The control VLAN and ERP instance have been configured using the control-vlan and protected-instance commands respectively in the ERPS ring view.

    The port is not a Layer 3 port. If the port is a Layer 3 port, run the portswitch command to switch the port to the Layer 2 mode.
    Spanning Tree Protocol (STP), Rapid Ring Protection Protocol (RRPP), Smart Ethernet Protection (SEP), or Smart Link is not enabled on the port.
        If the port has STP enabled, run the stp disable command in the interface view to disable STP.
        If the port has RRPP enabled, run the undo ring ring-id command in the RRPP domain view to disable RRPP.
        If the port has SEP enabled, run the undo sep segment segment-id command in the interface view to disable SEP.
        If the port has Smart Link enabled, run the undo port command in the Smart Link group view to disable Smart Link.
    ERPSv2 has been specified in the ERPS ring using the version v2 command if the port is specified as an RPL neighbor port.

Precautions

Before deleting a port from an ERPS ring or changing the port role, use the shutdown (interface view) command to disable the port. Then remove the port or change the port role and run the undo shutdown (interface view) command to enable the port. Otherwise, traffic forwarding may fail.

If ports added to an ERPS ring are all ordinary ports, any port on the device with the largest MAC address will be blocked.
Example
# Add GE0/0/1 to ERPS ring 10, and set the port to the RPL owner port.

<HUAWEI> system-view
[HUAWEI] erps ring 10
[HUAWEI-erps-ring10] port gigabitethernet 0/0/1 rpl owner

protected-instance (ERPS ring view)
Function

The protected-instance command configures Ethernet ring protection (ERP) instances in an ERPS ring.

The undo protected-instance command deletes ERP instances from an ERPS ring.

By default, no ERP instance is configured in an ERPS ring.
Format

protected-instance { all | { instance-id1 [ to instance-id2 ] &<1-10> } }

undo protected-instance { all | { instance-id1 [ to instance-id2 ] &<1-10> } }
Parameters
Parameter 	Description 	Value
instance-id1 to instance-id2 	Specifies the ID of an ERP instance.

    instance-id1 specifies the first ERP instance ID.
    to vlan-id2 specifies the last ERP instance ID. The value of instance-id2 must be greater than the value of instance-id1. instance-id1 and instance-id2 identify a range of ERP instances. If to instance-id2 is not specified, only instance-id1 is specified.

	The value is an integer that ranges from 0 to 4094.
all 	Indicates all ERP instances. 	-
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

On a device running ERPS, the VLAN where ERPS PDUs and data packets are transmitted must be mapped to an ERP instance. Otherwise, VLAN packets may cause broadcast storms on the ring network. As a result, the network may become unavailable.

Precautions

    If the stp mode (system view) command is used to set the STP working mode to VLAN-based Spanning Tree (VBST), the ERP instance specified by the protected-instance command must be the created static instance.

    If you run the protected-instance command multiple times in the same ERPS ring, multiple ERP instances are configured.

    If ports have been added to the ERPS ring, the ERP instance cannot be modified. To delete the configured ERP instance, run the undo erps ring command in the interface view or the undo port command in the ERPS ring view to delete ports from the ERPS ring, and run the undo protected-instance command to delete the ERP instance.

Follow-up Procedure
Configure the mapping between protected instances and VLANs. The specific procedures are as follows:

    Run the stp region-configuration command to enter the MST region view.

    Run the instance instance-id vlan { vlan-id [ to vlan-id ] } &<1-10> command to configure the mapping relationship between the protected instance and the VLAN.

    The parameter instance-id in this command must the same as the parameter instance-id in the protected-instance command.
    Run the active region-configuration command to activate the protected instance and the mapping relationship between the protected instance and the VLAN.

Example

# Configure ERP instance 5 in ERPS ring 1.

<HUAWEI> system-view
[HUAWEI] erps ring 1
[HUAWEI-erps-ring1] protected-instance 5

raps-mel
Function

The raps-mel command sets the value of the MEL field in Ring Auto Protection Switching (RAPS) Protocol Data Units (PDUs).

The undo raps-mel command restores the default value of the MEL field.

By default, the value of the MEL field in RAPS PDUs is 7.
Format

raps-mel level-id

undo raps-mel
Parameters
Parameter 	Description 	Value
level-id 	Specifies the value of the MEL field in RAPS PDUs. 	The value is an integer that ranges from 0 to 7.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

On a Layer 2 network running ERPS, if another fault detection protocol is enabled, the MEL field in RAPS PDUs is used to determine whether the RAPS PDUs can be forwarded. If the MEL value in an ERPS ring is smaller than the MEL value of the fault detection protocol, the RAPS PDUs have a lower priority and are discarded. If the MEL value in an ERPS ring is larger than the MEL value of the fault detection protocol, the RAPS PDUs can be forwarded. You can run the raps-mel command to set the value of the MEL field in RAPS PDUs.

In addition, the MEL value can also be used for interworking with other vendors' devices in an ERPS ring. The same MEL value ensures smooth communication between devices.

Precautions

If you run the raps-mel command multiple times, only the latest configuration takes effect.
Example

# Set the value of the MEL field to 5 in ERPS ring 1.

<HUAWEI> system-view
[HUAWEI] erps ring 1
[HUAWEI-erps-ring1] raps-mel 5

reset erps statistics
Function

The reset erps statistics command clears packet statistics in an ERPS ring.
Format

reset erps [ ring ring-id ] statistics
Parameters
Parameter 	Description 	Value
ring ring-id 	Clears packet statistics in a specified ERPS ring. 	The value is an integer that ranges from 1 to 255.
Views

All views
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Before collecting traffic statistics on a specific interface in a given period of time, clear the existing statistics on the interface by using the reset erps command.

Prerequisites

The ERPS ring has been created, and ports have been added to the specified ERPS ring.

Precautions

The cleared statistics cannot be restored. Exercise caution when you run this command.
Example

# Clear packet statistics in ERPS ring 2.

<HUAWEI> reset erps ring 2 statistics

revertive
Function

The revertive command configures revertive switching or non-revertive switching in an ERPS ring. The switching mode determines whether the RPL owner port is blocked again after a link fault is rectified.

The undo revertive disable command restores the default configuration.

By default, ERPS rings use revertive switching.
Format

revertive { enable | disable }

undo revertive disable
Parameters
Parameter 	Description 	Value
enable 	

Enables revertive switching in an ERPS ring.
	

-
disable 	

Disables revertive switching. That is, non-revertive switching is used in an ERPS ring.
	

-
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

After link faults in an ERPS ring are rectified, re-blocking the RPL owner port depends on the switching mode:

    In revertive switching, the RPL owner port is re-blocked after the WTR timer expires, and the RPL is blocked.
    In non-revertive switching, the WTR timer is not started, and the original faulty link is still blocked.

Prerequisites

The version v2 command has been executed to specify ERPSv2.
Example

# Configure non-revertive switching in ERPS ring 5.

<HUAWEI> system-view
[HUAWEI] erps ring 5
[HUAWEI-erps-ring5] revertive disable

sub-ring
Function

The sub-ring command configures an ERPS ring as a sub-ring.

The undo sub-ring command restores the default configuration.

By default, all ERPS rings are major rings.
Format

sub-ring

undo sub-ring
Parameters

None
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

ERPS has two versions: ERPSv1 and ERPSv2. ERPSv2 supports multi-ring topologies such as intersecting ring topologies in addition to single-ring topologies.

To deploy ERPS on a multi-ring network, run the sub-ring command to configure some rings as sub-rings.

Major rings are closed, and sub-rings are open.

Prerequisites

    The version v2 command has been executed to specify ERPSv2.
    The ERPS ring does not have any port. If the ERPS ring has a port, run the undo erps ring ring-id or undo port interface-type interface-number command to delete the port from the ERPS ring.

Precautions

If a sub-ring uses the VC mode to transmit RAPS PDUs, you must run the virtual-channel disable command to restore the RAPS PDU transmission mode to NVC before running the undo sub-ring command to restore the sub-ring to a major ring.
Example

# Configure ERPS ring 5 as a sub-ring.

<HUAWEI> system-view
[HUAWEI] erps ring 5
[HUAWEI-erps-ring5] sub-ring

tc-notify erps ring
Function

The tc-notify erps ring command configures an ERPS ring to notify other ERPS rings of its topology change.

The undo tc-notify erps ring command disables the topology change notification function.

By default, an ERPS ring does not notify other ERPS rings of its topology change.
Format

tc-notify erps ring { ring-id1 [ to ring-id2 ] } &<1-10>

undo tc-notify erps ring { ring-id1 [ to ring-id2 ] } &<1-10>
Parameters
Parameter 	Description 	Value
ring-id1 	

Specifies the start ring ID of the ERPS ring that will be notified of the topology change.
	The value is an integer that ranges from 1 to 255.
to ring-id2 	

Specifies the end ring ID of the ERPS ring that will be notified of the topology change.

ring-id1 and ring-id2 specify a ring range. If to ring-id2 is not specified, an ERPS ring notifies only the ERPS ring specified by ring-id1 of its topology change.
NOTE:

You can specify the ring range for a maximum of 10 times, and the ring ranges can overlap.
	The value is an integer that ranges from 1 to 255 and must be greater than or equal to ring-id1.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

When the topology of the local ERPS ring changes and other ERPS rings is not notified of the topology change, the MAC address entries remain unchanged on the other ERPS rings and therefore user traffic is interrupted. To ensure nonstop traffic transmission, run the tc-notify erps ring command to specify ERPS rings to which topology change notifications are sent.

Prerequisites

The version v2 command has been executed to specify ERPSv2.

Precautions

    The tc-notify erps ring command takes effect only on ERPS sub-rings.

    If an ERPS ring topology changes, the ERPS ring notifies the specified ERPS rings of its topology change. If the ERPS ring that has been specified to receive the topology change notification does not exist, the configuration does not take effect.

    After other ERPS rings receive the topology change notification from an ERPS ring, they send Flush-FDB messages on their separate rings to instruct their nodes to update MAC addresses. This ensures nonstop traffic transmission.

    If the tc-notify erps ring command is run more than once, all configurations take effect.

Example

# Configure ERPS ring 5 to notify ERPS rings 1 through 3 of its topology change.

<HUAWEI> system-view
[HUAWEI] erps ring 5
[HUAWEI-erps-ring5] tc-notify erps ring 1 to 3

tc-notify sep
Function

The tc-notify sep command configures the device to notify a SEP segment of topology changes in the ERPS ring so that the SEP segment can update the FDB in a timely manner.

The undo tc-notify sep command disables the topology change notification function.

By default, the device does not notify a SEP segment of topology changes in the ERPS ring.
Format

tc-notify sep { segment segment-id | all-segment }

undo tc-notify sep { segment segment-id | all-segment }
Parameters
Parameter 	Description 	Value

segment segment-id
	

Specifies the ID of a SEP segment.
	

The value is an integer in the range from 1 to 1024.

all-segment
	

Indicates all SEP segments.
	

-
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

When the topology of the ERPS ring changes and SEP segments are not notified of the topology change, the MAC address entries remain unchanged on the SEP segments and therefore user traffic is interrupted. To ensure nonstop traffic transmission, you can run the tc-notify sep command to specify the objects to which ERPS ring topology change notifications are sent.
Example

# Configure the device to notify a SEP segment of topology changes in the ERPS ring.

<HUAWEI> system-view
[HUAWEI] sep segment 2
[HUAWEI-sep-segment2] quit
[HUAWEI] erps ring 5
[HUAWEI-erps-ring5] tc-notify sep segment 2

tc-protection interval (ERPS ring view)
Function

The tc-protection interval command sets the topology change protection interval at which topology change notification messages are sent.

The undo tc-protection interval command restores the default topology change protection interval.

By default, the topology change protection interval is 2s.
Format

tc-protection interval interval-value

undo tc-protection interval
Parameters
Parameter 	Description 	Value
interval-value 	

Specifies the topology change protection interval.

A longer interval ensures stable ERPS operation, but may cause slow convergence.
	The value is an integer that ranges from 1 to 600, in seconds.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

If a user terminal connects to an upper-layer network through multiple ERPS rings and the topology of the ERPS ring closest to the user terminal changes, topology change notifications will be multiplied by 2 each time they pass through a ring until they reach the upper-layer network. As a result, the upper-layer network receives many identical topology change notifications.

In addition, if an ERPS ring frequently receives topology change notifications, its nodes will have lower CPU processing capability and repeatedly update Flush-FDB packets, consuming much bandwidth. To prevent this problem, run the tc-protection interval command to set the topology change protection interval at which the maximum number of topology change notifications specified in the tc-protection threshold command are processed. Then, during the topology change protection interval, the device processes only the specified maximum number of topology change notification messages. If there are excess notifications, the device processes all the excess notifications once after the topology change protection interval elapses. For example, if the topology change protection interval is set to 10 seconds and the maximum number is set to 5, when a device receives topology change notifications, the device processes only the first 5 topology change notifications within 10 seconds and processes the subsequent topology change notifications only after 10s. This prevents the device from frequently deleting MAC address entries and ARP entries.

Prerequisites

The erps ring command has been executed to create an ERPS ring.

Precautions

Suppressing topology change notification transmission allows the upper-layer network to receive and process only one notification during the topology change protection interval and protects ERPS nodes against topology change (TC) attacks.
Example

# Set the topology change protection interval to 3s in ERPS ring 1.

<HUAWEI> system-view
[HUAWEI] erps ring 1
[HUAWEI-erps-ring1] tc-protection interval 3

tc-protection threshold (ERPS ring view)
Function

The tc-protection threshold command sets the number of times ERPS parses topology change notifications and updates forwarding entries in the topology change protection interval.

The undo tc-protection threshold command restores the default number of times ERPS parses topology change notifications and updates forwarding entries in the topology change protection interval.

By default, ERPS parses topology change notifications and updates forwarding entries three times in the topology change protection interval.
Format

tc-protection threshold threshold-value

undo tc-protection threshold
Parameters
Parameter 	Description 	Value
threshold-value 	

Specifies the number of times ERPS parses topology change notifications and updates forwarding entries in the topology change protection interval.
	

The value is an integer that ranges from 1 to 255.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

After a switching device in an ERPS ring network receives topology change notifications, the device updates MAC address entries and ARP entries. Frequent updates will cause a high CPU usage.

To prevent frequent MAC address and ARP entry updates, run the tc-protection threshold command to set the maximum number of topology change notifications that can be processed during the topology change protection interval specified by the tc-protection interval command. Then, during the topology change protection interval, the device processes only the specified maximum number of topology change notification messages. If there are excess notifications, the device processes all the excess notifications once after the topology change protection interval elapses. For example, if the topology change protection interval is set to 10 seconds and the maximum number is set to 5, when a device receives topology change notifications, the device processes only the first 5 topology change notifications within 10 seconds and processes the subsequent topology change notifications only after 10s. This prevents the device from frequently deleting MAC address entries and ARP entries.

Prerequisites

The version v2 command has been run to specify ERPSv2.
Example
# Set the number of times ERPS parses topology change notifications and updates forwarding entries in the topology change protection interval to 5.

<HUAWEI> system-view
[HUAWEI] erps ring 5
[HUAWEI-erps-ring5] tc-protection threshold 5

version (ERPS ring view)
Function

The version command configures an ERPS version.

The undo version command restores the default ERPS version.

By default, ERPSv1 is used.
Format

version { v1 | v2 }

undo version
Parameters
Parameter 	Description 	Value
v1 	Specifies ERPSv1. 	-
v2 	Specifies ERPSv2. 	-
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario
ERPS has two versions: ERPSv1 released by the ITU-T in June and ERPSv2 released in August, 2010. ERPSv2 that is compatible with ERPSv1 provides the following enhanced functions:

    Multi-ring topologies, such as intersecting rings

    RAPS PDU transmission on virtual channels (VCs) and non-virtual-channels (NVCs) in sub-rings

    Forced Switch (FS) and Manual Switch (MS)

    Revertive and non-revertive switching

To configure an ERPS version, run the version command.

Precautions

Before specifying ERPSv1 for an ERPSv2-enabled device, delete all ERPS configurations that ERPSv1 does not support. Otherwise, the version cannot be changed.
Example

# Specify ERPSv2 for ERPS ring 5.

<HUAWEI> system-view
[HUAWEI] erps ring 5
[HUAWEI-erps-ring5] version v2

virtual-channel
Function

The virtual-channel enable command configures the virtual channel (VC) mode for RAPS PDU transmission in a sub-ring.

The virtual-channel disable command configures the non-virtual-channel (NVC) mode for RAPS PDU transmission in a sub-ring.

The undo virtual-channel enable command configures the non-virtual-channel (NVC) mode for RAPS PDU transmission in a sub-ring.

By default, RAPS PDUs are transmitted in NVC mode in a sub-ring.
Format

virtual-channel { enable | disable }

undo virtual-channel enable
Parameters
Parameter 	Description 	Value
enable 	

Enables the VC mode for RAPS PDU transmission in a sub-ring.
	

-
disable 	

Disables the VC mode for RAPS PDU transmission in a sub-ring. That is, the NVC mode is used.
	

-
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

ERPSv2 supports both single- and multi-ring topologies.

In multi-ring topologies, the VC or NVC mode can be used to transmit RAPS PDUs in a sub-ring:

    VC mode: RAPS PDUs in a sub-ring are transmitted to the major ring by the intersecting node. The RPL owner port of the sub-ring blocks both RAPS PDUs and data traffic.
    NVC mode: RAPS PDUs in a sub-ring are terminated on the intersecting nodes. The RPL owner port of the sub-ring blocks data traffic but not RAPS PDUs.

You can run the virtual-channel command to configure the RAPS PDU transmission mode in a sub-ring.

Prerequisites

    The version v2 command has been executed to specify ERPSv2.
    The sub-ring command has been executed to configure an ERPS ring as a sub-ring.

Configuration Impact

If a sub-ring uses the VC mode to transmit RAPS PDUs, you must run the virtual-channel disable or undo virtual-channel enable command to restore the RAPS PDU transmission mode to NVC before running the undo sub-ring command to restore the sub-ring to a major ring.
Example

# Configure the VC mode for RAPS PDU transmission in ERPS sub-ring 5.

<HUAWEI> system-view
[HUAWEI] erps ring 5
[HUAWEI-erps-ring5] version v2
[HUAWEI-erps-ring5] sub-ring
[HUAWEI-erps-ring5] virtual-channel enable

wtr-timer (ERPS ring view)
Function

The wtr-timer command sets the WTR timer in an ERPS ring.

The undo wtr-timer command restores the default value of the WTR timer.

By default, the WTR timer is 5 minutes in an ERPS ring.
Format

wtr-timer time-value

undo wtr-timer
Parameters
Parameter 	Description 	Value
time-value 	Specifies the value of the WTR timer in an ERPS ring. 	The value is an integer that ranges from 1 to 12, in minutes.
Views

ERPS ring view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario
The wtr-timer command is applied to RPL owner ports. If an RPL owner port is unblocked due to a link or node fault, the involved port may not go Up immediately after the link or node recovers. To prevent the RPL owner port from alternating between the Up and Down states, the node where the RPL owner port resides starts the WTR timer after receiving an RAPS PDU indicating the link or node recovery:

    If the node receives an RAPS PDU indicating that another port fails before the timer expires, the node disables the WTR timer and enables the RPL owner port.
    If the node does not receive any RAPS PDUs indicating that another port fails before the timer expires, the node blocks the RPL owner port when the WTR timer expires and sends an RAPS PDU indicating that the RPL owner port is blocked. After receiving the RAPS PDU, other nodes set their recovering ports to the Forwarding state in the ring.

Precautions

If you run the wtr-timer command multiple times, only the latest configuration takes effect.
Example

# Set the WTR timer to 10 minutes in ERPS ring 10.

<HUAWEI> system-view
[HUAWEI] erps ring 10
[HUAWEI-erps-ring10] wtr-timer 10

