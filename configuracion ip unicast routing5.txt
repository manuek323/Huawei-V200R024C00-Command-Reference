On an IS-IS network, if the local routing
information changes, a switch needs to generate a
new LSP to notify this change. If the local routing
information changes frequently, a large number of
new LSPs are generated. This occupies a lot of
system resources and decreases system
performance. To speed up network convergence
and prevent system performance from being
affected, configure an intelligent timer for
generating LSPs. This timer can adjust the delay in
generating LSPs based on the routing information
change frequency.
Enable LSP
fast flooding
Control
the
number of
LSPs
flooded
each time
on an
interface
to speed
up IS-IS
network
convergen
ce.
When an IS-IS switch receives new LSPs from other
switches, it updates the LSPs in the local LSDB and
periodically floods out the updated LSPs according
to a timer. LSP fast flooding updates the preceding
method. When a device configured with LSP fast
flooding receives one or more new LSPs, it floods
out the LSPs with a number smaller than the
specified number before calculating routes. This
speeds up LSDB synchronization.
Set an
interval at
which LSPs
are
retransmitted
over a P2P
link
Control
the
interval
for
retransmit
ting LSPs
to ensure
LSDB
synchroniz
ation on a
P2P
network.
On a point-to-point network, devices at both ends
of a link synchronize LSDBs with each other by
flooding LSPs. The device at one end of the link
sends an LSP. If the device at the other end receives
this LSP, it replies with a PSNP. If the device that
has sent an LSP does not receive a PSNP from the
other end in a period of time, the device will
retransmit the LSP.
Procedure
● Set the maximum length for LSPs.
a. Run system-view
The system view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 555
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Set the maximum length for LSPs.
▪ Run lsp-length originate
max-size
The maximum length is set for each generated LSP.
▪ Run lsp-length receive
max-size
The maximum length is set for each received LSP.
By default, the IS-IS system generates and receives 1497-byte LSPs.
NOTE
Ensure that the value of
max-size for LSPs to be generated is less than or equal
to the value of
max-size for LSPs to be received.
The value of
max-size set through the lsp-length command must meet the
following requirements; otherwise, the MTU status on the interface is considered
Down.
● The MTU of an Ethernet interface must be greater than or equal to the sum
of the value of
max-size and 3.
● The MTU of a P2P interface must be greater than or equal to the value of
max-size.
● Set the maximum lifetime for LSPs.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run timer lsp-max-age
age-time
The maximum lifetime is set for LSPs.
By default, the maximum lifetime of LSPs is 1200 seconds.
● Set the refresh interval for LSPs.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run timer lsp-refresh
refresh-time
A refresh interval is set for LSPs.
By default, the LSP refresh interval is 900s.
NOTE
Ensure that the LSP refresh interval is at least 300s less than the maximum LSP
lifetime. This allows new LSPs to reach all devices in an area before existing LSPs
expire.
The larger a network, the greater the deviation between the LSP refresh interval
and the maximum LSP lifetime.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 556
● Set the minimum interval at which LSPs are sent.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run isis timer lsp-throttle
throttle-interval [ count
count ]
The minimum interval for sending LSPs on an IS-IS interface and the
maximum number of LSPs sent within the interval are set.
By default, the minimum interval for sending LSPs is 50 ms, and the
maximum number of LSPs sent each time is 10.
● Configure the intelligent timer used to generate LSPs.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run timer lsp-generation
max-interval [
init-interval [
incr-interval ] ]
[ level-1 | level-2 ]
The intelligent timer used to generate LSPs is set.
If no level is configured, both Level-1 and Level-2 are configured.
The initial delay for generating the same LSPs (or LSP fragments) is
init-
interval. The delay for generating the same LSPs (or LSP fragments) in
the next iteration is
incr-interval. When the routes change each time, the
delay for generating the same LSPs (or LSP fragments) is twice as the
previous value until the delay is up to
max-interval. After the delay
reaches
max-interval for three times or the IS-IS process is reset, the
interval is reduced to
init-interval.
When
incr-interval is not used and the same LSPs (or LSP fragments) are
generated for the first time,
init-interval is used as the initial delay. Then,
the delay for generating the same LSPs (or LSP fragments) is
max-
interval. After the delay reaches
max-interval for three times or the IS-IS
process is reset, the interval is reduced to
init-interval.
When only
max-interval is used, the intelligent timer changes into a
normal one-short timer.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 557
● Enable LSP fast flooding.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run flash-flood [
lsp-count | max-timer-interval
interval | [ level-1 |
level-2 ] ]*
The LSP fast flooding is enabled.
The
lsp-count parameter specifies the number of LSPs flooded each time,
which is applicable to all interfaces. If the number of LSPs to be sent is
greater than the value of
lsp-count,
lsp-count takes effect. If the number
of LSPs to be sent is less than the value of
lsp-count, all the LSPs are
sent. If a timer is configured and the configured timer does not expire
before the route calculation, the LSPs are flooded immediately when
being received; otherwise, the LSPs are sent when the timer expires.
When LSP fast flooding is enabled, Level-1 LSPs and Level-2 LSPs are fast
flooded by default if no level is specified.
● Set an interval at which LSPs are retransmitted over a P2P link.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. (Optional) Run isis circuit-type p2p [ strict-snpa-check ]
A broadcast interface is simulated as a P2P interface.
NOTE
If the interface type is P2P, this step is not required.
e. Run isis timer lsp-retransmit
retransmit-interval
The interval at which LSPs are retransmitted over a P2P link is set.
By default, the interval for retransmitting LSPs over a P2P link is 5
seconds.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 558
7.11.3 Configuring Attributes for CSNPs
Context
Complete sequence number PDUs (CSNPs) contain summaries of all the LSPs in
an LSDB to ensure LSDB synchronization between neighbors. CSNPs are processed
differently on broadcast and P2P links.
● On a broadcast link, CSNPs are periodically sent by a DIS device. If a device
detects that its LSDB is not synchronized with that on its neighboring device,
the device will send PSNPs to apply for missing LSPs.
● On a P2P link, CSNPs are sent only during initial establishment of neighboring
relationships.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run isis timer csnp
csnp-interval [ level-1 | level-2 ]
The interval at which CSNPs are sent is set on the specified interface.
By default, the interval at which CSNPs are sent on a broadcast network is 10
seconds.
NOTE
Configure Level-1 and Level-2 only when a broadcast interface is specified.
----End
7.11.4 Setting the SPF Calculation Interval
Context
A network change always triggers IS-IS to perform SPF calculation. Frequent SPF
calculation will consume excessive CPU resources, affecting services.
To solve this problem, configure an intelligent timer to control the interval for SPF
calculation. For example, to speed up IS-IS route convergence, set the interval for
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 559
SPF calculation to a small value and set the interval to a large value after the IS-IS
network becomes stable.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run timer spf
max-interval [
init-interval [
incr-interval ] ]
The SPF intelligent timer is configured.
By default, no SPF intelligent timer is configured and the maximum delay in SPF
calculation is 5 seconds.
The intelligent timer changes as follows:
● The delay in the first SPF calculation is determined by
init-interval; the delay
in the second SPF calculation is determined by
incr-interval. From the third
time on, the delay in SPF calculation increases twice every time until the delay
reaches the value specified by
max-interval. After the delay remains at the
value specified by
max-interval for three times or the IS-IS process is
restarted, the delay decreases to the value specified by
init-interval.
● If
incr-interval is not specified, the delay in SPF calculation for the first time is
determined by
init-interval. From the second time on, the delay in SPF
calculation is determined by
max-interval. After the delay remains at the
value specified by
max-interval for three times or the IS-IS process is
restarted, the delay decreases to the value specified by
init-interval.
● When only
max-interval is specified, the intelligent timer functions as an
ordinary one-time triggering timer.
Step 4 (Optional) Run spf-slice-size
duration-time
The maximum duration for SPF calculation is configured.
By default, IS-IS route calculation lasts for a maximum of 2 ms at a time.
----End
7.11.5 Configuring Convergence Priorities for IS-IS Routes
Context
Devices allow you to configure the highest convergence priority for specific IS-IS
routes so that these IS-IS routes will be converged first when a network topology
changes.
The rules of applying convergence priorities for IS-IS routes are as follows:
● Existing IS-IS routes are converged based on the priorities configured in the
prefix-priority command.
● New IS-IS routes are converged based on the priorities configured in the
prefix-priority command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 560
● If an IS-IS route conforms to the matching rules of multiple convergence
priorities, the highest convergence priority is used.
● The convergence priority of a Level-1 IS-IS route is higher than that of a
Level-2 IS-IS route.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run prefix-priority [ level-1 | level-2 ] { critical | high | medium } { ip-prefix
prefix-name | tag
tag-value }
Convergence priorities are set for IS-IS routes.
By default, the convergence priority of 32-bit host routes is medium, and the
convergence priority of the other IS-IS routes is low.
NOTE
The prefix-priority command is only applicable to the public network.
After the prefix-priority command is run, the convergence priority of 32-bit host routes is
low, and the convergence priorities of the other routes are determined as specified in the
prefix-priority command.
----End
7.11.6 Verifying the IS-IS Route Convergence Control
Configuration
Procedure
● Run the display isis interface [ verbose ] [
process-id | vpn-instance
vpn-
instance-name ] command to check IS-IS packet information.
● Run the display isis route [
process-id | vpn-instance
vpn-instance-name ]
[ ipv4 ] [ verbose | [ level-1 | level-2 ] |
ip-address [
mask |
mask-length ] ] *
[ | count ] command to check IS-IS route information.
----End
7.12 Configuring LSP Fragment Extension
Pre-configuration Tasks
Before configuring LSP fragment extension, create IS-IS processes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 561
NOTE
When a new device connects to an IS-IS network, you are advised to configure LSP
fragment extension and virtual systems before establishing IS-IS neighbors or importing
routes. If you establish IS-IS neighbors or import routes without configuring LSP fragment
extension and virtual systems, IS-IS needs to carry much information, which cannot be
loaded through 256 fragments. You must then configure LSP fragment extension and virtual
systems, which will take effect only after you restart the IS-IS process.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run lsp-fragments-extend [ [ level-1 | level-2 | level-1-2 ] | [ mode-1 |
mode-2 ] ] *
LSP fragment extension is enabled in an IS-IS process.
By default, LSP fragment extension is disabled in an IS-IS process.
If the mode or level is not specified during the configuration of LSP fragment
extension, mode-1 and level-1-2 are used by default.
NOTE
If there are devices of other manufacturers on the network, LSP fragment extension must
be set to mode-1. Otherwise, devices of other manufacturers cannot identify LSPs.
Step 4 Run virtual-system
virtual-system-id
A virtual system is configured.
By default, no virtual system is configured.
To configure a switch to generate extended LSP fragments, you must configure at
least one virtual system. The ID of the virtual system must be unique in the
domain.
An IS-IS process can be configured with up to 50 virtual system IDs.
----End
Verifying the Configuration
Run the following commands to check IS-IS process statistics.
● display isis statistics [ updated-lsp [ history ] ] [ level-1 | level-2 |
level-1-2 ] [
process-id | vpn-instance
vpn-instance-name ]
● display isis
process-id statistics [ [ [ updated-lsp [ history ] ] [ level-1 |
level-2 | level-1-2 ] ] | [ packet ] ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 562
7.13 Configuring a Mesh Group on an NBMA Network
Pre-configuration Tasks
Before configuring a mesh group, configure basic IS-IS functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run isis mesh-group {
mesh-group-number | mesh-blocked }
The interface is added to a mesh group.
When mesh-blocked is configured on an interface, the interface is blocked and
cannot flood LSPs outside. All the interfaces added to a mesh group implement
global LSDB synchronization through CSNP and PSNP mechanisms.
----End
Verifying the Configuration
Run the following commands to check IS-IS process statistics.
● display isis statistics [ updated-lsp [ history ] ] [ level-1 | level-2 |
level-1-2 ] [
process-id | vpn-instance
vpn-instance-name ]
● display isis
process-id statistics [ [ [ updated-lsp [ history ] ] [ level-1 |
level-2 | level-1-2 ] ] | [ packet ] ]
7.14 Configuring IS-IS Reliability
Pre-configuration Tasks
Before configuring IS-IS reliability, configure basic IS-IS functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 563
Configuration Flowchart
You can perform the following configuration tasks (excluding the task of Verifying
the IS-IS Reliability Configuration) in any sequence.
7.14.1 Configuring Static BFD for IS-IS
Context
On an IS-IS network, a device periodically sends Hello packets to detect the
neighbor status change. By default, the device considers a neighbor Down when it
does not receive a Hello packet from the neighbor after sending three Hello
packets (30 seconds). This IS-IS fault detection mechanism, however, cannot
provide high reliability for the network that requires fast network convergence and
no packet loss. BFD for IS-IS can solve this problem. BFD is a millisecond-level
fault detection mechanism. It can fast detect faults on the link between IS-IS
neighbors. Therefore, BFD can speed up IS-IS route convergence, ensures fast link
switchover, and reduces traffic loss.
Compared to dynamic BFD, static BFD has the following characteristics:
● Static BFD can be manually controlled and is easy to deploy. To save memory
and ensure reliability of key links, BFD can be deployed on specified links.
● Establishing and deleting BFD sessions need to be manually triggered and
lack flexibility. Configuration errors may occur. For example, if an incorrect
local or remote discriminator is configured, a BFD session cannot work
properly.
NOTE
A BFD session currently does not detect route switching. If the change of bound peer IP
address causes a route to switch to another link, the BFD session is negotiated again only
when the original link fails.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support BFD for IS-IS.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run bfd
BFD is enabled globally.
Step 3 Run quit
The system view is displayed.
Step 4 Run bfd
cfg-name bind peer-ip
ip-address [ interface
interface-type interface-
number ]
BFD is enabled between the specified interface and peer router.
If a peer IP address and a local interface are specified in the bfd command, BFD
monitors only a single-hop link with the interface specified in the bfd command
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 564
as the outbound interface and with the peer IP address specified in the peer-ip
command as the next-hop address.
Step 5 Set discriminators.
● Run discriminator local
discr-value
A local discriminator is set.
● Run discriminator remote
discr-value
A remote discriminator is set.
The local discriminator of a device must be the remote discriminator of the device
on the other end; otherwise, a BFD session cannot be established. In addition, the
local and remote discriminators cannot be modified after being configured.
NOTE
The local discriminator of the local device must be the same as the remote discriminator of
the remote device, and the remote discriminator of the local device must be the same as
the local discriminator of the remote device.
Step 6 Run commit
Configurations are committed.
Step 7 Run quit
The system view is displayed.
Step 8 Run interface
interface-type interface-number
The view of the specified interface is displayed.
Step 9 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 10 Run isis bfd static
Static IPv4 BFD is enabled on the specified interface.
----End
Verifying the Configuration
You can check information about a BFD session only after parameters of the BFD
session are configured and the BFD session is established.
● Run the display isis [
process-id | vpn-instance
vpn-instance-name ] bfd
session { peer
ip-address | all } command to check information about the
BFD session.
● Run the display isis interface verbose command. The command output
shows that the status of static BFD for IS-IS process is Yes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 565
7.14.2 Configuring Dynamic BFD for IS-IS
Context
On an IS-IS network, a device periodically sends Hello packets to detect the
neighbor status change. By default, the device considers a neighbor Down when it
does not receive a Hello packet from the neighbor after sending three Hello
packets (30 seconds). This IS-IS fault detection mechanism, however, cannot
provide high reliability for the network that requires fast network convergence and
no packet loss. BFD for IS-IS can solve this problem. BFD is a millisecond-level
fault detection mechanism. It can fast detect faults on the link between IS-IS
neighbors. Therefore, BFD can speed up IS-IS route convergence, ensure fast link
switchover, and reduce traffic loss.
Dynamic BFD for IS-IS implements dynamic setup of BFD sessions. When a new
IS-IS neighbor relationship is set up, BFD is notified of the neighbor parameters
and the detection parameters (including source and destination IP addresses).
Then a BFD session will be established based on the received neighbor
parameters.
Dynamic BFD is more flexible than static BFD. In dynamic BFD, routing protocols
trigger the setup of BFD sessions, preventing the configuration errors caused by
manual configuration. Dynamic BFD is easy to configure and applies to the
scenarios where BFD needs to be configured on the entire network. Dynamic BFD
for IS-IS can fast detect neighbor status changes and implement fast network
convergence.
NOTE
A BFD session currently does not detect route switching. If the change of bound peer IP
address causes a route to switch to another link, the BFD session is negotiated again only
when the original link fails.
The priority of BFD configured on an interface is higher than that of BFD configured for a
process. If BFD session parameters are configured for both a process and an interface, the
parameters on the interface will be used to establish a dynamic BFD session.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support BFD for IS-IS.
Procedure
● Configure dynamic BFD for IS-IS in a specified IS-IS process.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is enabled globally.
c. Run quit
The system view is displayed.
d. Run isis
process-id
The IS-IS view is displayed.
e. Run bfd all-interfaces enable
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 566
BFD for IS-IS is enabled to establish a BFD session.
This command enables an IS-IS process to use default BFD parameters to
create BFD sessions on all the interfaces in the IS-IS process.
f. (Optional) Run bfd all-interfaces { min-rx-interval
receive-interval |
min-tx-interval
transmit-interval | detect-multiplier
multiplier-value } *
The parameters for establishing BFD sessions are set for all interfaces.
The command execution result is applicable to BFD session parameters
on all IS-IS interfaces.
g. (Optional) Run the isis bfd block command in the interface view:
The interface is prohibited from dynamically establishing a BFD session.
By default, an interface can dynamically establish BFD sessions.
● Configure dynamic BFD for IS-IS on a specified interface.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is enabled globally.
c. Run quit
The system view is displayed.
d. Run interface
interface-type interface-number
The interface view is displayed.
e. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
f. Run isis bfd enable
BFD is enabled on the interface to establish a BFD session.
After BFD is configured globally and the neighbor status is Up (on a
broadcast network, DIS is in the Up state), default BFD parameters will
be used to establish BFD sessions on the specified interface.
g. (Optional) Run isis bfd { min-rx-interval
receive-interval | min-tx-
interval
transmit-interval | detect-multiplier
multiplier-value } *
Run this command when BFD session parameters need to be configured
for a specified interface.
h. (Optional) Run isis bfd block
The interface is prohibited from dynamically establishing a BFD session.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 567
Verifying the Configuration
After BFD is enabled on both ends of a link, run the display isis [
process-id | vpn-
instance
vpn-instance-name ] bfd session { all | peer
ip-address | interface
interface-type interface-number } command. The command output shows that
BFD status is up.
7.14.3 Enabling IS-IS GR
Context
The restart of an IS-IS switch causes the temporary interruption of the network,
because the adjacency relationship between the switch and its neighbor is torn
down. The LSPs of the switch are deleted, which makes route calculation
inaccurate. Packets are thus lost.
You can configure IS-IS GR to solve this problem. After IS-IS GR is enabled, the
switch notifies the neighbor of the restart status, and reestablishes the adjacency
relationship with its neighbor without interrupting the forwarding.
The GR interval is set as the Holdtime in an IS-IS Hello PDU. Therefore, the
adjacency relationship is not torn down when the switch restarts.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run graceful-restart
IS-IS GR is enabled.
By default, IS-IS GR is disabled.
Step 4 Run graceful-restart no-impact-holdtime
The holdtime of an IS-IS neighbor is configured to remain unchanged in IS-IS GR
mode.
Step 5 (Optional) Run graceful-restart interval
interval-value
A value is configured for the T3 timer during the IS-IS GR.
The value of the T3 timer indicates the longest time that a GR lasts. A router
disables the T3 timer after the LSDB synchronization ends in all areas. If LSDBs are
not synchronized yet when the T3 timer expires, the GR fails.
By default, the value of the T3 timer is 300 seconds. Keeping the default value is
recommended.
During a GR, an IS-IS neighbor of the restarter sets the value of the T3 timer to
the holdtime of the neighbor relationship between them, which prevents routes
from being recalculated on the whole network due to a neighbor disconnection
during the GR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 568
Step 6 (Optional) Run graceful-restart suppress-sa
The GR restarter is configured to suppress the Suppress-Advertisement (SA) bit of
the restart TLV.
By default, the SA bit is not suppressed.
----End
Verifying the Configuration
Run display isis graceful-restart status [ level-1 | level-2 ] [
process-id | vpn-
instance
vpn-instance-name ] command to check the status of IS-IS GR.
7.15 Configuring IPv4 IS-IS Auto FRR
IS-IS Auto FRR can fast switch traffic to a backup link, ensuring millisecond-level
traffic interruption. This protects traffic and improves IS-IS network reliability.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support IS-IS Auto FRR.
7.15.1 Enabling IPv4 IS-IS Auto FRR
Context
Perform the following steps on the switch that needs the protection for the
forwarded traffic:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS process is enabled and the IS-IS view is displayed.
Step 3 Run frr
The IS-IS Auto FRR view is displayed.
Step 4 (Optional) Run frr-policy route route-policy
route-policy-name
Backup routes are filtered using a filtering policy. Only backup routes that have
passed the filtering policy are added to the routing table.
Step 5 Run loop-free-alternate [ level-1 | level-2 | level-1-2 ]
IS-IS Auto FRR is enabled and the loop-free backup route is created.
If the IS-IS level is not specified, IS-IS Auto FRR is enabled on Level-1 and Level-2
to create the backup route.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 569
NOTE
IS-IS can create the loop-free backup route only if the interface cost is in compliance with
the traffic protection inequality of IS-IS Auto FRR.
----End
7.15.2 (Optional) Disabling an Interface from Being Involved
in IPv4 LFA Calculation
Context
IS-IS Auto FRR can fast switch traffic to a backup link, ensuring millisecond-level
traffic interruption. This protects traffic and improves IS-IS network reliability.
Perform the following steps on the IS-IS interface to be disabled from participating
in the Loop-Free Alternate (LFA) calculation:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 Run undo isis lfa-backup [ level-1 | level-2 | level-1-2 ]
The interface is disabled from participating in the LFA calculation.
----End
7.15.3 Verifying the IPv4 IS-IS Auto FRR Configuration
Prerequisites
All IS-IS Auto FRR configurations are complete.
Procedure
● Run the display isis route [
process-id | vpn-instance
vpn-instance-name ]
[ ipv4 ] [ verbose | [ level-1 | level-2 ] |
ip-address [
mask |
mask-length ] ] *
command to check information about the primary link and backup link after
IS-IS Auto FRR is enabled.
● Run the display isis spf-tree [ systemid
systemid | dname
dname ]
[ [ level-1 | level-2 ] | ipv6 | verbose ] * [
process-id | vpn-instance
vpn-
instance-name ] command to check the traffic protection type of IS-IS Auto
FRR.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 570
7.16 Configuring the Overload Bit for an IS-IS Device
Pre-configuration Tasks
Before configuring the overload bit for an IS-IS device, configure basic IS-IS
functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run set-overload [ on-startup [
timeout1 | start-from-nbr
system-id [
timeout1
[
timeout2 ] ] | wait-for-bgp [
timeout1 ] ] [ send-sa-bit [
timeout3 ] ] ] [ allow
{ interlevel | external }* ]
The overload bit for non-pseudonode LSPs is configured.
----End
Verifying the Configuration
● Run the display isis lsdb [ [ level-1 | level-2 ] | verbose | [ local |
lsp-id | is-
name
symbolic-name ] ] * [
process-id | vpn-instance
vpn-instance-name ]
command to check information in the IS-IS LSDB.
7.17 Configuring IS-IS Neighbor Relationship Flapping
Suppression
Usage Scenario
If an interface carrying IS-IS services alternates between Up and Down, IS-IS
neighbor relationship flapping occurs on the interface. During the flapping, IS-IS
reestablishes the neighbor relationship and recalculates routes. In this process, a
large number of packets are exchanged, adversely affecting neighbor relationship
stability, IS-IS services, and other IS-IS-dependent services, such as LDP and BGP.
IS-IS neighbor relationship flapping suppression can address this problem by
delaying IS-IS neighbor relationship reestablishment or preventing service traffic
from passing through flapping links.
NOTE
The following steps are optional, choose them as required.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 571
Pre-configuration Tasks
Before configuring IS-IS neighbor relationship flapping suppression, complete the
following tasks:
● Configure an IP address for each interface to ensure that neighboring routers
are reachable at the network layer.
● Configure basic IPv4 IS-IS functions.
Procedure
Step 1 Run system-view
The system view is displayed.
By default, IS-IS neighbor relationship flapping suppression is enabled globally. To
disable this function globally, run the suppress-flapping peer disable command
in the IS-IS view.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
By default, IS-IS neighbor relationship flapping suppression is enabled on all
interfaces in the same IS-IS process. To disable the function from one of the
interfaces, run the isis suppress-flapping peer disable command.
Step 3 Run isis suppress-flapping peer hold-down
interval
The Hold-down mode is configured, and its duration is set.
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes
during neighbor relationship establishment, interfaces prevent neighbor
relationship reestablishment during Hold-down suppression, which minimizes
synchronization attempts and packet exchanges.
● Hold-max-cost mode: If the traffic forwarding path changes frequently,
interfaces use the maximum value (16777214 for the wide mode and 63 for
the narrow mode) as the cost of the flapping link during Hold-max-cost
suppression, which prevents traffic from passing through the flapping link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode.
By default, the Hold-down mode is disabled, but the Hold-max-cost mode is
enabled.
To disable this mode, run the isis suppress-flapping peer hold-max-cost disable
command.
Step 4 Run isis suppress-flapping peer { detecting-interval
detecting-interval |
threshold
threshold | resume-interval
resume-interval } *
Detection parameters are configured for IS-IS neighbor relationship flapping
suppression.
Each IS-IS interface that has IS-IS neighbor relationship flapping suppression
enabled starts a flapping counter. If the interval between two successive neighbor
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 572
status changes from Full to a non-Full state is shorter than
detecting-interval, a
valid flapping_event is recorded, and the flapping_count is incremented by 1.
When the flapping_count reaches or exceeds
threshold, flapping suppression takes
effect. If the interval between two successive neighbor status changes from Full to
a non-Full state is longer than
resume-interval, the flapping_count is reset.
NOTE
The value of
resume-interval must be greater than that of
detecting-interval.
By default, the detection interval of IS-IS neighbor relationship flapping
suppression is 60s, the suppression threshold is 10, and the interval for exiting
from suppression is 120s. Using the default detection parameters is recommended.
Step 5 Run quit
The system view is displayed.
Step 6 Run quit
The user view is displayed.
Step 7 Run reset isis
process-id suppress-flapping peer [ interface
interface-type
interface-number ] [ notify-peer ]
Interfaces are forced to exit from IS-IS neighbor relationship flapping suppression.
Interfaces exit from flapping suppression in the following scenarios:
● The suppression timer expires.
● The corresponding IS-IS process is reset.
● An IS-IS neighbor is reset using the reset isis peer command.
● IS-IS neighbor relationship flapping suppression is disabled globally using the
suppress-flapping peer disable (IS-IS) command in the IS-IS view.
● The reset isis suppress-flapping peer command is run.
● Suppression is aborted forcibly using the reset isis
process-id suppress-
flapping peer [ interface
interface-type interface-number ] notify-peer
command on the remote device.
----End
Verifying the Configurations
Run the display isis [
process-id ] interface
interface-type interface-number
verbose command to check the status of IS-IS neighbor relationship flapping
suppression.
<HUAWEI> display isis interface verbose
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif100 001 Up Down 1497 L1/L2 No/No
Circuit MT State : Standard
Description :
SNPA Address : xxxx-xxxx-xxxx
IP Address : 10.1.1.5
IPV6 Link Local Address :
IPV6 Global Address (es) :
Csnp Timer Value : L1 10 L2 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 573
Hello Timer Value : L1 10 L2 10
DIS Hello Timer Value : L1 3 L2 3
Hello Multiplier Value : L1 3 L2 3
LSP-Throttle Timer : L12 50
Cost : L1 10 L2 10
Ipv6 Cost : L1 10 L2 10
Priority : L1 64 L2 64
Retransmit Timer Value : L12 5
Bandwidth-Value : Low 1000000000 High 0
Static Bfd : NO
Dynamic Bfd : NO
Dynamic IPv6 Bfd : NO
Fast-Sense Rpr : NO
Suppress flapping peer : enable (flapping-count: 0, threshold: 10)
Suppress flapping peer in the command output indicates the current suppression
mode (enable), time when the flapping suppression started, and the remaining
time of the flapping suppression.
7.18 Maintaining IS-IS
7.18.1 Resetting IS-IS
Context
To reset IS-IS, reset IS-IS data structure, neighbor relationship and packets
NOTICE
The IS-IS data structure cannot be restored after you reset it. All the previous
structure information and the neighbor relationship are reset. Exercise caution
when running this command.
The specified IS-IS neighbor relationship is deleted after you reset a specified IS-IS
neighbor. Exercise caution when running this command.
Procedure
● Reset IS-IS data structure.
Run the reset isis all[
process-id | vpn-instance
vpn-instance-name ]
command to reset IS-IS data structure.
● Reset IS-IS neighbor relationship.
Run the reset isis peer
system-id [
process-id | vpn-instance
vpn-instance-
name ] command to reset a specific IS-IS neighbor.
After the IS-IS routing policy or the protocol changes, you can reset a specific
IS-IS neighbor to validate the new configuration.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 574
7.18.2 Improving the Maintainability of IS-IS
Context
The administrator can improve the maintainability of IS-IS using either of the
following methods:
● Configuring IS-IS host name mapping: Through this function, the
administrator can use a simple name to replace the system ID. After IS-IS host
name mapping is configured, the dynamic name is displayed in the IS-IS
information to replace the system ID when the display command is executed.
This improves the maintainability of IS-IS networks.
● Configuring IS-IS to add the POI TLV to a PURGE packet: When the value of
the Remaining Lifetime field in an LSP packet is 0, this packet is invalid and
called a PURGE packet. PURGE packets do not record information about the
devices generating these packets. Therefore, when a network is faulty, the
packet source cannot be located. To solve this problem, IS-IS can be
configured to add the POI TLV to a PURGE packet so that the PURGE packet
contains information about its generating device. If the dynamic host name
function is configured locally, the host name TLV is also added to the PURGE
packet to facilitate fault location.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Configure IS-IS host name mapping.
● Run is-name
symbolic-name
IS-IS dynamic host name mapping is configured and a host name is
configured for the local device.
This configuration is dynamic configuration. Therefore, the configured host
name
symbolic-name is advertised through an LSP to other IS-IS devices in
the same area. When you use IS-IS display commands to view IS-IS
information on other IS-IS devices, the system ID of the local device is
replaced by the configured host name.
● Run is-name map
system-id symbolic-name
IS-IS static host name mapping is configured and a host name is configured
for the remote device.
This configuration is static configuration and takes effect only on the local
device. Therefore, the configured host name
symbolic-name is not advertised
through an LSP.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 575
7.18.3 Configuring the Output of IS-IS Adjacency Status
Context
On an IS-IS network, neighbor flapping will result in network instability and
frequent network convergence. This will consume lots of memory and may even
cause user traffic loss. Therefore, neighbor flapping needs to be rapidly located
and solved.
To rapidly locate problems in the case of neighbor flapping, enable the output of
IS-IS adjacency changes to log these changes.
If the local terminal monitor is enabled and the output of the IS-IS adjacency
status is enabled, IS-IS adjacency changes will be output to the router until the
output of the adjacency status is disabled.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run log-peer-change [ topology ]
The output of the adjacency status is enabled.
By default, the output of IS-IS adjacency changes is disabled.
----End
7.19 Configuration Examples for IPv4 IS-IS
7.19.1 Example for Configuring Basic IS-IS Functions
Networking Requirements
As shown in Figure 7-33, there are four switches (SwitchA, SwitchB, SwitchC, and
SwitchD) on the network. The four switches need to communicate with each
other. SwitchA and SwitchB can only process a small amount of data because they
have lower performance than the other two switches.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 576
Figure 7-33 Networking diagram of configuring basic IS-IS functions
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable IS-IS on each switch so that the switches can be interconnected.
Configure SwitchA and SwitchB as Level-1 devices to enable them to maintain
less data.
Procedure
Step 1 Create VLANs and add corresponding interfaces to the VLANs.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.2 24
[SwitchA-Vlanif10] quit
Step 3 Run the IS-IS progress on each Switch, specify the network entity title, and
configure the level.
# Configure SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 577
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-1
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] is-level level-1
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
# Configure SwitchD.
[SwitchD] isis 1
[SwitchD-isis-1] is-level level-2
[SwitchD-isis-1] network-entity 20.0000.0000.0004.00
[SwitchD-isis-1] quit
Step 4 Enable the IS-IS progress on each interface.
# Configure SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
# Configure SwitchB.
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable 1
[SwitchB-Vlanif20] quit
# Configure SwitchC.
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] isis enable 1
[SwitchC-Vlanif20] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] isis enable 1
[SwitchC-Vlanif30] quit
# Configure SwitchD.
[SwitchD] interface vlanif 30
[SwitchD-Vlanif30] isis enable 1
[SwitchD-Vlanif30] quit
[SwitchD] interface vlanif 40
[SwitchD-Vlanif40] isis enable 1
[SwitchD-Vlanif40] quit
Step 5 Verify the configuration.
# View the IS-IS LSDB of each Switch.
[SwitchA] display isis lsdb
Database information for ISIS(1)
--------------------------------
Level-1 Link State Database
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 578
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
-------------------------------------------------------------------------------
0000.0000.0001.00-00* 0x0000006e 0x953e 862 68 0/0/0
0000.0000.0002.00-00 0x0000006a 0xc015 766 68 0/0/0
0000.0000.0002.01-00 0x00000008 0xccb6 766 55 0/0/0
0000.0000.0003.00-00 0x00000086 0x529e 1155 111 1/0/0
0000.0000.0003.01-00 0x0000005e 0xf238 1155 55 0/0/0
Total LSP(s): 5
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
[SwitchB] display isis lsdb
Database information for ISIS(1)
--------------------------------
Level-1 Link State Database
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
-------------------------------------------------------------------------------
0000.0000.0001.00-00 0x0000006e 0x953e 899 68 0/0/0
0000.0000.0002.00-00* 0x0000006a 0xc015 808 68 0/0/0
0000.0000.0002.01-00* 0x00000008 0xccb6 808 55 0/0/0
0000.0000.0003.00-00 0x00000086 0x529e 1195 111 1/0/0
0000.0000.0003.01-00 0x0000005e 0xf238 1195 55 0/0/0
Total LSP(s): 5
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
[SwitchC] display isis lsdb
Database information for ISIS(1)
--------------------------------
Level-1 Link State Database
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
-------------------------------------------------------------------------------
0000.0000.0001.00-00 0x0000006e 0x953e 953 68 0/0/0
0000.0000.0002.00-00 0x0000006a 0xc015 859 68 0/0/0
0000.0000.0002.01-00 0x00000008 0xccb6 859 55 0/0/0
0000.0000.0003.00-00* 0x00000085 0x549d 937 111 1/0/0
0000.0000.0003.01-00* 0x0000005d 0xf437 937 55 0/0/0
Total LSP(s): 5
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
Level-2 Link State Database
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
-------------------------------------------------------------------------------
0000.0000.0003.00-00* 0x0000008a 0x513c 876 100 0/0/0
0000.0000.0004.00-00 0x00000063 0x48ad 761 84 0/0/0
0000.0000.0004.01-00 0x0000005b 0x3aef 761 55 0/0/0
Total LSP(s): 3
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
[SwitchD] display isis lsdb
Database information for ISIS(1)
--------------------------------
Level-2 Link State Database
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 579
-------------------------------------------------------------------------------
0000.0000.0003.00-00 0x0000008a 0x513c 901 100 0/0/0
0000.0000.0004.00-00* 0x00000063 0x48ad 789 84 0/0/0
0000.0000.0004.01-00* 0x0000005b 0x3aef 789 55 0/0/0
Total LSP(s): 3
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
# View the IS-IS routing table of each Switch. A default route is available in the
routing table of the Level-1 devices and the next hop is a Level-1-2 device. The
routing table of the Level-2 device contains all Level-1 and Level-2 routes.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
0.0.0.0/0 10 NULL Vlanif10 10.1.1.1 A/-/-/-
192.168.0.0/24 20 NULL Vlanif10 10.1.1.1 A/-/-/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 20 NULL Vlanif10 10.1.1.1 A/-/-/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
[SwitchB] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
0.0.0.0/0 10 NULL Vlanif20 10.1.2.1 A/-/-/-
192.168.0.0/24 20 NULL Vlanif20 10.1.2.1 A/-/-/-
10.1.1.0/24 20 NULL Vlanif20 10.1.2.1 A/-/-/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
[SwitchC] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
192.168.0.0/24 10 NULL Vlanif30 Direct D/-/L/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.16.1.0/24 20 NULL Vlanif30 192.168.0.2 A/-/-/-
192.168.0.0/24 10 NULL Vlanif30 Direct D/-/L/-
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 580
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
[SwitchD] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.16.1.0/24 10 NULL Vlanif40 Direct D/-/L/-
192.168.0.0/24 10 NULL Vlanif30 Direct D/-/L/-
10.1.1.0/24 20 NULL Vlanif30 192.168.0.1 A/-/-/-
10.1.2.0/24 20 NULL Vlanif30 192.168.0.1 A/-/-/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
isis 1
is-level level-1
network-entity 10.0000.0000.0001.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 20
#
isis 1
is-level level-1
network-entity 10.0000.0000.0002.00
#
interface Vlanif20
ip address 10.1.2.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchC configuration file
#
sysname SwitchC
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 581
#
vlan batch 10 20 30
#
isis 1
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.1.2.1 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 192.168.0.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 30 40
#
isis 1
is-level level-2
network-entity 20.0000.0000.0004.00
#
interface Vlanif30
ip address 192.168.0.2 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
return
7.19.2 Example for Configuring IS-IS Route Summarization
Networking Requirements
As shown in Figure 7-34, three switches run IS-IS to communicate with each
other. SwitchA is a Level-2 device, SwitchB is a Level-1-2 device, and SwitchC is a
Level-1 device. SwitchA is heavily loaded because there are too many routing
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 582
entries on the IS-IS network. Therefore, system resource consumption of SwitchA
needs to be reduced.
Figure 7-34 Networking diagram for configuring IS-IS route summarization
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP addresses for interfaces and enable IS-IS on each switch so that
the switches can be interconnected.
2. Configure route summarization on SwitchB to reduce the routing table size of
SwitchA without affecting data forwarding so that the system resource
consumption of SwitchA can be reduced.
Procedure
Step 1 Create VLANs and add corresponding interfaces to the VLANs.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 50
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 50
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] ip address 172.17.1.1 24
[SwitchA-Vlanif50] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 583
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-2
[SwitchA-isis-1] network-entity 20.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] isis enable 1
[SwitchA-Vlanif50] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] isis enable 1
[SwitchB-Vlanif10] quit
[SwitchB] interface vlanif 50
[SwitchB-Vlanif50] isis enable 1
[SwitchB-Vlanif50] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] is-level level-1
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] isis enable 1
[SwitchC-Vlanif20] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] isis enable 1
[SwitchC-Vlanif30] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] isis enable 1
[SwitchC-Vlanif40] quit
Step 4 Check the IS-IS routing table of SwitchA.
[SwitchA]display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
172.16.1.0/24 30 NULL Vlanif50 172.17.1.2 A/-/-/-
172.16.2.0/24 30 NULL Vlanif50 172.17.1.2 A/-/-/-
172.16.3.0/24 30 NULL Vlanif50 172.17.1.2 A/-/-/-
172.16.4.0/24 20 NULL Vlanif50 172.17.1.2 A/-/-/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
Step 5 Configure route summarization on SwitchB.
# Summarize 172.16.1.0/24, 172.16.2.0/24, 172.16.3.0/24, and 172.16.4.0/24 as
172.16.0.0/16 on SwitchB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 584
[SwitchB] isis 1
[SwitchB-isis-1] summary 172.16.0.0 255.255.0.0 level-1-2
[SwitchB-isis-1] quit
Step 6 Verify the configuration.
# Check the IS-IS routing table of SwitchA. The routing table contains the route
172.16.0.0/16 summarized from 172.16.1.0/24, 172.16.2.0/24, 172.16.3.0/24, and
172.16.4.0/24.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
172.16.0.0/16 20 NULL Vlanif50 172.17.1.2 A/-/-/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 50
#
isis 1
is-level level-2
network-entity 20.0000.0000.0001.00
#
interface Vlanif50
ip address 172.17.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 50
#
isis 1
network-entity 10.0000.0000.0002.00
summary 172.16.0.0 255.255.0.0 level-1-2
#
interface Vlanif10
ip address 172.16.4.2 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 172.17.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 585
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 50
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10 20 30 40
#
isis 1
is-level level-1
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 172.16.4.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 172.16.1.1 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 172.16.2.1 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 172.16.3.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 40
#
return
7.19.3 Example for Configuring DIS Election
Networking Requirements
As shown in Figure 7-35, four switches on the broadcast network communicate
using IS-IS. SwitchA and SwitchB are Level-1-2 devices, SwitchC is a Level-1 device,
and SwitchD is a Level-2 device. SwitchA with high performance needs to be
configured as a Level-2 DIS.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 586
Figure 7-35 Networking diagram for configuring DIS election
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IS-IS to enable network interconnectivity.
2. Configure the DIS priority of Switch A to 100 so that SwitchA can be elected
as a Level-2 DIS.
Procedure
Step 1 Create VLANs and add corresponding interfaces to the VLANs.
# Configure SwitchA. The configurations of Switch, SwitchB, SwitchC, and SwitchD
are similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
Step 3 View the MAC address of the VLANIF 10 interface on each Switch.
# View the MAC address of the VLANIF 10 interface on SwitchA.
[SwitchA] display interface Vlanif 10
Vlanif10 current state : UP
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 587
Line protocol current state : UP
Last line protocol up time : 2014-12-02 18:02:15 UTC+08:00
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is 10.1.1.1/24
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fc10-afec
Current system time: 2014-12-02 18:03:12+08:00
Input bandwidth utilization : --
Output bandwidth utilization : --
# View the MAC address of the VLANIF 10 interface on SwitchB.
[SwitchB] display interface Vlanif 10
Vlanif10 current state : UP
Line protocol current state : UP
Last line protocol up time : 2014-12-02 18:01:15 UTC+08:00
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is 10.1.1.2/24
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fccd-acdf
Current system time: 2014-12-02 18:02:12+08:00
Input bandwidth utilization : --
Output bandwidth utilization : --
# View the MAC address of the VLANIF 10 interface on SwitchC.
[SwitchC] display interface Vlanif 10
Vlanif10 current state : UP
Line protocol current state : UP
Last line protocol up time : 2014-12-02 18:03:15 UTC+08:00
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is 10.1.1.3/24
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fc50-25fe
Current system time: 2014-12-02 18:04:12+08:00
Input bandwidth utilization : --
Output bandwidth utilization : --
# View the MAC address of the VLANIF 10 interface on SwitchD.
[SwitchD] display interface Vlanif 10
Vlanif10 current state : UP
Line protocol current state : UP
Last line protocol up time : 2014-12-02 18:07:15 UTC+08:00
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is 10.1.1.4/24
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fcfd-305c
Current system time: 2014-12-02 18:08:12+08:00
Input bandwidth utilization : --
Output bandwidth utilization : --
Step 4 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 588
[SwitchB-Vlanif10] isis enable 1
[SwitchB-Vlanif10] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] is-level level-1
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
# Configure SwitchD.
[SwitchD] isis 1
[SwitchD-isis-1] network-entity 10.0000.0000.0004.00
[SwitchD-isis-1] is-level level-2
[SwitchD-isis-1] quit
[SwitchD] interface vlanif 10
[SwitchD-Vlanif10] isis enable 1
[SwitchD-Vlanif10] quit
# View information about the IS-IS neighbors of SwitchA.
[SwitchA] display isis peer
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0002 Vlanif10 0000.0000.0002.01 Up 9s L1(L1L2) 64
0000.0000.0003 Vlanif10 0000.0000.0002.01 Up 27s L1 64
0000.0000.0002 Vlanif10 0000.0000.0004.01 Up 28s L2(L1L2) 64
0000.0000.0004 Vlanif10 0000.0000.0004.01 Up 8s L2 64
Total Peer(s): 4
# View information about the IS-IS interface of SwitchA.
[SwitchA] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 No/No
# View information about the IS-IS interface of SwitchB.
[SwitchB] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 Yes/No
# View information about the IS-IS interface of SwitchD.
[SwitchD] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 No/Yes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 589
NOTE
When the default DIS priority is used, the interface on SwitchB has the greatest MAC
address among all the interfaces on the Level-1 Switches. Therefore, SwitchB is elected as
the Level-1 DIS. The interface on SwitchD has the greatest MAC address among all the
interfaces on the Level-2 Switches. Therefore, SwitchD is elected as the Level-2 DIS. The
Level-1 pseudonode is 0000.0000.0002.01. The Level-2 pseudonode is 0000.0000.0004.01.
Step 5 Set the DIS priority of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis dis-priority 100
[SwitchA-Vlanif10] quit
# View information about the IS-IS neighbors of SwitchA.
[SwitchA] display isis peer
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0002 Vlanif10 0000.0000.0001.01 Up 21s L1(L1L2) 64
0000.0000.0003 Vlanif10 0000.0000.0001.01 Up 27s L1 64
0000.0000.0002 Vlanif10 0000.0000.0001.01 Up 28s L2(L1L2) 64
0000.0000.0004 Vlanif10 0000.0000.0001.01 Up 30s L2 64
Total Peer(s): 4
Step 6 Verify the configuration.
# View information about the IS-IS interface of SwitchA.
[SwitchA] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 Yes/Yes
As shown in the output information, after the DIS priority of the IS-IS interface is
changed, SwitchA immediately becomes a Level-1 and Level-2 DIS and its
pseudonode is 0000.0000.0001.01.
# View information about the IS-IS neighbors and IS-IS interfaces on SwitchB.
[SwitchB] display isis peer
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0001 Vlanif10 0000.0000.0001.01 Up 7s L1(L1L2) 100
0000.0000.0003 Vlanif10 0000.0000.0001.01 Up 25s L1 64
0000.0000.0001 Vlanif10 0000.0000.0001.01 Up 7s L2(L1L2) 100
0000.0000.0004 Vlanif10 0000.0000.0001.01 Up 25s L2 64
Total Peer(s): 4
[SwitchB] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 No/No
# View information about the IS-IS neighbors and IS-IS interfaces on SwitchD.
[SwitchD] display isis peer
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 590
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0002 Vlanif10 0000.0000.0001.01 Up 28s L2 64
0000.0000.0001 Vlanif10 0000.0000.0001.01 Up 9s L2 100
Total Peer(s): 2
[SwitchD] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 No/No
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 10
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
isis 1
network-entity 10.0000.0000.0001.00
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
isis dis-priority 100
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 591
#
isis 1
network-entity 10.0000.0000.0002.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10
#
isis 1
is-level level-1
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.1.3 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 10
#
isis 1
is-level level-2
network-entity 10.0000.0000.0004.00
#
interface Vlanif10
ip address 10.1.1.4 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
7.19.4 Example for Configuring IS-IS Load Balancing
Networking Requirements
As shown in Figure 7-36, switches run IS-IS to implement IP interworking.
Congestion of the network from SwitchA to destination address 172.17.1.0/24
needs to be relieved to improve network resource efficiency.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 592
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 7-36 Networking diagram for configuring IS-IS load balancing
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic IS-IS functions on each switch to implement IP interworking.
2. Configure load balancing to balance traffic from SwitchA to SwitchD between
SwitchB and SwitchC.
Procedure
Step 1 Configure VLANs that the related interfaces belong to.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20 50
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
[SwitchA] interface gigabitethernet 0/0/3
[SwitchA-GigabitEthernet0/0/3] port link-type trunk
[SwitchA-GigabitEthernet0/0/3] port trunk allow-pass vlan 50
[SwitchA-GigabitEthernet0/0/3] quit
Step 2 Assign an IP address to each VLANIF interface.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 593
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.1.2.1 24
[SwitchA-Vlanif20] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] ip address 172.16.1.1 24
[SwitchA-Vlanif50] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-2
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis enable 1
[SwitchA-Vlanif20] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] isis enable 1
[SwitchA-Vlanif50] quit
Step 4 Set the number of equal-cost routes for load balancing to 1 on SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] maximum load-balancing 1
[SwitchA-isis-1] quit
# View the routing table of SwitchA.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 30 NULL Vlanif10 10.1.1.2 A/-/-/-
172.16.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
192.168.0.0/24 20 NULL Vlanif10 10.1.1.2 A/-/-/-
192.168.1.0/24 20 NULL Vlanif20 10.1.2.2 A/-/-/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, U-Up/
Down Bit Set
As shown in the routing table, when the maximum number of equal-cost routes
for load balancing is set to 1, IS-IS selects 10.1.1.2 as the next hop to the
destination network 172.17.1.0. This is because IS-IS selects the route with next
hop 10.1.1.2 as the optimal route because SwitchB has a smaller system ID.
Step 5 Restore the default number of equal-cost routes for load balancing on SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] undo maximum load-balancing
[SwitchA-isis-1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 594
# View the routing table of SwitchA.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 30 NULL Vlanif10 10.1.1.2 A/-/-/-
Vlanif20 10.1.2.2
172.16.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
192.168.0.0/24 20 NULL Vlanif10 10.1.1.2 A/-/-/-
192.168.1.0/24 20 NULL Vlanif20 10.1.2.2 A/-/-/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, U-Up/
Down Bit Set
As shown in the routing table, the number of equal-cost routes for load balancing
is restored to the default value. Both the next hops of SwitchA, 10.1.1.2 (SwitchB)
and 10.1.2.2 (SwitchC) now become valid.
Step 6 (Optional) Set the preference for equal-cost routes on SwitchA.
[SwitchA] isis
[SwitchA-isis-1] nexthop 10.1.2.2 weight 1
[SwitchA-isis-1] quit
Step 7 Verify the configuration.
# View the routing table of SwitchA.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 30 NULL Vlanif20 10.1.2.2 A/-/-/-
172.16.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
192.168.0.0/24 20 NULL Vlanif10 10.1.1.2 A/-/-/-
192.168.1.0/24 20 NULL Vlanif20 10.1.2.2 A/-/-/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, U-Up/
Down Bit Set
As shown in the routing table, the preference of the next hop 10.1.2.2 (SwitchC)
with the weight as 1, is higher than that of 10.1.1.2 (SwitchB), after the weight is
set for equal-cost routes. Therefore, IS-IS selects route with the next hop 10.1.2.2
as the optimal route.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 595
#
vlan batch 10 20 50
#
isis 1
is-level level-2
network-entity 10.0000.0000.0001.00
nexthop 10.1.2.2 weight 1
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.1.2.1 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 172.16.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 30
#
isis 1
is-level level-2
network-entity 10.0000.0000.0002.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 192.168.0.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 40
#
isis 1
is-level level-2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 596
network-entity 10.0000.0000.0003.00
#
interface Vlanif20
ip address 10.1.2.2 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 192.168.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 30 40 60
#
isis 1
is-level level-2
network-entity 10.0000.0000.0004.00
#
interface Vlanif30
ip address 192.168.0.2 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 192.168.1.2 255.255.255.0
isis enable 1
#
interface Vlanif60
ip address 172.17.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 60
#
return
7.19.5 Example for Configuring IS-IS Auto FRR (IP Protecting
IP)
Networking Requirements
As shown in Figure 7-37, four switches (SwitchA, SwitchB, SwitchC, and SwitchD)
communicate using IS-IS. Reliability of data forwarding from SwitchA to SwitchD
needs to be improved so that uninterrupted traffic transmission is ensured when a
fault occurs on the network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 597
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 7-37 Networking diagram of configuring IS-IS Auto FRR
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP addresses for interfaces and enable IS-IS on each switch to
ensure reachable routes between the switches.
2. Set a larger link cost (in compliance with the traffic protection inequality of
IS-IS Auto FRR) on GigabitEthernet0/0/2 of SwitchA to ensure that Link T
functions as the primary link to forward data from SwitchA to SwitchD.
3. Configure IS-IS Auto FRR on SwitchA to allow traffic to be fast switched to the
backup link without waiting for route convergence when a fault occurs on
Link T. This ensures uninterrupted traffic transmission.
Procedure
Step 1 Configure VLANs that interfaces belong to.
# Configure SwitchA. The configurations of SwitchB, SwitchC and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 598
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.0.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.2.0.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-1-2
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis enable 1
[SwitchA-Vlanif20] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] is-level level-1-2
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable 1
[SwitchB-Vlanif20] quit
[SwitchB] interface vlanif 30
[SwitchB-Vlanif30] isis enable 1
[SwitchB-Vlanif30] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] is-level level-1-2
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] isis enable 1
[SwitchC-Vlanif50] quit
# Configure SwitchD.
[SwitchD] isis 1
[SwitchD-isis-1] is-level level-1-2
[SwitchD-isis-1] network-entity 10.0000.0000.0004.00
[SwitchD-isis-1] quit
[SwitchD] interface vlanif 50
[SwitchD-Vlanif50] isis enable 1
[SwitchD-Vlanif50] quit
[SwitchD] interface vlanif 30
[SwitchD-Vlanif30] isis enable 1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 599
[SwitchD-Vlanif30] quit
[SwitchD] interface vlanif 40
[SwitchD-Vlanif40] isis enable 1
[SwitchD-Vlanif40] quit
Step 4 Set the cost of Vlanif20 on SwitchA to 30, and then check routing information.
# Configure the cost of Vlanif20 on SwitchA to 30.
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis cost 30
[SwitchA-Vlanif20] quit
# Check information about the link from SwitchA to SwitchD. Link T has a lower
cost, and thereby IS-IS optimally selects Link T to send traffic that is forwarded by
SwitchA.
[SwitchA] display isis route 192.168.1.1 verbose
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Dest : 192.168.1.0/24 Int. Cost : 30 Ext. Cost : NULL
Admin Tag : - Src Count : 1 Flags : A/-/L/-
Priority : Low
NextHop : Interface : ExitIndex :
10.1.0.2 Vlanif10 0x00000003
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Dest : 192.168.1.0/24 Int. Cost : 30 Ext. Cost : NULL
Admin Tag : - Src Count : 3 Flags : -/-/-/-
Priority : Low
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
# Run the display fib 192.168.1.1 verbose command on SwitchA to check the
forwarding entry from SwitchA to SwitchD.
[SwitchA] display fib 192.168.1.1 verbose
Route Entry Count: 1
Destination: 192.168.1.0 Mask : 255.255.255.0
Nexthop : 10.1.0.2 OutIf : Vlanif10
LocalAddr : 10.1.0.1 LocalMask: 0.0.0.0
Flags : DGU Age : 26sec
ATIndex : 0 Slot : 0
LspFwdFlag : 0 LspToken : 0x0
InLabel : NULL OriginAs : 0
BGPNextHop : 0.0.0.0 PeerAs : 0
QosInfo : 0x0 OriginQos: 0x0
NexthopBak : 0.0.0.0 OutIfBak : [No Intf]
LspTokenBak: 0x0 InLabelBak : NULL
LspToken_ForInLabelBak : 0x0
EntryRefCount : 0
VlanId : 0x0
BgpKey : 0
BgpKeyBak : 0
LspType : 0 Label_ForLspTokenBak : 0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 600
MplsMtu : 0 Gateway_ForLspTokenBak : 0.0.0.0
NextToken : 0x0 IfIndex_ForLspTokenBak : 0
Label_NextToken : 0 Label : 0
LspBfdState : 0
As shown in the command output, the traffic from SwitchA to SwitchD is only
forwarded through Link T.
Step 5 Enable IS-IS Auto FRR on SwitchA, and then check the routing information.
# Enable IS-IS Auto FRR on SwitchA.
[SwitchA] isis
[SwitchA-isis-1] frr
[SwitchA-isis-1-frr] loop-free-alternate
# Check information about the link from SwitchA to SwitchD. You can find that IS-
IS creates a backup link because IS-IS Auto FRR is enabled.
[SwitchA] display isis route 192.168.1.1 verbose
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Dest : 192.168.1.0/24 Int. Cost : 30 Ext. Cost : NULL
Admin Tag : - Src Count : 1 Flags : A/-/L/-
Priority : Low
NextHop : Interface : ExitIndex :
10.1.0.2 Vlanif10 0x00000003
(B)10.2.0.2 Vlanif20 0x00000004
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Dest : 192.168.1.0/24 Int. Cost : 30 Ext. Cost : NULL
Admin Tag : - Src Count : 3 Flags : -/-/-/-
Priority : Low
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
# Check the protection type for the traffic from SwitchA to SwitchD.
[SwitchA] display isis spf-tree systemid 0000.0000.0004 verbose
Shortest Path Tree for ISIS(1)
------------------------------
ISIS(1) Level-1 Shortest Path Tree
----------------------------------
0000.0000.0004.00
Distance : 20
Distance-URT : 20
Flags : SPT/V6_Islt
IPv4 Nexthops-URT : 1
(1) 10.1.0.2 IF:Vlanif10 NBR:0000.0000.0003.00
(B) 10.2.0.2 IF:Vlanif20 NBR:0000.0000.0002.00
TYPE:LOOP-FREE PROTECT:LINK-NODE
IPv4 Nexthops-MIGP : 0
IPv6 Nexthops : 0
Neighbors: 2 (Children:1 Parents:1 Others:0)
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 601
(1) 0000.0000.0003.02
Cost : 10
Flags : Parent
(2) 0000.0000.0004.03
Cost : 10
Flags : Child
ISIS(1) Level-2 Shortest Path Tree
----------------------------------
0000.0000.0004.00
Distance : 20
Distance-URT : 20
Flags : SPT/V6_Islt
IPv4 Nexthops-URT : 1
(1) 10.1.0.2 IF:Vlanif10 NBR:0000.0000.0003.00
(B) 10.2.0.2 IF:Vlanif20 NBR:0000.0000.0002.00
TYPE:LOOP-FREE PROTECT:LINK-NODE
IPv4 Nexthops-MIGP : 0
IPv6 Nexthops : 0
Neighbors: 2 (Children:1 Parents:1 Others:0)
(1) 0000.0000.0003.02
Cost : 10
Flags : Parent
(2) 0000.0000.0004.03
Cost : 10
Flags : Child
As shown in the preceding command output, link-node dual protection is enabled
from SwitchA to SwitchD.
# Run the display fib 192.168.1.1 verbose command on SwitchA to check the
backup forwarding entry from SwitchA to SwitchD.
[SwitchA] display fib 192.168.1.1 verbose
Route Entry Count: 1
Destination: 192.168.1.0 Mask : 255.255.255.0
Nexthop : 10.1.0.2 OutIf : Vlanif10 LocalAddr : 10.1.0.1 LocalMask: 0.0.0.0
Flags : DGU Age : 6sec
ATIndex : 0 Slot : 0
LspFwdFlag : 0 LspToken : 0x0
InLabel : NULL OriginAs : 0
BGPNextHop : 0.0.0.0 PeerAs : 0
QosInfo : 0x0 OriginQos: 0x0
NexthopBak : 10.2.0.2 OutIfBak : Vlanif20
LspTokenBak: 0x0 InLabelBak : NULL
LspToken_ForInLabelBak : 0x0
EntryRefCount : 0
VlanId : 0x0
BgpKey : 0
BgpKeyBak : 0
LspType : 0 Label_ForLspTokenBak : 0
MplsMtu : 0 Gateway_ForLspTokenBak : 0.0.0.0
NextToken : 0x0 IfIndex_ForLspTokenBak : 0
Label_NextToken : 0 Label : 0
LspBfdState : 0
As shown in the command output, the master link from SwitchA to SwitchD is
Link T, the relevant backup link follows the route with Vlanif20 as the outbound
interface and 10.2.0.2 as the next hop.
Step 6 Verify the configuration.
# Run the shutdown command on Vlanif50 of SwitchC to make the link down.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 602
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] shutdown
# Run the display fib 192.168.1.1 verbose command immediately on SwitchA to
check information about the route from SwitchA to SwitchD.
[SwitchA] display fib 192.168.1.1 verbose
Route Entry Count: 1
Destination: 192.168.1.0 Mask : 255.255.255.0
Nexthop : 10.2.0.2 OutIf : Vlanif20
LocalAddr : 10.2.0.1 LocalMask: 0.0.0.0
Flags : DGU Age : 124sec
ATIndex : 0 Slot : 0
LspFwdFlag : 0 LspToken : 0x0
InLabel : NULL OriginAs : 0
BGPNextHop : 0.0.0.0 PeerAs : 0
QosInfo : 0x0 OriginQos: 0x0
NexthopBak : 0.0.0.0 OutIfBak : [No Intf]
LspTokenBak: 0x0 InLabelBak : NULL
LspToken_ForInLabelBak : 0x0
EntryRefCount : 0
VlanId : 0x0
BgpKey : 0
BgpKeyBak : 0
LspType : 0 Label_ForLspTokenBak : 0
MplsMtu : 0 Gateway_ForLspTokenBak : 0.0.0.0
NextToken : 0x0 IfIndex_ForLspTokenBak : 0
Label_NextToken : 0 Label : 0
LspBfdState : 0
As shown in the command output, the traffic forwarded by the SwitchA is
switched to the backup link, with Vlanif20 as the outbound interface and 10.2.0.2
as the next hop.
NOTE
If a fault occurs on the network, IS-IS Auto FRR ensures the fast switchover of the traffic to
the backup link before the network convergence, and consequently protects traffic.
----End
Configuration Files
● Configuration file of SwitchA
#
sysname SwitchA
#
vlan batch 10 20
#
isis 1
network-entity 10.0000.0000.0001.00
frr
loop-free-alternate level-1
loop-free-alternate level-2
#
interface Vlanif10
ip address 10.1.0.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.2.0.1 255.255.255.0
isis enable 1
isis cost 30
#
interface GigabitEthernet0/0/1
port link-type trunk
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 603
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● Configuration file of SwitchB
#
sysname SwitchB
#
vlan batch 20 30
#
isis 1
network-entity 10.0000.0000.0002.00
#
interface Vlanif20
ip address 10.2.0.2 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 10.3.0.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
return
● Configuration file of SwitchC
#
sysname SwitchC
#
vlan batch 10 50
#
isis 1
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.0.2 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 10.4.0.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 50
#
return
● Configuration file of SwitchD
#
sysname SwitchD
#
vlan batch 30 40 50
#
isis 1
network-entity 10.0000.0000.0004.00
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 604
#
interface Vlanif50
ip address 10.4.0.2 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 10.3.0.2 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 192.168.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
return
7.19.6 Example for Configuring Static BFD for IS-IS
Networking Requirements
As shown in Figure 7-38, three routers are interconnected using IS-IS, and SwitchA
and SwitchB communicate with each other through a Layer 2 switch. When the
link between SwitchA and SwitchB is faulty, the two routers need to rapidly
respond to the fault and reestablish a neighbor relationship.
Figure 7-38 Networking diagram of configuring static BFD for IS-IS
NOTE
BFD for IS-IS cannot be used to detect the multi-hop link between SwitchA and SwitchC,
because the IS-IS neighbor relationship cannot be established between SwitchA and
SwitchC.
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP addresses for interfaces and enable IS-IS on each router to
ensure reachable routes between the routers.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 605
2. Enable static BFD for IS-IS on SwitchA and SwitchB so that routers can rapidly
detect link faults.
Procedure
Step 1 Configure VLANs that each interface belongs to.
# Configure SwitchA. The configurations of Switch, SwitchB and SwitchC are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign the IP addresses for VLANIF interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-2
[SwitchA-isis-1] network-entity aa.1111.1111.1111.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] is-level level-2
[SwitchB-isis-1] network-entity aa.2222.2222.2222.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] isis enable 1
[SwitchB-Vlanif10] quit
[SwitchB] interface vlanif 30
[SwitchB-Vlanif30] isis enable 1
[SwitchB-Vlanif30] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] is-level level-2
[SwitchC-isis-1] network-entity aa.3333.3333.3333.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] isis enable 1
[SwitchC-Vlanif30] quit
# After the preceding configurations, you can see that the neighbor relationship is
established between SwitchA and SwitchB.
[SwitchA] display isis peer
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 606
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
2222.2222.2222 Vlanif10 1111.1111.1111.01 Up 23s L2 64
Total Peer(s): 1
The IS-IS routing table of SwitchA contains the routes to SwitchB and SwitchC.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
10.2.1.0/24 20 NULL Vlanif10 10.1.1.2 A/-/L/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, U-Up/
Down Bit Set
Step 4 Configure BFD.
# Enable BFD on SwitchA and configure a BFD session.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] bfd atob bind peer-ip 10.1.1.2 interface vlanif 10
[SwitchA-bfd-session-atob] discriminator local 1
[SwitchA-bfd-session-atob] discriminator remote 2
[SwitchA-bfd-session-atob] commit
[SwitchA-bfd-session-atob] quit
# Enable BFD on SwitchB and configure a BFD session.
[SwitchB] bfd
[SwitchB-bfd] quit
[SwitchB] bfd btoa bind peer-ip 10.1.1.1 interface vlanif 10
[SwitchB-bfd-session-btoa] discriminator local 2
[SwitchB-bfd-session-btoa] discriminator remote 1
[SwitchB-bfd-session-btoa] commit
[SwitchB-bfd-session-btoa] quit
After the preceding configurations are complete, run the display bfd session all
command on SwitchA or SwitchB, and you can see that the status of the BFD
session is Up.
The following uses the display on SwitchA as an example.
[SwitchA] display bfd session all
--------------------------------------------------------------------------------
Local Remote PeerIpAddr State Type InterfaceName
--------------------------------------------------------------------------------
1 2 10.1.1.2 Up S_IP_IF Vlanif10
--------------------------------------------------------------------------------
Total UP/DOWN Session Number : 1/0
Step 5 Enable IS-IS fast detection.
# Configure SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis bfd static
[SwitchA-Vlanif10] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 607
# Configure SwitchB.
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] isis bfd static
[SwitchB-Vlanif10] quit
Step 6 Verify the configuration.
# Enable debugging on SwitchA and export information to the VTY tunnel.
[SwitchA] info-center source bfd channel 1 log level debugging state on
[SwitchA] quit
<SwitchA> debugging isis circuit-information
<SwitchA> terminal debugging
<SwitchA> terminal logging
<SwitchA> terminal monitor
# Run the shutdown command on GigabitEthernet0/0/1 on SwitchB to simulate a
link fault.
[SwitchB]interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# On SwitchA, you can view the following log and debugging information, which
indicates that IS-IS deletes the neighbor relationship with SwitchB after being
notified by BFD of the fault.
May 19 2013 09:34:49+08:00 SwitchB %%01ISIS/4/PEER_DOWN_BFDDOWN(l)[2]:ISIS 1 ne
ighbor 2222.2222.2222 was Down on interface Vlanif2710 because the BFD node was d
own.
The Hello packet was received at 09:29:39 last time; the maximum interval for se
nding Hello packets was 8944; the local router sent 392 Hello packets and receiv
ed 2 packets; the type of the Hello packet was Lan Level-2.
Run the display isis route command or the display isis peer command on
SwitchA, and you can see that no information is displayed. This indicates that the
IS-IS neighbor relationship between SwitchA and SwitchB is deleted.
# After the configuration is checked, disable debugging on SwitchA.
<SwitchA> undo debugging isis circuit-information
<SwitchA> undo terminal debugging
<SwitchA> undo terminal logging
<SwitchA> undo terminal monitor
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 10
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchA configuration file
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 608
#
sysname SwitchA
#
info-center source BFD channel 1 log level debugging
#
vlan batch 10
#
bfd
#
isis 1
is-level level-2
network-entity aa.1111.1111.1111.00
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
isis bfd static
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
bfd atob bind peer-ip 10.1.1.2 interface Vlanif10
discriminator local 1
discriminator remote 2
commit
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 30
#
bfd
#
isis 1
is-level level-2
network-entity aa.2222.2222.2222.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
isis bfd static
#
interface Vlanif30
ip address 10.2.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
bfd btoa bind peer-ip 10.1.1.1 interface Vlanif10
discriminator local 2
discriminator remote 1
commit
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 30
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 609
#
isis 1
is-level level-2
network-entity aa.3333.3333.3333.00
#
interface Vlanif30
ip address 10.2.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
return
7.19.7 Example for Configuring Dynamic BFD for IS-IS
Networking Requirements
As shown in Figure 7-39, three routers are interconnected using IS-IS, and SwitchA
and SwitchB communicate with each other through a Layer 2 switch. When the
link that passes through the switch between SwitchA and SwitchB fails, the two
routers need to rapidly respond to the fault, and traffic can be switched to the link
that passes through SwitchC for forwarding.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 7-39 Networking diagram of configuring dynamic BFD for IS-IS
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP addresses for interfaces and enable IS-IS on each router to
ensure reachable routes between the routers.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 610
2. Set the IS-IS interface cost to control route selection of the routers to make
the link that passes through the switch from SwitchA to SwitchB as the
primary link and the link that passes through SwitchC as the backup link.
3. Configure dynamic BFD for IS-IS on SwitchA, SwitchB, and SwitchC so that
link faults can be detected rapidly and traffic can be switched to the backup
link for forwarding.
Procedure
Step 1 Configure VLANs that each interface belongs to.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Assign the IP addresses for VLANIF interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.3.3.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis
[SwitchA-isis-1] is-level level-2
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis enable 1
[SwitchA-Vlanif20] quit
# Configure SwitchB.
[SwitchB] isis
[SwitchB-isis-1] is-level level-2
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 50
[SwitchB-Vlanif50] isis enable 1
[SwitchB-Vlanif50] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable 1
[SwitchB-Vlanif20] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 611
[SwitchB] interface vlanif 40
[SwitchB-Vlanif40] isis enable 1
[SwitchB-Vlanif40] quit
# Configure SwitchC.
[SwitchC] isis
[SwitchC-isis-1] is-level level-2
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] isis enable 1
[SwitchC-Vlanif50] quit
# After the preceding configurations, run the display isis peer command. You can
see that the neighbor relationships are established between SwitchA and SwitchB,
and between SwitchA and SwitchC. The following uses the configuration of
SwitchA as an example.
[SwitchA] display isis peer
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0003 Vlanif10 0000.0000.0001.02 Up 21s L2 64
0000.0000.0002 Vlanif20 0000.0000.0002.01 Up 9s L2 64
Total Peer(s): 2
# Switches have learned routes from each other. The following uses the routing
table of SwitchA as an example.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.2.2.0/24 ISIS-L2 15 20 D 10.3.3.2 Vlanif20
ISIS-L2 15 20 D 10.1.1.2 Vlanif10
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 ISIS-L2 15 20 D 10.3.3.2 Vlanif20
As shown in the routing table, the next-hop address of the route to 172.16.1.0/24
is 10.3.3.2, and traffic is transmitted on the primary link SwitchA→SwitchB.
Step 4 Set the interface cost.
# Configure SwitchA.
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis cost 5
[SwitchA-Vlanif20] quit
# Configure SwitchB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 612
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis cost 5
[SwitchB-Vlanif20] quit
Step 5 Configure BFD for IS-IS processes.
# Enable BFD for IS-IS on SwitchA.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] isis
[SwitchA-isis-1] bfd all-interfaces enable
[SwitchA-isis-1] quit
# Enable BFD for IS-IS on SwitchB.
[SwitchB] bfd
[SwitchB-bfd] quit
[SwitchB] isis
[SwitchB-isis-1] bfd all-interfaces enable
[SwitchB-isis-1] quit
# Enable BFD for IS-IS on SwitchC.
[SwitchC] bfd
[SwitchC-bfd] quit
[SwitchC] isis
[SwitchC-isis-1] bfd all-interfaces enable
[SwitchC-isis-1] quit
# After the preceding configurations, run the display isis bfd session all
command on SwitchA, SwitchB, and SwitchC. You can see that the BFD session
status is Up.
The following uses the display on SwitchA as an example.
[SwitchA] display isis bfd session all
BFD session information for ISIS(1)
-----------------------------------
Peer System ID : 0000.0000.0003 Interface : Vlanif10
TX : 1000 BFD State : up Peer IP Address : 10.1.1.2
RX : 1000 LocDis : 8193 Local IP Address: 10.1.1.1
Multiplier : 3 RemDis : 8193 Type : L2
Diag : No diagnostic information
Peer System ID : 0000.0000.0002 Interface : Vlanif20
TX : 1000 BFD State : up Peer IP Address : 10.3.3.2
RX : 1000 LocDis : 8192 Local IP Address: 10.3.3.1
Multiplier : 3 RemDis : 8192 Type : L2
Diag : No diagnostic information
Total BFD session(s): 2
As shown in the preceding display, the status of the BFD session between SwitchA
and SwitchB and that between SwitchA and SwitchC is Up.
Step 6 Configure BFD for IS-IS interfaces.
# Configure BFD on VLANIF20 of SwitchA, set the minimum interval for sending
packets to 100 ms, the minimum interval for receiving packets to 100 ms, and the
local detection multiplier to 4.
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis bfd enable
[SwitchA-Vlanif20] isis bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
[SwitchA-Vlanif20] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 613
# Configure BFD on VLANIF20 of SwitchB, set the minimum interval for sending
packets to 100 ms, the minimum interval for receiving packets to 100 ms, and the
local detection multiplier to 4.
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis bfd enable
[SwitchB-Vlanif20] isis bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
[SwitchB-Vlanif20] quit
# After the preceding configurations, run the display isis bfd session all
command on SwitchA or SwitchB. You can see that the BFD parameters have
taken effect. The following uses the display on SwitchB as an example.
[SwitchB] display isis bfd session all
BFD session information for ISIS(1)
-----------------------------------
Peer System ID : 0000.0000.0003 Interface : Vlanif50
TX : 1000 BFD State : up Peer IP Address : 10.2.2.1
RX : 1000 LocDis : 8192 Local IP Address: 10.2.2.2
Multiplier : 3 RemDis : 8193 Type : L2
Diag : No diagnostic information
Peer System ID : 0000.0000.0001 Interface : Vlanif20
TX : 100 BFD State : up Peer IP Address : 10.3.3.1
RX : 100 LocDis : 8192 Local IP Address: 10.3.3.2
Multiplier : 4 RemDis : 8192 Type : L2
Diag : No diagnostic information
Total BFD session(s): 2
Step 7 Verify the configuration.
# Run the shutdown command on GigabitEthernet0/0/2 of SwitchB to simulate a
primary link failure.
[SwitchB] interface gigabitethernet 0/0/2
[SwitchB-GigabitEthernet0/0/2] shutdown
Step 8 # View the routing table of SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 8
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.2.2.0/24 ISIS-L2 15 20 D 10.1.1.2 Vlanif10
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 ISIS-L2 15 30 D 10.1.1.2 Vlanif10
As shown in the routing table, the backup link SwitchA→SwitchC→SwitchB takes
effect after the primary link fails, and the next-hop address of the route to
172.16.1.0/24 becomes 10.1.1.2.
# Run the display isis bfd session all command on SwitchA. You can see that the
status of the BFD session between SwitchA and SwitchC is Up.
[SwitchA] display isis bfd session all
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 614
BFD session information for ISIS(1)
-----------------------------------
Peer System ID : 0000.0000.0003 Interface : Vlanif10
TX : 1000 BFD State : up Peer IP Address : 10.1.1.2
RX : 1000 LocDis : 8193 Local IP Address: 10.1.1.1
Multiplier : 3 RemDis : 8193 Type : L2
Diag : No diagnostic information
Total BFD session(s): 1
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 20
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
bfd
#
isis 1
is-level level-2
bfd all-interfaces enable
network-entity 10.0000.0000.0001.00
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.3.3.1 255.255.255.0
isis enable 1
isis cost 5
isis bfd enable
isis bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchB configuration file
#
sysname SwitchB
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 615
#
vlan batch 20 40 50
#
bfd
#
isis 1
is-level level-2
bfd all-interfaces enable
network-entity 10.0000.0000.0002.00
#
interface Vlanif20
ip address 10.3.3.2 255.255.255.0
isis enable 1
isis cost 5
isis bfd enable
isis bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 10.2.2.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10 50
#
bfd
#
isis 1
is-level level-2
bfd all-interfaces enable
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 10.2.2.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 50
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 616
7.19.8 Example for Configuring IS-IS GR
Networking Requirements
As shown in Figure 7-40, SwitchA, SwitchB, and SwitchC belong to the same
autonomous system. They run IS-IS to implement interworking and provide the GR
mechanism. When IS-IS is restarted on SwitchA, SwitchA resends connection
requests to neighbors to synchronize the LSDB.
Figure 7-40 Networking diagram of IS-IS GR configuration
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable IS-IS on each Switch so that the Switches can be interconnected.
2. Configure GR in the IS-IS view on each Switch and configure the same interval
for the restart.
Procedure
Step 1 Configure VLANs that the related interfaces belong to.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 617
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] is-level level-2
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable 1
[SwitchB-Vlanif20] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] isis enable 1
[SwitchC-Vlanif20] quit
Step 4 Configure IS-IS GR and set the restart interval.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] graceful-restart
[SwitchA-isis-1] graceful-restart interval 150
[SwitchA-isis-1] quit
[SwitchA] quit
Step 5 Verify the configuration.
# Run the display fib command on SwitchA to view the Forwarding Information
Base (FIB) table.
<SwitchA> display fib
Route Flags: G - Gateway Route, H - Host Route, U - Up Route
S - Static Route, D - Dynamic Route, B - Black Hole Route
L - Vlink Route
--------------------------------------------------------------------------------
FIB Table:
Total number of Routes : 5
Destination/Mask Nexthop Flag TimeStamp Interface TunnelID
127.0.0.1/32 127.0.0.1 HU t[21] InLoop0 0x0
127.0.0.0/8 127.0.0.1 U t[21] InLoop0 0x0
10.1.1.1/32 127.0.0.1 HU t[20678] InLoop0 0x0
10.1.1.0/24 10.1.1.1 U t[20678] Vlanif10 0x0
10.2.1.0/24 10.1.1.2 DGU t[79388] Vlanif10 0x0
# Reset the IS-IS process by using the GR method on SwitchA.
<SwitchA> reset isis all graceful-restart
NOTE
The Switch restarts an IS-IS process in GR mode only when GR is enabled for the IS-IS
process.
# Run the display fib command on SwitchA and view the FIB table to check
whether GR works normally. If GR works normally, the FIB table does not change
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 618
and the forwarding service is not affected when SwitchA restarts the IS-IS process
in GR mode.
<SwitchA> display fib
Route Flags: G - Gateway Route, H - Host Route, U - Up Route
S - Static Route, D - Dynamic Route, B - Black Hole Route
L - Vlink Route
--------------------------------------------------------------------------------
FIB Table:
Total number of Routes : 5
Destination/Mask Nexthop Flag TimeStamp Interface TunnelID
127.0.0.1/32 127.0.0.1 HU t[21] InLoop0 0x0
127.0.0.0/8 127.0.0.1 U t[21] InLoop0 0x0
10.1.1.1/32 127.0.0.1 HU t[20678] InLoop0 0x0
10.1.1.0/24 10.1.1.1 U t[20678] Vlanif10 0x0
10.2.1.0/24 10.1.1.2 DGU t[79388] Vlanif10 0x0
As shown in the display, the FIB table on SwitchA does not change and the
forwarding service is not affected.
# Disable IS-IS GR on SwitchA.
<SwitchA> system-view
[SwitchA] isis 1
[SwitchA-isis-1] undo graceful-restart
[SwitchA-isis-1] quit
[SwitchA] quit
# Reset the IS-IS process on SwitchA (not in GR mode).
<SwitchA> reset isis all
# Run the display fib command on SwitchA to view the FIB table.
<SwitchA> display fib
Route Flags: G - Gateway Route, H - Host Route, U - Up Route
S - Static Route, D - Dynamic Route, B - Black Hole Route
L - Vlink Route
--------------------------------------------------------------------------------
FIB Table:
Total number of Routes : 4
Destination/Mask Nexthop Flag TimeStamp Interface TunnelID
127.0.0.1/32 127.0.0.1 HU t[21] InLoop0 0x0
127.0.0.0/8 127.0.0.1 U t[21] InLoop0 0x0
10.1.1.1/32 127.0.0.1 HU t[20678] InLoop0 0x0
10.1.1.0/24 10.1.1.1 U t[20678] Vlanif10 0x0
As shown in the display, the FIB table on SwitchA changes and the forwarding
service is affected.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
isis 1
graceful-restart
graceful-restart interval 150
is-level level-1
network-entity 10.0000.0000.0001.00
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 619
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 20
#
isis 1
graceful-restart
graceful-restart interval 150
is-level level-2
network-entity 10.0000.0000.0002.00
#
interface Vlanif20
ip address 10.2.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10 20
#
isis 1
graceful-restart
graceful-restart interval 150
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.2.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
7.20 Troubleshooting IPv4 IS-IS
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 620
7.20.1 Failed to Establish IS-IS Neighbor Relationships
Fault Symptom
IS-IS neighbor relationship fails to be established when the link is working
properly.
Procedure
Step 1 Check whether devices on both ends of the link have the matching IS-IS levels.
● Run the display current-configuration configuration isis | include is-level
command to check the level configurations of IS-IS processes on both ends.
● Run the display current-configuration interface
interface-type interface-
number | include isis circuit-level command to check the IS-IS level
configuration of the specified interface.
IS-IS neighbor relationship can be established when IS-IS interfaces on both ends
of the link have the matching IS-IS levels.
NOTE
If you cannot view the IS-IS level of an interface using the display current-configuration
interface
interface-type interface-number | include isis circuit-level command, the
interface uses the default IS-IS level. To view the default IS-IS level, run the display
default-parameter isis command to check the Circuit-Level field.
Requirements on the IS-IS levels of interfaces on both ends of a link are as follows:
● If the IS-IS level of the local interface is Level-1, the IS-IS level of the remote interface
must be Level-1 or Level-1-2.
● If the IS-IS level of the local interface is Level-2, the IS-IS level of the remote interface
must be Level-2 or Level-1-2.
● If the IS-IS level of the local interface is Level-1-2, the IS-IS level of the remote
interface can be Level-1, Level-2, or Level-1-2.
If the IS-IS levels of interfaces on both ends of a link do not match, perform either
of the following operations to change the IS-IS level:
● Run the is-level command in the IS-IS view to change the global IS-IS level.
● Run the isis circuit-level command in the interface view to change the
interface IS-IS level.
Step 2 Check whether devices on both ends of the link have the matching area addresses.
Run the display current-configuration configuration isis command to check
area address information.
NOTE
If IS-IS Level-1 neighbor relationship needs to be established between devices on both ends,
ensure that the two devices reside in the same area.
A maximum of three area addresses can be configured for an IS-IS process. Devices on both
ends can establish IS-IS Level-1 neighbor relationship when the two devices have a same
area address.
When IS-IS Level-2 neighbor relationship needs to be established between the two devices,
the two devices can have the same or different area addresses.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 621
If the area addresses of the two devices are different, run the network-entity
command in the IS-IS view to set the same area address for the two devices.
Step 3 Check whether devices on both ends of the link have the authentication mode.
Run the display current-configuration interface
interface-type interface-number
| include isis authentication-mode command to check the IS-IS authentication
modes of the interfaces on both ends of the link.
If the two interfaces use different authentication modes, run the isis
authentication-mode command in the view of one interface to ensure that this
interface has the same authentication mode and password as the other interface.
----End
7.20.2 A Device Cannot Learn IS-IS Routes from Its Neighbor
Fault Symptom
A device cannot learn IS-IS routes from its neighbor when its link is working
properly.
Procedure
Step 1 Check whether IS-IS neighbor relationship has been established between the
device and its neighbor.
Run the display isis peer command on each device on the link to check whether
IS-IS neighbor relationship has been established.
If IS-IS neighbor relationship is not established, rectify the fault according to
7.20.1 Failed to Establish IS-IS Neighbor Relationships.
Step 2 Check whether the IS-IS routing table of the device is correct.
Run the display isis route command on the device to check the IS-IS routing
table.
1. If the IS-IS routing table contains specified routes, run the display ip routing-
table
ip-address [
mask |
mask-length ] verbose command to check whether
the IP routing table contains routes with higher protocol preference than IS-IS
routes.
NOTE
If the State field of a route displays Active Adv, the route is active. If there are routes
that have the same prefix but are discovered by different routing protocols, routes
with higher protocol preference are preferred as active routes.
2. If the IP routing table contains routes with higher protocol preference than IS-
IS routes, modify the configuration based on network planning.
Step 3 Check whether the device and its neighbor have the matching IS-IS cost style.
Run the display current-configuration configuration isis command on the
device and its neighbor to check the IS-IS cost style.
The device can learn IS-IS routes from its neighbor when it has the same IS-IS cost
style as its neighbor.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 622
The IS-IS cost style of a device can be set as follows:
● narrow: indicates that the device can receive and send packets with cost style
narrow.
● narrow-compatible: indicates that the device can receive packets with cost
style narrow or wide but sends only packets with cost style narrow.
● compatible: indicates that the device can receive and send packets with cost
style narrow or wide.
● wide-compatible: indicates that the device can receive packets with cost style
narrow or wide but sends only packets with cost style wide.
● wide: indicates that the device can receive and send packets with cost style
wide.
If the IS-IS cost styles of both ends are set to narrow and wide (or wide-
compatible) respectively, the two ends cannot communicate.
If the IS-IS cost styles of both ends are set to narrow-compatible and wide
respectively, the two ends cannot communicate either.
If the device and its neighbor have mismatching IS-IS cost styles, run the cost-
style command on the device to modify the configuration.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 623
8 IPv6 IS-IS Configuration
8.1 Overview of IS-IS
8.2 Understanding IPv6 IS-IS
8.3 Summary of IPv6 IS-IS Configuration Tasks
8.4 Licensing Requirements and Limitations for IPv6 IS-IS
8.5 Default Settings for IPv6 IS-IS
8.6 Configuring Basic IPv6 IS-IS Functions
8.7 Improving IPv6 IS-IS Network Security
8.8 Controlling IPv6 IS-IS Route Selection
8.9 Controlling IPv6 IS-IS Route Exchange
8.10 Configuring IPv6 IS-IS Route Summarization
8.11 Controlling IPv6 IS-IS Route Convergence
8.12 Configuring LSP Fragment Extension
8.13 Configuring a Mesh Group on an NBMA Network
8.14 Configuring IPv6 IS-IS Reliability
8.15 Configuring the Overload Bit for an IS-IS Device
8.16 Maintaining IS-IS
8.17 Configuration Examples for IPv6 IS-IS
8.1 Overview of IS-IS
Definition
Intermediate System-to-Intermediate System (IS-IS) is an Interior Gateway
Protocol (IGP) that runs within an autonomous system (AS). IS-IS is also a link-
state routing protocol, using the shortest path first (SPF) algorithm to calculate
routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 8 IPv6 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 624
Purpose
IS-IS is a dynamic routing protocol initially designed by the International
Organization for Standardization (ISO) for its Connectionless Network Protocol
(CLNP).
To support IP routing, the Internet Engineering Task Force (IETF) extended and
modified IS-IS in RFC 1195. This modification enables IS-IS to apply to TCP/IP and
OSI environments. This type of IS-IS is called Integrated IS-IS or Dual IS-IS.
NOTE
IS-IS stated in this document refers to Integrated IS-IS, unless otherwise stated.
In addition to IPv4 networks, IS-IS also applies to IPv6 networks to provide
accurate routing information for IPv6 packets. IS-IS has good scalability, supports
IPv6 network layer protocols, and is capable of discovering, generating, and
forwarding IPv6 routes.
8.2 Understanding IPv6 IS-IS
8.2.1 IPv6 IS-IS
IS-IS is a link-state dynamic routing protocol initially designed by the OSI. To
support IPv4 routing, IS-IS is applied to IPv4 networks and called Integrated IS-IS.
As IPv6 networks are built, IS-IS also needs to provide accurate routing
information for IPv6 packet forwarding. IS-IS has good scalability, supports IPv6
network layer protocols, and is capable of discovering, generating, and forwarding
IPv6 routes.
To process and calculate IPv6 routes, IS-IS uses two new TLVs and one network
layer protocol identifier (NLPID).
The two TLVs are as follows:
● TLV 236 (IPv6 Reachability): describes network reachability by defining the
route prefix and metric.
● TLV 232 (IPv6 Interface Address): is similar to the IP Interface Address TLV of
IPv4, except that it changes a 32-bit IPv4 address to a 128-bit IPv6 address.
The NLPID is an 8-bit field that identifies the protocol packets of the network
layer. The NLPID of IPv6 is 142 (0x8E). If IS-IS supports IPv6, it advertises routing
information through the NLPID value.
8.3 Summary of IPv6 IS-IS Configuration Tasks
Table 8-1 describes the IS-IS configuration tasks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 8 IPv6 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 625
Table 8-1 IS-IS configuration tasks
Scenario Description Task
Configuring basic IPv6
IS-IS functions
To deploy the IS-IS
protocol on IPv6
networks, configure basic
IS-IS functions to enable
communication between
different nodes on the
network. Other IS-IS
features can only be
configured after the
basic functions are
configured.
8.6 Configuring Basic
IPv6 IS-IS Functions
Configuring IPv6 IS-IS
network security
On IS-IS networks,
unauthorized users can
attack the IS-IS network
by modifying data
packets or forging
authorized users. To
ensure security of
services carried on IS-IS
networks, configure area
or domain
authentication and
interface authentication.
8.7 Improving IPv6 IS-IS
Network Security
Configuring IPv6 IS-IS
route selection
If multiple redundant
links are available in the
network using the IS-IS
protocol, the route in the
IS-IS routing table may
not be the expected
optimal route. This does
not meet the network
planning and traffic
management
requirements. To
optimize the IS-IS
network and facilitate
traffic management,
more accurate control of
the routes on the
network is required.
8.8 Controlling IPv6 IS-
IS Route Selection
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 8 IPv6 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 626
Scenario Description Task
Configuring IPv6 IS-IS
routing information
exchange
In practical applications,
to meet network
requirements, configure
route policies to
accurately control
advertising and receiving
of IS-IS routing
information.
8.9 Controlling IPv6 IS-
IS Route Exchange
Configuring IPv6 IS-IS
route aggregation
Route aggregation
allows multiple routes
with the same IP prefix
to be aggregated into
one route.
Route aggregation on a
large IS-IS network can
effectively reduce entries
in the routing table. This
minimizes system
resource consumption
and facilitates
management. In
addition, if a link in the
aggregated IP address
segment frequently
alternates between Up
and Down, devices
outside this segment will
not be affected by the
change. This prevents
route flapping and
improves network
stability.
8.10 Configuring IPv6
IS-IS Route
Summarization
Configuring IPv6 IS-IS
route convergence
To enable IS-IS to rapidly
detect the network
changes, speed up the
IS-IS network
convergence. To
minimize the effect on
networks from route
flapping and reduce load
on the device, slow down
the IS-IS network
convergence.
8.11 Controlling IPv6
IS-IS Route
Convergence
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 8 IPv6 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 627
Scenario Description Task
Configuring LSP
fragment extension
When information
contained in the LSP
data packet Protocol
Data Unit (PDU) to be
advertised by IS-IS
increases greatly, the IS-
IS device will generate
multiple LSP fragments
to carry and advertise
more information.
8.12 Configuring LSP
Fragment Extension
Configuring mesh groups On the NBMA network,
when an interface of the
switch receives a new
LSP, the LSP is flooded to
other interfaces of the
switch. On highly-
connected networks that
have multiple P2P links,
this processing method
results in repeated LSP
flooding and wastes
bandwidth resources.
To solve this problem,
create a mesh group and
add some interfaces to
the group. The switch
never floods the LSPs
received at interfaces in
the mesh group to other
interfaces from the same
group, and only floods
the LSPs to interfaces
from other groups or
interfaces that are not
configured to any mesh
groups.
8.13 Configuring a
Mesh Group on an
NBMA Network
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 8 IPv6 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 628
Scenario Description Task
Configuring IPv6 IS-IS
overload
If the system cannot
store new LSPs or
synchronize the LSDB
normally, the calculated
routing information will
be incorrect. In this case,
the system can enter the
overload state. Routes
reached through the
device will not be
calculated, but routes
directly connected to the
device will not be
ignored.
When an IS-IS device on
the network requires
upgrade or maintenance,
the device needs to be
temporarily isolated
from the network. To
prevent other devices
from forwarding traffic
through this node, set
the overload bit for the
device.