7 IPv4 IS-IS Configuration
7.1 Overview of IS-IS
7.2 Understanding IS-IS
7.3 Default Settings for IPv4 IS-IS
7.4 Summary of IPv4 IS-IS Configuration Tasks
7.5 Licensing Requirements and Limitations for IPv4 IS-IS
7.6 Configure Basic IS-IS Functions
7.7 Improving IS-IS Network Security
7.8 Controlling IS-IS Route Selection
7.9 Controlling IS-IS Route Exchange
7.10 Configuring IS-IS Route Summarization
7.11 Controlling IS-IS Route Convergence
7.12 Configuring LSP Fragment Extension
7.13 Configuring a Mesh Group on an NBMA Network
7.14 Configuring IS-IS Reliability
7.15 Configuring IPv4 IS-IS Auto FRR
7.16 Configuring the Overload Bit for an IS-IS Device
7.17 Configuring IS-IS Neighbor Relationship Flapping Suppression
7.18 Maintaining IS-IS
7.19 Configuration Examples for IPv4 IS-IS
7.20 Troubleshooting IPv4 IS-IS
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 473
7.1 Overview of IS-IS
Definition
Intermediate System-to-Intermediate System (IS-IS) is an Interior Gateway
Protocol (IGP) that runs within an autonomous system (AS). IS-IS is also a link-
state routing protocol, using the shortest path first (SPF) algorithm to calculate
routes.
Purpose
IS-IS is a dynamic routing protocol initially designed by the International
Organization for Standardization (ISO) for its Connectionless Network Protocol
(CLNP).
To support IP routing, the Internet Engineering Task Force (IETF) extended and
modified IS-IS in RFC 1195. This modification enables IS-IS to apply to TCP/IP and
OSI environments. This type of IS-IS is called Integrated IS-IS or Dual IS-IS.
NOTE
IS-IS stated in this document refers to Integrated IS-IS, unless otherwise stated.
In addition to IPv4 networks, IS-IS also applies to IPv6 networks to provide
accurate routing information for IPv6 packets. IS-IS has good scalability, supports
IPv6 network layer protocols, and is capable of discovering, generating, and
forwarding IPv6 routes.
7.2 Understanding IS-IS
7.2.1 Basic Concepts of IS-IS
IS-IS Topology Structure
Overall IS-IS Topology
IS-IS uses a two-level hierarchy (backbone area and non-backbone area) to
support large-scale routing networks. Generally, Level-1 routers are deployed in
non-backbone areas, whereas Level-2 and Level-1-2 routers are deployed in
backbone areas. Each non-backbone area connects to the backbone area through
a Level-1-2 router.
Figure 7-1 shows a network that runs IS-IS. The network is similar to an OSPF
network topology with multiple areas. The backbone area contains all the routers
in Area 1 and Level-1-2 routers in other areas.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 474
Figure 7-1 IS-IS topology I
Figure 7-2 shows another type of IS-IS topology. In this topology, Level-2 routers
belong to different areas. All the physically contiguous Level-1-2 and Level-2
routers form the backbone area of IS-IS.
Figure 7-2 IS-IS topology II
The two types of topologies show the differences between IS-IS and OSPF:
● In IS-IS, each router belongs to only one area. In OSPF, different interfaces of
a router may belong to different areas.
● In IS-IS, no area is defined as the backbone area. In OSPF, Area 0 is defined as
the backbone area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 475
● In IS-IS, Level-1 and Level-2 routes are calculated using the SPF algorithm to
generate the shortest path tree (SPT). In OSPF, the SPF algorithm is used only
in the same area, and inter-area routes are forwarded by the backbone area.
IS-IS Router Types
● Level-1 router
A Level-1 router manages intra-area routing. It establishes neighbor
relationships with only the Level-1 and Level-1-2 routers in the same area and
maintains a Level-1 link state database (LSDB). The LSDB contains intra-area
routing information. A packet to a destination outside this area is forwarded
to the nearest Level-1-2 router.
● Level-2 router
A Level-2 router manages inter-area routing. It can establish neighbor
relationships with Level-2 or Level-1-2 routers in different areas and
maintains a Level-2 LSDB. The LSDB contains inter-area routing information.
All Level-2 routers form the backbone network of the routing domain. They
establish Level-2 neighbor relationships and are responsible for inter-area
communication. Level-2 routers in the routing domain must be physically
contiguous to ensure the continuity of the backbone network. Only Level-2
routers can exchange data packets or routing information with routers outside
the routing domain.
● Level-1-2 router
A router that belongs to both a Level-1 area and a Level-2 area is called a
Level-1-2 router. It can establish Level-1 neighbor relationships with Level-1
and Level-1-2 routers in the same area. It can also establish Level-2 neighbor
relationships with Level-2 and Level-1-2 routers in different areas. A Level-1
router must be connected to other areas through a Level-1-2 router.
A Level-1-2 router maintains two LSDBs: a Level-1 LSDB and a Level-2 LSDB.
The Level-1 LSDB saves for intra-area routing and the Level-2 LSDB saves for
inter-area routing.
IS-IS Network Types
IS-IS supports only two types of networks. In terms of physical links, IS-IS
networks can be classified into the following link types:
● Broadcast: such as Ethernet and Token-Ring
● Point-to-point: such as PPP and HDLC
NOTE
IS-IS cannot run on Point to MultiPoint (P2MP) networks.
DIS and Pseudonode
In a broadcast network, IS-IS needs to elect a Designated Intermediate System
(DIS) from all the routers. DISs are used to create and update pseudonodes and
generate link state protocol data units (LSPs) of pseudonodes to describe available
network devices.
The pseudonode is used to simulate a virtual node in the broadcast network and is
not an actual router. In IS-IS, a pseudonode is identified by the system ID of the
DIS and the 1-byte Circuit ID (its value is not 0).
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 476
Figure 7-3 Pseudonode
As shown in Figure 7-3, the use of pseudonodes simplifies the network topology
and shortens LSPs. When the network changes, the number of generated LSPs is
reduced, and the SPF consumes fewer resources.
Level-1 and Level-2 DISs are elected separately. You can configure different
priorities for DISs of different levels. The router with the highest priority is elected
as the DIS. If there are multiple routers with the same highest priority on a
broadcast network, the one with the highest MAC address is chosen. The DISs of
different levels can be the same router or different routers.
DIS election in IS-IS differs from designated router (DR) election in OSPF:
● On an IS-IS broadcast network, the router with priority 0 also takes part in
DIS election. In OSPF, the router with priority 0 does not take part in DR
election.
● In IS-IS, when a new router that meets the requirements of being a DIS
connects to a broadcast network, the router is elected as the new DIS, and
the previous pseudonode is deleted. This causes a new flooding of LSPs. In
OSPF, when a new router connects to a network, it is not immediately elected
as the DR even if it has the highest DR priority.
● On an IS-IS broadcast network, routers (including non-DIS routers) of the
same level on a network segment set up adjacencies. In OSPF, routers set up
adjacencies with only the DR and backup designated router (BDR).
NOTE
On an IS-IS broadcast network, although all the routers set up adjacencies with each other,
the LSDBs are synchronized by the DISs.
IS-IS Address Structure
The network service access point (NSAP) is an address defined by the OSI to
locate resources. Figure 7-4 shows the NSAP address structure. The NSAP is
composed of the initial domain part (IDP) and the domain specific part (DSP). The
lengths of the IDP and the DSP are variable. The maximum length of the NSAP is
20 bytes and its minimum length is 8 bytes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 477
● The IDP is similar to the network ID in an IP address. It is defined by the ISO
and consists of the authority and format identifier (AFI) and the initial
domain identifier (IDI). The AFI indicates the address allocation authority and
address format, and the IDI identifies a domain.
● The DSP is similar to the subnet ID and host address in an IP address. The
DSP consists of the High Order DSP (HODSP), system ID, and NSAP Selector
(SEL). The HODSP is used to divide areas, the system ID identifies a host, and
the SEL indicates the service type.
Figure 7-4 IS-IS address structure
● Area Address
The IDP and the HODSP of the DSP identify a routing domain and the areas
in a routing domain. Therefore, the combination of the IDP and HODSP is
called an area address, which is similar to an area number in OSPF. The area
addresses of routers in the same Level-1 area must be the same, while the
area addresses of routers in the Level-2 area can be different.
In general, a router can be configured with only one area address. The area
address of all nodes in an area must be the same. In the implementation of a
device, an IS-IS process can be configured with a maximum of three area
addresses to support seamless combination, division, and transformation of
areas.
● System ID
A system ID uniquely identifies a host or a router in an area. In the device, the
fixed length of the system ID is 48 bits (6 bytes).
In actual applications, a router ID corresponds to a system ID. If a router takes
the IP address 192.168.1.1 of Loopback 0 as its router ID, its system ID used in
IS-IS can be obtained in the following way:
– Extend each part of IP address 192.168.1.1 to 3 bits and add 0 to the
front of any part that is shorter than 3 bits. Then the IP address is
extended as 192.168.001.001.
– Divide the extended address 192.168.001.001 into three parts, each of
which consists of four decimal digits. Then system ID 1921.6800.1001 is
obtained.
You can specify a system ID in many ways. You need to ensure that the
system ID uniquely identifies a host or a router.
● SEL
The role of an SEL is similar to that of the "protocol identifier" of IP. A
transport protocol matches an SEL. The SEL is always "00" in IP.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 478
A Network Entity Title (NET) indicates the network layer information of an IS
itself and consists of an area ID and a system ID. It does not contain the transport
layer information (SEL = 0). A NET can be regarded as a special NSAP. The length
of the NET field is the same as that of an NSAP. Its maximum length is 20 bytes
and its minimum length is 8 bytes. When configuring IS-IS on a router, you can
configure only a NET instead of an NSAP.
Assume that there is a NET: ab.cdef.1234.5678.9abc.00. In the NET, the area
address is ab.cdef, the system ID is 1234.5678.9abc, and the SEL is 00.
IS-IS PDU Types
IS-IS PDUs include Hello PDUs, link state PDUs (LSPs), and sequence number
PDUs (SNPs).
● Hello PDU
Hello packets, also called IS-IS Hello PDUs (IIH), are used to set up and
maintain neighbor relationships. Among them, Level-1 LAN IIHs apply to the
Level-1 routers on broadcast LANs; Level-2 LAN IIHs apply to the Level-2
routers on broadcast LANs; and P2P IIHs apply to non-broadcast networks.
Hello packets on different networks have different formats. Compared to a
LAN IIH, a P2P IIH does not have the Priority and LAN ID fields, but has a
Local Circuit ID field. The Priority field indicates the DIS priority on a
broadcast network, the LAN ID field indicates the system ID of the DIS and
pseudonode, and the Local Circuit ID indicates the local link ID.
● LSP
LSPs are used to exchange link-state information. There are two types of LSPs:
Level-1 and Level-2. Level-1 IS-IS transmits Level-1 LSPs; Level-2 IS-IS
transmits Level-2 LSPs; and Level-1-2 IS-IS can transmit both Level-1 and
Level-2 LSPs.
The meanings of major fields in an LSP are as follows:
– ATT field: When a Level-1-2 IS-IS transmits Level-1 LSPs in a Level-1 area,
Level-1 IS-IS in the area can communicate with devices in other areas
through the Level-1-2 IS-IS if the ATT bit is set in the Level-1 LSPs.
– OL field: indicates the LSDB overload.
LSPs with the overload bit are still flooded on the network, but these
LSPs are ignored during the calculation of the routes that pass through a
router in overload state. After the overload bit is set on a router, other
routers ignore the router when performing SPF calculation and consider
only the direct routes of the router.
– IS Type field: indicates the type of IS-IS that generates the LSP. The value
01 indicates Level-1, and the value 11 indicates Level-2.
● SNP
SNPs describe the LSPs in all or some databases to help synchronize and
maintain all LSDBs.
SNPs include complete SNPs (CSNPs) and partial SNPs (PSNPs). They are
further classified into Level-1 CSNPs, Level-2 CSNPs, Level-1 PSNPs, and
Level-2 PSNPs.
A CSNP contains the summary of all LSPs in an LSDB. This maintains LSDB
synchronization between neighboring routers. On a broadcast network, the
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 479
DIS periodically sends CSNPs. The default interval for sending CSNPs is 10
seconds. On a point-to-point link, CSNPs are sent only when the neighbor
relationship is established for the first time.
A PSNP lists only the sequence number of recently received LSPs. A PSNP can
acknowledge multiple LSPs at one time. If an LSDB is not updated, the PSNP
is also used to request a neighbor to send a new LSP.
The variable length fields in an IS-IS PDU are multiple type-length-values (TLVs).
Figure 7-5 shows the TLV format. A TLV is also called a code-length-value (CLV).
Figure 7-5 TLV format
TLVs vary according to PDU types, as shown in Table 7-1.
Table 7-1 PDU types and TLV names
TLV Type Name Applied PDU Type
1 Area Addresses IIH, LSP
2 IS Neighbors (LSP) LSP
4 Partition Designated Level2 IS L2 LSP
6 IS Neighbors (MAC Address) LAN IIH
7 IS Neighbors (SNPA Address) LAN IIH
8 Padding IIH
9 LSP Entries SNP
10 Authentication Information IIH, LSP, SNP
128 IP Internal Reachability Information LSP
129 Protocols Supported IIH, LSP
130 IP External Reachability Information LSP
131 Inter-Domain Routing Protocol
Information
L2 LSP
132 IP Interface Address IIH, LSP
TLVs with the type value ranging from 1 to 10 are defined in ISO 10589, and the
other TLVs are defined in RFC 1195.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 480
7.2.2 IS-IS Fundamentals
IS-IS is a link-state routing protocol. Each router generates an LSP that contains
link state information about all the IS-IS interfaces on the router. The router can
establish IS-IS neighbor relationships with neighboring devices and update its
LSDB to synchronize the local LSDB with the LSDBs of all the other devices on the
IS-IS network. Based on the local LSDB, the router uses the SPF algorithm to
calculate IS-IS routes. If the router finds that an IS-IS route is the optimal route to
a destination, the router adds the route to the local IP routing table to guide
packet forwarding.
Establishment of IS-IS Neighbor Relationship
Two IS-IS routers need to establish a neighbor relationship before exchanging
packets to implement routing. On different networks, the modes for establishing
IS-IS neighbors are different.
● Establishment of a neighbor relationship on a broadcast link
Figure 7-6 uses Level-2 routers as an example to describe the process of
establishing a neighbor relationship on a broadcast link. The process of
establishing a neighbor relationship between Level-1 routers is the same as
the process of establishing a neighbor relationship between Level-2 routers.
Figure 7-6 Process of establishing a neighbor relationship on a broadcast link
a. RouterA broadcasts a Level-2 LAN IS-IS Hello PDU (IIH) with no neighbor
ID specified.
b. RouterB receives this packet and sets the status of the neighbor
relationship with RouterA to Initial. RouterB then responds to RouterA
with a Level-2 LAN IIH, indicating that RouterA is a neighbor of RouterB.
c. RouterA receives this packet and sets the status of the neighbor
relationship with RouterB to Up. RouterA then sends RouterB a Level-2
LAN IIH indicating that RouterB is a neighbor of RouterA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 481
d. RouterB receives this packet and sets the status of the neighbor
relationship with RouterA to Up. RouterA and RouterB establish a
neighbor relationship successfully.
The network is a broadcast network, so a DIS needs to be elected. After the
neighbor relationship is established, routers wait for two intervals before
sending Hello packets to elect the DIS. The IIH packets exchanged by the
routers contain the Priority field. The router with the highest priority is elected
as the DIS. If the routers have the same priority, the router with the largest
interface MAC address is elected as the DIS.
● Establishment of a neighbor relationship on a P2P link
Unlike the establishment of a neighbor relationship on a broadcast link, the
establishment of a neighbor relationship on a P2P link is classified into two
modes: two-way mode and three-way mode.
– Two-way mode
Upon receiving a P2P IIH from a neighbor, a router considers the
neighbor Up and establishes a neighbor relationship with the neighbor.
– Three-way mode
A neighbor relationship is established after P2P IIHs are sent three times.
The establishment of a neighbor relationship on a P2P link is similar to
that on a broadcast link.
The two-way mode has distinct disadvantages. For example, when two or
more links exist between two routers, the two routers can still establish a
neighbor relationship if one link is Down and the other is Up in the same
direction. The parameters of the link in Up state are used in SPF calculation.
As a result, the router that does not detect the fault of the link in Down state
still tries to forward packets over this link. The three-way mode addresses
such problems on unreliable P2P links. In three-way mode, a router considers
the neighbor Up only after confirming that the neighbor receives the packet
sent by it, and then establishes a neighbor relationship with the neighbor.
Basic rules for establishing an IS-IS neighbor relationship are as follows:
● Only neighboring routers of the same level can set up the neighbor
relationship with each other.
● Level-1 routers must have the same area IDs.
● Network types of IS-IS interfaces on both ends of a link must be consistent.
NOTE
Ethernet interfaces can be simulated as P2P interfaces to establish a neighbor
relationship on a P2P link.
● IP addresses of IS-IS interfaces on both ends of a link must be on the same
network segment.
IS-IS runs on the data-link layer and was initially designed for CLNP.
Therefore, the establishment of IS-IS neighbor relationships is not related to
IP addresses. In the implementation of a device, IS-IS runs only over IP.
Therefore, IS-IS needs to check the IP address of its neighbor. If secondary IP
addresses are assigned to the interfaces, the routers can still set up the IS-IS
neighbor relationship, but only when either the primary IP addresses or
secondary IP addresses are on the same network segment.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 482
NOTE
When IP addresses of IS-IS interfaces on both ends of a link are on different network
segments, a neighbor relationship can still be established on the two interfaces if the
interfaces are configured not to check the IP addresses in received Hello packets. You
can configure P2P interfaces not to check the IP addresses in received Hello packets.
Before configuring Ethernet interfaces not to check the IP addresses, simulate Ethernet
interfaces as P2P interfaces.
Process of Exchanging IS-IS LSPs
Causes of LSP generation
All routers in the IS-IS routing domain can generate LSPs. The following events
trigger the generation of a new LSP:
● Neighbor is Up or Down.
● Related interface goes Up or Down.
● Imported IP routes change.
● Inter-area IP routes change.
● Interface is assigned a new metric value.
● Periodic updates occur.
Processing of a new LSP received from a neighbor
1. The router installs the LSP to its LSDB and marks it for flooding.
2. The router sends the LSP to all interfaces except the interface that initially
received the LSP.
3. The neighbors flood the LSP to their neighbors.
LSP flooding
In LSP flooding, a router sends an LSP to its neighbors and then the neighbors
send the received LSP to their respective neighbors except the router that first
sends the LSP. In this manner, the LSP is flooded among the routers of the same
level. LSP flooding allows each router of the same level to have the same LSP
information and synchronize its LSDB with each other.
Each LSP has a 4-byte sequence number. When a router is started, the sequence
number of the first LSP sent by the router is 1. When a new LSP is generated, the
sequence number of the LSP is equal to the sequence number of the previous LSP
plus 1. Therefore, newer LSPs have larger sequence numbers.
Process of synchronizing LSDBs between a newly added router and DIS on a
broadcast link
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 483
Figure 7-7 Process of updating LSDBs on a broadcast link
In Figure 7-7
1. A new router (RouterC) sends a Hello packet to establish neighbor
relationships with the other routers in the broadcast domain.
2. RouterC establishes neighbor relationships with RouterA and RouterB, waits
for the timeout of the LSP refresh timer, and then sends its LSP to a multicast
address (01-80-C2-00-00-14 in a Level-1 area and 01-80-C2-00-00-15 in a
Level-2 area). All neighbors on the network can receive the LSP.
3. The DIS on the network segment adds the received LSP to its LSDB. After the
CSNP timer expires, the DIS sends CSNPs to synchronize the LSDBs on the
network.
4. RouterC receives the CSNPs from the DIS, checks its LSDB, and sends a PSNP
to request the LSPs it does not have.
5. The DIS receives the PSNP and sends RouterC the required LSPs for LSDB
synchronization.
The process of updating the LSDB of the DIS is as follows:
1. When the DIS receives an LSP, it searches the LSDB to check whether the
same LSP exists. If the DIS does not find the same LSP in its LSDB, the DIS
adds the LSP to its LSDB and broadcasts the content of the new LSDB.
2. If the sequence number of the received LSP is greater than that of the
corresponding LSP in the LSDB, the DIS replaces the existing LSP with the
received LSP and broadcasts the contents of the new LSDB. If the sequence
number of the received LSP is smaller than that of the corresponding LSP in
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 484
the LSDB, the DIS sends its LSP in the LSDB through the inbound interface of
the received LSP.
3. If the sequence number of the received LSP is the same as that of the
corresponding LSP in the LSDB, the DIS compares the remaining lifetime of
the two LSPs. If the remaining lifetime of the received LSP is smaller than that
of the corresponding LSP in the LSDB, the DIS replaces the existing LSP with
the received LSP and broadcasts the contents of the new LSDB. If the
remaining lifetime of the received LSP is greater than that of the
corresponding LSP, the DIS sends its LSP in the LSDB through the inbound
interface of the received LSP.
4. If the sequence number and remaining lifetime of the received LSP are the
same as those of the corresponding LSP in the LSDB, the DIS compares the
checksum of the two LSPs. If the checksum of the received LSP is greater than
that of the corresponding LSP in the LSDB, the DIS replaces the existing LSP
with the received LSP and broadcasts the content of the new LSDB. If the
checksum of the received LSP is smaller than that of the corresponding LSP,
the DIS sends its LSP in the LSDB through the inbound interface of the
received LSP.
5. If the sequence number, remaining lifetime, and checksum of the received LSP
are the same as those of the corresponding LSP in the LSDB, the DIS does not
forward the received LSP.
Process of synchronizing the LSDB on a P2P link
Figure 7-8 Process of updating LSDBs on a P2P link
1. RouterA establishes a neighbor relationship with RouterB.
2. RouterA and RouterB send a CSNP to each other. If the LSDB of the neighbor
and the received CSNP are not synchronized, the neighbor sends a PSNP to
request the required LSP.
3. Figure 7-8 assumes that RouterB requests the required LSP from RouterA.
RouterA sends the required LSP to RouterB, starts the LSP retransmission
timer, and waits for a PSNP from RouterB as an acknowledgement for the
received LSP.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 485
4. If RouterA does not receive a PSNP from RouterB after the LSP retransmission
timer expires, RouterA resends the LSP until it receives a PSNP from RouterB.
NOTE
A PSNP on a P2P link is used as:
● A request packet to acquire LSPs
● An ACK packet to acknowledge the received LSP
The process of updating LSDBs on a P2P link is as follows:
1. If the sequence number of the received LSP is greater than the sequence
number of the corresponding LSP in the LSDB, the router adds the LSP to its
LSDB. The router then sends a PSNP packet to acknowledge the received LSP.
At last, the router sends the LSP to all its neighbors except the neighbor that
sends the LSP.
2. If the sequence number of the received LSP is smaller than the sequence
number of the corresponding LSP, the router directly sends its LSP to the
neighbor and waits for a PSNP from the neighbor as the acknowledgement.
3. If the sequence number of the received LSP is the same as the sequence
number of the corresponding LSP in the LSDB, the router compares the
Remaining Lifetime of the two LSPs. If the Remaining Lifetime of the received
LSP is 0, the router adds the LSP to its LSDB. The router then sends a PSNP to
acknowledge the received LSP, and sends the LSP to all its neighbors except
the neighbor that sends the LSP. If the Remaining Lifetime of the received LSP
is not 0 but the corresponding LSP in the LSDB is 0, the router directly sends
its local LSP to the neighbor and waits for a PSNP from the neighbor.
4. If the sequence number of the received LSP and the corresponding LSP in the
LSDB are the same, and neither Remaining Lifetime is 0, router compares the
checksum of the two LSPs. If the received LSP has a greater checksum than
that of the corresponding LSP, the router adds the LSP to its LSDB. The router
then sends a PSNP to acknowledge the received LSP, and sends the LSP to all
its neighbors except the neighbor that sends the LSP. If the received LSP has a
smaller checksum than that of the corresponding LSP, the router directly
sends its local LSP to the neighbor and waits for a PSNP from the neighbor.
5. If the checksum of the received LSP and that of the corresponding LSP are the
same, the LSP is not forwarded.
7.2.3 IS-IS Authentication
To ensure network security, IS-IS authentication encrypts IS-IS packets by adding
an authentication field to packets. When a local router receives IS-IS packets from
a remote router, the local router discards the packets if the authentication
passwords do not match. This protects the local router.
Authentication Types
Based on the types of packets, authentication is classified as follows:
● Interface authentication: authenticates Level-1 and Level-2 Hello packets sent
and received on IS-IS interfaces using the specified authentication mode and
password.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 486
NOTE
You can configure a router to perform interface authentication in the following ways:
● A router sends authentication packets carrying the authentication TLV and verifies
the authentication information about the received packets.
● A router sends authentication packets carrying the authentication TLV but does not
verify the authentication information about the received packets.
● Area authentication: authenticates Level-1 LSPs and Level-1 SNPs transmitted
in an IS-IS area using the specified authentication mode and password.
● Routing domain authentication: authenticates Level-2 LSPs and Level-2 SNPs
transmitted in an IS-IS routing domain using the specified authentication
mode and password.
NOTE
In area authentication and routing domain authentication, you can configure a router
to authenticate LSPs and SNPs separately in the following ways:
● A router sends LSPs and SNPs carrying the authentication TLV and verifies the
authentication information about the received LSPs and SNPs.
● A router sends LSPs carrying the authentication TLV and verifies the authentication
information about the received LSPs. The router sends SNPs carrying the
authentication TLV but does not verify the authentication information about the
received SNPs.
● A router sends LSPs carrying the authentication TLV and verifies the authentication
information about the received LSPs. The router sends SNPs without the
authentication TLV and does not verify the authentication information about the
received SNPs.
● A router sends LSPs and SNPs carrying the authentication TLV but does not verify
the authentication information about the received LSPs and SNPs.
Based on the authentication modes of packets, authentication is classified into the
following types:
● Plain text authentication: is a simple authentication mode in which passwords
are directly added to packets. This authentication is insecure.
● MD5 authentication: uses the MD5 algorithm to encrypt passwords before
they are added to packets, which improves password security.
● Keychain authentication: further improves network security with configurable
key chain that changes with time.
● HMAC-SHA256 authentication: uses the HMAC-SHA256 algorithm to encrypt
a password before adding the password to a packet, which ensures high
password security.
NOTE
Simple authentication and MD5 authentication have potential security risks. HMAC-SHA256
or Keychain authentication mode is recommended.
Mode in Which Authentication Information Is Carried
IS-IS provides a TLV to carry authentication information, with the type of the TLV
specified as 10.
● Type: is defined by the ISO as 10, with a length of 1 byte.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 487
● Length: indicates the length of the authentication TLV, which is 1 byte.
● Value: indicates the authentication contents of 1 to 254 bytes, including the
authentication type and password.
The authentication type is 1 byte:
– Type 0 is reserved.
– Type 1 indicates plain text authentication.
– Type 54 indicates MD5 authentication.
– Type 255 indicates routing domain private authentication methods.
7.2.4 IS-IS Route Leaking
Normally, Level-1 routers manage routes in Level-1 areas. All Level-2 and
Level-1-2 routers form a contiguous backbone area. Level-1 areas can only
connect to the backbone area and cannot connect to each other.
A Level-1-2 router encapsulates learned Level-1 routing information into a Level-2
LSP and floods the Level-2 LSP to other Level-2 and Level-1-2 routers. Then
Level-1-2 and Level-2 routers know routing information about the entire IS-IS
routing domain. To reduce the size of routing tables, a Level-1-2 router, by default,
does not advertise the learned routing information of other Level-1 areas and the
backbone area to its Level-1 area. In this case, Level-1 routers do not know
routing information outside the local area. As a result, Level-1 routers cannot
select the optimal route to a destination outside the local area.
IS-IS route leaking can solve this problem. You can configure access control lists
(ACLs) and routing policies and mark routes with tags on Level-1-2 routers to
select eligible routes. Then a Level-1-2 router can advertise routing information of
other Level-1 areas and backbone area to its Level-1 area.
Figure 7-9 IS-IS route leaking
In Figure 7-9, RouterA sends a packet to RouterF. The selected optimal route
should be RouterA->RouterB->RouterD->RouterE->RouterF. This is because the
cost of this route is 50, which is smaller than the cost (70) of the other route
(RouterA->RouterC->RouterE->RouterF). However, when you check the route on
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 488
RouterA to view the path of the packets sent to RouterF, the selected route is
RouterA->RouterC->RouterE->RouterF but not the optimal route from RouterA to
RouterF.
RouterA (Level-1 router) does not know routes outside its area, so it sends packets
outside its area through the default route generated by the nearest Level-1-2
router. Therefore, the optimal route is not used to forward the packets.
If route leaking is enabled on Level-1-2 routers (RouterC and RouterD), Level-1
routers in Area 10 can know routes outside Area 10 and passing through the two
Level-1-2 routers. After route calculation, the forwarding path becomes RouterA-
>RouterB->RouterD->RouterE->RouterF, which is the optimal route from RouterA
to RouterF.
7.2.5 IS-IS Overload
IS-IS Overload allows a device to use the IS-IS overload bit to identify the overload
state. The IS-IS overload bit is the OL field in an IS-IS LSP. After the overload bit is
set on a device, other devices ignore this device when performing SPF calculation
and consider only the direct routes of the device.
Figure 7-10 IS-IS Overload
As shown in Figure 7-10, RouterB forwards the packets sent from RouterA to
network segment 10.1.1.0/24. If the overload bit in the LSP sent from RouterB is
set to 1, RouterA considers the LSDB of RouterB incomplete and sends packets to
10.1.1.0/24 through RouterD and RouterE. This process does not affect the packets
sent to the directly connected network segment of RouterB.
If a device cannot store new LSPs and fails to synchronize the LSDB, the routes
calculated by this device are incorrect. In this situation, the device enters the
overload state and does not calculate the routes passing through this device;
however, the direct routes of the device are still valid.
A device may enter the overload state because of device abnormalities or is
manually configured to enter the overload state. When an IS-IS device on the
network needs to be upgraded or maintained, isolate this device from the network
temporarily and set the overload bit on the device to prevent other devices from
using this device to forward traffic.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 489
NOTE
● If the system enters the overload state because of an abnormality, the system deletes all
the imported or leaked routes.
● If the system is configured to enter the overload state, the system determines whether
to delete all the imported or leaked routes based on the configuration.
7.2.6 IS-IS Network Convergence
Fast convergence and priority-based convergence can improve IS-IS network
convergence. Fast convergence speeds up network convergence by fast calculating
routes, while priority-based convergence sets different convergence priorities for
routes to improve network convergence.
Fast Convergence
IS-IS fast convergence is an extended feature of IS-IS that is implemented to speed
up the convergence of routes. Fast convergence includes the following:
● Incremental SPF (I-SPF): recalculates only the routes of the changed nodes
rather than all the nodes when the network topology changes. This speeds up
the calculation of routes.
In ISO 10589, the SPF algorithm is used to calculate routes. When a node
changes on the network, this algorithm is used to recalculate all routes. The
calculation takes a long time and consumes too many CPU resources,
affecting the convergence speed.
I-SPF improves this algorithm. Except for the first time, only changed nodes
instead of all nodes are involved in calculation. The shortest path tree (SPT)
generated is the same as that generated by the previous algorithm. This
decreases CPU usage and speeds up network convergence.
● Partial Route Calculation (PRC): calculates only the changed routes when the
routes on the network change.
Similar to I-SPF, PRC calculates only the changed routes, but it does not
calculate the shortest path. It updates routes based on the SPT calculated by
I-SPF.
In route calculation, a leaf represents a route, and a node represents a router.
If the SPT changes after I-SPF calculation, PRC processes all the leaves only on
the changed node. If the SPT remains unchanged, PRC processes only the
changed leaves. For example, if IS-IS is enabled on an interface of a node, the
SPT calculated by I-SPF remains unchanged. PRC updates only the routes of
this interface, consuming less CPU resources.
PRC working with I-SPF further improves the convergence performance of the
network. It is an improvement of the original SPF algorithm.
● Intelligent timer: applies to LSP generation and SPF calculation. The first
timeout period of the intelligent timer is fixed. Before the intelligent timer
expires, if an event that triggers the timer occurs, the next timeout period of
the intelligent timer increases.
Although the route calculation algorithm is improved, the long interval for
triggering route calculation affects the convergence speed. Frequent network
changes also consume too many CPU resources. The SPF intelligent timer
addresses both of these problems. In general, an IS-IS network is stable under
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 490
normal conditions. The probability of the occurrence of many network
changes is very minimal, and IS-IS does not calculate routes frequently. The
period for triggering the route calculation is very short (milliseconds). If the
topology of the network changes often, the intelligent timer increases the
route calculation interval to avoid too much CPU consumption. The original
mechanism uses a timer with uniform intervals, which makes fast
convergence and low CPU consumption impossible to achieve.
The LSP generation intelligent timer is similar to the SPF intelligent timer.
When the LSP generation intelligent timer expires, the system generates a
new LSP based on the current topology. The LSP generation timer is designed
as an intelligent timer to respond to emergencies (such as the interface is Up
or Down) quickly and speed up the network convergence.
● LSP fast flooding: speeds up the flooding of LSPs.
In most cases, when an IS-IS router receives new LSPs from other routers, it
updates the LSPs in its LSDB and periodically floods the updated LSPs
according to a timer.
LSP fast flooding speeds up LSDB synchronization because it allows a device
to flood fewer LSPs than the specified number before route calculation when
the device receives one or more new LSPs. This mechanism also speeds up
network convergence.
Priority-based Convergence
Priority-based IS-IS convergence ensures that specific routes are converged first
when a great number of routes need to be converged. You can assign a high
convergence priority to routes for key services so that these routes are converged
quickly. This reduces the impact of route convergence on key services. Different
routes can be set with different convergence priorities so that important routes
can be converged first. This improves network reliability.
7.2.7 IS-IS Neighbor Relationship Flapping Suppression
IS-IS neighbor relationship flapping suppression works by delaying IS-IS neighbor
relationship reestablishment or setting the link cost to the maximum value
(16777214 in IS-IS wide mode and 63 in IS-IS narrow mode).
Background
If the status of an interface carrying IS-IS services alternates between Up and
Down, IS-IS neighbor relationship flapping occurs on the interface. During the
flapping, IS-IS frequently sends Hello packets to reestablish the neighbor
relationship, synchronizes LSDBs, and recalculates routes. In this process, a large
number of packets are exchanged, adversely affecting neighbor relationship
stability, IS-IS services, and other IS-IS-dependent services, such as LDP and BGP.
IS-IS neighbor relationship flapping suppression can address this problem by
delaying IS-IS neighbor relationship reestablishment or preventing service traffic
from passing through flapping links.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 491
Related Concepts
Flapping_event: reported when the status of a neighbor relationship on an
interface last changes from Up to Init or Down. The flapping_event triggers
flapping detection.
Flapping_count: number of times flapping has occurred.
Detect-interval: interval at which flapping is detected. The interval is used to
determine whether to trigger a valid flapping_event.
Threshold: flapping suppression threshold. When the flapping_count reaches or
exceeds threshold, flapping suppression takes effect.
Resume-interval: interval used to determine whether flapping suppression exits. If
the interval between two valid flapping_events is longer than the resume-interval,
flapping suppression exits.
Implementation
Flapping detection
IS-IS interfaces start a flapping counter. If the interval between two
flapping_events is shorter than the detect-interval, a valid flapping_event is
recorded, and the flapping_count is incremented by 1. When the flapping_count
exceeds the threshold, the system determines that flapping occurs, and therefore
triggers flapping suppression, and sets the flapping_count to 0. If the interval
between two valid flapping_events is longer than the resume-interval before the
flapping_count reaches the threshold again, the system sets the flapping_count to
0 again. Interfaces start the suppression timer when the status of a neighbor
relationship last changes to Init or Down.
The detect-interval, threshold, and resume-interval are configurable.
Flapping suppression
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes
during neighbor relationship establishment, interfaces prevent neighbor
relationships from being reestablished during the suppression period, which
minimizes LSDB synchronization attempts and packet exchanges.
● Hold-max-cost mode: If the traffic forwarding path changes frequently,
interfaces use the maximum cost of the flapping link during the suppression
period, which prevents traffic from passing through the flapping link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode.
By default, the Hold-max-cost mode takes effect. The mode and suppression
period can be changed manually.
NOTE
When an interface enters the flapping suppression state, all neighbor relationships on the
interface enter the state accordingly.
Exiting from flapping suppression
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 492
Interfaces exit from flapping suppression in the following scenarios:
● The suppression timer expires.
● The corresponding IS-IS process is reset.
● A command is run to exit from flapping suppression.
● Three Hello packets in which the padding TLV carries a sub-TLV with the value
being 251 are sent consecutively to notify the peer device to forcibly exit
flapping suppression.
Typical Scenarios
Basic scenario
In Figure 7-11, the traffic forwarding path is Device A -> Device B -> Device C ->
Device E before a link failure occurs. After the link between Device B and Device C
fails, the forwarding path switches to Device A -> Device B -> Device D -> Device
E. If the neighbor relationship between Device B and Device C frequently flaps at
the early stage of the path switchover, the forwarding path will be switched
frequently, causing traffic loss and affecting network stability. If the neighbor
relationship flapping meets suppression conditions, flapping suppression takes
effect.
● If flapping suppression works in Hold-down mode, the neighbor relationship
between Device B and Device C is prevented from being reestablished during
the suppression period, in which traffic is forwarded along the path Device A -
> Device B -> Device D -> Device E.
● If flapping suppression works in Hold-max-cost mode, the maximum cost is
used as the cost of the link between Device B and Device C during the
suppression period, and traffic is forwarded along the path Device A -> Device
B -> Device D -> Device E.
Figure 7-11 Flapping suppression in a basic scenario
Single-forwarding path scenario
When only one forwarding path exists on the network, the flapping of the
neighbor relationship between any two devices on the path will interrupt traffic
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 493
forwarding. In Figure 7-12, the traffic forwarding path is Device A -> Device B ->
Device C -> Device E. If the neighbor relationship between Device B and Device C
flaps, and the flapping meets suppression conditions, flapping suppression takes
effect. However, if the neighbor relationship between Device B and Device C is
prevented from being reestablished, the whole network will be divided. Therefore,
Hold-max-cost mode (rather than Hold-down mode) is recommended. If flapping
suppression works in Hold-max-cost mode, the maximum cost is used as the cost
of the link between Device B and Device C during the suppression period. After the
network stabilizes and the suppression timer expires, the link is restored.
NOTE
By default, the Hold-max-cost mode takes effect.
Figure 7-12 Flapping suppression in a single-forwarding path scenario
Broadcast scenario
In Figure 7-13, four devices are deployed on the same broadcast network using
switches, and the devices are broadcast network neighbors. If Device C flaps due
to a link failure, and Device A and Device B were deployed at different time
(Device A was deployed earlier for example) or the flapping suppression
parameters on Device A and Device B are different, Device A first detects the
flapping and suppresses Device C. Consequently, the Hello packets sent by Device
A do not carry Device C's router ID. However, Device B has not detected the
flapping yet and still considers Device C a valid node. As a result, the DIS
candidates identified by Device A are Device B and Device D, whereas the DIS
candidates identified by Device B are Device A, Device C, and Device D. Different
DIS candidates result in a different DIS election result, which may lead to route
calculation errors. To prevent this problem in scenarios where an interface has
multiple neighbors, such as on a broadcast, P2MP, or NBMA network, all
neighbors on the interface are suppressed when the status of a neighbor
relationship last changes to Init or Down. Specifically, if Device C flaps, Device A,
Device B, and Device D on the broadcast network are all suppressed. After the
network stabilizes and the suppression timer expires, Device A, Device B, and
Device D are restored to normal status.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 494
Figure 7-13 Flapping suppression on a broadcast network
Scenario of multi-level networking
In Figure 7-14, Device A, Device B, Device C, Device E, and Device F are connected
on Level 1 (Area 1), and Device B, Device D, and Device E are connected on Level
2 (Area 0). Traffic from Device A to Device F is preferentially forwarded along an
intra-area route, and the forwarding path is Device A -> Device B -> Device C ->
Device E -> Device F. When the neighbor relationship between Device B and
Device C flaps and the flapping meets suppression conditions, flapping suppression
takes effect in the default mode (Hold-max-cost). Consequently, the maximum
cost is used as the cost of the link between Device B and Device C. However, the
forwarding path remains unchanged because intra-area routes take precedence
over inter-area routes during route selection according to IS-IS route selection
rules. To prevent traffic loss in multi-area scenarios, configure Hold-down mode to
prevent the neighbor relationship between Device B and Device C from being
reestablished during the suppression period. During this period, traffic is forwarded
along the path Device A -> Device B -> Device D -> Device E -> Device F.
NOTE
By default, the Hold-max-cost mode takes effect. The mode can be changed to Hold-down
manually.
Figure 7-14 Flapping suppression in a multi-area scenario
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 495
Scenario with both LDP-IGP synchronization and IS-IS neighbor relationship
flapping suppression configured
In Figure 7-15, if the link between PE1 and P1 fails, an LDP LSP switchover is
implemented immediately, causing the original LDP LSP to be deleted before a
new LDP LSP is established. To prevent traffic loss, LDP-IGP synchronization needs
to be configured. With LDP-IGP synchronization, the maximum cost is used as the
cost of the new LSP to be established. After the new LSP is established, the
original cost takes effect. Consequently, the original LSP is deleted, and LDP traffic
is forwarded along the new LSP.
LDP-IGP synchronization and IS-IS neighbor relationship flapping suppression work
in either Hold-down or Hold-max-cost mode. If both functions are configured,
Hold-down mode takes precedence over Hold-max-cost mode, followed by the
configured link cost. Table 7-2 lists the suppression modes that take effect in
different situations.
Table 7-2 Principles for selecting the suppression modes that take effect in
different situations
LDP-IGP
Synchronization/
IS-IS Neighbor
Relationship
Flapping
Suppression
Mode
LDP-IGP
Synchronization
Hold-down Mode
LDP-IGP
Synchronization
Hold-max-cost
Mode
Exited from LDP-
IGP
Synchronization
Suppression
IS-IS Neighbor
Relationship
Flapping
Suppression Hold-
down Mode
Hold-down Hold-down Hold-down
IS-IS Neighbor
Relationship
Flapping
Suppression Hold-
max-cost Mode
Hold-down Hold-max-cost Hold-max-cost
Exited from IS-IS
Neighbor
Relationship
Flapping
Suppression
Hold-down Hold-max-cost Exited from LDP-
IGP
synchronization
and IS-IS neighbor
relationship
flapping
suppression
For example, the link between PE1 and P1 frequently flaps in Figure 7-15, and
both LDP-IGP synchronization and IS-IS neighbor relationship flapping suppression
are configured. In this case, the suppression mode is selected based on the
preceding principles. No matter which mode (Hold-down or Hold-max-cost) is
selected, the forwarding path is PE1 -> P4 -> P3 -> PE2.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 496
Figure 7-15 Scenario with both LDP-IGP synchronization and IS-IS neighbor
relationship flapping suppression configured
Scenario with both bit-error-triggered protection switching and IS-IS neighbor
relationship flapping suppression configured
If a link has poor link quality, services transmitted along it may be adversely
affected. If bit-error-triggered protection switching is configured and the bit error
rate (BER) along a link exceeds a specified value, a bit error event is reported, and
the maximum cost is used as the cost of the link, triggering route reselection.
Consequently, service traffic is switched to the backup link. If both bit-error-
triggered protection switching and IS-IS neighbor relationship flapping suppression
are configured, they both take effect. Hold-down mode takes precedence over
Hold-max-cost mode, followed by the configured link cost.
Scenario with both Link-bundle and IS-IS neighbor relationship flapping
suppression configured
When the service traffic rate exceeds the capacity of the link, multiple links must
be used. If one of the links between two devices is faulty, traffic is switched to
another link. Because of limited forwarding capacity on the new link, excessive
traffic is discarded. If the number of faulty links reaches the upper threshold, the
maximum cost is used as the cost of all links in the link bundle to switch all
service traffic to the backup nodes. When both link-bundle and neighbor
relationship flapping suppression are configured, if the number of flapping links
reaches the upper threshold, the maximum cost must be configured as the cost of
all other links in the link bundle to prevent service loss caused by user traffic
congestion. As shown in Figure 7-16, two parallel links exist between Device A
and Device C. If Link 1 is faulty and Link 2 bears all service traffic, traffic loss
occurs. If both link-bundle and neighbor relationship flapping suppression are
configured and Link 1 flaps, the maximum cost must be configured for Link 2 to
avoid service traffic congestion. Only the Hold-max-cost mode therefore can be
configured for neighbor relationship flapping suppression to switch the traffic
forwarding path to Device A->Device B->Device C.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 497
Figure 7-16 Scenario with both Link-bundle and IS-IS neighbor relationship
flapping suppression configured
7.2.8 IS-IS Administrative Tag
Administrative tags control the advertisement of IP prefixes in an IS-IS routing
domain to simplify route management. You can use administrative tags to control
the import of routes of different levels and different areas and control IS-IS multi-
instances running on the same router.
Figure 7-17 IS-IS networking
In Figure 7-17, RouterA in Area 4 needs to communicate with devices in other
Level-1 areas, including RouterB in Area 5, RouterC in Area 3, and RouterD in Area
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 498
2. To ensure information security, it is required that other routers in Level-1 areas
(Areas 2, 3, and 5) should not receive the packets sent from RouterA. To meet this
requirement, configure the same administrative tag for IS-IS interfaces on RouterB,
RouterC, and RouterD and configure the Level-1-2 router in Area 4 to leak only
the routes matching the configured administrative tag from Level-2 to Level-1
areas. This allows RouterA to communicate with only RouterB, RouterC, and
RouterD when communicating with devices in Level-1 areas. Figure 7-18 shows
the topology formed on RouterA.
Figure 7-18 IS-IS administrative tag application
The value of an administrative tag is associated with certain attributes. If the cost-
style is wide, wide-compatible or compatible, when IS-IS advertises an IP address
prefix with these attributes, IS-IS adds the administrative tag to the TLV in the
prefix. The tag is flooded along with the prefix throughout the routing domain.
7.2.9 IS-IS Wide Metric
In ISO 10589, the maximum IS-IS interface metric value can only be 63 and the IS-
IS cost style is narrow. A small range of metrics cannot meet the requirements on
large-scale networks. Therefore, in RFC 3784, the maximum IS-IS interface metric
value can reach 16777215, and the maximum IS-IS route metric value can reach
4261412864; in this case, the IS-IS cost style is wide.
● The following lists the TLVs used in narrow mode:
– TLV 128 (IP Internal Reachability TLV): carries IS-IS routes in a routing
domain.
– TLV 130 (IP External Reachability TLV): carries IS-IS routes outside a
routing domain.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 499
– TLV 2 (IS Neighbors TLV): carries neighbor information.
● The following lists the TLVs used in wide mode:
– TLV 135 (Extended IP Reachability TLV): replaces the earlier IP
reachability TLV and carries IS-IS routing information. This TLV expands
the route metric and carries sub-TLVs.
– TLV 22 (IS Extended Neighbors TLV): carries neighbor information.
Table 7-3 lists the cost styles of received and sent IS-IS routing information. The
cost styles of received and sent IS-IS routing information vary according to the
cost style configured on a device.
Table 7-3 Cost styles of received and sent IS-IS routing information
Cost Style Configured
on a Device
Cost Style for
Received IS-IS Routing
Information
Cost Style for Sent IS-IS
Routing Information
narrow narrow narrow
narrow-compatible narrow&wide narrow
compatible narrow&wide narrow&wide
wide-compatible narrow&wide wide
wide wide wide
NOTE
When the cost-style is set to compatible, IS-IS sends the information in narrow mode and in
wide mode respectively.
IS-IS in wide mode and IS-IS in narrow mode cannot communicate. If IS-IS in wide mode
and IS-IS in narrow mode need to communicate, you must change the mode to enable all
routers on the network to receive packets sent by other routers.
7.2.10 IS-IS LSP Fragment Extension
When an IS-IS router needs to advertise the LSPs that contain much information,
the IS-IS router generates multiple LSP fragments to carry more IS-IS information.
IS-IS LSP fragments are identified by the LSP Number field in their LSP IDs. This
field is of 1 byte. An IS-IS process can generate a maximum of 256 LSP fragments;
therefore, only a limited number of routes can be carried.
As defined in RFC 3786, virtual system IDs can be configured and virtual LSPs that
carry routing information can be generated for IS-IS.
Concepts
● Originating system: is a router that runs the IS-IS protocol. A single IS-IS
process can function as multiple virtual routers to advertise LSPs, and the
originating system refers to the IS-IS process.
● Normal System-ID: is the system ID of the originating system.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 500
● Virtual System: is the system identified by the additional system ID to
generate extended LSP fragments. These fragments carry additional system
IDs in their LSP IDs.
● Additional System-ID: is assigned by network administrators to identify a
virtual system. A maximum of 256 extended LSP fragments can be generated
for each additional system ID.
NOTE
Like a normal system ID, an additional system ID must be unique in a routing domain.
● TLV 24 (IS Alias ID TLV): describes the relationship between the originating
system and virtual system.
Principles
In IS-IS, each system ID identifies a system, which can generate a maximum of
256 LSP fragments. With more additional system IDs (up to 50 virtual systems can
be configured), an IS-IS process can generate a maximum of 13,056 LSP
fragments.
After LSP fragment extension is configured, the system prompts you to restart the
IS-IS process if information is lost because LSPs overflow. After being restarted, the
originating system loads as much routing information to LSPs, adds the
overloaded information to the LSPs of the virtual system for transmission, and
uses TLV 24 to notify other routers of its relationship with the virtual system.
Operating Modes
An IS-IS router can run the LSP fragment extension feature in two modes.
Figure 7-19 IS-IS LSP fragment extension
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 501
O
pe
rat
in
g
M
od
e
Usag
e
Scen
ario
Principles Example Precautions
M
od
e-
1
Some
route
rs on
the
netw
ork
do
not
suppo
rt LSP
fragm
ent
exten
sion.
Virtual systems
participate in SPF
calculation. The
originating system
advertises LSPs
containing
information about
links to each virtual
system. Similarly,
each virtual system
advertises LSPs
containing
information about
links to the
originating system.
Virtual systems look
like the physical
routers that connect
to the originating
system.
Mode-1 is a
transitional mode
for the earlier
versions that do not
support LSP
fragment extension.
In earlier versions,
IS-IS cannot identify
the IS Alias ID TLV
and processes the
received LSP that is
advertised by a
virtual system as an
LSP advertised by an
IS-IS process.
In Figure 7-19,
RouterB does not
support LSP
fragment extension,
and RouterA is
configured to
support LSP
fragment extension
in mode-1. RouterA1
and RouterA2 are
virtual systems of
RouterA and send
LSPs carrying some
routing information
of RouterA. After
receiving LSPs from
RouterA, RouterA1,
and RouterA2,
RouterB considers
that there are three
individual routers at
the remote end and
calculates routes.
Because the cost of
the route from
RouterA to RouterA1
and the cost of the
route from RouterA
to RouterA2 are
both 0, the cost of
the route from
RouterB to RouterA
is the same as the
cost of the route
from RouterB to
RouterA1.
The LSP sent by a
virtual system
contains the same
area address and
overload bit as
those in a common
LSP. If the LSPs sent
by a virtual system
contain TLVs
specified in other
features, these TLVs
must be the same as
those in common
LSPs.
The virtual system
carries neighbor
information
indicating that the
neighbor is the
originating system,
with the metric
equal to the
maximum value
minus 1. The
originating system
carries neighbor
information
indicating that the
neighbor is the
virtual system, with
the metric 0. This
ensures that the
virtual system is the
downstream node of
the originating
system when other
routers calculate
routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 502
O
pe
rat
in
g
M
od
e
Usag
e
Scen
ario
Principles Example Precautions
M
od
e-
2
All
the
route
rs on
the
netw
ork
suppo
rt LSP
fragm
ent
exten
sion.
Virtual systems do
not participate in
SPF calculation. All
the routers on the
network know that
the LSPs generated
by virtual systems
actually belong to
the originating
system.
An IS-IS router
working in mode-2
can identify the IS
Alias ID TLV, which
is used as a
reference for
calculating the SPT
and routes.
In Figure 7-19,
RouterB supports
LSP fragment
extension, and
RouterA is
configured to
support LSP
fragment extension
in mode-2. RouterA1
and RouterA2 are
virtual systems of
RouterA and send
LSPs carrying some
routing information
of RouterA. When
receiving LSPs from
RouterA1 and
RouterA2, RouterB
obtains the IS Alias
ID TLV and knows
that the originating
system of RouterA1
and RouterA2 is
RouterA. RouterB
then considers that
information
advertised by
RouterA1 and
RouterA2 belongs to
RouterA.
-
NOTE
When the originating system and virtual system send the LSPs with fragment number 0, the
LSPs must carry the IS Alias ID TLV to indicate the originating system regardless of the
operation mode (mode-1 or mode-2).
7.2.11 IS-IS Host Name Mapping
The IS-IS host name mapping mechanism maps host names to system IDs for IS-IS
devices, including dynamic host name mapping and static host name mapping.
Dynamic host name mapping takes precedence over static host name mapping.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 503
When both a dynamic host name and a static host name are configured, the
dynamic host name takes effect.
On an IS-IS router where host name exchange is disabled, information about IS-IS
neighbors and LSDBs shows that each device in an IS-IS routing domain is
identified by a system ID with 12-digit hexadecimal number, for example,
aaaa.eeee.1234. This device identification method is complex and not easy to use.
The host name exchange mechanism facilitates IS-IS network management and
maintenance.
The system ID is replaced by a host name in the following situations:
● When an IS-IS neighbor is displayed, the system ID of the IS-IS neighbor is
replaced by its host name. When the neighbor is the DIS, the system ID of the
DIS is also replaced by its host name.
● When an LSP in the IS-IS LSDB is displayed, the system ID in the LSP ID is
replaced by the host name of the IS-IS device that advertises the LSP.
● When details about the IS-IS LSDB are displayed, the Host Name field is
added to the LSP generated by the device where dynamic host name
exchange is enabled, and the system ID in the Host Name field is replaced by
the dynamic host name of the device that generates the LSP.
Dynamic Host Name Mapping
On a device where dynamic host name mapping is enabled, dynamic host name
information is advertised as TLV 137 (Dynamic Hostname TLV) in LSPs. When you
run IS-IS commands on other devices to view IS-IS information, the system ID of
the local device is replaced by the configured host name. The host name is easier
to identify and memorize than the system ID.
The Dynamic Hostname TLV is optional and can be inserted anywhere in an LSP.
The value of this TLV cannot be empty. A device can determine whether to send
LSPs carrying TLV 137, while the device that receives LSPs can determine whether
to ignore TLV 137 or whether to obtain TLV 137 for its mapping table.
Static Host Name Mapping
Static host name mapping allows you to configure the mapping between host
names and system IDs of other IS-IS devices on a device. Static host name
mapping takes effect only on the local device and is not advertised using LSPs.
7.2.12 IS-IS GR
IS-IS graceful restart (GR) is a high availability technology that implements non-
stop data forwarding.
After the master/slave switchover, no neighbor information is stored on the
restarted router. The first Hello packets sent by the router after restart do not
contain the neighbor list. After receiving the Hello packets, the neighbor checks
the two-way neighbor relationship and detects that it is not in the neighbor list of
the Hello packets sent by the router. The neighbor relationship is interrupted. The
neighbor then generates new LSPs and floods the topology changes to all other
routers in the area. Routers in the area calculate routes based on the new LSDBs,
which leads to route interruption or routing loops.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 504
The IETF defined the GR standard, RFC 3847, for IS-IS. The restart of the protocol
is processed for both the reserved FIB tables and unreserved FIB tables. Therefore,
the route flapping and interruption of the traffic forwarding caused by the restart
can be avoided.
Concepts
IS-IS GR involves two roles, namely, GR restarter and GR helper.
● GR restarter: is a device that has the GR capability and restarts in GR mode.
● GR helper: is a device that has the GR capability and helps the GR restarter
complete the GR process. The GR restarter must have the GR helper
capability.
To implement GR, IS-IS uses TLV 211 (restart TLV) and three timers, T1, T2, and
T3.
Restart TLV
The restart TLV is an extended part of an IS-to-IS Hello (IIH) PDU. All IIH packets
of the router that supports IS-IS GR contain the restart TLV. The restart TLV carries
the parameters for the protocol restart. Figure 7-20 shows the format of the
restart TLV.
Figure 7-20 Restart TLV
Table 7-4 describes the fields of the restart TLV.
Table 7-4 Restart TLV fields
Field Length Description
Type 1 byte TLV type. Type value 211 indicates the restart TLV.
Length 1 byte Length of value in the TLV.
RR 1 bit Restart request bit. A router sends an RR packet to
notify the neighbors of its restarting or starting and
to require the neighbors to retain the current IS-IS
adjacency and return CSNPs.
RA 1 bit Restart acknowledgement bit. A router sends an RA
packet to respond to the RR packet.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 505
Field Length Description
SA 1 bit Suppress adjacency advertisement bit. The starting
router uses an SA packet to require its neighbors to
suppress the broadcast of their neighbor relationships
to prevent routing loops.
Remaining
Time
2 bytes Time during which the neighbor does not reset the
adjacency. The length of the field is 2 bytes. The time
is measured in seconds. When RA is reset, the value is
mandatory.
Timers
Three timers are introduced to enhance IS-IS GR: T1, T2, and T3.
● T1: If the GR restarter has already sent an IIH packet with RR being set but
does not receive any IIH packet that carries the restart TLV and the RA set
from the GR helper even after the T1 timer expires, the GR restarter resets the
T1 timer and continues to send the restart TLV. If the ACK packet is received
or the T1 timer expires three times, the T1 timer is deleted. The default value
of a T1 timer is 3 seconds.
Any interface enabled with IS-IS GR maintains a T1 timer. On a Level-1-2
router, broadcast interfaces maintain a T1 timer for Level-1 and Level-2
neighbor relationships.
● T2: is the time from when the GR restarter restarts until the LSDBs of all
devices of the same level are synchronized. T2 is the maximum time that the
system waits for synchronization of all LSDBs. T2 is generally 60 seconds.
Level-1 and Level-2 LSDBs maintain their respective T2 timers.
● T3: is the maximum time during which the GR restarter performs GR. The T3
initial value is 65535 seconds. After the IIH packets that carry the RA are
received from neighbors, the T3 value becomes the smallest value among the
Remaining Time fields of the IIH packets. If the T3 timer expires, GR fails.
The entire system maintains a T3 timer.
Session Mechanism
For differentiation, GR triggered by the master/slave switchover or the restart of
an IS-IS process is referred to as restarting. In restarting, the FIB table remains
unchanged. GR triggered by router restart is referred to as starting. In starting, the
FIB table is updated.
The following describes the process of IS-IS GR in restarting and starting modes:
● Figure 7-21 shows the process of IS-IS restarting.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 506
Figure 7-21 IS-IS restarting
a. After performing the protocol restart, the GR restarter performs the
following actions:
▪ Starts T1, T2, and T3 timers.
▪ Sends IIH packets that contain the restart TLV from all interfaces. In
such a packet, RR is set to 1, and RA and SA are set to 0.
b. After receiving an IIH packet, the GR helper performs the following
actions:
▪ Maintains the neighbor relationship and refreshes the current
Holdtime.
▪ Replies with an IIH packet containing the restart TLV. In the packet,
RR is set to 0; RA is set to 1, and the value of the Remaining Time
field indicates the period from the current moment to the timeout of
the Holdtime.
▪ Sends CSNPs and all LSPs to the GR restarter.
NOTE
On a P2P link, a neighbor must send CSNPs.
On a multicast link, only the neighbor of the DIS sends CSNPs. If the DIS is
restarted, a temporary DIS is elected from the other routers on the LAN.
If the neighbor does not have the GR helper capability, it ignores the
restart TLV and resets the adjacency with the GR restarter according to
normal IS-IS processing.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 507
c. After the GR restarter receives the IIH response packet, in which RR is set
to 0 and RA is set to 1, from the neighbor, it performs the following
actions:
▪ Compares the current value of the T3 timer with the value of the
Remaining Time field in the packet. The smaller value is taken as the
value of the T3 timer.
▪ Deletes the T1 timer maintained by the interface that receives the
ACK packet and CSNPs.
▪ If the interface does not receive the ACK packet or CSNPs, the GR
restarter constantly resets the T1 timer and resends the IIH packet
that contains the restart TLV. If the number of timeouts of the T1
timer exceeds the threshold value, the GR restarter forcibly deletes
the T1 timer and turns to the normal IS-IS processing to complete
LSDB synchronization.
d. After the GR restarter deletes the T1 timers on all interfaces, the
synchronization with all neighbors is complete when the CSNP list is
cleared and all LSPs are collected. The T2 timer is then deleted.
e. After the T2 timer is deleted, the LSDB of the level is synchronized.
▪ In the case of a Level-1 or Level-2 router, SPF calculation is triggered.
▪ In the case of a Level-1-2 router, determine whether the T2 timer on
the router of the other level is also deleted. If both T2 timers are
deleted, SPF calculation is triggered. Otherwise, the router waits for
the T2 timer of the other level to expire.
f. After all T2 timers are deleted, the GR restarter deletes the T3 timer and
updates the FIB table. The GR restarter re-generates the LSPs of each
level and floods them. During LSDB synchronization, the GR restarter
deletes the LSPs generated before restarting.
g. At this point, the IS-IS restarting of the GR restarter is complete.
● The starting device does not retain the FIB table. The starting device depends
on the neighbors, whose adjacency with itself is Up before it starts, to reset
their adjacency and suppress the neighbors from advertising their adjacency.
The IS-IS starting process is different from the IS-IS restarting process, as
shown in Figure 7-22.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 508
Figure 7-22 IS-IS starting
a. After the GR restarter is started, it performs the following actions:
▪ Starts the T2 timer for the synchronization of LSDBs of each level.
▪ Sends IIH packets that contain the restart TLV from all interfaces.
If RR in the packet is set to 0, a router is started.
If SA in the packet is set to 1, the router requests its neighbor to
suppress the advertisement of their adjacency before the neighbor
receives the IIH packet in which SA is set to 0.
b. After the neighbor receives the IIH packet that carries the restart TLV, it
performs the following actions depending on whether GR is supported:
▪ GR is supported.
Re-initiates the adjacency.
Deletes the description of the adjacency with the GR restarter from
the sent LSP. The neighbor also ignores the link connected to the GR
restarter when performing SPF calculation until it receives an IIH
packet in which SA is set to 0.
▪ GR is not supported.
Ignores the restart TLV and resets the adjacency with the GR
restarter.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 509
Replies with an IIH packet that does not contain the restart TLV. The
neighbor then returns to normal IS-IS processing. In this case, the
neighbor does not suppress the advertisement of the adjacency with
the GR restarter. On a P2P link, the neighbor also sends a CSNP.
c. After the adjacency is re-initiated, the GR restarter re-establishes the
adjacency with the neighbors on each interface. When an adjacency set
on an interface is in the Up state, the GR restarter starts the T1 timer for
the interface.
d. After the T1 timer expires, the GR restarter sends an IIH packet in which
both RR and SA are set to 1.
e. After the neighbor receives the IIH packet, it replies with an IIH packet, in
which RR is set to 0 and RA is set to 1, and sends a CSNP.
f. After the GR restarter receives the IIH ACK packet and CSNP from the
neighbor, it deletes the T1 timer.
If the GR restarter does not receive the IIH packet or CSNP, it constantly
resets the T1 timer and resends the IIH packet in which RR and SA are set
to 1. If the number of the timeouts of the T1 timer exceeds the threshold
value, the GR restarter forcibly deletes the T1 timer and turns to the
normal IS-IS processing to complete LSDB synchronization.
g. After receiving the CSNP from the helper, the GR restarter synchronizes
the LSDB.
h. After the LSDB of this level is synchronized, the T2 timer is deleted.
i. After all T2 timers are deleted, the SPF calculation is started and LSPs are
regenerated and flooded.
j. At this point, the IS-IS starting of the GR restarter is complete.
7.2.13 BFD for IS-IS
In IS-IS, the interval for sending Hello packets is 10s, and the holddown time for
keeping the neighbor relationship is three times the interval for sending Hello
packets. If a router does not receive a Hello packet from its neighbor within the
holddown time, the router deletes the corresponding neighbor relationship. This
indicates that the router detects neighbor faults in seconds. Second-level fault
detection, however, may result in heavy packet loss on high-speed networks.
Bidirectional forwarding detection (BFD) provides light-load and millisecond-level
link fault detection to prevent heavy packet loss. BFD is not used to substitute the
Hello mechanism of IS-IS but helps IS-IS rapidly detect the faults on neighbors or
links and instructs IS-IS to recalculate routes for packet forwarding.
In Figure 7-23, basic IS-IS functions are configured on every router, and BFD for
IS-IS is enabled on RouterA and RouterB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 510
Figure 7-23 BFD for IS-IS
When a fault occurs on the primary link, BFD fast detects the fault and reports it
to IS-IS. IS-IS sets the neighbors of the interface on the faulty link to Down, which
triggers topology calculation, and updates LSPs so that neighbors such as RouterC
can receive the updated LSPs from RouterB. This process implements fast network
convergence.
Classification of BFD for IS-IS
BFD for IS-IS includes static BFD for IS-IS and dynamic BFD for IS-IS.
Table 7-5 Two implementation modes for BFD for IS-IS
Impleme
ntation
Mode
Principles Differences
Static
BFD for
IS-IS
BFD session parameters,
including local and remote
discriminators, are manually
configured using commands,
and the requests for
establishing BFD sessions are
manually delivered.
● Static BFD can be manually
controlled and is easy to deploy.
To save memory and ensure
reliability of key links, deploy
BFD on specified links.
● Establishing and deleting BFD
sessions need to be manually
triggered and lack flexibility.
Configuration errors may occur.
For example, if an incorrect local
or remote discriminator is
configured, a BFD session
cannot work properly.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 511
Impleme
ntation
Mode
Principles Differences
Dynamic
BFD for
IS-IS
BFD sessions are dynamically
created but not manually
configured. When detecting
faults, BFD informs IS-IS of
the faults through the routing
management (RM) module.
IS-IS then turns the neighbors
Down, rapidly advertises the
changed LSPs, and performs
incremental SPF. This
implements fast route
convergence.
Dynamic BFD is more flexible than
static BFD. In dynamic BFD, routing
protocols trigger the setup of BFD
sessions, preventing the
configuration errors caused by
manual configuration. Dynamic
BFD is easy to configure and
applies to the scenarios where BFD
needs to be configured on the
entire network.
NOTE
BFD uses local and remote discriminators to differentiate multiple BFD sessions between
the same pair of systems.
Because IS-IS establishes only single-hop neighbors, BFD for IS-IS detects only single-hop
links between IS-IS neighbors.
Establishment and Deletion of BFD Sessions
The RM module provides related services for association with the BFD module for
IS-IS. Through RM, IS-IS prompts BFD to set up or tear down BFD sessions by
sending notification messages. In addition, BFD events are transmitted to IS-IS
through RM.
Conditions for setting up a BFD session
● Basic IS-IS functions are configured on each router and IS-IS is enabled on the
interfaces of the routers.
● BFD is globally enabled on each router, and BFD is enabled on a specified
interface or process.
● BFD is enabled on interfaces or processes, and the neighbors are Up. A DIS
needs to be elected on a broadcast network.
Process of setting up a BFD session
● P2P network
After the conditions for setting up a BFD session are satisfied, IS-IS instructs
BFD through RM to directly set up a BFD session between neighbors.
● Broadcast network
After the conditions for establishing BFD sessions are met, and the DIS is
elected, IS-IS instructs BFD through RM to establish a BFD session between
the DIS and each router. No BFD session is established between non-DISs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 512
NOTE
On a broadcast network, routers (including non-DIS routers) of the same level on a
network segment can establish neighbor relationships. In the implementation of BFD
for IS-IS, however, BFD sessions are established only between a DIS and a non-DIS. On
a P2P network, BFD sessions are directly established between neighbors.
If a Level-1-2 neighbor relationship is set up between two routers on a link, IS-IS sets
up two BFD sessions for the Level-1 and Level-2 neighbors on a broadcast network,
but sets up only one BFD session on a P2P network.
Conditions for tearing down a BFD session
● P2P network
When a neighbor relationship that was set up on P2P interfaces by IS-IS is
down (that is, the neighbor relationship is not in the Up state) or when the IP
protocol type of a neighbor is deleted, IS-IS tears down the BFD session.
● Broadcast network
When a neighbor relationship that was set up on P2P interfaces by IS-IS is
torn down (that is, the neighbor relationship is not in the Up state), when the
IP protocol type of a neighbor is deleted, or when the DIS is re-elected, IS-IS
tears down the BFD session.
NOTE
After dynamic BFD is globally disabled in an IS-IS process, the BFD sessions on all the
interfaces in this IS-IS process are deleted.
IS-IS Responding to BFD Session Down Event
When detecting a link failure, BFD generates a Down event, and then notifies RM
of the event. RM then instructs IS-IS to delete the neighbor relationship. IS-IS
recalculates routes to speed up route convergence on the entire network.
When both the local router and its neighbor are Level-1-2 routers, they establish
two neighbors of different levels. Then IS-IS establishes two BFD sessions for the
Level-1 neighbor and Level-2 neighbor respectively. When BFD detects a link
failure, it generates a Down event and informs the RM module of the event. The
RM module then instructs IS-IS to delete the neighbor relationship of a specific
level.
7.2.14 IS-IS Auto FRR
With the development of networks, the Voice over IP (VoIP) and on-line video
services require high-quality real-time transmission. Nevertheless, if an IS-IS fault
occurs, multiple processes, including fault detection, LSP update, LSP flooding,
route calculation, and FIB entry delivery, must be performed to switch traffic to a
new link. This results in a lengthy traffic interruption, which cannot meet the
requirement for real-time services.
Complying with RFC 5286 (Basic Specification for IP Fast Reroute Loop-Free
Alternates), IS-IS Auto FRR protects traffic when links or nodes become faulty. IS-
IS Auto FRR allows the forwarding system to rapidly detect such faults and take
measures to restore services as soon as possible.
In most cases, you can bind BFD to IS-IS Auto FRR to ensure millisecond-level fault
recovery. When BFD detects a link fault on an interface, the BFD session goes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 513
Down, triggering FRR on the interface. Subsequently, traffic is switched from the
faulty link to the backup link, which protects services.
Principles
IS-IS Auto FRR pre-computes a backup link by using the Loop-Free Alternate (LFA)
algorithm, and then adds the backup link and the primary link to the forwarding
table. In the case of an IS-IS network failure, IS-IS Auto FRR can fast switch traffic
to the backup link before routes on the control plane converge. This ensures
normal transmission of traffic and improves the reliability of the IS-IS network.
The backup link is calculated through the LFA algorithm. With the neighbor that
can provide the backup link being the root, the shortest path to the destination
node is calculated by a device through the SPF algorithm. Then, the loop-free
backup link is calculated according to the inequality defined in RFC 5286.
IS-IS Auto FRR can filter backup routes that need to be added to the IP routing
table. Only the backup routes matching the filtering policy are added to the IP
routing table. In this manner, users can flexibly control the addition of IS-IS
backup routes to the IP routing table.
Applications
IS-IS Auto FRR support traffic engineering (TE) links, including the following types:
● IP protecting TE
As shown in Figure 7-24, the TE tunnel has the smallest IS-IS cost among the
paths from RouterS to RouterD. Therefore, RouterS selects the TE tunnel as
the primary path to RouterD. The path RouterS->RouterN->RouterD has the
second smallest cost. According to the LFA algorithm, RouterS selects the path
RouterS->RouterN->RouterD as the backup path. The outbound interface of
the backup path is the interface that connects RouterS to RouterN.
NOTE
If the outbound interface of the backup link is the actual outbound interface of the TE
tunnel, IP protecting TE fails.
Figure 7-24 IP protecting TE
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 514
● TE protecting IP
As shown in Figure 7-25, the physical path RouterS-->RouterN-->RouterD has
the smallest IS-IS metric among the paths from RouterS to RouterD.
Therefore, RouterS prefers the path RouterS-->RouterN-->RouterD as the
primary path from RouterS to RouterD. The IS-IS cost of the TE tunnel is 12,
and the explicit path of the TE tunnel is the direct link from RouterS to
RouterD. The IS-IS metric of the direct link from RouterS to RouterD is 13,
which is greater than the IS-IS metric of the TE tunnel. Therefore, IS-IS selects
the TE tunnel as the backup path. TE protecting IP is implemented.
Figure 7-25 TE protecting IP
IS-IS Auto FRR traffic protection is classified into link protection and link-node dual
protection.
Figure 7-26 IS-IS Auto FRR link protection
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 515
Figure 7-27 IS-IS Auto FRR link-node dual protection
Table 7-6 IS-IS Auto FRR traffic protection
Traff
ic
Pro
tec
tio
n
Ty
pe
Object
Protect
ed
Condition Application Example
Lin
k
pro
tec
tio
n
Traffic
passing
through
a
specific
link
The link cost must satisfy the
following inequality:
Distance_opt(N,D) <
Distance_opt(N,S) +
Distance_opt(S,D)
In Figure 7-26, traffic is
transmitted from RouterS
to RouterD. The link cost
satisfies the link
protection inequality.
When the primary link
fails, RouterS switches
the traffic to the backup
link RouterS->RouterN so
that the traffic can be
further transmitted along
downstream paths. This
ensures that the traffic
interruption time is
within 50 ms.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 516
Traff
ic
Pro
tec
tio
n
Ty
pe
Object
Protect
ed
Condition Application Example
Lin
k-
no
de
du
al
pro
tec
tio
n
Next-
hop
node or
link
from
the local
node to
the
next-
hop
node.
Node
protecti
on takes
precede
nce over
link
protecti
on.
Link-node dual protection must
satisfy the following conditions:
● The link cost must satisfy the
following inequality:
Distance_opt(N,D) <
Distance_opt(N,S) +
Distance_opt(S,D)
● The interface cost of the router
must satisfy the following
inequality:
Distance_opt(N,D) <
Distance_opt(N,E) +
Distance_opt(E,D)
In Figure 7-27, traffic is
transmitted along the
path RouterS->RouterE-
>RouterD. The link cost
satisfies the link
protection inequality.
When RouterE or the link
between RouterS and
RouterE fails, RouterS
switches the traffic to the
backup link RouterS-
>RouterN so that the
traffic can be further
transmitted along
downstream paths. This
ensures that the traffic
interruption time is
within 50 ms.
NOTE
In Table 7-6, Distance_opt(X,Y) indicates the cost of the optimal path between node X and
node Y. S indicates the source node of traffic; E indicates the faulty node; N indicates the
node on the backup link; D indicates the destination node of traffic.
7.2.15 IS-IS TE
Conventional routers select the shortest path as the primary route regardless of
other factors, such as bandwidth. In this manner, traffic is not switched to other
paths even if a path is congested. MPLS traffic engineering (TE) has advantages in
solving the problem of network congestion. With MPLS TE, you can precisely
control the traffic path and prevent traffic from passing through congested nodes.
MPLS TE can reserve resources to ensure the quality of services during the
establishment of LSPs.
To ensure service continuity, MPLS TE introduces the route backup and fast reroute
(FRR) mechanisms to switch traffic in time when a link is faulty. MPLS TE allows
service providers (SPs) to fully utilize existing network resources to provide
diversified services. In addition, network resources can be optimized for scientific
network management.
To accomplish the preceding tasks, MPLS TE needs to learn TE information about
all devices on the network. However, MPLS TE lacks a mechanism in which each
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 517
device floods its TE information throughout the entire network for TE information
synchronization. However, IS-IS does provide such a mechanism. Therefore, MPLS
TE can advertise and synchronize TE information with the help of IS-IS.
IS-IS TE is an extension of IS-IS to support MPLS TE and complies with RFC 5305.
IS-IS TE defines new TLVs in IS-IS LSPs to carry TE information and floods LSPs to
flood and synchronize TE information. It extracts TE information from all LSPs and
then transmits the TE information to the Constraint Shortest Path First (CSPF)
module of MPLS for tunnel path calculation. IS-IS TE plays the role of a porter in
MPLS TE. Figure 7-28 shows the relationships between IS-IS TE, MPLS TE, and
CSPF.
Figure 7-28 Relationships between MPLS TE, CSPF, and IS-IS TE
New TLVs in IS-IS TE
To carry TE information in LSPs, IS-IS TE defines the following TLVs in RFC 5305:
● Extended IS reachability TLV
This TLV takes the place of IS reachability TLV and extends the TLV formats
with sub-TLVs. Sub-TLVs are implemented in TLVs in the same manner as TLVs
are implemented in LSPs. Sub-TLVs are used to carry TE information
configured on physical interfaces.
NOTE
Currently, all sub-TLVs defined in RFC 5305 are supported.
Table 7-7 Sub-TLVs defined in Extended IS reachability TLV
Name Type Length (Byte) Value
Administrative Group 3 4 Indicates the
administrative group.
IPv4 Interface Address 6 4 Indicates the IPv4
address of a local
interface.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 518
Name Type Length (Byte) Value
IPv4 Neighbour Address 8 4 Indicates the IPv4
address of a neighbor
interface.
Maximum Link
Bandwidth
9 4 Indicates the maximum
bandwidth of a link.
Maximum Reserved
Link Bandwidth
10 4 Indicates the maximum
reserved bandwidth of a
link.
Unreserved Bandwidth 11 32 Indicates the unreserved
bandwidth.
Traffic Engineering
Default Metric
18 3 Indicates the default
metric of TE.
Bandwidth Constraints
sub-TLV
22 36 Indicates the TLV of the
bandwidth constraint.
● Traffic Engineering router ID TLV
It is of TLV type 134, with a 4-byte Router ID. It is used as the MPLS LSR ID. In
MPLS TE, a Router ID uniquely identifies a router. Each router has a Router ID.
● Extended IP reachability TLV
This TLV takes the place of IP reachability TLV and carries routing information.
It extends the length of the route cost field and carries sub-TLVs.
● Shared Risk Link Group TLV
It is of TLV type 138 and used to carry information about the shared risk link
group. This TLV can carry information about multiple shared links, each of
which is a 4-byte positive integer.
IS-IS TE Implementation
IS-IS TE is implemented in two stages:
● Respond to MPLS TE configurations.
IS-IS TE functions only after MPLS TE is enabled.
IS-IS TE updates the TE information in IS-IS LSPs based on MPLS TE
configurations.
IS-IS TE transmits MPLS TE configurations to the CSPF module.
● Handle TE information in LSPs.
IS-IS TE extracts TE information from IS-IS LSPs and transmits the TE
information to the CSPF module.
In typical applications, IS-IS TE helps MPLS TE set up TE tunnels. As shown in
Figure 7-29, a TE tunnel is set up between RouterA and RouterD.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 519
Figure 7-29 IS-IS TE networking
The networking configuration is as follows:
● Enable MPLS TE on RouterA, RouterB, RouterC, and RouterD and enable
MPLS TE CSPF on RouterA to calculate the tunnel path.
● Run IS-IS and enable IS-IS TE on RouterA, RouterB, RouterC, and RouterD to
implement communication between the four routers.
After the preceding configuration is complete, IS-IS on RouterA, RouterB, RouterC,
and RouterD sends LSPs carrying TE information configured on each router.
RouterA then obtains the TE information of RouterB, RouterC, and RouterD from
the received LSPs. The CSPF module can calculate the path required by the TE
tunnel based on the TE information on the entire network.
Route Calculation on TE Tunnel Interfaces
IS-IS Shortcut (AA) and IS-IS Advertise (FA) calculate routes through TE tunnel
interfaces. For traffic transmitted through a specific route, MPLS guarantees
reliable forwarding whereas IP is less reliable. MPLS forwarding is achieved when
IS-IS Shortcut (AA) and IS-IS Advertise (FA) are configured, with TE tunnel
interfaces involved in route calculation and defined as the outbound interfaces of
specific routes.
Figure 7-30 Principle of IS-IS Shortcut (AA) and Advertise (FA)
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 520
IS-IS Shortcut (AA) and IS-IS Advertise (FA) have the following differences:
● IS-IS Advertise (FA) advertises TE tunnel information to other ISs, whereas IS-
IS Shortcut (AA) does not.
As shown in Figure 7-30, if the TE tunnel is enabled with IS-IS Advertise (FA),
RouterA advertises information indicating that RouterC is its neighbor. The
neighbor information is carried in TLV type 22 with no sub-TLVs. That is, no TE
information is carried. If the TE tunnel is enabled with IS-IS Shortcut (AA),
RouterA does not advertise such information.
● IS-IS Advertise (FA) affects the SPF tree of other routers, whereas IS-IS
Shortcut (AA) does not.
IS-IS Shortcut (AA) does not affect the original structure of the IS-IS SPF tree,
irrespective of whether a TE tunnel exists or not. Apart from the link from
RouterA to RouterB, and that from RouterB to RouterC, a link marked with
Shortcut from RouterA to RouterC is added. The link marked with Shortcut
participates in route calculation.
If the TE tunnel is enabled with IS-IS Advertise (FA), RouterA advertises the
message that "RouterC is a neighbor of RouterA" to other routers on the
network. Other routers then consider RouterC a neighbor of RouterA and add
RouterC to the SPF tree without marking it with Shortcut.
● IS-IS Advertise (FA) does not support a relative metric, whereas IS-IS Shortcut
(AA) does.
IS-IS Shortcut (AA) supports an absolute metric and a relative metric.
If you use an absolute metric, the metric value of TE tunnels in IS-IS is fixed. If
you use a relative metric, the metric value of TE tunnels in IS-IS is the sum of
the physical link cost and relative metric. As shown in Figure 7-30, if the
relative metric is set to 1, the cost of the path from RouterA to RouterC
through the TE tunnel is 21 (10+10+1). If the relative metric is set to 0, the TE
tunnel and physical link are of equal-cost on the outbound interface. If the
relative metric is less than 0, the TE tunnel interface is preferred as the
outbound interface.
● IS-IS Advertise (FA) requires bidirectional TE tunnels, whereas IS-IS Shortcut
(AA) requires only unidirectional tunnels.
7.2.16 IS-IS Local MT
IS-IS local multicast-topology (MT) creates a separate multicast topology on the
local device, without affecting the protocol packets exchanged between devices, to
allow both TE tunnels and multicast to be configured on the backbone network.
NOTE
The mentioned TE tunnel specifies the TE tunnel enabled with IGP Shortcut (AA).
Background
When multicast and an MPLS TE tunnel are deployed in a network simultaneously,
the multicast function may be affected by the TE tunnel.
This is because after the TE tunnel is enabled with IS-IS Shortcut (AA), the
outbound interface of a route calculated by an IS-IS is not the actual physical
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 521
interface but a TE tunnel interface. According to the unicast route to the multicast
source address, a router sends a Report message through a TE tunnel interface.
Routers spanned by the TE tunnel cannot sense the Report message, so multicast
forwarding entries cannot be created. The TE tunnel is unidirectional, so multicast
data packets sent by the multicast source are sent to the routers spanned by the
tunnel through the related physical interfaces. The routers do not have any
multicast forwarding entry. Therefore, the multicast data packets are discarded.
Figure 7-31 TE tunnel scenario
As shown in Figure 7-31, RouterA, RouterB, RouterC, RouterD, and RouterE are
Level-2 routers. The routers run IS-IS to implement interconnection. The multicast
services are normal. A unidirectional MPLS TE tunnel is set up between RouterB
and RouterD. The MPLS TE tunnel is enabled with IS-IS Shortcut (AA). When you
view the multicast routing table on RouterC spanned by the TE tunnel, you cannot
find any multicast forwarding entry. Therefore, the multicast services are
interrupted.
The process of transmitting multicast packets between the client and the multicast
server is as follows:
1. To join a multicast group, the client sends a Report message to RouterA.
RouterA then sends a Join message to RouterB.
2. When the Join message reaches RouterB, RouterB uses Tunnel 1/0/0 as the
Reverse Path Forwarding (RPF) interface and forwards the message to
RouterC through GE 2/0/0 by using the MPLS label.
3. The Join message is forwarded with the MPLS label, so RouterC just forwards
the message and does not create a multicast routing entry. In the topology
shown in Figure 7-31, RouterC is the penultimate hop of the MPLS
forwarding. RouterC pops out the MPLS label, and then forwards the Join
message to RouterD through GE 2/0/0.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 522
4. After receiving the Join message, RouterD creates a multicast forwarding
entry. The inbound interface is GE 2/0/0 and the outbound interface is GE
1/0/0. RouterD then forwards the message to RouterE. The SPT is set up.
5. When the multicast source sends the traffic to RouterD, RouterD forwards the
traffic to RouterC. RouterC does not create any forwarding entry in advance.
Therefore, the traffic is discarded and the multicast service is interrupted.
As described in the preceding process of transmitting multicast packets, the
forwarding of multicast packets relies on the unicast routing table, and the TE
tunnel is unidirectional. Therefore, the multicast packets are discarded. This
problem can be avoided by using the following methods:
● Manually configuring static multicast routes to guide the forwarding of
multicast packets.
● Configuring a bidirectional TE tunnel. In this case, the returned multicast
packets can be sent by using the same tunnel. Routers spanned by the TE
tunnel use the tunnel to transmit multicast packets.
● Configuring the Multicast Border Gateway Protocol (MBGP) to separate the
unicast topology from the multicast topology. MBGP provides the topology
that does not contain the TE tunnel for multicast separately. Multicast is used
to perform RPF check on MBGP routes.
● Configuring local MT
The preceding methods are used to prevent the interruption of multicast services.
The disadvantage of the first three methods is that a lot of manual configurations
need to be done. As a result, if the network is complex, the planning,
configuration, and maintenance tasks become heavier. Therefore, in the preceding
network environment, local MT needs to be configured.
Principles
Local MT creates a separate multicast topology on the local device, without
affecting the protocol packets exchanged between devices. This ensures that
multicast services are still available when both multicast and the MPLS TE tunnel
enabled with IGP Shortcut are deployed.
After local MT is enabled, the router at the ingress of a TE tunnel creates a
separate multicast IGP (MIGP) routing table to store the physical interfaces
corresponding to the TE tunnel. This ensures that multicast protocol packets are
correctly forwarded. The correct routing entries are created in the multicast
routing table (MRT). The implementation of local MT can be divided into two
stages:
● Create an MIGP routing table.
Multicast protocol packets are forwarded according to the unicast routing
table. After local MT is enabled on RouterB, RM creates separate MIGP
routing tables for multicast protocols. When the outbound interface of a route
is a TE tunnel interface, an IGP calculates the actual physical outbound
interface for the route and adds the outbound interface to the MIGP routing
table.
● Guide the forwarding of multicast protocol packets.
Before forwarding a multicast protocol packet, a router needs to search the
unicast routing table. If the router finds that the next hop is the TE tunnel, the
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 523
router continues to search the MIGP routing table for the related physical
outbound interface to guide the forwarding of the multicast protocol packet.
Figure 7-32 Local MT Topology
As shown in Figure 7-32, if the outbound interface of multicast source
192.168.3.2/24 is TE tunnel 1/0/0, the physical outbound interface of the route
calculated by IS-IS is GE 2/0/0. IS-IS installs the route to the MIGP routing table.
The multicast services are not affected by the TE tunnel. Multicast packets are
forwarded through the physical outbound interfaces according to the MIGP
routing table for the general IP forwarding. The related routing entries are created
in the MRT. Multicast data packets are then correctly forwarded.
7.2.17 IS-IS Multi-Instance and Multi-Process
On a VPN-supporting device, you can associate multiple VPN instances with
multiple IS-IS processes to implement IS-IS multi-instance. IS-IS multi-process
allows you to create multiple IS-IS processes in the same VPN (or on the public
network). These IS-IS processes are independent of each other. Route exchange
between IS-IS processes is similar to route exchange between routing protocols.
Each IS-IS process can be bound to a specified VPN instance. A typical application
is as follows: In a VPN, IS-IS runs between PEs and CEs and also runs on the VPN
backbone network. On the PEs, the two IS-IS processes are independent of each
other.
IS-IS multi-instance and multi-process have the following characteristics:
● IS-IS multi-processes share an RM routing table. IS-IS multi-instances use the
RM routing tables in VPNs, and each VPN has its own RM routing table.
● IS-IS multi-process allows a set of interfaces to be associated with a specified
IS-IS process. This ensures that the specified IS-IS process performs all the
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 524
protocol operations only on this set of interfaces. In this manner, multiple IS-
IS processes can work on a single router and each process is responsible for
managing a unique set of interfaces.
● When creating an IS-IS process, you can bind it to a VPN instance to associate
the IS-IS process with the VPN instance. The IS-IS process accepts and
processes only the events related to the VPN instance. When the bound VPN
instance is deleted, the IS-IS process is also deleted.
7.3 Default Settings for IPv4 IS-IS
Table 7-8 describes the default settings for IPv4 IS-IS.
Table 7-8 Default settings for IPv4 IS-IS
Parameter Default Setting
IS-IS Disabled
DIS priority 64
Device level Level-1-2
Interval for sending Hello packets 10s
Minimum interval for sending LSPs 50 ms
Maximum number of LSPs to be sent 10
Interval for updating LSPs 900s
Maximum lifetime of LSPs 1200s
Bandwidth reference value 100 Mbit/s
7.4 Summary of IPv4 IS-IS Configuration Tasks
Table 7-9 describes the IS-IS configuration tasks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 525
Table 7-9 IS-IS configuration tasks
Scenario Description Task
Configuring basic IS-IS
functions
To deploy the IS-IS
protocol on IPv4
networks, configure basic
IS-IS functions to enable
communication between
different nodes on the
network. Other IS-IS
features can only be
configured after the
basic functions are
configured.
7.6 Configure Basic IS-
IS Functions
Configuring IS-IS
network security
On IS-IS networks,
unauthorized users can
attack the IS-IS network
by modifying data
packets or forging
authorized users. To
ensure security of
services carried on IS-IS
networks, configure area
or domain
authentication and
interface authentication.
7.7 Improving IS-IS
Network Security
Configuring IS-IS route
selection
If multiple redundant
links are available in the
network using the IS-IS
protocol, the route in the
IS-IS routing table may
not be the expected
optimal route. This does
not meet the network
planning and traffic
management
requirements. To
optimize the IS-IS
network and facilitate
traffic management,
more accurate control of
the routes on the
network is required.
7.8 Controlling IS-IS
Route Selection
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 526
Scenario Description Task
Configuring IS-IS routing
information exchange
In practical applications,
to meet network
requirements, configure
route policies to
accurately control
advertising and receiving
of IS-IS routing
information.
7.9 Controlling IS-IS
Route Exchange
Configuring IS-IS route
aggregation
Route aggregation
allows multiple routes
with the same IP prefix
to be aggregated into
one route.
Route aggregation on a
large IS-IS network can
effectively reduce entries
in the routing table. This
minimizes system
resource consumption
and facilitates
management. In
addition, if a link in the
aggregated IP address
segment frequently
alternates between Up
and Down, devices
outside this segment will
not be affected by the
change. This prevents
route flapping and
improves network
stability.
7.10 Configuring IS-IS
Route Summarization
Configuring IS-IS route
convergence
To enable IS-IS to rapidly
detect the network
changes, speed up the
IS-IS network
convergence. To
minimize the effect on
networks from route
flapping and reduce load
on the device, slow down
the IS-IS network
convergence.
7.11 Controlling IS-IS
Route Convergence
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 527
Scenario Description Task
Configuring LSP
fragment extension
When information
contained in the LSP
data packet Protocol
Data Unit (PDU) to be
advertised by IS-IS
increases greatly, the IS-
IS device will generate
multiple LSP fragments
to carry and advertise
more information.
7.12 Configuring LSP
Fragment Extension
Configuring mesh groups On the NBMA network,
when an interface of the
switch receives a new
LSP, the LSP is flooded to
other interfaces of the
switch. On highly-
connected networks that
have multiple P2P links,
this processing method
results in repeated LSP
flooding and wastes
bandwidth resources.
To solve this problem,
create a mesh group and
add some interfaces to
the group. The switch
never floods the LSPs
received at interfaces in
the mesh group to other
interfaces from the same
group, and only floods
the LSPs to interfaces
from other groups or
interfaces that are not
configured to any mesh
groups.
7.13 Configuring a
Mesh Group on an
NBMA Network
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 528
Scenario Description Task
Improving IS-IS reliability To ensure rapid recovery
from failures on
networks using the IS-IS
protocol, adopt the
solution of fast fault
detection and standby
link switchover. However,
the IS-IS fault detection
mechanism and link
switchover require a long
period of time, which
fails to meet the
requirements of services
that are highly sensitive
to packet loss and
packet delay.
To meet requirements of
these services, use BFD
for IS-IS to implement
fast fault detection and
use IS-IS GR helper to
implement fast
switchover. This improves
IS-IS reliability.
7.14 Configuring IS-IS
Reliability
Configuring IS-IS
overload
If the system cannot
store new LSPs or
synchronize the LSDB
normally, the calculated
routing information will
be incorrect. In this case,
the system can enter the
overload state. Routes
reached through the
device will not be
calculated, but routes
directly connected to the
device will not be
ignored.
When an IS-IS device on
the network requires
upgrade or maintenance,
the device needs to be
temporarily isolated
from the network. To
prevent other devices
from forwarding traffic
through this node, set
the overload bit for the
device in question.
7.16 Configuring the
Overload Bit for an IS-
IS Device
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 529
7.5 Licensing Requirements and Limitations for IPv4 IS-
IS
Involved Network Elements
Other network elements are required to support IPv4 IS-IS.
Licensing Requirements
IPv4 IS-IS is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
Only the following switch models support IPv4 IS-IS:
S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-
S
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
Feature Limitations
None.
7.6 Configure Basic IS-IS Functions
Pre-configuration Tasks
Before configuring basic IS-IS functions, configure IP addresses for interfaces to
ensure that neighboring nodes are reachable at the network layer.
Configuration Procedure
Creating an IS-IS process is the prerequisite for configuring a network entity title
(NET), configuring the device level, and establishing an IS-IS neighbor relationship.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 530
7.6.1 Creating IS-IS Processes
Context
Creating IS-IS processes is the prerequisite for performing IS-IS configurations.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ] [ vpn-instance
vpn-instance-name ]
An IS-IS process is created, and the IS-IS process view is displayed.
The
process-id parameter specifies the ID of an IS-IS process. If the
process-id is
not specified, the value of
process-id is 1 by default. To associate the IS-IS process
with a VPN instance, specify the VPN instance name.
Step 3 (Optional) Run description
description
A description is configured for the IS-IS process.
Step 4 (Optional) Enable IS-IS to add the POI and hostname TLV to Purge LSPs.
Run purge-originator-identification enable [ always ]
IS-IS is enabled to determine whether to add the POI TLV and hostname TLV to
Purge LSPs based on the authentication configuration.
● If the purge-originator-identification enable command is run and the send-
only parameter is specified when configuring authentication, generated Purge
LSPs do not carry the POI TLV or hostname TLV.
● If the purge-originator-identification enable command is run and MD5 or
HMAC-MD5 authentication is configured, generated Purge LSPs do not carry
the POI TLV or hostname TLV. If the purge-originator-identification enable
command is run and authentication of another type is configured or no
authentication is configured, generated Purge LSPs carry the POI TLV and
hostname TLV.
● If the purge-originator-identification enable always command is run,
generated Purge LSPs carry the POI TLV and hostname TLV, regardless of
whether authentication is configured or whether the send-only parameter is
specified when configuring authentication.
----End
7.6.2 Configuring a NET
Context
NET is the special form of the network service access point (NSAP). After the IS-IS
view is displayed, IS-IS can start only when a NET is configured for an IS-IS
process.
Generally, you only need to configure one NET for an IS-IS process. When an area
needs to be redefined, for example, the area needs to be merged with other areas
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 531
or divided into sub-areas, configure multiple NETs to ensure route correctness. A
maximum of three area addresses can be configured for an IS-IS process.
Therefore, a maximum of three NETs can be configured for an IS-IS process. When
configuring multiple NETs, ensure that their system IDs are the same.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS process view is displayed.
Step 3 Run network-entity
net
A NET is configured.
NOTE
Configuring loopback interface addresses based on NETs is recommended to ensure that a
NET is unique on the network. If NETs are not unique, route flapping will easily occur.
An area ID uniquely identifies an area in the same IS-IS domain. All routers in the same
Level-1 area must share the same area ID, while routers in the same Level-2 area can have
different area IDs.
----End
7.6.3 Configuring the Device Level
Context
Configure the device level according to network planning requirements:
● When the level of a device is Level-1, the device establishes neighbor
relationships with only Level-1 and Level-1-2 routers in the same area and
maintains only Level-1 LSDBs.
● When the level of a device is Level-2, the device can establish neighbor
relationship with Level-2 routers in the same area or different areas and with
Level-1-2 routers in different areas and maintain only Level-2 LSDB.
● When the level of a device is Level-1-2, the device can establish neighbor
relationships with Level-1 and Level-2 routers and maintain Level-1 and
Level-2 LSDBs.
NOTICE
If the levels of IS-IS devices are changed during network operation, the IS-IS
process will be restarted and IS-IS neighbor relationships will be disconnected.
Setting the levels of devices when configuring IS-IS is recommended.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 532
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS process view is displayed.
Step 3 Run is-level { level-1 | level-1-2 | level-2 }
The level of the switch is configured.
By default, the level of the switch is Level-1-2.
----End
7.6.4 Establishing IS-IS Neighbor Relationships
Context
The methods to establish IS-IS neighbor relationships on a broadcast network and
a P2P network are different. Therefore, you need to set different IS-IS attributes
for different types of interfaces:
● On a broadcast network, IS-IS needs to select the designated intermediate
system (DIS). You can set the DIS priority for IS-IS interfaces to enable the
device with the highest DIS priority to be elected as the DIS.
● On a P2P network, IS-IS does not need to select the DIS. Therefore, the DIS
priority does not need to be configured for interfaces. To ensure P2P link
reliability, configure IS-IS to establish a neighbor relationship on two P2P
interfaces in 3-way mode for unidirectional link fault detection.
Generally, IS-IS checks the IP addresses of received Hello packets. A neighbor
relationship can be established only when the source IP address carried in a
received Hello packet and the address of the interface that receives the Hello
packet are on the same network segment. If the IP addresses of the two P2P
interfaces are on different network segments, and the isis peer-ip-ignore
command is run on the two interfaces, IS-IS does not check the peer IP
address. The neighbor relationship can be correctly established on the two
P2P interfaces.
Procedure
● Establish an IS-IS neighbor relationship on a broadcast link.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 533
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run isis enable [
process-id ]
IS-IS is enabled on the interface.
After this command is run, IS-IS establishes neighbor relationships and
floods LSPs through this interface.
NOTE
Loopback interfaces are not used to establish neighbor relationships. If IS-IS is
enabled on a loopback interface, IS-IS advertises the routes of the network
segment where the interface resides through other IS-IS interfaces.
e. Run isis circuit-level [ level-1 | level-1-2 | level-2 ]
The level of the interface is configured.
By default, the level of an interface is level-1-2.
When two Level-1-2 devices establish an IS-IS neighbor relationship, they
establish both Level-1 and Level-2 neighbor relationships. To allow the
two Level-1-2 devices to establish only Level-1 or Level-2 neighbor
relationship, change the level of interfaces.
NOTE
Changing the level of an IS-IS interface is valid only when the level of the IS-IS
device is Level-1-2. If the level of the device is not Level-1-2, the level of the
device determines the level of the established neighbor relationship.
f. (Optional) Run isis dis-priority
priority [ level-1 | level-2 ]
The DIS priority is set for the interface. A larger value indicates a higher
priority.
By default, the DIS priority of Level-1 and Level-2 broadcast interfaces is
64.
Level-1-2 broadcast interfaces select the DIS using Level-1 and Level-2
separately. To select the DIS only for Level-1 or Level-2 interfaces, specify
the level.
g. (Optional) Run isis silent [ advertise-zero-cost ]
The interface is suppressed.
By default, an IS-IS interface is not suppressed.
When an IS-IS interface is suppressed, the interface no longer sends or
receives IS-IS packets. The routes of the network segment where the
interface resides, however, can still be advertised to other IS-IS devices
within the same AS.
h. (Optional) Configure a delay for the IS-IS neighbor relationship
establishment.
Run isis delay-peer track last-peer-expired [ delay-time
delay-
interval ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 534
A delay is configured for the IS-IS neighbor relationship establishment.
On an IS-IS network, if the IS-IS link has the network transmission delay
or transmission error, a few Hello packets may be lost or incorrectly
transmitted. In this case, the neighbor relationship frequently changes
between the Up and Down states, leading to route flapping.
By default,
delay-interval is 60s.
If a new
delay-interval is configured and it is less than the remaining
time of the ongoing delay, the new
delay-interval takes effect
immediately; if the new
delay-interval is greater than the remaining time
of the ongoing delay, the ongoing delay continues until the new
delay-
interval takes effect at the next delay.
● Establish an IS-IS neighbor relationship on a P2P link.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run isis enable [
process-id ]
IS-IS is enabled on the interface.
e. Run isis circuit-level [ level-1 | level-1-2 | level-2 ]
The level of the interface is configured.
By default, the level of an interface is level-1-2.
f. Run isis circuit-type p2p [ strict-snpa-check ]
The network type of the interface is set to P2P.
By default, the network type of an interface is determined by the physical
type of the interface.
When the network type of an IS-IS interface changes, the interface
configuration changes accordingly:
▪ After a broadcast interface is simulated as a P2P interface using the
isis circuit-type p2p [ strict-snpa-check ] command, the interval for
sending Hello packets, the number of Hello packets that IS-IS does
not receive from a neighbor before the neighbor is declared Down,
interval for resending LSPs on a P2P link, and various IS-IS
authentication modes are restored to the default settings; other
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 535
configurations such as the DIS priority, DIS name, and interval for
sending CSNPs on a broadcast network become invalid.
▪ After the undo isis circuit-type command is run to restore the
default network type of an IS-IS interface, the interval for sending
Hello packets, number of Hello packets that IS-IS does not receive
from a neighbor before the neighbor is declared Down, interval for
retransmitting LSPs on a P2P link, various IS-IS authentication
modes, DIS priority, and interval for sending CSNPs on a broadcast
network are restored to the default settings.
g. Run isis ppp-negotiation { 2-way | 3-way [ only ] }
The negotiation mode is specified for the interface.
By default, the negotiation mode is 3-way.
h. Run isis peer-ip-ignore
IS-IS is configured to not check the IP addresses of received Hello packets.
By default, IS-IS checks the IP addresses of received Hello packets.
i. Run isis ppp-osicp-check
OSICP negotiation status check is configured on the interface.
By default, the OSICP negotiation status of a PPP interface does not
affect the status of an IS-IS interface.
NOTE
This command applies only to PPP interfaces and is invalid for other P2P
interfaces.
After this command is run, the OSICP negotiation status of a PPP interface
affects the status of an IS-IS interface. When PPP detects that the OSI network
fails, the link status of the IS-IS interface goes Down and the routes of the
network segment where the interface resides are not advertised through LSPs.
j. (Optional) Configure a delay for the IS-IS neighbor relationship
establishment.
Run isis delay-peer track last-peer-expired [ delay-time
delay-
interval ]
A delay is configured for the IS-IS neighbor relationship establishment.
On an IS-IS network, if the IS-IS link has the network transmission delay
or transmission error, a few Hello packets may be lost or incorrectly
transmitted. In this case, the neighbor relationship frequently changes
between the Up and Down states, leading to route flapping.
By default,
delay-interval is 60s.
If a new
delay-interval is configured and it is less than the remaining
time of the ongoing delay, the new
delay-interval takes effect
immediately; if the new
delay-interval is greater than the remaining time
of the ongoing delay, the ongoing delay continues until the new
delay-
interval takes effect at the next delay.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 536
7.6.5 Verifying the Basic IS-IS Function Configuration
Procedure
● Run the display isis peer [ verbose ] [
process-id | vpn-instance
vpn-
instance-name ] command to check information about IS-IS neighbors.
● Run the display isis interface [ verbose ] [
process-id | vpn-instance
vpn-
instance-name ] command to check information about IS-IS interfaces.
● Run the display isis route [
process-id | vpn-instance
vpn-instance-name ]
[ ipv4 ] [ verbose | [ level-1 | level-2 ] |
ip-address [
mask |
mask-length ] ] *
command to check information about IS-IS routes.
----End
7.7 Improving IS-IS Network Security
Pre-configuration Tasks
Before improving IS-IS network security, configure basic IS-IS functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the IS-IS Network Security Optimization Configuration) in any sequence.
7.7.1 Configuring Interface Authentication
Context
Generally, IS-IS packets are sent without authentication information encapsulation,
and the received packets are not authenticated. If a user sends malicious packets
to attack a network, information on the entire network may be stolen. Therefore,
you can configure IS-IS authentication to improve network security.
After IS-IS interface authentication is configured, authentication information can
be encapsulated into Hello packets to confirm the validity and correctness of
neighbor.
NOTICE
If plain is selected during the configuration of the authentication mode for the IS-
IS interface, the password is saved in the configuration file in plain text. This
brings security risks. It is recommended that you select cipher to save the
password in cipher text.
Simple authentication and MD5 authentication have potential security risks.
HMAC-SHA256 or Keychain authentication mode is recommended.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 537
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run any of the following commands to configure the authentication mode of the
IS-IS interface as required:
● Run isis authentication-mode simple { plain
plain-text | [ cipher ]
plain-
cipher-text } [ level-1 | level-2 ] [ ip | osi ] [ send-only ]
Simple authentication is configured for the IS-IS interface.
● Run isis authentication-mode md5 { plain
plain-text | [ cipher ]
plain-
cipher-text } [ level-1 | level-2 ] [ ip | osi ] [ send-only ]
MD5 authentication is configured for the IS-IS interface.
● Run isis authentication-mode hmac-sha256 key-id
key-id { plain
plain-text |
[ cipher ]
plain-cipher-text } [ level-1 | level-2 ] [ send-only ]
HMAC-SHA256 authentication is configured for the IS-IS interface.
● Run isis authentication-mode keychain
keychain-name [ level-1 | level-2 ]
[ send-only ]
Keychain authentication is configured for the IS-IS interface.
By default, an IS-IS interface does not authenticate received Hello packets and no
authentication password is configured on the interface.
NOTE
Use the send-only parameter according to network requirements:
● If the send-only parameter is specified, the device only encapsulates the Hello packets
to be sent with authentication information rather than checks whether the received
Hello packets pass the authentication. When the Hello packets do not need to be
authenticated on the local device and pass the authentication on the remote device,
the two devices can establish the neighbor relationship.
● If the send-only parameter is not specified, ensure that passwords of all interfaces
with the same level on the same network are the same.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support keychain
keychain-name.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 538
7.7.2 Configuring Area or Domain Authentication
Context
Generally, the IS-IS packets to be sent are not encapsulated with authentication
information, and the received packets are not authenticated. If a user sends
malicious packets to attack a network, information on the entire network may be
stolen. Therefore, you can configure IS-IS authentication to improve network
security.
The area authentication password is encapsulated into Level-1 IS-IS packets. Only
the packets that pass the area authentication can be accepted. Therefore, you
must configure IS-IS area authentication on all the IS-IS devices in the specified
Level-1 area to authenticate the Level-1 area.
The domain authentication password is encapsulated into Level-2 IS-IS packets.
Only the packets that pass the domain authentication can be accepted. Therefore,
you must configure IS-IS domain authentication on all the IS-IS devices in the
Level-2 area to authenticate Level-2 area.
NOTICE
If plain is selected during the configuration of the area authentication mode or
domain authentication mode, the password is saved in the configuration file in
plain text. This brings security risks. It is recommended that you select cipher to
save the password in cipher text.
Simple authentication and MD5 authentication have potential security risks.
HMAC-SHA256 or Keychain authentication mode is recommended.
Characters %^%# are used as the prefix and suffix of existing passwords with
variable lengths. Therefore, characters %^%# cannot be configured together at
the beginning or end of a cipher text password.
NOTE
When configuring IS-IS authentication, the area or domain authentication modes and
passwords of the routers in the same area must be consistent so that IS-IS packets can be
flooded normally.
Whether IS-IS packets can pass area or domain authentication does not affect the
establishment of Level-1 or Level-2 neighbor relationships.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS process view is displayed.
Step 3 Perform the following operations in any sequence as required.
● Run area-authentication-mode { { simple | md5 } { plain
plain-text |
[ cipher ]
plain-cipher-text } [ ip | osi ] | keychain
keychain-name | hmac-
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 539
sha256 key-id
key-id } [ snp-packet { authentication-avoid | send-only } |
all-send-only ]
The area authentication mode is configured.
By default, the system neither encapsulates generated Level-1 packets with
authentication information nor authenticates received Level-1 packets.
● Run domain-authentication-mode { { simple | md5 } { plain
plain-text |
[ cipher ]
plain-cipher-text } [ ip | osi ] | keychain
keychain-name | hmac-
sha256 key-id
key-id } [ snp-packet { authentication-avoid | send-only } |
all-send-only ]
The domain authentication mode is configured.
By default, the system neither encapsulates generated Level-2 packets with
authentication information nor authenticates received Level-2 packets.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support the keychain
keychain-name parameter.
The authentication involves the following situations:
● The device encapsulates the authentication mode into LSPs and SNPs to be sent and
checks whether the received packets pass authentication. Then, the device discards the
packets that do not pass the authentication. In this case, the parameter snp-packet or
all-send-only is not specified.
● The device encapsulates authentication information into LSPs to be sent and checks
whether the received LSPs pass the authentication; the device neither encapsulates the
SNPs to be sent with authentication information nor checks whether the received SNPs
pass the authentication. In this case, the parameter snp-packet authentication-avoid
needs to be specified.
● The device encapsulates the LSPs and SNPs to be sent with authentication information;
the device, however, checks the authentication mode of only the received LSPs rather
than the received SNPs. In this case, the parameter snp-packet send-only needs to be
specified.
● The device encapsulates the LSPs and SNPs to be sent with authentication information,
but does not check whether the received LSPs or SNPs pass the authentication. In this
case, the parameter all-send-only needs to be specified.
----End
7.7.3 Configuring the Optional Checksum
Context
When a network is running, Intermediate System to Intermediate System (IS-IS)
routers may be attacked or IS-IS packets may be modified. As a result, important
network information may be intercepted, causing serious loss to the network. The
optional checksum encapsulates optional checksum TLVs into the Complete
Sequence Numbers Protocol Data Units (CSNPs), Partial Sequence Number
Protocol Data Units (PSNPs), and Hello packets sent by IS-IS routers. When the
peer device receives the encapsulated packets, it checks whether TLVs carried in
the packets are correct. If TLVs are not correct, the peer device discards the
packets for network security.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 540
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis
An IS-IS process is created and the IS-IS view is displayed.
Step 3 Run optional-checksum enable
IS-IS optional checksum is enabled.
NOTE
If MD5 authentication or Keychain authentication with valid MD5 authentication is
configured on an IS-IS interface or area, IS-IS routers send Hello packets and SNP packets
carrying no checksum TLVs and verify the checksum of the received packets.
----End
7.7.4 Verifying the IS-IS Network Security Optimization
Configuration
Procedure
● Run the display isis lsdb verbose command to check the detailed information
in the IS-IS LSDB.
----End
7.8 Controlling IS-IS Route Selection
Pre-configuration Tasks
Before configuring IS-IS route selection, configure basic IS-IS functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the IS-IS Route Selection Control Configuration) in any sequence.
7.8.1 Configuring a Preference Value for IS-IS
Context
If multiple routes to the same destination are discovered by different routing
protocols running on the same device, the route discovered by the protocol with
the highest preference is selected.
To prefer a route discovered by IS-IS, configure a higher preference value for IS-IS.
In addition, a routing policy can be configured to increase the preferences of
specified IS-IS routes, without affecting route selection.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 541
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run preference {
preference | route-policy
route-policy-name } *
The IS-IS preference value is configured.
The default IS-IS preference value is 15. A smaller
preference value indicates a
higher preference.
----End
7.8.2 Configuring the Cost of an IS-IS Interface
Context
The costs of IS-IS interfaces can be determined in the following modes in
descending order of priority:
● Interface cost: is configured for a specified interface.
● Global cost: is configured for all interfaces.
● Automatically calculated cost: is automatically calculated based on the
interface bandwidth.
If no cost is configured for an IS-IS interface, the IS-IS interface uses the default
cost 10 and cost style narrow.
NOTICE
If you want to change the cost style of IS-IS devices, running the command while
configuring basic IS-IS functions is recommended. If the cost style of IS-IS devices
is changed during network operation, the IS-IS process is restarted and the
neighbor relationship is re-established.
Procedure
Step 1 Configure the IS-IS cost style.
1. Run system-view
The system view is displayed.
2. Run isis [
process-id ]
The IS-IS view is displayed.
3. Run cost-style { narrow | wide | wide-compatible | { narrow-compatible |
compatible } [ relax-spf-limit ] }
The IS-IS cost style is configured.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 542
By default, the cost style of routes received and sent by an IS-IS device is
narrow.
The cost range of an interface and a route received by the interface vary with the
cost type.
● If the cost style is narrow, the cost of an interface ranges from 1 to 63. The
maximum cost of a route received by the interface is 1023.
● If the cost style is narrow-compatible or compatible, the cost of an interface
ranges from 1 to 63. The cost of a received route is related to relax-spf-limit.
● If the cost style is wide-compatible or wide, the cost of the interface ranges
from 1 to 16777215. When the cost is 16777215, the neighbor TLV generated
on the link cannot be used for route calculation but for the transmission of TE
information. The maximum cost of a received route is 0xFFFFFFFF.
Step 2 Configure the cost of an IS-IS interface.
Perform any of the following operations to configure the cost of an IS-IS interface.
Configure the cost of a specified IS-IS interface.
1. Run system-view
The system view is displayed.
2. Run interface
interface-type interface-number
The interface view is displayed.
3. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
4. Run isis cost {
cost | maximum } [ level-1 | level-2 ]
The cost of the IS-IS interface is configured.
By default, the link cost of an IS-IS interface is 10.
NOTE
You can configure the parameter maximum only when the IS-IS cost style is wide or
wide-compatible.
To change the cost of a loopback interface, run the isis cost command only in the
loopback interface view.
Configure the global IS-IS cost.
1. Run system-view
The system view is displayed.
2. Run isis [
process-id ]
The IS-IS view is displayed.
3. Run circuit-cost {
cost | maximum } [ level-1 | level-2 ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 543
The global IS-IS cost is configured.
By default, no global cost is configured.
Enable IS-IS to automatically calculate the interface cost.
1. Run system-view
The system view is displayed.
2. Run isis [
process-id ]
The IS-IS view is displayed.
3. Run bandwidth-reference
value
The reference value of the bandwidth is configured. By default, the bandwidth
reference value is 100 Mbit/s.
4. Run auto-cost enable [ compatible ]
The interface is configured to automatically calculate its cost.
The bandwidth reference value set using the bandwidth-reference command
takes effect only when the cost style is wide or wide-compatible. In this case, the
interface cost is calculated using the following formula:
Cost of each interface = (Bandwidth-reference/Interface bandwidth) × 10
If the cost-style is narrow, narrow-compatible, or compatible, the cost of each
interface is calculated based on costs listed in Table 7-10.
Table 7-10 Mapping between IS-IS interface costs and interface bandwidth
Cost Bandwidth Range
60 Interface bandwidth ≤ 10 Mbit/s
50 10 Mbit/s < Interface bandwidth ≤ 100
Mbit/s
40 100 Mbit/s < Interface bandwidth ≤ 155
Mbit/s
30 155 Mbit/s < Interface bandwidth ≤ 622
Mbit/s
20 622 Mbit/s < Interface bandwidth ≤ 2.5
Gbit/s
10 2.5 Gbit/s < Interface bandwidth
----End
7.8.3 Configuring Equal-Cost IS-IS Routes
Context
If there are redundant IS-IS links, multiple routes may have an equal cost. Choose
either of the following methods to use these equal-cost IS-IS routes:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 544
● Configure load balancing for equal-cost IS-IS routes so that traffic will be
evenly balanced among these links.
This mechanism increases the link bandwidth usage and prevents network
congestion caused by link overload. However, this mechanism may make
traffic management more difficult because traffic will be randomly forwarded.
● Configure preference values for equal-cost IS-IS routes so that only the route
with the highest preference will be used and the others function as backups.
This configuration facilitates traffic management and improves the network
reliability, without the need to change original configurations.
Procedure
● Configure equal-cost IS-IS routes to work in load-balancing mode.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run maximum load-balancing
number
The maximum number of load-balancing equal-cost IS-IS routes is set.
By default, the maximum number of equal-cost routes on the S5720I-SI,
S5735-S, S5735-S-I, S5735S-H, S6720S-S, and S5736-S is 8, and the
maximum number of equal-cost routes on the S5731-H, S5731-S,
S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S,
and S6730S-S is 16.
NOTE
When the number of equal-cost routes is larger than the value specified in the
maximum load-balancing command, valid routes are selected for load
balancing based on the following criteria:
1. Route preference: Routes with lower preference values (higher preferences)
are selected for load balancing.
2. Next hop system ID: If routes have the same preference, routes with smaller
system IDs are selected for load balancing.
3. Interface index: If routes have the same preference and system ID, routes with
lower interface index values are selected for load balancing.
● Configure preference values for equal-cost IS-IS routes.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run nexthop
ip-address weight
value
A preference value is configured for an equal-cost IS-IS route.
By default, the preference value configured for equal-cost IS-IS routes is
255. A smaller value indicates a higher priority.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 545
7.8.4 Configuring IS-IS Route Leaking
Context
If multiple Level-1-2 devices in a Level-1 area are connected to devices in the
Level-2 area, a Level-1 LSP sent by each Level-1-2 device carries an ATT flag bit of
1. This Level-1 area will have multiple routes to the Level-2 area and to other
Level-1 areas.
By default, routes in a Level-1 area can be leaked into the Level-2 area so that
Level-1-2 and Level-2 devices can determine the topology of the entire network.
Devices in a Level-1 area are unaware of the entire network topology because
they only maintain LSDBs in the local Level-1 area. Therefore, a device in a Level-1
area can forward traffic to a Level-2 device only through the nearest Level-1-2
device. The route used may not be the optimal route to the destination.
To enable a device in a Level-1 area to select the optimal route, configure IPv4 IS-
IS route leaking so that specified routes in the Level-2 area can be leaked into the
local Level-1 area.
Routes of services deployed only in the local Level-1 area do not need to be
leaked into the Level-2 area. A policy can be configured to leak only desired routes
into the Level-2 area.
Procedure
● Specify routes in the Level-2 area and other Level-1 areas that can be leaked
into the local Level-1 area.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run import-route isis level-2 into level-1 [ tag
tag | filter-policy {
acl-
number | acl-name
acl-name | ip-prefix
ip-prefix-name | route-policy
route-policy-name } | direct { allow-filter-policy | allow-up-down-bit }
* ] *
Routes that meet the specified conditions in the Level-2 areas are leaked
into the local Level-1 area.
By default, routes in the Level-2 area are not leaked into Level-1 areas.
NOTE
The command is run on the Level-1-2 device that is connected to an external
area.
● Configure routes in Level-1 areas to leak into the Level-2 area.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 546
c. Run import-route isis level-1 into level-2 [ tag
tag | filter-policy {
acl-
number | acl-name
acl-name | ip-prefix
ip-prefix-name | route-policy
route-policy-name } | direct allow-filter-policy ] *
Routes that meet the specified conditions in Level-1 areas are leaked into
the Level-2 area.
By default, all routes in a Level-1 area are leaked into the Level-2 area.
NOTE
The command is run on the Level-1-2 device that is connected to an external
area.
----End
7.8.5 Controlling Whether a Level-1 Device Generates a IPv4
Default Route
Context
As defined in the IS-IS protocol, if a Level-1-2 device reaches more areas through a
Level-2 area than through a Level-1 area based on the link state database (LSDB),
the Level-1-2 device sets the ATT bit to 1 in the LSPs and sends the LSPs with the
ATT bit 1 to the Level-1 device. Upon receipt, the Level-1 device generates a
default route destined for the Level-1-2 device.
The preceding rules are used by default. You can set the ATT bit as required on a
live network.
Perform the following steps:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run the following command as required:
● To set the ATT bit in the LSPs sent by the Level-1-2 device, run the attached-
bit advertise { always | never } command.
– If the always parameter is specified, the ATT bit is set to 1. After
receiving the LSPs carrying the ATT bit 1, the Level-1 device generates a
default route.
– If the never parameter is specified, the ATT bit is set to 0. After receiving
the LSPs carrying the ATT bit 0, the Level-1 device does not generate a
default route, which reduces the size of a routing table.
● To disable the Level-1 device from generating default routes even though it
receives the LSPs carrying the ATT bit 1, run the attached-bit avoid-learning
command.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 547
7.8.6 Verifying the IS-IS Route Selection Control Configuration
Procedure
● Run the display isis route [
process-id | vpn-instance
vpn-instance-name ]
[ ipv4 ] [ verbose | [ level-1 | level-2 ] |
ip-address [
mask |
mask-length ] ] *
command to check IS-IS routing information.
● Run the display isis lsdb [ { level-1 | level-2 } | verbose | { local |
lsp-id | is-
name
symbolic-name } ] * [
process-id | vpn-instance
vpn-instance-name ]
command to check information in the IS-IS LSDB.
----End
7.9 Controlling IS-IS Route Exchange
Pre-configuration Tasks
Before controlling IS-IS route exchange, configure basic IS-IS functions.
Configuration Flowchart
You can perform the following configuration tasks (excluding the task of Verifying
the IS-IS Route Exchange Control Configuration) in any sequence.
7.9.1 Configuring IS-IS to Advertise a Default Route
Context
If IS-IS is configured to advertise a default route on a border device that has
external routes, the device advertises a default route 0.0.0.0/0 in the IS-IS routing
domain. All traffic destined for other routing domains is first forwarded to the
border device.
Configuring a static default route can also allow all the traffic to be first
forwarded to a border device, which then forwards the traffic outside an IS-IS
routing domain. However, this method leads to heavy workload in configuration
and management when a large number of devices are deployed on the network.
In addition, advertising default routes using IS-IS is flexible. If multiple border
devices are deployed, a routing policy can be configured to allow only the border
device that meets the specified conditions to advertise a default route, preventing
routing blackholes.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 548
Step 3 Run default-route-advertise [ always | match default | route-policy
route-
policy-name ] [ cost
cost | tag
tag | [ level-1 | level-1-2 | level-2 ] ] * [ avoid-
learning ]
IS-IS is configured to advertise a default route.
By default, IS-IS does not advertise a default route.
----End
7.9.2 Configuring IS-IS to Import External Routes
Context
After IS-IS is configured to advertise a default route on a border device in an IS-IS
routing domain, all the traffic destined outside the IS-IS routing domain is
forwarded through the border device. This burdens the border device because
other devices in the IS-IS routing domain do not have the routes destined outside
the domain. If multiple border devices are deployed in the IS-IS routing domain,
optimal routes to other routing domains need to be selected.
To ensure optimal routes are selected, all the other devices in the IS-IS routing
domain must learn all or some external routes.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Configure IS-IS to import external routes.
● When you need to set the cost of imported routes, run the import-route
{ { rip | isis | ospf } [
process-id ] | static | direct | unr | bgp [ permit-ibgp ] }
[ cost-type { external | internal } | cost
cost | tag
tag | route-policy
route-
policy-name | [ level-1 | level-2 | level-1-2 ] ] * command to configure IS-IS
to import external routes.
● When you need to retain the original cost of imported routes, run the import-
route { { rip | isis | ospf } [
process-id ] | direct | unr | bgp } inherit-cost
[ tag
tag | route-policy
route-policy-name | [ level-1 | level-2 | level-1-2 ] ] *
command to configure IS-IS to import external routes. In this case, the source
routing protocol of imported routes cannot be static.
NOTE
IS-IS will advertise all imported external routes to the IS-IS routing domain by default.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 549
7.9.3 Configuring IS-IS to Advertise Specified External Routes
to an IS-IS Routing Domain
Context
When the local IS-IS device advertises imported external routes to other IS-IS
devices, routing policies can be configured to advertise only the external routes
that meet specified conditions if these devices do not require all the imported
external routes.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name } export [
protocol [
process-id ] ]
IS-IS is configured to advertise the external routes that meet specified conditions
to the IS-IS routing domain.
----End
7.9.4 Adding Specified IS-IS Routes to the IP Routing Table
Context
Only routes in an IP routing table can be used to forward IP packets. An IS-IS
route can take effect only after this IS-IS route has been successfully added to an
IP routing table.
If an IS-IS route does not need to be added to a routing table, specify conditions,
such as a basic ACL, IP prefix, and routing policy, to filter routes so that only IS-IS
routes that meet the specified conditions can be added to an IP routing table. IS-IS
routes that do not meet the specified conditions cannot be added to the IP routing
table and cannot be selected to forward IP packets.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name } import
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 550
Conditions for filtering IS-IS routes are configured.
----End
7.9.5 Verifying the IS-IS Route Exchange Control Configuration
Procedure
● Run the display isis lsdb [ { level-1 | level-2 } | verbose | { local |
lsp-id | is-
name
symbolic-name } ] * [
process-id | vpn-instance
vpn-instance-name ]
command to check IS-IS LSDB information.
● Run the display isis route [
process-id | vpn-instance
vpn-instance-name ]
[ ipv4 ] [ verbose | [ level-1 | level-2 ] |
ip-address [
mask |
mask-length ] ] *
command to check IS-IS routing information.
● Run the display ip routing-table [ verbose ] command to check the IP
routing table.
----End
7.10 Configuring IS-IS Route Summarization
Pre-configuration Tasks
Before configuring IS-IS route summarization, configure basic IS-IS functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run summary
ip-address mask [ avoid-feedback | generate_null0_route | tag
tag | [ level-1 | level-1-2 | level-2 ] ] *
The specified IS-IS routes are summarized into one IS-IS route.
NOTE
After route summarization is configured on a device, the local routing table still contains all
specific routes before the summarization. The routing tables on other devices contain only
the summary route, and the summary route is deleted only after all its specific routes are
deleted.
----End
Verifying the Configuration
● Run the display isis route command to check summary routes in the IS-IS
routing table.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 551
● Run the display ip routing-table [ verbose ] command to check summary
routes in the IP routing table.
7.11 Controlling IS-IS Route Convergence
Pre-configuration Tasks
Before configuring IS-IS route convergence, configure basic IS-IS functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the IS-IS Route Convergence Control Configuration) in any sequence.
7.11.1 Configuring Attributes for Hello Packets
Context
IS-IS maintains neighbor relationships between neighbors by sending and
receiving Hello packets. If the local device does not receive Hello packets from its
neighbor within a specified period, the device considers the neighbor Down.
In IS-IS, you can set the interval for sending Hello packets and the holding
multiplier of neighboring devices to control the holdtime of neighbor relationships
between the local device and neighbors.
● If the interval for sending Hello packets is too short, more system resources
are consumed to send Hello packets, causing a heavy CPU load.
● If the holdtime of neighboring devices is too long, the local device needs to
spend much time detecting the failure of neighbors, slowing down IS-IS route
convergence. If the holdtime of neighboring devices is too short, some Hello
packets may be lost or become incorrect because of network transmission
delay and errors. This will cause neighbor relationships to frequently alternate
between Up and Down and lead to route flapping on the IS-IS network.
NOTE
You are advised to set the same interval for sending Hello packets and same holding
multiplier of neighboring devices on all the devices on the IS-IS network. This method
prevents IS-IS route convergence from being slowed down when some devices detect
link failures at a lower speed than other devices.
Procedure
● Configure the interval for sending Hello packets.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 552
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run isis timer hello
hello-interval [ level-1 | level-2 ] [ conservative ]
The interval for sending Hello packets is set on an interface.
By default, the interval for sending Hello packets 10 seconds.
NOTE
Parameters level-1 and level-2 are configured only on broadcast interfaces.
On a broadcast link, there are Level-1 and Level-2 Hello packets. For different
types of packets, you can set different intervals. If no level is specified, both the
Level-1 timer and Level-2 timer are configured. On a P2P link, there is only one
type of Hello packets. Therefore, neither level-1 nor level-2 is required.
● Set the holding multiplier for neighboring devices.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run isis timer holding-multiplier
number [ level-1 | level-2 ]
The holding multiplier of neighboring devices is set.
The default holding multiplier is 3. The holdtime of neighbor
relationships is three times the interval for sending Hello packets.
NOTE
Parameters level-1 and level-2 are configured only on broadcast interfaces.
----End
7.11.2 Configuring Attributes for LSPs
Context
LSPs are used to exchange link state information. You can configure attributes for
LSPs to control the length and maximum lifetime of LSPs. To accelerate network
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 553
convergence, you can enable LSP fast flooding or reduce the minimum interval for
sending LSPs and the interval for updating LSPs to speed up LSP flooding.
However, too many CPU resources will be consumed if the network topology
changes frequently. In this situation, configure the intelligent timer for generating
LSPs. This timer can quickly respond to emergencies, speed up network
convergence, and improve CPU resource efficiency because its interval becomes
longer when the network changes frequently. The function and implementation of
different parameter configurations are shown in the following table.
Parameter
Configuratio
n
Function Implementation
Set the
maximum
length for
LSPs
Set the
size for
LSPs to be
generated
and LSPs
to be
received.
When the volume of link status information
increases, the length of LSPs to be generated can
be increased to carry more information in each LSP.
Set the
maximum
lifetime for
LSPs
Set the
maximum
lifetime
for LSPs to
ensure the
validity of
an LSP
before its
updated
LSP is
received.
When a switch generates the system LSP, it fills in
the maximum lifetime for this LSP. After this LSP is
received by other switches, the lifetime of the LSP
is reduced gradually. If the switch does not receive
any more update LSPs and the lifetime of the LSP is
reduced to 0, the LSP will be deleted from the LSDB
60s later if no more updated LSPs are received.
Set the
refresh
interval for
LSPs
Set the
refresh
interval
for LSPs to
synchroniz
e LSDBs.
On an IS-IS network, LSDB synchronization is
implemented through LSP flooding. During LSP
flooding, a switch sends an LSP to its neighbors
and then the neighbors send the received LSP to
their respective neighbors except the switch that
first sends the LSP. In this manner, the LSP is
flooded among the switches of the same level. LSP
flooding allows each switch of the same level to
have the same LSP information and synchronize its
LSDB with each other.
Set the
minimum
interval at
which LSPs
are sent
Set the
interval
for
sending
an LSP
during LSP
update.
Reducing the minimum interval for sending LSPs
speeds up LSP flooding.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 554
Parameter
Configuratio
n
Function Implementation
Configure
the
intelligent
timer used to
generate
LSPs
Control
the
interval
for
generating
LSPs
intelligentl
y to speed
up route
convergen
ce and
reduce
system
load.
On an IS-IS network, if the local routing
information changes, a switch needs to generate a
new LSP to notify this change. If the local routing
information changes frequently, a large number of
new LSPs are generated. This occupies a lot of
system resources and decreases system
performance. To speed up network convergence
and prevent system performance from being
affected, configure an intelligent timer for
generating LSPs. This timer can adjust the delay in
generating LSPs based on the routing information
change frequency.
Enable LSP
fast flooding
Control
the
number of
LSPs
flooded
each time
on an
interface
to speed
up IS-IS
network
convergen
ce.
When an IS-IS switch receives new LSPs from other
switches, it updates the LSPs in the local LSDB and
periodically floods out the updated LSPs according
to a timer. LSP fast flooding updates the preceding
method. When a device configured with LSP fast
flooding receives one or more new LSPs, it floods
out the LSPs with a number smaller than the
specified number before calculating routes. This
speeds up LSDB synchronization.
Set an
interval at
which LSPs
are
retransmitted
over a P2P
link
Control
the
interval
for
retransmit
ting LSPs
to ensure
LSDB
synchroniz
ation on a
P2P
network.
On a point-to-point network, devices at both ends
of a link synchronize LSDBs with each other by
flooding LSPs. The device at one end of the link
sends an LSP. If the device at the other end receives
this LSP, it replies with a PSNP. If the device that
has sent an LSP does not receive a PSNP from the
other end in a period of time, the device will
retransmit the LSP.
Procedure
● Set the maximum length for LSPs.
a. Run system-view
The system view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 555
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Set the maximum length for LSPs.
▪ Run lsp-length originate
max-size
The maximum length is set for each generated LSP.
▪ Run lsp-length receive
max-size
The maximum length is set for each received LSP.
By default, the IS-IS system generates and receives 1497-byte LSPs.
NOTE
Ensure that the value of
max-size for LSPs to be generated is less than or equal
to the value of
max-size for LSPs to be received.
The value of
max-size set through the lsp-length command must meet the
following requirements; otherwise, the MTU status on the interface is considered
Down.
● The MTU of an Ethernet interface must be greater than or equal to the sum
of the value of
max-size and 3.
● The MTU of a P2P interface must be greater than or equal to the value of
max-size.
● Set the maximum lifetime for LSPs.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run timer lsp-max-age
age-time
The maximum lifetime is set for LSPs.
By default, the maximum lifetime of LSPs is 1200 seconds.
● Set the refresh interval for LSPs.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run timer lsp-refresh
refresh-time
A refresh interval is set for LSPs.
By default, the LSP refresh interval is 900s.
NOTE
Ensure that the LSP refresh interval is at least 300s less than the maximum LSP
lifetime. This allows new LSPs to reach all devices in an area before existing LSPs
expire.
The larger a network, the greater the deviation between the LSP refresh interval
and the maximum LSP lifetime.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 556
● Set the minimum interval at which LSPs are sent.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run isis timer lsp-throttle
throttle-interval [ count
count ]
The minimum interval for sending LSPs on an IS-IS interface and the
maximum number of LSPs sent within the interval are set.
By default, the minimum interval for sending LSPs is 50 ms, and the
maximum number of LSPs sent each time is 10.
● Configure the intelligent timer used to generate LSPs.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run timer lsp-generation
max-interval [
init-interval [
incr-interval ] ]
[ level-1 | level-2 ]
The intelligent timer used to generate LSPs is set.
If no level is configured, both Level-1 and Level-2 are configured.
The initial delay for generating the same LSPs (or LSP fragments) is
init-
interval. The delay for generating the same LSPs (or LSP fragments) in
the next iteration is
incr-interval. When the routes change each time, the
delay for generating the same LSPs (or LSP fragments) is twice as the
previous value until the delay is up to
max-interval. After the delay
reaches
max-interval for three times or the IS-IS process is reset, the
interval is reduced to
init-interval.
When
incr-interval is not used and the same LSPs (or LSP fragments) are
generated for the first time,
init-interval is used as the initial delay. Then,
the delay for generating the same LSPs (or LSP fragments) is
max-
interval. After the delay reaches
max-interval for three times or the IS-IS
process is reset, the interval is reduced to
init-interval.
When only
max-interval is used, the intelligent timer changes into a
normal one-short timer.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 557
● Enable LSP fast flooding.
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run flash-flood [
lsp-count | max-timer-interval
interval | [ level-1 |
level-2 ] ]*
The LSP fast flooding is enabled.
The
lsp-count parameter specifies the number of LSPs flooded each time,
which is applicable to all interfaces. If the number of LSPs to be sent is
greater than the value of
lsp-count,
lsp-count takes effect. If the number
of LSPs to be sent is less than the value of
lsp-count, all the LSPs are
sent. If a timer is configured and the configured timer does not expire
before the route calculation, the LSPs are flooded immediately when
being received; otherwise, the LSPs are sent when the timer expires.
When LSP fast flooding is enabled, Level-1 LSPs and Level-2 LSPs are fast
flooded by default if no level is specified.
● Set an interval at which LSPs are retransmitted over a P2P link.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. (Optional) Run isis circuit-type p2p [ strict-snpa-check ]
A broadcast interface is simulated as a P2P interface.
NOTE
If the interface type is P2P, this step is not required.
e. Run isis timer lsp-retransmit
retransmit-interval
The interval at which LSPs are retransmitted over a P2P link is set.
By default, the interval for retransmitting LSPs over a P2P link is 5
seconds.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 558
7.11.3 Configuring Attributes for CSNPs
Context
Complete sequence number PDUs (CSNPs) contain summaries of all the LSPs in
an LSDB to ensure LSDB synchronization between neighbors. CSNPs are processed
differently on broadcast and P2P links.
● On a broadcast link, CSNPs are periodically sent by a DIS device. If a device
detects that its LSDB is not synchronized with that on its neighboring device,
the device will send PSNPs to apply for missing LSPs.
● On a P2P link, CSNPs are sent only during initial establishment of neighboring
relationships.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run isis timer csnp
csnp-interval [ level-1 | level-2 ]
The interval at which CSNPs are sent is set on the specified interface.
By default, the interval at which CSNPs are sent on a broadcast network is 10
seconds.
NOTE
Configure Level-1 and Level-2 only when a broadcast interface is specified.
----End
7.11.4 Setting the SPF Calculation Interval
Context
A network change always triggers IS-IS to perform SPF calculation. Frequent SPF
calculation will consume excessive CPU resources, affecting services.
To solve this problem, configure an intelligent timer to control the interval for SPF
calculation. For example, to speed up IS-IS route convergence, set the interval for
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 559
SPF calculation to a small value and set the interval to a large value after the IS-IS
network becomes stable.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run timer spf
max-interval [
init-interval [
incr-interval ] ]
The SPF intelligent timer is configured.
By default, no SPF intelligent timer is configured and the maximum delay in SPF
calculation is 5 seconds.
The intelligent timer changes as follows:
● The delay in the first SPF calculation is determined by
init-interval; the delay
in the second SPF calculation is determined by
incr-interval. From the third
time on, the delay in SPF calculation increases twice every time until the delay
reaches the value specified by
max-interval. After the delay remains at the
value specified by
max-interval for three times or the IS-IS process is
restarted, the delay decreases to the value specified by
init-interval.
● If
incr-interval is not specified, the delay in SPF calculation for the first time is
determined by
init-interval. From the second time on, the delay in SPF
calculation is determined by
max-interval. After the delay remains at the
value specified by
max-interval for three times or the IS-IS process is
restarted, the delay decreases to the value specified by
init-interval.
● When only
max-interval is specified, the intelligent timer functions as an
ordinary one-time triggering timer.
Step 4 (Optional) Run spf-slice-size
duration-time
The maximum duration for SPF calculation is configured.
By default, IS-IS route calculation lasts for a maximum of 2 ms at a time.
----End
7.11.5 Configuring Convergence Priorities for IS-IS Routes
Context
Devices allow you to configure the highest convergence priority for specific IS-IS
routes so that these IS-IS routes will be converged first when a network topology
changes.
The rules of applying convergence priorities for IS-IS routes are as follows:
● Existing IS-IS routes are converged based on the priorities configured in the
prefix-priority command.
● New IS-IS routes are converged based on the priorities configured in the
prefix-priority command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 560
● If an IS-IS route conforms to the matching rules of multiple convergence
priorities, the highest convergence priority is used.
● The convergence priority of a Level-1 IS-IS route is higher than that of a
Level-2 IS-IS route.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run prefix-priority [ level-1 | level-2 ] { critical | high | medium } { ip-prefix
prefix-name | tag
tag-value }
Convergence priorities are set for IS-IS routes.
By default, the convergence priority of 32-bit host routes is medium, and the
convergence priority of the other IS-IS routes is low.
NOTE
The prefix-priority command is only applicable to the public network.
After the prefix-priority command is run, the convergence priority of 32-bit host routes is
low, and the convergence priorities of the other routes are determined as specified in the
prefix-priority command.
----End
7.11.6 Verifying the IS-IS Route Convergence Control
Configuration
Procedure
● Run the display isis interface [ verbose ] [
process-id | vpn-instance
vpn-
instance-name ] command to check IS-IS packet information.
● Run the display isis route [
process-id | vpn-instance
vpn-instance-name ]
[ ipv4 ] [ verbose | [ level-1 | level-2 ] |
ip-address [
mask |
mask-length ] ] *
[ | count ] command to check IS-IS route information.
----End
7.12 Configuring LSP Fragment Extension
Pre-configuration Tasks
Before configuring LSP fragment extension, create IS-IS processes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 561
NOTE
When a new device connects to an IS-IS network, you are advised to configure LSP
fragment extension and virtual systems before establishing IS-IS neighbors or importing
routes. If you establish IS-IS neighbors or import routes without configuring LSP fragment
extension and virtual systems, IS-IS needs to carry much information, which cannot be
loaded through 256 fragments. You must then configure LSP fragment extension and virtual
systems, which will take effect only after you restart the IS-IS process.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run lsp-fragments-extend [ [ level-1 | level-2 | level-1-2 ] | [ mode-1 |
mode-2 ] ] *
LSP fragment extension is enabled in an IS-IS process.
By default, LSP fragment extension is disabled in an IS-IS process.
If the mode or level is not specified during the configuration of LSP fragment
extension, mode-1 and level-1-2 are used by default.
NOTE
If there are devices of other manufacturers on the network, LSP fragment extension must
be set to mode-1. Otherwise, devices of other manufacturers cannot identify LSPs.
Step 4 Run virtual-system
virtual-system-id
A virtual system is configured.
By default, no virtual system is configured.
To configure a switch to generate extended LSP fragments, you must configure at
least one virtual system. The ID of the virtual system must be unique in the
domain.
An IS-IS process can be configured with up to 50 virtual system IDs.
----End
Verifying the Configuration
Run the following commands to check IS-IS process statistics.
● display isis statistics [ updated-lsp [ history ] ] [ level-1 | level-2 |
level-1-2 ] [
process-id | vpn-instance
vpn-instance-name ]
● display isis
process-id statistics [ [ [ updated-lsp [ history ] ] [ level-1 |
level-2 | level-1-2 ] ] | [ packet ] ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 562
7.13 Configuring a Mesh Group on an NBMA Network
Pre-configuration Tasks
Before configuring a mesh group, configure basic IS-IS functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run isis mesh-group {
mesh-group-number | mesh-blocked }
The interface is added to a mesh group.
When mesh-blocked is configured on an interface, the interface is blocked and
cannot flood LSPs outside. All the interfaces added to a mesh group implement
global LSDB synchronization through CSNP and PSNP mechanisms.
----End
Verifying the Configuration
Run the following commands to check IS-IS process statistics.
● display isis statistics [ updated-lsp [ history ] ] [ level-1 | level-2 |
level-1-2 ] [
process-id | vpn-instance
vpn-instance-name ]
● display isis
process-id statistics [ [ [ updated-lsp [ history ] ] [ level-1 |
level-2 | level-1-2 ] ] | [ packet ] ]
7.14 Configuring IS-IS Reliability
Pre-configuration Tasks
Before configuring IS-IS reliability, configure basic IS-IS functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 563
Configuration Flowchart
You can perform the following configuration tasks (excluding the task of Verifying
the IS-IS Reliability Configuration) in any sequence.
7.14.1 Configuring Static BFD for IS-IS
Context
On an IS-IS network, a device periodically sends Hello packets to detect the
neighbor status change. By default, the device considers a neighbor Down when it
does not receive a Hello packet from the neighbor after sending three Hello
packets (30 seconds). This IS-IS fault detection mechanism, however, cannot
provide high reliability for the network that requires fast network convergence and
no packet loss. BFD for IS-IS can solve this problem. BFD is a millisecond-level
fault detection mechanism. It can fast detect faults on the link between IS-IS
neighbors. Therefore, BFD can speed up IS-IS route convergence, ensures fast link
switchover, and reduces traffic loss.
Compared to dynamic BFD, static BFD has the following characteristics:
● Static BFD can be manually controlled and is easy to deploy. To save memory
and ensure reliability of key links, BFD can be deployed on specified links.
● Establishing and deleting BFD sessions need to be manually triggered and
lack flexibility. Configuration errors may occur. For example, if an incorrect
local or remote discriminator is configured, a BFD session cannot work
properly.
NOTE
A BFD session currently does not detect route switching. If the change of bound peer IP
address causes a route to switch to another link, the BFD session is negotiated again only
when the original link fails.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support BFD for IS-IS.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run bfd
BFD is enabled globally.
Step 3 Run quit
The system view is displayed.
Step 4 Run bfd
cfg-name bind peer-ip
ip-address [ interface
interface-type interface-
number ]
BFD is enabled between the specified interface and peer router.
If a peer IP address and a local interface are specified in the bfd command, BFD
monitors only a single-hop link with the interface specified in the bfd command
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 564
as the outbound interface and with the peer IP address specified in the peer-ip
command as the next-hop address.
Step 5 Set discriminators.
● Run discriminator local
discr-value
A local discriminator is set.
● Run discriminator remote
discr-value
A remote discriminator is set.
The local discriminator of a device must be the remote discriminator of the device
on the other end; otherwise, a BFD session cannot be established. In addition, the
local and remote discriminators cannot be modified after being configured.
NOTE
The local discriminator of the local device must be the same as the remote discriminator of
the remote device, and the remote discriminator of the local device must be the same as
the local discriminator of the remote device.
Step 6 Run commit
Configurations are committed.
Step 7 Run quit
The system view is displayed.
Step 8 Run interface
interface-type interface-number
The view of the specified interface is displayed.
Step 9 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 10 Run isis bfd static
Static IPv4 BFD is enabled on the specified interface.
----End
Verifying the Configuration
You can check information about a BFD session only after parameters of the BFD
session are configured and the BFD session is established.
● Run the display isis [
process-id | vpn-instance
vpn-instance-name ] bfd
session { peer
ip-address | all } command to check information about the
BFD session.
● Run the display isis interface verbose command. The command output
shows that the status of static BFD for IS-IS process is Yes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 565
7.14.2 Configuring Dynamic BFD for IS-IS
Context
On an IS-IS network, a device periodically sends Hello packets to detect the
neighbor status change. By default, the device considers a neighbor Down when it
does not receive a Hello packet from the neighbor after sending three Hello
packets (30 seconds). This IS-IS fault detection mechanism, however, cannot
provide high reliability for the network that requires fast network convergence and
no packet loss. BFD for IS-IS can solve this problem. BFD is a millisecond-level
fault detection mechanism. It can fast detect faults on the link between IS-IS
neighbors. Therefore, BFD can speed up IS-IS route convergence, ensure fast link
switchover, and reduce traffic loss.
Dynamic BFD for IS-IS implements dynamic setup of BFD sessions. When a new
IS-IS neighbor relationship is set up, BFD is notified of the neighbor parameters
and the detection parameters (including source and destination IP addresses).
Then a BFD session will be established based on the received neighbor
parameters.
Dynamic BFD is more flexible than static BFD. In dynamic BFD, routing protocols
trigger the setup of BFD sessions, preventing the configuration errors caused by
manual configuration. Dynamic BFD is easy to configure and applies to the
scenarios where BFD needs to be configured on the entire network. Dynamic BFD
for IS-IS can fast detect neighbor status changes and implement fast network
convergence.
NOTE
A BFD session currently does not detect route switching. If the change of bound peer IP
address causes a route to switch to another link, the BFD session is negotiated again only
when the original link fails.
The priority of BFD configured on an interface is higher than that of BFD configured for a
process. If BFD session parameters are configured for both a process and an interface, the
parameters on the interface will be used to establish a dynamic BFD session.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support BFD for IS-IS.
Procedure
● Configure dynamic BFD for IS-IS in a specified IS-IS process.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is enabled globally.
c. Run quit
The system view is displayed.
d. Run isis
process-id
The IS-IS view is displayed.
e. Run bfd all-interfaces enable
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 566
BFD for IS-IS is enabled to establish a BFD session.
This command enables an IS-IS process to use default BFD parameters to
create BFD sessions on all the interfaces in the IS-IS process.
f. (Optional) Run bfd all-interfaces { min-rx-interval
receive-interval |
min-tx-interval
transmit-interval | detect-multiplier
multiplier-value } *
The parameters for establishing BFD sessions are set for all interfaces.
The command execution result is applicable to BFD session parameters
on all IS-IS interfaces.
g. (Optional) Run the isis bfd block command in the interface view:
The interface is prohibited from dynamically establishing a BFD session.
By default, an interface can dynamically establish BFD sessions.
● Configure dynamic BFD for IS-IS on a specified interface.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is enabled globally.
c. Run quit
The system view is displayed.
d. Run interface
interface-type interface-number
The interface view is displayed.
e. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
f. Run isis bfd enable
BFD is enabled on the interface to establish a BFD session.
After BFD is configured globally and the neighbor status is Up (on a
broadcast network, DIS is in the Up state), default BFD parameters will
be used to establish BFD sessions on the specified interface.
g. (Optional) Run isis bfd { min-rx-interval
receive-interval | min-tx-
interval
transmit-interval | detect-multiplier
multiplier-value } *
Run this command when BFD session parameters need to be configured
for a specified interface.
h. (Optional) Run isis bfd block
The interface is prohibited from dynamically establishing a BFD session.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 567
Verifying the Configuration
After BFD is enabled on both ends of a link, run the display isis [
process-id | vpn-
instance
vpn-instance-name ] bfd session { all | peer
ip-address | interface
interface-type interface-number } command. The command output shows that
BFD status is up.
7.14.3 Enabling IS-IS GR
Context
The restart of an IS-IS switch causes the temporary interruption of the network,
because the adjacency relationship between the switch and its neighbor is torn
down. The LSPs of the switch are deleted, which makes route calculation
inaccurate. Packets are thus lost.
You can configure IS-IS GR to solve this problem. After IS-IS GR is enabled, the
switch notifies the neighbor of the restart status, and reestablishes the adjacency
relationship with its neighbor without interrupting the forwarding.
The GR interval is set as the Holdtime in an IS-IS Hello PDU. Therefore, the
adjacency relationship is not torn down when the switch restarts.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run graceful-restart
IS-IS GR is enabled.
By default, IS-IS GR is disabled.
Step 4 Run graceful-restart no-impact-holdtime
The holdtime of an IS-IS neighbor is configured to remain unchanged in IS-IS GR
mode.
Step 5 (Optional) Run graceful-restart interval
interval-value
A value is configured for the T3 timer during the IS-IS GR.
The value of the T3 timer indicates the longest time that a GR lasts. A router
disables the T3 timer after the LSDB synchronization ends in all areas. If LSDBs are
not synchronized yet when the T3 timer expires, the GR fails.
By default, the value of the T3 timer is 300 seconds. Keeping the default value is
recommended.
During a GR, an IS-IS neighbor of the restarter sets the value of the T3 timer to
the holdtime of the neighbor relationship between them, which prevents routes
from being recalculated on the whole network due to a neighbor disconnection
during the GR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 568
Step 6 (Optional) Run graceful-restart suppress-sa
The GR restarter is configured to suppress the Suppress-Advertisement (SA) bit of
the restart TLV.
By default, the SA bit is not suppressed.
----End
Verifying the Configuration
Run display isis graceful-restart status [ level-1 | level-2 ] [
process-id | vpn-
instance
vpn-instance-name ] command to check the status of IS-IS GR.
7.15 Configuring IPv4 IS-IS Auto FRR
IS-IS Auto FRR can fast switch traffic to a backup link, ensuring millisecond-level
traffic interruption. This protects traffic and improves IS-IS network reliability.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support IS-IS Auto FRR.
7.15.1 Enabling IPv4 IS-IS Auto FRR
Context
Perform the following steps on the switch that needs the protection for the
forwarded traffic:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS process is enabled and the IS-IS view is displayed.
Step 3 Run frr
The IS-IS Auto FRR view is displayed.
Step 4 (Optional) Run frr-policy route route-policy
route-policy-name
Backup routes are filtered using a filtering policy. Only backup routes that have
passed the filtering policy are added to the routing table.
Step 5 Run loop-free-alternate [ level-1 | level-2 | level-1-2 ]
IS-IS Auto FRR is enabled and the loop-free backup route is created.
If the IS-IS level is not specified, IS-IS Auto FRR is enabled on Level-1 and Level-2
to create the backup route.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 569
NOTE
IS-IS can create the loop-free backup route only if the interface cost is in compliance with
the traffic protection inequality of IS-IS Auto FRR.
----End
7.15.2 (Optional) Disabling an Interface from Being Involved
in IPv4 LFA Calculation
Context
IS-IS Auto FRR can fast switch traffic to a backup link, ensuring millisecond-level
traffic interruption. This protects traffic and improves IS-IS network reliability.
Perform the following steps on the IS-IS interface to be disabled from participating
in the Loop-Free Alternate (LFA) calculation:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 Run undo isis lfa-backup [ level-1 | level-2 | level-1-2 ]
The interface is disabled from participating in the LFA calculation.
----End
7.15.3 Verifying the IPv4 IS-IS Auto FRR Configuration
Prerequisites
All IS-IS Auto FRR configurations are complete.
Procedure
● Run the display isis route [
process-id | vpn-instance
vpn-instance-name ]
[ ipv4 ] [ verbose | [ level-1 | level-2 ] |
ip-address [
mask |
mask-length ] ] *
command to check information about the primary link and backup link after
IS-IS Auto FRR is enabled.
● Run the display isis spf-tree [ systemid
systemid | dname
dname ]
[ [ level-1 | level-2 ] | ipv6 | verbose ] * [
process-id | vpn-instance
vpn-
instance-name ] command to check the traffic protection type of IS-IS Auto
FRR.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 570
7.16 Configuring the Overload Bit for an IS-IS Device
Pre-configuration Tasks
Before configuring the overload bit for an IS-IS device, configure basic IS-IS
functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run set-overload [ on-startup [
timeout1 | start-from-nbr
system-id [
timeout1
[
timeout2 ] ] | wait-for-bgp [
timeout1 ] ] [ send-sa-bit [
timeout3 ] ] ] [ allow
{ interlevel | external }* ]
The overload bit for non-pseudonode LSPs is configured.
----End
Verifying the Configuration
● Run the display isis lsdb [ [ level-1 | level-2 ] | verbose | [ local |
lsp-id | is-
name
symbolic-name ] ] * [
process-id | vpn-instance
vpn-instance-name ]
command to check information in the IS-IS LSDB.
7.17 Configuring IS-IS Neighbor Relationship Flapping
Suppression
Usage Scenario
If an interface carrying IS-IS services alternates between Up and Down, IS-IS
neighbor relationship flapping occurs on the interface. During the flapping, IS-IS
reestablishes the neighbor relationship and recalculates routes. In this process, a
large number of packets are exchanged, adversely affecting neighbor relationship
stability, IS-IS services, and other IS-IS-dependent services, such as LDP and BGP.
IS-IS neighbor relationship flapping suppression can address this problem by
delaying IS-IS neighbor relationship reestablishment or preventing service traffic
from passing through flapping links.
NOTE
The following steps are optional, choose them as required.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 571
Pre-configuration Tasks
Before configuring IS-IS neighbor relationship flapping suppression, complete the
following tasks:
● Configure an IP address for each interface to ensure that neighboring routers
are reachable at the network layer.
● Configure basic IPv4 IS-IS functions.
Procedure
Step 1 Run system-view
The system view is displayed.
By default, IS-IS neighbor relationship flapping suppression is enabled globally. To
disable this function globally, run the suppress-flapping peer disable command
in the IS-IS view.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
By default, IS-IS neighbor relationship flapping suppression is enabled on all
interfaces in the same IS-IS process. To disable the function from one of the
interfaces, run the isis suppress-flapping peer disable command.
Step 3 Run isis suppress-flapping peer hold-down
interval
The Hold-down mode is configured, and its duration is set.
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes
during neighbor relationship establishment, interfaces prevent neighbor
relationship reestablishment during Hold-down suppression, which minimizes
synchronization attempts and packet exchanges.
● Hold-max-cost mode: If the traffic forwarding path changes frequently,
interfaces use the maximum value (16777214 for the wide mode and 63 for
the narrow mode) as the cost of the flapping link during Hold-max-cost
suppression, which prevents traffic from passing through the flapping link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode.
By default, the Hold-down mode is disabled, but the Hold-max-cost mode is
enabled.
To disable this mode, run the isis suppress-flapping peer hold-max-cost disable
command.
Step 4 Run isis suppress-flapping peer { detecting-interval
detecting-interval |
threshold
threshold | resume-interval
resume-interval } *
Detection parameters are configured for IS-IS neighbor relationship flapping
suppression.
Each IS-IS interface that has IS-IS neighbor relationship flapping suppression
enabled starts a flapping counter. If the interval between two successive neighbor
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 572
status changes from Full to a non-Full state is shorter than
detecting-interval, a
valid flapping_event is recorded, and the flapping_count is incremented by 1.
When the flapping_count reaches or exceeds
threshold, flapping suppression takes
effect. If the interval between two successive neighbor status changes from Full to
a non-Full state is longer than
resume-interval, the flapping_count is reset.
NOTE
The value of
resume-interval must be greater than that of
detecting-interval.
By default, the detection interval of IS-IS neighbor relationship flapping
suppression is 60s, the suppression threshold is 10, and the interval for exiting
from suppression is 120s. Using the default detection parameters is recommended.
Step 5 Run quit
The system view is displayed.
Step 6 Run quit
The user view is displayed.
Step 7 Run reset isis
process-id suppress-flapping peer [ interface
interface-type
interface-number ] [ notify-peer ]
Interfaces are forced to exit from IS-IS neighbor relationship flapping suppression.
Interfaces exit from flapping suppression in the following scenarios:
● The suppression timer expires.
● The corresponding IS-IS process is reset.
● An IS-IS neighbor is reset using the reset isis peer command.
● IS-IS neighbor relationship flapping suppression is disabled globally using the
suppress-flapping peer disable (IS-IS) command in the IS-IS view.
● The reset isis suppress-flapping peer command is run.
● Suppression is aborted forcibly using the reset isis
process-id suppress-
flapping peer [ interface
interface-type interface-number ] notify-peer
command on the remote device.
----End
Verifying the Configurations
Run the display isis [
process-id ] interface
interface-type interface-number
verbose command to check the status of IS-IS neighbor relationship flapping
suppression.
<HUAWEI> display isis interface verbose
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif100 001 Up Down 1497 L1/L2 No/No
Circuit MT State : Standard
Description :
SNPA Address : xxxx-xxxx-xxxx
IP Address : 10.1.1.5
IPV6 Link Local Address :
IPV6 Global Address (es) :
Csnp Timer Value : L1 10 L2 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 573
Hello Timer Value : L1 10 L2 10
DIS Hello Timer Value : L1 3 L2 3
Hello Multiplier Value : L1 3 L2 3
LSP-Throttle Timer : L12 50
Cost : L1 10 L2 10
Ipv6 Cost : L1 10 L2 10
Priority : L1 64 L2 64
Retransmit Timer Value : L12 5
Bandwidth-Value : Low 1000000000 High 0
Static Bfd : NO
Dynamic Bfd : NO
Dynamic IPv6 Bfd : NO
Fast-Sense Rpr : NO
Suppress flapping peer : enable (flapping-count: 0, threshold: 10)
Suppress flapping peer in the command output indicates the current suppression
mode (enable), time when the flapping suppression started, and the remaining
time of the flapping suppression.
7.18 Maintaining IS-IS
7.18.1 Resetting IS-IS
Context
To reset IS-IS, reset IS-IS data structure, neighbor relationship and packets
NOTICE
The IS-IS data structure cannot be restored after you reset it. All the previous
structure information and the neighbor relationship are reset. Exercise caution
when running this command.
The specified IS-IS neighbor relationship is deleted after you reset a specified IS-IS
neighbor. Exercise caution when running this command.
Procedure
● Reset IS-IS data structure.
Run the reset isis all[
process-id | vpn-instance
vpn-instance-name ]
command to reset IS-IS data structure.
● Reset IS-IS neighbor relationship.
Run the reset isis peer
system-id [
process-id | vpn-instance
vpn-instance-
name ] command to reset a specific IS-IS neighbor.
After the IS-IS routing policy or the protocol changes, you can reset a specific
IS-IS neighbor to validate the new configuration.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 574
7.18.2 Improving the Maintainability of IS-IS
Context
The administrator can improve the maintainability of IS-IS using either of the
following methods:
● Configuring IS-IS host name mapping: Through this function, the
administrator can use a simple name to replace the system ID. After IS-IS host
name mapping is configured, the dynamic name is displayed in the IS-IS
information to replace the system ID when the display command is executed.
This improves the maintainability of IS-IS networks.
● Configuring IS-IS to add the POI TLV to a PURGE packet: When the value of
the Remaining Lifetime field in an LSP packet is 0, this packet is invalid and
called a PURGE packet. PURGE packets do not record information about the
devices generating these packets. Therefore, when a network is faulty, the
packet source cannot be located. To solve this problem, IS-IS can be
configured to add the POI TLV to a PURGE packet so that the PURGE packet
contains information about its generating device. If the dynamic host name
function is configured locally, the host name TLV is also added to the PURGE
packet to facilitate fault location.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Configure IS-IS host name mapping.
● Run is-name
symbolic-name
IS-IS dynamic host name mapping is configured and a host name is
configured for the local device.
This configuration is dynamic configuration. Therefore, the configured host
name
symbolic-name is advertised through an LSP to other IS-IS devices in
the same area. When you use IS-IS display commands to view IS-IS
information on other IS-IS devices, the system ID of the local device is
replaced by the configured host name.
● Run is-name map
system-id symbolic-name
IS-IS static host name mapping is configured and a host name is configured
for the remote device.
This configuration is static configuration and takes effect only on the local
device. Therefore, the configured host name
symbolic-name is not advertised
through an LSP.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 575
7.18.3 Configuring the Output of IS-IS Adjacency Status
Context
On an IS-IS network, neighbor flapping will result in network instability and
frequent network convergence. This will consume lots of memory and may even
cause user traffic loss. Therefore, neighbor flapping needs to be rapidly located
and solved.
To rapidly locate problems in the case of neighbor flapping, enable the output of
IS-IS adjacency changes to log these changes.
If the local terminal monitor is enabled and the output of the IS-IS adjacency
status is enabled, IS-IS adjacency changes will be output to the router until the
output of the adjacency status is disabled.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run isis [
process-id ]
The IS-IS view is displayed.
Step 3 Run log-peer-change [ topology ]
The output of the adjacency status is enabled.
By default, the output of IS-IS adjacency changes is disabled.
----End
7.19 Configuration Examples for IPv4 IS-IS
7.19.1 Example for Configuring Basic IS-IS Functions
Networking Requirements
As shown in Figure 7-33, there are four switches (SwitchA, SwitchB, SwitchC, and
SwitchD) on the network. The four switches need to communicate with each
other. SwitchA and SwitchB can only process a small amount of data because they
have lower performance than the other two switches.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 576
Figure 7-33 Networking diagram of configuring basic IS-IS functions
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable IS-IS on each switch so that the switches can be interconnected.
Configure SwitchA and SwitchB as Level-1 devices to enable them to maintain
less data.
Procedure
Step 1 Create VLANs and add corresponding interfaces to the VLANs.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.2 24
[SwitchA-Vlanif10] quit
Step 3 Run the IS-IS progress on each Switch, specify the network entity title, and
configure the level.
# Configure SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 577
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-1
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] is-level level-1
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
# Configure SwitchD.
[SwitchD] isis 1
[SwitchD-isis-1] is-level level-2
[SwitchD-isis-1] network-entity 20.0000.0000.0004.00
[SwitchD-isis-1] quit
Step 4 Enable the IS-IS progress on each interface.
# Configure SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
# Configure SwitchB.
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable 1
[SwitchB-Vlanif20] quit
# Configure SwitchC.
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] isis enable 1
[SwitchC-Vlanif20] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] isis enable 1
[SwitchC-Vlanif30] quit
# Configure SwitchD.
[SwitchD] interface vlanif 30
[SwitchD-Vlanif30] isis enable 1
[SwitchD-Vlanif30] quit
[SwitchD] interface vlanif 40
[SwitchD-Vlanif40] isis enable 1
[SwitchD-Vlanif40] quit
Step 5 Verify the configuration.
# View the IS-IS LSDB of each Switch.
[SwitchA] display isis lsdb
Database information for ISIS(1)
--------------------------------
Level-1 Link State Database
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 578
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
-------------------------------------------------------------------------------
0000.0000.0001.00-00* 0x0000006e 0x953e 862 68 0/0/0
0000.0000.0002.00-00 0x0000006a 0xc015 766 68 0/0/0
0000.0000.0002.01-00 0x00000008 0xccb6 766 55 0/0/0
0000.0000.0003.00-00 0x00000086 0x529e 1155 111 1/0/0
0000.0000.0003.01-00 0x0000005e 0xf238 1155 55 0/0/0
Total LSP(s): 5
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
[SwitchB] display isis lsdb
Database information for ISIS(1)
--------------------------------
Level-1 Link State Database
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
-------------------------------------------------------------------------------
0000.0000.0001.00-00 0x0000006e 0x953e 899 68 0/0/0
0000.0000.0002.00-00* 0x0000006a 0xc015 808 68 0/0/0
0000.0000.0002.01-00* 0x00000008 0xccb6 808 55 0/0/0
0000.0000.0003.00-00 0x00000086 0x529e 1195 111 1/0/0
0000.0000.0003.01-00 0x0000005e 0xf238 1195 55 0/0/0
Total LSP(s): 5
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
[SwitchC] display isis lsdb
Database information for ISIS(1)
--------------------------------
Level-1 Link State Database
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
-------------------------------------------------------------------------------
0000.0000.0001.00-00 0x0000006e 0x953e 953 68 0/0/0
0000.0000.0002.00-00 0x0000006a 0xc015 859 68 0/0/0
0000.0000.0002.01-00 0x00000008 0xccb6 859 55 0/0/0
0000.0000.0003.00-00* 0x00000085 0x549d 937 111 1/0/0
0000.0000.0003.01-00* 0x0000005d 0xf437 937 55 0/0/0
Total LSP(s): 5
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
Level-2 Link State Database
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
-------------------------------------------------------------------------------
0000.0000.0003.00-00* 0x0000008a 0x513c 876 100 0/0/0
0000.0000.0004.00-00 0x00000063 0x48ad 761 84 0/0/0
0000.0000.0004.01-00 0x0000005b 0x3aef 761 55 0/0/0
Total LSP(s): 3
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
[SwitchD] display isis lsdb
Database information for ISIS(1)
--------------------------------
Level-2 Link State Database
LSPID Seq Num Checksum Holdtime Length ATT/P/OL
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 579
-------------------------------------------------------------------------------
0000.0000.0003.00-00 0x0000008a 0x513c 901 100 0/0/0
0000.0000.0004.00-00* 0x00000063 0x48ad 789 84 0/0/0
0000.0000.0004.01-00* 0x0000005b 0x3aef 789 55 0/0/0
Total LSP(s): 3
*(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended),
ATT-Attached, P-Partition, OL-Overload
# View the IS-IS routing table of each Switch. A default route is available in the
routing table of the Level-1 devices and the next hop is a Level-1-2 device. The
routing table of the Level-2 device contains all Level-1 and Level-2 routes.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
0.0.0.0/0 10 NULL Vlanif10 10.1.1.1 A/-/-/-
192.168.0.0/24 20 NULL Vlanif10 10.1.1.1 A/-/-/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 20 NULL Vlanif10 10.1.1.1 A/-/-/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
[SwitchB] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
0.0.0.0/0 10 NULL Vlanif20 10.1.2.1 A/-/-/-
192.168.0.0/24 20 NULL Vlanif20 10.1.2.1 A/-/-/-
10.1.1.0/24 20 NULL Vlanif20 10.1.2.1 A/-/-/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
[SwitchC] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
192.168.0.0/24 10 NULL Vlanif30 Direct D/-/L/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.16.1.0/24 20 NULL Vlanif30 192.168.0.2 A/-/-/-
192.168.0.0/24 10 NULL Vlanif30 Direct D/-/L/-
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 580
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
[SwitchD] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.16.1.0/24 10 NULL Vlanif40 Direct D/-/L/-
192.168.0.0/24 10 NULL Vlanif30 Direct D/-/L/-
10.1.1.0/24 20 NULL Vlanif30 192.168.0.1 A/-/-/-
10.1.2.0/24 20 NULL Vlanif30 192.168.0.1 A/-/-/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
isis 1
is-level level-1
network-entity 10.0000.0000.0001.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 20
#
isis 1
is-level level-1
network-entity 10.0000.0000.0002.00
#
interface Vlanif20
ip address 10.1.2.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchC configuration file
#
sysname SwitchC
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 581
#
vlan batch 10 20 30
#
isis 1
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.1.2.1 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 192.168.0.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 30 40
#
isis 1
is-level level-2
network-entity 20.0000.0000.0004.00
#
interface Vlanif30
ip address 192.168.0.2 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
return
7.19.2 Example for Configuring IS-IS Route Summarization
Networking Requirements
As shown in Figure 7-34, three switches run IS-IS to communicate with each
other. SwitchA is a Level-2 device, SwitchB is a Level-1-2 device, and SwitchC is a
Level-1 device. SwitchA is heavily loaded because there are too many routing
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 582
entries on the IS-IS network. Therefore, system resource consumption of SwitchA
needs to be reduced.
Figure 7-34 Networking diagram for configuring IS-IS route summarization
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP addresses for interfaces and enable IS-IS on each switch so that
the switches can be interconnected.
2. Configure route summarization on SwitchB to reduce the routing table size of
SwitchA without affecting data forwarding so that the system resource
consumption of SwitchA can be reduced.
Procedure
Step 1 Create VLANs and add corresponding interfaces to the VLANs.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 50
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 50
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] ip address 172.17.1.1 24
[SwitchA-Vlanif50] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 583
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-2
[SwitchA-isis-1] network-entity 20.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] isis enable 1
[SwitchA-Vlanif50] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] isis enable 1
[SwitchB-Vlanif10] quit
[SwitchB] interface vlanif 50
[SwitchB-Vlanif50] isis enable 1
[SwitchB-Vlanif50] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] is-level level-1
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] isis enable 1
[SwitchC-Vlanif20] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] isis enable 1
[SwitchC-Vlanif30] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] isis enable 1
[SwitchC-Vlanif40] quit
Step 4 Check the IS-IS routing table of SwitchA.
[SwitchA]display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
172.16.1.0/24 30 NULL Vlanif50 172.17.1.2 A/-/-/-
172.16.2.0/24 30 NULL Vlanif50 172.17.1.2 A/-/-/-
172.16.3.0/24 30 NULL Vlanif50 172.17.1.2 A/-/-/-
172.16.4.0/24 20 NULL Vlanif50 172.17.1.2 A/-/-/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
Step 5 Configure route summarization on SwitchB.
# Summarize 172.16.1.0/24, 172.16.2.0/24, 172.16.3.0/24, and 172.16.4.0/24 as
172.16.0.0/16 on SwitchB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 584
[SwitchB] isis 1
[SwitchB-isis-1] summary 172.16.0.0 255.255.0.0 level-1-2
[SwitchB-isis-1] quit
Step 6 Verify the configuration.
# Check the IS-IS routing table of SwitchA. The routing table contains the route
172.16.0.0/16 summarized from 172.16.1.0/24, 172.16.2.0/24, 172.16.3.0/24, and
172.16.4.0/24.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
172.16.0.0/16 20 NULL Vlanif50 172.17.1.2 A/-/-/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 50
#
isis 1
is-level level-2
network-entity 20.0000.0000.0001.00
#
interface Vlanif50
ip address 172.17.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 50
#
isis 1
network-entity 10.0000.0000.0002.00
summary 172.16.0.0 255.255.0.0 level-1-2
#
interface Vlanif10
ip address 172.16.4.2 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 172.17.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 585
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 50
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10 20 30 40
#
isis 1
is-level level-1
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 172.16.4.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 172.16.1.1 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 172.16.2.1 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 172.16.3.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 40
#
return
7.19.3 Example for Configuring DIS Election
Networking Requirements
As shown in Figure 7-35, four switches on the broadcast network communicate
using IS-IS. SwitchA and SwitchB are Level-1-2 devices, SwitchC is a Level-1 device,
and SwitchD is a Level-2 device. SwitchA with high performance needs to be
configured as a Level-2 DIS.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 586
Figure 7-35 Networking diagram for configuring DIS election
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IS-IS to enable network interconnectivity.
2. Configure the DIS priority of Switch A to 100 so that SwitchA can be elected
as a Level-2 DIS.
Procedure
Step 1 Create VLANs and add corresponding interfaces to the VLANs.
# Configure SwitchA. The configurations of Switch, SwitchB, SwitchC, and SwitchD
are similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
Step 3 View the MAC address of the VLANIF 10 interface on each Switch.
# View the MAC address of the VLANIF 10 interface on SwitchA.
[SwitchA] display interface Vlanif 10
Vlanif10 current state : UP
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 587
Line protocol current state : UP
Last line protocol up time : 2014-12-02 18:02:15 UTC+08:00
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is 10.1.1.1/24
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fc10-afec
Current system time: 2014-12-02 18:03:12+08:00
Input bandwidth utilization : --
Output bandwidth utilization : --
# View the MAC address of the VLANIF 10 interface on SwitchB.
[SwitchB] display interface Vlanif 10
Vlanif10 current state : UP
Line protocol current state : UP
Last line protocol up time : 2014-12-02 18:01:15 UTC+08:00
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is 10.1.1.2/24
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fccd-acdf
Current system time: 2014-12-02 18:02:12+08:00
Input bandwidth utilization : --
Output bandwidth utilization : --
# View the MAC address of the VLANIF 10 interface on SwitchC.
[SwitchC] display interface Vlanif 10
Vlanif10 current state : UP
Line protocol current state : UP
Last line protocol up time : 2014-12-02 18:03:15 UTC+08:00
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is 10.1.1.3/24
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fc50-25fe
Current system time: 2014-12-02 18:04:12+08:00
Input bandwidth utilization : --
Output bandwidth utilization : --
# View the MAC address of the VLANIF 10 interface on SwitchD.
[SwitchD] display interface Vlanif 10
Vlanif10 current state : UP
Line protocol current state : UP
Last line protocol up time : 2014-12-02 18:07:15 UTC+08:00
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is 10.1.1.4/24
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fcfd-305c
Current system time: 2014-12-02 18:08:12+08:00
Input bandwidth utilization : --
Output bandwidth utilization : --
Step 4 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 588
[SwitchB-Vlanif10] isis enable 1
[SwitchB-Vlanif10] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] is-level level-1
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
# Configure SwitchD.
[SwitchD] isis 1
[SwitchD-isis-1] network-entity 10.0000.0000.0004.00
[SwitchD-isis-1] is-level level-2
[SwitchD-isis-1] quit
[SwitchD] interface vlanif 10
[SwitchD-Vlanif10] isis enable 1
[SwitchD-Vlanif10] quit
# View information about the IS-IS neighbors of SwitchA.
[SwitchA] display isis peer
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0002 Vlanif10 0000.0000.0002.01 Up 9s L1(L1L2) 64
0000.0000.0003 Vlanif10 0000.0000.0002.01 Up 27s L1 64
0000.0000.0002 Vlanif10 0000.0000.0004.01 Up 28s L2(L1L2) 64
0000.0000.0004 Vlanif10 0000.0000.0004.01 Up 8s L2 64
Total Peer(s): 4
# View information about the IS-IS interface of SwitchA.
[SwitchA] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 No/No
# View information about the IS-IS interface of SwitchB.
[SwitchB] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 Yes/No
# View information about the IS-IS interface of SwitchD.
[SwitchD] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 No/Yes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 589
NOTE
When the default DIS priority is used, the interface on SwitchB has the greatest MAC
address among all the interfaces on the Level-1 Switches. Therefore, SwitchB is elected as
the Level-1 DIS. The interface on SwitchD has the greatest MAC address among all the
interfaces on the Level-2 Switches. Therefore, SwitchD is elected as the Level-2 DIS. The
Level-1 pseudonode is 0000.0000.0002.01. The Level-2 pseudonode is 0000.0000.0004.01.
Step 5 Set the DIS priority of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis dis-priority 100
[SwitchA-Vlanif10] quit
# View information about the IS-IS neighbors of SwitchA.
[SwitchA] display isis peer
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0002 Vlanif10 0000.0000.0001.01 Up 21s L1(L1L2) 64
0000.0000.0003 Vlanif10 0000.0000.0001.01 Up 27s L1 64
0000.0000.0002 Vlanif10 0000.0000.0001.01 Up 28s L2(L1L2) 64
0000.0000.0004 Vlanif10 0000.0000.0001.01 Up 30s L2 64
Total Peer(s): 4
Step 6 Verify the configuration.
# View information about the IS-IS interface of SwitchA.
[SwitchA] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 Yes/Yes
As shown in the output information, after the DIS priority of the IS-IS interface is
changed, SwitchA immediately becomes a Level-1 and Level-2 DIS and its
pseudonode is 0000.0000.0001.01.
# View information about the IS-IS neighbors and IS-IS interfaces on SwitchB.
[SwitchB] display isis peer
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0001 Vlanif10 0000.0000.0001.01 Up 7s L1(L1L2) 100
0000.0000.0003 Vlanif10 0000.0000.0001.01 Up 25s L1 64
0000.0000.0001 Vlanif10 0000.0000.0001.01 Up 7s L2(L1L2) 100
0000.0000.0004 Vlanif10 0000.0000.0001.01 Up 25s L2 64
Total Peer(s): 4
[SwitchB] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 No/No
# View information about the IS-IS neighbors and IS-IS interfaces on SwitchD.
[SwitchD] display isis peer
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 590
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0002 Vlanif10 0000.0000.0001.01 Up 28s L2 64
0000.0000.0001 Vlanif10 0000.0000.0001.01 Up 9s L2 100
Total Peer(s): 2
[SwitchD] display isis interface
Interface information for ISIS(1)
---------------------------------
Interface Id IPV4.State IPV6.State MTU Type DIS
Vlanif10 001 Up Down 1497 L1/L2 No/No
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 10
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
isis 1
network-entity 10.0000.0000.0001.00
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
isis dis-priority 100
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 591
#
isis 1
network-entity 10.0000.0000.0002.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10
#
isis 1
is-level level-1
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.1.3 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 10
#
isis 1
is-level level-2
network-entity 10.0000.0000.0004.00
#
interface Vlanif10
ip address 10.1.1.4 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
7.19.4 Example for Configuring IS-IS Load Balancing
Networking Requirements
As shown in Figure 7-36, switches run IS-IS to implement IP interworking.
Congestion of the network from SwitchA to destination address 172.17.1.0/24
needs to be relieved to improve network resource efficiency.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 592
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 7-36 Networking diagram for configuring IS-IS load balancing
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic IS-IS functions on each switch to implement IP interworking.
2. Configure load balancing to balance traffic from SwitchA to SwitchD between
SwitchB and SwitchC.
Procedure
Step 1 Configure VLANs that the related interfaces belong to.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20 50
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
[SwitchA] interface gigabitethernet 0/0/3
[SwitchA-GigabitEthernet0/0/3] port link-type trunk
[SwitchA-GigabitEthernet0/0/3] port trunk allow-pass vlan 50
[SwitchA-GigabitEthernet0/0/3] quit
Step 2 Assign an IP address to each VLANIF interface.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 593
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.1.2.1 24
[SwitchA-Vlanif20] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] ip address 172.16.1.1 24
[SwitchA-Vlanif50] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-2
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis enable 1
[SwitchA-Vlanif20] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] isis enable 1
[SwitchA-Vlanif50] quit
Step 4 Set the number of equal-cost routes for load balancing to 1 on SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] maximum load-balancing 1
[SwitchA-isis-1] quit
# View the routing table of SwitchA.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 30 NULL Vlanif10 10.1.1.2 A/-/-/-
172.16.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
192.168.0.0/24 20 NULL Vlanif10 10.1.1.2 A/-/-/-
192.168.1.0/24 20 NULL Vlanif20 10.1.2.2 A/-/-/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, U-Up/
Down Bit Set
As shown in the routing table, when the maximum number of equal-cost routes
for load balancing is set to 1, IS-IS selects 10.1.1.2 as the next hop to the
destination network 172.17.1.0. This is because IS-IS selects the route with next
hop 10.1.1.2 as the optimal route because SwitchB has a smaller system ID.
Step 5 Restore the default number of equal-cost routes for load balancing on SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] undo maximum load-balancing
[SwitchA-isis-1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 594
# View the routing table of SwitchA.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 30 NULL Vlanif10 10.1.1.2 A/-/-/-
Vlanif20 10.1.2.2
172.16.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
192.168.0.0/24 20 NULL Vlanif10 10.1.1.2 A/-/-/-
192.168.1.0/24 20 NULL Vlanif20 10.1.2.2 A/-/-/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, U-Up/
Down Bit Set
As shown in the routing table, the number of equal-cost routes for load balancing
is restored to the default value. Both the next hops of SwitchA, 10.1.1.2 (SwitchB)
and 10.1.2.2 (SwitchC) now become valid.
Step 6 (Optional) Set the preference for equal-cost routes on SwitchA.
[SwitchA] isis
[SwitchA-isis-1] nexthop 10.1.2.2 weight 1
[SwitchA-isis-1] quit
Step 7 Verify the configuration.
# View the routing table of SwitchA.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
172.17.1.0/24 30 NULL Vlanif20 10.1.2.2 A/-/-/-
172.16.1.0/24 10 NULL Vlanif50 Direct D/-/L/-
192.168.0.0/24 20 NULL Vlanif10 10.1.1.2 A/-/-/-
192.168.1.0/24 20 NULL Vlanif20 10.1.2.2 A/-/-/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
10.1.2.0/24 10 NULL Vlanif20 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, U-Up/
Down Bit Set
As shown in the routing table, the preference of the next hop 10.1.2.2 (SwitchC)
with the weight as 1, is higher than that of 10.1.1.2 (SwitchB), after the weight is
set for equal-cost routes. Therefore, IS-IS selects route with the next hop 10.1.2.2
as the optimal route.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 595
#
vlan batch 10 20 50
#
isis 1
is-level level-2
network-entity 10.0000.0000.0001.00
nexthop 10.1.2.2 weight 1
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.1.2.1 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 172.16.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 30
#
isis 1
is-level level-2
network-entity 10.0000.0000.0002.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 192.168.0.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 40
#
isis 1
is-level level-2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 596
network-entity 10.0000.0000.0003.00
#
interface Vlanif20
ip address 10.1.2.2 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 192.168.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 30 40 60
#
isis 1
is-level level-2
network-entity 10.0000.0000.0004.00
#
interface Vlanif30
ip address 192.168.0.2 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 192.168.1.2 255.255.255.0
isis enable 1
#
interface Vlanif60
ip address 172.17.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 60
#
return
7.19.5 Example for Configuring IS-IS Auto FRR (IP Protecting
IP)
Networking Requirements
As shown in Figure 7-37, four switches (SwitchA, SwitchB, SwitchC, and SwitchD)
communicate using IS-IS. Reliability of data forwarding from SwitchA to SwitchD
needs to be improved so that uninterrupted traffic transmission is ensured when a
fault occurs on the network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 597
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 7-37 Networking diagram of configuring IS-IS Auto FRR
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP addresses for interfaces and enable IS-IS on each switch to
ensure reachable routes between the switches.
2. Set a larger link cost (in compliance with the traffic protection inequality of
IS-IS Auto FRR) on GigabitEthernet0/0/2 of SwitchA to ensure that Link T
functions as the primary link to forward data from SwitchA to SwitchD.
3. Configure IS-IS Auto FRR on SwitchA to allow traffic to be fast switched to the
backup link without waiting for route convergence when a fault occurs on
Link T. This ensures uninterrupted traffic transmission.
Procedure
Step 1 Configure VLANs that interfaces belong to.
# Configure SwitchA. The configurations of SwitchB, SwitchC and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 598
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.0.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.2.0.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-1-2
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis enable 1
[SwitchA-Vlanif20] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] is-level level-1-2
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable 1
[SwitchB-Vlanif20] quit
[SwitchB] interface vlanif 30
[SwitchB-Vlanif30] isis enable 1
[SwitchB-Vlanif30] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] is-level level-1-2
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] isis enable 1
[SwitchC-Vlanif50] quit
# Configure SwitchD.
[SwitchD] isis 1
[SwitchD-isis-1] is-level level-1-2
[SwitchD-isis-1] network-entity 10.0000.0000.0004.00
[SwitchD-isis-1] quit
[SwitchD] interface vlanif 50
[SwitchD-Vlanif50] isis enable 1
[SwitchD-Vlanif50] quit
[SwitchD] interface vlanif 30
[SwitchD-Vlanif30] isis enable 1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 599
[SwitchD-Vlanif30] quit
[SwitchD] interface vlanif 40
[SwitchD-Vlanif40] isis enable 1
[SwitchD-Vlanif40] quit
Step 4 Set the cost of Vlanif20 on SwitchA to 30, and then check routing information.
# Configure the cost of Vlanif20 on SwitchA to 30.
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis cost 30
[SwitchA-Vlanif20] quit
# Check information about the link from SwitchA to SwitchD. Link T has a lower
cost, and thereby IS-IS optimally selects Link T to send traffic that is forwarded by
SwitchA.
[SwitchA] display isis route 192.168.1.1 verbose
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Dest : 192.168.1.0/24 Int. Cost : 30 Ext. Cost : NULL
Admin Tag : - Src Count : 1 Flags : A/-/L/-
Priority : Low
NextHop : Interface : ExitIndex :
10.1.0.2 Vlanif10 0x00000003
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Dest : 192.168.1.0/24 Int. Cost : 30 Ext. Cost : NULL
Admin Tag : - Src Count : 3 Flags : -/-/-/-
Priority : Low
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
# Run the display fib 192.168.1.1 verbose command on SwitchA to check the
forwarding entry from SwitchA to SwitchD.
[SwitchA] display fib 192.168.1.1 verbose
Route Entry Count: 1
Destination: 192.168.1.0 Mask : 255.255.255.0
Nexthop : 10.1.0.2 OutIf : Vlanif10
LocalAddr : 10.1.0.1 LocalMask: 0.0.0.0
Flags : DGU Age : 26sec
ATIndex : 0 Slot : 0
LspFwdFlag : 0 LspToken : 0x0
InLabel : NULL OriginAs : 0
BGPNextHop : 0.0.0.0 PeerAs : 0
QosInfo : 0x0 OriginQos: 0x0
NexthopBak : 0.0.0.0 OutIfBak : [No Intf]
LspTokenBak: 0x0 InLabelBak : NULL
LspToken_ForInLabelBak : 0x0
EntryRefCount : 0
VlanId : 0x0
BgpKey : 0
BgpKeyBak : 0
LspType : 0 Label_ForLspTokenBak : 0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 600
MplsMtu : 0 Gateway_ForLspTokenBak : 0.0.0.0
NextToken : 0x0 IfIndex_ForLspTokenBak : 0
Label_NextToken : 0 Label : 0
LspBfdState : 0
As shown in the command output, the traffic from SwitchA to SwitchD is only
forwarded through Link T.
Step 5 Enable IS-IS Auto FRR on SwitchA, and then check the routing information.
# Enable IS-IS Auto FRR on SwitchA.
[SwitchA] isis
[SwitchA-isis-1] frr
[SwitchA-isis-1-frr] loop-free-alternate
# Check information about the link from SwitchA to SwitchD. You can find that IS-
IS creates a backup link because IS-IS Auto FRR is enabled.
[SwitchA] display isis route 192.168.1.1 verbose
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-1 Forwarding Table
--------------------------------
IPV4 Dest : 192.168.1.0/24 Int. Cost : 30 Ext. Cost : NULL
Admin Tag : - Src Count : 1 Flags : A/-/L/-
Priority : Low
NextHop : Interface : ExitIndex :
10.1.0.2 Vlanif10 0x00000003
(B)10.2.0.2 Vlanif20 0x00000004
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Dest : 192.168.1.0/24 Int. Cost : 30 Ext. Cost : NULL
Admin Tag : - Src Count : 3 Flags : -/-/-/-
Priority : Low
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
U-Up/Down Bit Set
# Check the protection type for the traffic from SwitchA to SwitchD.
[SwitchA] display isis spf-tree systemid 0000.0000.0004 verbose
Shortest Path Tree for ISIS(1)
------------------------------
ISIS(1) Level-1 Shortest Path Tree
----------------------------------
0000.0000.0004.00
Distance : 20
Distance-URT : 20
Flags : SPT/V6_Islt
IPv4 Nexthops-URT : 1
(1) 10.1.0.2 IF:Vlanif10 NBR:0000.0000.0003.00
(B) 10.2.0.2 IF:Vlanif20 NBR:0000.0000.0002.00
TYPE:LOOP-FREE PROTECT:LINK-NODE
IPv4 Nexthops-MIGP : 0
IPv6 Nexthops : 0
Neighbors: 2 (Children:1 Parents:1 Others:0)
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 601
(1) 0000.0000.0003.02
Cost : 10
Flags : Parent
(2) 0000.0000.0004.03
Cost : 10
Flags : Child
ISIS(1) Level-2 Shortest Path Tree
----------------------------------
0000.0000.0004.00
Distance : 20
Distance-URT : 20
Flags : SPT/V6_Islt
IPv4 Nexthops-URT : 1
(1) 10.1.0.2 IF:Vlanif10 NBR:0000.0000.0003.00
(B) 10.2.0.2 IF:Vlanif20 NBR:0000.0000.0002.00
TYPE:LOOP-FREE PROTECT:LINK-NODE
IPv4 Nexthops-MIGP : 0
IPv6 Nexthops : 0
Neighbors: 2 (Children:1 Parents:1 Others:0)
(1) 0000.0000.0003.02
Cost : 10
Flags : Parent
(2) 0000.0000.0004.03
Cost : 10
Flags : Child
As shown in the preceding command output, link-node dual protection is enabled
from SwitchA to SwitchD.
# Run the display fib 192.168.1.1 verbose command on SwitchA to check the
backup forwarding entry from SwitchA to SwitchD.
[SwitchA] display fib 192.168.1.1 verbose
Route Entry Count: 1
Destination: 192.168.1.0 Mask : 255.255.255.0
Nexthop : 10.1.0.2 OutIf : Vlanif10 LocalAddr : 10.1.0.1 LocalMask: 0.0.0.0
Flags : DGU Age : 6sec
ATIndex : 0 Slot : 0
LspFwdFlag : 0 LspToken : 0x0
InLabel : NULL OriginAs : 0
BGPNextHop : 0.0.0.0 PeerAs : 0
QosInfo : 0x0 OriginQos: 0x0
NexthopBak : 10.2.0.2 OutIfBak : Vlanif20
LspTokenBak: 0x0 InLabelBak : NULL
LspToken_ForInLabelBak : 0x0
EntryRefCount : 0
VlanId : 0x0
BgpKey : 0
BgpKeyBak : 0
LspType : 0 Label_ForLspTokenBak : 0
MplsMtu : 0 Gateway_ForLspTokenBak : 0.0.0.0
NextToken : 0x0 IfIndex_ForLspTokenBak : 0
Label_NextToken : 0 Label : 0
LspBfdState : 0
As shown in the command output, the master link from SwitchA to SwitchD is
Link T, the relevant backup link follows the route with Vlanif20 as the outbound
interface and 10.2.0.2 as the next hop.
Step 6 Verify the configuration.
# Run the shutdown command on Vlanif50 of SwitchC to make the link down.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 602
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] shutdown
# Run the display fib 192.168.1.1 verbose command immediately on SwitchA to
check information about the route from SwitchA to SwitchD.
[SwitchA] display fib 192.168.1.1 verbose
Route Entry Count: 1
Destination: 192.168.1.0 Mask : 255.255.255.0
Nexthop : 10.2.0.2 OutIf : Vlanif20
LocalAddr : 10.2.0.1 LocalMask: 0.0.0.0
Flags : DGU Age : 124sec
ATIndex : 0 Slot : 0
LspFwdFlag : 0 LspToken : 0x0
InLabel : NULL OriginAs : 0
BGPNextHop : 0.0.0.0 PeerAs : 0
QosInfo : 0x0 OriginQos: 0x0
NexthopBak : 0.0.0.0 OutIfBak : [No Intf]
LspTokenBak: 0x0 InLabelBak : NULL
LspToken_ForInLabelBak : 0x0
EntryRefCount : 0
VlanId : 0x0
BgpKey : 0
BgpKeyBak : 0
LspType : 0 Label_ForLspTokenBak : 0
MplsMtu : 0 Gateway_ForLspTokenBak : 0.0.0.0
NextToken : 0x0 IfIndex_ForLspTokenBak : 0
Label_NextToken : 0 Label : 0
LspBfdState : 0
As shown in the command output, the traffic forwarded by the SwitchA is
switched to the backup link, with Vlanif20 as the outbound interface and 10.2.0.2
as the next hop.
NOTE
If a fault occurs on the network, IS-IS Auto FRR ensures the fast switchover of the traffic to
the backup link before the network convergence, and consequently protects traffic.
----End
Configuration Files
● Configuration file of SwitchA
#
sysname SwitchA
#
vlan batch 10 20
#
isis 1
network-entity 10.0000.0000.0001.00
frr
loop-free-alternate level-1
loop-free-alternate level-2
#
interface Vlanif10
ip address 10.1.0.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.2.0.1 255.255.255.0
isis enable 1
isis cost 30
#
interface GigabitEthernet0/0/1
port link-type trunk
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 603
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● Configuration file of SwitchB
#
sysname SwitchB
#
vlan batch 20 30
#
isis 1
network-entity 10.0000.0000.0002.00
#
interface Vlanif20
ip address 10.2.0.2 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 10.3.0.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
return
● Configuration file of SwitchC
#
sysname SwitchC
#
vlan batch 10 50
#
isis 1
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.0.2 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 10.4.0.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 50
#
return
● Configuration file of SwitchD
#
sysname SwitchD
#
vlan batch 30 40 50
#
isis 1
network-entity 10.0000.0000.0004.00
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 604
#
interface Vlanif50
ip address 10.4.0.2 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 10.3.0.2 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 192.168.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
return
7.19.6 Example for Configuring Static BFD for IS-IS
Networking Requirements
As shown in Figure 7-38, three routers are interconnected using IS-IS, and SwitchA
and SwitchB communicate with each other through a Layer 2 switch. When the
link between SwitchA and SwitchB is faulty, the two routers need to rapidly
respond to the fault and reestablish a neighbor relationship.
Figure 7-38 Networking diagram of configuring static BFD for IS-IS
NOTE
BFD for IS-IS cannot be used to detect the multi-hop link between SwitchA and SwitchC,
because the IS-IS neighbor relationship cannot be established between SwitchA and
SwitchC.
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP addresses for interfaces and enable IS-IS on each router to
ensure reachable routes between the routers.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 605
2. Enable static BFD for IS-IS on SwitchA and SwitchB so that routers can rapidly
detect link faults.
Procedure
Step 1 Configure VLANs that each interface belongs to.
# Configure SwitchA. The configurations of Switch, SwitchB and SwitchC are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign the IP addresses for VLANIF interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-2
[SwitchA-isis-1] network-entity aa.1111.1111.1111.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] is-level level-2
[SwitchB-isis-1] network-entity aa.2222.2222.2222.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] isis enable 1
[SwitchB-Vlanif10] quit
[SwitchB] interface vlanif 30
[SwitchB-Vlanif30] isis enable 1
[SwitchB-Vlanif30] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] is-level level-2
[SwitchC-isis-1] network-entity aa.3333.3333.3333.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] isis enable 1
[SwitchC-Vlanif30] quit
# After the preceding configurations, you can see that the neighbor relationship is
established between SwitchA and SwitchB.
[SwitchA] display isis peer
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 606
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
2222.2222.2222 Vlanif10 1111.1111.1111.01 Up 23s L2 64
Total Peer(s): 1
The IS-IS routing table of SwitchA contains the routes to SwitchB and SwitchC.
[SwitchA] display isis route
Route information for ISIS(1)
-----------------------------
ISIS(1) Level-2 Forwarding Table
--------------------------------
IPV4 Destination IntCost ExtCost ExitInterface NextHop Flags
-------------------------------------------------------------------------------
10.2.1.0/24 20 NULL Vlanif10 10.1.1.2 A/-/L/-
10.1.1.0/24 10 NULL Vlanif10 Direct D/-/L/-
Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, U-Up/
Down Bit Set
Step 4 Configure BFD.
# Enable BFD on SwitchA and configure a BFD session.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] bfd atob bind peer-ip 10.1.1.2 interface vlanif 10
[SwitchA-bfd-session-atob] discriminator local 1
[SwitchA-bfd-session-atob] discriminator remote 2
[SwitchA-bfd-session-atob] commit
[SwitchA-bfd-session-atob] quit
# Enable BFD on SwitchB and configure a BFD session.
[SwitchB] bfd
[SwitchB-bfd] quit
[SwitchB] bfd btoa bind peer-ip 10.1.1.1 interface vlanif 10
[SwitchB-bfd-session-btoa] discriminator local 2
[SwitchB-bfd-session-btoa] discriminator remote 1
[SwitchB-bfd-session-btoa] commit
[SwitchB-bfd-session-btoa] quit
After the preceding configurations are complete, run the display bfd session all
command on SwitchA or SwitchB, and you can see that the status of the BFD
session is Up.
The following uses the display on SwitchA as an example.
[SwitchA] display bfd session all
--------------------------------------------------------------------------------
Local Remote PeerIpAddr State Type InterfaceName
--------------------------------------------------------------------------------
1 2 10.1.1.2 Up S_IP_IF Vlanif10
--------------------------------------------------------------------------------
Total UP/DOWN Session Number : 1/0
Step 5 Enable IS-IS fast detection.
# Configure SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis bfd static
[SwitchA-Vlanif10] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 607
# Configure SwitchB.
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] isis bfd static
[SwitchB-Vlanif10] quit
Step 6 Verify the configuration.
# Enable debugging on SwitchA and export information to the VTY tunnel.
[SwitchA] info-center source bfd channel 1 log level debugging state on
[SwitchA] quit
<SwitchA> debugging isis circuit-information
<SwitchA> terminal debugging
<SwitchA> terminal logging
<SwitchA> terminal monitor
# Run the shutdown command on GigabitEthernet0/0/1 on SwitchB to simulate a
link fault.
[SwitchB]interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# On SwitchA, you can view the following log and debugging information, which
indicates that IS-IS deletes the neighbor relationship with SwitchB after being
notified by BFD of the fault.
May 19 2013 09:34:49+08:00 SwitchB %%01ISIS/4/PEER_DOWN_BFDDOWN(l)[2]:ISIS 1 ne
ighbor 2222.2222.2222 was Down on interface Vlanif2710 because the BFD node was d
own.
The Hello packet was received at 09:29:39 last time; the maximum interval for se
nding Hello packets was 8944; the local router sent 392 Hello packets and receiv
ed 2 packets; the type of the Hello packet was Lan Level-2.
Run the display isis route command or the display isis peer command on
SwitchA, and you can see that no information is displayed. This indicates that the
IS-IS neighbor relationship between SwitchA and SwitchB is deleted.
# After the configuration is checked, disable debugging on SwitchA.
<SwitchA> undo debugging isis circuit-information
<SwitchA> undo terminal debugging
<SwitchA> undo terminal logging
<SwitchA> undo terminal monitor
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 10
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchA configuration file
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 608
#
sysname SwitchA
#
info-center source BFD channel 1 log level debugging
#
vlan batch 10
#
bfd
#
isis 1
is-level level-2
network-entity aa.1111.1111.1111.00
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
isis bfd static
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
bfd atob bind peer-ip 10.1.1.2 interface Vlanif10
discriminator local 1
discriminator remote 2
commit
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 30
#
bfd
#
isis 1
is-level level-2
network-entity aa.2222.2222.2222.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
isis bfd static
#
interface Vlanif30
ip address 10.2.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
bfd btoa bind peer-ip 10.1.1.1 interface Vlanif10
discriminator local 2
discriminator remote 1
commit
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 30
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 609
#
isis 1
is-level level-2
network-entity aa.3333.3333.3333.00
#
interface Vlanif30
ip address 10.2.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
return
7.19.7 Example for Configuring Dynamic BFD for IS-IS
Networking Requirements
As shown in Figure 7-39, three routers are interconnected using IS-IS, and SwitchA
and SwitchB communicate with each other through a Layer 2 switch. When the
link that passes through the switch between SwitchA and SwitchB fails, the two
routers need to rapidly respond to the fault, and traffic can be switched to the link
that passes through SwitchC for forwarding.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 7-39 Networking diagram of configuring dynamic BFD for IS-IS
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP addresses for interfaces and enable IS-IS on each router to
ensure reachable routes between the routers.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 610
2. Set the IS-IS interface cost to control route selection of the routers to make
the link that passes through the switch from SwitchA to SwitchB as the
primary link and the link that passes through SwitchC as the backup link.
3. Configure dynamic BFD for IS-IS on SwitchA, SwitchB, and SwitchC so that
link faults can be detected rapidly and traffic can be switched to the backup
link for forwarding.
Procedure
Step 1 Configure VLANs that each interface belongs to.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Assign the IP addresses for VLANIF interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.3.3.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis
[SwitchA-isis-1] is-level level-2
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis enable 1
[SwitchA-Vlanif20] quit
# Configure SwitchB.
[SwitchB] isis
[SwitchB-isis-1] is-level level-2
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 50
[SwitchB-Vlanif50] isis enable 1
[SwitchB-Vlanif50] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable 1
[SwitchB-Vlanif20] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 611
[SwitchB] interface vlanif 40
[SwitchB-Vlanif40] isis enable 1
[SwitchB-Vlanif40] quit
# Configure SwitchC.
[SwitchC] isis
[SwitchC-isis-1] is-level level-2
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] isis enable 1
[SwitchC-Vlanif50] quit
# After the preceding configurations, run the display isis peer command. You can
see that the neighbor relationships are established between SwitchA and SwitchB,
and between SwitchA and SwitchC. The following uses the configuration of
SwitchA as an example.
[SwitchA] display isis peer
Peer information for ISIS(1)
System Id Interface Circuit Id State HoldTime Type PRI
-------------------------------------------------------------------------------
0000.0000.0003 Vlanif10 0000.0000.0001.02 Up 21s L2 64
0000.0000.0002 Vlanif20 0000.0000.0002.01 Up 9s L2 64
Total Peer(s): 2
# Switches have learned routes from each other. The following uses the routing
table of SwitchA as an example.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.2.2.0/24 ISIS-L2 15 20 D 10.3.3.2 Vlanif20
ISIS-L2 15 20 D 10.1.1.2 Vlanif10
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 ISIS-L2 15 20 D 10.3.3.2 Vlanif20
As shown in the routing table, the next-hop address of the route to 172.16.1.0/24
is 10.3.3.2, and traffic is transmitted on the primary link SwitchA→SwitchB.
Step 4 Set the interface cost.
# Configure SwitchA.
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis cost 5
[SwitchA-Vlanif20] quit
# Configure SwitchB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 612
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis cost 5
[SwitchB-Vlanif20] quit
Step 5 Configure BFD for IS-IS processes.
# Enable BFD for IS-IS on SwitchA.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] isis
[SwitchA-isis-1] bfd all-interfaces enable
[SwitchA-isis-1] quit
# Enable BFD for IS-IS on SwitchB.
[SwitchB] bfd
[SwitchB-bfd] quit
[SwitchB] isis
[SwitchB-isis-1] bfd all-interfaces enable
[SwitchB-isis-1] quit
# Enable BFD for IS-IS on SwitchC.
[SwitchC] bfd
[SwitchC-bfd] quit
[SwitchC] isis
[SwitchC-isis-1] bfd all-interfaces enable
[SwitchC-isis-1] quit
# After the preceding configurations, run the display isis bfd session all
command on SwitchA, SwitchB, and SwitchC. You can see that the BFD session
status is Up.
The following uses the display on SwitchA as an example.
[SwitchA] display isis bfd session all
BFD session information for ISIS(1)
-----------------------------------
Peer System ID : 0000.0000.0003 Interface : Vlanif10
TX : 1000 BFD State : up Peer IP Address : 10.1.1.2
RX : 1000 LocDis : 8193 Local IP Address: 10.1.1.1
Multiplier : 3 RemDis : 8193 Type : L2
Diag : No diagnostic information
Peer System ID : 0000.0000.0002 Interface : Vlanif20
TX : 1000 BFD State : up Peer IP Address : 10.3.3.2
RX : 1000 LocDis : 8192 Local IP Address: 10.3.3.1
Multiplier : 3 RemDis : 8192 Type : L2
Diag : No diagnostic information
Total BFD session(s): 2
As shown in the preceding display, the status of the BFD session between SwitchA
and SwitchB and that between SwitchA and SwitchC is Up.
Step 6 Configure BFD for IS-IS interfaces.
# Configure BFD on VLANIF20 of SwitchA, set the minimum interval for sending
packets to 100 ms, the minimum interval for receiving packets to 100 ms, and the
local detection multiplier to 4.
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] isis bfd enable
[SwitchA-Vlanif20] isis bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
[SwitchA-Vlanif20] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 613
# Configure BFD on VLANIF20 of SwitchB, set the minimum interval for sending
packets to 100 ms, the minimum interval for receiving packets to 100 ms, and the
local detection multiplier to 4.
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis bfd enable
[SwitchB-Vlanif20] isis bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
[SwitchB-Vlanif20] quit
# After the preceding configurations, run the display isis bfd session all
command on SwitchA or SwitchB. You can see that the BFD parameters have
taken effect. The following uses the display on SwitchB as an example.
[SwitchB] display isis bfd session all
BFD session information for ISIS(1)
-----------------------------------
Peer System ID : 0000.0000.0003 Interface : Vlanif50
TX : 1000 BFD State : up Peer IP Address : 10.2.2.1
RX : 1000 LocDis : 8192 Local IP Address: 10.2.2.2
Multiplier : 3 RemDis : 8193 Type : L2
Diag : No diagnostic information
Peer System ID : 0000.0000.0001 Interface : Vlanif20
TX : 100 BFD State : up Peer IP Address : 10.3.3.1
RX : 100 LocDis : 8192 Local IP Address: 10.3.3.2
Multiplier : 4 RemDis : 8192 Type : L2
Diag : No diagnostic information
Total BFD session(s): 2
Step 7 Verify the configuration.
# Run the shutdown command on GigabitEthernet0/0/2 of SwitchB to simulate a
primary link failure.
[SwitchB] interface gigabitethernet 0/0/2
[SwitchB-GigabitEthernet0/0/2] shutdown
Step 8 # View the routing table of SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 8
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.2.2.0/24 ISIS-L2 15 20 D 10.1.1.2 Vlanif10
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 ISIS-L2 15 30 D 10.1.1.2 Vlanif10
As shown in the routing table, the backup link SwitchA→SwitchC→SwitchB takes
effect after the primary link fails, and the next-hop address of the route to
172.16.1.0/24 becomes 10.1.1.2.
# Run the display isis bfd session all command on SwitchA. You can see that the
status of the BFD session between SwitchA and SwitchC is Up.
[SwitchA] display isis bfd session all
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 614
BFD session information for ISIS(1)
-----------------------------------
Peer System ID : 0000.0000.0003 Interface : Vlanif10
TX : 1000 BFD State : up Peer IP Address : 10.1.1.2
RX : 1000 LocDis : 8193 Local IP Address: 10.1.1.1
Multiplier : 3 RemDis : 8193 Type : L2
Diag : No diagnostic information
Total BFD session(s): 1
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 20
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
bfd
#
isis 1
is-level level-2
bfd all-interfaces enable
network-entity 10.0000.0000.0001.00
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.3.3.1 255.255.255.0
isis enable 1
isis cost 5
isis bfd enable
isis bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchB configuration file
#
sysname SwitchB
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 615
#
vlan batch 20 40 50
#
bfd
#
isis 1
is-level level-2
bfd all-interfaces enable
network-entity 10.0000.0000.0002.00
#
interface Vlanif20
ip address 10.3.3.2 255.255.255.0
isis enable 1
isis cost 5
isis bfd enable
isis bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 10.2.2.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10 50
#
bfd
#
isis 1
is-level level-2
bfd all-interfaces enable
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 10.2.2.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 50
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 616
7.19.8 Example for Configuring IS-IS GR
Networking Requirements
As shown in Figure 7-40, SwitchA, SwitchB, and SwitchC belong to the same
autonomous system. They run IS-IS to implement interworking and provide the GR
mechanism. When IS-IS is restarted on SwitchA, SwitchA resends connection
requests to neighbors to synchronize the LSDB.
Figure 7-40 Networking diagram of IS-IS GR configuration
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable IS-IS on each Switch so that the Switches can be interconnected.
2. Configure GR in the IS-IS view on each Switch and configure the same interval
for the restart.
Procedure
Step 1 Configure VLANs that the related interfaces belong to.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign an IP address to each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure basic IS-IS functions.
# Configure SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] is-level level-1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 617
[SwitchA-isis-1] network-entity 10.0000.0000.0001.00
[SwitchA-isis-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] isis enable 1
[SwitchA-Vlanif10] quit
# Configure SwitchB.
[SwitchB] isis 1
[SwitchB-isis-1] is-level level-2
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable 1
[SwitchB-Vlanif20] quit
# Configure SwitchC.
[SwitchC] isis 1
[SwitchC-isis-1] network-entity 10.0000.0000.0003.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] isis enable 1
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] isis enable 1
[SwitchC-Vlanif20] quit
Step 4 Configure IS-IS GR and set the restart interval.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] isis 1
[SwitchA-isis-1] graceful-restart
[SwitchA-isis-1] graceful-restart interval 150
[SwitchA-isis-1] quit
[SwitchA] quit
Step 5 Verify the configuration.
# Run the display fib command on SwitchA to view the Forwarding Information
Base (FIB) table.
<SwitchA> display fib
Route Flags: G - Gateway Route, H - Host Route, U - Up Route
S - Static Route, D - Dynamic Route, B - Black Hole Route
L - Vlink Route
--------------------------------------------------------------------------------
FIB Table:
Total number of Routes : 5
Destination/Mask Nexthop Flag TimeStamp Interface TunnelID
127.0.0.1/32 127.0.0.1 HU t[21] InLoop0 0x0
127.0.0.0/8 127.0.0.1 U t[21] InLoop0 0x0
10.1.1.1/32 127.0.0.1 HU t[20678] InLoop0 0x0
10.1.1.0/24 10.1.1.1 U t[20678] Vlanif10 0x0
10.2.1.0/24 10.1.1.2 DGU t[79388] Vlanif10 0x0
# Reset the IS-IS process by using the GR method on SwitchA.
<SwitchA> reset isis all graceful-restart
NOTE
The Switch restarts an IS-IS process in GR mode only when GR is enabled for the IS-IS
process.
# Run the display fib command on SwitchA and view the FIB table to check
whether GR works normally. If GR works normally, the FIB table does not change
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 618
and the forwarding service is not affected when SwitchA restarts the IS-IS process
in GR mode.
<SwitchA> display fib
Route Flags: G - Gateway Route, H - Host Route, U - Up Route
S - Static Route, D - Dynamic Route, B - Black Hole Route
L - Vlink Route
--------------------------------------------------------------------------------
FIB Table:
Total number of Routes : 5
Destination/Mask Nexthop Flag TimeStamp Interface TunnelID
127.0.0.1/32 127.0.0.1 HU t[21] InLoop0 0x0
127.0.0.0/8 127.0.0.1 U t[21] InLoop0 0x0
10.1.1.1/32 127.0.0.1 HU t[20678] InLoop0 0x0
10.1.1.0/24 10.1.1.1 U t[20678] Vlanif10 0x0
10.2.1.0/24 10.1.1.2 DGU t[79388] Vlanif10 0x0
As shown in the display, the FIB table on SwitchA does not change and the
forwarding service is not affected.
# Disable IS-IS GR on SwitchA.
<SwitchA> system-view
[SwitchA] isis 1
[SwitchA-isis-1] undo graceful-restart
[SwitchA-isis-1] quit
[SwitchA] quit
# Reset the IS-IS process on SwitchA (not in GR mode).
<SwitchA> reset isis all
# Run the display fib command on SwitchA to view the FIB table.
<SwitchA> display fib
Route Flags: G - Gateway Route, H - Host Route, U - Up Route
S - Static Route, D - Dynamic Route, B - Black Hole Route
L - Vlink Route
--------------------------------------------------------------------------------
FIB Table:
Total number of Routes : 4
Destination/Mask Nexthop Flag TimeStamp Interface TunnelID
127.0.0.1/32 127.0.0.1 HU t[21] InLoop0 0x0
127.0.0.0/8 127.0.0.1 U t[21] InLoop0 0x0
10.1.1.1/32 127.0.0.1 HU t[20678] InLoop0 0x0
10.1.1.0/24 10.1.1.1 U t[20678] Vlanif10 0x0
As shown in the display, the FIB table on SwitchA changes and the forwarding
service is affected.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
isis 1
graceful-restart
graceful-restart interval 150
is-level level-1
network-entity 10.0000.0000.0001.00
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 619
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 20
#
isis 1
graceful-restart
graceful-restart interval 150
is-level level-2
network-entity 10.0000.0000.0002.00
#
interface Vlanif20
ip address 10.2.1.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10 20
#
isis 1
graceful-restart
graceful-restart interval 150
network-entity 10.0000.0000.0003.00
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
isis enable 1
#
interface Vlanif20
ip address 10.2.1.1 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
7.20 Troubleshooting IPv4 IS-IS
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 620
7.20.1 Failed to Establish IS-IS Neighbor Relationships
Fault Symptom
IS-IS neighbor relationship fails to be established when the link is working
properly.
Procedure
Step 1 Check whether devices on both ends of the link have the matching IS-IS levels.
● Run the display current-configuration configuration isis | include is-level
command to check the level configurations of IS-IS processes on both ends.
● Run the display current-configuration interface
interface-type interface-
number | include isis circuit-level command to check the IS-IS level
configuration of the specified interface.
IS-IS neighbor relationship can be established when IS-IS interfaces on both ends
of the link have the matching IS-IS levels.
NOTE
If you cannot view the IS-IS level of an interface using the display current-configuration
interface
interface-type interface-number | include isis circuit-level command, the
interface uses the default IS-IS level. To view the default IS-IS level, run the display
default-parameter isis command to check the Circuit-Level field.
Requirements on the IS-IS levels of interfaces on both ends of a link are as follows:
● If the IS-IS level of the local interface is Level-1, the IS-IS level of the remote interface
must be Level-1 or Level-1-2.
● If the IS-IS level of the local interface is Level-2, the IS-IS level of the remote interface
must be Level-2 or Level-1-2.
● If the IS-IS level of the local interface is Level-1-2, the IS-IS level of the remote
interface can be Level-1, Level-2, or Level-1-2.
If the IS-IS levels of interfaces on both ends of a link do not match, perform either
of the following operations to change the IS-IS level:
● Run the is-level command in the IS-IS view to change the global IS-IS level.
● Run the isis circuit-level command in the interface view to change the
interface IS-IS level.
Step 2 Check whether devices on both ends of the link have the matching area addresses.
Run the display current-configuration configuration isis command to check
area address information.
NOTE
If IS-IS Level-1 neighbor relationship needs to be established between devices on both ends,
ensure that the two devices reside in the same area.
A maximum of three area addresses can be configured for an IS-IS process. Devices on both
ends can establish IS-IS Level-1 neighbor relationship when the two devices have a same
area address.
When IS-IS Level-2 neighbor relationship needs to be established between the two devices,
the two devices can have the same or different area addresses.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 621
If the area addresses of the two devices are different, run the network-entity
command in the IS-IS view to set the same area address for the two devices.
Step 3 Check whether devices on both ends of the link have the authentication mode.
Run the display current-configuration interface
interface-type interface-number
| include isis authentication-mode command to check the IS-IS authentication
modes of the interfaces on both ends of the link.
If the two interfaces use different authentication modes, run the isis
authentication-mode command in the view of one interface to ensure that this
interface has the same authentication mode and password as the other interface.
----End
7.20.2 A Device Cannot Learn IS-IS Routes from Its Neighbor
Fault Symptom
A device cannot learn IS-IS routes from its neighbor when its link is working
properly.
Procedure
Step 1 Check whether IS-IS neighbor relationship has been established between the
device and its neighbor.
Run the display isis peer command on each device on the link to check whether
IS-IS neighbor relationship has been established.
If IS-IS neighbor relationship is not established, rectify the fault according to
7.20.1 Failed to Establish IS-IS Neighbor Relationships.
Step 2 Check whether the IS-IS routing table of the device is correct.
Run the display isis route command on the device to check the IS-IS routing
table.
1. If the IS-IS routing table contains specified routes, run the display ip routing-
table
ip-address [
mask |
mask-length ] verbose command to check whether
the IP routing table contains routes with higher protocol preference than IS-IS
routes.
NOTE
If the State field of a route displays Active Adv, the route is active. If there are routes
that have the same prefix but are discovered by different routing protocols, routes
with higher protocol preference are preferred as active routes.
2. If the IP routing table contains routes with higher protocol preference than IS-
IS routes, modify the configuration based on network planning.
Step 3 Check whether the device and its neighbor have the matching IS-IS cost style.
Run the display current-configuration configuration isis command on the
device and its neighbor to check the IS-IS cost style.
The device can learn IS-IS routes from its neighbor when it has the same IS-IS cost
style as its neighbor.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 622
The IS-IS cost style of a device can be set as follows:
● narrow: indicates that the device can receive and send packets with cost style
narrow.
● narrow-compatible: indicates that the device can receive packets with cost
style narrow or wide but sends only packets with cost style narrow.
● compatible: indicates that the device can receive and send packets with cost
style narrow or wide.
● wide-compatible: indicates that the device can receive packets with cost style
narrow or wide but sends only packets with cost style wide.
● wide: indicates that the device can receive and send packets with cost style
wide.
If the IS-IS cost styles of both ends are set to narrow and wide (or wide-
compatible) respectively, the two ends cannot communicate.
If the IS-IS cost styles of both ends are set to narrow-compatible and wide
respectively, the two ends cannot communicate either.
If the device and its neighbor have mismatching IS-IS cost styles, run the cost-
style command on the device to modify the configuration.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 7 IPv4 IS-IS Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 623