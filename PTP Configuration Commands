PTP Configuration Commands

    Command Support
    display ptp
    display ptp utc
    ptp announce-drop enable
    ptp announce-interval
    ptp announce receipt-timeout
    ptp asymmetry-correction
    ptp clock-source
    ptp clock-source local local-priority
    ptp clock-step
    ptp delay-mechanism
    ptp device-type
    ptp domain
    ptp enable (interface view)
    ptp enable (system view)
    ptp local-priority
    ptp mac-egress
    ptp min-delayreq-interval
    ptp min-pdelayreq-interval
    ptp notslave disable
    ptp port-state
    ptp port-type
    ptp profile g-8275-1 enable
    ptp set-port-state enable
    ptp slaveonly
    ptp sync-interval
    ptp tcoc-clock-id
    ptp udp-egress
    ptp virtual-clock-id
    reset ptp statistics

Command Support

Model
	

Supported Part Number
	

Unsupported Part Number

S6730-H24X6C
	

    02352FSG, 02352FSG-001, 02352FSG-003, 02352FSG-005, 02352FSG-006
    02353GFC, 02353GFC-001, 02353GFC-003

	

    02352FSG-007, 02352FSG-008, 02352FSG-009
    02353GFC-004

S6730-H48X6C
	

    02352FSF, 02352FSF-003, 02352FSF-005, 02352FSF-007, 02352FSF-008, 02352FSF-011
    02353FWL, 02353FWL-003, 02353FWL-005

	

    02352FSF-009, 02352FSF-010, 02352FSF-012
    02353FWL-006

S6730-H24X4Y4C
	

None
	

No part number supports this model.

S6730-H28Y4C
	

None
	

No part number supports this model.

S6730S-H24X6C-A
	

    02353HVK, 02353HVK-001, 02353HVK-003

	

02353HVK-004
display ptp
Function

The display ptp command displays information about the Precision Time Protocol (PTP).
Format

display ptp all [ config | state ] [ slot slot-id ]

display ptp interface interface-type interface-number
Parameters

Parameter
	

Description
	

Value

all
	

Displays all the statistics of a PTP device, such as the global configuration parameters, interface where the clock source resides, time trace status, and interface running status.
	

-

config
	

Displays configurations of all the modules related to PTP on the device.
	

-

state
	

Displays the running status of the protocol on all the modules related to PTP on the device.
	

-

slot slot-id
	

Displays the status information of the protocol on all the modules related to PTP based on a slot ID.
	

The value must be set according to the device configuration.

interface interface-type interface-number
	
Displays the BMC running status and the number of sent and received PTP packets on a specified interface.

    interface-type specifies the type of an interface.

    interface-number specifies the number of an interface.

	

-
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

Using the display ptp command, you can view the running status of PTP and statistics information about the global configuration parameters, interface where the clock source resides, and clock lock status. In addition, the command also displays the grandmaster clock ID, receiver number, parent clock ID, parent port number, statistics, and status of interfaces or role list.

Precautions

The display ptp displays the configuration on the interface only when PTP is enabled globally and in the interface view.
Example

# Display the status and statistics of all the modules related to PTP.

<HUAWEI> display ptp all slot 0
  Device config info                                                            
  ------------------------------------------------------------------------      
  PTP state         :enabled    Domain  value      :0                           
  Slave only        :no         Device type        :E2ETCOC                     
  Set port state    :no         Local clock ID     :e468a3fffe552a30            
  Virtual clock ID  :no         Time lock success  :no                          
  PTP profile       :IEEE1588V2                                                 
                                                                                
  BMC run info                                                                                                                      
  ------------------------------------------------------------------------                                                          
  Grand clock ID    :9c8fd0fffecf3c87                                                                                               
  Receive number    :XGigabitEthernet0/0/3                                                                                           
  Parent clock ID   :9c8fd0fffecf3c87                                                                                               
  Parent portnumber :256                                                                                                            
  Priority1         :1          Priority2          :1                                                                               
  Step removed      :0          Clock accuracy     :0x21                                                                            
  Clock class       :6          Time Source        :0xa0                                                                            
  UTC Offset        :35         UTC Offset Valid   :False                                                                           
  Timescale         :PTP        Time Traceable     :False                                                                           
  Leap              :None       Frequence Traceable:True                                                                            
  Offset scaled     :0xffff
                                                                                                                                                                                                  
  Clock source info                                                             
  Clock Pri1 Pri2 Accuracy Class TimeSrc Signal Switch Direction In-Status      
  ------------------------------------------------------------------------      
  local 128  128  0x31     187   0xa0     -      -      -         -             

# Display PTP interface status and packet statistics of XGigabitEthernet0/0/3.

<HUAWEI> display ptp interface xgigabitethernet 0/0/3
  Port State :faulty                                                            
  Port Number :3                                                                
                                                                                
  Recv Packet Statistics                                                        
  -----------------------------------------------------------------------       
  Announce               :0          Sync                       :0              
  Req                    :0          Resp                       :0              
  Followup               :0          Pdelay_resp_followup       :0              
                                                                                
  Send Packet Statistics                                                        
  -----------------------------------------------------------------------       
  Announce               :0          Sync                       :0              
  Req                    :0          Resp                       :0              
  Followup               :0          Pdelay_resp_followup       :0              
                                                                                
  Discard Packet Statistics                                                     
  -----------------------------------------------------------------------       
  Announce               :0          Sync                       :0              
  Delayreq               :0          Pdelayreq                  :0              
  Resp                   :0          Pdelayresp                 :0              
  Followup               :0          Pdelay_resp_followup       :0              

Table 3-178 Description of the display ptp command output

Item
	

Description

Device config info

PTP state
	

Whether PTP is enabled.

The value is set through the ptp enable command.

Domain value
	

Domain that the PTP clock belongs to.

The value is set through the ptp domain command.

Slave only
	

Whether the slave only mode is adopted.

The value is set through the ptp slaveonly command.

Device-type
	

Type of the PTP device.

The value is set through the ptp device-type command.

Set port state
	

Whether to manually enable tracing for a clock source.

Virtual clock ID
	

Whether a virtual clock ID is configured.

Time lock success
	

Whether the device time is locked.

PTP profile
	

PTP profile the device is using.

Local clock ID
	

ID of the local clock.

The value is set through the ptp virtual-clock-id command.

BMC run info

Grand clock ID
	

ID of the grandmaster clock.

Receive number
	

Interface that receives signals of the clock source.

Parent clock ID
	

ID of the parent clock.

Parent portnumber
	

Interface that sends signals of the parent clock source.

Priority1
	

Priority1 of the clock source obtained from the master clock.

Priority2
	

Priority2 of the clock source obtained from the master clock.

Step removed
	

Number of communication channels between the local clock and the grandmaster clock, that is, number of BC devices.

Clock-accuracy
	

Accuracy of the clock source, which is obtained from the master clock.

Clock-class
	

Class of the clock source, which is obtained from the master clock.

Time Source
	

Time source of the clock source, which is obtained from the master clock.

UTC Offset
	

Offset between the Universal Time Coordinated (UTC) and International Atomic Time (TAI).

UTC Offset Valid
	

Whether the UTC offset takes effect.

Timescale
	
Time scale used by the PTP clock. The PTP protocol supports two types of time scales:

    ARB
    PTP

Time Traceable
	

Whether the time can be traced.

Frequence Traceable
	

Whether the clock frequency can be traced.

Source port
	

Clock source of the master clock.

Port info

Name
	

Name of the interface enabled with PTP.

State
	
Status of the interface enabled with PTP:

    Faulty: indicates that the interface is faulty.
    Listening: indicates that the interface is being monitored.
    Master: indicates that the interface is a master interface.
    Passive: indicates that the interface is a passive port.
    Premaster: indicates that the interface is a standby master interface.
    Slave: indicates that the interface is a slave interface.

Delay-mech
	

Delay measurement mechanism used on an interface.

The value is set through the ptp delay-mechanism command.

Ann-timeout
	

Timeout interval for waiting the Announce message.

The value is set through the ptp announce receipt-timeout command.

Type
	

Type of an interface, which is usually the same as the type of the device. If the device type is TCandBC, the value is set through the ptp port-type command.

Domain
	

The clock domain of an interface should be the same as the device type. If the device type is TCandBC, the clock domain of the interface is set by the ptp domain command.

Clock source info

Clock
	

Clock source.

Pri1
	

Priority1 of the clock source. The value is set through the ptp clock-source command.

Pri2
	

Priority2 of the clock source. The value is set through the ptp clock-source command.

Accuracy
	

Accuracy of the clock source. The value is set through the ptp clock-source command.

Class
	

Class of the clock source. The value is set through the ptp clock-source command.

TimeSrc
	

Time source of the clock source. The value is set through the ptp clock-source command.

In-Status
	

Whether the clock source is normal.

Port State
	

Port state.

Port Number
	

Port number of the clock source.

Recv Packet Statistics
	

Received packet statistics.

Send Packet Statistics
	

Sent packet statistics.

Discard Packet Statistics
	

Discarded packet statistics.
display ptp utc
Function

The display ptp utc command displays the Universal Time Coordinated (UTC) time.
Format

display ptp utc [ slot slot-id ]
Parameters

Parameter
	

Description
	

Value
slot slot-id 	Displays the UTC time based on a slot ID. 	The value range depends on the device configuration.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

UTC is also called the Greenwich Mean Time (GMT). The time displayed on the PTP device must be the UTC time.

The command is used to view the synchronization status of the UTC time. After two devices are synchronized, the UTC time should be the same.
The PTP supports two types of time scales: ARB and PTP.

    When the ARB time scale is used, the time can start from any time point and be reset by the management process. The slave clock obtains only the offset between the UTC time and TAI time in seconds. Therefore, the ARB time scale is used only to transmit the offset of the PTP time.
    When the PTP time scale is used, the system time is the UTC time adjusted according to utc-offset.

    The origin of the PTP time scale is 00:00:00 of January 1, 1970. The formula for converting the TAI time to the UTC time is: UTC = TAI - utc-offset. The utc-offset parameter indicates the accumulated offset between the current UTC and the TAI.

Example

# Display the UTC time.

<HUAWEI> display ptp utc
Non-UTC Time:2009-12-30  20:43:39 

Table 3-179 Description of the display ptp utc command output

Item
	

Description

Non-UTC Time
	

Non-standard UTC time converted according to the ARB time.
ptp announce-drop enable
Function

The ptp announce-drop enable command configures the interface of the PTP device to discard Announce messages.

The undo ptp announce-drop enable command restores the default mode of processing Announce messages on the interface of the PTP device.

By default, Announce messages are not discarded.
Format

ptp announce-drop enable

undo ptp announce-drop enable
Parameters

None.
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Announce messages are advertisement messages in PTP, which are used to establish the master-slave hierarchy between devices. If the interface discards Announce messages, the device where the interface resides cannot receive clock synchronization information from other PTP devices. Usually, the ptp announce-drop enable command is configured on the interface at the user side to prevent the interface from receiving and processing Announce messages. This saves system resources.
Example

# Configure the mode of processing Announce messages on XGigabitEthernet1/0/1 of the PTP device to discard.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 1/0/1
[HUAWEI-XGigabitEthernet1/0/1] ptp announce-drop enable

ptp announce-interval
Function

The ptp announce-interval command sets the interval for sending Announce packets on an interface of the PTP device.

The undo ptp announce-interval command restores the default interval for sending Announce packets on the interface of the PTP device.

By default, the interval for sending Announce packets is 128 ms.
Format

ptp announce-interval announce-interval

undo ptp announce-interval
Parameters

Parameter
	

Description
	

Value

announce-interval
	

Indicates that the interval for sending Announce packets on the interface is set to the nth power of 2 in milliseconds, where n is specified by announce-interval.
	

The value is an integer that ranges from 0 to 20.

By default, the interval is 7 (128 ms).
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Announce messages are advertisement messages in PTP, which are used to establish the master-slave hierarchy between devices. Announce packets ensure the exchange of clock synchronization information between PTP devices. If the value of the announce-interval is too small, devices frequently exchange PTP packets, which consume excessive bandwidth; if the value of the announce-interval is too great, the clock synchronization accuracy cannot be guaranteed. Therefore, while the clock synchronization accuracy is ensured, you should set the announce-interval to a larger value.
Example

# Set the interval for sending Announce packets on XGigabitEthernet0/0/1 of the PTP device to 256 ms.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp announce-interval 8

ptp announce receipt-timeout
Function

The ptp announce receipt-timeout command configures the maximum timeout times of receiving Announce messages on an interface.

The undo ptp announce receipt-timeout command restores the default maximum timeout times of receiving Announce messages on an interface.

By default, the maximum timeout times of receiving Announce messages is 3.
Format

ptp announce receipt-timeout timeout-value

undo ptp announce receipt-timeout
Parameters

Parameter
	

Description
	

Value

timeout-value
	

Specifies the maximum timeout times of receiving Announce messages.
	

The value is an integer that ranges from 2 to 255.

The default value is 3.
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines
Announce messages are advertisement messages in PTP, which are used to establish the master-slave hierarchy between devices. When the maximum timeout times of receiving Announce messages on an interface exceeds the specified threshold:

    In dynamic clock source selection: The local device configures the status of the 1588v2 interface as non-slave. That is, the 1588v2 interface does not synchronize the time with other devices.
    In static clock source selection: The 1588v2 interface status remains unchanged.

Timeout interval for receiving Announce messages on the local interface = Maximum timeout times of receiving Announce messages on the local interface (receipt-timeout) x Interval for sending Announce messages to the peer device (announce-interval) The interval for sending Announce messages to the peer device (announce-interval) is set using the ptp announce-interval announce-interval command.

If you run this command multiple times, only the latest configuration takes effect.
Example

# Set the maximum timeout times of receiving Announce messages on XGigabitEthernet0/0/1 of the PTP device to 4.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp announce receipt-timeout 4

ptp asymmetry-correction
Function

The ptp asymmetry-correction command sets the delay offset value to ensure accurate time synchronization.

The undo ptp asymmetry-correction command restores the default delay offset.

By default, the asymmetry correction value of the PTP packet sent from the interface is not configured.
Format

ptp asymmetry-correction { positive | negative } asymmetry-correction

undo ptp asymmetry-correction
Parameters

Parameter
	

Description
	

Value

positive asymmetry-correction
	

Indicates the positive asymmetry correction value.
	

The value is an integer that ranges from 0 to 2000000, in ns. The default value is 0.

negative asymmetry-correction
	

Indicates the negative asymmetry correction value.
	

The value is an integer that ranges from 0 to 2000000, in ns. The default value is 0.
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

In case of path delay calculation, PTP measures the packet sending path only and considers the delays for sending and receiving packets as the same by default.

If the two delays are different or asymmetric, you need to configure an asymmetry correction value. In this case, the device automatically considers the asymmetry correction value in the path delay calculation complying with the Pdelay or Delay measurement mechanism.
Example

# Set the delay offset value to 1 ns on XGigabitEthernet 0/0/1.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp asymmetry-correction positive 1

ptp clock-source
Function

The ptp clock-source command sets the attributes of the clock source and time source.

The undo ptp clock-source command cancels the settings.

For default values of the parameters, see the parameter description.
Format

ptp clock-source local { clock-accuracy clock-accuracy | clock-class clock-class | priority1 priority1 | priority2 priority2 | time-source time-source } slot slot-id

undo ptp clock-source local { clock-accuracy | clock-class | priority1 | priority2 | time-source } slot slot-id

After G.8275.1 is enabled, only the priority2 priority2 and time-source time-source parameters are supported.
Parameters

Parameter
	

Description
	

Value

local
	

Indicates the local clock.
	

-

clock-accuracy clock-accuracy
	

Specifies an attribute defining the accuracy of a clock.
	

The value of clock-accuracy is a hexadecimal number that is in the range of 0 to FF. You can set the value to 20-31 or 80-FD.

The default accuracy of the local clock is 31.

The accuracy values mapping the values of clock-accuracy-value are as follows:

    20: The time is accurate to within 25 ns.
    21: The time is accurate to within 100 ns.
    22: The time is accurate to within 250 ns.
    23: The time is accurate to within 1 us.
    24: The time is accurate to within 2.5 us.
    25: The time is accurate to within 10 us.
    26: The time is accurate to within 25 us.
    27: The time is accurate to within 100 us.
    28: The time is accurate to within 250 us.
    29: The time is accurate to within 1 ms.
    2A: The time is accurate to within 2.5 ms.
    2B: The time is accurate to within 10 ms.
    2C: The time is accurate to within 25 ms.
    2D: The time is accurate to within 100 ms.
    2E: The time is accurate to within 250 ms.
    2F: The time is accurate to within 1s.
    30: The time is accurate to within 10s.
    31: The time is accurate to more than 10s.
    80 to FD: reserved for PTP features.

clock-class clock-class
	

Specifies the attribute of an ordinary or boundary clock denotes the traceability of the time or frequency distributed by the grandmaster clock, that is the capability to trace the International Atomic Time (TAI).
	

The value of clock-class is an integer that ranges from 0 to 255.

The default value of the local clock is 187.

The capabilities to trace the TAI mapping the values of clock-class-value are as follows:

    0, 9, and 10: reserved to enable compatibility with future versions.
    1-5, 8, 11-12, 15-51, 53-57, 59-67, 123-127, 128-132, 171-186, 188-192, 194-215, 233-247, 249-250, 252-254: reserved.
    68-122, 133-170, 216-232: used by alternate PTP profiles.
    6: a clock that is synchronized to a primary reference time source. The timescale distributed is PTP. A clock of class 6 cannot be a slave to another clock in the domain.
    7: a clock that has previously been designated as class 6 but that has lost the capability to synchronize to a primary reference time source. The PTP system enters the holdover state and does not perform best clock source selection. The timescale distributed is PTP. A clock of class 7 cannot be a slave to another clock in the domain.
    13: a clock that is synchronized to an application specific source of time. The timescale distributed is ARB. A clock of class 13 cannot be a slave to another clock in the domain.
    14: a clock that has previously been designated as class 13 but that has lost the capability to synchronize to an application specific source of time. The clock is in holdover mode and within holdover specifications. The timescale distributed is ARB. A clock of class 14 cannot be a slave to another clock in the domain.
    52: Degradation alternative A for a clock of class 7 that is not within holdover specification. A clock of class 52 cannot be a slave to another clock in the domain.
    58: Degradation alternative A for a clock of class 14 that is not within holdover specification. A clock of class 58 cannot be a slave to another clock in the domain.
    187: Degradation alternative B for a clock of class 7 that is not within holdover specification. A clock of class 187 can be a slave to another clock in the domain.
    193: Degradation alternative B for a clock of class 14 that is not within holdover specification. A clock of class 193 can be a slave to another clock in the domain.
    248: This clock class is used if none of the other clock class definitions apply.
    251: Reserved for version 1 compatibility.
    255: clock class of a slave-only clock.

priority1 priority1
	

Specifies a user configurable designation that a clock belongs to an ordered set of clocks from which a master is selected. The attribute priority1 is used in the execution of the best master clock algorithm.
	

The value of priority1 is an integer that ranges from 0 to 255.

The default value is 128.

Lower values take precedence.

priority2 priority2
	

Specifies a user configurable designation that provides finer grained ordering among otherwise equivalent clocks. The attribute priority2 is used in the execution of the best master clock algorithm.
	

The value of priority2 is an integer that ranges from 0 to 255.

The default value is 128.

Lower values take precedence.

time-source time-source
	

Specifies the source of time used by the grandmaster clock.
	

The value of time-source is an integer that ranges from 1 to 8.

The default value of the local clock is 8 (INTERNAL_OSCILLATOR).

The attributes mapping the values of time-source-value are as follows:

    1: (0x10) ATOMIC_CLOCK
    2: (0x20) GPS
    3: (0x30) TERRESTRIAL_RADIO
    4: (0x40) PTP
    5: (0x50) NTP
    6: (0x60) HAND_SET
    7: (0x90) OTHER
    8: (0xa0) INTERNAL_OSCILLATOR

slot slot-id
	

Specifies the slot ID.
	

The value range depends on the device configuration.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

The time-source parameter specifies the clock source attribute used by the grandmaster clock device and the value is set according to the clock source connected to the device.

When the BMC algorithm is used by the PTP device for master clock selection, priority1 values of each candidate time source are compared first, then clock-class, clock-accuracy, and priority2. If priority1 values of candidate time sources are the same, clock-class values are compared, and so on. The time source with the highest priority is selected as the master clock.

A smaller clock-class value indicates a higher clock class. When the clock-class of a device is smaller than 128, the device cannot function as a slave clock. Therefore, do not set a high clock-class for a slave clock. Otherwise, the PTP interface of the slave clock cannot enter the slave state, and the device cannot synchronize with the master clock.
Example

# Configure the time source of the local clock to ATOMIC_CLOCK.

<HUAWEI> system-view
[HUAWEI] ptp clock-source local time-source 1 slot 0

# Set priority 1 of the local clock to 1.

<HUAWEI> system-view
[HUAWEI] ptp clock-source local priority1 1 slot 0

# Set priority 2 of the local clock to 1.

<HUAWEI> system-view
[HUAWEI] ptp clock-source local priority2 1 slot 0

# Set the class of the local clock to 10.

<HUAWEI> system-view
[HUAWEI] ptp clock-source local clock-class 10 slot 0

# Set the accuracy of the local clock to 31 (accurate to >10s).

<HUAWEI> system-view
[HUAWEI] ptp clock-source local clock-accuracy 31 slot 0

ptp clock-source local local-priority
Function

The ptp clock-source local local-priority command sets the local priority for a local PTP clock source or an external clock source.

The undo ptp clock-source local local-priority command restores the default local priority of a local or external clock source.

By default, the local priority of a local PTP clock source or an external clock source is 128.
Format

ptp clock-source local local-priority local-priority-value slot slot-id

undo ptp clock-source local local-priority slot slot-id
Parameters
Parameter 	Description 	Value
local-priority local-priority-value 	Specifies a local priority. 	The value is an integer that ranges from 1 to 255.
slot slot-id 	Specifies the slot ID. 	The value range depends on the device configuration.
Views

System view
Default Level

2: Configuration level
Usage Guidelines
Usage Scenarios

According to the BMC algorithm in G.8275.1, when the local or external clock source competes with a line clock source and other attributes are the same, the two clock sources are compared against the local priority. The clock source with a lower local priority is preferentially selected.
Example

# Set the local priority of a local PTP clock source to 120.

<HUAWEI> system-view
[HUAWEI] ptp clock-source local local-priority 120 slot 0

ptp clock-step
Function

The ptp clock-step command specifies the mode in which PTP packets that are used by PTP devices to perform time synchronization are timestamped.

The undo ptp clock-step command resets the mode in which PTP packets that are used by PTP devices to perform time synchronization are timestamped.

By default, the mode in which PTP packets are timestamped is one-step.
Format

ptp clock-step { one-step | two-step }

undo ptp clock-step
Parameters

Parameter
	

Description
	

Value

one-step
	

Indicates the one-step clock mode. In one-step clock mode, Sync messages in Delay mode and Pdelay_Resp messages in Pdelay mode are stamped with the time when they are sent.
	

-

two-step
	

Indicates the two-step clock mode. In two-step clock mode, Sync messages in Delay mode and Pdelay_Resp messages in Pdelay mode only record the time when they are generated, but carry no timestamps. The timestamps are carried in subsequent messages, that is, Follow_Up or Pdelay_Resp_Follow_Up messages.
	

-
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The device adopts the one-step mode to timestamp outgoing PTP messages to communicate with other devices, and identify received Follow_Up messages in two-step mode. In this way, an interface in one-step clock mode can communicate with another interface in two-step clock mode.

Precautions

After the PTP device type is set to e2etc, e2etcoc, p2ptc, or p2ptcoc using the ptp device-type, the mode in which PTP messages are timestamped cannot be changed to two-step using the ptp clock-step command.
Example

# Configure the two-step clock mode on XGigabitEthernet0/0/1.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp clock-step two-step

ptp delay-mechanism
Function

The ptp delay-mechanism command configures the delay measurement mechanism applied on the interface of a PTP device.

The undo ptp delay-mechanism command deletes the delay measurement mechanism applied on the interface of the PTP device.

By default, the delay measurement mechanism is only configured on the P2P transparent clock (P2PTC), E2E transparent clock (E2ETC), P2P transparent clock and ordinary clock (P2PTCOC), and E2E transparent clock and ordinary clock (E2ETCOC).
Format

ptp delay-mechanism { delay | pdelay }

undo ptp delay-mechanism
Parameters

Parameter
	

Description
	

Value

delay
	

Indicates that the delay measurement mechanism applied on the interface is in Delay mode.
	

-

pdelay
	

Indicates that the delay measurement mechanism applied on the interface is in Pdelay mode.
	

-
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage scenario
PTP supports two delay measurement mechanisms:

    Delay request-response end to end (E2E) mechanism: calculates the time difference based on the total delay of the link between the master and slave clocks.
    Peer delay peer to peer (P2P) mechanism: calculates the time difference based on the delay of each link between the master and slave clocks.

In the P2P mechanism, the link delay of each interface must be measured separately. Different from the E2E mechanism, the P2P mechanism calculates and accumulates the forwarding delay and link delay to ensure accurate clock synchronization. If the master and slave clocks are far from each other and there are many TCs, the P2P mechanism will greatly reduce the clock synchronization efficiency and affect the clock synchronization effect. Therefore, when there is only one or two TCs, the P2P mechanism is recommended. When there are three or more TCs, the E2E mechanism is recommended.

Precautions

    OC and BC interfaces must be configured with the delay measurement mechanism before PTP is enabled.

    If the delay measurement mechanism is configured on an interface, to configure another delay measurement mechanism, you need to cancel the original configuration first.
    The corresponding delay measurement mechanism is applied on the E2ETC, E2ETCOC, P2PTC, P2PTCOC by default and cannot be modified; therefore, PTP can be directly enabled on interfaces of these devices.

Example

# Configure the mode of the delay measurement mechanism of XGigabitEthernet0/0/1 on the PTP device as Delay.

<HUAWEI> system-view
[HUAWEI] ptp device-type bc
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp delay-mechanism delay 

ptp device-type
Function

The ptp device-type command configures the device type of a PTP device.

The undo ptp device-type command cancels the setting of the device type of a PTP device.

By default, the device type is not configured on a PTP device.
Format

ptp device-type { bc | oc | e2etc | e2etcoc | p2ptc | p2ptcoc | tcandbc | t-bc } slot slot-id

undo ptp device-type slot slot-id

After G.8275.1 is enabled, only the t-bc parameter is supported.
Parameters

Parameter
	

Description
	

Value

oc
	

Indicates the ordinary clock (OC). An OC device has only one interface in the PTP domain, through which the local clock synchronizes with the upstream clock or advertises the time to the downstream clock.
	

-

bc
	

Indicates the boundary clock (BC). A BC device has multiple interfaces in the PTP domain. One of these interfaces synchronizes time from the upstream device, and the other interfaces advertise the time to the downstream device.
	

-

e2etc
	

Indicates the end to end transparent clock (E2ETC). A TC device does not participate in the calculation of the PTP clock and only transparently transmits PTP packets.
	

-

p2ptc
	

Indicates that the peer to peer transparent clock (P2PTC).
	

-

e2etcoc
	

Indicates the end to end transparent ordinary clock (E2ETCOC). A TCOC device is a special TC node. It synchronizes time in the same way as a TC device and can synchronize the clock frequency with the upstream device according to PTP packets.
	

-

p2ptcoc
	

Indicates the peer to peer transparent ordinary clock (P2PTCOC).
	

-

tcandbc
	

Indicates the transparent boundary clock.
	

-

t-bc
	

Indicates the telecom boundary clock.
	

-

slot slot-id
	

Specifies the ID of the slot where the PTP device resides.
	

The value range depends on the device configuration.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

Each device can be configured with only one device type.

The PTP functions and parameters are not affected when you change the device type of the device. The device supports the following functions to simplify the configuration:

    Conversion between the BC, OC, and TCandBC modes
    Conversion between the E2ETC, P2PTC, E2ETCOC, and P2PTCOC modes

The PTP functions and parameters are not affected when you change the device type of the device. Before changing the device type, make sure that the conditions of the new device type are met. For example:

    To change the device type from BC or TCandBC to OC, make sure that the conditions of the OC are met, that is, PTP is enabled on only one interface. Otherwise, the following error information is displayed:

    To change the device type from OC to BC, make sure that the device is not in slave-only state. Otherwise, the following error information is displayed:

    To change the device type from E2ETCOC or P2PTCOC to E2ETC or P2PTC, make sure that no PTP-related configuration exists on the OC interface of the TCOC device. Otherwise, the following error information exists:

    If the original device type is TCandBC and the type of an interface is set to TC, when you switch the device type to OC or BC, the following error information is displayed:

    If the original device type is E2ETC or P2PTC, you can switch the device type to only E2ETCOC, or P2PTCOC. Otherwise, the following error information is displayed:

You set the device type of the PTP device and enable PTP on the device in a random sequence.

Precautions

    Running the undo ptp device-type command will clear the PTP configuration in the interface view. If the PTP device type is OC and the ptp slaveonly slot slot-id command is configured, running the undo ptp device-type command will also clear the ptp slaveonly slot slot-id command configuration. Exercise caution when running the undo ptp device-type command.
    When the device type of the device is set to TC, TCOC, or TCandBC (the interface type is TC):
        Ensure that PTP packets are forwarded at the service layer. For example, on a ring network, you need to use ring network protocols to remove loops at the service layer.
        On the TC device, the interfaces for receiving and sending PTP packets must be enabled with PTP. Otherwise, the resident time of the device cannot be calculated correctly. In this case, only packets are forwarded.
        To ensure PTP time synchronization, ensure that PTP packets are first forwarded when the interface reaches the maximum rate.
    After the mode in which PTP messages are timestamped is changed to two-step using the ptp clock-step command, the ptp device-type command cannot be used to configure the PTP device type to e2etc, e2etcoc, p2ptc, or p2ptcoc.

Example

# Set the PTP device type to OC.

<HUAWEI> system-view
[HUAWEI] ptp device-type oc

ptp domain
Function

The ptp domain command configures the domain where the PTP device resides.

The undo ptp domain command restores the domain where the PTP device resides to the default value.

By default, the domain where the PTP device resides is PTP domain 0.
Format

ptp domain domain-value

undo ptp domain
Parameters

Parameter
	

Description
	

Value

domain-value
	

Specifies the domain that the clock source belongs to.
	

The value is an integer that ranges from 0 to 255.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

A physical time synchronization network can be logically divided into multiple clock domains. Each clock domain has a synchronization time, to which all devices in the domain are synchronized. Different clock domains have their own synchronization time, which is independent from each other.
Example

# Set the value of the domain where the PTP device resides to 4.

<HUAWEI> system-view
[HUAWEI] ptp domain 4

ptp enable (interface view)
Function

The ptp enable command enables PTP on a certain interface of the device.

The undo ptp enable command disables PTP on a certain interface of the device.

By default, PTP is not enabled on the interface of the device.
Format

ptp enable

undo ptp enable
Parameters

None
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage scenario

After PTP is enabled globally, enable PTP on an interface so that PTP can take effect.

Precautions

    Before enabling PTP, ensure that the interface supports PTP.
    The management interface and the sub interface cannot be enabled with PTP.

Pre-configuration tasks

    Before enabling PTP on an interface, you must run the ptp device-type command in the system view to set the device type.
    You must use the ptp port-type command to configure the clock mode of an interface on the TCandBC device.
    On the OC device, only one interface can be enabled with PTP.
    On the OC or BC device, you must use the ptp delay-mechanism command to configure the delay mechanism before enabling PTP.

Example

# Enable PTP on XGigabitEthernet 0/0/1.

<HUAWEI> system-view
[HUAWEI] ptp device-type bc slot 0
[HUAWEI] interface xgigabitethernet 0/0/1 
[HUAWEI-XGigabitEthernet0/0/1] ptp delay-mechanism delay
[HUAWEI-XGigabitEthernet0/0/1] ptp enable

ptp enable (system view)

Function

The ptp enable command enables PTP on the device.

The undo ptp enable command disables PTP on the device.

By default, PTP is disabled globally.
Format

ptp enable

undo ptp enable
Parameters

None
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Before using PTP, run the ptp enable command in the system view to enable PTP globally.

The undo ptp enable command will disable PTP and make all the PTP configuration become ineffective. To use PTP, reconfigure PTP.
Example

# Enable PTP globally.

<HUAWEI> system-view
[HUAWEI] ptp enable

ptp local-priority
Function

The ptp local-priority command configures the local priority of a G.8275.1 interface.

The undo ptp local-priority command restores the default local priority of a G.8275.1 interface.

By default, the local priority of a G.8275.1 interface is 128.
Format

ptp local-priority local-priority-value

undo ptp local-priority [ local-priority-value ]
Parameters
Parameter 	Description 	Value
local-priority-value 	Specifies the local priority of a G.8275.1 interface. 	The value is an integer that ranges from 1 to 255.
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines
According to the BMC algorithm in G.8275.1:

    When two line clock sources are compared and other attributes the same, the interface with a lower local priority is preferentially selected.
    When the local or external clock source competes with a line clock source and other attributes are the same, the two clock sources are compared against the local priority. The clock source with a lower local priority is preferentially selected.

Example

# Set the local priority of a local G.8275.1 clock source to 120.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp local-priority 120

ptp mac-egress
Function

The ptp mac-egress command configures the MAC encapsulation mode for the PTP packets.

The undo ptp mac-egress command restores the default MAC encapsulation mode.

By default, PTP packets are encapsulated in MAC multicast mode and do not carry any VLAN tag.
Format

ptp mac-egress { destination-mac destination-mac | vlan vlan-id [ priority priority-value ] }

undo ptp mac-egress { destination-mac | vlan [ priority ] }

In G.8275.1 mode, only the destination-mac destination-mac parameter is supported.
Parameters

Parameter
	

Description
	

Value

destination-mac destination-mac
	

Indicates the destination MAC address of the PTP packet.

If the destination MAC address is not configured, the PTP packet is encapsulated in multicast mode by default and does not carry any VLAN tag.
	

The value is in the format of H-H-H. An H contains one to four hexadecimal numbers.

vlan vlan-id
	

Specifies the VLAN ID of PTP messages.
	

The value is an integer that ranges from 1 to 4094.

priority priority-value
	

Specifies the priority of VLAN packets.
	

The value is an integer that ranges from 0 to 7. The default value is 7, indicating the highest priority.
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage scenario

You can configure the encapsulation mode for packets based on the Layer 2 network types of devices. If a device resides on a Layer 2 unicast network, configure a MAC address for the device. If a device resides on a multicast network, no MAC address needs to be configured for the device because a default multicast MAC address is defined.
Table 3-180 Default multicast MAC address for delay and Pdelay measurement mechanisms
Packet Type 	MAC Address

All except peer delay measurement mechanisms
	

011B-1900-0000

Peer delay measurement mechanism
	

0180-C200-000E

Precautions

    This command is invalid for transparently transmitted packets.

    The MAC address cannot be 0000-0000-0000.

    Before configuring MAC encapsulation, delete the UDP encapsulation configuration if UDP encapsulation has been configured.

    MAC encapsulation is required when the VLAN ID to be encapsulated to sent or received packets is configured.

    After G.8275.1 is configured, only the default multicast MAC addresses 011B-1900-0000 and 0180-C200-000E can be configured.

Example

# Configure the unicast MAC encapsulation for the PTP packet.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp mac-egress destination-mac 001B-1911-1100

# Configure the multicast MAC encapsulation for the PTP packet.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp mac-egress vlan 2 priority 2

ptp min-delayreq-interval
Function

The ptp min-delayreq-interval command sets the minimum interval for sending Delay_Req messages on a 1588v2 interface.

The undo ptp min-delayreq-interval command restores the default minimum interval for sending Delay_Req messages on a 1588v2 interface.

By default, the minimum interval for sending 1588v2 Delay_Req messages on a 1588v2 interface is 128 ms, and the minimum interval for sending G.8275.1 Delay_Req messages on a 1588v2 interface is 64 ms.
Format

ptp min-delayreq-interval min-delayreq-interval

undo ptp min-delayreq-interval
Parameters
Parameter 	Description 	Value
min-delayreq-interval 	Specifies that the minimum interval for sending Delay_Req messages on a 1588v2 interface is set to the min-pdelayreq-intervalth power of 2, in milliseconds. 	The value is an integer that ranges from 0 to 20. In 1588v2 mode, the default value is 7, namely, 128 ms. In G.8275.1 mode, the default value is 6, namely, 64 ms. Table 3-181 shows the mapping between the min-delayreq-interval value and the actual sending interval.
Table 3-181 Mapping between the min-delayreq-interval value and the actual sending interval
Value of min-delayreq-interval 	

Actual Interval
0 	1 ms
1 	2 ms
2 	4 ms
3 	8 ms
4 	16 ms
5 	32 ms
6 	64 ms
7 	128 ms
8 	256 ms
9 	512 ms
10 	1s
11 	2s
12 	4s
13 	8s
14 	16s
15 	32s
16 	64s
17 	128s
18 	256s
19 	512s
20 	1024s
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

During 1588v2 clock synchronization, an Announce message is sent to determine the master-slave hierarchy, where the upstream node that advertises the synchronization time is the master device and the downstream node that receives the synchronization time is called the slave device. The master device sends Sync messages to the slave device to transmit performance parameters of time signals. In addition, the delay measurement mechanism can be implemented to ensure the accuracy of time signals.
Because the delay varies according to the network link, the 1588v2 time signals may be inaccurate. During 1588v2 clock synchronization, delay and Pdelay messages are transmitted to measure link delay, and time signals can be corrected based on the link delay. During the delay measurement request process, the local device sends a Delay_Req message and the peer device replies with a Delay_Resp message. There are two types of delay measurement mechanism.

    delay: specifies a delay request-response mechanism, in which information about the clock and time is calculated according to the delay of the entire link between the PTP device and the clock source. In this mode, the slave device sends a Delay_Req message to the master device, and the slave device corrects time signals based on the Delay_Resp message replied by the master device.
    pdelay: specifies a peer delay mechanism, in which information about the time and clock is calculated according to the delay of each segment of the link between the PTP device and the clock source. In this mode, the slave device and master device exchange Pdelay_Req messages and time signals are corrected based on the Pdelay_Resq messages replied.

If min-delayreq-interval is set to a small value, PTP devices frequently exchange Delay_Req messages, occupying many bandwidth resources. If min-delayreq-interval is set to a large value, high-precision clock synchronization cannot be guaranteed. If the required clock synchronization accuracy is guaranteed, set min-delayreq-interval to a large value.
Example

# Set the minimum interval for sending Delay_Req messages on the 1588v2 interface XGigabitEthernet 0/0/1 to 256 ms.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp min-delayreq-interval 8

ptp min-pdelayreq-interval
Function

The ptp min-pdelayreq-interval command configures the minimum interval for sending Pdelay_Req messages on a 1588v2 interface.

The undo ptp min-pdelayreq-interval command restores the default minimum interval for sending Pdelay_Req messages on a 1588v2 interface.

By default, the minimum interval for sending Pdelay_Req message is 128 ms.
Format

ptp min-pdelayreq-interval min-pdelayreq-interval

undo ptp min-pdelayreq-interval
Parameters
Parameter 	Description 	Value
min-pdelayreq-interval 	Specifies that the minimum interval for sending Pdelay_Req messages on a 1588v2 interface is set to the min-pdelayreq-interval power of 2, in milliseconds. 	The value is an integer that ranges from 0 to 20. The default value is 7, that is, 128 milliseconds. Table 3-182 lists the mapping between the min-pdelayreq-interval value and the actual sending interval.
Table 3-182 Mapping between the min-pdelayreq-interval value and the actual sending interval
Value of min-pdelayreq-interval 	

Actual Interval
0 	1 ms
1 	2 ms
2 	4 ms
3 	8 ms
4 	16 ms
5 	32 ms
6 	64 ms
7 	128 ms
8 	256 ms
9 	512 ms
10 	1s
11 	2s
12 	4s
13 	8s
14 	16s
15 	32s
16 	64s
17 	128s
18 	256s
19 	512s
20 	1024s
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

During 1588v2 clock synchronization, an Announce message is sent to determine the master-slave hierarchy, where the upstream node that advertises the synchronization time is the master device and the downstream node that receives the synchronization time is called the slave device. The master device sends Sync messages to the slave device to transmit performance parameters of time signals. In addition, the delay measurement mechanism can be implemented to ensure the accuracy of time signals.
Because the delay varies according to the network link, the 1588v2 time signals may be inaccurate. During 1588v2 clock synchronization, delay and Pdelay messages are transmitted to measure link delay, and time signals can be corrected based on the link delay. During the delay measurement request process, the local device sends a Delay_Req message and the peer device replies with a Delay_Resp message. There are two types of delay measurement mechanism.

    delay: specifies a delay request-response mechanism, in which information about the clock and time is calculated according to the delay of the entire link between the PTP device and the clock source. In this mode, the slave device sends a Delay_Req message to the master device, and the slave device corrects time signals based on the Delay_Resp message replied by the master device.
    pdelay: specifies a peer delay mechanism, in which information about the time and clock is calculated according to the delay of each segment of the link between the PTP device and the clock source. In this mode, the slave device and master device exchange Pdelay_Req messages and time signals are corrected based on the Pdelay_Resq messages replied.

If min-pdelayreq-interval is set to a small value, PTP devices frequently exchange Pdelay_Req messages, occupying many bandwidth resources. If min-pdelayreq-interval is set to a large value, high-precision clock synchronization cannot be guaranteed. If the required clock synchronization accuracy is guaranteed, set min-pdelayreq-interval to a large value.
Example

# Set the minimum interval for sending Pdelay_Req messages on the 1588v2 interface XGigabitEthernet 0/0/1 to 128 ms.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp min-pdelayreq-interval 7

ptp notslave disable
Function

The ptp notslave disable command configures the notslave attribute of a G.8275.1 interface as false.

The undo ptp notslave disable command restores the default notslave attribute of a G.8275.1 interface as true.

By default, the notslave attribute of a G.8275.1 interface is set to true.
Format

ptp notslave disable

undo ptp notslave disable
Parameters

None
Views

System view
Default Level

2: Configuration level
Usage Guidelines

To change the notslave attribute of a G.8275.1 interface, run the ptp notslave disable command. If the notslave attribute of a G.8275.1 interface is true, the G.8275.1 interface will never work in the slave state. If the notslave attribute of a G.8275.1 interface is false, the G.8275.1 interface can be in the slave state.
Prerequisites

The PTP device complies with the G.8275.1 profile.
Example

# Set the nontslave attribute of a G.8275.1 interface to false.

<HUAWEI> system-view
[HUAWEI] ptp notslave disable

ptp port-state
Function

The ptp port-state command statically configures the status of a PTP interface.

The undo ptp port-state command restores the default status of a PTP interface.

By default, a statically specified PTPT interface is in the initializing state.
Format

ptp port-state { slave | passive | master | premaster | listening | faulty | disabled | initializing }

undo ptp port-state
Parameters
Parameter 	Description 	Value
slave 	Configures the PTP interface status as slave. A slave interface traces external time information. A PTP device can be configured with only one slave interface. 	-
passive 	Configures the PTP interface status as passive. A passive PTP interface neither traces external time information nor advertises time information. A passive interface can send Pdelay_Req, Pdelay_Resp, delay_Resp_Follow_Up, and signaling messages as well as respond to management messages. If multiple PTP interfaces are detected as master devices in a domain, the PTP interface with the highest priority is selected as the master device and the local interface connected to this PTP interface is in the slave state. In this case, other local interfaces are in the passive state and back up the slave interface. 	-
master 	Configures the PTP interface status as master. A master PTP interface advertises time information to other devices. 	-
premaster 	Configures the PTP interface status as premaster. A premaster PTP interface neither traces external time information nor advertises time information. A premaster interface can send Pdelay_Req, Pdelay_Resp, delay_Resp_Follow_Up, and signaling messages as well as respond to management messages. 	-
listening 	Configures the PTP interface status as listening. A listening PTP interface neither traces external time information nor advertises time information. If a device originally functioning as a master clock is configured to be an OC working in slaveonly mode, or if the device becomes faulty, the status of the PTP interface on the device changes from master to listening. 	-
faulty 	Configures the PTP interface status as faulty. A faulty interface can only respond to some management messages on a link, instead of sending other PTP messages. 	-
disabled 	Configures the PTP interface status as disabled. A disabled PTP interface cannot send PTP messages, and discards all PTP messages except for management messages. The disabled status of a PTP interface equals to disabling the PTP function from the interface using the undo ptp enable command in the interface view. 	-
initializing 	Configures the PTP interface status as initializing. An initializing PTP interface initializes the data set, hardware information, and communication device information. In case of an initializing PTP interface, all interfaces on the clock node are prohibited from sending PTP messages. 	-
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Static clock source selection and dynamic BMC clock source selection are two independent sets of clock source selection mechanism. The priority of static clock source selection is higher than that of dynamic BMC clock source selection. You can fix the master-slave relationship between clock nodes within a network by statically configuring the status of PTP interfaces on them. In this way, the reference clock source is not selected through BMC algorithm.
Example

# Configure the PTP interface to be in the slave state.

<HUAWEI> system-view
[HUAWEI] ptp set-port-state enable
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp port-state slave

ptp port-type
Function

The ptp port-type command configures the clock mode of an interface on a TCandBC device.

The undo ptp port-type command deletes the clock mode configured on the interface on a TCandBC device.

By default, the PTP clock mode is not configured on the interface.
Format

ptp port-type { bc | tc }

undo ptp port-type
Parameters

Parameter
	

Description
	

Value

bc
	

Indicates that the clock mode configured on the interface of the TCandBC is BC.
	

-

tc
	

Indicates that the clock mode configured on the interface of the TCandBC is TC.
	

-
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage scenario

The device supports the TCandBC clock mode. In this case, you can configure the clock mode of the interface to TC or BC. If the original clock mode of the interface is BC or OC, and the interface is enabled with PTP, the clock mode of the interface changes to BC after the device clock mode is changed to TC and BC mode.

Precautions

    This command is invalid when G.8275.1 is enabled.

    If the interface is enabled with PTP, the ptp port-type command is invalid.

    Before deleting the clock mode of the interface of the TCandBC device, you must first clear the clock domain of the interface, if the clock mode is TC and the clock domain of the interface is configured.

Example

# Configure the clock mode of XGigabitEthernet0/0/1 interface on the TCandBC device to BC.

<HUAWEI> system-view
[HUAWEI] ptp device-type tcandbc
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp port-type bc

ptp profile g-8275-1 enable
Function

The ptp profile g-8275-1 enable command configures PTP to comply with ITU-T G.8275.1.

The undo ptp profile g-8275-1 enable command cancels configuring PTP to comply with ITU-T G.8275.1. That is, PTP complies with IEEE 1588v2.

By default, PTP complies with IEEE 1588v2.
Format

ptp profile g-8275-1 enable

undo ptp profile g-8275-1 enable
Parameters

None
Views

System view
Default Level

2: Configuration level
Usage Guidelines

ITU-T G.8275.1 is a new PTP protocol designed for the telecom domain. To switch the 1588v2 profile to the G.8275.1 profile, run the ptp profile g-8275-1 enable command. To switch the G.8275.1 profile to the 1588v2 profile, run the undo ptp profile g-8275-1 enable command.
Configuration Impact

After the ITU-T G.8275.1 profile is configured, all the configurations related to IEEE 1588v2 in the system view and interface view are deleted, and the PTP configurations are restored to the default values. In addition, the default values of value ranges of the domain, sync-interval, and delayreq-interval parameters are changed. However, the function to globally enable PTP (using the ptp enable command) is not affected.
Example

# Configure the ITU-T G.8275.1 profile.

<HUAWEI> system-view
[HUAWEI] ptp profile g-8275-1 enable

ptp set-port-state enable
Function

The ptp set-port-state enable command enables the function to statically specify the interface status.

The undo ptp set-port-state enable command disables the function to statically specify the interface status.

By default, the function to statically specify the interface status is disabled.
Format

ptp set-port-state enable slot slot-id

undo ptp set-port-state enable slot slot-id
Parameters
Parameter 	Description 	Value

slot slot-id
	

Specifies a slot ID.
	

The value depends on the device configuration.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

In a 1588v2/G.8275.1 clock synchronization network, all clock nodes work in the master-slave relationship. By default, the master-slave relationship between clock nodes is calculated through the BMC algorithm. To fix the master-slave relationship between clock nodes within a network, run the ptp set-port-state enable command to enable the function to statically specify the 1588v2/G.8275.1 interface status and then run the ptp port-state command to specify the clock synchronization status of all interfaces (except for the TC interface). After the ptp set-port-state enable command is run in the system view, all 1588v2/G.8275.1 interfaces are in the initializing state by default.
The following considerations apply when statically configuring the 1588v2 interface status:

    The status of a TC interface is fixed to be premaster. Therefore, you cannot change the status of TC interfaces, including all the 1588v2 interfaces on the E2ETC and P2PTC devices and TC interfaces on the E2ETCOC and P2PTCOC devices using commands.
    If the status of a 1588v2 interface has been specified and the device mode needs to be switched to E2ETC, P2PTC, E2ETCOC, or 2PTCOC, delete the 1588v2 interface status configuration.
    A 1588v2 device can be configured with only one slave interface.

Ensure that a G.8275.1 device is configured with only one slave interface.
Example

# Enable the function to statically specify the interface status.

<HUAWEI> system-view
[HUAWEI] ptp set-port-state enable slot 0

ptp slaveonly
Function

The ptp slaveonly command sets the attribute of the clock source interface of the OC to slave-only.

The undo ptp slaveonly command restores the default status of the PTP interface of the OC.

By default, the clock source interface can be a master interface or a slave interface.
Format

ptp slaveonly slot slot-id

undo ptp slaveonly slot slot-id
Parameters

Parameter
	

Description
	

Value
slot slot-id 	Specifies the ID of the slot where the OC with the PTP interface in the slave state resides. 	The value range depends on the device configuration.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage scenario

When an OC functions as the last clock node, the OC receives clock signals from an upstream device and sends the clock signals to clients. To prevent clock signals of clients from affecting the PTP system, configure the interface status of the OC to slave-only. This configuration ensures that the OC does not synchronize the clock signals of clients.

The OC in a domain has only one PTP interface. If the interface status of the OC is set to slave-only, no interface can switch to the master.
Example

# Set the attribute of the clock source interface to slave-only on the OC.

<HUAWEI> system-view
[HUAWEI] ptp device-type oc slot 0
[HUAWEI] ptp slaveonly slot 0

ptp sync-interval
Function

The ptp sync-interval command sets the interval for sending Sync packets from an interface.

The undo ptp sync-interval command restores the default interval for sending Sync packets from an interface.

By default, the interval for sending 1588v2 Sync packets is 8 ms, the interval for sending G.8275.1 Sync packets is 64 ms.
Format

ptp sync-interval sync-interval

undo ptp sync-interval
Parameters

Parameter
	

Description
	

Value

sync-interval
	

Indicates that the interval for sending Sync packets on an interface is set to the nth power of 2 in milliseconds, where n is specified by sync-interval.
	

The value is an integer that ranges from 0 to 20.

In 1588v2 mode, the default value is 3. That is, the interval is 8 ms. In G.8275.1 mode, the default value is 6. That is, the interval is 64 ms.
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage scenario

Sync packets are used to generate timestamps when the delay mechanism is used. Based on the generated timestamps, PTP calculates the link delay and implements clock synchronization. The interval for sending Sync packets affects the clock synchronization accuracy. A higher interval indicates a higher clock synchronization accuracy. However, a high packet sending interval will increase the network load. Therefore, configure the interval for sending Sync packets according to networking requirements.
Example

# Set the interval for sending Sync packets to 128 ms on XGigabitEthernet0/0/1.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp sync-interval 7

ptp tcoc-clock-id
Function

The ptp tcoc-clock-id command, you can specify a clock source for an OC interface on the TCOC device to synchronize.

The undo ptp tcoc-clock-id command cancels the previous setting.

By default, no clock source is specified for a TCOC device to synchronize.
Format

ptp tcoc-clock-id clock-source-id port-num port-num

undo ptp tcoc-clock-id
Parameters

Parameter
	

Description
	

Value

clock-source-id
	

Specifies the ID of the peer clock source (ID of the static clock source).
	

The format is HHHHHHHH. H is a two-digit hexadecimal number, such as E0 and FC.

port-num port-num
	

Indicates the number of the interface where the peer master clock is located. The value is converted from the x/y/z format of the interface number. x stands for the slot number, y stands for the sub-card number, and z stands for the interface number.

To convert the port number from the x/y/z format into an integer, you need to first convert x into a 6-bit binary number; y into a 2-bit binary number; z into an 8-bit binary number. Then, rank these binary numbers in the format of x/y/z to obtain a 16-bit binary number. Convert the 16-bit binary number into a decimal number, which is the port-num value. For example, port number 2/0/1 on the master clock is converted into 2049.
	

The value is an integer that ranges from 0 to 65535.
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage scenario

The ptp tcoc-clock-id command specifies the interface from which the local device synchronizes the clock frequency. The clock-source-id and port-num parameter of the command specify the port identify. The local device accepts only the PTP packets with specified clock ID and port number.

Precautions

    A TCOC device cannot synchronize the time. It can synchronize only the frequency; therefore, it can be configured with only one interface.

    clock-source-id specifies the clock ID of the peer master clock source device and port-num specifies the number of the peer master clock interface. If the values of clock-source-id and port-num are incorrect or the specified master clock source is faulty, synchronization cannot be performed.

Example

# Set ID of the clock source for XGigabitEthernet0/0/1 on the TCOC device to 122323FFFE122110.

<HUAWEI> system-view
[HUAWEI] ptp device-type e2etcoc slot 0
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp tcoc-clock-id 122323FFFE122110 port-num 1

ptp udp-egress
Function

The ptp udp-egress command sets the UDP encapsulation mode for PTP packets.

The undo ptp udp-egress source-ip command restores the encapsulation mode for PTP packets to MAC encapsulation mode.

Using the undo ptp udp-egress { destination-ip | destination-mac | dscp | vlan | priority } command, you can restore the default configuration of the UDP encapsulation mode.

By default, PTP packets are encapsulated in MAC multicast mode. If UDP encapsulation is configured, multicast UDP encapsulation is used by default.
Format

ptp udp-egress source-ip source-ip [ destination-ip destination-ip ] [ dscp dscp ] [ vlan vlan-id [ priority priority ] ]

ptp udp-egress destination-mac destination-mac

undo ptp udp-egress { source-ip | destination-ip | destination-mac | dscp | vlan | priority }
Parameters

Parameter
	

Description
	

Value

source-ip source-ip
	

Indicates the source IP address of the UDP-encapsulated PTP packets.
	

The value is in dotted decimal notation.

destination-ip destination-ip
	

Indicates the destination IP address of the UDP-encapsulated PTP packets.
	

The value is in dotted decimal notation.

destination-mac destination-mac
	

Indicates the destination MAC address of the UDP-encapsulated PTP packets.
	

The value is in the format of H-H-H. An H contains one to four hexadecimal numbers.

dscp dscp
	

Indicates the Differentiated Service Code Point (DSCP) priority carried in the UDP-encapsulated PTP packets.
	

The value is an integer that ranges from 0 to 63. The default value is 56.

vlan vlan-id
	

Indicates the VLAN ID encapsulated in the PTP packets.
	

The value is an integer that ranges from 1 to 4094.
priority priority 	

Indicates the 802.1p priority carried in the VLAN-encapsulated packet.
	

The value is an integer that ranges from 0 to 7. The default value is 7, indicating the highest priority.
Views

XGE interface view, 25GE interface view, 40GE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage scenario

By default, PTP packets are encapsulated in multicast MAC mode. You can use the ptp udp-egress command to change the encapsulation mode to UDP encapsulation to implement Layer 3 encapsulation.
UDP encapsulation is further classified into unicast UDP encapsulation and multicast UDP encapsulation.

    Unicast encapsulation

    In this encapsulation mode, you need to set the unicast destination IP address of PTP packets.

    Multicast encapsulation
    Table 3-183 shows destination IP addresses that can be used only in the multicast UDP encapsulation.
    Table 3-183 Default multicast IP address for delay and Pdelay measurement mechanisms
    Delay Mechanism 	IP Address

    All except peer delay
    	

    224.0.1.129

    Peer delay
    	

    224.0.0.107
    In multicast UDP encapsulation mode, you do not need to set the destination IP address.

Precautions

Before using the ptp udp-egress destination-mac destination-mac command to configure the destination MAC address for UDP encapsulation, configure the source IP address for UDP encapsulation. The destination MAC address cannot be all 0s or a multicast address.
Example

# Configure the PTP packet to be encapsulated in UDP unicast mode. Set the source IP address of the PTP packet to 192.168.2.2 and the destination IP address to 192.168.1.1.

<HUAWEI> system-view
[HUAWEI] interface xgigabitethernet 0/0/1
[HUAWEI-XGigabitEthernet0/0/1] ptp udp-egress source-ip 192.168.2.2 destination-ip 192.168.1.1

ptp virtual-clock-id
Function

The ptp virtual-clock-id command configures the virtual clock ID on the PTP device.

The undo ptp virtual-clock-id command restores the automatically generated clock ID on the PTP device.

By default, no virtual clock ID is configured on the PTP device. The clock ID is generated by padding fffe to the middle of the system bridge MAC address. For example, if the system bridge MAC address is 111122223333, the default clock ID is 111122fffe223333.
Format

ptp virtual-clock-id clock-id-value slot slot-id

undo ptp virtual-clock-id slot slot-id
Parameters

Parameter
	

Description
	

Value

clock-id-value
	

Specifies the lower four bytes of a virtual clock ID.

The lower four bytes of the virtual clock ID are configurable, whereas the higher four bytes are automatically allocated by the system.

The value of the higher four bytes automatically allocated by the system is 0x00259e32.
	

The value range is 00000001-ffffffff in the form of a hexadecimal number.
slot slot-id 	Specifies the ID of the slot where the involved PTP device resides. 	The value range depends on the device configuration.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

The 8-byte clock ID uniquely identifies a PTP device in the PTP domain. When a PTP device performs the master-slave switchover, the clock ID of the PTP device changes along with the system bridge MAC address. As a result, the clock ID may not uniquely identify the PTP device.

By using the ptp virtual-clock-id command, you can specify the clock ID of a PTP device. The specified clock ID does not change in the case of the master-slave switchover, and can therefore uniquely identify the PTP device. The lower four bytes of the virtual clock ID are configurable, whereas the higher four bytes are automatically allocated by the system.
Example

# Set the lower four bytes of the virtual clock ID on the PTP device to 00000123.

<HUAWEI> system-view
[HUAWEI] ptp virtual-clock-id 00000123 slot 0

reset ptp statistics
Function

The reset ptp statistics command clears statistics on PTP packets on the interface of a device.
Format
reset ptp statistics { all [ slot slot-id ] | interface interface-type interface-number }
Parameters

Parameter
	

Description
	

Value

all
	

Clears statistics on the received PTP packets of all interfaces.
	

-

interface interface-type interface-number
	
Clears statistics on the received PTP packets of a specified interface.

    interface-type specifies the type of an interface.

    interface-number specifies the number of an interface.

	

-
slot slot-id 	Clears statistics on the received PTP packets of all interface with a specified slot ID. 	The value range depends on the device configuration.
Views

User view
Default Level

2: Configuration level
Usage Guidelines

You can use the reset ptp statistics command to clear the statistics on the received PTP packets of a specified interface or all interfaces by restoring the counter.
Example

# Clear the statistics on PTP packets on XGigabitEthernet0/0/1.

<HUAWEI> reset ptp statistics interface xgigabitethernet 0/0/1

