VCMP Configuration Commands

    Command Support
    display vcmp counters
    display vcmp interface brief
    display vcmp status
    display vcmp track
    reset vcmp
    reset vcmp counters
    reset vcmp track
    vcmp authentication
    vcmp device-id
    vcmp disable
    vcmp domain
    vcmp role

Command Support

Commands provided in this section and all the parameters in the commands are supported by all switch models (except the S5751-L, S5731-L, and S5731S-L), unless otherwise specified. For details, see specific commands.
display vcmp counters
Function

The display vcmp counters command displays statistics on VCMP packets.
Format

display vcmp counters
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

If VCMP configured on a switch does not take effect, run the display vcmp counters command to view statistics on VCMP packets. The statistics helps you determine whether data on the switch is incorrect and locate faults.
Example

# Display statistics on VCMP packets.

<HUAWEI> display vcmp counters
VCMP statistics:
Received summary packets                        : 0
Received request packets                        : 0
Received subset packets                         : 0
Sent summary packets                            : 0
Sent request packets                            : 0
Sent subset packets                             : 0
Received packets with ethheader error           : 0
Received packets with version error             : 0
Received packets with type error                : 0
Received packets with digest error              : 0
Received packets with domain error              : 0
Received packets with deviceid error            : 0
Failed to receive packets for bad vcmp state    : 0
Failed to send packets for bad vcmp state       : 0
Failed to receive packets for bad vlan          : 0
Failed to send packets for bad vlan             : 0
Failed to receive packets for bad link state    : 0
Failed to send packets for bad link state       : 0
Failed to receive packets for bad link type     : 0
Failed to send packets for bad link type        : 0
Failed to receive packets for bad forward state : 0
Failed to send packets for bad forward state    : 0
Failed to receive packets for bad length        : 0
Failed to receive packets for other             : 0

Table 5-71 Description of the display vcmp counters command output

Item
	

Description

VCMP statistics
	

Statistics on VCMP packets.

Received summary packets
	

Number of received VCMP Summary-Advert packets.

Received request packets
	

Number of received VCMP Advert-Request packets.

Received subset packets
	

Number of received VCMP subset packets.

Sent summary packets
	

Number of sent VCMP Summary-Advert packets.

Sent request packets
	

Number of sent VCMP Advert-Request packets.

Sent subset packets
	

Number of sent VCMP subset packets.

Received packets with ethheader error
	

Number of received VCMP packets with an incorrect Ethernet header.

Received packets with version error
	

Number of received VCMP packets with an incorrect protocol version.

Received packets with type error
	

Number of received VCMP packets of an incorrect type.

Received packets with digest error
	

Number of received VCMP packets with an incorrect digest.

Received packets with domain error
	

Number of received VCMP packets with an incorrect VCMP domain name.

Received packets with deviceid error
	

Number of received VCMP packets with an incorrect device ID.

Failed to receive packets for bad vcmp state
	

Number of packets that failed to be received due to incorrect VCMP status.

Failed to send packets for bad vcmp state
	

Number of packets that failed to be sent due to incorrect VCMP status.

Failed to receive packets for bad vlan
	

Number of packets that failed to be received due to incorrect VLAN information.

Failed to send packets for bad vlan
	

Number of packets that failed to be sent due to incorrect VLAN information.

Failed to receive packets for bad link state
	

Number of packets that failed to be received due to incorrect link status.

Failed to send packets for bad link state
	

Number of packets that failed to be sent due to incorrect link status.

Failed to receive packets for bad link type
	

Number of packets that failed to be received due to an incorrect link type.

Failed to send packets for bad link type
	

Number of packets that failed to be sent due to an incorrect link type.

Failed to receive packets for bad forward state
	

Number of packets that failed to be received due to incorrect forwarding status of the Layer 2 Ethernet interface.

Failed to send packets for bad forward state
	

Number of packets that failed to be sent due to incorrect forwarding status of the Layer 2 Ethernet interface.

Failed to receive packets for bad length
	

Number of packets that failed to be received because their lengths are incorrect.

Failed to receive packets for other
	

Number of packets that failed to be received due to other causes.
display vcmp interface brief
Function

The display vcmp interface brief command displays the VCMP status on Layer 2 Ethernet interfaces.
Format

display vcmp interface brief
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

By default, VCMP is enabled on all Layer 2 Ethernet interfaces of a switch. You can run the display vcmp interface brief command to view the VCMP status on Layer 2 Ethernet interfaces.
Example

# Display the VCMP status on Layer 2 Ethernet interfaces.

<HUAWEI> display vcmp interface brief

Vcmp interface number:2
Interface                         Vcmp State
--------------------------------------------
GigabitEthernet0/0/1              disable
GigabitEthernet0/0/2              enable

Table 5-72 Description of the display vcmp interface brief command output

Item
	

Description

Vcmp interface number
	

Number of Layer 2 Ethernet interfaces supporting VCMP.

Interface
	

Name and number of a Layer 2 Ethernet interface on which VCMP can run.

Vcmp State
	

VCMP status on a Layer 2 Ethernet interface.

To specify the parameter, run the vcmp disable command.
display vcmp status
Function

The display vcmp status command displays the VCMP configuration, including the VCMP domain name, VCMP role, device ID, configuration revision number, and VCMP domain authentication password.
Format

display vcmp status
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

After VCMP is configured on a switch, you can run the display vcmp status command to view the VCMP configuration.
Example

# Display the VCMP configuration.

<HUAWEI> display vcmp status

VCMP information:
Domain                  : VLAN
Role                    : Server
Server ID               : VLAN
Configuration Revision  : 0x846a0000
Password                : ******

Table 5-73 Description of the display vcmp status command output

Item
	

Description

VCMP information
	

VCMP information.

Domain
	

VCMP domain name. To change the VCMP domain name, run the vcmp domain command.

Role
	

VCMP role of the switch in the VCMP domain. To change the VCMP role, run the vcmp role command.

Server ID
	

ID of the switch functioning as the VCMP server. To change the device ID, run the vcmp device-id command.

Configuration Revision
	

Configuration revision number.

Password
	

VCMP domain authentication password. To change the authentication password, run the vcmp authentication command.

If no authentication password is configured, this parameter is left empty.
display vcmp track
Function

The display vcmp track command displays VLAN changes on a device functioning as a client.
Format

display vcmp track
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

If VLAN changes, including creating VLANs, deleting VLANs, modifying VLAN names, and modifying VLAN descriptions, are made on a device functioning as a server, the device functioning as a client synchronizes its VLAN information with that on the server by exchanging VCMP packets. To view VLAN changes, run the display vcmp track command on the client.
Example

# Display VLAN changes on the client.

<HUAWEI> display vcmp track
Operate Flags: A - Add, D - Delete, VN - VLAN Name , VD - VLAN Description
-------------------------------------------------------------------------------
Op System-Time              Operate-VLAN
-------------------------------------------------------------------------------
A  03-19 19:32:27           103
A  03-19 19:30:57           10
D  03-19 19:15:52           20
VD 03-19 19:12:20           100
VN 03-19 19:12:06           100
A  03-19 19:10:48           101
A  03-19 19:09:45           100

Table 5-74 Description of the display vcmp track command output

Item
	

Description

Operate Flags
	
Operation flag:

    A: Newly created VLANs
    D: Deleted VLANs
    VN: VLANs whose names were modified
    VD: VLANs whose descriptions were modified

Op System-Time
	

System time

Operate-VLAN
	

Operated VLAN
reset vcmp
Function

The reset vcmp command clears the VCMP domain name and device ID learned on a VCMP client.
Format

reset vcmp
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

The VCMP domain ID and device ID learned by a VCMP client remain unchanged. The VCMP client needs to learn VCMP information again when the VCMP server in the local VCMP domain is changed. Therefore, clear learned VCMP information before the VCMP client learns VCMP information.

Configuration Impact

After the reset vcmp command is executed, the learned VCMP information is cleared and cannot be restored. Therefore, exercise caution when you run the reset vcmp command.
Example

# Clear the VCMP domain name and device ID learned on a VCMP client

<HUAWEI> reset vcmp

reset vcmp counters
Function

The reset vcmp counters command clears statistics on VCMP packets.
Format

reset vcmp counters
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Before re-collecting statistics on VCMP packets in a specified period, run the reset vcmp counters command to clear existing statistics on VCMP packets.

Configuration Impact

After the reset vcmp counters command is executed, statistics on VCMP packets are cleared cannot be restored. Therefore, exercise caution when you run the reset vcmp counters command.
Example

# Clear statistics on VCMP packets.

<HUAWEI> reset vcmp counters

reset vcmp track
Function

The reset vcmp track command deletes VLAN changes on a device functioning as a client.
Format

reset vcmp track
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Before viewing VLAN changes on a client using the display vcmp track command, run the reset vcmp track command to delete existing VLAN changes.

Configuration Impact

After you run the reset vcmp track command, the deleted information cannot be restored. Therefore, exercise caution when running the reset vcmp track command.
Example

# Delete existing VLAN changes on the client.

<HUAWEI> reset vcmp track

vcmp authentication
Function

The vcmp authentication command sets a VCMP domain authentication password.

The undo vcmp authentication command deletes the VCMP domain authentication password.

By default, no VCMP domain authentication password is set and VCMP packets pass without authentication.
Format

vcmp authentication sha2-256 password password

undo vcmp authentication
Parameters
Parameter 	Description 	Value

sha2-256
	

Enables SHA2-256 authentication for a VCMP domain.
	

-

password password
	

Specifies a VCMP domain authentication password.
	

The value a string of case-sensitive characters, spaces not supported. Passwords are saved in ciphertext in the configuration file. Either of the following passwords can be set:

    A simple text password is a string of 1 to 8 characters.
    A ciphertext password is a string of 48 characters.

When double quotation marks are used around the string, spaces are allowed in the string.
NOTE:

A 32-character ciphertext password configured in an earlier version is also supported in this version.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

To enhance security for a VCMP domain, you can run the vcmp authentication command to set a VCMP domain authentication password on each switch for authenticating packets exchanged between the switches in the VCMP domain.

Precautions

All switches in a VCMP domain must use the same VCMP domain authentication password.
Example

# Set the VCMP domain authentication password to huawei.

<HUAWEI> system-view

[HUAWEI] vcmp authentication sha2-256 password huawei

vcmp device-id
Function

The vcmp device-id command sets the device ID of the VCMP server.

The undo vcmp device-id command deletes the device ID of the VCMP server.

By default, no device ID is set for the VCMP server.
Format

vcmp device-id device-name

undo vcmp device-id
Parameters
Parameter 	Description 	Value

device-name
	

Specifies a device ID.
	

The value is a string of 1 to 31 case-sensitive characters without spaces. When double quotation marks are used around the string, spaces are allowed in the string.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

A device ID identifies the VCMP server so that other roles in a VCMP domain can identify the VCMP server.

Prerequisites

The vcmp role server command has been executed to configure a server role for a switch in a VCMP domain. The device ID can be set only for the VCMP server.
Example

# Set the device ID of the VCMP server.

<HUAWEI> system-view

[HUAWEI] vcmp device-id VLAN

vcmp disable
Function

The vcmp disable command disables VCMP on an interface.

The undo vcmp disable command enables VCMP on an interface.

By default, VCMP is enabled on all interfaces of a switch.
Format

vcmp disable

undo vcmp disable
Parameters

None
Views

Ethernet interface view, GE interface view, XGE interface view, 25GE interface view, 100GE interface view, 40GE interface view, MultiGE interface view, Eth-Trunk interface view, port group view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

By default, VCMP is enabled on all interfaces of a switch. If an edge switch in a VCMP domain requires VCMP management but its peer end does not require VCMP management, run the vcmp disable command on the edge switch Layer 2 interface connected to the peer end to disable VCMP. The peer end then does not receive VCMP packets.

Prerequisites

The interface connected to the peer end has been configured as a Layer 2 interface using the portswitch command.
Example

# Disable VCMP on GE0/0/1.

<HUAWEI> system-view

[HUAWEI] interface gigabitethernet 0/0/1

[HUAWEI-GigabitEthernet0/0/1] vcmp disable

vcmp domain
Function

The vcmp domain command configures a VCMP domain.

The undo vcmp domain command deletes a VCMP domain.

By default, no VCMP domain is created.
Format

vcmp domain domain-name

undo vcmp domain
Parameters
Parameter 	Description 	Value
domain-name 	

Specifies the name of a VCMP domain.
	The value is a string of 1 to 31 case-sensitive characters without spaces. When double quotation marks are used around the string, spaces are allowed in the string.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

VLANs created and deleted on the VCMP server are synchronized to VCMP clients in the local VCMP domain by sending VCMP packets.

A VCMP domain specifies the scope for managed switches. All VCMP clients are managed by the VCMP server. You can run the vcmp domain command to configure a VCMP domain.

Precautions

All switches in a VCMP domain must use the same domain name either through manual configuration or automatic learning. If the domain name is not set on a VCMP client, the VCMP client learns the domain name in the first received VCMP packet.

Each switch can be added to only one VCMP domain. Switches in different VCMP domains cannot synchronize VLAN information.
Example

# Configure a VCMP domain named VLAN.

<HUAWEI> system-view

[HUAWEI] vcmp domain VLAN

vcmp role
Function

The vcmp role command configures a role for a switch in a VCMP domain.

The undo vcmp role command restores the default role of a switch in a VCMP domain.

By default, switches in a VCMP domain are VCMP silent.
Format

vcmp role { client | server | silent | transparent }

undo vcmp role
Parameters
Parameter 	Description 	Value

client
	

Indicates the client role in a VCMP domain.

As a managed role, a VCMP client synchronizes VLAN information with the VCMP server.

After the VCMP server is specified on a Layer 2 network, VCMP clients in the same domain learn VLAN information in VCMP packets from the VCMP server and synchronize the VLAN information. You can create and delete VLAN information on VCMP clients. Local VLAN information on VCMP clients, however, are overwritten by VLAN information synchronized from the VCMP server.
	

-

server
	

Indicates the server role in a VCMP domain.

You can create and delete VLAN information on the VCMP server. The VCMP server synchronizes VLAN information to other switches in the local VCMP domain by sending VCMP packets.
	

-

silent
	

Indicates the silent role in a VCMP domain.

Deployed at the edge of a VCMP domain, a VCMP silent switch prevents VCMP packets in a VCMP domain from being transmitted to other VCMP domains, saving unnecessary costs of devices in other VCMP domains.

A VCMP silent switch directly discards received VCMP packets.
	

-

transparent
	

Indicates the transparent role in a VCMP domain.

A VCMP transparent switch does not affect other switches in the local VCMP domain and is not affected by VCMP management behaviors such as VLAN creation and deletion. The VCMP transparent switch transparently forwards VCMP packets. Only trunk or hybrid interfaces in VLAN 1 can receive and forward VCMP packets.

VLANs created and deleted on a VCMP transparent switch are not synchronized to other switches.
	

-
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

VLANs created and deleted on the VCMP server are synchronized to VCMP clients in the local VCMP domain by sending VCMP packets.

You can run the vcmp role command to set roles of switches in a VCMP domain.

Precautions

In V200R021C10 and earlier versions, the VCMP role is Client by default. In V200R022C00 and later versions, the VCMP role is Silent by default. If a device is upgraded from V200R021C10 or an earlier version to V200R022C00 or a later version, the VCMP role does not change after the upgrade.
In V200R021C10 and earlier versions:

    The VCMP role of a device is Client by default and the device configuration file does not contain the vcmp role client command. After the device is upgraded to V200R022C00 or a later version, the device configuration file contains the vcmp role client command.
    If the vcmp role silent command has been run on a device to set the VCMP role to Silent, the device configuration file contains the vcmp role silent command. After the device is upgraded to V200R022C00 or a later version, the device configuration file does not contain the vcmp role silent command.

Example

# Configure a switch as the VCMP server in a VCMP domain.

<HUAWEI> system-view

[HUAWEI] vcmp role server
Warning: Change the VCMP role from client to server.Continue? [Y/N]:y  

