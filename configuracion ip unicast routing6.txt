header:
● Link-State Advertisement Type: indicates the LSA type.
● Link State ID: indicates a link state ID. In a Router-LSA, this field indicates the
router ID of the device that originates this LSA. Here, the value of this field is
the router ID of R2.
● Advertising Router: indicates the router that advertises this LSA.
A Router-LSA contains three information fields, which are used to advertise a
router's link states and costs to other routers in the area where this LSA is flooded.
The LSA shown in Figure 5-25 indicates that: The link type (Type) is a transit
network (Transit), the DR interface's IP address (ID) is 192.168.23.2, the interface
IP address of the advertising router connected to the network is 192.168.23.1
(Data), and the cost (Metric) to this network is 1. Routers that receive this LSA
generate the topology based on the link state information.
Four link types area available, and the ID and Data field values vary depending on
the link type:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 201
● P2P (the field value is 1): The ID field indicates the router ID of a neighbor,
and the Data field indicates the interface IP address of the advertising router
connected to the network.
● Transit (the field value is 2): The ID field indicates the IP address of the DR
interface, and the Data field indicates the interface IP address of the
advertising router connected to the network.
● Stub (the field value is 3): The ID field indicates the IP network or subnet
address, and the Data field indicates the network IP address or subnet mask.
● Virtual Link (the field value is 4): The ID field indicates the router ID of a
neighbor, and the Data field indicates the MIB-II ifIndex of the advertising
router's interface.
Network-LSA
A Network-LSA is a Type 2 LSA. It describes the link states of all routers on the
local network segment. A DR generates Network-LSAs and advertises them within
its area. In Figure 5-26, R3 sends R2 a Network-LSA that contains router IDs of all
the routers that establish adjacencies with the DR.
Figure 5-26 Network-LSA (Type 2)
Figure 5-27 shows the information contained in the Network-LSA.
Figure 5-27 Information in a Network-LSA
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 202
In a Network-LSA, the Link State ID field indicates the IP address of a DR
interface.
Flooding Router-LSAs and Network-LSAs within an area enables each router in this
area to complete LSDB synchronization, which implements intra-area
communication.
Network-summary-LSA
A Network-summary-LSA is a Type 3 LSA. It describes inter-area routing
information. An ABR generates Network-summary-LSAs and advertises them
within its area to notify destination addresses of routes from this area to other
areas. Actually, an ABR generates Network-summary-LSAs by collecting Type 1
and Type 2 LSAs within its area and summarizing related routes. In Figure 5-28,
R2 functions as an ABR to advertise routing information in Area 0 and Area 1 to
Area 1 and Area 0 respectively.
Figure 5-28 Network-summary-LSA (Type 3)
Figure 5-29 shows the information contained in a Network-summary-LSA
advertised by R2 on GE0/0/1.
Figure 5-29 Information in a Network-summary-LSA
In a Network-summary-LSA, the Link State ID field indicates the IP address of the
network described by this LSA. Information in this LSA shows that this LSA is
advertised by R2 (10.2.2.2) and can reach the network with the IP address
192.168.12.0 and the subnet mask 255.255.255.0 at the cost of 1. R2 advertises
the network address of Area 1 to Area 0 so that routers in Area 0 know how to
reach the network in Area 1, implementing inter-area communication.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 203
If an ABR has multiple routes within its area to reach a destination, it originates
only one Network-summary-LSA carrying the route with the lowest cost to the
backbone area.
Network-summary-LSAs will not be advertised within totally stub areas or totally
NSSAs.
ASBR-Summary-LSA
An ASBR-summary-LSA is a Type 4 LSA. It describes routes to an ASBR. An ABR
generates ASBR-summary-LSAs and advertises them to areas except the area to
which the ASBR is located. In Figure 5-30, R3 functions as an ABR to advertise an
ASBR-summary-LSA to Area 0.
Figure 5-30 ASBR-summary-LSA (Type 4)
Figure 5-31 shows information contained in an ASBR-summary-LSA. The Link
State ID field indicates the router ID (10.4.4.4) of the ASBR that this LSA
describes, namely, R4. The router that advertises this LSA is R3 (10.3.3.3), and the
cost of the route from R3 to R4 is 1.
Figure 5-31 Information in an ASBR-summary-LSA
AS-external-LSA
An AS-external-LSA is a Type 5 LSA. It describes routes to destinations outside an
AS. An ASBR generates AS-external-LSAs and advertises them to all areas except
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 204
stub areas and NSSAs. In Figure 5-32, R4 functions as an ASBR to advertise a
route to an external destination network outside the AS.
Figure 5-32 AS-external-LSA (Type 5)
Figure 5-33 shows the information contained in an AS-external-LSA. The Link
State ID field indicates the destination IP address of the external network. The
Forwarding Address field indicates the address to which packets destined for this
external network should be forwarded. Here, the forwarding address 0.0.0.0
indicates that packets will be forwarded to the ASBR that generates this LSA.
Figure 5-33 Information in an AS-external-LSA
NSSA LSA
In addition to the preceding LSAs, there is a special type of LSA, namely, NSSA
LSA. An NSSA LSA is a Type 7 LSA. It describes routes to destinations outside an
AS. An ASBR generates NSSA LSAs and advertises them only in NSSAs. When an
ABR in an NSSA receives NSSA LSAs, the ABR selectively translates them into Type
5 LSAs to advertise imported external routes to other areas on the OSPF network.
If Area 2 in Figure 5-23 is an NSSA, GE0/0/2 of R4 generates an NSSA LSA, as
shown in Figure 5-34.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 205
Figure 5-34 NSSA LSA
NSSA LSAs and AS-external-LSAs have the same fields but are flooded into
different areas. AS-external-LSAs are flooded within an AS, whereas NSSA LSAs
are flooded within NSSAs.
NSSAs allow importing external routes, but NSSA LSAs describing external routes
can only be flooded within NSSAs. To enable external routes to be imported into
all areas except NSSAs, the ABR (R3) translates NSSA LSAs into AS-external-LSAs
and floods the AS-external-LSAs within the entire AS. The following provides more
information about the translation:
● The propagate bit (P-bit) in Type 7 LSAs is used to notify a router of whether
the Type 7 LSAs need to be translated.
● By default, the translator is the ABR with the largest router ID in the NSSA.
● Only NSSA LSAs with the P-bit set to 1 and a non-zero forwarding address
(FA) can be translated into AS-external-LSAs. An FA indicates a specific
address that a packet will be forwarded to before arriving at the destination
address.
● The P-bit is not set for default routes in NSSA LSAs generated by an ABR.
Opaque LSA
Opaque LSAs include Type 9 LSAs, Type 10 LSAs, and Type 11 LSAs. They provide a
universal mechanism for OSPF extensions.
● Type 9 LSAs are advertised only on the network segment where the
originating interface resides. Grace LSAs used to support graceful restart (GR)
are Type 9 LSAs.
● Type 10 LSAs are advertised within an OSPF area. LSAs used to support traffic
engineering (TE) are Type 10 LSAs.
● Type 11 LSAs are advertised within an AS. At present, there are no
applications of Type 11 LSAs.
Table 5-9 describes whether a type of LSA is supported in an area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 206
Table 5-9 Support status of LSAs in different types of areas
Area Type Router
-LSA
(Type
1)
Netwo
rk-LSA
(Type
2)
Netwo
rk-
summ
ary-
LSA
(Type
3)
ASBR-
summa
ry-LSA
(Type
4)
AS-
extern
al-LSA
(Type
5)
NSSA-
LSA
(Type
7)
Common area
(including standard
and backbone
areas)
Suppor
ted
Suppor
ted
Suppor
ted
Suppor
ted
Support
ed
Not
support
ed
Stub area Suppor
ted
Suppor
ted
Suppor
ted
Not
support
ed
Not
support
ed
Not
support
ed
Totally stub area Suppor
ted
Suppor
ted
Not
support
ed
Not
support
ed
Not
support
ed
Not
support
ed
NSSA Suppor
ted
Suppor
ted
Suppor
ted
Not
support
ed
Not
support
ed
Suppor
ted
Totally NSSA Suppor
ted
Suppor
ted
Not
support
ed
Not
support
ed
Not
support
ed
Suppor
ted
5.2.1.10 OSPF Fast Convergence
OSPF fast convergence speeds up the convergence of routes. It includes the
following components:
● Incremental SPF (I-SPF): recalculates only the routes of the changed nodes
rather than all the nodes when the network topology changes, which speeds
up route calculation.
● Partial Route Calculation (PRC): calculates only the changed routes when the
routes on the network change.
● OSPF intelligent timer: can dynamically adjust its value based on the user's
configuration and the frequency of a triggering event, such as route
calculation, which ensures rapid and stable network operation.
The OSPF intelligent timer uses the exponential backoff technology so that
the value of the timer is accurate to milliseconds.
I-SPF
In ISO 10589, the Dijkstra algorithm was adopted to calculate routes. When a
node changes on the network, this algorithm is used to recalculate all routes,
which takes a long time and consumes too many CPU resources, affecting the
convergence speed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 207
I-SPF improves the Dijkstra algorithm. Except for the first time, only changed
nodes instead of all nodes are involved in calculation. The SPT generated at last is
the same as that generated using the Dijkstra algorithm. I-SPF consumes fewer
CPU resources and speeds up network convergence.
PRC
Similar to I-SPF, PRC performs calculation only for the changed routes. The
difference is that PRC does not calculate the shortest paths. It updates routes
based on the SPTs calculated by I-SPF.
In route calculation, a leaf represents a route, and a node represents a router.
Either an SPT change or a leaf change causes a routing information change. The
SPT change is irrelevant to the leaf change. PRC processes routing information as
follows:
● If the SPT changes, PRC processes the routing information of all leaves on a
changed node.
● If the SPT remains unchanged, PRC does not process the routing information
on any node.
● If a leaf changes, RPC processes the routing information on the leaf only.
● If a leaf remains unchanged, PRC does not process the routing information on
any leaf.
For example, if OSPF is enabled on an interface of a node, the SPT calculated by I-
SPF remains unchanged. PRC updates only the routes of this interface, consuming
fewer CPU resources.
PRC improves the SPF algorithm. Working with I-SPF, RPC further improves
network convergence performance.
NOTE
On live networks, only I-SPF and PRC are used to calculate OSPF routes.
OSPF Intelligent Timer
On an unstable network, routes are calculated frequently, which consumes a great
number of CPU resources. In addition, LSAs that describe the unstable topology
are generated and transmitted on the unstable network. Frequent processing of
data such LSAs affects the rapid and stable operation of the entire network.
To speed up route convergence on the entire network, you can use the OSPF
intelligent timer that can control route calculation, LSA generation, and LSA
receipt.
The OSPF intelligent timer works in either of the following modes:
● On a network where routes are calculated repeatedly, the OSPF intelligent
timer dynamically adjusts the interval between two route calculations based
on user's configuration and the exponential backoff technology. In this way,
the number of route calculations can be reduced, and therefore fewer CPU
resources are consumed. Routes will be calculated again after the network
topology stabilizes.
● On an unstable network, a router generates or receives numerous LSAs due to
frequent topology changes. In this case, the OSPF intelligent timer can
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 208
dynamically adjust the interval at which the LSAs are generated or processed.
Within the interval, no LSAs are generated or processed. This prevents invalid
LSAs from being generated and advertised on the entire network.
The OSPF intelligent timer is started by default and has a default value.
5.2.1.11 OSPF Virtual Link
A virtual link is a logical channel set up between two ABRs through a non-
backbone area.
As required in RFC 2328, all non-backbone areas must be connected to the
backbone area to ensure that all areas are reachable. However, it is not true in
some scenarios due to certain restrictions. To resolve this issue, you can configure
an OSPF virtual link.
In Figure 5-35, Area 2 is not connected to Area 0. Therefore, RouterA cannot
function as an ABR to generate routing information of Network1 and advertise the
information to Area 2, and RouterB does not have routes to Network1. A virtual
link can be deployed to resolve this issue.
Figure 5-35 Non-backbone area not connected to the backbone area
In Figure 5-36, two ABRs use a virtual link to directly transmit OSPF packets. The
OSPF device between the two ABRs only forwards packets. Because the
destination of OSPF packets is not the OSPF device, the OSPF device transparently
transmits the OSPF packets as common IP packets.
Figure 5-36 OSPF virtual link implementation principles
A virtual link functions as a point-to-point connection between two ABRs. The
interfaces on both ends of the virtual link can be configured with parameters such
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 209
as the Hello interval in the same way these parameters are configured on physical
interfaces. The transmit area refers to the area that provides an internal route of a
non-backbone area for both ends of the virtual link. A virtual link must be
configured at both ends of the link, or it will not take effect.
A virtual link increases the network complexity and complicates fault locating. You
are not advised to use virtual links during network planning. Virtual links are only
a temporary measure to fix unavoidable network topology problems. When virtual
links are designed, you need to consider whether to re-plan the network.
5.2.1.12 OSPF Route Summarization and Filtering
OSPF Route Summarization
Route summarization allows multiple routes with the same prefix to be
summarized into a single summary route. Only the summary route is advertised to
other areas. This reduces both the routing table size and routing information
transmitted between areas, improving device performance.
OSPF supports two types of route summarization:
● Inter-area route summarization
Inter-area route summarization is performed on ABRs and applies to routes
from within an AS. An ABR generates Network-summary (Type 3) LSAs by
network segment while advertising routing information to other areas. If
network segments are contiguous, the ABR can summarize them into a single
segment. This allows the ABR to send only the summary LSA for all the
specified network segments.
● External route summarization
External route summarization is performed on ASBRs and is specific to
external routes that are imported into OSPF. ASBRs can summarize imported
AS-external (Type 5) LSAs within a summary address range. After an NSSA is
configured, an ASBR must summarize imported NSSA (Type 7) LSAs with the
summary address range.
Devices that are both ABRs and ASBRs summarize the Type 5 LSAs translated
from Type 7 LSAs.
OSPF Route Filtering
OSPF supports route filtering using routing policies, including route-policy, access-
list, and prefix-list. By default, OSPF does not filter routes.
OSPF route filtering can be used to:
● Import routes.
OSPF can import routes learned by other routing protocols. You can configure
routing policies to filter imported routes, allowing OSPF to import only routes
that match specific conditions.
● Advertise imported routes.
An OSPF device advertises imported routes to its neighbors.
You can configure filtering rules to filter the routes to be advertised, but the
rules take effect only on ASBRs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 210
● Learn routes.
Filtering rules can be configured to allow OSPF to filter received intra-area,
inter-area, and AS external routes.
After receiving routes, an OSPF device adds only the routes that match
filtering rules to the local routing table. However, the device can advertise all
routes from the OSPF routing table.
● Learn inter-area LSAs.
You can configure an ABR to filter incoming Summary LSAs. This
configuration takes effect only on ABRs because only ABRs can advertise
Summary LSAs.
Difference between route filtering for inter-area LSA learning and that for
route learning: The former directly filters incoming LSAs but the latter filters
the routes calculated using LSAs to determine the routes to be added to the
local routing table. In route filtering for route learning, all incoming LSAs are
learned.
● Advertise inter-area LSAs.
You can configure an ABR to filter outgoing Summary LSAs. This configuration
takes effect only on ABRs.
5.2.1.13 OSPF Multi-Process
OSPF supports multi-process. This allows multiple OSPF processes to run
independently on the same router. Route exchanges between different OSPF
processes are similar to route exchanges between different routing protocols.
Each router interface belongs to only one OSPF process.
OSPF multi-process typically applies to the scenario where OSPF runs between
provider edges (PEs) and customer edges (CEs) in a VPN whereas OSPF is used as
an IGP on the backbone of the VPN. On the PEs, the two OSPF processes do not
affect each other.
5.2.1.14 OSPF RFC 1583 Compatibility
RFC 1583 is an early version of OSPFv2.
During OSPF external route calculations, routing loops may occur because RFC
2328 and RFC 1583 define different route selection rules. To prevent routing loops,
both communication ends must use the same route selection rules. The
mechanism is as follows:
● When RFC 1583 compatibility is enabled, OSPF uses route selection rules
defined in RFC 1583.
● When RFC 1583 compatibility is disabled, OSPF uses route selection rules
defined in RFC 2328.
OSPF calculates external routes using Type 5 LSAs. If the router with RFC 1583
compatibility enabled receives a Type 5 LSA:
● The router selects a route to the ASBR that originates the LSA or to the
forwarding address (FA) described in the LSA.
● The router selects external routes to the same destination.
By default, OSPF uses route selection rules defined in RFC 1583.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 211
5.2.2 Enhanced OSPF Functions
5.2.2.1 OSPF VPN
Definition
OSPF VPN enables Provider Edges (PEs) and Customer Edges (CEs) within VPNs to
run OSPF. This is useful for interworking and allows OSPF to learn and advertise
VPN routes.
Purpose
As a widely used IGP, in most cases, OSPF runs in VPNs. When OSPF runs between
PEs and CEs and PEs are advertising VPN routes using OSPF, CEs do not need to
support other routing protocols for interworking, simplifying the management and
configuration of CEs.
Running OSPF Between PEs and CEs
In BGP/MPLS VPN, routing information is transmitted between PEs using Multi-
Protocol BGP (MP-BGP), whereas routing information is learned and advertised
between PEs and CEs using OSPF.
Running OSPF between PEs and CEs has the following benefits:
● OSPF is used within a site to learn routes. Running OSPF between PEs and CEs
can reduce the protocol types that CEs must support, lowering the
requirements on the CEs.
● Running OSPF both within a site and between PEs and CEs frees network
administrators from getting familiarity with multiple protocols, simplifying the
workload of them.
● Running OSPF between PEs and CEs facilitates the transition from a non-VPN
backbone network to a BGP/MPLS VPN network.
As shown in Figure 5-37, CE1, CE3, and CE4 belong to VPN 1. The numbers
following OSPF refer to the IDs of OSPF multi-instance processes running on PEs.
Figure 5-37 Running OSPF between PEs and CEs
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 212
To advertise routes of CE1 to CE3 and CE4:
1. PE1 imports OSPF routes of CE1 into BGP and generates BGP VPNv4 routes.
2. PE1 advertises BGP VPNv4 routes to PE2 using MP-BGP.
3. PE2 imports BGP VPNv4 routes into OSPF, and then advertises these routes to
CE3 and CE4.
The process of advertising routes of CE4 or CE3 to CE1 is the same.
Configuring OSPF Areas Between PEs and CEs
OSPF areas between PEs and CEs can be either non-backbones or backbone areas
(Area 0). A PE can only be an area border router (ABR).
In the extended application of OSPF VPN, the MPLS VPN backbone network serves
as Area 0. OSPF requires that backbone areas (Area 0) be contiguous. Therefore,
Area 0 in all VPN sites must be connected to the MPLS VPN backbone network. If
a VPN site has OSPF Area 0, the PEs that CEs access must be connected to the
backbone area of this VPN site through the MPLS VPN backbone network. If no
physical link is available to directly connect PEs to Area 0 in the VPN site, a virtual
link can be used to implement logical connection between them, as shown in
Figure 5-38.
Figure 5-38 Configuring OSPF areas between PEs and CEs
In Figure 5-38, a non-backbone area (Area 1) is configured between PE1 and CE1,
and a backbone area (Area 0) is configured in Site 1. As a result, the backbone
area in Site 1 is isolated from the VPN backbone area. Therefore, a virtual link is
configured between PE1 and CE1 to ensure that the backbone areas are
continuous.
OSPF Domain ID
If inter-area routes are advertised between local and remote OSPF areas, these
areas are considered in the same OSPF domain.
Important characteristics of OSPF domain IDs include:
● Domain IDs identify and differentiate different domains.
● Each OSPF domain has one or more domain IDs, one of which is a primary ID
with the others being secondary IDs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 213
● If an OSPF instance does not have a specific domain ID, NULL is used as its
domain ID.
Before a PE advertises the BGP routes learned from remote PEs to CEs, the PE
checks the domain IDs carried in the BGP routes to determine the type of OSPF
routes (Type 3, Type 5, or Type 7) to be advertised.
If local domain IDs are the same as or compatible with the remote domain IDs
carried in the BGP routes, the PE advertises Type 3 routes. Otherwise, the PE
advertises Type 5 or Type 7 routes.
Table 5-10 Domain ID
Comparison Between Local and Remote
Domain IDs
Advertised Route Type
Both the local and remote domain IDs are null. Inter-area route
The remote domain ID is the same as the local
primary domain ID or one of the local
secondary domain IDs.
Inter-area route
The remote domain ID is different from the
local primary domain ID and all the local
secondary domain IDs.
If the local area is a non-NSSA,
external routes are generated.
If the local area is an NSSA,
NSSA routes are generated.
Routing Loop Prevention
Routing loops may occur between PEs and CEs if OSPF and BGP learn routes from
each other.
Figure 5-39 OSPF VPN routing loop
As shown in Figure 5-39, a routing loop occurs in the following process:
1. PE1 uses OSPF to import a BGP route whose destination address is
10.1.1.1/32.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 214
2. OSPF then generates a Type 5 or Type 7 LSA and advertises it to CE1.
3. CE1 learns an OSPF route with the destination address of 10.1.1.1/32 and the
next hop of PE1 and advertises the route to PE2.
4. PE2 learns an OSPF route with the destination address and next hop being
10.1.1.1/32 and CE1 respectively.
5. Likewise, CE1 learns an OSPF route with the destination address of 10.1.1.1/32
and the next hop of PE2, and PE1 learns an OSPF route with the destination
address of 10.1.1.1/32 and the next hop of CE1.
6. In this way, CE1 has learned two equal-cost routes, with the next hop of one
being PE1 and the other being PE2. The next hops of the routes from PE1 and
PE2 to 10.1.1.1/32 are both CE1. That is, a routing loop occurs.
The preference of an OSPF route is higher than that of a BGP route. Therefore,
BGP routes on PE1 and PE2 to 10.1.1.1/32 are replaced by the OSPF routes. The
OSPF routes with the destination address of 10.1.1.1/32 and the next hop of CE1
are active in the routing tables of PE1 and PE2.
The BGP routes then become inactive, causing the deletion of the LSAs generated
when OSPF imports the routes. As a result, the active OSPF routes are withdrawn,
and the BGP route becomes active again. The above process occurs repeatedly,
leading to route flapping.
OSPF VPN provides a solution to this problem, as described in the following table.
Table 5-11 Routing loop prevention
Feature Definition Function
DN bit The DN bit is a 1-bit flag used by
an OSPF multi-instance process
to prevent routing loops.
When a PE advertises
generated Type 3, Type
5, or Type 7 LSAs to CEs,
it sets the DN bit of
these LSAs to 1 and
retains the default value
0 for the DN bit of other
LSAs.
When calculating routes,
the OSPF multi-instance
process of the PE ignores
LSAs with the DN bit set
to 1. This prevents the PE
from learning the self-
originated LSAs from
CEs, thereby avoiding
routing loops.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 215
Feature Definition Function
VPN route tag The VPN route tag is carried in
Type 5 or Type 7 LSAs generated
by PEs according to received BGP
private routes.
The VPN route tag is valid only
on the PEs that receive BGP
routes and generate OSPF LSAs.
It is not transmitted in BGP
extended community attributes.
When a PE detects that
the VPN route tag in the
received LSA is the same
as that in the local LSA,
the PE ignores this LSA.
This prevents routing
loops.
Default route A default route is a route with an
all-0 destination address and an
all-0 subnet mask.
Default routes are used
to forward traffic from
CEs or from the sites
where CEs reside
.
Disabling Routing Loop Prevention
NOTICE
Exercise caution when disabling routing loop prevention as it increases the
likelihood of routing loops.
After routing loop prevention is enabled, OSPF routing loops will not occur in VPN
sites during BGP/OSPF route exchanges.
In an inter-AS VPN Option A scenario, if OSPF runs between ASBRs to transmit
VPN routes, the remote ASBR will be unable to learn the OSPF routes sent by the
local ASBR due to the routing loop prevention mechanism.
Figure 5-40 illustrates an inter-AS VPN in Option A mode. OSPF runs between PE1
and CE1. Assume that CE1 sends VPN routes to CE3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 216
Figure 5-40 Networking diagram of an inter-AS VPN deployed in Option A mode
In Figure 5-40:
1. PE1 learns routes to CE1 through the OSPF process within a VPN instance,
imports these routes into MP-BGP, and then sends the MP-BGP routes to
ASBR1.
2. ASBR1 receives the MP-BGP routes, imports the routes into the OSPF process
within a VPN instance, and then generates Type 3, Type 5, or Type 7 LSAs with
the DN bit set to 1.
3. When learning these LSAs using OSPF, ASBR2 checks the DN-bit in the LSAs.
When detecting that the DN-bit in the LSAs is 1, ASBR2 ignores these LSAs.
Because ASBR2 cannot learn OSPF routes sent from ASBR1, CE1 cannot
communicate with CE3.
The following methods are provided to solve this problem:
● Method 1: Disable devices from setting the DN bit to 1 when importing BGP
routes into OSPF. For example, ASBR1 is disabled from setting the DN-bit to 1
when importing BGP routes into OSPF. When ASBR2 receives these routes and
detects that the DN-bit in the LSAs carrying these routes is 0, ASBR2 uses
these LSAs to calculate routes.
● Method 2: Disable devices from checking the DN-bit in received LSAs. For
example, ASBR2 is disabled from checking the DN-bit in received LSAs. ASBR1
sets the DN-bit to 1 in LSAs when importing MP-BGP routes into OSPF.
ASBR2, however, does not check the DN-bit when receiving these LSAs and
uses these LSAs to calculate routes.
The two methods can be used more flexibly based on specific types of LSAs. For
Type 3 LSAs, you can configure a sender to determine whether to set the DN bit to
1 or configure a receiver to determine whether to check the DN bit in the Type 3
LSAs based on the router ID of the device that generates the LSAs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 217
In an inter-AS VPN Option A scenario as shown in Figure 5-41, four ASBRs are
fully meshed and run OSPF. ASBR2 may receive Type 3, Type 5, or Type 7 LSAs
generated on ASBR4. If ASBR2 is disabled from checking the DN-bit in the LSAs,
ASBR2 will accept the Type 3 LSAs, and routing loops will occur. ASBR2 will deny
the Type 5 or Type 7 LSAs because the VPN route tags carried in the LSAs are the
same as the default VPN route tag of the OSPF process on ASBR2.
To address the routing loops caused by Type 3 LSAs, you can disable the check of
the DN-bit only for the Type 3 LSAs that are generated by devices with the router
ID 10.1.1.1 or 10.3.3.3. With the check disabled in such a way, if ASBR2 receives
Type 3 LSAs sent by ASBR4 with the router ID 10.4.4.4, ASBR2 will check the DN-
bit and deny these Type 3 LSAs because the DN-bit is set to 1.
Figure 5-41 Networking diagram of fully meshed ASBRs in the inter-AS VPN
Option A scenario
Multi-VPN-Instance CE
OSPF multi-instance generally runs on PEs. Multi-VPN-Instance CEs (MCEs) are
devices that run OSPF multi-instance within user LANs.
Compared with OSPF multi-instance running on PEs, MCEs have the following
characteristics:
● Support of OSPF-BGP synchronization is not required.
● A separate OSPF instance is created for each service. That is, different virtual
CEs transmit traffic for different services. This is a low-cost solution for LAN
security issues.
● Different OSPF multi-instances are implemented on a CE. To implement OSPF
multi-instances, routing loop detection needs to be disabled and route
calculation is performed directly. That is, MCEs also use the received LSAs with
the DN bit set to 1 for route calculations.
5.2.2.2 OSPF TE
Traffic engineering (TE) requires knowledge of the network topology and network
constraints, including the bandwidth, traffic engineering metrics, administrative
groups, and affinity attributes. By itself, OSPF cannot meet these requirements and
needs to be extended by introducing a new type of LSAs to advertise network
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 218
constraints. Then, the Constrained Shortest Path First (CSPF) algorithm can
calculate the path that satisfies defined constraints.
OSPF TE is designed to support MPLS TE and the establishment and maintenance
of the Label Switch Path (LSP). In MPLS TE architecture, OSPF is responsible for
collecting and advertising MPLS TE information.
Figure 5-42 OSPF functions in MPLS TE architecture
OSPF Functions in MPLS TE Architecture
In MPLS TE architecture, OSPF advertises information by collecting and then
flooding traffic engineering information to devices in the same area.
Collected information forms the traffic engineering database (TEDB) and is
utilized by the CSPF to calculate routes.
OSPF does not consider what the specific information is or how MPLS uses the
information.
TE-LSA
OSPF uses Type 10 Opaque LSAs to collect and advertise traffic engineering
information. Type 10 LSAs contain link state information required by traffic
engineering, including:
● Maximum link bandwidth
● Maximum reservable bandwidth
● Current reserved bandwidth
● Link color
Type 10 Opaque LSAs use OSPF flooding to synchronize link state information
among devices in an area. This forms a uniform TEDB for route calculation.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 219
Interaction Between OSPF TE and CSPF
OSPF uses Type 10 LSAs to collect traffic engineering information, including the
bandwidth, priority, and link metric. OSPF then processes and provides the
information for CSPF to calculate routes.
IGP Shortcut and Forwarding Adjacency
OSPF supports IGP shortcuts and forwarding adjacencies. These two features
enable OSPF packets to reach a destination through a tunnel interface as the
outbound interface. The differences between the two features are as follows:
Devices with IGP shortcuts enabled use a tunnel interface as an outbound
interface without advertising the tunnel interface link to neighbors. This prevents
other devices from using this tunnel. IGP shortcuts are unidirectional and need to
be configured only on devices that need to use IGP shortcuts.
Devices with forwarding adjacencies enabled use a tunnel interface as an
outbound interface while advertising the tunnel interface link to neighbors. This
allows other devices to use this tunnel.
OSPF DS-TE
DiffServ Aware Traffic Engineering (DS-TE) combines the advantages of MPLS TE
and Differentiated Services (DiffServ), and therefore it controls and forwards data
differently based on Class of Service (CoS) while precisely controlling data paths.
That is, DS-TE allows for efficient use of network resources while reserving
required resources for different services.
To support DE-TE in MPLS, OSPF TE-LSAs contain local overbooking multiplier
TLVs and bandwidth constraint (BC) TLVs. These TLVs are used to collect and
advertise the information about the reservable bandwidth of each class type (CT)
with a specific priority on the link. A class type refers to the bandwidth set of an
LSP or a group of LSPs sharing the same CoS.
OSPF SRLG
OSPF supports Shared Risk Link Group (SRLG) applications in MPLS by obtaining
information about the SRLG that floods traffic engineering information to devices
in an area.
5.2.2.3 OSPF Security
OSPF GTSM
The Generalized TTL Security Mechanism (GTSM) protects services over the IP
layer against attacks by checking whether the value of the time to live (TTL) in an
IP packet header is within a predefined range. An attacker may simulate real
unicast OSPF packets and continuously send the packets to a router. When the
router finds that these packets are destined for itself, it directly sends the packets
to the control plane for processing without checking the validity of these packets.
As a result, the router will remain busy processing these packets, leading to a high
CPU usage.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 220
GTSM protects a device's TCP/IP-based control plane from certain attacks that
consume CPU resources, for example, the CPU overload attack.
Devices with GTSM enabled check the TTL values in all received packets according
to configured policies. An action is then performed on the packets that do not
match the criteria specified in the policies. (For example, the packets may be
discarded).
A GTSM policy includes:
● Source address of an IP packet sent to the device
● VPN instance to which a packet belongs
● Protocol number of an IP packet (89 for OSPF and 6 for BGP)
● Source interface number and destination interface number of a protocol
above TCP/UDP
● Valid TTL range
GTSM can be implemented for different connections:
● For directly connected neighbors, the TTL of unicast protocol packets is set to
255.
● For multi-hop neighbors, an appropriate TTL range is defined.
The applicability of GTSM is as follows:
● GTSM is applicable to unicast packets instead of multicast packets. The TTL of
multicast packets cannot exceed 255, and therefore GTSM is not required for
multicast packets.
● GTSM does not apply to devices that use a tunnel to communicate with each
other.
OSPF Packet Authentication
On networks requiring high security, OSPF packet authentication can be
configured on routers to improve OSPF network security. During OSPF packet
authentication, routers must use the same authentication mode and can establish
a neighbor relationship to exchange routing information only after they pass the
authentication.
OSPF supports two authentication methods:
● Simple password authentication: uses a password in either plaintext or
ciphertext for authentication.
● Message digest authentication: uses Message Digest5 (MD5), Hash Message
Authentication Code (HMAC) MD5, or HMAC-Secure Hash Algorithm (SHA)
256 for authentication.
Packet Authentication can be configured for all networks in an area or for
individual interfaces in the area. Interface authentication configuration overrides
area authentication.
5.2.2.4 OSPF GR
The control plane and forwarding plane are generally separated on switches.
When the network topology remains stable, a restart of the control plane does not
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 221
affect the forwarding plane, which means that the forwarding plane can continue
to forward data. This separation ensures non-stop service forwarding.
In graceful restart (GR) mode, the forwarding plane continues to direct data
forwarding when a device restart occurs, without being affected by the actions on
the control plane, such as re-establishment of neighbor relationships and route
calculation. In this way, service interruption caused by route flapping is prevented
and the network reliability is improved.
Basic Concepts of OSPF GR
Graceful Restart (GR), also called non-stop forwarding (NSF), is used to ensure
normal traffic forwarding and proper running of key services during a routing
protocol restart.
Unless otherwise stated, GR described in this section refers to the GR technology
defined in RFC 3623.
GR is a fault-tolerant redundancy technology, one of high availability (HA)
technologies that include link protection, faulty node recovery, and traffic
engineering, and is used to ensure non-stop forwarding of key services during
active/standby switchovers and system upgrades.
The following concepts are involved in GR:
● Grace-LSA
OSPF supports GR by flooding Grace-LSAs. Grace-LSAs are used to inform
neighbors of the GR time, cause, and interface address when the GR starts
and ends.
● Role of a switch during GR
– Restarter: is the switch that restarts. The Restarter can be configured to
support full GR or partial GR.
– Helper: is the switch that helps the Restarter. The Helper can be
configured to:
▪ Selectively support GR based on policies.
▪ Support planned GR.
▪ Support unplanned GR.
● GR causes
– Unknown: indicates that GR is triggered by unknown events.
– Software restart: indicates that GR is triggered by commands.
– Software reload/upgrade: indicates that GR is triggered by a software
restart or upgrade.
– Switch to redundant control processor: indicates that GR is triggered by
an abnormal active/standby switchover.
● GR period
The GR period cannot exceed 1800 seconds. OSPF switches can exit GR before
GR timeout regardless of successful or failed GR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 222
Classification of OSPF GR
● Full GR: When a neighbor of a switch does not support GR, the switch exits
GR.
● Partial GR: When a neighbor of a switch does not support GR, only the
interface associated with this neighbor exits GR, whereas the other interfaces
perform GR normally.
● Planned GR: Commands are manually configured to restart a switch or
perform an active/standby switchover for the switch. The Restarter sends a
Grace-LSA before the restart or switchover.
● Unplanned GR: A switch performs an active/standby switchover without
sending a Grace-LSA and then enters GR after the standby board goes Up.
The process of unplanned GR after the standby board goes Up is the same as
that of planned GR.
GR Process
Figure 5-43 shows an OSPF GR process.
Figure 5-43 OSPF GR process
An OSPF GR process includes the following phases:
1. The Restarter (SwitchA) enters the GR state.
a. The Restarter performs an active/standby switchover.
NOTE
In planned GR mode, the Restarter sends a Grace-LSA to notify the Helper of the
GR start, period, and cause before performing the switchover. In unplanned GR
mode, the Restarter does not send any Grace-LSA.
b. Before the Restarter enters the GR state, it sends a Grace-LSA to maintain
OSPF neighbor relationships.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 223
c. When the standby board goes Up, the Restarter immediately sends a
Grace-LSA to notify the Helper (SwitchB) of the GR start, period, and
cause. Then, the Restarter sends five consecutive Grace-LSAs to the
Helper to ensure that the Helper can receive a Grace-LSA.
NOTE
Sending five consecutive Grace-LSAs is proposed by vendors and has not been
defined by OSPF.
During the GR, the Helper retains the neighbor relationship with the Restarter
so that other switches do not detect the active/standby switchover performed
by the Restarter.
2. The Restarter stays in the GR state.
a. The Restarter and Helper establish an OSPF adjacency.
b. The Helper checks the Restarter status. If the Restarter status is Down,
the Helper considers that the Restarter can restore services within a
specified GR period. Before the specified GR period expires, the Helper
does not terminate sessions or delete the topology or routing information
obtained from the Restarter.
c. When the Restarter recovers, it sends a packet to the Helper. After the
Restarter receives a response, it reestablishes the neighbor relationship
list.
d. The Restarter establishes a session with the Helper to obtain topology or
routing information and uses the information to calculate its own routing
table.
An active/standby switchover or restart of the Restarter can be manually
performed or automatically triggered by faults. During the switchover or
restart, the Restarter does not delete the routing information from its routing
table or FIB or reset its interface boards. Therefore, the service continuity can
be implemented.
3. The Restarter exits the GR state.
– If the GR is successful, the Restarter reestablishes the neighbor
relationship with the Helper before the GR period expires. After the
Helper receives a Grace-LSA with an aging time of 3600 seconds from the
Restarter, the status of the neighbor relationship between the Helper and
Restarter changes to Full.
– If the GR fails, packet reception and status change on the Restarter and
Helper are as follows:
On the Restarter:
▪ The Restarter times out the GR and fails to completely recover the
neighbor relationships.
▪ The Restarter fails to perform the bidirectional check due to Type 1
or Type 2 LSAs sent by the Helper.
▪ The interface status of the Restarter changes.
▪ The Restarter receives 1-way Hello packets from the Helper.
▪ The Restarter receives a Grace-LSA generated by another switch on
the same network segment.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 224
NOTE
Only one switch can perform GR on the same network segment at the same
time.
▪ Different DRs or BDRs are elected among the Restarter and
neighbors on the same network segment due to topology changes.
On the Helper:
▪ The Helper fails to receive a Grace-LSA from the Restarter before the
neighbor relationship expires.
▪ The interface status of the Helper changes.
▪ The Helper receives LSAs different from those in its own LSDB from
other switches. You can configure the Helper not to perform a strict
LSA check to avoid this issue.
▪ The Helper receives Grace-LSAs from two switches on the same
network segment at the same time.
▪ The neighbor relationships between the Helper and other switches
change.
Comparison Between GR Mode and Non-GR Mode
Table 5-12 Comparison of an active/standby switchover in GR mode and non-GR
mode
Switchover in Non-GR Mode Switchover in GR Mode
● OSPF neighbor relationships are
re-established.
● Routes are recalculated.
● The forwarding table changes.
● The entire network detects the
route changes, and routes flap for
a short period of time.
● Packets are lost during
forwarding, and services are
interrupted.
● OSPF neighbor relationships are re-
established.
● Routes are recalculated.
● The forwarding table remains
unchanged.
● Except for neighbors of the device on
which an active/standby switchover
occurs, other switches do not detect
route changes.
● No packets are lost during
forwarding, and services are not
affected.
5.2.2.5 OSPF Neighbor Relationship Flapping Suppression
OSPF neighbor relationship flapping suppression works by delaying OSPF neighbor
relationship reestablishment or setting the link cost to the maximum value
(65535).
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 225
Background
If the status of an interface carrying OSPF services alternates between Up and
Down, OSPF neighbor relationship flapping occurs on the interface. During the
flapping, OSPF frequently sends Hello packets to reestablish the neighbor
relationship, synchronizes LSDBs, and recalculates routes. In this process, a large
number of packets are exchanged, adversely affecting the stability of the existing
neighbor relationships, OSPF services, and other OSPF-dependent services, such as
LDP and BGP. Suppression of OSPF neighbor relationship flapping can address this
problem by delaying OSPF neighbor relationship reestablishment or preventing
service traffic from passing through flapping links.
Related Concepts
Flapping_event: A flapping_event occurs when the status of a neighbor
relationship on an interface last changes from Full to a non-Full state. A
flapping_event triggers flapping detection.
Flapping_count: This parameter indicates the number of times flapping has
occurred.
Detect-interval: This parameter indicates the flapping detection interval. The
interval is used to determine whether to trigger a valid flapping_event.
Threshold: This parameter indicates the flapping suppression threshold. When the
flapping_count reaches or exceeds the threshold, flapping suppression takes effect.
Resume-interval: This parameter indicates the resumption interval. If the time
between two valid flapping_events is longer than the resume-interval, flapping
suppression exits.
Implementation
Flapping detection
A flapping counter is started on OSPF interfaces. Each time two consecutive
flapping_events occur within a detect-interval, a valid flapping_event is recorded
and the flapping_count increments by 1. When the flapping_count reaches or
exceeds the threshold, the system determines that flapping occurs, triggers
flapping suppression accordingly, and sets the flapping_count to 0. If two
consecutive valid flapping_events occur within a period longer than the resume-
interval before the flapping_count reaches the threshold again, the system also
sets the flapping_count to 0. Interfaces start the suppression timer when the
neighbor status last changes to ExStart or Down.
The detect-interval, threshold, and resume-interval are configurable.
Flapping suppression
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes,
interfaces prevent neighbor relationships from being reestablished within the
suppression period, which minimizes LSDB synchronization attempts and
packet exchanges.
● Hold-max-cost mode: In the case where the traffic forwarding path changes
frequently, interfaces use 65535 as the cost of the flapping link within the
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 226
suppression period, which prevents traffic from passing through the flapping
link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode after the Hold-down mode exits.
By default, the Hold-max-cost mode takes effect. The suppression mode and
period can be changed manually using command lines.
NOTE
When an interface enters the flapping suppression state, all neighbors of the interface enter
the state accordingly.
Exiting flapping suppression
Interfaces exit flapping suppression in the following scenarios:
● The suppression timer expires.
● The corresponding OSPF process is reset.
● Command lines are configured to force interfaces to exit flapping suppression.
Typical Scenarios
Basic scenario
In Figure 5-44, the traffic forwarding path is Switch A -> Switch B -> Switch C ->
Switch E before a link failure occurs. After the link between Switch B and Switch C
fails, the forwarding path switches to Switch A -> Switch B -> Switch D -> Switch
E. At the early stage of the path switchover, there is a high probability that the
status of the neighbor relationship between Switch B and Switch C flaps
frequently, leading to frequent switchovers of forwarding paths. Each switchover
triggered by faults causes traffic loss. The network stability is affected. In this
scenario, if the devices are configured with flapping suppression, flapping
suppression takes effect when the suppression conditions are met.
● If flapping suppression works in Hold-down mode, the neighbor relationship
between Switch B and Switch C is prevented from being reestablished within
the suppression period so that the traffic is forwarded along the path Switch
A -> Switch B -> Switch D -> Switch E.
● If flapping suppression works in Hold-max-cost mode, 65535 is used as the
cost of the link between Switch B and Switch C within the suppression period
so that the traffic is forwarded along the path Switch A -> Switch B -> Switch
D -> Switch E.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 227
Figure 5-44 Flapping suppression in a basic scenario
Single-forwarding path scenario
If only one forwarding path exists on the network, the neighbor relationship
flapping between any two devices on the path will interrupt traffic forwarding. In
Figure 5-45, the only traffic forwarding path is Switch A -> Switch B -> Switch C -
> Switch E. If the neighbor relationship between Switch B and Switch C flaps and
the flapping meets the suppression conditions, flapping suppression takes effect.
However, if the neighbor relationship between Switch B and Switch C is prevented
from being reestablished, the whole network will be divided. Therefore, the Hold-
max-cost mode (rather than the Hold-down mode) is recommended. If flapping
suppression works in Hold-max-cost mode, 65535 is used as the cost of the link
between Switch B and Switch C within the suppression period. After the network
stabilizes and the suppression timer expires, the link is restored.
NOTE
By default, the Hold-max-cost mode takes effect.
Figure 5-45 Flapping suppression in a single-forwarding path scenario
Broadcast scenario
In Figure 5-46, four devices are deployed on the same broadcast network using
switches, and the devices are broadcast network neighbors. If Switch C flaps due
to a link failure and Switch A and Switch B were deployed at different time
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 228
(Switch A was deployed earlier for example) or the flapping suppression
parameters on Switch A are different from those on Switch B, Switch A first
detects the flapping and suppresses Switch C. Consequently, the Hello packets sent
by Switch A do not carry the Switch ID of Switch C. However, Switch B has not
detected the flapping yet and still considers Switch C as a valid node. As a result,
the DR candidates identified by Switch A are Switch B and Switch D, whereas the
DR candidates identified by Switch B are Switch A, Switch C, and Switch D.
Different DR candidates result in a different DR election result, which may lead to
route calculation errors. To prevent this problem in scenarios where an interface
has multiple neighbors, such as on a broadcast, P2MP, or NBMA network, all
neighbors on the interface are suppressed when the status of a neighbor
relationship last changes to ExStart or Down. Specifically, if Switch C flaps, Switch
A, Switch B, and Switch D on the same broadcast network as Switch C are all
suppressed. After the network stabilizes and the suppression timer expires, Switch
A, Switch B, and Switch D are restored to normal status.
Figure 5-46 Flapping suppression on a broadcast network
Multi-area scenario
In Figure 5-47, Switch A, Switch B, Switch C, Switch E, and Switch F are connected
in area 1, and Switch B, Switch D, and Switch E are connected in backbone area 0.
Traffic from Switch A to Switch F is preferentially forwarded along intra-area
routes, and therefore the forwarding path is Switch A -> Switch B -> Switch C ->
Switch E -> Switch F. When the neighbor relationship between Switch B and
Switch C flaps and the flapping meets suppression conditions, flapping suppression
takes effect in the default mode of Hold-max-cost. Consequently, 65535 is used as
the cost of the link between Switch B and Switch C. However, the forwarding path
remains unchanged because intra-area routes take precedence over inter-area
routes during route selection according to OSPF route selection rules. Therefore,
the Hold-down mode must be used in this scenario to prevent the neighbor
relationship between Switch B and Switch C from being reestablished within the
suppression period. During this period, traffic is forwarded along the path Switch A
-> Switch B -> Switch D -> Switch E -> Switch F.
NOTE
By default, the Hold-max-cost mode takes effect. You can manually configure command
lines to change the mode to Hold-down.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 229
Figure 5-47 Flapping suppression in a multi-area scenario
Scenario with both LDP-IGP synchronization and OSPF neighbor relationship
flapping suppression configured
In Figure 5-48, if the link between PE1 and P1 fails, an LDP LSP switchover is
implemented immediately, causing the original LDP LSP to be deleted before a
new LDP LSP is established. To prevent traffic loss, LDP-IGP synchronization needs
to be configured. With LDP-IGP synchronization configured, 65535 is used as the
cost of the new LSP to be established. After the new LSP is established, the
original cost takes effect. Then, the original LSP is deleted, and LDP traffic is
forwarded along the new LSP.
Both LDP-IGP synchronization and OSPF neighbor relationship flapping
suppression work in either Hold-down or Hold-max-cost mode. If both functions
are configured, the Hold-down mode takes precedence over the Hold-max-cost
mode, followed by the configured link cost. Table 5-13 lists the suppression modes
that take effect in different situations.
Table 5-13 Principles for selecting suppression modes in different situations
LDP-IGP
Synchronization/
OSPF Neighbor
Relationship
Flapping
Suppression
Mode
Hold-down Mode
of LDP-IGP
Synchronization
Hold-max-cost
Mode of LDP-IGP
Synchronization
Exiting LDP-IGP
Synchronization
Suppression
Hold-down mode
of OSPF neighbor
relationship
flapping
suppression
Hold-down Hold-down Hold-down
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 230
LDP-IGP
Synchronization/
OSPF Neighbor
Relationship
Flapping
Suppression
Mode
Hold-down Mode
of LDP-IGP
Synchronization
Hold-max-cost
Mode of LDP-IGP
Synchronization
Exiting LDP-IGP
Synchronization
Suppression
Hold-max-cost
mode of OSPF
neighbor
relationship
flapping
suppression
Hold-down Hold-max-cost Hold-max-cost
Exiting OSPF
Neighbor
Relationship
Flapping
Suppression
Hold-down Hold-max-cost Exiting LDP-IGP
synchronization
and OSPF
neighbor
relationship
flapping
suppression
For example, the link between PE1 and P1 frequently flaps, as shown in Figure
5-48, and both LDP-IGP synchronization and OSPF neighbor relationship flapping
suppression are configured. In this case, the suppression mode is selected based on
the above principles. No matter which mode (Hold-down or Hold-max-cost) is
selected, the forwarding path is switched to PE1 -> P4 -> P3 -> PE2.
Figure 5-48 Scenario with both LDP-IGP synchronization and OSPF neighbor
relationship flapping suppression configured
Scenario with both bit-error-triggered protection switching and OSPF
neighbor relationship flapping suppression configured
If a link has a poor link quality, services transmitted along it may be adversely
affected. If bit-error-triggered protection switching is configured and the bit error
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 231
rate (BER) along a link exceeds a specified value, a bit error event is reported, and
65535 is used as the cost of the link, triggering route reselection. Consequently,
service traffic is switched to the backup link. If both bit-error-triggered protection
switching and OSPF neighbor relationship flapping suppression are configured,
they both take effect. The Hold-down mode takes precedence over the Hold-max-
cost mode, followed by the configured link cost.
5.2.2.6 OSPF Smart-Discover
Definition
Routers periodically send Hello packets through OSPF interfaces at the Hello
interval specified in the Hello timer. This fixed interval slows down the
establishment of OSPF neighbor relationships.
Enabling smart-discover can speed up establishment of OSPF neighbor
relationships in certain scenarios.
Table 5-14 OSPF smart-discover
Scenario Processing
Smart-discover is not
configured.
● Hello packets are sent only when the Hello
timer expires.
● Devices wait to receive Hello packets within
the Hello interval to establish neighbor
relationships.
Smart-discover is configured. ● Hello packets are sent directly regardless of
whether the Hello timer has expired.
● Devices receive packets without delay and
can immediately transmit their status to
establish neighbor relationships.
Principle
In the following scenarios, an interface with smart-discover enabled can send
Hello packets to target devices without waiting for the expiration of the Hello
timer:
● The neighbor status becomes 2-way for the first time.
● The neighbor status changes from 2-way or a higher state to Init.
5.2.2.7 OSPF Database Overflow
Definition
OSPF requires that routers in the same area have the same LSDB.
If the number of routes on a network increases, routers may fail to carry so much
routing information due to limited system resources. This is known as an OSPF
database overflow.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 232
Purpose
Configuring stub areas or NSSAs partially addresses database overflows. However,
stub areas or NSSAs fail to resolve the problem of an unexpected increase in
dynamic routes. To dynamically limit the LSDB capacity and thereby prevent
database overflows, you can set the maximum number of external LSAs allowed in
the LSDB.
Implementation
Setting the maximum number of non-default external routes on a router can
prevent database overflows.
All routers on an OSPF network must be configured with the same upper limit. If
the number of external routes on a router reaches the upper limit, the router
enters the overflow state and starts an overflow timer. The router automatically
exits the overflow state after the timer expires. By default, the timer value is 5
seconds.
Table 5-15 OSPF database overflow phases
Overflow Phase OSPF Processing
Entering the overflow
state
A router deletes all non-default external routes
generated by itself.
Staying in the overflow
state
● The router does not generate non-default
external routes.
● The router discards the newly received non-
default external routes, and does not reply with
LSAck packets.
● When the overflow timer expires, the router
checks whether the number of external routes
still exceeds the upper limit and performs the
following operations accordingly:
– If the number of external routes still exceeds
the upper limit, the router restarts the timer.
– If the number of external routes is less than
the upper limit, the router exits the overflow
state.
Exiting the overflow state ● The router resets the overflow timer.
● The router generates non-default routes.
● The router learns the newly received non-default
external routes, and replies with LSAck packets.
● The router prepares to enter the overflow state
in case of future occurrences.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 233
5.2.2.8 OSPF Mesh-Group
Definition
In scenarios with multiple concurrent links, you can deploy OSPF mesh-group to
classify links into a mesh group. This allows OSPF to flood LSAs to only one link
selected from the mesh group. OSPF mesh-group prevents repetitive flooding that
burdens the system.
The mesh-group feature is disabled by default.
Purpose
After receiving or generating an LSA, an OSPF process floods the LSA. If there are
multiple concurrent links, OSPF floods the LSA to each link and sends Update
messages. Flooding more than one LSA is unnecessary as only one is valid.
To prevent this unnecessary burden on the system, you can enable mesh-group to
classify multiple concurrent links between a router and its neighbor into a group
and then select a primary link for flooding.
Implementation
As shown in Figure 5-49, Router A and Router B are connected through three links
and establish an OSPF neighbor relationship. After receiving a new LSA from
interface 4, Router A floods the LSA to Router B through interfaces 1, 2, and 3.
This flooding causes an unnecessary load on the concurrent links.
Figure 5-49 LSA flooding with OSPF mesh-group disabled
If there are multiple concurrent links between a device with OSPF mesh-group
enabled and its neighbor, the device floods received LSAs only to the primary link,
as shown in Figure 5-50.
Figure 5-50 LSA flooding with OSPF mesh-group enabled
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 234
As defined in OSPF, LSAs can be flooded to a link only when the neighbor status
reaches Exchange or a higher state. When the status of the interface on the
primary link is lower than Exchange, OSPF reselects a primary link from
concurrent links for flooding LSAs. After receiving LSAs flooded by Router A
through link 1, Router B no longer floods the LSAs to Router A through link 2 and
link 3.
The Router ID of a neighbor uniquely identifies a mesh group. Interfaces
connected to the same neighbor with status higher than Exchange belong to the
same mesh group.
In Figure 5-51, a mesh group of Router A resides in Area 0, which contains the
links of interface 1 and interface 2. More than one neighbor of interface 3 resides
on the broadcast link. Therefore, interface 3 cannot be added to the mesh group.
Figure 5-51 Scenario where an interface cannot be added to a mesh group
NOTE
If a router with OSPF mesh-group enabled has the same router ID as its directly connected
neighbor, LSDBs cannot be synchronized and routes cannot be calculated correctly. In such
a scenario, you need to reconfigure the router ID of the neighbor. (The configuration with
the same router ID for two different devices is a configuration error.)
5.2.3 Association Between OSPF and Other Protocols
BFD for OSPF
Bidirectional Forwarding Detection (BFD) is a mechanism for detecting
communication faults between forwarding engines.
BFD detects the connectivity of a data protocol along a path between two
systems. Such a path can be a physical link, a logical link, or a tunnel.
BFD for OSPF allows BFD sessions to be associated with OSPF. If a BFD session
detects a link fault, it notifies OSPF of the fault, allowing OSPF to quickly respond
to the change in the network topology.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 235
Devices recalculate routes in the event of a link fault or a topology change.
Network performance is improved if the route convergence process of routing
protocols is completed faster.
As link faults are inevitable, rapidly detecting these faults and notifying routing
protocols is an effective way to quickly resolve such issues. BFD for OSPF speeds
up OSPF convergence if a fault occurs on the link between neighbors.
Table 5-16 Comparison before and after BFD for OSPF is enabled
BFD
Association
Link Fault Detection Condition Convergence
Speed
Disabled The OSPF dead timer expires. (The
default timeout interval is 40 seconds.)
Measured in
seconds
Enabled A BFD session goes Down. Measured in
milliseconds
Figure 5-52 shows the process of BFD for OSPF.
Figure 5-52 BFD for OSPF
1. OSPF neighbor relationships are established between SwitchA, SwitchB, and
SwitchC.
2. When the neighbor relationships enter the Full state, BFD is instructed to set
up a BFD session.
3. The outbound interface of the route from SwitchA to SwitchB is GE0/0/2. If
the link between SwitchA and SwitchB fails, BFD detects the fault and then
notifies SwitchA of the fault.
4. SwitchA processes the neighbor Down event, and recalculates routes.
Following recalculation, the outbound interface of the route from SwitchA to
SwitchB becomes GE0/0/1, with the route to SwitchB traversing SwitchC.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 236
OSPF-BGP Association
A device restart, or even a new device itself, may cause the loss of network traffic
during BGP route convergence. This happens because OSPF converges faster than
BGP.
The solution to this problem is association between OSPF and BGP.
If there is a backup link, BGP traffic is lost during traffic switchback because BGP
route convergence is slower than OSPF route convergence.
In Figure 5-53, SwitchA, SwitchB, SwitchC, and SwitchD are running OSPF and
have established IBGP connections. SwitchC functions as the backup of SwitchB.
When the network is stable, BGP and OSPF routes converge completely on the
devices.
Traffic from SwitchA to 10.3.1.0/30 normally passes through SwitchB. If SwitchB
becomes faulty, traffic is switched to SwitchC. After SwitchB recovers, traffic is
switched back to SwitchB.
During the switchback process, some packets are lost because OSPF route
convergence is faster than BGP route convergence. This means that the
convergence of OSPF routes is already complete while BGP routes are still
converging. As a result, SwitchB fails to learn the route to 10.3.1.0/30.
In this case, upon receipt of packets from SwitchA to 10.3.1.0/30, SwitchB discards
these packets.
Figure 5-53 OSPF-BGP association
A device with OSPF-BGP association enabled remains as a stub router in the
configured association period. The link metric in the LSAs advertised by the device
is set to the maximum value of 65535. In this way, the device instructs other OSPF
devices not to use it for data forwarding.
In Figure 5-53, OSPF-BGP association is enabled on SwitchB. SwitchA forwards
traffic to the backup device SwitchC before BGP route convergence on SwitchB is
complete.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 237
OSPF-LDP Association
On networks that use primary and backup links, OSPF-LDP association ensures
that, when a faulty primary link recovers, traffic interruptions are minimized.
As shown in Figure 5-54, the primary link travels along the path
PE1→P1→P2→P3→PE2, and the backup link travels along the path
PE1→P1→P4→P3→PE2.
If the primary link is faulty, traffic is switched to the backup link. When the
primary link recovers, traffic is switched back to the primary link, during which
traffic is interrupted for an extended period of time.
Figure 5-54 OSPF-LDP association
Synchronizing LDP and OSPF (IGP) on P1 and P2 can shorten the duration of
traffic interruption caused by traffic switchback to the primary link from seconds
to milliseconds.
Table 5-17 OSPF-LDP association
OSPF-LDP Association Traffic Interruption Time
Disabled Measured in seconds
Enabled Measured in milliseconds
OSPF-LDP association delays route switchback by suppressing the establishment
of OSPF neighbor relationships until LDP convergence is complete. Before an LSP
is established on the primary link, the backup link continues to forward traffic. The
backup link is then deleted following the LSP establishment on the primary link.
OSPF-LDP association involves three timers:
● Hold-down
● Hold-max-cost
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 238
● Delay
When the primary link recovers, a router responds as follows:
1. Starts the Hold-down timer. The OSPF interface does not establish OSPF
neighbor relationships but waits for the establishment of an LDP session. The
hold-down timer specifies the period that the OSPF interface waits.
2. Starts the Hold-max-cost timer after the Hold-down timer expires. The Hold-
max-cost timer specifies the interval for advertising the maximum link metric
of the interface in LSAs to the primary link.
3. Starts the Delay timer to wait for the establishment of an LSP after an LDP
session is re-established on the primary link.
4. Enables LDP to notify OSPF that synchronization is complete regardless of the
OSPF status after the Delay timer expires.
5.3 Application Scenarios for OSPF
5.3.1 OSPF GR
In Figure 5-55, RouterA, RouterB, RouterC, and RouterD run OSPF for
interworking, and RouterA and RouterB have GR enabled. When RouterA restarts,
RouterB helps RouterA perform GR, without notifying other neighbors of RouterA.
OSPF GR ensures service continuity.
Figure 5-55 OSPF GR
5.3.2 OSPF GTSM
In Figure 5-56, OSPF runs between routers, and GTSM is enabled on RouterC. The
valid TTL ranges of the packets sent from routers to RouterC are as follows:
● For RouterA and RouterE (which are neighbors of RouterC): (255 – hops + 1)
to 255.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 239
● For RouterB, RouterD, and RouterF: 254 to 255, 253 to 255, and 252 to 255,
respectively.
Figure 5-56 OSPF GTSM
5.4 OSPF Deployment Guide
5.4.1 OSPF Network Planning and Design
OSPF Network Stability: Router ID Design
Router ID selection is the first task in OSPF network design and implementation.
As a link-state routing protocol, OSPF calculates routes based on LSAs. All OSPF
routers on an OSPF network send and flood LSAs to the entire network. In this
way, each OSPF router on the network collects LSAs received from other routers,
saves the LSAs in its LSDB, and uses an SPF algorithm to calculate an SPT to other
networks with itself as the root. Therefore, ensuring the stability of the LSDB on
each OSPF router is a prerequisite for ensuring the stability of the OSPF network.
In an LSDB, LSAs received from different OSPF routers are distinguished by router
ID. If the router ID of a router changes, the router floods its LSAs again. As a
result, all the other OSPF routers on the network update their LSDBs and perform
SPF calculation again, leading to OSPF network flapping. Therefore, selecting
stable router IDs is the first task in OSPF network design.
Router IDs can be configured manually. If no router ID is specified for a router, the
system automatically selects an interface IP address as the router's router ID. The
router ID selection rules are as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 240
1. The router preferentially selects the largest IP address among loopback
interface addresses as the router ID.
2. If no loopback interface is configured, the router selects the largest IP address
among interface addresses as the router ID.
3. The router reselects a router ID only when the interface address used as the
router ID is deleted or changed.
On actual networks, it is recommended that router IDs of OSPF routers be
specified manually. First, plan a private network segment such as 192.168.1.0/24
for router ID selection. Before starting the OSPF process, create a loopback
interface on each OSPF router, and use a private IP address with a 32-bit mask as
the IP address of the loopback interface. The private IP address is then used as the
router's router ID. If there is no special requirement, the address of this loopback
interface does not need to be advertised to the OSPF network.
Hierarchical Network Design: OSPF Area Design
OSPF is a network protocol that requires hierarchical design. The concept of area
is used on an OSPF network. From a hierarchical perspective, areas on an OSPF
network are classified into backbone and non-backbone areas. The ID of the
backbone area is 0 and that of a non-backbone area is in the range 1 to
4294967295. An OSPF router on the border between the backbone area and a
non-backbone area is called ABR.
Actually, OSPF area design is the process of classifying OSPF routers on the
network. The first consideration in OSPF area design is the network scale. You can
only plan the backbone area for small networks such as a network with several
routers as the core and aggregation devices. However, hierarchical network design
is required on large OSPF networks.
For large OSPF networks, the core, aggregation, and access layers must be
planned in OSPF area design. In addition, OSPF backbone routers are generally
egress routers and core switches. These devices are typically high-end routing
devices such as Huawei NE series high-end routers and Huawei S series modular
switches. Non-backbone area design depends on the geographical locations and
device performance. If many low-end Layer 3 switching devices with product
positioning and performance limitations are deployed in a non-backbone area, the
number of routes should be minimized using small-sized areas or special areas.
The IDs of non-backbone areas on an actual network should not be planned
randomly. Consecutive IDs such as 1, 2, and 3 are not recommended. It is
recommended that IDs in ascending order such as 10, 20, and 30 be used,
facilitating area ID addition in future network capacity expansion.
Routing Entry Optimization for Non-Backbone Areas: Special Areas
Using special areas can optimize routing entries on routers in non-backbone areas.
Generally, the number of routing entries on routers in a non-backbone area needs
to be reduced in the following scenarios:
● The non-backbone area has only one ABR as the egress router and all traffic
for accessing external areas needs to pass through this egress router. In this
case, non-ABR routers in this non-backbone area do not need to obtain
detailed information about external areas, and only an egress is required to
send traffic outside this area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 241
● Low-end Layer 3 switches are deployed in the non-backbone area and their
routing tables cannot contain too many routing entries due to performance
limitations. Special areas can be configured to reduce the number of routing
entries on the devices.
Switches support four types of special areas defined in OSPF: stub area, totally
stub area, NSSA, and totally NSSA.
In most cases, routers in non-backbone areas on a typical OSPF network only need
to know the outbound interface of the default route. Therefore, it is recommended
that non-backbone areas be planned as totally NSSAs. This can significantly
reduce the number of routing entries on internal routers in the non-backbone
areas and the number of OSPF packets to be exchanged among these routers. For
some networks with special requirements, the four types of special areas can be
used flexibly based on actual requirements.
Routing Entry Optimization for the Backbone Area: IP Subnetting and Route
Summarization in Non-Backbone Areas
Because routers in the backbone area are responsible for route exchange among
areas, these routers have large routing tables. You can properly plan IP subnets for
non-backbone areas and summarize routes on the routers residing on area
borders to optimize routing entries on routers in the backbone area.
It is recommended that an IP network facilitating route summarization be used as
a new OSPF network, and that IP addresses be planned again for expanded OSPF
networks. Route summarization can reduce the number of routing entries in the
routing tables of routers in the backbone area and the number of OSPF packets to
be exchanged among these routers. After routes are summarized, a single-point
link failure or network flapping will not affect route update on the entire network.
Therefore, route summarization also improves the network stability.
Uplink Traffic Diversion: Default OSPF Route Import and Route Selection
Optimization
Most service traffic on a large OSPF network is not transmitted inside the
network, but is forwarded to the Internet egress. Therefore, default route design is
a key design point for an OSPF network.
An actual OSPF network may have more than one egress. Configuring multiple
links to load balance egress traffic is a difficult task in OSPF network design.
Although there are many load balancing methods, the most simple and secure
method is to use the internal route selection mechanism of OSPF. An OSPF router
determines whether a route is optimal by calculating its cost, and preferentially
adds a route with a smaller cost to its routing table. Therefore, you can adjust the
costs of OSPF interfaces to make a router select different outbound interfaces for
load balancing.
OSPFv2 was developed earlier and rapid bandwidth development was not
considered at that time. By default, the reference bandwidth for OSPF cost
calculation is 100 Mbit/s. Therefore, by default, OSPF considers that the cost of an
interface with bandwidth greater than 100 Mbit/s is 1. The reference bandwidth is
outdated because the network backbone bandwidth develops towards 10 Tbit/s.
Switches provide the function of changing the reference bandwidth. In OSPF
network construction, you can run the bandwidth-reference command to
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 242
configure a proper reference bandwidth. In summary, to optimize route selection
on an OSPF network, you are advised to select a proper reference bandwidth to
adjust the costs of OSPF interfaces.
Loop Prevention in Route Summarization Scenarios: Blackhole Route
Route summarization can reduce the number of routes and improve the network
stability in many scenarios. However, routing loops may occur in route
summarization. Blackhole routes can solve this problem. A router discards packets
that match a blackhole route, and does not send any error information to the
packet sender. Therefore, route summarization and blackhole routes are often
used together in OSPF network design.
OSPF Network Security: Silent Interface
Security must be the first consideration for large OSPF networks. In OSPF network
design, OSPF packets are often prohibited from being sent to users, preventing
end users from obtaining OSPF packet information. If a user can intercept OSPF
packets, the user will know how to connect to the OSPF network, making the
OSPF network prone to attacks or damages. For example, if the user connects a
router to the OSPF network and makes the router's OSPF process unstable, the
OSPF network will flap or even break down.
To ensure security and stability of an OSPF network, it is recommended that silent
interfaces be configured on edge devices of the OSPF network to prevent OSPF
packets from being sent to users. These silent interfaces are prohibited from
receiving and sending OSPF packets. These interfaces can still advertise direct
routes, but cannot establish neighbor relationships because Hello packets are
blocked on the interfaces.
5.4.2 OSPF Network Design Deployment Case
Figure 5-57 shows a typical campus network topology. This is a large campus
network with the core, aggregation, and access layers and multiple egresses to the
Internet. On this network, dual-link redundancy and cluster protection among core
and aggregation switches have been deployed. Typically, on such a large campus
network, Huawei NE series high-end routers are deployed as egress devices, and
Huawei campus cluster-supporting modular switches are deployed as core and
aggregation switches. User gateways are deployed on the aggregation layer, and
aggregation switches are the boundary between Layer 2 and Layer 3 networks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 243
Figure 5-57 Typical campus network topology
Core and aggregation switches on the typical campus network are deployed in
clusters, and one cluster functions as a single logical device. Multiple links are
bundled together to form a single logical link. The above network topology is
simplified into a logical topology, as shown in Figure 5-58. There may be multiple
buildings in a campus network, and the following example uses three buildings.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 244
Figure 5-58 Logical topology of a typical campus network
OSPF Network Stability: Router ID Design
The primary task of deploying OSPF is to design and deploy router IDs. In most
situations, an appropriate private IP address segment can be used to design router
IDs. This example uses IP addresses on the IP address segment 10.0.0.0/24 as
router IDs.
After router IDs are designed, you need to create loopback interfaces on each
OSPF device and configure an IP address 10.0.0.X/32 for each loopback interface.
The following configures router IDs for a core modular switch cluster:
[HUAWEI] interface LoopBack 0
[HUAWEI-LoopBack0] ip address 10.0.0.3 32 //Configure an IP address with a 32-bit mask for LoopBack0.
[HUAWEI-LoopBack0] quit
[HUAWEI] ospf 1 router-id 10.0.0.3 //Create OSPF process 1 and set the router ID to 10.0.0.3.
NOTE
If there are no special requirements, advertisement of the IP address of Loopback0 into
OSPF processes is not recommended because the advertisement is unnecessary.
Figure 5-59 shows the network topology with router IDs designed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 245
Figure 5-59 Network topology with router IDs designed
Hierarchical Network Design: OSPF Area Design
After router IDs are assigned to routers, you need to partition the OSPF network.
To obtain a hierarchical OSPF network, you can deploy egress routers and core
switches in Area 0 and design non-backbone areas based on geographical
locations. When designing area IDs for non-backbone areas, you need to ensure
that new areas are easy to add for network expansion. Based on geographical
locations involved in this case, egress routers and core switches are deployed in
the backbone area and the aggregation switches in each building are deployed in
a non-backbone area respectively. Figure 5-60 shows the OSPF network topology
after area partitioning.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 246
Figure 5-60 OSPF network topology after area partitioning
The following configures Area 0 and Area 10 for the core switch cluster:
[HUAWEI] ospf 1 //Enter the OSPF process view.
[HUAWEI-ospf-1] area 0 //Enter the view of Area 0.
[HUAWEI-ospf-1-area-0.0.0.0] network 10.200.10.0 0.0.0.3 //Advertise the network segment where the
uplink interface resides to Area 0.
[HUAWEI-ospf-1-area-0.0.0.0] network 10.200.20.0 0.0.0.3 //Advertise the network segment where the
uplink interface resides to Area 0.
[HUAWEI-ospf-1-area-0.0.0.0] quit
[HUAWEI-ospf-1] area 10 //Enter the view of Area 10.
[HUAWEI-ospf-1-area-0.0.0.10] network 10.100.10.0 0.0.0.3 //Advertise the network segment where the
downlink interface resides to Area 10.
[HUAWEI-ospf-1-area-0.0.0.10] quit
The preceding configuration commands show that an OSPF device is located on
the border between OSPF areas. The uplink and downlink interfaces of the core
switch cluster in the topology belong to Area 0 and Area 10 respectively. That is,
this cluster functions as an ABR.
NOTE
It is a bad design to deploy many low-end routers or Layer 3 switches in a single OSPF area,
and it is better to reduce the number of devices in a single OSPF area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 247
Routing Entry Optimization for Non-Backbone Areas: Special Areas
After the OSPF network is partitioned into multiple areas, you may find that the
routing table size of devices in non-backbone areas is large. If devices in non-
backbone areas have low performance and are expected not to maintain a large
routing table, you can use special areas to reduce the number of routing entries in
the table. Figure 5-61 shows the network topology with all non-backbone areas
configured as totally NSSAs.
Figure 5-61 Network topology with non-backbone areas configured as totally
NSSAs
The following provides an example of configuring totally NSSAs by configuring a
core switch cluster and an aggregation switch cluster in Area 10.
The configuration of the core switch cluster is as follows:
[HUAWEI] ospf 1 //Enter the OSPF process view.
[HUAWEI-ospf-1] area 10 //Enter the view of Area 10.
[HUAWEI-ospf-1-area-0.0.0.10] nssa no-summary //Configure nssa no-summary for the ABR.
[HUAWEI-ospf-1-area-0.0.0.10] quit
The configuration of the aggregation switch cluster is as follows:
[HUAWEI] ospf 1 //Enter the OSPF process view.
[HUAWEI-ospf-1] area 10 //Enter the view of Area 10.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 248
[HUAWEI-ospf-1-area-0.0.0.10] nssa //Configure nssa for the non-ABR.
[HUAWEI-ospf-1-area-0.0.0.10] quit
Before a totally NSSA is configured, routing entries from the aggregation switch
cluster to non-backbone areas are as follows:
<HUAWEI> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 21 Routes : 21
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.0.0.4/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.1.0/24 Direct 0 0 D 10.10.1.1 Vlanif100
10.10.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif100
10.10.2.0/24 Direct 0 0 D 10.10.2.1 Vlanif200
10.10.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif200
10.10.3.0/24 Direct 0 0 D 10.10.3.1 Vlanif300
10.10.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif300
10.20.1.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.20.2.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.20.3.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.30.1.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.30.2.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.30.3.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.100.10.0/30 Direct 0 0 D 10.100.10.2 Vlanif10
10.100.10.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.100.20.0/30 OSPF 10 2 D 10.100.10.1 Vlanif10
10.100.30.0/30 OSPF 10 2 D 10.100.10.1 Vlanif10
10.200.10.0/30 OSPF 10 2 D 10.100.10.1 Vlanif10
10.200.20.0/30 OSPF 10 2 D 10.100.10.1 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
After a totally NSSA is configured, routing entries from the aggregation switch
cluster to non-backbone areas are as follows:
<HUAWEI> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 12 Routes : 12
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 OSPF 10 2 D 10.100.10.1 Vlanif10
10.0.0.4/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.1.0/24 Direct 0 0 D 10.10.1.1 Vlanif100
10.10.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif100
10.10.2.0/24 Direct 0 0 D 10.10.2.1 Vlanif200
10.10.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif200
10.10.3.0/24 Direct 0 0 D 10.10.3.1 Vlanif300
10.10.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif300
10.100.10.0/30 Direct 0 0 D 10.100.10.2 Vlanif10
10.100.10.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
The preceding outputs show that the IP routing table size of Area 10 is reduced
significantly after a totally NSSA is configured. This indicates that configuring a
non-backbone area as a totally NSSA can reduce the routing table size.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 249
Routing Entry Optimization for the Backbone Area: IP Subnetting and Route
Summarization in Non-Backbone Areas
After non-backbone areas are configured as totally NSSAs, the routing table size
of routers in non-backbone areas are reduced significantly and the amount of
information to be exchanged between these routers is also reduced. Reduced
routing table size and information exchange are also required in the backbone
area. To implement this requirement, you need to use IP subnetting and perform
route summarization on ABRs in non-backbone areas.
Figure 5-62 shows summarized routes advertised from Area 10 to Area 0 after IP
subnetting is performed.
Figure 5-62 Using route summarization to optimize routing entries in the
backbone area
Route summarization will prevent specific routes from being advertised. The ABR
in Area 10 advertises only one summarized route 10.10.0.0/16 into Area 0,
reducing the routing entries on the backbone routers and number of OSPF packets
to be exchanged with Area 0 and ensuring the routing table stability. Proper IP
addressing facilitating route summarization is recommended during OSPF network
design.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 250
The following configures route summarization on the ABR (core switch cluster) in
Area 10:
[HUAWEI] ospf 1 //Enter the OSPF process view.
[HUAWEI-ospf-1] area 10 //Enter the view of Area 10.
[HUAWEI-ospf-1-area-0.0.0.10] abr-summary 10.10.0.0 255.255.0.0 //Summarize routes on the ABR.
[HUAWEI-ospf-1-area-0.0.0.10] quit
NOTE
The abr-summary command can be configured only on an ABR. Do not configure this
command on non-ABRs in an area. Otherwise, incorrect routing entries will be generated.
Before routes are summarized, the IP routing table of NE40E-1 is as follows:
<NE40E-1> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 12 Routes : 12
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.0.0.1/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.1.0/24 OSPF 10 3 D 10.200.10.2 GigabitEthernet0/0/1
10.10.2.0/24 OSPF 10 3 D 10.200.10.2 GigabitEthernet0/0/1
10.10.3.0/24 OSPF 10 3 D 10.200.10.2 GigabitEthernet0/0/1
After routes are summarized, the IP routing table of NE40E-1 is as follows:
<NE40E-1> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 12 Routes : 12
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.0.0.1/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.0.0/16 OSPF 10 3 D 10.200.10.2 GigabitEthernet0/0/1
The preceding outputs show that NE40E-1 in the backbone area has specific
routes to users' network segments before routes are summarized. After route
summarization is configured on the ABR, NE40E-1 has only one summarized route
with a 16-bit mask to users' network segments. If there are many user network
segments, route summarization can significantly reduce routing entries in the
backbone areas, decrease the number of LSAs to be exchanged between the
backbone and non-backbone areas, and therefore improve the network stability.
Uplink Traffic Diversion: Default OSPF Route Import and Route Selection
Optimization
Most traffic of a campus network is destined for the Internet. Therefore, on a
campus network with multiple egresses, you must consider importing default
routes and load balancing traffic among these egresses.
Multiple methods are available to import default routes. The recommended
method is to configure non-forcible delivery of default routes on an ASBR. Non-
forcible delivery of default routes indicates that a default route can be advertised
only when it exists in the IP routing table of this ASBR. This prevents loops and
suboptimal routes in special scenarios.
In Figure 5-63, after two ASBRs advertise default routes, the core switch cluster
receives two default routes with their next hops pointing to two egress routers
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 251
respectively. The core switch cluster can choose one link as the uplink or two
uplinks for load balancing. You can flexibly configure traffic direction based on
network requirements.
Figure 5-63 Using default routes for uplink traffic direction on the core switch
cluster
The following configures non-forcible delivery of default routes on NE40E-1 (the
configuration of NE40E-2 is similar to that of NE40E-1):
[NE40E-1] ip route-static 0.0.0.0 0.0.0.0 1.1.1.1 //On NE40E-1, configure a default route with the next
hop pointing to the public address of the telecom carrier.
[NE40E-1] ospf 1 //Enter the OSPF process view.
[NE40E-1-ospf-1] default-route-advertise //Advertise the default route without specifying the always
parameter. That is, the default route is delivered non-forcibly.
After the preceding configurations are complete, the core switch cluster learns two
equal-cost default routes. Uplink traffic of the core switch cluster will be
forwarded in load balancing mode.
<HUAWEI> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 23 Routes : 24
Destination/Mask Proto Pre Cost Flags NextHop Interface
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 252
0.0.0.0/0 O_ASE 150 1 D 10.200.10.1 Vlanif40
O_ASE 150 1 D 10.200.20.1 Vlanif50
......
If you want two uplinks of the core switch cluster to work in active/standby mode,
the simplest method is to change their OSPF costs.
To implement route backup, you can change the OSPF cost of the link from the
core switch cluster to NE40-2 to be higher than that of the link from the cluster to
NE40-1. In this way, uplink traffic is preferentially sent to NE40E-1. If NE40E-1 is
faulty, the traffic is automatically switched to NE40E-2.
Configure the core switch cluster.
[HUAWEI] interface vlanif 50 //Enter the OSPF interface view.
[HUAWEI-Vlanif50] ospf cost 10 //Change the OSPF cost of this interface to 10.
Configure NE40E-2.
[NE40E-2] interface gigabitethernet 0/0/1 //Enter the OSPF interface view.
[NE40E-2-GigabitEthernet0/0/1] ospf cost 10 //Change the OSPF cost of this interface to 10.
NOTE
To adjust the cost of a link to affect OSPF route selection, you need to adjust the cost on
the devices on both ends of the link. Otherwise, asymmetric routing occurs, which causes
network faults.
The default OSPF cost of links providing more than 100 Mbit/s bandwidth is 1.
After the OSPF cost of the link from the core switch cluster to NE40-2 is changed
to 10, the cluster transmits its uplink traffic preferentially to NE40-1, and the IP
routing table of the cluster has only one default route pointing to NE40E-1.
<HUAWEI> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 23 Routes : 23
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 O_ASE 150 1 D 10.200.10.1 Vlanif40
......
Loop Prevention in Route Summarization Scenarios: Blackhole Route
After the preceding design and deployment, this campus network has basic OSPF
functions and routing entries have been optimized. However, this network has the
risk of loops due to route summarization.
It is common that a campus network is under internal network attacks. Assume
that a host in Building 1 is attacked by viruses, which will make the host access all
IP addresses on the network segment 10.0.0.0. In this situation, a loop may easily
occur.
If the host accesses the IP address 10.10.50.1 (this address does not exist in
Building 1), a routing loop occurs:
1. When the host sends a packet, the packet is sent to its gateway, namely,
aggregation switch cluster 1 in Building 1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 253
2. Aggregation switch cluster 1 does not have specific routes to the destination
address of this packet, and therefore it sends this packet to the core switch
cluster through a default route.
3. The IP address 10.10.50.1 does not exist on the entire campus network.
Therefore, after the packet reaches the core switch cluster, it matches only a
default route and then is sent to NE40E-1.
4. The route learned by NE40E-1 is summarized and then advertised by the core
switch cluster, so the packet matches the route 10.10.0.0/16 and is sent back
to the core switch cluster.
A routing loop occurs between the core switch cluster and NE40E-1, as shown in
Figure 5-64. This loop will seriously affect network operation and even cause
network crash. Therefore, you need to avoid routing loops in route summarization
scenarios.
Figure 5-64 Routing loop
The main reason for this routing loop is that the core switch cluster uses a default
route to forward a packet with a destination address that does not exist in the
campus network to the backbone area, and then the backbone area sends the
packet back to the cluster through a summarized return route.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 254
To address this problem, you need to configure a blackhole route on the core
switch cluster to block such a packet. Perform the following configuration:
[HUAWEI] ip route-static 10.10.0.0 255.255.0.0 NULL0
After a blackhole route is configured, the packet to be returned to the network
segment 10.10.0.0 will be directed to the user network segment through a specific
route. If such specific route is not found, this host address does not exist in the
campus network. The packet will match this blackhole route and be dropped to
prevent routing loops. When configuring route summarization in other areas, you
also need to configure a blackhole route to prevent routing loops.
OSPF Network Security: Silent Interface
After the preceding deployment is completed, the entire OSPF network can run
properly. However, this network has a large security vulnerability. That is, user-side
interfaces can receive OSPF Hello packets, so basic network information can be
easily obtained using a network sniffing tool for attack launch.
To ensure OSPF network security, you are advised to configure silent interfaces to
block OSPF packets sent to users, as shown in Figure 5-65.
Figure 5-65 Configuring silent interfaces to block OSPF packets sent to users
The following configures silent interfaces in core switch cluster 1 in Area 10:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 255
[HUAWEI] ospf 1
[HUAWEI-ospf-1] silent-interface vlanif100
[HUAWEI-ospf-1] silent-interface vlanif200
[HUAWEI-ospf-1] silent-interface vlanif300
NOTE
The silent-interface command prohibits specified interfaces from receiving and sending
OSPF packets and is typically configured on user-side interfaces. Configuring this command
on the link between two OSPF routers will cause a failure to establish an OSPF neighbor
relationship between them.
5.5 Summary of OSPF Configuration Tasks
This section provides a summary of OSPF configuration tasks. Perform
configurations according to your particular requirements.
Table 5-18 describes OSPF configuration tasks.
Table 5-18 OSPF configuration tasks
Scenario Description Task
Configuring Basic OSPF
Functions
Basic OSPF functions must be
configured before other OSPF
functions can be implemented.
5.8
Configuring
Basic OSPF
Functions
5.9
Configuring
Session
Parameters
for OSPF
Neighbor or
Adjacency
Relationshi
ps
5.10
Configuring
OSPF
Attributes
on Different
Types of
Networks
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 256
Scenario Description Task
Configuring OSPF Areas ● In a stub area, an area border
router (ABR) does not transmit
autonomous system (AS) external
routes, reducing route entries on
the ABR as well as the amount of
routing information to be
transmitted.
● An NSSA is a special type of OSPF
area. Similar to a stub area, an
NSSA does not transmit external
routes from other areas. Different
from a stub area, an NSSA imports
AS external routes and transmits
them in the entire AS (a stub area
does not import AS external
routes).
5.11
Configuring
OSPF Stub
Areas
5.12
Configuring
an OSPF
NSSA
Configuring OSPF Local-
MT
You can enable OSPF local multicast
topology (Local-MT) to allow TE
tunnel spanned devices to generate
multicast forwarding entries.
5.13
Configuring
Local MT
Adjusting OSPF Route
Selection
To implement flexible application of
OSPF on the live network, you can
adjust OSPF parameters to control
OSPF routing.
5.14
Adjusting
OSPF Route
Selection
Controlling OSPF
Routing Information
To implement network requirements,
you can configure OSPF parameters
to control advertisement and receipt
of OSPF routes.
5.15
Controlling
OSPF
Routing
Information
Controlling the
Convergence Speed of
OSPF Routes
You can increase the convergence
speed of OSPF routes to enable OSPF
to quickly respond to changes in the
network topology, or reduce the
convergence speed to decrease the
impact caused by route flapping over
OSPF networks and relieve loads on
devices.
5.18
Configuring
OSPF Fast
Convergenc
e
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 257
Scenario Description Task
Improving Reliability of
an OSPF Network
● If you configure BFD for OSPF in a
process or on an interface, the link
status can be rapidly detected.
This allows fault detection to
complete in milliseconds, speeding
up OSPF convergence.
● To avoid traffic interruption and
route flapping caused by standby/
active switchovers, you can
configure OSPF GR.
5.16
Configuring
BFD for
OSPF
5.19
Configuring
OSPF GR
Improving Stability of an
OSPF Network
You can improve the stability of an
OSPF network to reduce route
flapping on the network. This enables
the devices to work in a normal state
for an extended period of time.
5.20
Improving
Stability of
an OSPF
Network
Improving the Security of
an OSPF Network
In an OSPF network demanding high
security, you can configure OSPF
authentication and GTSM to improve
the network security.
5.21
Improving
the Security
of an OSPF
Network
5.6 Licensing Requirements and Limitations for OSPF
Involved Network Elements
Other network elements are required to support OSPF.
Licensing Requirements
OSPF is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support OSPF.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 258
Feature Limitations
None.
5.7 Default Settings for OSPF
Table 5-19 describes the default settings for OSPF.
Table 5-19 Default settings for OSPF
Parameter Default Setting
OSPF Disabled
Interval for sending Hello
packets
10 seconds on P2P and broadcast interfaces; 30
seconds on P2MP and NBMA interfaces
Dead interval after which
an OSPF neighbor
relationship expires
40 seconds on P2P and broadcast interfaces; 120
seconds on P2MP and NBMA interfaces
Period during which a
device acts as a stub router
500 seconds
Bandwidth reference value
used to calculate a link cost
100 Mbit/s
5.8 Configuring Basic OSPF Functions
Applicable Environment
When OSPF is configured on multiple switches in the same area, most
configuration data, such as the timer, filter, and aggregation, must be planned
uniformly by area. Incorrect configurations may prevent neighboring switches from
exchanging information or even cause routing information congestion and self-
loops.
OSPF configurations performed in interface views take effect regardless of
whether OSPF is enabled. These configurations remain in place even if OSPF is
disabled.
Pre-configuration Tasks
Before configuring basic OSPF functions, configure IP addresses for interfaces to
ensure that neighboring nodes are reachable at the network layer.
5.8.1 Creating an OSPF Process
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 259
Context
To run OSPF, each switch must have a router ID. A router ID is a 32-bit unsigned
integer, uniquely identifying a switch in an AS. To ensure the stability of OSPF,
manually plan and configure a unique router ID for each device.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id | router-id
router-id | vpn-instance
vpn-instance-name ] *
An OSPF process is created, and the OSPF view is displayed.
● The parameter
process-id specifies the ID of an OSPF process. The default
value is 1.
The switch supports OSPF multi-process. You can create different processes
for different types of services. An OSPF process ID is of local significance.
Different switches can exchange packets even if they have different process
IDs.
● The parameter router-id
router-id specifies the router ID of a switch.
By default, the system automatically selects the largest IP address among
loopback interface addresses as its router ID. The router ID of each device in
an AS must be unique. Using an interface IP address as a router ID is
recommended.
NOTE
The router ID of each OSPF process must be unique on the OSPF network; otherwise,
the OSPF neighbor relationship cannot be set up and routing information is incorrect.
Configuring a unique router ID for each OSPF process on each OSPF device is
recommended to ensure stability.
● The parameter vpn-instance
vpn-instance-name specifies the name of a VPN
instance.
If a VPN instance is specified, the OSPF process belongs to that VPN instance;
otherwise, the OSPF process belongs to a public network instance.
----End
5.8.2 Creating an OSPF Area
Context
Each device on an OSPF network must maintain an LSDB. The size of the LSDB
increases as more devices are deployed on the network, which can become a
burden. OSPF solves this problem by partitioning an AS into areas. An area is a
logical device group identified by an area ID. The borders of an area are devices
rather than links. Each OSPF interface must belong to an area, meaning that a link
(or network segment) belongs to only one area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 260
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id | router-id
router-id | vpn-instance
vpn-instance-name ] *
An OSPF process is created, and the OSPF view is displayed.
Step 3 Run area
area-id
An OSPF area is created, and the OSPF area view is displayed.
The area with ID 0 is the backbone area, which is responsible for forwarding inter-
area routing information. Routing information between non-backbone areas must
be forwarded through the backbone area.
----End
5.8.3 Enabling OSPF
Context
After creating an OSPF process, you need to configure the network segments to
which the IP addresses of OSPF interfaces belong in an area. Each interface that
runs OSPF must belong to an area, meaning that a network segment can belong
to only one area.
OSPF checks the network mask carried in received Hello packets. If the network
mask carried in such a packet is different from that of the local device, OSPF
discards the Hello packet and does not establish any OSPF neighbor relationship.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
OSPF can be enabled in an OSPF area or on a specific interface.
● Enable OSPF in an OSPF area.
1. Run network
ip-address wildcard-mask
A network segment belonging to an area is configured.
OSPF can run on an interface only when the following conditions are met:
– The IP address mask length of the interface is greater than or equal to
the mask length converted from the wildcard mask specified in the
network command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 261
– The primary IP address of the interface resides in the network segment
specified in the network command.
By default, OSPF advertises the IP address of a loopback interface as a 32-bit
host route, which is independent from the mask length configured on the
loopback interface. To advertise routes to the network segment where the
loopback interface resides, configure the network type as NBMA or broadcast
in the interface view. For details, see Configuring Network Types for OSPF
Interfaces.
● Enable OSPF on a specific interface.
1. Run interface
interface-type interface-number
The interface view is displayed.
2. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
3. Run ospf enable [
process-id ] area
area-id
OSPF is enabled on the interface.
A decimal integer or an IPv4 address in dotted-decimal notation can be
entered as the area ID, but the area ID is displayed always as an IPv4 address
in dotted-decimal notation.
----End
5.8.4 (Optional) Creating OSPF Virtual Links
Context
After OSPF areas are defined, OSPF route updates between non-backbone areas
are transmitted through the backbone area. OSPF requires that all non-backbone
areas maintain connectivity with the backbone area and that the backbone areas
in different OSPF areas also maintain connectivity with each other. However, this is
not true in some cases due to certain restrictions. To resolve this problem, you can
configure OSPF virtual links.
Perform the following steps on a switch running OSPF.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 262
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Run vlink-peer
router-id [ smart-discover | hello
hello-interval | retransmit
retransmit-interval | trans-delay
trans-delay-interval | dead
dead-interval |
[ simple [ plain
plain-text | [ cipher ]
cipher-text ] | { md5 | hmac-md5 | hmac-
sha256 } [
key-id { plain
plain-text | [ cipher ]
cipher-text } ] | authentication-
null | keychain
keychain-name ] ] *
A virtual link is created.
The vlink-peer (OSPF area) command must also be configured on the
neighboring switch.
NOTICE
If plain is selected, the password is stored in plaintext in the configuration file. For
security purposes, you are advised to select cipher so that the password is stored
in ciphertext.
Simple authentication, MD5 authentication and HMAC-MD5 authentication have
potential security risks. Therefore, HMAC-SHA256 authentication is recommended.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support the keychain
keychain-name parameter.
----End
Follow-up Procedure
Devices from different vendors may use different default MTUs. Therefore, after
virtual links are created, the MTU needs to be set to the default value 0 for
interfaces to send DD packets, which ensures the compatibility. For details, see
Configuring an Interface to Fill in the DD Packet with the Actual MTU.
5.8.5 (Optional) Restricting the Flooding of LSA Packets
Context
If there are multiple neighboring switches or a large number of LSA packets are
flooded, a neighboring switch may be inundated with LSA packets and become
overwhelmed processing them. This may cause the neighboring switch to discard
Hello packets that are used to maintain the OSPF neighbor relationships, resulting
in interruptions to the neighbor relationships. More packets need to be exchanged
to reestablish the neighbor relationships, which further increases the possibility of
neighbor relationship interruptions. To resolve this problem, you can restrict the
flooding of LSA packets.
Perform the following steps on a switch running OSPF.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 263
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run flooding-control [ number
transmit-number | timer-interval
transmit-
interval ] *
The flooding of LSA packets is restricted.
By default, 50 LSA packets can be flooded at an interval of 30 ms.
The flooding-control command takes effect immediately after execution.
If the flooding-control command is not run, flooding of LSA packets is
automatically restricted when the number of neighboring switches exceeds 256.
----End
5.8.6 Verifying the Basic OSPF Function Configuration
Prerequisites
All configurations of basic OSPF functions are complete.
Procedure
● Run the display ospf [
process-id ] peer command in any view to check
information about OSPF neighbors.
● Run the display ospf [
process-id ] interface command in any view to check
information about OSPF interfaces.
● Run the display ospf [
process-id ] routing command in any view to check
information about an OSPF routing table.
● Run the display ospf [
process-id ] lsdb command in any view to check
information about an OSPF LSDB.
----End
5.9 Configuring Session Parameters for OSPF Neighbor
or Adjacency Relationships
Pre-configuration Tasks
On an OSPF network, all routing information is transmitted and exchanged
between neighboring or adjacent devices. Configuring proper session parameters
for OSPF neighbor or adjacency relationships helps improve network stability.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 264
Before configuring session parameters for OSPF neighbor or adjacency
relationships, complete the following tasks:
● Configure a link layer protocol.
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more of the following configuration tasks (excluding the task of
Verifying the OSPF Session Parameter Configuration) as required.
5.9.1 Setting an OSPF Packet Retransmission Limit
Context
After an OSPF switch sends DD, LSU, or LSR packets but does not receive any
LSAck packet from a neighbor within a specified time, the switch retransmits the
packets. If the number of packet retransmissions reaches a specified limit, the
switch tears down the adjacency relationship with the neighbor.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run retransmission-limit [
max-number ]
An OSPF packet retransmission limit is set.
By default, no OSPF packet retransmission limit is set. If an OSPF packet
retransmission limit is set, the default value of
max-number is 30.
----End
5.9.2 Configuring an Interface to Insert the Actual MTU into
DD Packets
Context
The default maximum transmission unit (MTU) is 0.
To improve compatibility with a non-Huawei device, an OSPF-enabled Huawei
device adds the MTU 0 in DD packets to be sent and does not check the MTUs in
received DD packets, allowing an OSPF neighbor relationship to be set up even if
the two ends have different MTU settings.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 265
However, under the default configuration, the non-Huawei device may discard an
OSPF packet received from the Huawei device if the packet's actual MTU is
greater than the MTU of the non-Huawei device. If the discarded packet is an LSU,
an OSPF neighbor relationship can still be set up, but the route carried in the LSU
fails to be learned, causing service interruptions.
To resolve this issue, run the ospf mtu-enable command to configure an interface
to add the actual MTU in DD packets to be sent and check whether the MTU in a
received DD packet is greater than the local MTU. If the interface MTU settings of
the local and remote ends are different, an OSPF neighbor relationship cannot
enter the Full state. In this manner, MTU inconsistency can then be identified in
time.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf mtu-enable
The interface is configured to insert the actual MTU into DD packets and check
whether the MTU in DD packets from the neighbor exceeds the MTU of the local
end.
By default, the MTU in DD packets sent by an interface is 0.
NOTICE
Performing this procedure causes the re-establishment of neighbor relationships.
----End
5.9.3 Verifying the OSPF Session Parameter Configuration
Prerequisites
All configurations about session parameters of OSPF neighbor or adjacency
relationships are complete.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 266
Procedure
● Run the display ospf [
process-id ] peer command to check information
about OSPF neighbors.
● Run the display ospf [
process-id ] brief command to check brief OSPF
information.
● Run the display ospf [
process-id ] retrans-queue [
interface-type interface-
number ] [
neighbor-id ] [ low-level-of-retrans-times-range
min-time ]
[ high-level-of-retrans-times-range
max-time ] command to check the
OSPF retransmission queue.
----End
5.10 Configuring OSPF Attributes on Different Types of
Networks
Applicable Environment
By setting network types for OSPF interfaces and adjusting the OSPF attributes,
you can flexibly build OSPF networks.
In Table 5-20, OSPF classifies networks into four types based on the types of link
layer protocols.
Table 5-20 Network types supported by OSPF
Network Type Characteristic Default Configuration
Broadcast On a broadcast network,
Hello packets, LSU packets,
and LSAck packets are
transmitted using multicast;
DD packets and LSR packets
are transmitted using unicast.
If the link layer protocol is
Ethernet or Fiber Distributed
Data Interface (FDDI), OSPF
regards the network as a
broadcast network by
default.
Non-broadcast
multiple access
(NBMA)
On an NBMA network, Hello
packets, DD packets, LSR
packets, LSU packets, and
LSAck packets are
transmitted using unicast.
An NBMA network must be
fully meshed. That is, any
two switches on an NBMA
network must be directly
reachable.
If the link layer protocol is
ATM, OSPF regards the
network as an NBMA
network by default.
Point-to-point
(P2P)
On a P2P network, Hello
packets, DD packets, LSR
packets, LSU packets, and
LSAck packets are
transmitted using multicast.
If the link layer protocol is
PPP, HDLC, or Link Access
Procedure Balanced (LAPB),
OSPF regards the network as
a P2P network by default.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 267
Network Type Characteristic Default Configuration
Point-to-
multipoint
(P2MP)
On a P2MP network, Hello
packets are transmitted using
multicast; DD packets, LSR
packets, LSU packets, and
LSAck packets are
transmitted using unicast.
OSPF does not regard a
network as a P2MP network
by default regardless of its
link layer protocol. A P2MP
network must be forcibly
changed from another
network type.
As described in Table 5-20, the difference between OSPF configurations on four
types of networks lies in the packet transmission mode.
Pre-configuration Tasks
Before configuring OSPF attributes on different types of networks, complete the
following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Configuring network types of OSPF interfaces is the prerequisite for configuring
P2MP or NBMA network attributes.
5.10.1 Configuring a Network Type for an OSPF Interface
Context
Configure one of the following network types for an OSPF interface:
● P2MP: A P2MP network does not have an associated link layer protocol.
Therefore, a P2MP network must be forcibly changed from another network
type.
● NBMA: An NBMA network must be fully meshed. That is, any two switches on
an NBMA network must be directly reachable. However, this is not true in
many cases. In such cases, you need to manually change the network type.
● Broadcast: To speed up the establishment of neighbor relationships, you can
change the network type from broadcast to P2P.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 268
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf network-type { broadcast | nbma | p2mp | p2p [ peer-ip-ignore ] }
A network type is configured for the interface.
By default, the network type of an interface depends on the type of the physical
interface. The default network type of an Ethernet interface is broadcast.
When you configure a new network type for an interface, the original network
type of the interface is replaced.
A network type can be configured to suit networking requirements:
● If the network type of an interface is broadcast and a switch on the network
does not support multicast addresses, you can change the network type of
the interface to NBMA.
● If the network type of an interface is NBMA and the network is fully meshed
(any two switches are directly connected), you can change the network type
of the interface to broadcast. Configuring neighboring switch information on
the interface is not required then.
● If the network type of an interface is NBMA but the network is not fully
meshed, you must change the network type of the interface to P2MP. This
allows two indirectly connected switches to communicate through one switch
that directly connects to them both. Configuring neighboring switch
information on the interface is not required then.
● If only two switches run OSPF on the same network segment, you are advised
to change the network type of the interface to P2P.
NOTE
OSPF cannot be configured on a null interface.
----End
5.10.2 Configuring P2MP Network Attributes
Procedure
Step 1 Disable OSPF from checking the network mask.
1. Run system-view
The system view is displayed.
2. Run interface
interface-type interface-number
The interface view is displayed.
3. (Optional) On an Ethernet interface, run undo portswitch
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 269
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
4. Run ospf network-type p2mp
A network type is configured for the OSPF interface.
A P2MP network must be forcibly changed from another network type. For
details, see Configuring Network Types for OSPF Interfaces.
5. Run ospf p2mp-mask-ignore
OSPF is disabled from checking the network mask on the P2MP network.
6. Run quit
Exit the interface view.
Step 2 (Optional) Set the cost for the OSPF route to a specified neighbor on a P2MP
network.
By default, on a P2MP network, the cost of an OSPF route to a neighbor equals
the interface cost. If this default cost is not suitable, run the p2mp-peer command
to set a desired cost.
1. Run ospf [
process-id ]
The OSPF process view is displayed.
2. Run p2mp-peer
ip-address cost
cost
A cost is set for an OSPF route to a specified neighbor on a P2MP network.
Step 3 Configure the switch to filter the LSA packets to be sent.
When multiple links exist between two switches, you can configure the local
switch to filter the LSA packets to be sent. This can reduce unnecessary LSA
retransmission attempts and save bandwidth resources.
1. Run ospf [
process-id ]
The OSPF process view is displayed.
2. Run filter-lsa-out peer
ip-address { all | { summary [ acl {
acl-number |
acl-
name } ] | ase [ acl {
acl-number |
acl-name } ] | nssa [ acl {
acl-number |
acl-name } ] } * }
The local switch is configured to filter the LSA packets to be sent on the P2MP
network.
By default, the LSA packets to be sent are not filtered.
----End
5.10.3 Configuring NBMA Network Attributes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 270
Procedure
Step 1 (Optional) Set the network type to NBMA.
An NBMA network must be fully meshed. That is, any two switches on an NBMA
network must be directly reachable. In most cases, however, this is not true. To
resolve this problem, you can run specific commands to forcibly change the
network type to P2MP. For details, see Configuring Network Types for OSPF
Interfaces.
1. Run system-view
The system view is displayed.
2. Run interface
interface-type interface-number
The interface view is displayed.
3. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
4. Run ospf network-type nbma
The network type of the OSPF interface is set to NBMA.
Step 2 (Optional) Set the interval at which Hello packets for polling are sent on the
NBMA network.
On the NBMA network, after the neighbor relationship becomes invalid, the
switch sends Hello packets at an interval defined in the polling mechanism.
1. Run ospf timer poll
interval
The interval at which Hello packets for polling are sent is set on an NBMA
interface.
The default value is 120, in seconds.
Step 3 Configure a neighboring switch on the NBMA network.
If the network type of an interface is NBMA, the interface cannot broadcast Hello
packets to discover neighboring switches. Therefore, the IP address of a
neighboring switch and whether the neighboring switch can participate in DR
election must be configured manually on the interface.
1. Run quit
Exit the interface view.
2. Run ospf [
process-id ]
The OSPF process view is displayed.
3. Run peer
ip-address [ dr-priority
priority ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 271
A neighboring switch is configured on the NBMA network.
----End
5.10.4 Verifying the OSPF Attribute Configuration
Prerequisites
The configurations for OSPF attributes on the NBMA network and P2MP network
are complete.
Procedure
● Run either of the following commands to check LSDB information:
– display ospf [
process-id ] lsdb [ brief ]
– display ospf [
process-id ] lsdb [ { router | network | summary | asbr |
ase | nssa | opaque-link | opaque-area | opaque-as } [
link-state-id ] ]
[ originate-router [
advertising-router-id ] | self-originate ] [ age { min-
value
min-age-value | max-value
max-age-value } * ]
● Run the display ospf [
process-id ] peer [ [
interface-type interface-number ]
neighbor-id | brief | last-nbr-down ] command to view OSPF neighbor
information.
● Run the display ospf [
process-id ] nexthop command to check OSPF next
hop information.
● Run either of the following commands to check OSPF routing table
information:
– display ospf [
process-id ] routing [
ip-address [
mask |
mask-length ] ]
[ interface
interface-type interface-number ] [ nexthop
nexthop-
address ]
– display ospf [
process-id ] routing router-id [
router-id ]
● Run the display ospf [
process-id ] interface [ all |
interface-type interface-
number ] [ verbose ] command to check OSPF interface information.
----End
5.11 Configuring OSPF Stub Areas
Applicable Environment
Partitioning an AS into different areas reduces the number of LSAs. To further
reduce the number of entries in routing tables and the number of LSAs to be
transmitted in a non-backbone area, configure the non-backbone area on the
border of the AS as a stub area.
Configuring a stub area is optional.
Note the following points when configuring a stub area:
● The backbone area (Area 0) cannot be configured as a stub area.
● If an area is to be configured as a stub area, all the switches in this area must
be configured with stub attributes using the stub command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 272
● An ASBR cannot exist in a stub area to import AS external routes.
● Virtual links cannot exist in stub areas.
Pre-configuration Tasks
Before configuring OSPF stub areas, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Figure 5-66 Flowchart of configuring OSPF stub areas
5.11.1 Configuring an Area as a Stub Area
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Run stub [ no-summary | default-route-advertise backbone-peer-ignore ] *
The area is configured as a stub area.
The parameter no-summary prevents an ABR from sending Type 3 LSAs to the
stub area.
The parameter default-route-advertise enables an ABR to generate default Type
3 LSAs and advertise them to the stub area.
The parameter backbone-peer-ignore prevents an ABR from checking the
neighbor status when the ABR generates default Type 3 LSAs and advertises them
to the stub area. Specifically, the ABR generates default Type 3 LSAs and
advertises them to the stub area if there is an Up interface in the backbone area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 273
NOTE
● Stub attributes must be configured on all switches in a stub area using the stub
command.
● Configuring or deleting stub attributes will update routing information in the area. Stub
attributes can be deleted or reconfigured only after the routing update is complete.
Step 5 (Optional) Run default-cost
cost
The cost of the default Type 3 route to the stub area is set.
The default value is 1.
To ensure the reachability of AS external routes to a stub area, the ABR in the stub
area generates a default route and advertises the route to the non-ABR switches
in the stub area.
----End
5.11.2 Verifying the OSPF Stub Area Configuration
Procedure
Run either of the following commands to check LSDB information:
● display ospf [
process-id ] lsdb [ brief ]
● display ospf [
process-id ] lsdb [ { router | network | summary | asbr | ase |
nssa | opaque-link | opaque-area | opaque-as } [
link-state-id ] ]
[ originate-router [
advertising-router-id ] | self-originate ] [ age { min-
value
min-age-value | max-value
max-age-value } * ]
Run either of the following commands to check OSPF routing table information:
● display ospf [
process-id ] routing [
ip-address [
mask |
mask-length ] ]
[ interface
interface-type interface-number ] [ nexthop
nexthop-address ]
● display ospf [
process-id ] routing router-id [
router-id ]
Run the display ospf [
process-id ] abr-asbr [
router-id ] command to check OSPF
ASBR and ABR information.
5.12 Configuring an OSPF NSSA
Applicable Environment
To import external routes and prevent resource consumption caused by external
routes, configure an NSSA.
An NSSA is a special type of OSPF area. Similar to a stub area, an NSSA does not
transmit external routes from other areas. Different from a stub area, an NSSA
imports AS external routes and transmits them in the entire AS using Type 7 LSAs
(a stub area does not import AS external routes).
Type 7 LSAs are generated by ASBRs of NSSAs and flooded only in the NSSAs
where ASBRs reside. An ABR in an NSSA selectively translates received Type 7 LSAs
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 274
into Type 5 LSAs to advertise AS external routes to the other areas over the OSPF
network.
Pre-configuration Tasks
Before configuring an NSSA, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring switches are
reachable at the network layer.
● Configure basic OSPF functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Run nssa [ { default-route-advertise [ backbone-peer-ignore ] | suppress-
default-route } | flush-waiting-timer
interval-value | no-import-route | no-
summary | set-n-bit | suppress-forwarding-address | translator-always |
translator-interval
interval-value | zero-address-forwarding | translator-strict ]*
The area is configured as an NSSA.
NOTE
● NSSA attributes must be configured on all devices in the NSSA using the nssa
command.
● Configuring or deleting NSSA attributes will update the routing information in the area
and interrupt neighbor relationships. NSSA attributes can be reconfigured or deleted
only after the routing update is complete.
The parameters in the nssa command apply to the following scenarios:
● The default-route-advertise parameter is used to configure an ASBR to
advertise a Type 7 LSA carrying a default route to the NSSA.
On an ABR, a Type 7 LSA carrying a default route is generated regardless of
whether the routing table on the ABR contains a default route. On an ASBR, a
Type 7 LSA carrying a default route is generated only when the routing table
contains a default route.
● When the area to which an ASBR belongs is configured as an NSSA, invalid
Type 5 LSAs from other switches in the area can be deleted only when the
aging time reaches 3600s. These invalid LSAs consume numerous memory
resources, degrading the switch performance. To resolve this problem, you can
set the flush-waiting-timer parameter to generate Type 5 LSAs with the
aging time set to the maximum value (3600s). The generated Type 5 LSAs
with the largest aging time can delete the invalid Type 5 LSAs from other
switches in time.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 275
NOTE
– When the value of the LS age field (aging time) in the header of an LSA generated
using the flush-waiting-timer parameter reaches 3600s, the LSA is deleted.
– If an ASBR also functions as an ABR, the flush-waiting-timer parameter does not
take effect. This prevents Type 5 LSAs in non-NSSAs from being deleted.
● If an ASBR also functions as an ABR, you can configure the no-import-route
parameter to prevent external routes imported using the import-route
command from being advertised to the NSSA.
● The no-summary parameter can be configured on an ABR to prevent an ABR
from transmitting Type 3 LSAs to an NSSA so that the number of LSAs
transmitted to the NSSA can be reduced.
NOTE
After the nssa default-route-advertise backbone-peer-ignore no-summary
command is run, the ABR generates Type 7 and Type 3 LSAs both carrying default
routes if there is an Up interface in the backbone area. The Type 3 LSAs preferentially
take effect.
● If the set-n-bit parameter is configured, the N-bit is set in the DD packets
during the synchronization between the switch and neighboring switches.
● If multiple ABRs are deployed in an NSSA, the system automatically selects an
ABR (generally the switch with the largest router ID) as a translator
converting Type 7 LSAs into Type 5 LSAs. To specify one or two ABRs (in load
balancing scenarios) as all-the-time translators, you can configure the
translator-always parameter on the selected ABRs. You can use this
command to pre-configure a fixed translator to prevent LSA flooding caused
by translator role changes.
● The translator-interval parameter is used to ensure uninterrupted services
when translator roles change. The value of
interval-value must be greater
than the flooding period.
Step 5 (Optional) Run default-cost
cost
The cost of the default route carried in Type 3 LSAs that the ABR sends to the
NSSA is set.
To ensure reachability of AS external routes, the ABR in the NSSA generates a
default route and advertises the route to other switches in the NSSA. You can use
this command to set the cost of the default route to an NSSA and adjust the
selection of the default route.
Type 7 LSAs can also be used to carry a default route to guide traffic to other ASs.
Multiple ABRs may exist in an NSSA. To prevent routing loops, an ABR does not
calculate the default routes advertised by the other ABRs.
By default, the cost of the default route that an ABR sends to the NSSA is 1.
----End
Verifying the Configuration
Run either of the following commands to check LSDB information:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 276
● display ospf [
process-id ] lsdb [ brief ]
● display ospf [
process-id ] lsdb [ { router | network | summary | asbr | ase |
nssa | opaque-link | opaque-area | opaque-as } [
link-state-id ] ]
[ originate-router [
advertising-router-id ] | self-originate ] [ age { min-
value
min-age-value | max-value
max-age-value } * ]
Run either of the following commands to check OSPF routing table information:
● display ospf [
process-id ] routing [
ip-address [
mask |
mask-length ] ]
[ interface
interface-type interface-number ] [ nexthop
nexthop-address ]
● display ospf [
process-id ] routing router-id [
router-id ]
Run the display ospf [
process-id ] interface [ all |
interface-type interface-
number ] [ verbose ] command to check OSPF interface information.
5.13 Configuring Local MT
Applicable Environment
When both multicast and an MPLS TE tunnel are configured and the TE tunnel is
configured with IGP Shortcut, the outbound interface of the route calculated by an
IGP may not a physical interface but a TE tunnel interface. The switch uses the TE
tunnel interface to send multicast Join messages through a unicast route to the
multicast source address. The switch through which the TE tunnel passes, however,
cannot detect the multicast Join messages. As a result, multicast forwarding
entries will not be created.
To resolve this problem, you need to enable local MT. After local MT is enabled, if
the outbound interface of the calculated route is a TE tunnel interface of the IGP
Shortcut type, the route management (RM) module creates a separate MIGP
routing table for the multicast protocol, calculates the physical outbound interface
for the route, and adds the physical interface to the MIGP routing table for
multicast forwarding.
You can configure filtering conditions for local MT to control the number of
routing entries in an MIGP routing table and speed up MIGP routing table lookup.
NOTE
Only the S5731-S, S5731-H, S5731S-H, S5732-H, S6730-S, S6730S-H, and S6730-Hsupport
this function.
Pre-configuration Tasks
Before configuring local MT, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring switches are
reachable at the network layer.
● Configure basic OSPF functions.
● Configure a TE tunnel for the OSPF process.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 277
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run local-mt enable
Local MT is enabled.
NOTE
● Local MT is applicable only to the OSPF process of a public network instance.
● Local MT does not support forwarding adjacency (FA).
Step 4 (Optional) Run local-mt filter-policy { acl {
acl-number |
acl-name } | ip-prefix
ip-prefix-name | route-policy
route-policy-name }
A filtering policy is configured for local MT.
After an MIGP routing table is created, OSPF calculates routes. When the
calculation result shows that the outbound interface is an IGP Shortcut-capable TE
tunnel interface, the switch saves the physical interface where the tunnel interface
resides as the outbound interface in the MIGP routing table for multicast packet
forwarding.
To control the number of entries in the MIGP routing table and speed up the
MIGP routing table lookup, you can configure a filtering policy to allow only the
matched routes to the multicast source address to be added to the MIGP routing
table.
Multiple routes to a non-multicast source address may be added to a MIGP
routing table, causing the number of entries to exceed the upper limit. Therefore,
you are advised to configure a routing policy before enabling local MT.
NOTE
If a named ACL is configured using the acl command and a rule is configured using the rule
command for the ACL, the rule takes effect only on the source address range specified by the
parameter source within the time range specified by the parameter time-range.
----End
Verifying the Configuration
● Run the display ospf [
process-id ] migp-routing [
ip-address [
mask |
mask-
length ] ] [ interface
interface-type interface-number ] [ nexthop
nexthop-
address ] command to check the MIGP routing table information.
● Run the display ospf [
process-id ] routing command to check OSPF routing
table information.
● Run the display ospf [
process-id ] brief command to check brief OSPF
information.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 278
5.14 Adjusting OSPF Route Selection
Applicable Environment
To meet various requirements, such as flexible networking or load balancing
optimization on complex networks, you can adjust OSPF parameters.
Pre-configuration Tasks
Before adjusting OSPF route selection, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more configuration tasks (excluding the task of Verifying the OSPF
Route Selection Adjustment Configuration) as required.
5.14.1 Setting a Link Cost for an OSPF Interface
Context
You can manually set a link cost for an OSPF interface or allow OSPF to
automatically calculate the cost according to the interface bandwidth. The
calculation formula is as follows:
Cost of an interface = Bandwidth reference value/Interface bandwidth.
The integer of the calculated result is used as the cost of the interface. If the
calculated result is smaller than 1, the cost value is 1. Changing the bandwidth
reference value can change the cost of an interface. To manually set the link cost
or change the bandwidth reference value and interface bandwidth, perform the
following steps.
Procedure
● Set a link cost for an OSPF interface.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The OSPF interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 279
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run ospf cost
cost
A cost is set for the OSPF interface.
By default, OSPF automatically calculates its cost based on its interface
bandwidth. The default cost of a loopback interface is 0.
● Configure bandwidth-based automatic OSPF interface cost calculation.
The calculation formula is as follows: Cost of the interface = Bandwidth
reference value/Interface bandwidth. The integer of the calculation result is
used as the cost of the interface. If the result is less than 1, the cost is 1.
NOTE
● To use the bandwidth reference value to determine the interface cost, run the
bandwidth-reference command.
● To use the interface bandwidth to determine the interface cost, run the bandwidth
command to set configuration bandwidth for an interface, and then run the
bandwidth-config enable command to enable the device to calculate the cost for
the interface based on the configuration bandwidth of the interface.
● To use both the bandwidth reference value and interface bandwidth to determine
the interface cost, select the preceding configuration.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The OSPF interface view is displayed.
c. (Option) Run bandwidth
bandwidth
Configuration bandwidth is set for the interface.
By default, if no configuration bandwidth is set for an interface, the OSPF
interface cost is calculated based on the physical bandwidth of the
interface.
d. Run quit
Exit from the interface view.
e. Run ospf [
process-id ]
The OSPF process view is displayed.
f. (Option) Run bandwidth-reference
value
A bandwidth reference value is set.
The default bandwidth reference value is 100 Mbit/s.
NOTE
Ensure that the bandwidth reference values of switches in an OSPF process are the
same.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 280
g. (Option) Run bandwidth-config enable
The device is enabled to use the configuration bandwidth of each OSPF
interface to calculate the cost for the interface.
By default, a device is not enabled to calculate the cost of an OSPF
interface based on the configured interface bandwidth.
----End
5.14.2 Configuring Equal-Cost Routes
Context
If the destinations and costs of multiple routes discovered by one routing protocol
are the same, these routes are equal-cost routes and load balancing can be
implemented among them.
For example, in Figure 5-67, three routes between switchA and switchB that run
OSPF have the same costs. The three routes are equal-cost routes for load
balancing.
Figure 5-67 Networking diagram for configuring equal-cost routes
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run maximum load-balancing
number
The maximum number of equal-cost routes is set.
By default, the maximum number of equal-cost routes on the S5720I-SI, S5735-S,
S5735-S-I, S5735S-H, S6720S-S, and S5736-S is 8, and the maximum number of
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 281
equal-cost routes on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-
S, S6730-H, S6730S-H, S6730-S, and S6730S-S is 16.
Step 4 (Optional) Run nexthop
ip-address weight
value
The route preferences are configured for load balancing.
When the number of equal-cost routes on the live network exceeds the limit
specified in the maximum load-balancing command, valid routes are randomly
selected for load balancing. To specify valid routes for load balancing, you can run
the nexthop command to set the route preferences of the routes to higher values.
A smaller value of weight indicates a higher route preference. The default value
of weight is 255, which indicates that load balancing is implemented regardless of
the route preferences.
----End
5.14.3 Configuring a Route Selection Rule
Context
RFC 2328 and RFC 1583 define route selection rules differently. After OSPF is
enabled on a switch, you need to specify a route selection rule based on the
switch configuration. By default, a switch complies with the route selection rule
defined in RFC 1583. If the neighboring switch complies with the route selection
rule defined in RFC 2328, you need to configure the local switch to comply with
that defined in RFC 2328. This allows all switches in an OSPF area to comply with
the same route selection rule.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run undo rfc1583 compatible
The switch is configured to comply with the route selection rule defined in RFC
2328, instead of RFC 1583.
By default, the switch complies with the route selection rule defined in RFC 1583.
----End
5.14.4 Verifying the OSPF Route Selection Adjustment
Configuration
Prerequisites
All configurations of adjusting OSPF route selection are complete.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 282
Procedure
● Run the display ospf [
process-id ] interface command to check OSPF
interface information.
● Run the display ospf [
process-id ] routing command to check OSPF routing
table information.
----End
5.15 Controlling OSPF Routing Information
Pre-configuration Tasks
Before controlling OSPF routing information, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more of the following configuration tasks (excluding the task of
Verifying the OSPF Route Control Configuration) as required.
5.15.1 Configuring OSPF to Import External Routes
Context
To communicate with a switch running a protocol other than OSPF, an OSPF-
capable switch must import routes of this protocol into the OSPF network.
OSPF can ensure loop-free intra-area and inter-area routes; however, OSPF cannot
prevent external route loops. Therefore, exercise caution to prevent loops caused
by manual configurations when importing external routes to OSPF.
Perform the following steps on the switch functioning as an ASBR running OSPF.
Procedure
● Configure OSPF to import the routes discovered by other protocols.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run import-route { limit
limit-number | { bgp [ permit-ibgp ] | direct |
unr | rip [
process-id-rip ] | static | isis [
process-id-isis ] | ospf [
process-
id-ospf ] } [ cost
cost | type
type | tag
tag | route-policy
route-policy-
name ] * }
The switch is configured to import routes discovered by other protocols.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 283
NOTE
Only the S5720I-SI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, S5731-H,
S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support the bgp [ permit-ibgp ] and isis [
process-id-
isis ] parameters.
● Set parameters for OSPF to import routes.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run default { cost {
cost-value | inherit-metric } | limit
limit | tag
tag |
type
type } *
The parameters (route cost, tag, and type) for route import are set to the
default values.
The tag parameter is used to identify protocol-related information. For
example, it can differentiate AS numbers carried in BGP routes imported
by OSPF.
By default, the cost of the external routes imported by OSPF is 1, the type
of the imported external routes is Type 2, and the tag value of the
imported routes is 1.
NOTE
To set a cost for an imported route, run one of the following commands (listed in
descending order of priority).
● apply cost
● import-route
● default (default cost)
----End
5.15.2 Configuring OSPF to Advertise Default Routes to an
OSPF Area
Context
On an OSPF network, multiple switches often reside on the area border and AS
border for next-hop backup or traffic load balancing. To reduce routing entries and
improve resource usage on the OSPF network, you can configure a default route in
the following scenarios:
1. An ABR advertises a Type 3 LSA carrying a default route for instructing
switches to forward inter-area packets.
2. An ASBR advertises a Type 5 or Type 7 LSA carrying a default route for
instructing switches to forward AS external packets.
When no matching route is discovered, the switch can forward packets through a
default route.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 284
The preference of a default route in Type 3 LSAs is higher than that of the route in
Type 5 or Type 7 LSAs.
Advertisement of a default route is determined by the type of the area to which
the default route needs to be imported. Table 5-21 lists the default route
advertisement by area type.
Table 5-21 Default route advertising mode
Area
Type
Generated By Advertise
d By
LSA Type Flood
ing
Area
Common
area
A default route is generated using
the default-route-advertise
command.
ASBR Type 5 LSA Com
mon
area
Stub area A default route is generated
automatically.
ABR Type 3 LSA Stub
area
NSSA A default route is generated using
the nssa [ default-route-
advertise ] command.
ASBR Type 7 LSA NSSA
Totally
NSSA
A default route is generated
automatically.
ABR Type 3 LSA NSSA
Perform the following steps on an ASBR running OSPF.
Procedure
● Configure OSPF to advertise a default route to an OSPF area.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run default-route-advertise [ [ always | permit-calculate-other ] | cost
cost | type
type | route-policy
route-policy-name [ match-any ] ] *
OSPF is configured to advertise a default route to the OSPF area.
▪ The parameter always indicates that an LSA describing a default
route is generated and then advertised regardless of whether there
are active default routes of other OSPF processes in the routing table
of the local device.
▪ The parameter permit-calculate-other indicates that the local
router is allowed to calculate the default routes advertised by other
switches after adverting its own default route.
▪ The parameter route-policy
route-policy-name indicates that the
local device advertises default routes according to the parameters of
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 285
the configured routing policy when there are matched default
routing entries generated by other OSPF processes.
NOTE
● An ASE LSA describing a default route is generated and then advertised only
when there is an active default route of another OSPF process in the routing
table of the local device.
● Before advertising default routes, OSPF compares the preferences of default
routes. Therefore, if a static default route is configured on an OSPF switch,
the default route advertised by OSPF can be added to the current routing
table only when it has a higher preference than the static route.
----End
5.15.3 Configuring OSPF Route Summarization
Context
Route summarization on a large-scale OSPF network reduces the number of
routing entries. This function minimizes system resource consumption while
maintaining system performance. In addition, if a link frequently alternates
between Up and Down, the links not involved in route summarization are not
affected. This prevents route flapping and improves network stability.
OSPF supports two types of route summarization:
● Inter-area route summarization
Inter-area route summarization is performed on ABRs and applies to routes
from within an AS. An ABR generates Network-summary (Type 3) LSAs by
network segment while advertising routing information to other areas. If
network segments are contiguous, the ABR can summarize them into a single
segment. This allows the ABR to send only the summary LSA for all the
specified network segments.
● External route summarization
External route summarization is performed on ASBRs and is specific to
external routes that are imported into OSPF. ASBRs can summarize imported
AS-external (Type 5) LSAs within a summary address range. After an NSSA is
configured, an ASBR must summarize imported NSSA (Type 7) LSAs with the
summary address range.
Devices that are both ABRs and ASBRs summarize the Type 5 LSAs translated
from Type 7 LSAs.
Perform the following steps on a switch running OSPF.
Procedure
● Configure inter-area route summarization on an ABR.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 286
c. Run area
area-id
The OSPF area view is displayed.
d. Run abr-summary
ip-address mask [ [ cost {
cost | inherit-minimum } |
[ advertise [ generate-null0-route ] | not-advertise | generate-null0-
route [ advertise ] ] ] * ]
ABR route summarization is configured.
● Configure external route summarization on an ASBR.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. (Optional) Run asbr-summary type nssa-trans-type-reference [ cost
nssa-trans-cost-reference ]
OSPF is configured to consider Type 5 LSAs translated from Type 7 LSAs
when setting types and costs for summarized routes.
By default, OSPF does not consider Type 5 LSAs translated from Type 7
LSAs when setting types and costs for summarized routes.
d. Run asbr-summary
ip-address mask [ not-advertise | tag
tag | cost
cost
| distribute-delay
interval ] *
ASBR route summarization is configured.
NOTE
After route summarization is configured, the routing table on the local OSPF
switch remains unchanged, but the routing table on a neighboring OSPF switch
contains only one summarized route. This summarized route is removed only
when all specific routes involved in the summarization are interrupted.
----End
5.15.4 Configuring OSPF to Filter Received Routes
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name [ secondary ] } import
OSPF is configured to filter received routes.
● The parameter
acl-number specifies the number of a basic ACL.
● The parameter acl-name
acl-name specifies the name of an ACL.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 287
● The parameter ip-prefix
ip-prefix-name specifies the name of an IP prefix list.
The filter-policy import command is used to filter the routes calculated by OSPF
but cannot be used to filter advertised or received LSAs. Only the routes that pass
the filtering criteria are added to the routing table. Routes that do not pass the
filtering criteria can still be advertised.
----End
5.15.5 Configuring OSPF to Filter the Routes to Be Advertised
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name } export [
protocol [
process-id ] ]
OSPF is configured to filter the routes imported using the import-route
command. Only the routes that pass the filtering criteria are advertised.
● The parameter
acl-number specifies the number of a basic ACL.
● The parameter acl-name
acl-name specifies the name of an ACL.
● The parameter ip-prefix
ip-prefix-name specifies the name of an IP prefix list.
● The parameter route-policy
route-policy-name specifies the name of a
routing policy.
To filter the routes of a specific routing protocol or process, specify the parameter
protocol [
process-id ]. If this parameter is not specified, OSPF filters all the
imported routes.
NOTE
● The import-route command cannot be used to import external default routes.
● Only for the external routes passing the filtering criteria, OSPF generates Type 5 LSAs to
advertise the routes.
----End
5.15.6 Configuring a Switch to Filter LSAs to Be Sent
Context
When multiple links exist between two switches, you can configure the local
switch to filter the LSAs to be sent over certain links. This prevents unnecessary
retransmission of LSAs and saves bandwidth resources.
Perform the following steps on a switch running OSPF.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 288
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf filter-lsa-out { all | { summary [ acl {
acl-number |
acl-name } ] | ase
[ acl {
acl-number |
acl-name } ] | nssa [ acl {
acl-number |
acl-name } ] } * }
The switch is configured to filter the LSAs to be sent.
By default, a switch does not filter the LSAs to be sent.
----End
5.15.7 Configuring OSPF to Filter ABR Type3 LSAs
Context
After filtering criteria are set for the incoming or outgoing Type 3 LSAs (Summary
LSAs) in an area, only the Type 3 LSAs that pass the filtering criteria can be
received or advertised.
This function applies only to ABRs.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Configure OSPF to filter incoming or outgoing Type 3 LSAs generated by ABRs as
required.
● Run filter {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name } export
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 289
OSPF is configured to filter Type 3 LSAs leaving the local area.
● Run filter {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name } import
OSPF is configured to filter Type 3 LSAs entering the local area.
----End
5.15.8 (Optional) Enabling the Mesh-Group Function
Context
To reduce the load on concurrent links between two switches, you can enable the
mesh-group function.
A neighboring router ID uniquely identifies a mesh group. A mesh group contains
several concurrent links, and flooding is implemented only once after the group is
created. Interfaces can be added to the same mesh group only when the following
conditions are met:
● The interfaces belong to the same area and OSPF process.
● The status of the interfaces is higher than Exchange.
● The interfaces connect to the same neighboring switch.
Perform the following steps on a switch running OSPF.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run mesh-group enable
The mesh-group function is enabled.
By default, the mesh-group function is disabled.
----End
5.15.9 Setting the Maximum Number of External LSAs in the
LSDB
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 290
Step 3 Run lsdb-overflow-limit
number
The maximum number of external LSAs in the LSDB is set.
----End
5.15.10 Verifying the OSPF Route Control Configuration
Prerequisites
All configurations of controlling OSPF routing information are complete.
Procedure
● Run either of the following commands to check OSPF routing table
information:
– display ospf [
process-id ] routing [
ip-address [
mask |
mask-length ] ]
[ interface
interface-type interface-number ] [ nexthop
nexthop-
address ]
– display ospf [
process-id ] routing router-id [
router-id ]
● Run the display ospf [
process-id ] interface [ all |
interface-type interface-
number ] [ verbose ] command to check OSPF interface information.
● Run the display ospf [
process-id ] asbr-summary [
ip-address mask ]
command to check OSPF ASBR summarization information.
----End
5.16 Configuring BFD for OSPF
Applicable Environment
Fault detection via Hello packets periodically sent to neighboring switches requires
more than 1s. For services such as voice and video, which are sensitive to packet
loss and latency, prolonged fault detection will cause packet loss when traffic is
transmitted at gigabit rates. This detection period cannot meet the high reliability
requirements of carrier-class networks.
BFD for OSPF resolves this problem. After BFD for OSPF is configured in a process
or on an interface, the link status can be rapidly detected. This allows fault
detection to complete in milliseconds, speeding up OSPF convergence.
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support BFD for OSPF.
Pre-configuration Tasks
Before configuring BFD for OSPF, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 291
● Configure basic OSPF functions.
Configuration Procedure
Figure 5-68 Flowchart of configuring BFD for OSPF
5.16.1 Configuring Global BFD
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run bfd
BFD is configured globally, and the global BFD view is displayed.
----End
5.16.2 Configuring BFD for OSPF
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run bfd all-interfaces enable
BFD for OSPF is enabled, and BFD sessions are established.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 292
If all the interfaces in a single process are configured with BFD and their neighbor
relationships are in the Full state, OSPF establishes BFD sessions on all the
interfaces in the process.
Step 4 (Optional) run bfd all-interfaces { min-rx-interval
receive-interval | min-tx-
interval
transmit-interval | detect-multiplier
multiplier-value } *
Parameters are set for the BFD sessions.
● The parameter min-rx-interval
receive-interval specifies the expected
minimum interval for receiving BFD packets from the neighbor.
● The parameter min-tx-interval
transmit-interval specifies the minimum
interval for sending BFD packets to the neighbor.
● The parameter detect-multiplier
multiplier-value specifies the local detection
multiplier.
NOTE
Default values of
receive-interval,
transmit-interval, and
multiplier-value are recommended.
Configure parameters based on the network status and network reliability
requirements. A short interval between BFD packet transmissions can be
configured if high network reliability is required.
NOTE
● Actual interval between BFD packet transmissions on the local switch = Max {value of
transmit-interval configured on the local switch, value of
receive-interval configured on the
neighboring switch }
● Actual interval between BFD packet receipts on the local switch = Max {value of
transmit-
interval configured on the neighboring switch, value of
receive-interval configured on the
local switch }
● Actual BFD packet detection period on the local switch = Actual interval between BFD packet
receipts on the local switch x Value of
multiplier-value configured on the neighboring switch
For example, if:
● On the local switch, the configured interval between BFD packet transmissions is 200 ms; the
configured interval between BFD packet receipts is 300 ms; the detection multiplier is 4.
● On the neighboring switch, the configured interval between BFD packet transmissions is 100
ms; the configured interval between BFD packet receipts is 600 ms; the detection multiplier
is 5.
Then:
● On the local switch, the actual interval between BFD packet transmissions is 600 ms
calculated by using the formula: max {200 ms, 600 ms}; the interval between BFD packet
receipts is 300 ms calculated by using the formula: max {100 ms, 300 ms}; the detection
period is 1500 ms calculated by using the formula: 300 ms x 5.
● On the neighboring switch, the actual interval between BFD packet transmissions is 300 ms
calculated by using the formula: max {100 ms, 300 ms}; the actual interval between BFD
packet receipts is 600 ms calculated by using the formula: max {200 ms, 600 ms}; the
detection period is 2400 ms calculated by using the formula: 600 ms x 4.
----End
5.16.3 (Optional) Preventing an Interface from Dynamically
Setting Up a BFD Session
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 293
Context
After the bfd all-interfaces enable command is run in an OSPF process, BFD
sessions are set up on all the OSPF interfaces under the process whose neighbor
relationships are in Full state. You can prevent an interface from dynamically
setting up a BFD session as required.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The view of the interface enabled with BFD for OSPF is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf bfd block
The interface is prevented from dynamically setting up a BFD session.
----End
5.16.4 (Optional) Configuring BFD on an Interface
Context
To allow a switch to rapidly detect failures occurring on a specific interface, you
can configure BFD for OSPF on the interface. When detecting a failure, the switch
then instructs OSPF to recalculate routes, speeding up OSPF convergence. If the
OSPF neighbor relationship set up on this interface goes Down, the BFD session
between the OSPF neighbors is dynamically deleted.
Before configuring BFD for OSPF on an interface, you need to enable BFD globally.
Perform the following steps on a switch:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 294
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf bfd enable
BFD is enabled on the OSPF interface and a BFD session is set up.
If all the interfaces in a single process are configured with BFD and their neighbor
relationships are in Full state, OSPF creates BFD sessions with default parameter
values on the interfaces with OSPF enabled in the process.
NOTE
The priority of BFD for OSPF configured on an interface is higher than that of BFD for OSPF
configured for a process.
If parameters need to be set for BFD sessions, run the ospf bfd { min-rx-interval
receive-interval | min-tx-interval
transmit- interval | detect-multiplier
multiplier-
value } * command.
Default values of
receive-interval,
transmit-interval, and
multiplier-value are
recommended. That is, the preceding command can be skipped.
The parameters need to be configured based on the network status and network
reliability requirements. A short interval between BFD packet transmissions can be
configured if high network reliability is required.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 295
NOTE
● Actual interval between BFD packet transmissions on the local switch = Max {value of
transmit-interval configured on the local switch, value of
receive-interval configured on the
neighboring switch }
● Actual interval between BFD packet receipts on the local switch = Max {value of
transmit-
interval configured on the neighboring switch, value of
receive-interval configured on the
local switch }
● Actual BFD packet detection period on the local switch = Actual interval between BFD packet
receipts on the local switch x Value of
multiplier-value configured on the neighboring switch
For example, if:
● On the local switch, the configured interval between BFD packet transmissions is 200 ms; the
configured interval between BFD packet receipts is 300 ms; the detection multiplier is 4.
● On the neighboring switch, the configured interval between BFD packet transmissions is 100
ms; the configured interval between BFD packet receipts is 600 ms; the detection multiplier
is 5.
Then:
● On the local switch, the actual interval between BFD packet transmissions is 600 ms
calculated by using the formula: max {200 ms, 600 ms}; the interval between BFD packet
receipts is 300 ms calculated by using the formula: max {100 ms, 300 ms}; the detection
period is 1500 ms calculated by using the formula: 300 ms x 5.
● On the neighboring switch, the actual interval between BFD packet transmissions is 300 ms
calculated by using the formula: max {100 ms, 300 ms}; the actual interval between BFD
packet receipts is 600 ms calculated by using the formula: max {200 ms, 600 ms}; the
detection period is 2400 ms calculated by using the formula: 600 ms x 4.
----End
5.16.5 Verifying the BFD for OSPF Configuration
Prerequisites
All configurations of BFD for OSPF are complete.
Procedure
● Run the following commands to check information about a BFD session or
global BFD sessions:
– display ospf [
process-id ] bfd session
interface-type interface-number
[
router-id ]
– display ospf [
process-id ] bfd session {
router-id | all }
----End
5.17 Configuring OSPF IP FRR
Applicable Environment
With the development of networks, Voice over IP (VoIP) and on-line video services
require high-quality real-time transmission. Nevertheless, if an OSPF fault occurs,
traffic can be switched to a new link only after the following processes: fault
detection at the millisecond level, notifying the fault to the routing control plane
at the millisecond level, generating and flooding new topology information at the
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 296
tens of milliseconds level, triggering SPF calculation at the tens of milliseconds
level, and notifying and installing a new route at the hundreds-of-milliseconds
level. As a result, it takes much more than 50 ms to recovery the link from the
fault, which cannot meet the requirement for real-time services on the network.
With OSPF IP FRR that calculates a backup link in advance, devices can fast switch
traffic to the backup link without interrupting traffic when the primary link
becomes faulty. This protects traffic and therefore greatly improves the reliability
of OSPF networks.
OSPF IP FRR is applicable to the services that are sensitive to packet delay and
packet loss.
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support this function.
5.17.1 Enabling OSPF IP FRR
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id | router-id
router-id | vpn-instance
vpn-instance-name ] *
An OSPF process is started, and the OSPF view is displayed.
Step 3 Run frr
The OSPF IP FRR view is displayed.
Step 4 Run loop-free-alternate
OSPF IP FRR is enabled to generate a loop-free backup link.
By default, this function is disabled. OSPF can generate a loop-free backup link
only when the OSPF IP FRR traffic protection inequality is met.
NOTE
In the following description, Distance_opt(X, Y) indicates the shortest link from node X to
node Y, S stands for a source node, E for the faulty node, N for a node along a backup link,
and D for a destination node.
● Link protection takes effect when the traffic to be protected flows along a
specified link and the link cost meets the inequality: Distance_opt(N, D) <
Distance_opt(N, S) + Distance_opt(S, D).
● Node-and-link protection takes effect when the traffic to be protected flows
along a specified link and passes through a specified node and the following
conditions are met:
– The link cost meets the inequality: Distance_opt(N, D) < Distance_opt(N,
S) + Distance_opt(S, D).
– The interface cost meets the inequality: Distance_opt(N, D) <
Distance_opt(N, E) + Distance_opt(E, D).
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 297
Step 5 (Optional) Run frr-priority static low
The Loop-Free Alternates (LFA) algorithm is configured for calculating the next
hop and outbound interface for a backup link.
The next hop and outbound interface of an OSPF loop-free backup link can be
obtained using either of the following methods:
● Static backup link: After OSPF IP FRR is enabled using the ip frr command in
the system view or VPN instance view, specify a next hop and an outbound
interface for the static backup link.
● Dynamic backup link: After OSPF IP FRR is enabled using the loop-free-
alternate command, configure the device to use the LFA algorithm to
calculate the next hop and outbound interface for the dynamic backup link.
By default, static backup links take preference over dynamic backup links during
route selection. However, static backup links are less flexible than dynamic backup
links. If a link failure occurs, static backup links cannot update automatically, but
dynamic backup links can. Therefore, run the frr-priority static low command to
specify the LFA algorithm for calculating the next hop and outbound interface so
that the dynamic backup links can take preference over static backup links.
Step 6 (Optional) Run frr-policy route route-policy
route-policy-name
An OSPF IP FRR filtering policy is configured.
After an OSPF IP FRR filtering policy is configured, only the OSPF backup routes
that pass the filtering criteria can be delivered to the forwarding table. To protect
the traffic over a specific OSPF route, you can configure a filtering policy that
matches the OSPF route to ensure that the route can be added to the forwarding
table. If this route fails, OSPF can fast switch the traffic to a backup route.
----End
5.17.2 (Optional) Binding OSPF IP FRR and BFD
Context
If OSPF IP FRR is configured, the lower layer needs to fast respond to link changes
so that traffic can be rapidly switched to backup links in the case of a link failure.
You can bind BFD to the link status so that link faults can be detected rapidly. This
ensures that traffic is rapidly switched to the backup link in the case of link
failures.
Binding OSPF IP FRR and BFD can be configured in a specified process or on a
specified interface. The priority of BFD configured on an interface is higher than
that of BFD configured in an OSPF process. If BFD is enabled on an interface, a
BFD session is established according to the BFD parameters set on the interface.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support this function.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 298
Procedure
● Bind OSPF IP FRR and BFD in a specified process.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is globally configured.
c. Run quit
Return to the system view.
d. Run ospf [
process-id | router-id
router-id | vpn-instance
vpn-instance-
name ] *
The OSPF process is enabled, and the OSPF view is displayed.
e. Run bfd all-interfaces enable
BFD is enabled in the OSPF process.
f. Run bfd all-interfaces frr-binding
IP FRR is bound to BFD in an OSPF process.
● Bind OSPF IP FRR and BFD on a specified interface.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is globally configured.
c. Run quit
Return to the system view.
d. Run interface
interface-type interface-number
The interface view is displayed.
e. Run ospf bfd enable
BFD is enabled on the OSPF interface.
f. Run ospf bfd frr-binding
IP FRR is bound to BFD on the OSPF interface.
----End
5.17.3 (Optional) Disabling OSPF IP FRR on an Interface
Context
OSPF IP FRR can be disabled on an interface of a specific device that is running
important services. This prevents the device connected to this interface from
providing a backup link for the local device and therefore being burdened after
FRR switches traffic to the backup link.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 299
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The view of the OSPF IP FRR-enabled interface is displayed.
Step 3 Run ospf frr block
OSPF IP FRR is disabled on the interface.
----End
5.17.4 Verifying the OSPF IP FRR Configuration
Prerequisites
All OSPF IP FRR configurations are complete.
Procedure
● Run the display ospf [
process-id ] routing command to check information
about the primary and backup links after OSPF IP FRR is enabled.
View the routes to the specified OSPF device.
<HUAWEI> display ospf routing 192.168.4.0
OSPF Process 1 with Router ID 192.168.150.11
Destination : 192.168.4.0/24
AdverRouter : 10.4.4.4 Area : 0.0.0.0
Cost : 2 Type : Transit
NextHop : 192.168.2.2 Interface : Vlanif20
Priority : Low Age : 00h00m10s
Backup Nexthop : 192.168.1.2 Backup Interface: Vlanif10
Backup Type : LFA LINK
The preceding information shows that a backup route is generated on the
switch, including information about the backup next hop: Backup NextHop,
Backup Interface, and Backup Type indicating the address, outbound
interface, and type of the backup next hop respectively.
----End
5.18 Configuring OSPF Fast Convergence
Pre-configuration Tasks
Before configuring OSPF fast convergence, complete the following tasks:
● Configure a link layer protocol.
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 300
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more configuration tasks (excluding the task of Verifying the OSPF
Fast Convergence Configuration) as required.
5.18.1 Setting a Convergence Priority for OSPF Routes
Context
A network may bear many different services, such as data, voice, and video. These
services have different requirements for the network.
To ensure that OSPF routes converge preferentially, you can configure convergency
priorities for these routes. This shortens the interruption of key services and
improves the reliability of the entire network.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run prefix-priority { critical | high | medium } ip-prefix
ip-prefix-name
A convergence priority is set for OSPF routes.
OSPF then calculates and floods LSAs and synchronizes LSDBs according to the
priority. This speeds up route convergence. When an LSA meets multiple priorities,
the highest priority takes effect. OSPF calculates routes in the sequence of intra-
area routes, inter-area routes, and AS external routes. This command specifies the
OSPF route convergence priorities. Convergence priorities include critical, high,
medium, and low in descending order. During LSA flooding, LSAs are placed into
the corresponding critical, high, medium, and low queues according to priorities,
which speeds up the processing of high-priority LSAs.
NOTE
This command takes effect only on the public network.
----End
5.18.2 Setting an Interval for Sending Hello Packets
Context
OSPF interfaces periodically send Hello packets to establish and maintain neighbor
relationships. The sending interval must be the same between any two neighbors.
Otherwise, OSPF neighbor relationships cannot be established.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 301
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf timer hello
interval [ conservative ]
An interval at which the OSPF interface sends Hello packets is set.
By default, the interval is 10s on a P2P or broadcast interface, and 30s on a P2MP
or NBMA interface. The dead time after which an OSPF neighbor relationship
expires on an interface is four times the interval for sending Hello packets on the
interface.
----End
5.18.3 Setting a Dead Time for a Neighbor Relationship
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf timer dead
interval
A dead time after which the neighbor relationship expires between two switches is
set.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 302
By default, the dead time is 40s on a P2P or broadcast interface, and 120s on a
P2MP or NBMA interface. The dead time is four times the interval for sending
Hello packets on the same interface.
NOTE
A dead time longer than 20s is recommended. If the dead time is shorter than 20s, the
OSPF neighbor relationship may be disconnected unexpectedly.
Both the Hello timer (interval for sending Hello packets) and the Dead timer (interval after
which a neighbor relationship expires) are restored to their default values upon a change of
the network type.
----End
5.18.4 Configuring Smart-discover
Context
If the neighbor status of a switch changes or the DR/BDR on a multi-access
network (broadcast or NBMA network) changes before Smart-discover is
configured, the switch does not send Hello packets to its neighbor until the Hello
timer expires. This slows down the establishment of neighbor relationships
between devices. To resolve this problem, you can configure Smart-discover to
allow the switch to send Hello packets to its neighbor immediately without
waiting for the expiration of the Hello timer.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf smart-discover
Smart-discover is configured on the interface.
----End
5.18.5 Setting an Interval for Updating LSAs
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 303
Context
OSPF stipulates that LSAs are updated at an interval of 5s to prevent network
connections or frequent route flapping from consuming excessive network
bandwidth or device resources.
On a stable network where routes need to converge fast, you can set the LSA
update interval to 0s so that the topology or route changes can be immediately
advertised over the network through LSAs, thereby speeding up route
convergence.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run lsa-originate-interval { 0 | { intelligent-timer
max-interval start-interval
hold-interval | other-type
interval } * }
An interval for updating LSAs is set.
● The parameter intelligent-timer indicates that an intelligent timer is used to
set the interval for updating Router-LSAs and Network-LSAs.
● The parameter
max-interval specifies the maximum interval for updating
LSAs, in milliseconds.
● The parameter
start-interval specifies the initial interval for updating LSAs, in
milliseconds.
● The parameter
hold-interval specifies the hold interval for updating LSAs, in
milliseconds.
● The parameter other-type
interval indicates an interval for updating LSAs
other than Router-LSAs and Network-LSAs.
By default, an intelligent timer is enabled. After an intelligent timer is enabled, the
default maximum interval for updating LSAs is 5000 ms, the default initial interval
is 500 ms, and the default hold interval is 1000 ms. The mechanism of the
intelligent timer is as follows:
1. The initial interval for updating LSAs is specified by
start-interval.
2. The interval for the
nth (
n ≥ 2) LSA update is equal to
hold-interval x 2(n-2).
3. When the interval specified by
hold-interval x 2(n-2) reaches the maximum
interval specified by
max-interval, the maximum interval is used for the
subsequent three LSA updates. Then, OSPF goes back to step Step 3.1 and
updates LSAs at the initial interval specified by
start-interval.
----End
5.18.6 Setting an Interval for Receiving LSAs
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 304
Context
OSPF stipulates that LSAs are received at an interval of 1s to prevent network
connections or frequent route flapping from consuming excessive network
bandwidth or device resources.
On a stable network where routes need to converge fast, you can set the LSA
receipt interval to 0s so that the topology or route changes can be immediately
advertised over the network through LSAs, thereby speeding up route
convergence.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run lsa-arrival-interval {
interval | intelligent-timer
max-interval start-interval
hold-interval }
The interval for receiving LSAs is set.
● The parameter
interval specifies the interval for receiving LSAs, in
milliseconds.
● The parameter intelligent-timer indicates that an intelligent timer is used to
set the interval for receiving Router-LSAs and Network-LSAs.
● The parameter
max-interval specifies the maximum interval for receiving
LSAs, in milliseconds.
● The parameter
start-interval specifies the initial interval for receiving LSAs, in
milliseconds.
● The parameter
hold-interval specifies the hold interval for receiving LSAs, in
milliseconds.
By default, an intelligent timer is enabled. After an intelligent timer is enabled, the
default maximum interval for receiving LSAs is 1000 ms, the default initial interval
is 500 ms, and the default hold interval is 500 ms. The mechanism of the
intelligent timer is as follows:
1. The initial interval for receiving LSAs is specified by
start-interval.
2. The interval for the
nth (
n ≥ 2) LSA receipt is equal to
hold-interval x 2(n-2).
3. When the interval specified by
hold-interval x 2(n-2) reaches the maximum
interval specified by
max-interval, the maximum interval is used for the
subsequent three LSA receipts. Then, OSPF goes back to step Step 3.1 and
receives LSAs at the initial interval specified by
start-interval.
----End
5.18.7 Setting an Interval for SPF Calculations
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 305
Context
When an OSPF LSDB changes, shortest paths must be recalculated. If a network
changes frequently, shortest paths are recalculated frequently, heavily consuming
system resources and degrading the network performance. To prevent this
problem, you can configure an intelligent timer to set a proper interval for SPF
calculations.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run spf-schedule-interval {
interval1 | intelligent-timer
max-interval start-
interval hold-interval | millisecond
interval2 }
The interval for SPF calculations is set.
● The parameter
interval1 specifies the interval for SPF calculations, in seconds.
● The parameter intelligent-timer indicates that an intelligent timer is used to
set the interval for SPF calculations.
● The parameter
max-interval specifies the maximum interval for SPF
calculations, in milliseconds.
● The parameter
start-interval specifies the initial interval for SPF calculations,
in milliseconds.
● The parameter
hold-interval specifies the hold interval for SPF calculations, in
milliseconds.
● The parameter millisecond
interval2 specifies the interval for SPF
calculations, in milliseconds.
By default, an intelligent timer is enabled. After an intelligent timer is enabled, the
default maximum interval for the SPF calculation is 10000 ms, the initial interval is
500 ms, and the hold interval is 1000 ms. The mechanism of the intelligent timer
is as follows:
1. The initial interval for SPF calculations is specified by
start-interval.
2. The interval for the
nth (
n ≥ 2) SPF calculation is equal to
hold-interval x
2(n-2).
3. When the interval specified by
hold-interval x 2(n-2) reaches the maximum
interval specified by
max-interval, the maximum interval is used for the
subsequent three SPF calculations. Then, OSPF goes back to step Step 3.1 and
performs the SPF calculation at the initial interval specified by
start-interval.
----End
5.18.8 Verifying the OSPF Fast Convergence Configuration
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 306
Prerequisites
All configurations of OSPF fast convergence are complete.
Procedure
● Run the display ospf [
process-id ] brief command to check OSPF brief
information.
----End
5.19 Configuring OSPF GR
Applicable Environment
To avoid traffic interruption and route flapping caused by active/standby
switchovers, you can enable OSPF GR.
After an OSPF process is restarted using GR, the Restarter and the Helper
reestablish a neighbor relationship, exchange routing information, synchronize
their LSDBs, and update their routing tables and forwarding tables. These
operations ensure fast OSPF convergence and network topology stability.
NOTE
Where possible, to prevent service forwarding from being affected by faults on an active
control board, you can configure OSPF GR when dual control boards are deployed.
Pre-configuration Tasks
Before configuring OSPF GR, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring switches are
reachable at the network layer.
● Configure basic OSPF functions.
5.19.1 Enabling the Opaque-LSA Capability of OSPF
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run opaque-capability enable
The opaque-LSA capability is enabled.
The opaque-LSA capability must be enabled because OSPF uses Type 9 LSAs to
support GR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 307
Step 4 Run graceful-restart
The OSPF GR feature is enabled.
----End
5.19.2 (Optional) Configuring GR Session Parameters on the
Restarter
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run graceful-restart [ period
period | planned-only | partial ] *
GR session parameters are set on the Restarter.
● The parameter period indicates the GR period on the Restarter. By default,
the GR period is 120 seconds.
● The parameter planned-only indicates that the Restarter supports only
planned GR. By default, the Restarter supports both planned GR and
unplanned GR.
● The parameter partial indicates that the Restarter supports only partial GR.
By default, the Restarter supports totally GR.
----End
5.19.3 (Optional) Configuring GR Session Parameters on the
Helper
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run graceful-restart helper-role { [ { ip-prefix
ip-prefix-name | acl-number
acl-
number | acl-name
acl-name } | ignore-external-lsa | planned-only ] * | never }
GR session parameters are set on the Helper.
● The parameters
ip-prefix,
acl-number, and
acl-name are used to configure a
filtering policy. A switch enters the Helper mode only when it passes the
filtering criteria in the policy.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 308
● The parameter ignore-external-lsa indicates that the Helper does not check
AS-external LSAs. By default, the Helper checks AS-external LSAs.
● The parameter planned-only indicates that the Helper supports only planned
GR. By default, the Helper supports both planned GR and unplanned GR.
● The parameter never indicates that the switch never enters the Helper mode.
----End
5.19.4 Verifying the OSPF GR Configuration
Prerequisites
All configurations of OSPF GR are complete.
Procedure
● Run the display ospf [
process-id ] graceful-restart [ verbose ] command to
check information about OSPF GR.
----End
5.20 Improving Stability of an OSPF Network
Applicable Environment
To reduce device load and improve network performance, you can configure OSPF
timers to reduce the number of unnecessary packets on the network.
Pre-configuration Tasks
Before performing operations to improve the stability of an OSPF network,
Configure basic OSPF functions.
Configuration Procedure
Perform one or more of the following configuration tasks (excluding the task of
Verifying the OSPF Network Stability Optimization Configuration) as required.
5.20.1 Setting a Priority for OSPF Routes
Context
A priority can be set for each routing protocol running on a switch. When these
protocols discover the same route, the route discovered by the highest-priority
routing protocol takes effect.
Procedure
Step 1 Run system-view
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 309
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run preference [ ase ] {
preference | route-policy
route-policy-name } *
A priority is set for OSPF routes.
● The parameter ase indicates that a priority is set for AS external routes.
● The parameter
preference specifies the priority of OSPF routes. A smaller
value indicates a higher priority.
● The parameter route-policy
route-policy-name indicates that a routing policy
is used to set a priority for specified routes.
The default priority of OSPF routes is 10. If the parameter ase is specified in the
command, the default priority of AS external routes is 150.
----End
5.20.2 Configuring an LSA Transmission Delay on an Interface
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf trans-delay
interval
A delay after which LSAs can be transmitted is set on the interface.
By default, the delay is 1s.
----End
5.20.3 Configuring an Interval for Retransmitting LSAs
Between Adjacent Switches
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 310
Context
After a switch sends an LSA to its neighboring switch, the switch waits for a
response within an interval. If no response is received within the interval, the
switch retransmits the LSA to the neighboring switch.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf timer retransmit
interval
An interval at which LSAs are retransmitted between adjacent switches is set.
By default, the interval is 5s.
NOTE
Generally, the interval at which LSAs are retransmitted between adjacent switches must be
greater than the round trip time of a packet transmitted between the two switches.
Otherwise, some LSAs are retransmitted unnecessarily.
----End
5.20.4 Configuring a Stub Router
Context
Configuring a switch to function as a stub router ensures an uninterrupted route
on the switch during upgrades and other maintenance operations. This is because
the route cost is set to the maximum value 65535 and therefore the route is no
longer preferentially selected.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 311
The OSPF process view is displayed.
Step 3 Run stub-router [ on-startup [
interval ] ]
The switch is configured as a stub router.
No device functions as a stub router by default.
If a switch is configured as a stub router, it functions as a stub router for 500s by
default.
NOTE
A stub router configured using this command bears no similarity to a switch in a stub area.
----End
5.20.5 Prohibiting an OSPF Interface from Sending and
Receiving Protocol Packets
Context
To prevent devices on other networks from obtaining local OSPF routing
information and to prevent the local device from receiving the routing update
information advertised by other devices on the same network, you can prohibit an
OSPF interface from sending and receiving protocol packets. Such a configured
interface can continue to advertise its direct routes; however, Hello packets will be
blocked. This ensures that no neighbor relationship can be set up through the
interface, which enhances OSPF networking capabilities and reduces network
resource consumption.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run silent-interface { all |
interface-type interface-number }
An OSPF interface is prohibited from sending and receiving protocol packets.
By default, an interface is allowed to send and receive protocol packets.
You can prohibit an interface from sending and receiving OSPF packets in different
OSPF processes, but the silent-interface command is valid only for the OSPF
interface in the current process.
----End
5.20.6 Disabling the Function of Triggering Active/Standby
Board Switchover upon Abnormal OSPF LSA Aging
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 312
Context
If the local device clock is faster than usual and the aging timer expires
abnormally, the local device will clear all Router LSAs from the neighboring device,
causing route flapping and service interruptions. To resolve this issue, a device
automatically triggers active/standby switchover upon abnormal OSPF LSA aging.
Active/standby board switchover is triggered to restore network connections and
service traffic when the following condition is met:
(Number of incorrectly cleared Router LSAs/Total number of Router LSAs) x 100%
≥ 80% (Router LSAs here are those sent by the neighboring device to the local
device.)
To disable the function of triggering active/standby board switchover upon
abnormal OSPF LSA aging, run the ospf maxage-lsa auto-protect disable
command.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf maxage-lsa auto-protect disable
The function of triggering active/standby board switchover upon abnormal OSPF
LSA aging is disabled.
By default, this function is enabled.
----End
5.20.7 Verifying the OSPF Network Stability Optimization
Configuration
Prerequisites
All configurations of improving the stability of an OSPF network are complete.
Procedure
● Run the display ospf [
process-id ] brief command to check OSPF brief
information.
● Run the display ip routing-table command to check IP routing table
information.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 313
5.21 Improving the Security of an OSPF Network
Applicable Environment
On an OSPF network demanding high security, you can configure OSPF
authentication and the Generalized TTL Security Mechanism (GTSM) to improve
the security of the OSPF network.
NOTE
GTSM supports only unicast addresses; therefore, in OSPF, GTSM takes effect on virtual links
and sham links.
Pre-configuration Tasks
Before improving the security of an OSPF network, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more of the following configuration tasks (excluding the task of
Verifying the OSPF Network Security Optimization Configuration) as required.
5.21.1 Configuring OSPF GTSM
Context
The Generalized TTL Security Mechanism (GTSM) protects a switch by checking
whether the TTL value in an IP packet header is in a pre-defined range to improve
system security.
To make GTSM take effect, you need to enable GTSM on both ends of an OSPF
connection.
The valid TTL range of packets is [255 -
hops + 1, 255].
GTSM checks the TTL value of only the packets that match the GTSM policy. For
the packets that do not match the GTSM policy, you can configure a default action
to pass or drop them. If the default action is drop, you need to configure GTSM for
all switch connections. If GTSM is not configured for a switch, packets from the
switch are dropped. Therefore, the connection to the switch cannot be established.
This ensures security but reduces the ease of use.
You can enable the log function to record information about dropped packets,
facilitating fault locating.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 314
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf valid-ttl-hops
hops [ nonstandard-multicast ] [ vpn-instance
vpn-
instance-name ]
OSPF GTSM is configured.
NOTE
The ospf valid-ttl-hops command has two functions:
● Enabling OSPF GTSM
● Configuring a valid TTL range of packets
The parameter vpn-instance is valid only for the latter function.
Therefore, if only a private network policy or a public network policy is configured, you are
advised to set the default action to be performed on packets that do not match the GTSM
policy as pass. This prevents the OSPF packets of other instances from being discarded
incorrectly.
Step 3 (Optional) Run gtsm default-action { drop | pass }
The default action to be performed on packets that do not match the GTSM policy
is set.
By default, the action is pass.
NOTE
If the default action is configured but no GTSM policy is configured, GTSM does not take
effect.
Step 4 (Optional) Run gtsm log drop-packet all
The log function is enabled on the device in the system view. The information
about the packets dropped by GTSM will be recorded in the log.
----End
5.21.2 Configuring an Area Authentication Mode
Context
In area authentication, all switches in an area must use the same area
authentication mode and password. For example, all switches in Area 0 are
configured to use the simple authentication mode and a password of abc.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 315
NOTICE
If plain is selected in the area authentication configuration, the password is stored
in plaintext in the configuration file. For security purposes, you are advised to
select cipher to store the password in ciphertext.
Simple authentication, MD5 authentication, and HMAC-MD5 ciphertext
authentication have potential security risks. HMAC-SHA256 ciphertext
authentication is recommended.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Run any of the following commands to configure an authentication mode for the
OSPF area as required:
● Run authentication-mode simple [ plain
plain-text | [ cipher ]
cipher-text ]
Simple authentication is configured for the OSPF area.
– plain: indicates that the password is stored in plaintext.
– cipher: indicates that the password is stored in ciphertext. For MD5
authentication or HMAC-MD5 authentication, the password is stored in
ciphertext by default.
● Run authentication-mode { md5 | hmac-md5 | hmac-sha256 } [
key-id
{ plain
plain-text | [ cipher ]
cipher-text } ]
An authentication mode is configured for the OSPF area.
– md5: indicates that MD5 ciphertext authentication is used.
– hmac-md5: indicates that HMAC-MD5 ciphertext authentication is used.
– hmac-sha256: indicates that HMAC-SHA256 ciphertext authentication is
used.
–
key-id: specifies the authentication key ID in ciphertext authentication.
● Run authentication-mode keychain
keychain-name
Keychain authentication is configured for the OSPF area.
NOTE
Before using Keychain authentication, you need to configure Keychain information in
the system view. To enable switches to successfully establish an OSPF neighbor
relationship, ensure that key-id, algorithm, and key-string in the local ActiveSendKey
are the same as those in the remote ActiveRecvKey.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support keychain
keychain-name.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 316
5.21.3 Configuring an Interface Authentication Mode
Context
Interface authentication, using an authentication mode and a password, is
performed among neighboring switches. The priority of interface authentication is
higher than that of area authentication.
NOTICE
If plain is selected in the interface authentication configuration, the password is
stored in plaintext in the configuration file. For security purposes, you are advised
to select cipher to store the password in ciphertext.
Simple authentication, MD5 authentication, and HMAC-MD5 ciphertext
authentication have potential security risks. HMAC-SHA256 ciphertext
authentication is recommended.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run any of the following commands to configure an authentication mode or null
authentication on an interface as required:
● Run ospf authentication-mode simple [ plain
plain-text | [ cipher ]
cipher-
text ]
Simple authentication is configured for the OSPF interface.
– simple: indicates that simple authentication is used.
– plain: indicates that the password is stored in plaintext.
– cipher: indicates that the password is stored in ciphertext. For MD5
authentication or HMAC-MD5 authentication, the password is stored in
ciphertext by default.
● Run ospf authentication-mode { md5 | hmac-md5 | hmac-sha256 } [
key-id
{ plain
plain-text | [ cipher ]
cipher-text } ]
An authentication mode is configured for the OSPF interface.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 317
– md5: indicates that MD5 ciphertext authentication is used.
– hmac-md5: indicates that HMAC-MD5 ciphertext authentication is used.
– hmac-sha256: indicates that HMAC-SHA256 ciphertext authentication is
used.
● Run ospf authentication-mode null
Null authentication is configured on the OSPF interface.
● Run ospf authentication-mode keychain
keychain-name
Keychain authentication is configured for the OSPF interface.
NOTE
Before using Keychain authentication, configure Keychain information in the system
view. To enable switches to successfully establish an OSPF neighbor relationship,
ensure that key-id, algorithm, and key-string in the local ActiveSendKey are the
same as those in the remote ActiveRecvKey.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support keychain
keychain-name.
----End
5.21.4 Verifying the OSPF Network Security Optimization
Configuration
Prerequisites
The configurations for improving security of an OSPF network are complete.
Procedure
● Run the display gtsm statistics {
slot-id | all } command to check the GTSM
statistics.
● Run the display ospf [
process-id ] request-queue [
interface-type interface-
number ] [
neighbor-id ] command to check the OSPF request queue.
● Run the display ospf [
process-id ] retrans-queue [
interface-type interface-
number ] [
neighbor-id ] command to check the OSPF retransmission queue.
● Run the display ospf [
process-id ] error [ lsa ] command to check OSPF
error information.
----End
5.22 Configuring OSPF Neighbor Relationship Flapping
Suppression
Applicable Environment
If an interface carrying OSPF services frequently alternates between Up and Down,
the OSPF neighbor relationship flaps on the interface. In this case, OSPF frequently
sends Hello packets to reestablish the neighbor relationship, synchronizes LSDBs,
and recalculates routes. In this process, a large number of packets are exchanged,
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 318
adversely affecting stability of existing neighbor relationships, OSPF services, and
other OSPF-dependent services, such as LDP and BGP. To address this problem,
OSPF implements suppression of neighbor relationship flapping to delay OSPF
neighbor relationship reestablishment or prevent service traffic from passing
through flapping links.
NOTE
The following steps are optional.
Pre-configuration Tasks
Before configuring OSPF neighbor relationship flapping suppression, complete the
following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● 5.8 Configuring Basic OSPF Functions
Procedure
Step 1 Run system-view
The system view is displayed.
By default, suppression of OSPF neighbor relationship flapping is enabled globally.
To disable this function globally, run the suppress-flapping peer disable
command.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
By default, suppression of OSPF neighbor relationship flapping is enabled on all
interfaces in the same OSPF process. To disable this function on an interface, run
the ospf suppress-flapping peer disable command.
Step 3 Run ospf suppress-flapping peer hold-down
interval
The Hold-down mode of flapping suppression is configured, and the suppression
duration is set.
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes
during neighbor relationship establishment in an interface, the interface
prevents the reestablishment of the neighbor relationship, which minimizes
LSDB synchronization attempts and packet exchanges.
● Hold-max-cost mode: If the traffic forwarding path changes frequently, the
interface uses the maximum value 65535 as the cost of the flapping link,
which prevents traffic from passing through the flapping link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode after the Hold-down mode exits.
By default, only the Hold-max-cost mode is enabled.
To disable the Hold-max-cost mode, run the ospf suppress-flapping peer hold-
max-cost disable command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 319
Step 4 Run ospf suppress-flapping peer { detecting-interval
detecting-interval |
threshold
threshold | resume-interval
resume-interval } *
Detection parameters are configured for OSPF neighbor relationship flapping
suppression.
Each OSPF interface with OSPF neighbor relationship flapping suppression
enabled starts a flapping counter. If the interval between two successive status
changes of a neighbor from Full to a non-Full state is shorter than
detecting-
interval, a valid flapping_event is recorded and the flapping_count increments by
1. When the flapping_count reaches or exceeds
threshold, flapping suppression
takes effect. If the interval between two successive status changes of a neighbor
from Full to a non-Full state is longer than
resume-interval, the flapping_count is
reset.
NOTE
The value of
resume-interval must be greater than that of
detecting-interval.
By default, the value of detecting-interval is 60s, the value threshold is 10, and
the value of resume-interval is 120s. Default values of the detection parameters
are recommended.
Step 5 Run quit
The system view is displayed.
Step 6 Run quit
The user view is displayed.
Step 7 Run reset ospf
process-id suppress-flapping peer [
interface-type interface-
number ] [ notify-peer ]
The interface is forced to exit the suppression of OSPF neighbor relationship
flapping.
NOTE
An interface exits flapping suppression in any of the following scenarios:
● The suppression timer expires.
● The corresponding OSPF process is reset.
● Suppression of OSPF neighbor relationship flapping is disabled globally using the
suppress-flapping peer disable command in the OSPF view.
● The reset ospf suppress-flapping peer command is run.
----End
Verifying the Configuration
Run the display ospf [
process-id ] interface
interface-type interface-number
verbose command to check the status of OSPF neighbor relationship flapping
suppression.
<HUAWEI> display ospf interface vlanif 100 verbose
OSPF Process 1 with Router ID 10.1.1.2
Interfaces
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 320
Interface: 10.0.0.2 (VLANIF100)
Cost: 1 State: DR Type: Broadcast MTU: 1500
Priority: 1
Designated Router: 10.0.0.2
Backup Designated Router: 10.0.0.1
Timers: Hello 10 , Dead 40 , Poll 120 , Retransmit 5 , Transmit Delay 1
IO Statistics
Type Input Output
Hello 161367 10436
DB Description 18 18
Link-State Req 5 6
Link-State Update 203780 210
Link-State Ack 90411 276
ALLSPF GROUP
ALLDR GROUP
OpaqueId: 1 PrevState: BDR
Effective cost: 1, enabled by OSPF Protocol.
Suppress flapping peer: enable(flapping-count: 0, threshold: 20)
In the command output, Suppress flapping peer contains the information
indicating that flapping suppression is enabled.
5.23 Suppressing the Advertisement of Interface IP
Addresses
Applicable Environment
This section describes how to suppress the advertisement of interface IP addresses
so that the interface IP addresses can be reused.
Procedure
● Suppress the advertisement of the IP addresses of all interfaces in an OSPF
process.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run suppress-reachability
The advertisement of the IP addresses of all interfaces in the OSPF
process is suppressed.
By default, all interfaces in an OSPF process advertise their IP addresses.
● Suppress the advertisement of the IP addresses of a specified interface.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The OSPF interface view is displayed.
c. Run ospf suppress-reachability
The advertisement of the IP addresses of a specified interface is
suppressed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 321
By default, all OSPF interfaces advertise their IP addresses.
----End
5.24 Configuring Network Management for OSPF
Pre-configuration Tasks
OSPF supports network management. You can bind the OSPF MIB to an OSPF
process and configure the trap and log functions.
Before configuring network management for OSPF, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more configuration tasks (excluding the task of Verifying the OSPF
Network Management Configuration) as required.
5.24.1 Configuring OSPF MIB Binding
Context
In scenarios where multiple OSPF processes are enabled, you can bind the OSPF
MIB to a process.
Perform the following steps on an OSPF switch.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf mib-binding
process-id
The OSPF MIB is bound to a process.
----End
5.24.2 Configuring the OSPF Trap Function
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run snmp-agent trap enable feature-name ospf [ trap-name
{ ospfifauthfailure | ospfifconfigerror | ospfifrxbadpacket | ospfifstatechange |
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 322
ospflsdbapproachingoverflow | ospflsdboverflow | ospfmaxagelsa |
ospfnbrrestarthelperstatuschange | ospfnbrstatechange |
ospfnssatranslatorstatuschange | ospforiginatelsa | ospfrestartstatuschange |
ospftxretransmit | ospfvirtifauthfailure | ospfvirtifconfigerror |
ospfvirtifrxbadpacket | ospfvirtifstatechange | ospfvirtiftxretransmit |
ospfvirtnbrrestarthelperstatuschange | ospfvirtnbrstatechange } ]
The OSPF trap function is enabled.
To enable the trap function for one or more events, you can specify type-name.
----End
5.24.3 Configuring the OSPF Log Function
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run enable log [ config | error | state | snmp-trap ]
The OSPF log function is enabled.
----End
5.24.4 Verifying the OSPF Network Management
Configuration
Prerequisites
The configurations for the network management function of OSPF are complete.
Procedure
● Run the display ospf [
process-id ] brief command to view information about
the binding of OSPF MIBs and OSPF processes.
● Run the display snmp-agent trap feature-name ospf all command to view
all trap messages of the OSPF module.
----End
5.25 Maintaining OSPF
5.25.1 Clearing OSPF Information
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 323
Context
NOTICE
OSPF information cannot be restored after you clear it. Therefore, confirm the
action before you use the commands.
To clear OSPF information, run the following reset commands in the user view.
Procedure
● Run the reset ospf [
process-id ] counters [ neighbor [
interface-type
interface-number ] [
router-id ] ] command to reset OSPF counters.
– counters: indicates OSPF counters.
– neighbor: indicates neighbor information on a specified interface.
● Run the reset ospf [
process-id ] redistribution command in the user view to
re-import routes by OSPF.
● Run the reset gtsm statistics all command to clear the GTSM statistics from
the device.
----End
5.25.2 Resetting OSPF Information
Context
NOTICE
Running the reset ospf command will tear down the OSPF adjacency relationship
between two switches. Therefore, confirm the action before you use the
command.
To reset OSPF connections, run the following command in the user view.
Procedure
● Run the reset ospf [
process-id ] process [ flush-waiting-timer
time |
graceful-restart ] command to restart the OSPF process.
----End
5.26 Configuration Examples for OSPF
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 324
5.26.1 Example for Configuring Basic OSPF Functions
Networking Requirements
As shown in Figure 5-69, three switches on a network need to communicate with
each other, and the entire network needs to be extended based on SwitchA and
SwitchB as the service devices.
Figure 5-69 Networking diagram for configuring basic OSPF functions
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure VLANs for interfaces, VLANIF interfaces for the VLANs, and IP
addresses for each VLANIF interface to implement communication within
network segments.
2. Configure basic OSPF functions on each switch. Configure SwitchA as the ABR
to partition the OSPF network into two areas (Area0 and Area1) so that the
entire OSPF network can be extended using the area where SwitchA and
SwitchB are located as the backbone area.
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 325
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.0.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 192.168.1.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] ospf 1 router-id 10.1.1.1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] area 1
[SwitchA-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.1] return
# Configure SwitchB.
[SwitchB] ospf 1 router-id 10.2.2.2
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] return
# Configure SwitchC.
[SwitchC] ospf 1 router-id 10.3.3.3
[SwitchC-ospf-1] area 1
[SwitchC-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.1] return
Step 4 Verify the configuration.
# Check information about OSPF neighbors on SwitchA.
<SwitchA> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.0.1(Vlanif10)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.0.2
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.0.2 BDR: 192.168.0.1 MTU: 0
Dead timer due in 36 sec
Retrans timer interval: 5
Neighbor is up for 00:15:04
Authentication Sequence: [ 0 ]
Neighbors
Area 0.0.0.1 interface 192.168.1.1(Vlanif20)'s neighbors
Router ID: 10.3.3.3 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.2 BDR: 192.168.1.1 MTU: 0
Dead timer due in 39 sec
Retrans timer interval: 5
Neighbor is up for 00:07:32
Authentication Sequence: [ 0 ]
# Check the OSPF routing information on SwitchC.
<SwitchC> display ospf routing
OSPF Process 1 with Router ID 10.3.3.3
Routing Tables
Routing for Network
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 326
Destination Cost Type NextHop AdvRouter Area
192.168.1.0/24 1 Transit 192.168.1.2 10.3.3.3 0.0.0.1
192.168.0.0/24 2 Inter-area 192.168.1.1 10.1.1.1 0.0.0.1
Total Nets: 2
Intra Area: 1 Inter Area: 1 ASE: 0 NSSA: 0
The preceding command output shows that SwitchC has an inter-area route to the
network segment 192.168.0.0/24.
# Check the routing table on SwitchB, and perform the ping operation on SwitchB
to test the connectivity between SwitchB and SwitchC.
<SwitchB> display ospf routing
OSPF Process 1 with Router ID 10.2.2.2
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
192.168.0.0/24 1 Transit 192.168.0.2 10.2.2.2 0.0.0.0
192.168.1.0/24 2 Inter-area 192.168.0.1 10.1.1.1 0.0.0.0
Total Nets: 2
Intra Area: 1 Inter Area: 1 ASE: 0 NSSA: 0
The preceding command output shows that SwitchB has an inter-area route to the
network segment 192.168.1.0/24.
# Perform the ping operation on SwitchB to test the connectivity between SwitchB
and SwitchC.
<SwitchB> ping 192.168.1.2
PING 192.168.1.2: 56 data bytes, press CTRL_C to break
Reply from 192.168.1.2: bytes=56 Sequence=1 ttl=253 time=62 ms
Reply from 192.168.1.2: bytes=56 Sequence=2 ttl=253 time=16 ms
Reply from 192.168.1.2: bytes=56 Sequence=3 ttl=253 time=62 ms
Reply from 192.168.1.2: bytes=56 Sequence=4 ttl=253 time=94 ms
Reply from 192.168.1.2: bytes=56 Sequence=5 ttl=253 time=63 ms
--- 192.168.1.2 ping statistics ---
5 packet(s) transmitted
5 packet(s) received
0.00% packet loss
round-trip min/avg/max = 16/59/94 ms
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
interface Vlanif10
ip address 192.168.0.1 255.255.255.0
#
interface Vlanif20
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 327
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.1.1.1
area 0.0.0.0
network 192.168.0.0 0.0.0.255
area 0.0.0.1
network 192.168.1.0 0.0.0.255
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.0.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1 router-id 10.2.2.2
area 0.0.0.0
network 192.168.0.0 0.0.0.255
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20
#
interface Vlanif20
ip address 192.168.1.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.3.3.3
area 0.0.0.1
network 192.168.1.0 0.0.0.255
#
return
5.26.2 Example for Configuring OSPF DR Election
Networking Requirements
As shown in Figure 5-70, five switches are deployed with the intermediate Layer 2
switch connecting the other four switches running OSPF. The DR elected by default
among the four switches does not meet the network requirements. SwitchA needs
to be elected as the DR to exchange LSA information with other devices on the
OSPF network, and SwitchC needs to be used as the backup of SwitchA. For other
service demands, SwitchB needs to exchange LSA information with other devices
on the OSPF network through the DR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 328
Figure 5-70 Networking diagram for configuring OSPF DR election
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic OSPF functions on each switch and check the default DR
election result among the four switches.
2. Configure the DR priorities for interfaces on SwitchA, SwitchB, and SwitchC to
100, 0, and 2 respectively. In this way, SwitchA is elected as the DR and
SwitchC as the BDR, SwitchB never becomes the DR or BDR, and SwitchD uses
the default DR priority and remains unchanged.
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of Switch, SwitchB, SwitchC, and SwitchD
are similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 329
[SwitchA] ospf 1 router-id 10.1.1.1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf 1 router-id 10.2.2.2
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf 1 router-id 10.3.3.3
[SwitchC-ospf-1] area 0
[SwitchC-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] quit
[SwitchC-ospf-1] quit
# Configure SwitchD.
[SwitchD] ospf 1 router-id 10.4.4.4
[SwitchD-ospf-1] area 0
[SwitchD-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.0] quit
[SwitchD-ospf-1] quit
[SwitchD] quit
# Check information about OSPF neighbors on SwitchA.
[SwitchA] display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(Vlanif10)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: 2-Way Mode:Nbr is Master Priority: 1
DR: 192.168.1.4 BDR: 192.168.1.3 MTU: 0
Dead timer due in 32 sec
Retrans timer interval: 5
Neighbor is up for 00:04:21
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.4 BDR: 192.168.1.3 MTU: 0
Dead timer due in 37 sec
Retrans timer interval: 5
Neighbor is up for 00:04:06
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.4 BDR: 192.168.1.3 MTU: 0
Dead timer due in 37 sec
Retrans timer interval: 5
Neighbor is up for 00:03:53
Authentication Sequence: [ 0 ]
The preceding command output shows the default DR election result that SwitchD
is the DR and SwitchC is the BDR. When the DR priorities are the same, the device
with a greater router ID is elected as the DR.
Step 4 Set a DR priority for each switch interface.
# Configure SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 330
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ospf dr-priority 100
[SwitchA-Vlanif10] quit
[SwitchA] quit
# Configure SwitchB.
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] ospf dr-priority 0
[SwitchB-Vlanif10] quit
[SwitchB] quit
# Configure SwitchC.
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] ospf dr-priority 2
[SwitchC-Vlanif10] quit
[SwitchC] quit
# Check information about OSPF neighbors on SwitchD.
<SwitchD> display ospf peer
OSPF Process 1 with Router ID 10.4.4.4
Neighbors
Area 0.0.0.0 interface 192.168.1.4(Vlanif10)'s neighbors
Router ID: 10.1.1.1 Address: 192.168.1.1
State: Full Mode:Nbr is Slave Priority: 100
DR: 192.168.1.4 BDR: 192.168.1.3 MTU: 0
Dead timer due in 31 sec
Retrans timer interval: 5
Neighbor is up for 00:11:17
Authentication Sequence: [ 0 ]
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Slave Priority: 0
DR: 192.168.1.4 BDR: 192.168.1.3 MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:11:19
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Slave Priority: 2
DR: 192.168.1.4 BDR: 192.168.1.3 MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:11:15
Authentication Sequence: [ 0 ]
The preceding command output shows that the DR election result among the four
switches remains unchanged. This is because that, even if a newly added device
has the highest DR priority, the device cannot immediately become the DR on the
network segment after the DR and BDR election is complete. DR and BDR election
is performed again only after the OSPF process is restarted.
Step 5 Restart the OSPF process.
# In the user view of each switch, run the reset ospf 1 process command to
restart the OSPF process simultaneously. The simultaneous restart of the OSPF
process enables each switch to participate in elections of the DR and BDR.
# Restart SwitchA.
<SwitchA> reset ospf 1 process
# Restart SwitchB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 331
<SwitchB> reset ospf 1 process
# Restart SwitchC.
<SwitchC> reset ospf 1 process
# Restart SwitchD.
<SwitchD> reset ospf 1 process
Step 6 Verify the configuration.
# Check information about OSPF neighbors on SwitchD.
<SwitchD> display ospf peer
OSPF Process 1 with Router ID 10.4.4.4
Neighbors
Area 0.0.0.0 interface 192.168.1.4(Vlanif10)'s neighbors
Router ID: 10.1.1.1 Address: 192.168.1.1
State: Full Mode:Nbr is Slave Priority: 100
DR: 192.168.1.1 BDR: 192.168.1.3 MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:07:19
Authentication Sequence: [ 0 ]
Router ID: 10.2.2.2 Address: 192.168.1.2
State: 2-Way Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: 192.168.1.3 MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:07:19
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Slave Priority: 2
DR: 192.168.1.1 BDR: 192.168.1.3 MTU: 0
Dead timer due in 37 sec
Retrans timer interval: 5
Neighbor is up for 00:07:17
Authentication Sequence: [ 0 ]
The preceding command output shows that SwitchA is elected as the DR and
SwitchC as the BDR. The neighbor status between SwitchD and SwitchB is 2-Way,
indicating that neither of them is the DR or BDR and they do not exchange LSA
information.
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 10
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 332
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
ospf dr-priority 100
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1 router-id 10.1.1.1
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
ospf dr-priority 0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1 router-id 10.2.2.2
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.1.3 255.255.255.0
ospf dr-priority 2
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1 router-id 10.3.3.3
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 333
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.1.4 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1 router-id 10.4.4.4
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
return
5.26.3 Example for Configuring OSPF Stub Areas
Networking Requirements
As shown in Figure 5-71, OSPF is running among three switches, the entire OSPF
network is partitioned into Area0 and Area1, and SwitchB functions as an ASBR to
communicate with external networks. The size of the OSPF routing table on
SwitchC needs to be reduced, which is expected not to affect the communication.
Figure 5-71 Networking diagram for configuring an OSPF stub area
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic OSPF functions on each switch to implement basic
connections on the OSPF network.
2. Configure static routes on SwitchB and import them to the OSPF routing table
so that there are reachable routes between the OSPF network and external
networks.
3. Configure Area1 as a stub area to reduce the size of the OSPF routing table
on SwitchC.
4. Disable the ABR (SwitchA) from advertising Type 3 LSAs to Area1 (this
configuration indicates that Area 1 is configured as a totally stub area) to
further reduce the size of the OSPF routing table on SwitchC.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 334
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.0.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 192.168.1.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] ospf 1 router-id 10.1.1.1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] area 1
[SwitchA-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.1] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf 1 router-id 10.2.2.2
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf 1 router-id 10.3.3.3
[SwitchC-ospf-1] area 1
[SwitchC-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.1] quit
[SwitchC-ospf-1] quit
Step 4 # Configure SwitchB to import static routes.
[SwitchB] ip route-static 10.0.0.0 8 null 0
[SwitchB] ospf 1
[SwitchB-ospf-1] import-route static type 1
[SwitchB-ospf-1] quit
# Check the OSPF routing table on SwitchC. AS external routes exist in the table.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 335
[SwitchC] display ospf routing
OSPF Process 1 with Router ID 10.3.3.3
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
192.168.1.0/24 1 Transit 192.168.1.2 10.3.3.3 0.0.0.1
192.168.0.0/24 2 Inter-area 192.168.1.1 10.1.1.1 0.0.0.1
Routing for ASEs
Destination Cost Type Tag NextHop AdvRouter
10.0.0.0/8 3 Type1 1 192.168.1.1 10.2.2.2
Total Nets: 3
Intra Area: 1 Inter Area: 1 ASE: 1 NSSA: 0
Step 5 Configure Area1 as a stub area.
# Configure SwitchA.
[SwitchA] ospf 1
[SwitchA-ospf-1] area 1
[SwitchA-ospf-1-area-0.0.0.1] stub
[SwitchA-ospf-1-area-0.0.0.1] quit
[SwitchA-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf 1
[SwitchC-ospf-1] area 1
[SwitchC-ospf-1-area-0.0.0.1] stub
[SwitchC-ospf-1-area-0.0.0.1] quit
[SwitchC-ospf-1] quit
# Check the OSPF routing table on SwitchC. AS external routes do not exist in the
table, but a default route to external networks is added to the table.
[SwitchC] display ospf routing
OSPF Process 1 with Router ID 10.3.3.3
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
192.168.1.0/24 1 Transit 192.168.1.2 10.3.3.3 0.0.0.1
0.0.0.0/0 2 Inter-area 192.168.1.1 10.1.1.1 0.0.0.1
192.168.0.0/24 2 Inter-area 192.168.1.1 10.1.1.1 0.0.0.1
Total Nets: 3
Intra Area: 1 Inter Area: 2 ASE: 0 NSSA: 0
Step 6 Configure Area1 as a totally stub area.
[SwitchA] ospf 1
[SwitchA-ospf-1] area 1
[SwitchA-ospf-1-area-0.0.0.1] stub no-summary
[SwitchA-ospf-1-area-0.0.0.1] quit
[SwitchA-ospf-1] quit
Step 7 Verify the configuration.
# Check the OSPF routing table on SwitchC. The route with the destination
address 192.168.0.0/24 does not exist in the table. Only intra-area OSPF routes
and a default route to external networks exist in the table.
[SwitchC] display ospf routing
OSPF Process 1 with Router ID 10.3.3.3
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 336
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
192.168.1.0/24 1 Transit 192.168.1.2 10.3.3.3 0.0.0.1
0.0.0.0/0 2 Inter-area 192.168.1.1 10.1.1.1 0.0.0.1
Total Nets: 2
Intra Area: 1 Inter Area: 1 ASE: 0 NSSA: 0
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
interface Vlanif10
ip address 192.168.0.1 255.255.255.0
#
interface Vlanif20
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.1.1.1
area 0.0.0.0
network 192.168.0.0 0.0.0.255
area 0.0.0.1
network 192.168.1.0 0.0.0.255
stub no-summary
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.0.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1 router-id 10.2.2.2
import-route static type 1
area 0.0.0.0
network 192.168.0.0 0.0.0.255
#
ip route-static 10.0.0.0 255.0.0.0 NULL0
#
return
● SwitchC configuration file
#
sysname SwitchC
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 337
#
vlan batch 20
#
interface Vlanif20
ip address 192.168.1.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.3.3.3
area 0.0.0.1
network 192.168.1.0 0.0.0.255
stub
#
return
5.26.4 Example for Configuring an OSPF NSSA
Networking Requirements
As shown in Figure 5-72, OSPF is running on four switches, and the entire OSPF
network is partitioned into Area0 and Area1. It is required that devices in Area1 do
not receive external routes imported by other OSPF areas but they import external
routes through the ASBR to communicate with external networks. Because there
are a large number of services configured on SwitchB, SwitchA needs to be
specified as a translator to translate Type7 LSAs to Type5 LSAs and send them to
other OSPF areas.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 5-72 Networking diagram for configuring an OSPF NSSA
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic OSPF functions on each switch to implement basic
connections on the OSPF network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 338
2. Configure Area1 as an NSSA, configure static routes on SwitchD, and import
the static routes to the OSPF routing table. In this way, switches in Area1 can
communicate with external networks only through SwitchD.
3. Configure SwitchA as a translator so that it can translate Type7 LSAs to Type5
LSAs and then send them to other OSPF areas.
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 30
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 30
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 30
[SwitchA-Vlanif30] ip address 192.168.3.1 24
[SwitchA-Vlanif30] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] ospf 1 router-id 10.1.1.1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] area 1
[SwitchA-ospf-1-area-0.0.0.1] network 192.168.3.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.1] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf 1 router-id 10.2.2.2
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] area 1
[SwitchB-ospf-1-area-0.0.0.1] network 192.168.4.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.1] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf 1 router-id 10.3.3.3
[SwitchC-ospf-1] area 0
[SwitchC-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 339
[SwitchC-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] quit
[SwitchC-ospf-1] quit
# Configure SwitchD.
[SwitchD] ospf 1 router-id 10.4.4.4
[SwitchD-ospf-1] area 1
[SwitchD-ospf-1-area-0.0.0.1] network 192.168.3.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.1] network 192.168.4.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.1] quit
[SwitchD-ospf-1] quit
Step 4 Configure Area1 as an NSSA.
# Configure SwitchA.
[SwitchA] ospf 1
[SwitchA-ospf-1] area 1
[SwitchA-ospf-1-area-0.0.0.1] nssa
[SwitchA-ospf-1-area-0.0.0.1] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf 1
[SwitchB-ospf-1] area 1
[SwitchB-ospf-1-area-0.0.0.1] nssa
[SwitchB-ospf-1-area-0.0.0.1] quit
[SwitchB-ospf-1] quit
# Configure SwitchD.
[SwitchD] ospf 1
[SwitchD-ospf-1] area 1
[SwitchD-ospf-1-area-0.0.0.1] nssa
[SwitchD-ospf-1-area-0.0.0.1] quit
[SwitchD-ospf-1] quit
Step 5 Configure SwitchD to import static routes.
[SwitchD] ip route-static 172.16.0.0 16 null 0
[SwitchD] ospf 1
[SwitchD-ospf-1] import-route static
[SwitchD-ospf-1] quit
# Check the OSPF routing table on SwitchC.
[SwitchC] display ospf routing
OSPF Process 1 with Router ID 10.3.3.3
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
192.168.1.0/24 1 Transit 192.168.1.2 10.3.3.3 0.0.0.0
192.168.2.0/24 1 Transit 192.168.2.2 10.3.3.3 0.0.0.0
192.168.3.0/24 2 Inter-area 192.168.1.1 10.1.1.1 0.0.0.0
192.168.4.0/24 2 Inter-area 192.168.2.1 10.2.2.2 0.0.0.0
Routing for ASEs
Destination Cost Type Tag NextHop AdvRouter
172.16.0.0/16 1 Type2 1 192.168.1.1 10.2.2.2
Total Nets: 5
Intra Area: 2 Inter Area: 2 ASE: 1 NSSA: 0
The preceding command output shows that AS external routes imported by the
NSSA are advertised to other areas through SwitchB. That is, SwitchB translates
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 340
Type7 LSAs to Type5 LSAs. This is because that OSPF selects the ABR (SwitchB)
with a greater router ID as the translator.
Step 6 Configure SwitchA as a translator.
[SwitchA] ospf 1
[SwitchA-ospf-1] area 1
[SwitchA-ospf-1-area-0.0.0.1] nssa translator-always
[SwitchA-ospf-1-area-0.0.0.1] quit
[SwitchA-ospf-1] quit
Step 7 Verify the configuration.
# Check the OSPF routing table on SwitchC after 40 seconds.
[SwitchC] display ospf routing
OSPF Process 1 with Router ID 10.3.3.3
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
192.168.1.0/24 1 Transit 192.168.1.2 10.3.3.3 0.0.0.0
192.168.2.0/24 1 Transit 192.168.2.2 10.3.3.3 0.0.0.0
192.168.3.0/24 2 Inter-area 192.168.1.1 10.1.1.1 0.0.0.0
192.168.4.0/24 2 Inter-area 192.168.2.1 10.2.2.2 0.0.0.0
Routing for ASEs
Destination Cost Type Tag NextHop AdvRouter
172.16.0.0/16 1 Type2 1 192.168.1.1 10.1.1.1
Total Nets: 5
Intra Area: 2 Inter Area: 2 ASE: 1 NSSA: 0
The preceding command output shows that AS external routes imported by the
NSSA are advertised to other areas through SwitchA. That is, SwitchA functions as
the translator.
NOTE
By default, both the new and original translators function for 40 seconds. After 40 seconds,
translation is performed by only the new translator.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 30
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface Vlanif30
ip address 192.168.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 341
ospf 1 router-id 10.1.1.1
area 0.0.0.0
network 192.168.1.0 0.0.0.255
area 0.0.0.1
network 192.168.3.0 0.0.0.255
nssa translator-always
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 20 40
#
interface Vlanif20
ip address 192.168.2.1 255.255.255.0
#
interface Vlanif40
ip address 192.168.4.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.2.2.2
area 0.0.0.0
network 192.168.2.0 0.0.0.255
area 0.0.0.1
network 192.168.4.0 0.0.0.255
nssa
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10 20
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif20
ip address 192.168.2.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.3.3.3
area 0.0.0.0
network 192.168.1.0 0.0.0.255
network 192.168.2.0 0.0.0.255
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 30 40
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 342
#
interface Vlanif30
ip address 192.168.3.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.4.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
ospf 1 router-id 10.4.4.4
import-route static
area 0.0.0.1
network 192.168.3.0 0.0.0.255
network 192.168.4.0 0.0.0.255
nssa
#
ip route-static 172.16.0.0 255.255.0.0 NULL0
#
return
5.26.5 Example for Configuring OSPF Load Balancing
Networking Requirements
On an OSPF network, as shown in Figure 5-73, four switches all belong to Area0.
Load balancing needs to be configured so that the traffic from SwitchA can be
sent to SwitchD through SwitchB and SwitchC.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 5-73 Networking diagram for configuring load balancing among OSPF
routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 343
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic OSPF functions on each switch to implement basic
connections on the OSPF network.
2. Configure load balancing on SwitchA.
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20 50
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
[SwitchA] interface gigabitethernet 0/0/3
[SwitchA-GigabitEthernet0/0/3] port link-type trunk
[SwitchA-GigabitEthernet0/0/3] port trunk allow-pass vlan 50
[SwitchA-GigabitEthernet0/0/3] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.1.2.1 24
[SwitchA-Vlanif20] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] ip address 172.16.1.1 24
[SwitchA-Vlanif50] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] ospf 1 router-id 10.10.10.1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 172.16.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] network 10.1.2.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf 1 router-id 10.10.10.2
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 344
# Configure SwitchC.
[SwitchC] ospf 1 router-id 10.10.10.3
[SwitchC-ospf-1] area 0
[SwitchC-ospf-1-area-0.0.0.0] network 10.1.2.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] quit
[SwitchC-ospf-1] quit
# Configure SwitchD.
[SwitchD] ospf 1 router-id 10.10.10.4
[SwitchD-ospf-1] area 0
[SwitchD-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.0] network 172.17.1.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.0] quit
[SwitchD-ospf-1] quit
# Check the routing table on SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 11 Routes : 12
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.1.2.0/24 Direct 0 0 D 10.1.2.1 Vlanif20
10.1.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 Direct 0 0 D 172.16.1.1 Vlanif50
172.16.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif50
172.17.1.0/24 OSPF 10 3 D 10.1.1.2 Vlanif10
OSPF 10 3 D 10.1.2.2 Vlanif20
192.168.0.0/24 OSPF 10 2 D 10.1.1.2 Vlanif10
192.168.1.0/24 OSPF 10 2 D 10.1.2.2 Vlanif20
The preceding command output shows that both next hops of SwitchA, namely,
10.1.1.2 (SwitchB) and 10.1.2.2 (SwitchC), become valid. This is because that the
default quantity of equal-cost routes allowed for a switch is 8.
Step 4 Configure a weight for an equal-cost route on SwitchA.
If you do not want load balancing between SwitchB and SwitchC, set a weight for
one of the equal-cost routes to specify the next hop.
[SwitchA] ospf 1
[SwitchA-ospf-1] nexthop 10.1.2.2 weight 1
[SwitchA-ospf-1] quit
# Check the routing table on SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 11 Routes : 11
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.1.2.0/24 Direct 0 0 D 10.1.2.1 Vlanif20
10.1.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 345
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 Direct 0 0 D 172.16.1.1 Vlanif50
172.16.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif50
172.17.1.0/24 OSPF 10 3 D 10.1.2.2 Vlanif20
192.168.0.0/24 OSPF 10 2 D 10.1.1.2 Vlanif10
192.168.1.0/24 OSPF 10 2 D 10.1.2.2 Vlanif20
The preceding command output shows that the priority of the next hop 10.1.2.2
(SwitchC) with weight 1 is higher than that of 10.1.1.2 (SwitchB). Therefore, OSPF
selects the route with the next hop 10.1.2.2 as the optimal route.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20 50
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
#
interface Vlanif20
ip address 10.1.2.1 255.255.255.0
#
interface Vlanif50
ip address 172.16.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
ospf 1 router-id 10.10.10.1
nexthop 10.1.2.2 weight 1
area 0.0.0.0
network 10.1.1.0 0.0.0.255
network 10.1.2.0 0.0.0.255
network 172.16.1.0 0.0.0.255
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 30
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
#
interface Vlanif30
ip address 192.168.0.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 346
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
ospf 1 router-id 10.10.10.2
area 0.0.0.0
network 10.1.1.0 0.0.0.255
network 192.168.0.0 0.0.0.255
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 40
#
interface Vlanif20
ip address 10.1.2.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
ospf 1 router-id 10.10.10.3
area 0.0.0.0
network 10.1.2.0 0.0.0.255
network 192.168.1.0 0.0.0.255
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 30 40 60
#
interface Vlanif30
ip address 192.168.0.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif60
ip address 172.17.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 60
#
ospf 1 router-id 10.10.10.4
area 0.0.0.0
network 172.17.1.0 0.0.0.255
network 192.168.0.0 0.0.0.255
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 347
network 192.168.1.0 0.0.0.255
#
return
5.26.6 Example for Configuring OSPF-BGP Synchronization
Networking Requirements
As shown in Figure 5-74, an EBGP connection is established between SwitchD and
SwitchE. IBGP connections are established between switches in AS 10, and OSPF is
used as an IGP protocol. OSPF-BGP synchronization needs to be enabled on
SwitchB so that the traffic from SwitchA to AS 20 will not be interrupted when
SwitchB restarts.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 5-74 Networking diagram for configuring OSPF-BGP synchronization
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure VLANs for interfaces, VLANIF interfaces for the VLANs, and IP
addresses for each VLANIF interface to implement communication within
network segments.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 348
2. Configure basic OSPF functions and IBGP connections on SwitchA, SwitchB,
SwitchC, and SwitchD (excluding 10.2.1.1/30) to implement device
connections within AS 10.
3. Configure EBGP connections between SwitchD and SwitchE, and import direct
routes and OSPF routes to implement communication between AS 10 and AS
20.
4. Set the OSPF protocol cost to 2 on SwitchC so that SwitchA selects only
SwitchB as the intermediate router to the network segment 10.2.1.0 and
SwitchC becomes the backup of SwitchB.
5. Enable OSPF-BGP synchronization on SwitchB so that the traffic from SwitchA
to AS 20 will not be interrupted when SwitchB restarts.
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB, SwitchC, SwitchD, and
SwitchE are similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Assign IP addresses to the VLANIF interfaces and loopback interfaces.
# Configure SwitchA. The configurations of SwitchB, SwitchC, SwitchD, and
SwitchE are similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 30
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.1.2.1 30
[SwitchA-Vlanif20] quit
[SwitchA] interface loopback 0
[SwitchA-LoopBack0] ip address 10.10.10.1 32
[SwitchA-LoopBack0] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] router id 10.10.10.1
[SwitchA] ospf 1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 10.10.10.1 0.0.0.0
[SwitchA-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.3
[SwitchA-ospf-1-area-0.0.0.0] network 10.1.2.0 0.0.0.3
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] quit
Step 4 Configure IBGP fully meshed connections.
# Configure SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 349
[SwitchA] bgp 10
[SwitchA-bgp] peer 10.10.10.2 as-number 10
[SwitchA-bgp] peer 10.10.10.2 connect-interface LoopBack 0
[SwitchA-bgp] peer 10.10.10.3 as-number 10
[SwitchA-bgp] peer 10.10.10.3 connect-interface LoopBack 0
[SwitchA-bgp] peer 10.10.10.4 as-number 10
[SwitchA-bgp] peer 10.10.10.4 connect-interface LoopBack 0
[SwitchA-bgp] quit
# Configure SwitchB.
[SwitchB] bgp 10
[SwitchB-bgp] peer 10.10.10.1 as-number 10
[SwitchB-bgp] peer 10.10.10.1 connect-interface LoopBack 0
[SwitchB-bgp] peer 10.10.10.3 as-number 10
[SwitchB-bgp] peer 10.10.10.3 connect-interface LoopBack 0
[SwitchB-bgp] peer 10.10.10.4 as-number 10
[SwitchB-bgp] peer 10.10.10.4 connect-interface LoopBack 0
[SwitchB-bgp] quit
# Configure SwitchC.
[SwitchC] bgp 10
[SwitchC-bgp] peer 10.10.10.1 as-number 10
[SwitchC-bgp] peer 10.10.10.1 connect-interface LoopBack 0
[SwitchC-bgp] peer 10.10.10.2 as-number 10
[SwitchC-bgp] peer 10.10.10.2 connect-interface LoopBack 0
[SwitchC-bgp] peer 10.10.10.4 as-number 10
[SwitchC-bgp] peer 10.10.10.4 connect-interface LoopBack 0
[SwitchC-bgp] quit
# Configure SwitchD.
[SwitchD] bgp 10
[SwitchD-bgp] peer 10.10.10.1 as-number 10
[SwitchD-bgp] peer 10.10.10.1 connect-interface LoopBack 0
[SwitchD-bgp] peer 10.10.10.2 as-number 10
[SwitchD-bgp] peer 10.10.10.2 connect-interface LoopBack 0
[SwitchD-bgp] peer 10.10.10.3 as-number 10
[SwitchD-bgp] peer 10.10.10.3 connect-interface LoopBack 0
[SwitchD-bgp] quit
Step 5 Establish an EBGP connection.
# Configure SwitchD.
[SwitchD] bgp 10
[SwitchD-bgp] peer 10.2.1.2 as-number 20
[SwitchD-bgp] import-route direct
[SwitchD-bgp] import-route ospf 1
[SwitchD-bgp] quit
# Configure SwitchE.
[SwitchE] bgp 20
[SwitchE-bgp] router-id 10.10.10.5
[SwitchE-bgp] peer 10.2.1.1 as-number 10
[SwitchE-bgp] ipv4-family unicast
[SwitchE-bgp-af-ipv4] network 10.3.1.0 30
[SwitchE-bgp-af-ipv4] quit
[SwitchE-bgp] quit
Step 6 Configure a cost for OSPF on SwitchC.
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] ospf cost 2
[SwitchC-Vlanif20] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] ospf cost 2
[SwitchC-Vlanif30] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 350
# Check the routing table on SwitchA. The routing table shows that the route to
the destination network segment 10.3.1.0 is learned through BGP and the
outbound interface is Vlanif10.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 14 Routes : 15
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/30 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.1.2.0/30 Direct 0 0 D 10.1.2.1 Vlanif20
10.1.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.1.3.0/30 OSPF 10 2 D 10.1.1.2 Vlanif10
10.1.4.0/30 OSPF 10 3 D 10.1.2.2 Vlanif20
OSPF 10 3 D 10.1.1.2 Vlanif10
10.2.1.0/30 IBGP 255 0 RD 10.10.10.4 Vlanif10
10.3.1.0/30 IBGP 255 0 RD 10.2.1.2 Vlanif10
10.10.10.1/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.10.2/32 OSPF 10 1 D 10.1.1.2 Vlanif10
10.10.10.3/32 OSPF 10 1 D 10.1.2.2 Vlanif20
10.10.10.4/32 OSPF 10 2 D 10.1.1.2 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
# Check the routing table on SwitchB.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 14 Routes : 15
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/30 Direct 0 0 D 10.1.1.2 Vlanif10
10.1.1.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.1.2.0/30 OSPF 10 2 D 10.1.1.1 Vlanif10
10.1.3.0/30 Direct 0 0 D 10.1.3.1 Vlanif40
10.1.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif40
10.1.4.0/30 OSPF 10 2 D 10.1.3.2 Vlanif40
10.2.1.0/30 IBGP 255 0 RD 10.10.10.4 Vlanif40
10.3.1.0/30 IBGP 255 0 RD 10.2.1.2 Vlanif40
10.10.10.1/32 OSPF 10 1 D 10.1.1.1 Vlanif10
10.10.10.2/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.10.3/32 OSPF 10 2 D 10.1.1.1 Vlanif10
OSPF 10 2 D 10.1.3.2 Vlanif40
10.10.10.4/32 OSPF 10 1 D 10.1.3.2 Vlanif40
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
The preceding command output shows that the route to the destination network
segment 10.3.1.0 is learned by SwitchB through BGP and the outbound interface is
Vlanif40. The routes to the network segments 10.1.2.0 and 10.1.4.0 are learned
through OSPF, and the costs of the routes are both 2.
Step 7 Configure OSPF-BGP synchronization on SwitchB.
[SwitchB] ospf
[SwitchB-ospf-1] stub-router on-startup
[SwitchB-ospf-1] return
Step 8 Verify the configuration.
# Save the configurations.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 351
<SwitchB> save
The system displays a message asking whether you want to save the
configurations. Enter y.
# Restart SwitchB.
<SwitchB> reboot
The system displays a message asking whether you want to continue with a
system reboot. Enter y.
# Check the routing table on SwitchA. The routing table shows that the route to
the destination network segment 10.3.1.0 is learned through BGP and the
outbound interface is Vlanif20.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 10 Routes : 10
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.2.0/30 Direct 0 0 D 10.1.2.1 Vlanif20
10.1.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.1.4.0/30 OSPF 10 3 D 10.1.2.2 Vlanif20
10.2.1.0/30 IBGP 255 0 RD 10.10.10.4 Vlanif20
10.3.1.0/30 IBGP 255 0 RD 10.2.1.2 Vlanif20
10.10.10.1/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.10.3/32 OSPF 10 1 D 10.1.2.2 Vlanif20
10.10.10.4/32 OSPF 10 3 D 10.1.2.2 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
# Check the routing table on SwitchB. The routing table shows that only OSPF
routes exist in the routing table and their costs are at least 65535. This is because
that OSPF (IGP) routes converge faster than BGP routes.
<SwitchB> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 12 Routes : 13
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/30 Direct 0 0 D 10.1.1.2 Vlanif10
10.1.1.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.1.2.0/30 OSPF 10 65536 D 10.1.1.1 Vlanif10
10.1.3.0/30 Direct 0 0 D 10.1.3.1 Vlanif40
10.1.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif40
10.1.4.0/30 OSPF 10 65536 D 10.1.3.2 Vlanif40
10.10.10.1/32 OSPF 10 65535 D 10.1.1.1 Vlanif10
10.10.10.2/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.10.3/32 OSPF 10 65536 D 10.1.1.1 Vlanif10
OSPF 10 65536 D 10.1.3.2 Vlanif40
10.10.10.4/32 OSPF 10 65535 D 10.1.3.2 Vlanif40
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
# After the network is stable, check the routing table of SwitchB again.
<SwitchB> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 14 Routes : 15
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 352
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/30 Direct 0 0 D 10.1.1.2 Vlanif10
10.1.1.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.1.2.0/30 OSPF 10 2 D 10.1.1.1 Vlanif10
10.1.3.0/30 Direct 0 0 D 10.1.3.1 Vlanif40
10.1.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif40
10.1.4.0/30 OSPF 10 2 D 10.1.3.2 Vlanif40
10.2.1.0/30 IBGP 255 0 RD 10.10.10.4 Vlanif40
10.3.1.0/30 IBGP 255 0 RD 10.2.1.2 Vlanif40
10.10.10.1/32 OSPF 10 1 D 10.1.1.1 Vlanif10
10.10.10.2/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.10.3/32 OSPF 10 2 D 10.1.1.1 Vlanif10
OSPF 10 2 D 10.1.3.2 Vlanif40
10.10.10.4/32 OSPF 10 1 D 10.1.3.2 Vlanif40
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
The preceding command output shows that, after BGP routes on SwitchB
converge, the routing information restores.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
router id 10.10.10.1
#
vlan batch 10 20
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.252
#
interface Vlanif20
ip address 10.1.2.1 255.255.255.252
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface LoopBack0
ip address 10.10.10.1 255.255.255.255
#
bgp 10
peer 10.10.10.2 as-number 10
peer 10.10.10.2 connect-interface LoopBack0
peer 10.10.10.3 as-number 10
peer 10.10.10.3 connect-interface LoopBack0
peer 10.10.10.4 as-number 10
peer 10.10.10.4 connect-interface LoopBack0
#
ipv4-family unicast
undo synchronization
peer 10.10.10.2 enable
peer 10.10.10.3 enable
peer 10.10.10.4 enable
#
ospf 1
area 0.0.0.0
network 10.1.1.0 0.0.0.3
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 353
network 10.1.2.0 0.0.0.3
network 10.10.10.1 0.0.0.0
#
return
● SwitchB configuration file
#
sysname SwitchB
#
router id 10.10.10.2
#
vlan batch 10 40
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.252
#
interface Vlanif40
ip address 10.1.3.1 255.255.255.252
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface LoopBack0
ip address 10.10.10.2 255.255.255.255
#
bgp 10
peer 10.10.10.1 as-number 10
peer 10.10.10.1 connect-interface LoopBack0
peer 10.10.10.3 as-number 10
peer 10.10.10.3 connect-interface LoopBack0
peer 10.10.10.4 as-number 10
peer 10.10.10.4 connect-interface LoopBack0
#
ipv4-family unicast
undo synchronization
peer 10.10.10.1 enable
peer 10.10.10.3 enable
peer 10.10.10.4 enable
#
ospf 1
stub-router on-startup
area 0.0.0.0
network 10.1.1.0 0.0.0.3
network 10.1.3.0 0.0.0.3
network 10.10.10.2 0.0.0.0
#
return
● SwitchC configuration file
#
sysname SwitchC
#
router id 10.10.10.3
#
vlan batch 20 30
#
interface Vlanif20
ip address 10.1.2.2 255.255.255.252
ospf cost 2
#
interface Vlanif30
ip address 10.1.4.1 255.255.255.252
ospf cost 2
#
interface GigabitEthernet0/0/1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 354
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface LoopBack0
ip address 10.10.10.3 255.255.255.255
#
bgp 10
peer 10.10.10.1 as-number 10
peer 10.10.10.1 connect-interface LoopBack0
peer 10.10.10.2 as-number 10
peer 10.10.10.2 connect-interface LoopBack0
peer 10.10.10.4 as-number 10
peer 10.10.10.4 connect-interface LoopBack0
#
ipv4-family unicast
undo synchronization
peer 10.10.10.1 enable
peer 10.10.10.2 enable
peer 10.10.10.4 enable
#
ospf 1
area 0.0.0.0
network 10.1.2.0 0.0.0.3
network 10.1.4.0 0.0.0.3
network 10.10.10.3 0.0.0.0
#
return
● SwitchD configuration file
#
sysname SwitchD
#
router id 10.10.10.4
#
vlan batch 30 40 50
#
interface Vlanif30
ip address 10.1.4.2 255.255.255.252
#
interface Vlanif40
ip address 10.1.3.2 255.255.255.252
#
interface Vlanif50
ip address 10.2.1.1 255.255.255.252
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
interface LoopBack0
ip address 10.10.10.4 255.255.255.255
#
bgp 10
peer 10.10.10.1 as-number 10
peer 10.10.10.1 connect-interface LoopBack0
peer 10.10.10.2 as-number 10
peer 10.10.10.2 connect-interface LoopBack0
peer 10.10.10.3 as-number 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 355
peer 10.10.10.3 connect-interface LoopBack0
peer 10.2.1.2 as-number 20
#
ipv4-family unicast
undo synchronization
import-route direct
import-route ospf 1
peer 10.10.10.1 enable
peer 10.10.10.2 enable
peer 10.10.10.3 enable
peer 10.2.1.2 enable
#
ospf 1
area 0.0.0.0
network 10.1.3.0 0.0.0.3
network 10.1.4.0 0.0.0.3
network 10.10.10.4 0.0.0.0
#
return
● SwitchE configuration file
#
sysname SwitchE
#
vlan batch 50 60
#
interface Vlanif50
ip address 10.2.1.2 255.255.255.252
#
interface Vlanif60
ip address 10.3.1.1 255.255.255.252
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 60
#
interface LoopBack0
ip address 10.10.10.5 255.255.255.255
#
bgp 20
router-id 10.10.10.5
peer 10.2.1.1 as-number 10
#
ipv4-family unicast
undo synchronization
network 10.3.1.0 255.255.255.252
peer 10.2.1.1 enable
#
return
5.26.7 Example for Configuring OSPF GR
Networking Requirements
As shown in Figure 5-75, OSPF is running among three switches, and the entire
OSPF network is partitioned into Area0 and Area1. It is required that restarting the
OSPF process on SwitchC does not affect data forwarding.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 356
Figure 5-75 Networking diagram for configuring OSPF GR
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic OSPF functions on each switch to implement basic
connections on the OSPF network.
2. Enable the Opaque LSA function on SwitchA and SwitchC so that OSPF
supports OSPF GR through Type9 LSA.
3. Configure the GR function on SwitchA and SwitchC so that data is forwarded
properly when OSPF restarts.
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.0.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 192.168.1.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] ospf 1 router-id 10.1.1.1
[SwitchA-ospf-1] area 0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 357
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] area 1
[SwitchA-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.1] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf 1 router-id 10.2.2.2
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf 1 router-id 10.3.3.3
[SwitchC-ospf-1] area 1
[SwitchC-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.1] quit
[SwitchC-ospf-1] quit
Step 4 Enable the Opaque LSA function.
# Configure SwitchA.
[SwitchA] ospf 1
[SwitchA-ospf-1] opaque-capability enable
[SwitchA-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf 1
[SwitchC-ospf-1] opaque-capability enable
[SwitchC-ospf-1] quit
Step 5 Configure the OSPF GR feature.
# Configure SwitchA.
[SwitchA] ospf 1
[SwitchA-ospf-1] graceful-restart
[SwitchA-ospf-1] return
# Configure SwitchC.
[SwitchC] ospf 1
[SwitchC-ospf-1] graceful-restart
[SwitchC-ospf-1] return
Step 6 Verify the configuration.
# Check the GR status of SwitchC.
<SwitchC> display ospf graceful-restart
OSPF Process 1 with Router ID 10.3.3.3
Graceful-restart capability : enabled
Graceful-restart support : planned and un-planned, totally
Helper-policy support : planned and un-planned, strict lsa check
Current GR state : normal
Graceful-restart period : 120 seconds
Number of neighbors under helper:
Normal neighbors : 0
Virtual neighbors : 0
Sham-link neighbors : 0
Total neighbors : 0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 358
Number of restarting neighbors : 0
Last exit reason:
On graceful restart : none
On Helper : none
# Check the neighbor status on SwitchA.
<SwitchA> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.0.1(Vlanif10)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.0.2 GR State: Normal
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.0.2 BDR: 192.168.0.1 MTU: 0
Dead timer due in 40 sec
Retrans timer interval: 5
Neighbor is up for 00:04:28
Authentication Sequence: [ 0 ]
Neighbors
Area 0.0.0.1 interface 192.168.1.1(Vlanif20)'s neighbors
Router ID: 10.3.3.3 Address: 192.168.1.2 GR State: Normal
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 36 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
The preceding command output shows that the OSPF neighbor status of SwitchA
is Full and GR status is Normal.
# Restart the OSPF process of SwitchC gracefully.
<SwitchC> reset ospf process graceful-restart
# Check the neighbor status on SwitchA.
<SwitchA> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.0.1(Vlanif10)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.0.2 GR State: Normal
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.0.2 BDR: 192.168.0.1 MTU: 0
Dead timer due in 40 sec
Retrans timer interval: 5
Neighbor is up for 00:04:28
Authentication Sequence: [ 0 ]
Neighbors
Area 0.0.0.1 interface 192.168.1.1(Vlanif20)'s neighbors
Router ID: 10.3.3.3 Address: 192.168.1.2 GR State: Normal
State: Full Mode:Nbr is Slave Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 36 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 359
The preceding command output shows that the OSPF neighbor status of SwitchA
and SwitchC are still Full without being affected by the graceful restart of the
OSPF process on SwitchC.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
interface Vlanif10
ip address 192.168.0.1 255.255.255.0
#
interface Vlanif20
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.1.1.1
opaque-capability enable
graceful-restart
area 0.0.0.0
network 192.168.0.0 0.0.0.255
area 0.0.0.1
network 192.168.1.0 0.0.0.255
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.0.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1 router-id 10.2.2.2
area 0.0.0.0
network 192.168.0.0 0.0.0.255
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20
#
interface Vlanif20
ip address 192.168.1.2 255.255.255.0
#
interface GigabitEthernet0/0/1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 360
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.3.3.3
opaque-capability enable
graceful-restart
area 0.0.0.1
network 192.168.1.0 0.0.0.255
#
return
5.26.8 Example for Configuring BFD for OSPF
Networking Requirements
As shown in Figure 5-76, OSPF is running among SwitchA, SwitchB, and SwitchC,
and the switch between SwitchA and SwitchB only provides transparent
transmission. It is required that SwitchA and SwitchB quickly detect the status of
the link between them and services be quickly switched to the backup link
SwitchA-SwitchC-SwitchB when the link SwitchA-SwitchB becomes faulty.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 5-76 Networking diagram for configuring BFD for OSPF
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic OSPF functions on each switch to implement basic
connections on the OSPF network.
2. Configure BFD for OSPF on each switch so that services are quickly switched
to the backup link if the link between SwitchA and SwitchB is faulty.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 361
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 30
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 30
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 30
[SwitchA-Vlanif30] ip address 10.3.3.1 24
[SwitchA-Vlanif30] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] ospf 1 router-id 10.10.10.1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] network 10.3.3.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf 1 router-id 10.10.10.2
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 10.2.2.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 10.3.3.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 172.16.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf 1 router-id 10.10.10.3
[SwitchC-ospf-1] area 0
[SwitchC-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] network 10.2.2.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] quit
[SwitchC-ospf-1] quit
# After the preceding configurations, run the display ospf peer command. The
command output shows that adjacencies are established among SwitchA, SwitchB,
and SwitchC. The following provides the command output of SwitchA:
[SwitchA] display ospf peer
OSPF Process 1 with Router ID 10.10.10.1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 362
Neighbors
Area 0.0.0.0 interface 10.1.1.1(Vlanif10)'s neighbors
Router ID: 10.10.10.3 Address: 10.1.1.2
State: Full Mode:Nbr is Master Priority: 1
DR: 10.1.1.2 BDR: 10.1.1.1 MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:00:15
Authentication Sequence: [ 0 ]
Neighbors
Area 0.0.0.0 interface 10.3.3.1(Vlanif30)'s neighbors
Router ID: 10.10.10.2 Address: 10.3.3.2
State: Full Mode:Nbr is Master Priority: 1
DR: 10.3.3.2 BDR: 10.3.3.1 MTU: 0
Dead timer due in 25 sec
Retrans timer interval: 5
Neighbor is up for 00:00:59
Authentication Sequence: [ 0 ]
# Check the OSPF routing table on SwitchA. The routing table contains the routing
entries to SwitchB and SwitchC. The next-hop address of the route to the
destination network segment 172.16.1.0/24 is 10.3.3.2, indicating that the traffic is
transmitted over the link SwitchA→SwitchB.
[SwitchA] display ospf routing
OSPF Process 1 with Router ID 10.10.10.1
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
10.1.1.0/24 1 Transit 10.1.1.1 10.10.10.1 0.0.0.0
10.2.2.0/24 2 Transit 10.1.1.2 10.10.10.3 0.0.0.0
10.2.2.0/24 2 Transit 10.3.3.2 10.10.10.3 0.0.0.0
10.3.3.0/24 1 Transit 10.3.3.1 10.10.10.1 0.0.0.0
172.16.1.0/24 2 Stub 10.3.3.2 10.10.10.2 0.0.0.0
Total Nets: 5
Intra Area: 5 Inter Area: 0 ASE: 0 NSSA: 0
Step 4 Configure BFD for OSPF.
# Configure BFD for OSPF on SwitchA.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] ospf 1
[SwitchA-ospf-1] bfd all-interfaces enable
[SwitchA-ospf-1] quit
# Configure BFD for OSPF on SwitchB.
[SwitchB] bfd
[SwitchB-bfd] quit
[SwitchB] ospf 1
[SwitchB-ospf-1] bfd all-interfaces enable
[SwitchB-ospf-1] quit
# Configure BFD for OSPF on SwitchC.
[SwitchC] bfd
[SwitchC-bfd] quit
[SwitchC] ospf 1
[SwitchC-ospf-1] bfd all-interfaces enable
[SwitchC-ospf-1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 363
# After the preceding configurations, run the display ospf bfd session all
command on SwitchA, SwitchB, or SwitchC. Each command output shows that the
BFD session status is Up. The following provides the command output of SwitchA:
[SwitchA] display ospf bfd session all
OSPF Process 1 with Router ID 10.10.10.1
Area 0.0.0.0 interface 10.1.1.1(Vlanif10)'s BFD Sessions
NeighborId:10.10.10.3 AreaId:0.0.0.0 Interface:Vlanif10
BFDState:up rx :1000 tx :1000
Multiplier:3 BFD Local Dis:8195 LocalIpAdd:10.1.1.1
RemoteIpAdd:10.1.1.2 Diagnostic Info:No diagnostic information
Area 0.0.0.0 interface 10.3.3.1(Vlanif30)'s BFD Sessions
NeighborId:10.10.10.2 AreaId:0.0.0.0 Interface:Vlanif30
BFDState:up rx :1000 tx :1000
Multiplier:3 BFD Local Dis:8194 LocalIpAdd:10.3.3.1
RemoteIpAdd:10.3.3.2 Diagnostic Info:No diagnostic information
Step 5 Verify the configuration.
# Run the shutdown command on GE0/0/1 of SwitchB to simulate a link fault.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# Check the OSPF routing table on SwitchA.
[SwitchA] display ospf routing
OSPF Process 1 with Router ID 10.10.10.1
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
10.1.1.0/24 1 Transit 10.1.1.1 10.10.10.1 0.0.0.0
10.2.2.0/24 2 Transit 10.1.1.2 10.10.10.3 0.0.0.0
10.3.3.0/24 1 Stub 10.3.3.1 10.10.10.1 0.0.0.0
172.16.1.0/24 3 Stub 10.1.1.2 10.10.10.2 0.0.0.0
Total Nets: 4
Intra Area: 4 Inter Area: 0 ASE: 0 NSSA: 0
After the link SwitchA-SwitchB is faulty, the backup link SwitchA-SwitchC-SwitchB
takes effect and the next-hop address of the route to the destination network
segment 172.16.1.0/24 changes to 10.1.1.2.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 30
#
bfd
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
#
interface Vlanif30
ip address 10.3.3.1 255.255.255.0
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 364
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
ospf 1 router-id 10.10.10.1
bfd all-interfaces enable
area 0.0.0.0
network 10.1.1.0 0.0.0.255
network 10.3.3.0 0.0.0.255
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 20 30 40
#
bfd
#
interface Vlanif20
ip address 10.2.2.2 255.255.255.0
#
interface Vlanif30
ip address 10.3.3.2 255.255.255.0
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
ospf 1 router-id 10.10.10.2
bfd all-interfaces enable
area 0.0.0.0
network 10.2.2.0 0.0.0.255
network 10.3.3.0 0.0.0.255
network 172.16.1.0 0.0.0.255
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 10 20
#
bfd
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
#
interface Vlanif20
ip address 10.2.2.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 365
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.10.10.3
bfd all-interfaces enable
area 0.0.0.0
network 10.1.1.0 0.0.0.255
network 10.2.2.0 0.0.0.255
#
return
5.26.9 Example for Configuring OSPF IP FRR
Networking Requirements
As shown in Figure 5-77, four switches belong to the same OSPF area. It is
required that traffic forwarded by SwitchA be protected. The specific requirements
are as follows:
● In normal scenarios, traffic of SwitchA is forwarded over the primary link
SwitchA-SwitchC.
● When the primary link SwitchA-SwitchC fails, traffic is fast switched to the
backup link SwitchA-SwitchB without waiting for route convergence, ensuring
uninterrupted traffic forwarding.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 5-77 Networking diagram for configuring OSPF IP FRR
Configuration Roadmap
The configuration roadmap is as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 366
1. Configure basic OSPF functions on each switch.
2. Configure OSPF IP FRR on SwitchA to ensure uninterrupted forwarding of
traffic from SwitchA.
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface GigabitEthernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface GigabitEthernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, and SwitchD are
similar to the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 192.168.2.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] ospf 1 router-id 10.1.1.1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf 1 router-id 10.2.2.2
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.3.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] return
# Configure SwitchC.
[SwitchC] ospf 1 router-id 10.3.3.3
[SwitchC-ospf-1] area 0
[SwitchC-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] network 192.168.3.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] network 192.168.4.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] return
# Configure SwitchD.
[SwitchD] ospf 1 router-id 10.4.4.4
[SwitchD-ospf-1] area 0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 367
[SwitchD-ospf-1-area-0.0.0.0] network 192.168.4.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.0] return
Step 4 Enable OSPF IP FRR on SwitchA.
# Enable OSPF IP FRR on SwitchA.
[SwitchA] ospf
[SwitchA-ospf-1] frr
[SwitchA-ospf-1-frr] loop-free-alternate
[SwitchA-ospf-1-frr] return
Step 5 Verify the configuration.
# Check information about routes from SwitchA to SwitchD. Verify that OSPF
generates a backup route after OSPF IP FRR is enabled.
<SwitchA> display ospf routing 192.168.4.0
OSPF Process 1 with Router ID 10.1.1.1
Destination : 192.168.4.0/24
AdverRouter : 10.4.4.4 Area : 0.0.0.0
Cost : 2 Type : Transit
NextHop : 192.168.2.2 Interface : Vlanif20
Priority : Low Age : 00h00m10s
Backup Nexthop : 192.168.1.2 Backup Interface: Vlanif10
Backup Type : LFA LINK
The preceding command output shows that a backup route is generated on
SwitchA.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface Vlanif20
ip address 192.168.2.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1 router-id 10.1.1.1
frr
loop-free-alternate
area 0.0.0.0
network 192.168.1.0 0.0.0.255
network 192.168.2.0 0.0.0.255
#
return
● SwitchB configuration file
#
sysname SwitchB
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 368
#
vlan batch 10 30
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif30
ip address 192.168.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
ospf 1 router-id 10.2.2.2
area 0.0.0.0
network 192.168.1.0 0.0.0.255
network 192.168.3.0 0.0.0.255
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 30 40
#
interface Vlanif20
ip address 192.168.2.2 255.255.255.0
#
interface Vlanif30
ip address 192.168.3.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.4.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
ospf 1 router-id 10.3.3.3
area 0.0.0.0
network 192.168.2.0 0.0.0.255
network 192.168.3.0 0.0.0.255
network 192.168.4.0 0.0.0.255
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 40
#
interface Vlanif40
ip address 192.168.4.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 369
port trunk allow-pass vlan 40
#
ospf 1 router-id 10.4.4.4
area 0.0.0.0
network 192.168.4.0 0.0.0.255
#
return
5.26.10 Example for Configuring Local OSPF MT
Networking Requirements
As shown in Figure 5-78, multicast and an IGP Shortcut-enabled MPLS TE tunnel
are configured on a network. The outbound interface of the route calculated by
IGP may be a TE tunnel interface, not a physical interface. The TE tunnel interface
on the switch sends multicast Join packets over a unicast route to the multicast
source address. The multicast Join packets are transparent to SwitchC through
which the TE tunnel passes. As a result, SwitchC cannot generate multicast
forwarding entries. To resolve the problem, you can enable local OSPF MT on
SwitchB. With local MT enabled, if the outbound interface of a route after
calculation is an IGP Shortcut-enabled TE tunnel interface, the routing
management (RM) module creates an independent Multicast IGP (MIGP) routing
table, calculates the physical outbound interface for the route, and adds the route
to the MIGP routing table. Multicast packets are then forwarded along the routes
in the MIGP routing table.
Figure 5-78 Networking diagram for configuring local OSPF MT
Configuration Roadmap
The configuration roadmap is as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 370
1. Configure basic OSPF functions on each switch to implement basic
connections on the OSPF network.
2. Configure multicast PIM-SM on each switch so that the host can receive the
multicast data from the source.
3. Configure the MPLS RSVP-TE tunnel function on SwitchB, SwitchC, and
SwitchD, configure an MPLS TE tunnel interface on SwitchB, and establish a
TE tunnel from SwitchB to SwitchD.
4. Configure the IGP-Shortcut function on SwitchB so that SwitchB uses the TE
tunnel interface as the outbound interface.
5. Configure the local OSPF MT function on SwitchB so that a physical outbound
interface is created in the MIGP routing table as the next-hop of each route
whose original outbound interface is a TE tunnel interface.
Procedure
Step 1 Configure VLANs for interfaces.
# Configure SwitchA. The configurations of SwitchB, SwitchC, SwitchD, and
SwitchE are similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type access
[SwitchA-GigabitEthernet0/0/1] port default vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address for each VLANIF interface or loopback interface.
# Configure SwitchA. The configurations of SwitchB, SwitchC, SwitchD, and
SwitchE are similar to the configuration of SwitchA.
[SwitchA] interface loopback 0
[SwitchA-LoopBack0] ip address 10.1.1.1 32
[SwitchA-LoopBack0] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 172.16.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.0.0.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] router id 10.1.1.1
[SwitchA] ospf 1
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 10.1.1.1 0.0.0.0
[SwitchA-ospf-1-area-0.0.0.0] network 10.0.0.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] network 172.16.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 371
[SwitchB] router id 10.2.2.2
[SwitchB] ospf 1
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 10.2.2.2 0.0.0.0
[SwitchB-ospf-1-area-0.0.0.0] network 10.0.0.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 10.0.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] router id 10.3.3.3
[SwitchC] ospf 1
[SwitchC-ospf-1] area 0
[SwitchC-ospf-1-area-0.0.0.0] network 10.3.3.3 0.0.0.0
[SwitchC-ospf-1-area-0.0.0.0] network 10.0.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] network 10.0.2.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] quit
[SwitchC-ospf-1] quit
# Configure SwitchD.
[SwitchD] router id 10.4.4.4
[SwitchD] ospf 1
[SwitchD-ospf-1] area 0
[SwitchD-ospf-1-area-0.0.0.0] network 10.4.4.4 0.0.0.0
[SwitchD-ospf-1-area-0.0.0.0] network 10.0.2.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.0] network 10.0.3.0 0.0.0.255
[SwitchD-ospf-1-area-0.0.0.0] quit
[SwitchD-ospf-1] quit
# Configure SwitchE.
[SwitchE] router id 10.5.5.5
[SwitchE] ospf 1
[SwitchE-ospf-1] area 0
[SwitchE-ospf-1-area-0.0.0.0] network 10.5.5.5 0.0.0.0
[SwitchE-ospf-1-area-0.0.0.0] network 10.0.3.0 0.0.0.255
[SwitchE-ospf-1-area-0.0.0.0] network 192.168.3.0 0.0.0.255
[SwitchE-ospf-1-area-0.0.0.0] quit
[SwitchE-ospf-1] quit
Step 4 Configure PIM-SM.
# Enable multicast on all switches and enable PIM-SM on all interfaces. The
configurations of SwitchB, SwitchC, SwitchD, and SwitchE are similar to the
configuration of SwitchA.
[SwitchA] multicast routing-enable
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] pim sm
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] pim sm
[SwitchA-Vlanif20] quit
# Enable Internet Group Management Protocol (IGMP) on the interface
connecting SwitchA to the host.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] igmp enable
[SwitchA-Vlanif10] igmp version 3
[SwitchA-Vlanif10] quit
# Configure a C-BSR and a C-RP. Set the RP service range and specify the C-BSR
and C-RP locations on SwitchD.
[SwitchD] pim
[SwitchD-pim] c-bsr vlanif 50
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 372
[SwitchD-pim] c-rp vlanif 50
[SwitchD-pim] quit
# Run the display multicast routing-table command to check the switch
multicast routing table. The following provides the multicast routing table of
SwitchC:
[SwitchC] display multicast routing-table
Multicast routing table of VPN-Instance: public net
Total 1 entry
00001. (192.168.3.2, 225.0.0.1)
Uptime: 15:03:04
Upstream Interface: Vlanif40
List of 1 downstream interface
1: Vlanif30
Step 5 Configure an MPLS RSVP-TE tunnel.
# Configure SwitchB.
[SwitchB] mpls lsr-id 10.2.2.2
[SwitchB] mpls
[SwitchB-mpls] mpls te
[SwitchB-mpls] mpls rsvp-te
[SwitchB-mpls] mpls te cspf
[SwitchB-mpls] quit
[SwitchB] interface vlanif 30
[SwitchB-Vlanif30] mpls
[SwitchB-Vlanif30] mpls te
[SwitchB-Vlanif30] mpls rsvp-te
[SwitchB-Vlanif30] quit
[SwitchB] ospf 1
[SwitchB-ospf-1] enable traffic-adjustment
[SwitchB-ospf-1] opaque-capability enable
[SwitchB-ospf-1] area 0.0.0.0
[SwitchB-ospf-1-area-0.0.0.0] mpls-te enable
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] mpls lsr-id 10.3.3.3
[SwitchC] mpls
[SwitchC-mpls] mpls te
[SwitchC-mpls] mpls rsvp-te
[SwitchC-mpls] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] mpls
[SwitchC-Vlanif30] mpls te
[SwitchC-Vlanif30] mpls rsvp-te
[SwitchC-Vlanif30] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] mpls
[SwitchC-Vlanif40] mpls te
[SwitchC-Vlanif40] mpls rsvp-te
[SwitchC-Vlanif40] quit
[SwitchC] ospf 1
[SwitchC-ospf-1] opaque-capability enable
[SwitchC-ospf-1] area 0.0.0.0
[SwitchC-ospf-1-area-0.0.0.0] mpls-te enable
[SwitchC-ospf-1-area-0.0.0.0] quit
[SwitchC-ospf-1] quit
# Configure SwitchD.
[SwitchD] mpls lsr-id 10.4.4.4
[SwitchD] mpls
[SwitchD-mpls] mpls te
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 373
[SwitchD-mpls] mpls rsvp-te
[SwitchD-mpls] quit
[SwitchD] interface vlanif 40
[SwitchD-Vlanif40] mpls
[SwitchD-Vlanif40] mpls te
[SwitchD-Vlanif40] mpls rsvp-te
[SwitchD-Vlanif40] quit
[SwitchD] ospf 1
[SwitchD-ospf-1] opaque-capability enable
[SwitchD-ospf-1] area 0.0.0.0
[SwitchD-ospf-1-area-0.0.0.0] mpls-te enable
[SwitchD-ospf-1-area-0.0.0.0] quit
[SwitchD-ospf-1] quit
Configure an MPLS TE tunnel and enable IGP Shortcut.
Configure an MPLS TE tunnel and enable IGP Shortcut on SwitchB.
[SwitchB] interface tunnel 1
[SwitchB-Tunnel1] ip address unnumbered interface loopback 0
[SwitchB-Tunnel1] tunnel-protocol mpls te
[SwitchB-Tunnel1] destination 10.4.4.4
[SwitchB-Tunnel1] mpls te tunnel-id 100
[SwitchB-Tunnel1] mpls te igp shortcut ospf
[SwitchB-Tunnel1] mpls te igp metric relative -10
[SwitchB-Tunnel1] mpls te commit
[SwitchB-Tunnel1] quit
# Check the OSPF routing table on SwitchB. The information shows that an MPLS
TE tunnel is set up.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 15 Routes : 15
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.0.0.0/24 Direct 0 0 D 10.0.0.2 Vlanif20
10.0.0.2/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.0.1.0/24 Direct 0 0 D 10.0.1.2 Vlanif30
10.0.1.2/32 Direct 0 0 D 127.0.0.1 Vlanif30
10.0.2.0/24 OSPF 10 2 D 10.0.1.1 Vlanif30
10.0.3.0/24 OSPF 10 2 D 10.2.2.2 Tunnel1
10.1.1.1/32 OSPF 10 1 D 10.0.0.1 Vlanif20
10.2.2.2/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.3.3.3/32 OSPF 10 1 D 10.0.1.1 Vlanif30
10.4.4.4/32 OSPF 10 1 D 10.2.2.2 Tunnel1
10.5.5.5/32 OSPF 10 2 D 10.2.2.2 Tunnel1
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 OSPF 10 2 D 10.0.0.1 Vlanif20
192.168.3.0/24 OSPF 10 3 D 10.2.2.2 Tunnel1
# Check the multicast routing table on switchSwitchC spanned by the TE tunnel.
[SwitchC] display multicast routing-table
No multicast routing entry is displayed in the command output, indicating that
SwitchC has discarded multicast packets.
Step 6 Configure local OSPF MT.
# Enable local OSPF MT on SwitchB.
[SwitchB] ospf 1
[SwitchB-ospf-1] local-mt enable
[SwitchB-ospf-1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 374
Step 7 Verify the configuration.
# Check the multicast routing table on SwitchC again. Verify that a multicast
route is contained in the routing table.
[SwitchC] display multicast routing-table
Multicast routing table of VPN-Instance: public net
Total 1 entry
00001. (192.168.3.2, 225.0.0.1)
Uptime: 00:00:19
Upstream Interface: Vlanif40
List of 1 downstream interface
1: Vlanif30
# Check the MIGP routing table on SwitchB.
[SwitchB] display migp routing-table
Route Flags: R - relay, D - download to fib
------------------------------------------------------------------------------
Routing Tables: MIGP
Destinations : 4 Routes : 4
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.0.3.0/24 OSPF 10 3 10.0.1.1 Vlanif30
10.4.4.4/32 OSPF 10 2 10.0.1.1 Vlanif30
10.5.5.5/32 OSPF 10 3 10.0.1.1 Vlanif30
192.168.3.0/24 OSPF 10 4 10.0.1.1 Vlanif30
The command output shows that a physical outbound interface is created in the
MIGP routing table as the next-hop of each route whose original outbound
interface is a TE tunnel interface.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
router id 10.1.1.1
#
vlan batch 10 20
#
multicast routing-enable
#
interface Vlanif10
ip address 172.16.1.1 255.255.255.0
pim sm
igmp enable
igmp version 3
#
interface Vlanif20
ip address 10.0.0.1 255.255.255.0
pim sm
#
interface GigabitEthernet0/0/1
port link-type access
port default vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface LoopBack0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 375
ip address 10.1.1.1 255.255.255.255
#
ospf 1
area 0.0.0.0
network 10.0.0.0 0.0.0.255
network 10.1.1.1 0.0.0.0
network 172.16.1.0 0.0.0.255
#
return
● SwitchB configuration file
#
sysname SwitchB
#
router id 10.2.2.2
#
vlan batch 20 30
#
multicast routing-enable
#
mpls lsr-id 10.2.2.2
mpls
mpls te
mpls rsvp-te
mpls te cspf
#
interface Vlanif20
ip address 10.0.0.2 255.255.255.0
pim sm
#
interface Vlanif30
ip address 10.0.1.2 255.255.255.0
pim sm
mpls
mpls te
mpls rsvp-te
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface LoopBack0
ip address 10.2.2.2 255.255.255.255
#
interface Tunnel1
ip address unnumbered interface LoopBack0
tunnel-protocol mpls te
destination 10.4.4.4
mpls te tunnel-id 100
mpls te igp shortcut ospf
mpls te igp metric relative -10
mpls te commit
#
ospf 1
opaque-capability enable
enable traffic-adjustment
local-mt enable
area 0.0.0.0
network 10.0.0.0 0.0.0.255
network 10.0.1.0 0.0.0.255
network 10.2.2.2 0.0.0.0
mpls-te enable
#
return
● SwitchC configuration file
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 376
#
sysname SwitchC
#
router id 10.3.3.3
#
vlan batch 30 40
#
multicast routing-enable
#
mpls lsr-id 10.3.3.3
mpls
mpls te
mpls rsvp-te
#
interface Vlanif30
ip address 10.0.1.1 255.255.255.0
pim sm
mpls
mpls te
mpls rsvp-te
#
interface Vlanif40
ip address 10.0.2.2 255.255.255.0
pim sm
mpls
mpls te
mpls rsvp-te
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface LoopBack0
ip address 10.3.3.3 255.255.255.255
#
ospf 1
opaque-capability enable
area 0.0.0.0
network 10.0.1.0 0.0.0.255
network 10.0.2.0 0.0.0.255
network 10.3.3.3 0.0.0.0
mpls-te enable
#
return
● SwitchD configuration file
#
sysname SwitchD
#
router id 10.4.4.4
#
vlan batch 40 50
#
multicast routing-enable
#
mpls lsr-id 10.4.4.4
mpls
mpls te
mpls rsvp-te
#
interface Vlanif40
ip address 10.0.2.1 255.255.255.0
pim sm
mpls
mpls te
mpls rsvp-te
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 377
#
interface Vlanif50
ip address 10.0.3.1 255.255.255.0
pim sm
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface LoopBack0
ip address 10.4.4.4 255.255.255.255
#
ospf 1
opaque-capability enable
area 0.0.0.0
network 10.0.2.0 0.0.0.255
network 10.0.3.0 0.0.0.255
network 10.4.4.4 0.0.0.0
mpls-te enable
#
pim
c-bsr Vlanif50
c-rp Vlanif50
#
return
● SwitchE configuration file
#
sysname SwitchE
#
router id 10.5.5.5
#
vlan batch 50 60
#
multicast routing-enable
#
interface Vlanif50
ip address 10.0.3.3 255.255.255.0
pim sm
#
interface Vlanif60
ip address 192.168.3.1 255.255.255.0
pim sm
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type access
port default vlan 60
#
interface LoopBack0
ip address 10.5.5.5 255.255.255.255
#
ospf 1
area 0.0.0.0
network 10.0.3.0 0.0.0.255
network 10.5.5.5 0.0.0.0
network 192.168.3.0 0.0.0.255
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 378
5.27 Troubleshooting OSPF
5.27.1 An OSPF Neighbor Relationship Cannot Be Established
Fault Symptom
An OSPF neighbor relationship cannot be established between two devices.
Procedure
Step 1 Check whether the physical status and protocol status of interfaces on both ends
of the link are Up and stable, whether packets are lost on the interfaces, and
whether the two devices can ping each other using packets longer than 1500
bytes.
If the physical status of the interfaces is not Up or unstable (interfaces flap for
example), check whether the link connection is normal and whether the protocol
status of the interfaces is Up. Ensure that no error packet statistics exist on the
interfaces.
If packet loss occurs during the ping test, check whether the MTUs of device
interfaces along which ping packets travel are properly set.
Step 2 Check whether the two devices have the same OSPF process router ID.
Run the display ospf [
process-id ] brief command on the two devices
respectively to check the OSPF process router IDs of them.
Each router ID in an OSPF process must be unique on the entire network.
Otherwise, devices on both ends of the link cannot establish an OSPF neighbor
relationship, and routing information will be incorrect.
If the two devices have the same OSPF process router ID, run the ospf [
process-
id ] router-id
router-id command in the system view to change the OSPF process
router IDs and ensure that the two devices have different OSPF process router IDs.
After changing an OSPF process router ID, run the reset ospf [
process-id ]
process command in the user view to make the new router ID take effect.
Step 3 Check whether the two devices have the same OSPF area ID.
Run the display ospf [
process-id ] brief command on the two devices
respectively to check the OSPF area IDs of them.
If the two devices have different OSPF area IDs, run the area
area-id command in
the OSPF view to change the OSPF area IDs and ensure that the two devices have
the same OSPF area ID.
Step 4 Check whether OSPF interfaces on both ends of the link have the same network
type.
Run the display ospf [
process-id ] interface command on the two devices
respectively to check the OSPF interface network types of them.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 379
The OSPF interfaces on both ends of a link must have the same network type;
otherwise, the two interfaces cannot establish an OSPF neighbor relationship.
If the network types of the two OSPF interfaces are different, run the ospf
network-type { broadcast | nbma | p2mp | p2p } command in the OSPF interface
view to change the OSPF interface network types and ensure the network type
consistency between the two interfaces.
NOTE
If the network types of OSPF interfaces on both ends of the link are NBMA, run the peer
ip-address [ dr-priority
priority ] command in the OSPF view to configure NBMA neighbors.
Step 5 Check whether OSPF interfaces on both ends of the link have the same IP address
mask.
Run the display current-configuration interface
interface-type interface-number
command on the two devices respectively to check the IP addresses of the
specified OSPF interfaces on the devices.
The OSPF interfaces on both ends of a link must have the same IP address mask;
otherwise, the two interfaces cannot establish an OSPF neighbor relationship. On
a P2MP network, to disable devices from checking the network masks so that an
OSPF neighbor relationship can be established, run the ospf p2mp-mask-ignore
command in the OSPF interface view.
If the two OSPF interfaces have different IP address masks, run the ip address
ip-
address {
mask |
mask-length } command in the OSPF interface view to change
the IP address masks and ensure the IP address mask consistency between the
two interfaces.
Step 6 Check whether IP addresses of OSPF interfaces on both ends of the link reside in
the network segment specified in the network command.
Run the display current-configuration interface
interface-type interface-number
command on the two devices respectively to check IP addresses of the OSPF
interfaces on both ends of the link, and run the display current-configuration
configuration ospf command on the two devices respectively to check the OSPF
process configuration.
OSPF can run on an interface only when the following conditions are met:
● The mask length of the interface's IP address is longer than or equal to that
converted from the wildcard mask specified by the network command. OSPF
uses wildcard masks. For example, 0.0.0.255 indicates that the mask length is
24 bits.
● The primary IP address of the interface resides in the network segment
specified in the network command.
If the IP address of an interface does not meet the preceding conditions, run the ip
address
ip-address {
mask |
mask-length } command in the OSPF-enabled
interface view to change the IP address of the interface. Alternatively, in the view
of the area to which the OSPF process belongs, run the network command to
change the configured network segment so that the IP address of the interface
can meet the preceding conditions.
Step 7 Check whether the DR priorities of OSPF interfaces on both ends of the link are 0.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 380
Run the display ospf [
process-id ] interface command on the two devices
respectively to check the DR priorities of the OSPF interfaces.
On a broadcast or NBMA network, at least one OSPF interface needs to have a DR
priority higher than 0 so that the DR can be elected. Otherwise, the neighbor
status of devices on both ends of the link only can reach 2-Way.
If the DR priorities of the two OSPF interfaces are both 0, run the ospf dr-priority
priority command in the OSPF interface view to change the DR priorities. Ensure
that there is at least one OSPF interface has a DR priority higher than 0.
----End
5.27.2 OSPF Cannot Discover Routes of a Non-Local Area
Symptom
There are no problems with a link, but OSPF cannot discover routes of a non-local
area.
Procedure
Step 1 Check whether the area where the device resides is connected to the backbone
area.
Run the display ospf [
process-id ] brief command on the ABR in the area where
the device resides to check the area configuration.
OSPF requires that all non-backbone areas be connected to the backbone area.
If no backbone area information is configured on the ABR, run the area
area-id
command in the OSPF view to modify the OSPF area information. Ensure that at
least one interface on the ABR runs in the backbone area.
NOTE
If non-backbone areas cannot be connected to the backbone area due to networking
restrictions, you can configure OSPF virtual links to resolve this problem.
Step 2 Check whether the area where the device resides is a totally stub area.
Run the display current-configuration configuration ospf [
process-id ]
command on the device to check the OSPF process configuration.
If you specify the parameter no-summary when configuring a non-backbone area
as a stub area on the ABR (that is, running the stub no-summary command in
the OSPF area view), the area is configured as a totally stub area.
A totally stub area allows only intra-area routes to be advertised within the area.
If the area where the device resides is configured as a totally stub area, perform
the following configurations based on service requirements:
● To restore the totally stub area to a common area, run the undo stub
command in the OSPF area view on all devices in the area.
● To restore a totally stub area to a stub area, run the undo stub command in
the OSPF area view on the ABR in the area and then run the stub command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 381
Step 3 Check whether the area where the device resides is a totally NSSA.
Run the display current-configuration configuration ospf [
process-id ]
command on the device to check the OSPF process configuration.
If you specify the parameter no-summary when configuring a non-backbone area
as an NSSA on the ABR (that is, running the nssa no-summary command in the
OSPF area view), the area is configured as a totally NSSA.
A totally NSSA allows only intra-area routes to be advertised within the area.
If the area where the device resides is configured as a totally NSSA, perform the
following configuration based on service requirements:
● To restore the totally NSSA to a common area, run the undo nssa command
in the OSPF area view on all devices in the area.
● To restore a totally NSSA to a stub area, run the undo nssa command in the
OSPF area view on the ABR in the area and then run the nssa command.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 382
6 OSPFv3 Configuration
6.1 Overview of OSPFv3
6.2 Understanding OSPFv3
6.3 Summary of OSPFv3 Configuration Tasks
6.4 Licensing Requirements and Limitations for OSPFv3
6.5 Default Settings for OSPFv3
6.6 Configuring Basic OSPFv3 Functions
6.7 Establishing and Maintaining an OSPFv3 Neighbor Relationship
6.8 Configuring an OSPFv3 Area
6.9 Configuring an OSPFv3 NSSA
6.10 Configuring OSPFv3 Route Attributes
6.11 Controlling OSPFv3 Routing Information
6.12 Optimizing an OSPFv3 Network
6.13 Configuring BFD for OSPFv3
6.14 Configuring OSPFv3 IP FRR
6.15 Configuring OSPFv3 GR
6.16 Improving OSPFv3 Network Security
6.17 Configuring OSPFv3 Neighbor Relationship Flapping Suppression
6.18 Configuring OSPFv3 IPSec
6.19 Configuring the Network Management Function of OSPFv3
6.20 Resetting OSPFv3
6.21 Configuration Examples for OSPFv3
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 383
6.1 Overview of OSPFv3
Definition
Open Shortest Path First (OSPF) is a link-state Interior Gateway Protocol (IGP)
developed by the Internet Engineering Task Force (IETF).
OSPF Version 3 (OSPFv3), as defined in RFC 2740 and expanded in RFC 5340, is a
modification of OSPFv2 allowing IPv6 support.
Purpose
The primary purpose of OSPFv3 is to develop a routing protocol independent of
any specific network layer. The internal routing information of OSPFv3 has been
redesigned to serve this purpose.
OSPFv3 and OSPFv2 differ as follows:
● OSPFv3 is used in IPv6, while OSPFv2 is used in IPv4.
OSPFv3 does not insert IP-based data in the header of an IP packet or Link
State Advertisement (LSA).
● OSPFv3 uses protocol-independent information to execute crucial tasks that
originally required the use of the data in the IP packet header, for example, to
identify LSAs that advertise routing data.
6.2 Understanding OSPFv3
6.2.1 OSPFv3 Fundamentals
● The working principles of Hello messages, state machines, link-state
databases (LSDBs), flooding, and route calculation are the same in OSPFv3
and OSPFv2.
● OSPFv3 divides an Autonomous System (AS) into one or more logical areas
and advertises routes through LSAs.
● OSPFv3 ensures routing information consistency by exchanging OSPFv3
packets between routers within an OSPFv3 area.
● OSPFv3 packets are encapsulated into IPv6 packets, which can be transmitted
in unicast or multicast mode.
OSPFv3 Packets
Packet Type Description
Hello Sent regularly to discover and maintain OSPFv3
neighbor relationships.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 384
Packet Type Description
Database Description (DD) Contains the summary of the local LSDB. It is
exchanged between two OSPFv3 routers to
update the LSDBs.
Link State Request (LSR) Sent to neighbors to request the required LSAs.
An OSPFv3 router sends LSR packets to its
neighbor only after they exchange DD packets.
Link State Update (LSU) Used to transmit required LSAs to neighbors.
Link State Acknowledgment
(LSAck)
Used to acknowledge the receipt of LSA packets.
LSA Types
LSA Type Description
Router-LSA (Type 1) ● Generated by a router for each area to which an
OSPFv3 interface belongs and advertised in that
area.
● Describes the status and costs of links of the
router.
Network-LSA (Type 2) ● Generated by a designated router (DR) and
broadcast in the area to which the DR belongs.
● Describes the link status.
Inter-Area-Prefix-LSA
(Type 3)
● Generated by an area border router (ABR).
● Describes the route of a network segment within
the local area and is used to inform other areas
of the route.
Inter-Area-Router-LSA
(Type 4)
● Generated by an ABR and advertised to all
related areas, except the area to which the
autonomous system boundary router (ASBR)
belongs.
● Describes the route to the ASBR.
AS-external-LSA (Type 5) ● Generated by an ASBR and advertised to all
areas except the stub area and the not-so-stubby
area (NSSA).
● Describes routes to a destination outside the AS.
NSSA-LSA (Type 7) ● Generated by an ASBR and advertised only in
NSSAs.
● Describes routes to a destination outside the AS.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 385
LSA Type Description
Link-LSA (Type 8) ● Each router generates one for each link.
● Describes the link-local address and IPv6 address
prefix associated with the link, as well as the link
option set in the network LSA. It is transmitted
only on the link.
Intra-Area-Prefix-LSA
(Type 9)
● Each router or DR generates one or more to be
transmitted in the local area.
● An LSA of this type generated on a router
describes the IPv6 address prefix associated with
the router LSA.
● An LSA of this type generated on a DR describes
the IPv6 address prefix associated with the
network LSA.
Router Types
Figure 6-1 Router types
Table 6-1 Router types
Router Type Description
Internal router Routers whose interfaces all belong to the same
OSPFv3 area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 386
Router Type Description
Area border router (ABR) Belongs to two or more areas, one of which must
be a backbone area.
Used to connect backbone and non-backbone areas.
It can be physically or logically connected to the
backbone area.
Backbone router At least one interface on a backbone router must
belong to the backbone area.
All ABRs and internal routers in Area 0 are
backbone routers.
AS boundary router
(ASBR)
Exchanges routing information with other ASs.
May not locate on the boundary of an AS. It can be
an internal router or an ABR.
OSPFv3 Route Types
AS inter-area and intra-area routes describe routes within an AS. External routes
describe routes to destinations outside an AS. OSPFv3 classifies imported AS
external routes into Type 1 routes and Type 2 routes.
Table 6-2 lists route types in descending order of priority.
Table 6-2 Route types
Route Type Description
Intra-area route Routes that are generated from within an area (the
destination belongs to the area).
Inter-area route Routes that originate from other areas.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 387
Route Type Description
External route Routes that are imported into OSPF from other
routing protocols or different OSPF processes.
External routes fall into two categories: Type 1 and
Type 2 external routes. The difference between the
two types is the way the cost of a route is
calculated.
● Type 1 external route: The cost of a Type 1
external route is the addition of the external cost
(from the local device to an ASBR) and the
internal cost (from the ASBR to the destination)
used to reach that route.
● Type 2 external route: The cost of a Type 2
external route is always the external cost (from
an ASBR to the destination), irrespective of the
internal cost to reach that route.
A Type 1 external route is always preferred over a
Type 2 external route for the same destination.
Area Types
Table 6-3 Area types
Area Type Description
Totally stub area Allows Type 3 default routes advertised by the ABR, but
disallows routes outside the AS and inter-area routes.
Stub area Different from a totally stub area, a stub area allows inter-
area routes.
NSSA Different from a stub area, an NSSA allows routes outside
an AS.
An ASBR advertises Type 7 LSAs in the local area. These
Type 7 LSAs are translated into Type 5 LSAs on an ABR,
and are then flooded in the entire OSPFv3 AS.
Network Types Supported by OSPFv3
OSPFv3 classifies networks into different types according to link layer protocols.
The following table describes these network types.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 388
Table 6-4 Network types
Network Type Description
Broadcast Default network type if the link layer protocol is
Ethernet or Fiber Distributed Data Interface (FDDI).
● Hello messages, LSU packets, and LSAck packets are
transmitted in multicast mode (FF02::5 is the reserved
IPv6 multicast address of the OSPFv3 router; FF02::6
is the reserved IPv6 multicast address of the OSPFv3
DR or BDR).
● DD packets and LSR packets are transmitted in
unicast mode.
Non-broadcast
multiple access
(NBMA)
Default network type if the link layer protocol is frame
relay, ATM, or X.25.
Protocol packets, such as Hello messages and DD, LSR,
LSU, and LSAck packets, are transmitted in unicast
mode.
Point-to-multipoint
(P2MP)
Not a default network type for any link layer protocol. A
P2MP network must be forcibly changed from other
network types. It is a common practice to change an
NBMA that is not fully connected to a P2MP network.
● Hello messages are transmitted in multicast mode to
the multicast address FF02::5.
● Other protocol packets, including DD, LSR, LSU, and
LSAck packets, are transmitted in unicast mode.
Point-to-point (P2P) Default network type if the link layer protocol is PPP,
HDLC, or LAPB.
Protocol packets, including Hello messages, DD, LSR,
LSU, and LSAck packets, are transmitted to the multicast
address FF02::5.
Stub Area
In stub areas, ABRs do not flood the received external routes. This reduces both
the size of routers' routing tables and the amount of routing information in
transmission.
Configuring a stub area is optional. Not all areas can be configured as stub areas.
Typically, a non-backbone area located at the AS boundary with only one ABR is
set to be a stub area.
To ensure the reachability of a destination outside the AS, the ABR in the stub
area generates a default route and advertises it to the non-ABR routers in that
stub area.
Note the following when configuring a stub area:
● The backbone area cannot be configured as a stub area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 389
● All routers in a stub area must be configured with the stub command.
● ASBRs cannot exist in stub areas, because it is not allowed to flood external
routes in stub areas.
● A virtual link cannot pass through a stub area.
OSPFv3 Route Summarization
Routing summarization decreases the amount of routing information and the size
of routing tables, improving the performance of routers.
The following is a description of OSPFv3 route summarization:
● Inter-area route summarization
Inter-area route summarization is performed on ABRs and applies to routes
from within an AS. An ABR generates Network-summary (Type 3) LSAs by
network segment while advertising routing information to other areas. If
network segments are contiguous, the ABR can summarize them into a single
segment. This allows the ABR to send only the summary LSA for all the
specified network segments.
● External route summarization
External route summarization is performed on ASBRs and is specific to
external routes that are imported into OSPF. ASBRs can summarize imported
AS-external (Type 5) LSAs within a summary address range. After an NSSA is
configured, an ASBR must summarize imported NSSA (Type 7) LSAs with the
summary address range.
Devices that are both ABRs and ASBRs summarize the Type 5 LSAs translated
from Type 7 LSAs.
OSPFv3 Virtual Link
A virtual link is a logical channel set up between two ABRs through a non-
backbone area.
● It must be configured on both ends of the link to take effect.
● The non-backbone area that provides an internal route for both the ends of
the virtual link is a transit area.
Non-backbone areas cannot always physically connect to the backbone area in
real-world situations. Configuring OSPFv3 virtual links resolves this problem.
A virtual link functions as a point-to-point connection between two ABRs. The
interfaces on the virtual link can be configured with parameters such as the hello
interval in the same way they are configured on physical interfaces.
Figure 6-2 OSPFv3 virtual link
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 390
Figure 6-2 shows the transmission of OSPFv3 packets between two ABRs. OSPFv3
devices between the two ABRs only transparently forward the OSPFv3 packets as
common IP packets when they detect that they are not the destinations of the
packets.
OSPFv3 Multi-Process
Multiple OSPFv3 processes can run on the same router because they are
independent of each other. Route interaction between different OSPFv3 processes
is similar to that between different routing protocols.
One interface on a router belongs to only one OSPFv3 process.
6.2.2 OSPFv3 GR
Graceful restart (GR) is a high availability (HA) technology used to ensure normal
traffic forwarding when a routing protocol restarts and guarantee that key services
are not affected in the process.
GR comprises a series of comprehensive technologies including fault-tolerant
redundancy, link protection, faulty node recovery, and traffic engineering. As a
redundancy technology, GR is widely used to ensure uninterrupted forwarding of
key data during active/standby switchovers and system upgrades.
If GR is not enabled, an active/standby switchover leads to intermittent
interruption of data forwarding. As a result, route flapping occurs on the whole
network. This is unacceptable on a large-scale network, especially on a carrier
network.
If GR is enabled, the forwarding plane continues to direct data forwarding when a
restart occurs. Then actions on the control plane, such as reestablishment of
neighbor relationships and route calculation, do not affect the forwarding plane.
Service interruption caused by route flapping is therefore prevented, which
improves network reliability.
Basic Concepts
● Grace-LSA
– OSPFv3 supports GR by flooding Grace-LSAs on the link.
– Grace-LSAs are used when GR starts and ends to inform neighbors of the
GR time, cause, and interface instance ID.
● Router role
– A router can function as a GR restarter, which has the GR capability and
restarts in GR mode.
– A router can function as a GR helper, which also has the GR capability
and helps the GR restarter to complete the GR process.
● GR implementation
– Planned GR: This refers to a graceful restart of OSPFv3 through the reset
ospfv3 graceful-restart command. In this mode, a Grace-LSA is sent to
the neighbor before the restart.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 391
– Unplanned GR: This refers to an active/standby switchover triggered by
router faults, such as loss of power, dead loops, exceptions, or master
resets.
Unlike planned GR, a Grace-LSA is not sent before the active/standby
switchover. Instead, the switchover is performed directly. When the
standby board becomes Up, a Grace-LSA is sent, and the GR process
starts.
GR Process
Figure 6-3 OSPFv3 planned GR process (reset ospfv3 graceful-restart)
Figure 6-4 OSPFv3 unplanned GR process (active/standby switchover)
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 392
● On the GR restarter:
1. In planned GR mode, the GR restarter sends a Grace-LSA to all neighbors to
inform them of the restart of a GR process and the duration and cause of this
process.
In unplanned GR mode, a Grace-LSA is sent to each neighbor immediately
after the standby board is Up. This informs the neighbors of the restart of a
GR process and the duration and cause of this process.
2. The GR restarter sets up new neighbor relationships by negotiating with
neighbors again.
3. When all neighbor relationships between the GR restarter and the original
neighbors enter the Full state:
– The GR restarter exits the GR process and OSPFv3 recalculates routes.
– The GR restarter updates its routing table on the main control board and
the forwarding information bases (FIBs) on interface boards. It also
deletes invalid routing entries.
– The GR restarter sends a Grace-LSA with an aging time of 3600 seconds
to instruct the GR helper to exit the GR process.
The GR process is now complete.
4. If errors occur during a GR process, the GR timer expires, or a neighbor
relationship fails to enter the Full state during the GR process, the GR
restarter exits the process and OSPFv3 is restarted in non-GR mode. This
causes packets loss.
● On the GR helper:
1. A router that is configured to support the GR process on its neighbor enters
the helper mode after receiving a Grace-LSA.
2. The GR helper maintains its neighbor relationship with the GR restarter, and
the status of the neighbor relationship does not change.
3. If the GR helper continues to receive Grace-LSAs whose GR period differs from
its own GR period, the GR helper updates its GR period to match that of the
received Grace-LSAs.
4. After the GR restarter informs the helper of the success of the GR process
through a Grace-LSA with an aging time of 3600 seconds, the GR helper exits
the GR process.
5. If errors occur during the GR process, the GR helper exits the helper state and
deletes invalid routes after route calculation.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 393
Comparison of OSPFv3 GR and Non-GR Modes
Table 6-5 Comparison of OSPFv3 GR and non-GR modes
Active/Standby Switchover in Non-
GR Mode
Active/Standby Switchover in GR
Mode
● OSPFv3 neighbor relationships are
reestablished.
● Routes are recalculated.
● The forwarding table changes.
● Route changes are sensed on the
network and route flapping
occurs over a short period of
time.
● Packets are lost during
forwarding, and services are
interrupted.
● OSPFv3 neighbor relationships are
reestablished.
● Routes are recalculated.
● The forwarding table does not
change.
● Route changes are not sensed, except
on the neighbor of the device where
the active/standby switchover occurs.
● Packets are not lost during
forwarding, and services are not
affected.
6.2.3 OSPFv3-BGP Synchronization
When a router is restarted or a new router is deployed on a network, network
traffic may be lost during Border Gateway Protocol (BGP) convergence. This is
because IGP convergence is faster than BGP convergence. OSPFv3-BGP
synchronization can solve this problem.
When a router on a BGP network recovers from a fault, BGP convergence is
performed again. Packets may be lost during the convergence.
Figure 6-5 shows traffic traversing a BGP network, passing through Router C from
RouterA to RouterD.
Figure 6-5 Traffic traversing a BGP network
If a fault occurs on RouterC, traffic is redirected to RouterB after rerouting. Packets
are lost when RouterC is restored to normal operating status.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 394
This is because OSPFv3 convergence is already complete when RouterC recovers,
and RouterC becomes the next hop on the route from RouterA to RouterD.
However, at this point, BGP convergence on RouterC is not complete, so RouterC
does not yet know the route to RouterD.
For this reason, when packets destined for RouterD are transmitted from RouterA
to RouterC, they are discarded by RouterC because it has no route to RouterD. This
is shown in Figure 6-6.
Figure 6-6 Packet loss upon device restart without OSPFv3-BGP synchronization
Process of OSPFv3-BGP synchronization
When a router enabled with OSPFv3-BGP synchronization restarts, it advertises a
message in the local OSPFv3 area instructing other routers not to use it as a
transit router.
At the same time, the router sets the cost value in its LSAs to 65535, the largest
value. This ensures that it is not used by other routers as a transit router. The BGP
route, however, can still reach the router.
6.2.4 OSPFv3 Neighbor Relationship Flapping Suppression
OSPFv3 neighbor relationship flapping suppression works by delaying OSPFv3
neighbor relationship reestablishment or setting the link cost to the maximum
value (65535).
Background
If the status of an interface carrying OSPFv3 services alternates between Up and
Down, OSPFv3 neighbor relationship flapping occurs on the interface. During the
flapping, OSPFv3 frequently sends Hello packets to reestablish the neighbor
relationship, synchronizes LSDBs, and recalculates routes. In this process, a large
number of packets are exchanged, adversely affecting neighbor relationship
stability, OSPFv3 services, and other OSPFv3-dependent services, such as LDP and
BGP. OSPFv3 neighbor relationship flapping suppression can address this problem
by delaying OSPFv3 neighbor relationship reestablishment or preventing service
traffic from passing through flapping links.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 395
Related Concepts
Flapping_event: reported when the status of a neighbor relationship on an
interface last changes from Full to a non-Full state. The flapping_event triggers
flapping detection.
Flapping_count: number of times flapping has occurred.
Detect-interval: detection interval. The interval is used to determine whether to
trigger a valid flapping_event.
Threshold: flapping suppression threshold. When the flapping_count reaches or
exceeds threshold, flapping suppression takes effect.
Resume-interval: interval for exiting from OSPFv3 neighbor relationship flapping
suppression. If the interval between two successive valid flapping_events is longer
than resume-interval, the flapping_count is reset.
Implementation
Flapping detection
Each OSPFv3 interface on which OSPFv3 neighbor relationship flapping
suppression is enabled starts a flapping counter. If the interval between two
flapping_events is shorter than the detect-interval, a valid flapping_event is
recorded, and the flapping_count is incremented by 1. When the flapping_count
reaches or exceeds threshold, flapping suppression takes effect. If the interval
between two successive neighbor status changes from Full to a non-Full state is
longer than resume-interval, the flapping_count is reset.
The detecting-interval, threshold, and resume-interval are configurable.
NOTE
The value of resume-interval must be greater than that of detecting-interval.
Flapping suppression
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes
during neighbor relationship establishment, interfaces prevent neighbor
relationships from being reestablished during the suppression period, which
minimizes LSDB synchronization attempts and packet exchanges.
● Hold-max-cost mode: If the traffic forwarding path changes frequently,
interfaces use 65535 as the cost of the flapping link during Hold-max-cost
suppression, which prevents traffic from passing through the flapping link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode.
By default, the Hold-max-cost mode takes effect. The mode and suppression
duration can be changed manually.
If an attack causes frequent neighbor relationship flapping, Hold-down mode can
minimize the impact of the attack.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 396
NOTE
When an interface enters the flapping suppression state, all neighbor relationships on the
interface enter the state accordingly.
Exiting from flapping suppression
Interfaces exit from flapping suppression in the following scenarios:
● The suppression timer expires.
● The corresponding OSPFv3 process is reset.
● An OSPFv3 neighbor is reset.
● OSPFv3 neighbor relationship flapping suppression is disabled globally.
● A command is run to exit from flapping suppression.
Typical Scenarios
Basic scenario
In Figure 6-7, the traffic forwarding path is SwitchA -> SwitchB -> SwitchC ->
SwitchE before a link failure occurs. After the link between SwitchB and SwitchC
fails, the forwarding path switches to SwitchA -> SwitchB -> SwitchD -> SwitchE. If
the neighbor relationship between SwitchB and SwitchC frequently flaps at the
early stage of the path switchover, the forwarding path will be switched
frequently, causing traffic loss and affecting network stability. If the neighbor
relationship flapping meets suppression conditions, flapping suppression takes
effect.
● If flapping suppression works in Hold-down mode, the neighbor relationship
between SwitchB and SwitchC is prevented from being reestablished during
the suppression period, in which traffic is forwarded along the path SwitchA -
> SwitchB -> SwitchD -> SwitchE.
● If flapping suppression works in Hold-max-cost mode, 65535 is used as the
cost of the link between SwitchB and SwitchC during the suppression period,
and traffic is forwarded along the path SwitchA -> SwitchB -> SwitchD ->
SwitchE.
Figure 6-7 Flapping suppression in a basic scenario
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 397
Single-forwarding path scenario
When only one forwarding path exists on the network, the flapping of the
neighbor relationship between any two switches on the path will interrupt traffic
forwarding. In Figure 6-8, the traffic forwarding path is SwitchA -> SwitchB ->
SwitchC -> SwitchE. If the neighbor relationship between SwitchB and SwitchC
flaps, and the flapping meets suppression conditions, flapping suppression takes
effect. However, if the neighbor relationship between SwitchB and SwitchC is
prevented from being reestablished, the whole network will be divided. Therefore,
Hold-max-cost mode (rather than Hold-down mode) is recommended. If flapping
suppression works in Hold-max-cost mode, 65535 is used as the cost of the link
between SwitchB and SwitchC during the suppression period. After the network
stabilizes and the suppression timer expires, the link is restored.
NOTE
By default, the Hold-max-cost mode takes effect.
Figure 6-8 Flapping suppression in a single-forwarding path scenario
Broadcast scenario
In Figure 6-9, four switches are deployed on the same broadcast network using
switches, and the switches are broadcast network neighbors. If SwitchC flaps due
to a link failure, and SwitchA and SwitchB were deployed at different time
(SwitchA was deployed earlier for example) or the flapping suppression
parameters on SwitchA and SwitchB are different, SwitchA first detects the
flapping and suppresses SwitchC. Consequently, the Hello packets sent by SwitchA
do not carry SwitchC's Switch ID. However, SwitchB has not detected the flapping
yet and still considers SwitchC a valid node. As a result, the DR candidates
identified by SwitchA are SwitchB and SwitchD, whereas the DR candidates
identified by SwitchB are SwitchA, SwitchC, and SwitchD. Different DR candidates
result in a different DR election result, which may lead to route calculation errors.
To prevent this problem in scenarios where an interface has multiple neighbors,
such as on a broadcast, P2MP, or NBMA network, all neighbors on the interface
are suppressed when the status of a neighbor relationship last changes to ExStart
or Down. Specifically, if SwitchC flaps, SwitchA, SwitchB, and SwitchD on the
broadcast network are all suppressed. After the network stabilizes and the
suppression timer expires, SwitchA, SwitchB, and SwitchD are restored to normal
status.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 398
Figure 6-9 Flapping suppression on a broadcast network
Multi-area scenario
In Figure 6-10, SwitchA, SwitchB, SwitchC, SwitchE, and SwitchF are connected in
area 1, and SwitchB, SwitchD, and SwitchE are connected in backbone area 0.
Traffic from SwitchA to SwitchF is preferentially forwarded along an intra-area
route, and the forwarding path is SwitchA -> SwitchB -> SwitchC -> SwitchE ->
SwitchF. When the neighbor relationship between SwitchB and SwitchC flaps and
the flapping meets suppression conditions, flapping suppression takes effect in the
default mode (Hold-max-cost). However, the forwarding path remains unchanged
because intra-area routes take precedence over inter-area routes during route
selection according to OSPFv3 route selection rules. To prevent traffic loss in
multi-area scenarios, configure Hold-down mode to prevent the neighbor
relationship between SwitchB and SwitchC from being reestablished during the
suppression period. During this period, traffic is forwarded along the path SwitchA
-> SwitchB -> SwitchD -> SwitchE -> SwitchF.
NOTE
By default, the Hold-max-cost mode takes effect. The mode can be changed to Hold-down
manually.
Figure 6-10 Flapping suppression in a multi-area scenario
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 399
6.2.5 OSPFv3 and OSPFv2 Comparison
The following aspects of OSPFv3 and OSPFv2 are the same:
● Network type and interface type
● Interface state machine and neighbor state machine
● LSDB
● Flooding mechanism
● Hello, DD, LSR, LSU, and LSAck packets
● Route calculation
The following aspects of OSPFv3 and OSPFv2 are different:
● OSPFv3 runs on IPv6, which is based on links rather than network segments.
This means that there is no need to configure OSPFv3 on interfaces in the
same network segment. It is only necessary that the interfaces enabled with
OSPFv3 are on the same link. Interfaces can also set up OSPFv3 sessions
without IPv6 global addresses.
● OSPFv3 does not depend on IP addresses.
This separates topology calculation from IP addresses. OSPFv3 calculates a
topology without knowing the IPv6 global address, which only applies to
virtual link interfaces for packet forwarding.
● OSPFv3 packets and the LSA format have the following changes:
– OSPFv3 packets do not contain IP addresses.
– OSPFv3 router LSAs and network LSAs do not contain IP addresses, which
are advertised by Type 8 LSAs and Type 9 LSAs.
– In OSPFv3, router IDs, area IDs, and LSA link state IDs no longer indicate
IP addresses, but the IPv4 address format is still reserved.
– In broadcast, NBMA, or P2MP networks, neighbors are identified by
router IDs instead of IP addresses.
● In OSPFv3, information about the flooding scope is added in the LSA Type
field.
This allows OSPFv3 routers to process LSAs of unidentified types, which
makes processing more flexible.
– OSPFv3 stores or floods unidentified packets, whereas OSPFv2 discards.
– OSPFv3 floods packets in an OSPF area or on a link. It sets the U flag bit
of packets (the flooding area is based on the link local) so that
unidentified packets are stored or forwarded to the stub area.
For example, RouterA and RouterB can identify LSA of a certain type. They are
connected through RouterC, which cannot identify this type of LSA. When
RouterA floods an LSA of this type, RouterC still floods it to RouterB even
though it cannot identify the LSA itself. RouterB then processes the LSA
normally.
If this occurred over OSPFv2, RouterC would discard the unidentified LSA, and
it would not reach RouterB.
● OSPFv3 supports multi-process on a link.
Only one OSPFv2 process can be configured on a physical interface, but
multiple OSPFv3 processes can be configured a single physical interface.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 400
These processes are identified by different instance IDs. They establish
neighbor relationships with the other end of the link and transmit packets to
the other end without interfering with each other.
The resources of a link can therefore be shared among OSPFv3 instances that
simulate multiple OSPFv3 routers. This allows more efficient use of limited
router resources.
● OSPFv3 uses IPv6 link-local addresses.
IPv6 implements neighbor discovery and automatic configuration based on
link-local addresses. Routers running IPv6 do not forward IPv6 packets whose
destination address is a link-local address. Those packets can only be
exchanged on the same link. The unicast link-local address starts from
FE80::/10.
As a routing protocol running on IPv6, OSPFv3 uses link-local addresses to
maintain neighbor relationships and update LSDBs. All OSPFv3 interfaces,
except Vlink interfaces, use link-local addresses as the source address and the
next hop address to transmit OSPFv3 packets.
The advantages are as follows:
– The OSPFv3 can calculate the topology without knowing the global IPv6
addresses.
– The packets flooded on a link are not transmitted to other links, which
prevents unnecessary flooding and saves bandwidth.
● OSPFv3 supports the following two new LSAs:
– Type 8 (Link) LSA: A router floods a link LSA on the link where it resides
to advertise its link-local address and the configured global IPv6 address.
– Type 9 (Intra-Area-Prefix) LSA: A router advertises an intra-area-prefix
LSA in the local OSPF area to inform other routers in the area or network
of its IPv6 global address. The network can be a broadcast network or an
NBMA network.
● OSPFv3 identifies neighbors based only on router IDs.
OSPF identifies neighbors based on IPv4 interface addresses in broadcast,
NBMA, P2P, and P2MP networks and identifies neighbors based on router IDs
in Vlink networks.
Since OSPFv3 identifies neighbors based only on router IDs, it can establish
and maintain neighbor relationships even when global IPv6 addresses are not
configured or are configured in different network segments. Topology
calculation is not based on IP addresses.
6.3 Summary of OSPFv3 Configuration Tasks
Table 6-6 describes the OSPFv3 configuration tasks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 401
Table 6-6 OSPFv3 configuration tasks
Scenario Description Task
Constructing a basic
OSPFv3 network
Enable the OSPFv3
process and specify the
router ID before
configuring OSPFv3.
After this is complete,
other OSPFv3 functions
can be configured or
take effect.
● 6.6 Configuring Basic
OSPFv3 Functions
● 6.7 Establishing and
Maintaining an
OSPFv3 Neighbor
Relationship
Configuring OSPFv3
special area attributes
You can flexibly use
OSPFv3 special area
attributes to deploy the
network according to
actual requirements. The
special areas are as
follows:
● 6.8 Configuring an
OSPFv3 Area
● 6.9 Configuring an
OSPFv3 NSSA
Configuring OSPFv3
route attributes
You can configure the
OSPFv3 route attributes
to change OSPFv3 route
selection policies. This
can help meet the
requirements of complex
network environments.
6.10 Configuring
OSPFv3 Route
Attributes
Controlling OSPFv3
routing information
You can configure route
summarization as well as
the filtering of received
and advertised routes.
Route summarization
lowers the number of
external routes in the
LSDB and provides
accurate control of
OSPFv3 routing
information.
6.11 Controlling
OSPFv3 Routing
Information
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 402
Scenario Description Task
Adjusting and optimizing
OSPFv3 networks
You can change the
OSPFv3 packet timer to
adjust the OSPFv3
network convergence
rate and network load
caused by protocol
packets. On some low-
rate links, the delay of
LSA transmission by
interfaces must be taken
into account. You can
adjust the Shortest Path
First (SPF) calculation
interval to restrict
resource consumption
caused by frequent
network changes.
6.12 Optimizing an
OSPFv3 Network
Configuring OSPFv3 GR You can enable OSPFv3
GR features to prevent
route flapping and
interruption of traffic
forwarding caused by an
OSPFv3 restart.
After OSPFv3 is
restarted, the GR
restarter and the GR
helper reestablish
neighbor relationships,
exchange routing
information, synchronize
the database, and
update the routing and
forwarding tables. This
implements fast OSPFv3
convergence.
6.15 Configuring
OSPFv3 GR
Improving OSPFv3
network security
On networks that require
high security, you can
configure the OSPFv3
Generalized TTL Security
Mechanism (GTSM) and
authentication mode to
improve network
security.
6.16 Improving OSPFv3
Network Security
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 403
Scenario Description Task
Configuring the OSPFv3
network management
function
OSPFv3 supports the
network management
function as well as fault
and log functions. You
can bind the OSPFv3
management
information base (MIB)
to a process to use these
functions.
6.19 Configuring the
Network Management
Function of OSPFv3
6.4 Licensing Requirements and Limitations for OSPFv3
Involved Network Elements
Other network elements are required to support OSPFv3.
Licensing Requirements
OSPFv3 is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support OSPFv3.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
Feature Limitations
None.
6.5 Default Settings for OSPFv3
Table 6-7 describes the default settings for OSPFv3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 404
Table 6-7 Default settings for OSPFv3
Parameter Default Setting
OSPFv3 Disabled
Interval at which Hello
packets are sent
● 10 seconds for the interfaces on the P2P and
broadcast networks
● 30 seconds for the interfaces on P2MP and
NBMA networks
Dead interval after which
OSPFv3 neighbor
relationships expire
● 40 seconds for the interfaces on the P2P and
broadcast networks
● 120 seconds for the interfaces on P2MP and
NBMA networks
Period during which a
switch acts as a stub router
500 seconds
Bandwidth reference value
used to calculate a link cost
100 Mbit/s
6.6 Configuring Basic OSPFv3 Functions
Applicable Environment
Configure basic OSPFv3 functions before building OSPFv3 networks. Enable
OSPFv3 and specify the interface, area ID, and router ID before configuring other
functions.
Pre-configuration Tasks
Before configuring basic OSPFv3 functions, complete the following tasks:
● Enable IPv6 capabilities.
● Make the network layers of the adjacent nodes accessible.
6.6.1 Enabling OSPFv3
Context
OSPFv3 supports multiple processes on a switch. These processes are
differentiated by process IDs. A process ID is set when OSPFv3 is enabled and is
only locally valid. It does not affect packet exchange with other switches.
A router ID is a 32-bit unsigned integer that uniquely identifies a switch within an
AS. It is expressed in the IPv4 address format. OSPFv3 router IDs must be
manually set. If the router ID is not set, OSPFv3 cannot function normally.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 405
Ensure that the router IDs of switches in an AS are all different. When multiple
OSPFv3 processes are enabled on a switch, specify a unique router ID for each
process.
Plan router IDs and manually configure them to ensure the stable operation of
OSPFv3.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ] [ vpn-instance
vpn-instance-name ]
OSPFv3 is enabled, and the OSPFv3 view is displayed.
Step 3 Run router-id
router-id
A router ID is set.
When configuring a router ID, ensure that the router ID is unique in an AS. You
can select the IP address of an interface as the router ID.
NOTE
If router IDs conflict in an OSPFv3 process, routers cannot establish OSPFv3 neighbor
relationships, and the routing information is incorrect.
If a router ID conflict occurs, perform either of the following operations:
● Reconfigure a router ID.
● Run the undo ospfv3 router-id auto-recover disable command to enable the
switch to automatically change the conflicted router ID to its own IP address.
NOTE
– After the undo ospfv3 router-id auto-recover disable command is run, the conflicting
router ID will be changed.
– After the router ID is changed, if the new router ID still conflicts with another one, the
switch is allowed to reconfigure one for a maximum of three times.
----End
6.6.2 Enabling OSPFv3 on an Interface
Context
After enabling OSPFv3 in the system view, enable OSPFv3 on an interface.
Because an interface has multiple instances, specify in which instance OSPFv3 is
enabled. If no instance ID is specified, the value defaults to 0. The same instance
must be enabled on interfaces between which the neighbor relationship is set up.
Perform the following operations on the switch that runs OSPFv3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 406
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3
process-id area
area-id [ instance
instance-id ]
OSPFv3 is enabled on the interface.
The area ID can be entered as a decimal integer or in the IPv4 address format, but
it is always displayed in the IPv4 address format.
Step 5 (Optional) Run the ospfv3 network-type { broadcast | nbma | p2mp [ non-
broadcast ] | p2p } [ instance
instance-id ] command to configure a network type
for the interface.
NOTE
When an interface supports multi-instances, you must specify the value of
instance-id when
enabling OSPFv3 on the interface. If the value of
instance-id is not specified, the default value 0
is used. In this case, the configured network type of an interface may not match the actual
network type of the interface. This step is mandatory in such a case.
----End
6.6.3 Entering an OSPFv3 Area View
Context
When configuring OSPFv3 switches in the same area, uniformly plan the
configuration data. Otherwise, neighbor switches cannot exchange information
with each other. This causes congestion of routing information or routing loops.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ] [ vpn-instance
vpn-instance-name ]
The OSPFv3 view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 407
Step 3 Run area
area-id
The OSPFv3 area view is displayed.
The area ID can be entered as a decimal integer or in the IPv4 address format.
However, it is displayed in the IPv4 address format.
An OSPFv3 area cannot be manually deleted. It is automatically deleted only after
all the configurations in the area view are cleared.
----End
6.6.4 (Optional) Configuring a Route Selection Rule
Context
RFC 5340 and RFC 1583 define route selection rules differently. After OSPFv3 is
enabled on a switch, you need to specify a route selection rule based on the
switch configuration. By default, a switch complies with the route selection rule
defined in RFC 5340. If the neighboring switch complies with the route selection
rule defined in RFC 1583, you need to configure the local switch to comply with
that defined in RFC 1583. This allows all switches in an OSPFv3 area to comply
with the same route selection rule.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ] [ vpn-instance
vpn-instance-name ]
The OSPF process view is displayed.
Step 3 Run rfc1583 compatible
The device is configured to comply with the route selection rules defined in RFC
1583, rather than RFC 5340.
By default, the switch complies with the route selection rules defined in RFC 5340.
----End
6.6.5 Verifying the Basic OSPFv3 Function Configuration
Prerequisites
Configuring basic OSPFv3 functions is complete.
Procedure
● Run the display ospfv3 [
process-id ] command to check the summary
information about the OSPFv3 process.
● Run the display ospfv3 [
process-id ] interface [ area
area-id ] [
interface-
type interface-number ] command to check the OSPFv3 interface information.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 408
● Run the following commands to check OSPFv3 LSDB information:
– display ospfv3 [
process-id ] lsdb [ area
area-id ] [ originate-router
advertising-router-id | self-originate ] [ { router | network | inter-router
[ asbr-router
asbr-router-id ] | { inter-prefix | nssa } [
ipv6-address
prefix-length ] | link | intra-prefix | grace } [
link-state-id ] ]
– display ospfv3 [
process-id ] lsdb [ originate-router
advertising-router-
id | self-originate ] external [
ipv6-address prefix-length ] [
link-state-
id ]
● Run the display ospfv3 [
process-id ] [ area
area-id ] peer [
interface-type
interface-number ] [ verbose ] command or display ospfv3 [
process-id ]
[ area
area-id ] peer
neighbor-id [ verbose ] command to check the
information about the OSPFv3 neighbor.
● Run the display ospfv3 [
process-id ] routing [ abr-routes | asbr-routes |
statistics |
ipv6-address prefix-length | intra-routes | inter-routes | ase-
routes | nssa-routes ] command to check the OSPFv3 routing table:
● Run the display ospfv3 [
process-id ] path command to check the paths to a
destination address.
● Run the display default-parameter ospfv3 command to check the default
OSPFv3 configuration.
----End
6.7 Establishing and Maintaining an OSPFv3 Neighbor
Relationship
Applicable Environment
Establishing and maintaining OSPFv3 neighbor relationships is necessary for the
construction of an OSPFv3 network. The configurations in this section allow you
to:
● Modify OSPFv3 timers to adjust the convergence speed of the OSPFv3
network and the network load caused by protocol packets.
● Configure the OSPFv3 retransmission limitation to prevent non-stop packet
retransmissions if the neighbor does not receive packets.
● Adjust the intervals for updating and receiving LSAs to speed up the
convergence of an OSPFv3 network.
Pre-configuration Tasks
Before establishing or maintaining an OSPFv3 neighbor relationship, configure
basic OSPFv3 functions.
6.7.1 Configuring an Interval at Which Hello Packets are Sent
Context
Hello packets are sent periodically to the neighbor switch to establish and
maintain a neighbor relationship and to elect a designated router (DR) and a
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 409
backup DR (BDR). RFC 2328 requires that the Hello timer values of neighbors be
consistent. The value of the Hello timer is inversely proportional to the route
convergence speed and network load.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 timer hello
interval [ conservative ] [ instance
instance-id ]
The interval at which Hello packets are sent is set on the interface.
----End
6.7.2 Configuring a Dead Time for a Neighbor Relationship
Context
A neighbor switch is considered invalid if a switch receives no Hello packets it for a
specified period of time. The period is called the dead time. The dead time on an
interface must be at least four times its Hello interval.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 410
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 timer dead
interval [ instance
instance-id ]
A dead time is specified for a neighbor relationship.
----End
6.7.3 Configuring an LSA Retransmission Interval
Context
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 timer retransmit
interval [ instance
instance-id ]
The interval for retransmitting LSAs to adjacent switches is set.
The value of
interval must be greater than the round trip time of one packet
transmitted between two switches.
NOTE
An excessively small LSA retransmission can cause unnecessary retransmissions.
----End
6.7.4 Configuring an LSA Transmission Delay
Context
LSAs age in the LSDB of a local switch but do not age in the transmission process.
Set a delay for LSA transmission. This is a necessary configuration for low-speed
networks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 411
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 trans-delay
interval [ instance
instance-id ]
A delay for LSA transmission is set on the interface.
----End
6.7.5 Verifying the OSPFv3 Neighbor Relationship
Establishment and Maintenance Configuration
Prerequisites
The configurations for establishing and maintaining an OSPFv3 neighbor
relationship have been completed.
Procedure
● Run the display ospfv3 [
process-id ] interface [ area
area-id ] [
interface-
type interface-number ] command to check the OSPFv3 interface information.
----End
6.8 Configuring an OSPFv3 Area
Applicable Environment
Define OSPFv3 areas to reduce the number of LSAs in the network and enhance
OSPFv3 extensibility. To further reduce the size of routing tables and number of
LSAs, specify some non-backbone areas at the edge of ASs as stub areas.
Pre-configuration Tasks
Before configuring OSPFv3 area attributes, configure basic OSPFv3 functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 412
6.8.1 Configuring an OSPFv3 Stub Area
Context
Perform the following operations on each switch that runs OSPFv3 in the area
that will be configured as a stub area:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
Step 3 Run area
area-id
The OSPFv3 area view is displayed.
Step 4 Run stub [ no-summary ]
The area is configured as a stub area.
Step 5 (Optional) Run default-cost
cost
The cost of the default route sent to the stub area is set.
By default, this cost is 1.
Perform this step only on the ABR in the stub area.
The parameter no-summary takes effect only when the stub command is
configured on the ABR. If this parameter is configured, the ABR only sends the
summary-LSA of a default route to the stub area. It does not generate other
summary-LSAs, such as AS-external-LSAs or Summary-LSAs. This area is called a
totally stub area.
----End
6.8.2 Configuring OSPFv3 Virtual Links
Context
After an OSPFv3 area is defined, OSPFv3 route updates between non-backbone
areas are implemented through a backbone area. OSPFv3 requires all non-
backbone areas to maintain connectivity with the backbone area and the
backbone area to maintain its own connectivity as well. If this requirement cannot
be met, configure OSPFv3 virtual links.
A virtual link must be configured at both ends of the link, or it will not take effect.
Perform the following operations on the switch that runs OSPFv3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 413
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.