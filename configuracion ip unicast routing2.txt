Task
Command Reference
Configure a
summarized
BGP4+ route and
apply a route-
policy to it.
aggregate
ipv6-address
prefix-length [ as-set |
attribute-policy
route-
policy-name1 | detail-
suppressed | origin-policy
route-policy-name2 |
suppress-policy
route-
policy-name3 ] *
9.13 Configuring
BGP Route
Summarization
Configure BGP4+
route
dampening and
apply
dampening
parameters to
the routes that
match a route-
policy.
dampening [
half-life-reach
reuse suppress ceiling |
route-policy
route-policy-
name ] *
-
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1004
Configuration
Task
Command Reference
Configure BGP4+
to import routes
that match a
route-policy
from another
routing protocol.
import-route
protocol
[
process-id ] [ med
med |
route-policy
route-policy-
name ] *
9.6.5 Configuring
BGP to Import
Routes
Import local
routes that
match a route-
policy to the
BGP4+ routing
table and
advertise them
to BGP4+ peers.
network
ipv6-address
prefix-length [ route-policy
route-policy-name ]
9.6.5 Configuring
BGP to Import
Routes
Enable BGP4+
route recursion
based on a
route-policy.
nexthop recursive-lookup
route-policy
route-policy-
name
9.9.2 Configuring
the Next_Hop
Attribute
Configure a
device to send a
default route to
a peer or a peer
group and use a
route-policy to
modify the
attributes of the
default route.
peer {
group-name |
ipv6-
address } default-route-
advertise [ route-policy
route-policy-name ]
9.14 Configuring
BGP to Advertise
Default Routes to
Peers
Configure a
device to accept
the routes that
match a route-
policy from a
peer or peer
group or
advertise the
routes that
match a route-
policy to a peer
or peer group.
peer {
group-name |
ipv6-
address } route-policy
route-policy-name { import
| export }
9.10.2 Controlling
the Advertisement
of BGP Routes
9.10.3 Controlling
the Receiving of
BGP Routes
Use a route-
policy to set a
BGP4+ priority.
preference route-policy
route-policy-name
9.9.1 Configuring
the BGP Priority
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1005
Configuration
Task
Command Reference
Prevent the
BGP4+ routes
that match a
route-policy
from being
added to the
IPv6 routing
table.
routing-table rib-only
[ route-policy
route-policy-
name ]
-
● Apply a route-policy to multicast routes.
a. Run the system-view command to enter the system view.
b. Run the ip rpf-route-static [ vpn-instance
vpn-instance-name ]
source-
address {
mask |
mask-length } [ isis
process-id | ospf
process-id | rip
process-id | bgp | static ] [ route-policy
route-policy-name ] {
interface-
type interface-number |
gateway-address } [ preference
preference ]
[ order
order-number ] command to configure multicast static routes and
use route-policy
route-policy-name to configure matching rules of
multicast static routes.
For details on how to configure multicast static routes, see Configuring a
Multicast Static Route.
● Apply a route-policy to BGP/MPLS IP VPN routes.
– To apply a route-policy in the BGP view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the bgp {
as-number-plain |
as-number-dot } command to enter
the BGP view.
iii. Run the ingress-lsp trigger route-policy
route-policy-name
command to enable the function of establishing ingress LSPs for
labeled BGP routes based on a route-policy.
On a MAN where the hybrid access mode is used, a large number of
BGP labeled routes are used to establish end-to-end LSPs. Some
intermediate nodes do not need to carry VPN services, but excessive
ingress LSPs are created, wasting network resources. In this situation,
run this command to establish ingress LSPs based on a route-policy
to reduce network resource consumption.
– To apply a route-policy in the VPN instance view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the ip vpn-instance
vpn-instance-name command to enter the
VPN instance view.
iii. Perform either of the following operations as required:
○ To associate the current VPN instance address family with one
export route-policy, run the export route-policy
route-policy-
name command. Only one route-policy can be associated, and
the last associated route-policy takes effect.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1006
The export command can control route transmission between
different VPN instances on a PE, while the peer route-policy
export command can control only the VPNv4 or VPNv6 routes
that a PE sends to other PE peers.
○ To associate the current VPN instance address family with one
import route-policy, run the import route-policy
route-policy-
name command. Only one route-policy can be associated, and
the last associated route-policy takes effect.
The import route-policy command can control route receiving
between different VPN instances on a PE, while the peer route-
policy import command can control only the VPNv4 or VPNv6
routes that a PE sends to other PE peers.
● Apply a route-policy to an FRR scenario.
– For route-policy applications in IP FRR on the public network, see
Configuring IP FRR on the Public Network.
– For route-policy applications in IP FRR for VPN routes, see Configuring IP
FRR for VPN Routes.
– For route-policy applications in IP+VPNv4 hybrid FRR, see Configuring IP
+VPNv4 Hybrid FRR.
– For route-policy applications in VPN FRR, see Configuring VPN FRR.
----End
10.6.6 Verifying the Routing Policy Configuration
Procedure
● Run the display route-policy [
route-policy-name ] command to check
information about the route-policy.
----End
10.7 Configuring Filter-Policy
Pre-configuration Tasks
Before configuring a filter-policy, configure routing protocols.
Configuration Procedure
You can configure a filter-policy to filter the routes to be received or advertised.
Choose one of the following configurations as needed:
10.7.1 Applying Filters to Received Routes
Procedure
● Configuring RIP to filter received routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1007
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Depending on type of desired filtering, run one of following commands
to configure RIP to filter the received routes:
▪ Run filter-policy {
acl-number | acl-name
acl-name } import
[
interface-type interface-number ]
Learned routing information is filtered based on an ACL.
▪ Run filter-policy gateway
ip-prefix-name import
Routing information advertised by neighbors is filtered based on the
IP prefix list.
▪ Run filter-policy ip-prefix
ip-prefix-name [ gateway
ip-prefix-
name ] import [
interface-type interface-number ]
Routes learned by the specified interface are filtered based on the IP
prefix list and neighbors.
● Configuring OSPF to filter received routes
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-
name | route-policy
route-policy-name [ secondary ] } import
OSPF is configured to filter received routes.
▪ The
acl-number parameter specifies the number of a basic ACL.
▪ The acl-name
acl-name parameter specifies the name of an ACL.
▪ The ip-prefix
ip-prefix-name parameter specifies the name of an IP
prefix list.
The filter-policy import command filters the routes calculated by OSPF
but cannot filter advertised or received LSAs. Only the routes that pass
the filtering criteria are added to the OSPF routing table. However, routes
that do not pass the filtering criteria are not added to the OSPF routing
table but can still be advertised.
● Configuring IS-IS to filter received routes
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
c. Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-
name | route-policy
route-policy-name } import
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1008
IS-IS routes that match the filter-policy are delivered to the IP routing
table.
● Configure the BGP device to filter the routes received from all its peers or
peer groups.
a. Run system-view
The system view is displayed.
b. Run bgp {
as-number-plain |
as-number-dot }
The BGP view is displayed.
c. Enter the corresponding address family view based on network type to
configure BGP devices on networks.
▪ Run ipv4-family { unicast | multicast }
The IPv4 address family view is displayed.
▪ Run ipv6-family [ unicast ]
The IPv6 address family view is displayed.
d. Perform either of the following operations to configure the BGP device to
filter the routes received from all its peers or peer groups:
▪ To filter routes based on an ACL, run the filter-policy {
acl-number |
acl-name
acl-name } import or the filter-policy {
acl6-number |
acl6-name
acl6-name } import command.
▪ To filter routes based on an IP prefix list, run the filter-policy ip-
prefix
ip-prefix-name import or the filter-policy ipv6-prefix
ipv6-
prefix-name import command.
NOTE
If an ACL has been referenced in the filter-policy command but no VPN instance
is specified in the ACL rule, BGP will filter routes including public and private
network routes in all address families. If a VPN instance is specified in the ACL
rule, only the data traffic from the VPN instance will be filtered, and no route of
this VPN instance will be filtered.
● Configure BGP to filter the routes received from a specified peer or peer
group.
a. Run system-view
The system view is displayed.
b. Run bgp {
as-number-plain |
as-number-dot }
The BGP view is displayed.
c. Enter the corresponding address family view based on network type to
configure BGP devices on networks.
▪ Run ipv4-family { unicast | multicast }
The IPv4 address family view is displayed.
▪ Run ipv6-family [ unicast ]
The IPv6 address family view is displayed.
d. Perform any of the following operations to configure the BGP device to
filter the routes received from a specific peer or peer group:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1009
▪ To filter routes based on an ACL, run the peer {
group-name |
ipv4-
address |
ipv6-address } filter-policy {
acl-number | acl-name
acl-
name |
acl6-number | acl6-name
acl6-name } import command.
▪ To filter routes based on an IP prefix list, run the peer {
ipv4-address
|
group-name } ip-prefix
ip-prefix-name import or the peer {
group-
name |
ipv4-address |
ipv6-address } ipv6-prefix
ipv6-prefix-name
import command.
▪ To filter routes based on an AS_Path filter, run the peer {
ipv4-
address |
group-name |
ipv6-address } as-path-filter {
as-path-filter-
number |
as-path-filter-name } import command.
▪ To filter routes based on a route-policy, run the peer {
ipv4-address |
group-name |
ipv6-address } route-policy
route-policy-name import
command.
NOTE
The routing policy applied in the peer route-policy import command does not
support a specific interface as one matching rule. That is, the routing policy does
not support the if-match interface command.
NOTICE
If the number of routes received by the local device exceeds the upper
limit and the peer route-limit command is used for the first time, the
local device and its peer reestablish the peer relationship, regardless of
whether alert-only is set.
e. (Optional) Run peer {
group-name |
ipv4-address |
ipv6-address } route-
limit
limit [
percentage ] [ alert-only | idle-forever | idle-timeout
times ]
The maximum number of routes that can be received from the peer or
peer group is set.
----End
10.7.2 Applying Filters to Advertised Routes
Procedure
● Configuring RIP to filter advertised routes
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-
name } export [
protocol [
process-id ] |
interface-type interface-
number ]
Imported routes are filtered before being advertised.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1010
Routing information advertised by RIP may contain the routing
information imported from other protocols. You can use the
protocol
parameter to filter the routing information imported from a specified
routing protocol. If the
protocol parameter is not used, all the routes
advertised by RIP are filtered, including imported routes and local routes
(direct routes).
NOTE
RIP-2 defines a 16-bit tag, while other routing protocols define 32-bit tags. If the
routes of other routing protocols are imported into RIP and the tag is used in the
routing policy, the tag value cannot exceed 65535. If the tag value exceeds
65535, the routing policy becomes invalid or the matching result is incorrect.
● Configuring OSPF to filter advertised routes
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-
name | route-policy
route-policy-name } export [
protocol [
process-
id ] ]
OSPF is configured to filter the routes imported using the import-route
command. Only the routes that pass the filtering criteria are advertised.
▪ The
acl-number parameter specifies the number of a basic ACL.
▪ The acl-name
acl-name parameter specifies the name of an ACL.
▪ The ip-prefix
ip-prefix-name parameter specifies the name of an IP
prefix list.
▪ The route-policy
route-policy-name parameter specifies the name of
a route policy.
To filter the routes of a specific routing protocol or OSPF process, specify
the
protocol [
process-id ] parameter. If this parameter is not specified,
OSPF filters all the imported routes.
NOTE
● The import-route command cannot import external default routes.
● OSPF filters imported routes and generates Type 5 LSAs to advertise only
external routes that pass the filtering criteria.
● Configuring IS-IS to filter advertised routes
a. Run system-view
The system view is displayed.
b. Run isis [
process-id ]
The IS-IS view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1011
c. Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-
name | route-policy
route-policy-name } export [
protocol [
process-
id ] ]
IS-IS is configured to advertise the external routes that meet specified
conditions to the IS-IS routing domain.
● Configure the BGP device to filter the routes advertised by all its peers or peer
groups.
You can configure a BGP device to filter routes to be advertised.
a. Run system-view
The system view is displayed.
b. Run bgp {
as-number-plain |
as-number-dot }
The BGP view is displayed.
c. Enter the corresponding address family view based on network type to
configure BGP devices on networks.
▪ Run ipv4-family { unicast | multicast }
The IPv4 address family view is displayed.
▪ Run ipv6-family [ unicast ]
The IPv6 address family view is displayed.
d. Perform either of the following operations to configure the BGP device to
advertise routes to all peers or peer groups:
▪ To filter routes based on an ACL, run the filter-policy {
acl-number |
acl-name
acl-name } export [
protocol [
process-id ] ] or the filter-
policy {
acl6-number | acl6-name
acl6-name } export [
protocol
[
process-id ] ] command.
▪ To filter routes based on an IP prefix list, run the filter-policy ip-
prefix
ip-prefix-name export [
protocol [
process-id ] ] or the filter-
policy ipv6-prefix
ipv6-prefix-name export [
protocol [
process-id ] ]
command.
NOTE
If an ACL has been referenced in the filter-policy command but no VPN instance
is specified in the ACL rule, BGP will filter routes including public and private
network routes in all address families. If a VPN instance is specified in the ACL
rule, only the data traffic from the VPN instance will be filtered, and no route of
this VPN instance will be filtered.
● Configure BGP to filter the routes advertised by a specified peer or peer
group.
a. Run system-view
The system view is displayed.
b. Run bgp {
as-number-plain |
as-number-dot }
The BGP view is displayed.
c. Enter the corresponding address family view based on network type to
configure BGP devices on networks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1012
▪ Run ipv4-family { unicast | multicast }
The IPv4 address family view is displayed.
▪ Run ipv6-family [ unicast ]
The IPv6 address family view is displayed.
d. Perform any of the following operations to configure the BGP device to
advertise routes to a specific peer or peer group:
▪ To filter routes based on an ACL, run the peer {
group-name |
ipv4-
address |
ipv6-address } filter-policy {
acl-number | acl-name
acl-
name |
acl6-number | acl6-name
acl6-name } export command.
▪ To filter routes based on an IP prefix list, run the peer {
ipv4-address
|
group-name } ip-prefix
ip-prefix-name export or the peer {
group-
name |
ipv4-address |
ipv6-address } ipv6-prefix
ipv6-prefix-name
export command.
▪ To filter routes based on an AS_Path filter, run the peer {
ipv4-
address |
group-name |
ipv6-address } as-path-filter {
as-path-filter-
number |
as-path-filter-name } export command.
▪ To filter routes based on a route-policy, run the peer {
ipv4-address |
group-name |
ipv6-address } route-policy
route-policy-name export
command.
NOTE
The routing policy applied in the peer route-policy export command does not
support a specific interface as one matching rule. That is, the routing policy does
not support the if-match interface command.
----End
10.8 Controlling the Valid Time of Routing Policies
Pre-configuration Tasks
None
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run route-policy-change notify-delay
delay-time
The delay in applying the routing policy is set.
The value ranges from 1 to 180, in seconds.
By default, the RM immediately instructs protocols to apply a new policy when the
existing routing policy changes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1013
Step 3 Run quit
Return to the user view.
Step 4 (Optional) Run refresh bgp all { export | import }
BGP is configured to apply the new routing policy.
After a routing policy is configured, to make policy-based filtering take effect
immediately, use this command to configure BGP to apply the new policy
immediately.
The policies affected by the timer are ACLs, IP prefix lists, AS_Path filters,
community filters, extended community filters, RD filters, and route-policies.
----End
Verifying the Configuration
● Run the display current-configuration | include notify-delay command to
check the delay in applying a routing policy.
10.9 Maintaining Routing Policies
Context
NOTICE
Statistics of IP prefix lists cannot be restored after being cleared. Exercise caution
when running these commands.
Procedure
● Run reset ip ip-prefix [
ip-prefix-name ] command in the user view to clear
IPv4 prefix list statistics.
● Run reset ip ipv6-prefix [
ipv6-prefix-name ] command in the user view to
clear IPv6 prefix list statistics.
----End
10.10 Configuration Examples for Routing Policies
10.10.1 Example for Filtering the Routes to Be Received or
Advertised
Networking Requirements
Figure 10-19 shows how on an OSPF network, SwitchA receives routes from the
Internet and provides these routes for the OSPF network. A user wants devices on
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1014
the OSPF network to access only the network segments 172.16.17.0/24,
172.16.18.0/24, and 172.16.19.0/24, and SwitchC to access only the network
segment 172.16.18.0/24.
Figure 10-19 Networking diagram for filtering the received and advertised routes
Device Interface VLANIF Interface IP Address
SwitchA GE0/0/1 VLANIF10 192.168.1.1/24
SwitchB GE0/0/1 VLANIF10 192.168.1.2/24
SwitchB GE0/0/2 VLANIF20 192.168.2.1/24
SwitchC GE0/0/1 VLANIF20 192.168.2.2/24
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure a routing policy on SwitchA and apply the routing policy during
route advertisement. When routes are advertised, the routing policy allows
SwitchA to provide routes from network segments 172.16.17.0/24,
172.16.18.0/24, and 172.16.19.0/24 for SwitchB, and allows devices on the
OSPF network to access the three network segments.
2. Configure a routing policy on SwitchC and apply the routing policy during
route importing. When routes are imported, the routing policy allows SwitchC
to receive only the routes from the network segment 172.16.18.0/24 and
access this network segment.
Procedure
Step 1 Add interfaces to VLANs.
# Configure SwitchA. Ensure that the configurations of SwitchB and SwitchC are
the same as the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1015
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign IP addresses to VLANIF interfaces.
# Configure SwitchA. Ensure that the configurations of SwitchB and SwitchC are
the same as the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure basic OSPF functions.
# Configure SwitchA.
[SwitchA] ospf
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] quit
# Configure SwitchB.
[SwitchB] ospf
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf
[SwitchC-ospf-1] area 0
[SwitchC-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] quit
[SwitchC-ospf-1] quit
Step 4 Configure five static routes on SwitchA and import these routes into OSPF.
[SwitchA] ip route-static 172.16.16.0 24 NULL 0
[SwitchA] ip route-static 172.16.17.0 24 NULL 0
[SwitchA] ip route-static 172.16.18.0 24 NULL 0
[SwitchA] ip route-static 172.16.19.0 24 NULL 0
[SwitchA] ip route-static 172.16.20.0 24 NULL 0
[SwitchA] ospf
[SwitchA-ospf-1] import-route static
[SwitchA-ospf-1] quit
# Check the IP routing table on SwitchB. You can see that the five static routes are
imported into OSPF.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 11 Routes : 11
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.16.0/24 O_ASE 150 1 D 192.168.1.1 Vlanif10
172.16.17.0/24 O_ASE 150 1 D 192.168.1.1 Vlanif10
172.16.18.0/24 O_ASE 150 1 D 192.168.1.1 Vlanif10
172.16.19.0/24 O_ASE 150 1 D 192.168.1.1 Vlanif10
172.16.20.0/24 O_ASE 150 1 D 192.168.1.1 Vlanif10
192.168.1.0/24 Direct 0 0 D 192.168.1.2 Vlanif10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1016
192.168.1.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.2.0/24 Direct 0 0 D 192.168.2.1 Vlanif20
192.168.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
Step 5 Configure a policy for advertising routes.
# Configure an IP prefix list named a2b on SwitchA.
[SwitchA] ip ip-prefix a2b index 10 permit 172.16.17.0 24
[SwitchA] ip ip-prefix a2b index 20 permit 172.16.18.0 24
[SwitchA] ip ip-prefix a2b index 30 permit 172.16.19.0 24
# Configure a policy for advertising routes on SwitchA, and use the IP prefix list
a2b to filter routes.
[SwitchA] ospf
[SwitchA-ospf-1] filter-policy ip-prefix a2b export static
# Check the IP routing table on SwitchB. You can see that SwitchB receives only
three routes defined in a2b.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 9 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.17.0/24 O_ASE 150 1 D 192.168.1.1 Vlanif10
172.16.18.0/24 O_ASE 150 1 D 192.168.1.1 Vlanif10
172.16.19.0/24 O_ASE 150 1 D 192.168.1.1 Vlanif10
192.168.1.0/24 Direct 0 0 D 192.168.1.2 Vlanif10
192.168.1.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.2.0/24 Direct 0 0 D 192.168.2.1 Vlanif20
192.168.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
Step 6 Configure a policy for receiving routes.
# Configure an IP prefix list named in on SwitchC.
[SwitchC] ip ip-prefix in index 10 permit 172.16.18.0 24
# Configure a policy for receiving routes on SwitchC, and use the IP prefix list in to
filter routes.
[SwitchC] ospf
[SwitchC-ospf-1] filter-policy ip-prefix in import
[SwitchC-ospf-1] quit
# Check the IP routing table on SwitchC. You can see that the IP routing table
contains only one route defined in the IP prefix list in.
[SwitchC] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 5 Routes : 5
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.18.0/24 O_ASE 150 1 D 192.168.2.1 Vlanif20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1017
192.168.2.0/24 Direct 0 0 D 192.168.2.2 Vlanif20
192.168.2.2/32 Direct 0 0 D 127.0.0.1 Vlanif20
----End
Configuration Files
● Configuration file of SwitchA
#
sysname SwitchA
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1
filter-policy ip-prefix a2b export static
import-route static
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
ip ip-prefix a2b index 10 permit 172.16.17.0 24
ip ip-prefix a2b index 20 permit 172.16.18.0 24
ip ip-prefix a2b index 30 permit 172.16.19.0 24
#
ip route-static 172.16.16.0 255.255.255.0 NULL0
ip route-static 172.16.17.0 255.255.255.0 NULL0
ip route-static 172.16.18.0 255.255.255.0 NULL0
ip route-static 172.16.19.0 255.255.255.0 NULL0
ip route-static 172.16.20.0 255.255.255.0 NULL0
#
return
● Configuration file of SwitchB
#
sysname SwitchB
#
vlan batch 10 20
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif20
ip address 192.168.2.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1
area 0.0.0.0
network 192.168.1.0 0.0.0.255
network 192.168.2.0 0.0.0.255
#
return
● Configuration file of SwitchC
#
sysname SwitchC
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1018
#
vlan batch 20
#
interface Vlanif20
ip address 192.168.2.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1
filter-policy ip-prefix in import
area 0.0.0.0
network 192.168.2.0 0.0.0.255
#
ip ip-prefix in index 10 permit 172.16.18.0 24
#
return
10.10.2 Example for Applying a Routing Policy for Importing
Routes
Networking Requirements
In Figure 10-20, SwitchB exchanges routing information with SwitchA through
OSPF, and with SwitchC through IS-IS. A user wants SwitchB to import IS-IS routes
into the OSPF network. The user also wants the route to 172.17.1.0/24 on the
OSPF network to have a low preference and the route to 172.17.2.0/24 to have a
tag, making it easy to reference by a routing policy.
Figure 10-20 Networking diagram for applying a routing policy for importing
routes
Device Interface VLANIF
Interface
IP Address
SwitchA GE0/0/1 VLANIF10 192.168.1.1/24
SwitchB GE0/0/1 VLANIF10 192.168.1.2/24
SwitchB GE0/0/2 VLANIF20 192.168.2.2/24
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1019
SwitchC GE0/0/1 VLANIF20 192.168.2.1/24
SwitchC GE0/0/2 VLANIF30 172.17.1.1/24
SwitchC GE0/0/3 VLANIF40 172.17.2.1/24
SwitchC GE0/0/4 VLANIF50 172.17.3.1/24
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure a routing policy on SwitchB, set the cost of the route to
172.17.1.0/24 to 100, and apply the routing policy when OSPF imports IS-IS
routes. The routing policy allows the route to 172.17.1.0/24 to have a low
preference.
2. Configure a routing policy on SwitchB, set the tag of the route to
172.17.2.0/24 to 20, and apply the routing policy when OSPF imports IS-IS
routes. This allows the tag of the route to 172.17.2.0/24 to take effect,
making it easy to reference by a routing policy.
Procedure
Step 1 Add interfaces to VLANs.
# Configure SwitchA. Ensure that the configurations of SwitchB, and SwitchC are
the same as the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign IP addresses to VLANIF interfaces.
# Configure SwitchA. Ensure that the configurations of SwitchB, and SwitchC are
the same as the configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure IS-IS.
# Configure SwitchC.
[SwitchC] isis
[SwitchC-isis-1] is-level level-2
[SwitchC-isis-1] network-entity 10.0000.0000.0001.00
[SwitchC-isis-1] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] isis enable
[SwitchC-Vlanif20] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] isis enable
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1020
[SwitchC-Vlanif30] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] isis enable
[SwitchC-Vlanif40] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] isis enable
[SwitchC-Vlanif50] quit
# Configure SwitchB.
[SwitchB] isis
[SwitchB-isis-1] is-level level-2
[SwitchB-isis-1] network-entity 10.0000.0000.0002.00
[SwitchB-isis-1] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] isis enable
[SwitchB-Vlanif20] quit
Step 4 Configure OSPF and import routes.
# Configure SwitchA and enable OSPF.
[SwitchA] ospf
[SwitchA-ospf-1] area 0
[SwitchA-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchA-ospf-1-area-0.0.0.0] quit
[SwitchA-ospf-1] quit
# Configure SwitchB, enable OSPF, and import IS-IS routes.
[SwitchB] ospf
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] import-route isis 1
[SwitchB-ospf-1] quit
# Check the OSPF routing table on SwitchA. You can see the imported routes.
[SwitchA] display ospf routing
OSPF Process 1 with Router ID 192.168.1.1
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
192.168.1.0/24 1 Transit 192.168.1.1 192.168.1.1 0.0.0.0
Routing for ASEs
Destination Cost Type Tag NextHop AdvRouter
172.17.1.0/24 1 Type2 1 192.168.1.2 192.168.1.2
172.17.2.0/24 1 Type2 1 192.168.1.2 192.168.1.2
172.17.3.0/24 1 Type2 1 192.168.1.2 192.168.1.2
192.168.2.0/24 1 Type2 1 192.168.1.2 192.168.1.2
Total Nets: 5
Intra Area: 1 Inter Area: 0 ASE: 4 NSSA: 0
Step 5 Set the filtering list.
# Configure ACL 2002 to match 172.17.2.0/24.
[SwitchB] acl number 2002
[SwitchB-acl-basic-2002] rule permit source 172.17.2.0 0.0.0.255
[SwitchB-acl-basic-2002] quit
# Configure an IP prefix list named prefix-a to match 172.17.1.0/24.
[SwitchB] ip ip-prefix prefix-a index 10 permit 172.17.1.0 24
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1021
Step 6 Configure a routing policy.
[SwitchB] route-policy isis2ospf permit node 10
[SwitchB-route-policy] if-match ip-prefix prefix-a
[SwitchB-route-policy] apply cost 100
[SwitchB-route-policy] quit
[SwitchB] route-policy isis2ospf permit node 20
[SwitchB-route-policy] if-match acl 2002
[SwitchB-route-policy] apply tag 20
[SwitchB-route-policy] quit
[SwitchB] route-policy isis2ospf permit node 30
[SwitchB-route-policy] quit
Step 7 Apply the routing policy when routes are imported.
# Configure SwitchB and apply the routing policy when routes are imported.
[SwitchB] ospf
[SwitchB-ospf-1] import-route isis 1 route-policy isis2ospf
[SwitchB-ospf-1] quit
# Check the OSPF routing table on SwitchA. You can see that the cost of the route
to 172.17.1.0/24 is 100; the tag of the route to 172.17.2.0/24 is 20; other route
attributes remain unchanged.
[SwitchA] display ospf routing
OSPF Process 1 with Router ID 192.168.1.1
Routing Tables
Routing for Network
Destination Cost Type NextHop AdvRouter Area
192.168.1.0/24 1 Transit 192.168.1.1 192.168.1.1 0.0.0.0
Routing for ASEs
Destination Cost Type Tag NextHop AdvRouter
172.17.1.0/24 100 Type2 1 192.168.1.2 192.168.1.2
172.17.2.0/24 1 Type2 20 192.168.1.2 192.168.1.2
172.17.3.0/24 1 Type2 1 192.168.1.2 192.168.1.2
192.168.2.0/24 1 Type2 1 192.168.1.2 192.168.1.2
Total Nets: 5
Intra Area: 1 Inter Area: 0 ASE: 4 NSSA: 0
----End
Configuration Files
● Configuration file of SwitchA
#
sysname SwitchA
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
ospf 1
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
return
● Configuration file of SwitchB
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1022
#
sysname SwitchB
#
vlan batch 10 20
#
acl number 2002
rule 5 permit source 172.17.2.0 0.0.0.255
#
isis 1
is-level level-2
network-entity 10.0000.0000.0002.00
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif20
ip address 192.168.2.2 255.255.255.0
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ospf 1
import-route isis 1 route-policy isis2ospf
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
route-policy isis2ospf permit node 10
if-match ip-prefix prefix-a
apply cost 100
#
route-policy isis2ospf permit node 20
if-match acl 2002
apply tag 20
#
route-policy isis2ospf permit node 30
#
ip ip-prefix prefix-a index 10 permit 172.17.1.0 24
#
return
● Configuration file of SwitchC
#
sysname SwitchC
#
vlan batch 20 30 40 50
#
isis 1
is-level level-2
network-entity 10.0000.0000.0001.00
#
interface Vlanif20
ip address 192.168.2.1 255.255.255.0
isis enable 1
#
interface Vlanif30
ip address 172.17.1.1 255.255.255.0
isis enable 1
#
interface Vlanif40
ip address 172.17.2.1 255.255.255.0
isis enable 1
#
interface Vlanif50
ip address 172.17.3.1 255.255.255.0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1023
isis enable 1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 50
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1024
11 IP Routing Table Management
11.1 Licensing Requirements and Limitations for IP Routing Table Management
11.2 Managing IP Routing Tables
11.3 Example for Configuring IP FRR on the Public Network
11.1 Licensing Requirements and Limitations for IP
Routing Table Management
Involved Network Elements
Other network elements are not required.
Licensing Requirements
The number of IPv4 FIB entries supported by the S5720-HI and S5730-HI depends
on licenses. For the maximum number of IPv4 FIB entries, contact the equipment
supplier.
For details about how to apply for a license, see Applying for Licenses in the
S1720, S5700, and S6700 Series Switches License Usage Guide.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support IP Routing Table Management.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1025
Feature Limitations
When the S6720-SI, S6720S-S, S6720S-SI, S5730-SI, S5735S-H, S5736-S, S5730S-EI,
S6720-LI, and S6720S-LI function as route-based forwarding devices, you are
advised to use them in the following typical route-based forwarding scenarios:
● IPv4 routes: Among all routing entries, there are no more than 1500 types of
16-bit prefixes or no more than 200 types of 8-bit prefixes. In VPN scenarios,
the same prefix is counted multiple times in different VPNs.
● IPv6 routes: Among all routing entries, there are no more than 1200 types of
32-bit prefixes or no more than 3 types of 8-bit prefixes. In VPN scenarios, the
same prefix is counted multiple times in different VPNs.
Routes with a mask less than 64 bits are recommended, and routes with a
128-bit mask are not recommended. It is not recommended that you use a
large number of Layer 3 interfaces to configure IPv6 services. This is because
two routes will be generated for an IPv6 Layer 3 interface: one is a network
segment route and the other is a 128-bit local route, and this 128-bit local
route occupies many hardware resources.
For example, there are four IP addresses: 10.1.1.1, 10.1.2.1, 10.2.1.1, 192.168.1.1
● There are three types of 16-bit prefixes: 10.1, 10.2, and 192.168.
● There are two types of 8-bit prefixes: 10 and 192.
When the preceding switches are used as route forwarding devices in scenarios
other than the preceding typical scenarios, collect log information, configuration,
and routing entries if route forwarding failures occur, and contact technical
support personnel.
In a VXLAN scenario, the configuration of ECMP-based distribution of packets with
the same source address and destination address does not take effect; traffic is
still load balanced based on the configured ECMP load balancing mode.
11.2 Managing IP Routing Tables
11.2.1 Displaying and Maintaining an IP Routing Table
Context
You can view IP routing table information to locate routing faults. The following
describes the commands used to display and maintain IP routing table
information.
display commands can be used in all views, and reset commands can only be used
in the user view.
If the switch imports a large number of routes, system performance may be
affected when services are being processed because the routes consume a lot of
system resources. To improve system security and reliability, configure a limit on
the number of public route prefixes. When the number of public route prefixes
exceeds the limit, an alarm is generated, prompting you to check validity of public
route prefixes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1026
Procedure
● Run the display ip routing-table command to check brief information about
the active routes in the IPv4 routing table.
● Run the display ip routing-table verbose command to check detailed
information about the IPv4 routing table.
● Run the display ip routing-table
ip-address [
mask |
mask-length ] [ longer-
match ] [ verbose ] command to check detailed information about the routes
with the specified destination address in the IPv4 routing table.
● Run the display ip routing-table
ip-address1 {
mask1 |
mask-length1 }
ip-
address2 {
mask2 |
mask-length2 } [ verbose ] command to check detailed
information about the routes within the specified destination address range in
the IPv4 routing table.
● Run the display ip routing-table acl {
acl-number |
acl-name } [ verbose ]
command to check detailed information about the routes that match the
specified basic ACL in the IPv4 routing table.
● Run the display ip routing-table ip-prefix
ip-prefix-name [ verbose ]
command to check detailed information about the routes that match the
specified IP prefix list in the IPv4 routing table.
● Run the display ip routing-table protocol
protocol [ inactive | verbose ]
command to check detailed information about the routes discovered by the
specified routing protocol in the IPv4 routing table.
● Run the display ip routing-table statistics command to check route statistics
in the IPv4 routing table.
● Run the display ipv6 routing-table command to check brief information
about the active routes in the IPv6 routing table.
● Run the display ipv6 routing-table verbose command to check detailed
information about the IPv6 routing table.
● Run the display ipv6 routing-table
protocol [ inactive | verbose ] command
to check detailed information about the routes discovered by the specified
routing protocol in the IPv6 routing table.
● Run the display ipv6 routing-table statistics command to check route
statistics in the IPv6 routing table.
● Run the reset ip routing-table statistics protocol { all |
protocol } command
to clear route statistics in the IPv4 routing table.
● Run the reset ipv6 routing-table statistics protocol { all |
protocol }
command to clear route statistics in the IPv6 routing table.
----End
11.2.2 Displaying and Maintaining the Routing Management
Module
Context
If the device imports a large number of routes, system performance may be
affected when services are being processed because the routes consume a lot of
system resources. To improve system reliability, configure a limit on the number of
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1027
public route prefixes. When the number of public route prefixes exceeds the limit,
an alarm is generated, prompting you to check validity of public route prefixes.
Procedure
● Run the display rm interface [
interface-type interface-number ] command
to check IPv4 routing management (RM) information on the specified
interface.
● Run the display rm ipv6 interface [
interface-type interface-number ]
command to check IPv6 RM information on the specified interface.
● Maintain the RM module.
Configure a limit on the number of public route prefixes.
a. Run system-view
The system view is displayed.
b. Run either of the following commands as required:
▪ Run ip prefix-limit
number {
alert-percent [ route-unchanged ] |
simply-alert }
A limit on the number of IPv4 public route prefixes is configured.
By default, the maximum number of IPv4 public route prefixes is not
limited.
▪ Run ipv6 prefix-limit
number {
alert-percent [ route-unchanged ] |
simply-alert }
A limit on the number of IPv6 public route prefixes is configured.
By default, the maximum number of IPv6 public route prefixes is not
limited.
alert-percent specifies the percentage of the maximum number of
supported public route prefixes. If you specify
alert-percent in the
command, an alarm is generated when the number of public route
prefixes exceeds the value calculated by the following formula:
(
number x
alert-percent)/100
New public route prefixes can still be added to the IP routing table until
the number of public route prefixes reaches the value of
number.
Subsequent route prefixes will then be discarded.
If you specify simply-alert in the command, new public route prefixes
can still be added to the IP routing table and only an alarm is generated
after the number of public route prefixes exceeds the value of
number.
However, when the total number of private and public route prefixes
reaches the limit on the number of unicast route prefixes, subsequent
public route prefixes will be discarded.
If you decrease the value of
alert-percent after the number of public
route prefixes exceeds the value of
number, whether the IP routing table
remains unchanged depends on whether route-unchanged is specified in
the command:
▪ If it is specified, the IP routing table remains unchanged.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1028
▪ If it is not specified, the system deletes all the routes from the IP
routing table and re-adds routes to the IP routing table.
NOTE
After the number of public route prefixes exceeds the limit, note the following
rules:
● If you run the ip prefix-limit command to increase the value of
number or
run the undo ip prefix-limit command to remove the limit, the device
relearns IPv4 public route prefixes.
● If you run the ipv6 prefix-limit command to increase the value of
number
or run the undo ipv6 prefix-limit command to remove the limit, the device
relearns IPv6 public route prefixes.
● Direct and static routes can still be added to the IP routing table.
c. (Optional) Run ip prefix-limit log-interval
interval
An interval at which the system generates logs after the number of public
route prefixes exceeds the limit is configured.
By default, the system generates logs at an interval of 5s after the
number of public route prefixes exceeds the limit.
You can set a longer interval to decrease the frequency at which the
system generates logs.
----End
11.2.3 Displaying and Maintaining FIB Tables
Context
NOTE
Unless otherwise stated, FIB tables in this document refer to unicast FIB tables.
A device selects routes according to its IP routing table and forwards packets
according to FIB tables. If the number of entries in a FIB table reaches or exceeds
the limit, that is, the FIB table is overloaded, new active routes cannot be delivered
to the FIB table, affecting packet forwarding.
Procedure
● Check FIB entries.
– Run the display fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
[ verbose ] command to check IPv4 FIB entries.
– Run the display fib [ vpn-instance
vpn-instance-name ] acl
acl-number
[ verbose ] command to check IPv4 FIB entries that match a specified
ACL.
– Run the display fib [ vpn-instance
vpn-instance-name ] ip-prefix
prefix-
name [ verbose ] command to check IPv4 FIB entries that match a
specified IP prefix list.
– Run the display fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
destination-address1 [ verbose ] command to check IPv4 FIB entries that
match a specified destination IP address.
– Run the display fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
destination-address1 destination-mask1 [ verbose ] command to check
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1029
IPv4 FIB entries that exactly match a specified destination IP address and
mask.
– Run the display fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
destination-address1 longer [ verbose ] command to check all IPv4 FIB
entries that match destination IP addresses in the natural mask range.
– Run the display fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
destination-address1 destination-mask1 longer [ verbose ] command to
check all IPv4 FIB entries that match destination IP addresses in a
specified mask range.
– Run the display fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
destination-address1 destination-mask1 destination-address2 destination-
mask2 [ verbose ] command to check IPv4 FIB entries that match
destination IP addresses in the range of
destination-address1 destination-
mask1 and
destination-address2 destination-mask2.
– Run the display fib [ vpn-instance
vpn-instance-name ] next-hop
ip-
address command to check IPv4 FIB entries that match a specified next-
hop IP address.
– Run the display fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
statistics command to check the total number of IPv4 FIB entries.
– Run the display fib [
slot-id ] statistics all command to check IPv4 FIB
entry statistics.
– Run the display ipv6 fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
[ verbose ] command to check IPv6 FIB entries.
– Run the display ipv6 fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
ipv6-address [ verbose ] command to check IPv6 FIB entries that match a
specified destination IPv6 address.
– Run the display ipv6 fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
ipv6-address prefix-length [ verbose ] command to check IPv6 FIB entries
that exactly match a specified destination IPv6 address and mask.
– Run the display ipv6 fib [
slot-id ] [ vpn-instance
vpn-instance-name ]
[ verbose ] statistics command to check the total number of IPv6 FIB
entries.
– Run the display ipv6 fib [
slot-id ] statistics all command to check IPv6
FIB entry statistics.
● Maintain FIB tables.
– Enable the alarm function for the IPv4 route prefix usage and set the
alarm threshold.
i. Run system-view
The system view is displayed.
ii. Run fib threshold-alarm upper-limit
upper-limit-value lower-limit
lower-limit-value
The alarm function for the IPv4 route prefix usage is enabled and the
alarm threshold is set.
By default, the alarm function for IPv4 route prefix usage is enabled.
The upper alarm threshold is 85% and the lower alarm threshold is
75%.
– Configure the resource mode of the extended entry space register to
adjust the IPv4 and IPv6 FIB table sizes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1030
i. (Optional) Run the display resource-mode configuration command
to check the resource mode configuration of the extended entry
space.
ii. Run the system-view command to enter the system view.
iii. Configure the resource allocation mode of the extended entry space.
○ assign resource-mode { enhanced-mac | enhanced-arp |
enhanced-ipv4 | super-arp } [ slot
slot-id | all ] (S6735-S)
○ assign resource-mode { enhanced-arp | enhanced-sac |
enhanced-sipfpm | eca | sac } [ slot
slot-id | all ] (S5731-H,
S5731S-H, S5731-S, and S5731S-S)
○ assign resource-mode { enhanced-arp | enhanced-sac |
enhanced-sipfpm | sac } [ slot
slot-id | all ] (S6730-S, S6730S-S,
and S5732-H)
○ assign resource-mode { enhanced-mac | enhanced-arp |
enhanced-fib | enhanced-sac | sac | enhanced-sipfpm } [ slot
slot-id | all ] (S6730-H and S6730S-H)
○ assign resource-mode { enhanced-mac | enhanced-arp }
global (S500, S5735-S, S300, S5735-L, S5735-S-I, S5735-L-I,
S5735-L1, and S5735S-L1)
By default, the resource allocation mode of the S5731-H, S5731S-H,
S500, S5735-S, S300, S5735-L, S5735-S-I, S5735-L-I, S5735-
L1,S5735S-L1, S5732-H, S5731-S, S5731S-S, S6730-S, S6730S-S,
S6730-H, S6730S-H, S6735-S is enhanced-arp.
– Configure periodic refresh of FIB entries.
i. Run system-view
The system view is displayed.
ii. Run undo fib regularly-refresh disable
Periodic refresh of FIB entries is enabled.
By default, periodic refresh of FIB entries is enabled.
iii. Run fib regularly-refresh { interval
interval [ entry-number
entry-
number ] | entry-number
entry-number | cycle-interval
cycle-
interval }
The entire FIB entry update interval, FIB entry update interval per
cycle, and the number of FIB entries updated per cycle are
configured.
By default, the FIB entry update interval per cycle is 1 second, and
the number of FIB entries updated per cycle is 50. The entire FIB
entry update interval is 1 minute on the S5731-S, S5731-H, S5731S-
H, S5732-H, S6730-S, S6730S-H, and S6730-H, and is fixed to 1440
minutes on other devices.
– Configure periodic refresh of IPv6 FIB entries.
i. Run system-view
The system view is displayed.
ii. Run undo ipv6 fib regularly-refresh disable
Periodic refresh of IPv6 FIB entries is enabled.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1031
iii. Run ipv6 fib regularly-refresh { interval
interval | entry-number
entry-number | cycle-interval
cycle-interval }
The entire IPv6 FIB entry update interval, IPv6 FIB entry update
interval per cycle, and the number of IPv6 FIB entries updated per
cycle are configured.
By default, the IPv6 FIB entry update interval per cycle is 1 second,
and the number of IPv6 FIB entries updated per cycle is 50. The
entire IPv6 FIB entry update interval is 1 minute on the S5731-S,
S5731-H, S5731S-H, S5732-H, S6730-S, S6730S-H, and S6730-H, and
is fixed to 1440 minutes on other devices.
----End
11.2.4 Configuring IP FRR on the Public Network
Usage Scenario
On a traditional IP network, when a lower-layer failure occurs on the forwarding
link of a device, the physical interface of the device becomes Down. After the
device detects the failure, it instructs the upper-layer routing system to recalculate
routes and update routing information. It often takes the routing system several
seconds to reselect an available route.
Second-level convergence is intolerable to the services that are quite sensitive to
delay and packet loss because it may lead to service interruptions. For example,
Voice over Internet Protocol (VoIP) services are only tolerant of millisecond-level
interruptions. IP FRR ensures that the forwarding system rapidly responds to link
failures and uses backup routes to forward data, minimizing service traffic
interruptions.
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support this function.
Pre-configuration Tasks
Before configuring IP FRR on the public network, complete the following tasks:
● Configure static routes or an IGP to ensure that there are reachable routes
between devices.
● Configure different costs for routes to generate two non-equal-cost routes.
Configuration Procedure
Configure a route-policy and then enable IP FRR on the public network for the
route-policy.
Procedure
Step 1 Configure a route-policy.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1032
1. Run system-view
The system view is displayed.
2. Run route-policy
route-policy-name { permit | deny } node
node
A route-policy is created and the route-policy view is displayed.
3. (Optional) Run if-match
Matching conditions are configured to filter the routes to be backed up.
Select the if-match command according to 10.6.2 (Optional) Configuring
an if-match Clause.
If no matching condition is configured, backup outbound interfaces and
backup next hops will be specified for all routes of the device. This, however,
causes backup information to be specified for some routes that do not need
to be backed up. To correctly configure backup between routes, you are
advised to configure matching conditions.
4. Run apply backup-interface
interface-type interface-number
A backup outbound interface is configured.
5. Run apply backup-nexthop
ip-address
A backup next hop is configured.
NOTE
– If a backup outbound interface is configured on a P2P link, no backup next hop
needs to be specified.
– If a backup outbound interface is configured on a non-P2P link, a backup next hop
needs to be specified.
6. Run quit
Return to the system view.
Step 2 Enable IP FRR on the public network.
1. Run ip frr route-policy
route-policy-name
IP FRR on the public network is enabled.
When using IP FRR, use this command to enable IP FRR so that the route-
policy can take effect.
NOTE
Only one route-policy can be configured every time you use the command. If you run
this command multiple times, only the latest configuration takes effect.
----End
Verifying the Configuration
Run the display ip routing-table [ verbose ] command to check information
about the IPv4 routing table.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1033
11.2.5 Configuring IPv6 FRR on the Public Network
Usage Scenario
On a traditional IP network, when a lower-layer failure occurs on the forwarding
link of a device, the physical interface of the device becomes Down. After the
device detects the failure, it instructs the upper-layer routing system to recalculate
routes and update routing information. It often takes the routing system several
seconds to reselect an available route.
Second-level convergence is intolerable to the services that are quite sensitive to
delay and packet loss because it may lead to service interruptions. For example,
Voice over Internet Protocol (VoIP) services are only tolerant of millisecond-level
interruptions. IPv6 FRR ensures that the forwarding system rapidly responds to link
failures and uses backup routes to forward data, minimizing service traffic
interruptions.
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support this function.
Pre-configuration Tasks
Before configuring IPv6 FRR on the public network, complete the following tasks:
● Configure static routes or an IGP to ensure that there are reachable routes
between devices.
● Configure different costs for routes to generate two non-equal-cost routes.
Configuration Procedure
Configure a route-policy and then enable IPv6 FRR on the public network for the
route-policy.
Procedure
Step 1 Configure a route-policy.
1. Run system-view
The system view is displayed.
2. Run route-policy
route-policy-name { permit | deny } node
node
A route-policy is created and the route-policy view is displayed.
3. (Optional) Run if-match
Matching conditions are configured to filter the routes to be backed up.
Select the if-match command according to 10.6.2 (Optional) Configuring
an if-match Clause.
If no matching condition is configured, backup outbound interfaces and
backup next hops will be specified for all routes of the device. This, however,
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1034
causes backup information to be specified for some routes that do not need
to be backed up. To correctly configure backup between routes, you are
advised to configure matching conditions.
4. Run apply ipv6 backup-interface
interface-type interface-number
A backup outbound interface is configured.
5. Run apply ipv6 backup-nexthop
ipv6-address
A backup next hop is configured.
NOTE
– If a backup next hop is specified, a backup outbound interface also needs to be
specified.
– If a backup outbound interface is configured on a P2P link, no backup next hop
needs to be specified.
– If a backup outbound interface is configured on a non-P2P link, a backup next hop
needs to be specified.
6. Run quit
Return to the system view.
Step 2 Enable IPv6 FRR on the public network.
1. Run ipv6 frr route-policy
route-policy-name
IPv6 FRR on the public network is enabled.
When using IPv6 FRR, use this command to enable IPv6 FRR so that the
route-policy can take effect.
NOTE
Only one route-policy can be configured every time you use the command. If you run
this command multiple times, only the latest configuration takes effect.
----End
Verifying the Configuration
Run the display ipv6 routing-table [ verbose ] command to check information
about the IPv6 routing table.
11.2.6 Configuring the ECMP Load Balancing Mode
Context
ECMP applies to the network where multiple links to the same destination are
available. In the traditional routing technology, packets are forwarded to the
destination through one link only; the other links are in backup or inactive state;
switching between these links requires a certain period when dynamic routes are
used. Different from the traditional routing technology, ECMP can use multiple
links to increase transmission bandwidth and transmit data on a faulty link
without any delay or packet loss.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1035
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support ECMP load balancing.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ecmp load-balance sip [ dip ] [ port ]
The ECMP load balancing mode is set.
By default, ECMP load balancing is performed on packets based on the source IP
address, destination IP address, transport-layer source port number and
destination port number.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-S, S5735-S-I, S6735-S,
S6730-H, S6730S-H, S6730-S, and S6730S-S support the ECMP load balancing mode.
Step 3 Run ecmp load-balance diffluence
ECMP-based distribution of packets with the same source address and destination
address is configured.
By default, ECMP-based distribution of packets with the same source address and
destination address is not configured.
In a VXLAN scenario, ECMP-based distribution of packets with the same source
address and destination address does not take effect; instead, the configured
ECMP load balancing mode takes effect..
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S,
and S6730S-S support this command.
----End
11.2.7 Configuring the Advertisement of IPv4 ARP Vlink Direct
Routes
Context
After a device's sub-interfaces or VLANIF interfaces have static ARP entries
configured or dynamically learn ARP entries, the device generates a type of 32-bit
host route according to ARP entries if the arp direct-route enable command is
executed to configure the ARP module of the device to report IPv4 ARP Vlink
direct routes to the RM module. This type of 32-bit host route is called IPv4 ARP
Vlink direct route.
By default, IPv4 ARP Vlink direct routes are only used to guide local traffic
forwarding. To control the routing table size and ensure routing table stability,
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1036
devices are prohibited from redistributing these direct routes into dynamic routing
protocols. In some situations, however, devices need to perform operations based
on specific routes. For example, a device needs to direct remote traffic for different
users using different export policies. Subsequently, the device needs to redistribute
IPv4 ARP Vlink direct routes into dynamic routing protocols and advertises them to
the remote end.
You can use a route-policy to filter IPv4 ARP Vlink direct routes to be advertised so
that only the routes matching the route-policy can be advertised. This operation
can control the routing table size and implement precise control over data traffic.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support the configuration of the advertisement of IPv4 ARP Vlink
direct routes.
Pre-configuration Tasks
Before configuring the advertisement of IPv4 ARP Vlink direct routes, set link layer
protocol parameters and assign IP addresses to interfaces to ensure that the status
of the link layer protocol of the interfaces is Up.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run arp vlink-direct-route advertise [ route-policy
route-policy-name ]
The advertisement of IPv4 ARP Vlink direct routes is configured.
By default, a device does not advertise IPv4 ARP Vlink direct routes.
You can specify the route-policy
route-policy-name parameter in the command to
filter the IPv4 ARP Vlink direct routes to be advertised.
NOTE
Currently, apply clauses cannot be used to set route attributes for the routes that match
the specified route-policy.
IPv4 ARP Vlink direct routes need to be redistributed into the routing tables of
dynamic routing protocols on the device running dynamic routing protocols before
these routes are advertised by dynamic routing protocols.
----End
Verifying the Configuration
After the configuration of the advertisement of IPv4 ARP Vlink direct routes is
complete, you can run the display ip routing-table verbose command to check
information about IPv4 ARP Vlink direct routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1037
11.3 Example for Configuring IP FRR on the Public
Network
Networking Requirements
In Figure 11-1, RouterB and RouterC are egress routers on the Internet. SwitchA is
connected to two core switches SwitchB and SwitchC through two GE interfaces.
Each of SwitchB and SwitchC is connected to the two egress routers through two
GE interfaces. When a fault occurs on the link between SwitchB and RouterB,
SwitchB must rapidly respond to the link fault and use a backup route for data
forwarding to ensure that services are forwarded correctly.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 11-1 Networking diagram of configuring IP FRR on the public network
Configuration Roadmap
The configuration roadmap is as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1038
1. Configure static routes on SwitchA to ensure that packets destined for
192.168.1.1/24 are forwarded by SwitchC and packets destined for
10.55.1.1/24 are forwarded by SwitchB.
2. Configure a route-policy on SwitchB and apply this route-policy for IP FRR on
the public network so that services can be rapidly switched to the backup link
SwitchB→SwitchC→RouterB when the primary link SwitchB→RouterB fails.
Procedure
Step 1 Create VLANs and add interfaces to the VLANs.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 50 60
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 50
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 60
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Assign IPv4 addresses to VLANIF interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] ip address 10.50.1.2 24
[SwitchA-Vlanif50] quit
[SwitchA] interface vlanif 60
[SwitchA-Vlanif60] ip address 10.60.1.2 24
[SwitchA-Vlanif60] quit
Step 3 Configure basic OSPF functions on SwitchB and SwitchC.
# Configure SwitchB.
[SwitchB] ospf
[SwitchB-ospf-1] area 0
[SwitchB-ospf-1-area-0.0.0.0] network 10.10.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 10.20.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 10.60.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] network 10.70.1.0 0.0.0.255
[SwitchB-ospf-1-area-0.0.0.0] quit
[SwitchB-ospf-1] quit
# Configure SwitchC.
[SwitchC] ospf
[SwitchC-ospf-1] area 0
[SwitchC-ospf-1-area-0.0.0.0] network 10.30.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] network 10.40.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] network 10.50.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] network 10.70.1.0 0.0.0.255
[SwitchC-ospf-1-area-0.0.0.0] quit
[SwitchC-ospf-1] quit
Step 4 Configure IP addresses and basic OSPF functions on RouterB and RouterC to
ensure that there are reachable routes between RouterB, RouterC, SwitchB, and
SwitchC.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1039
Step 5 Configure static routes on SwitchA to ensure that packets destined for
192.168.1.1/24 are forwarded by SwitchC and packets destined for 10.55.1.1/24 are
forwarded by SwitchB.
# Configure SwitchA.
[SwitchA] ip route-static 10.55.1.0 24 vlanif 60 10.60.1.1
[SwitchA] ip route-static 192.168.1.0 24 vlanif 50 10.50.1.1
Step 6 Configure a route-policy and enable IP FRR on the public network.
# Configure an IP prefix list on SwitchB.
[SwitchB] ip ip-prefix ip_frr_pre index 10 permit 10.55.1.0 24
# On SwitchB, configure a route-policy, backup next hop, and backup outbound
interface.
[SwitchB] route-policy ip_frr_rp permit node 10
[SwitchB-route-policy] if-match ip-prefix ip_frr_pre
[SwitchB-route-policy] apply backup-nexthop 10.70.1.1
[SwitchB-route-policy] apply backup-interface vlanif 70
[SwitchB-route-policy] quit
# On SwitchB, enable IP FRR on the public network.
[SwitchB] ip frr route-policy ip_frr_rp
Step 7 Check information about the backup outbound interface and backup next hop.
# Check information about the backup outbound interface and backup next hop
on SwitchB.
[SwitchB] display ip routing-table verbose
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 1 Routes : 1
Destination: 10.55.1.0/24
Protocol: OSPF Process ID: 1
Preference: 10 Cost: 2
NextHop: 10.10.1.1 Neighbour: 0.0.0.0
State: Active Adv Age: 1d17h58m22s
Tag: 0 Priority: medium
Label: NULL QoSInfo: 0x0
IndirectID: 0x80000001
RelayNextHop: 0.0.0.0 Interface: Vlanif10
TunnelID: 0x0 Flags: RD
BkNextHop: 10.70.1.1 BkInterface: Vlanif70
BkLabel: NULL SecTunnelID: 0x0
BkPETunnelID: 0x0 BkPESecTunnelID: 0x0
BkIndirectID: 0x0
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 50 60
#
interface Vlanif50
ip address 10.50.1.2 255.255.255.0
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1040
interface Vlanif60
ip address 10.60.1.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 60
#
ip route-static 10.55.1.0 255.255.255.0 Vlanif60 10.60.1.1
ip route-static 192.168.1.0 255.255.255.0 Vlanif50 10.50.1.1
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 20 60 70
#
ip frr route-policy ip_frr_rp
#
interface Vlanif10
ip address 10.10.1.2 255.255.255.0
#
interface Vlanif20
ip address 10.20.1.2 255.255.255.0
#
interface Vlanif60
ip address 10.60.1.1 255.255.255.0
#
interface Vlanif70
ip address 10.70.1.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 70
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 60
#
ospf 1
area 0.0.0.0
network 10.10.1.0 0.0.0.255
network 10.20.1.0 0.0.0.255
network 10.60.1.0 0.0.0.255
network 10.70.1.0 0.0.0.255
#
ip ip-prefix ip_frr_pre index 10 permit 10.55.1.0 24
#
route-policy ip_frr_rp permit node 10
if-match ip-prefix ip_frr_pre
apply backup-nexthop 10.70.1.1
apply backup-interface Vlanif70
#
return
● SwitchC configuration file
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1041
#
sysname SwitchC
#
vlan batch 30 40 50 70
#
interface Vlanif30
ip address 10.30.1.1 255.255.255.0
#
interface Vlanif40
ip address 10.40.1.1 255.255.255.0
#
interface Vlanif50
ip address 10.50.1.1 255.255.255.0
#
interface Vlanif70
ip address 10.70.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 70
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 50
#
ospf 1
area 0.0.0.0
network 10.30.1.0 0.0.0.255
network 10.40.1.0 0.0.0.255
network 10.50.1.0 0.0.0.255
network 10.70.1.0 0.0.0.255
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 11 IP Routing Table Management
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1042
12 PBR Configuration
12.1 Overview of PBR
12.2 Licensing Requirements and Limitations for PBR
12.3 Configuring PBR
12.4 Configuring NQA for PBR
12.5 (Optional) Configuring PBR to Take Precedence over Blackhole Routes
12.6 Configuration Examples for PBR
12.1 Overview of PBR
Definition
Policy-based routing (PBR) allows switches to select routes based on user-defined
policies, and it takes precedence over direct routes, static routes, and routes
generated by dynamic routing protocols. After PBR is configured on the device, if
the received packets (including Layer 2 packets) match PBR rules, the device
forwards the packets according to the rules. If the packets do not match PBR rules,
the device forwards the packets according to the destination address of the
packets.
NOTE
The main differences between PBR and routing policies are:
● PBR changes the forwarding path of packets based on user-defined policies instead of
based on the routes in an IP routing table.
● Routing policies change the forwarding path of packets by filtering routes and setting
route attributes. For example, route attributes (including reachability) can be set to
change the forwarding path of network traffic.
Purpose
Traditionally, to determine the routes used to forward packets, a switch searches
its IP routing table based on the destination address carried in the packets. To
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1043
allow switches to route packets based on user-defined policies, PRB can be
configured.
Benefits
PBR has the following advantages:
● Allows network administrators to define policies for routing packets,
improving route selection flexibility.
● Enables different data flows to be forwarded on different links, increasing link
efficiency.
● Allows cost-effective links to be used for transmitting service data without
affecting service quality, reducing the cost of enterprise data services.
12.2 Licensing Requirements and Limitations for PBR
Involved Network Elements
Other network elements are not required.
Licensing Requirements
PBR is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support PBR.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
Feature Limitations
On the S5720I-SI, S5720-LI, S2730S-S, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-
L1, S5720S-LI, S5720S-SI, S5720-SI, S5735-S, S500, and S5735-S-I, PBR takes effect
only for the packets forwarded at Layer 3 but not for the packets forwarded at
Layer 2. On other switch models, PBR takes effect for the packets forwarded at
both Layer 2 and Layer 3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1044
12.3 Configuring PBR
Context
After a redirection action is configured, a switch redirects packets matching traffic
classification rules to a specified next-hop address.
A traffic policy containing the redirection action can be used globally, on an
interface, or in a VLAN in the inbound direction.
Pre-configuration Tasks
Before configuring PBR, complete the following tasks:
● Configure IP addresses for interfaces and configure routing protocols to
ensure connectivity.
● Configure an ACL to classify traffic.
Procedure
1. Configure a traffic classifier.
For details about configuring a traffic classifier, see Configuring a Traffic
Classifier in "MQC Configuration" in the
S300, S500, S2700, S5700, and S6700
V200R024C00 Configuration Guide - QoS.
2. Configure a traffic behavior.
a. Run traffic behavior
behavior-name
A traffic behavior is created and the traffic behavior view is displayed;
alternatively, the view of an existing traffic behavior is displayed.
b. Run the following commands as required.
▪ Run redirect [ remote ] [ vpn-instance
vpn-instance-name ] ip-
nexthop {
ip-address [ track-nqa
admin-name test-name ] } &<1-4>
[ forced | low-precedence ] *
The switch is configured to redirect packets matching traffic
classification rules to the specified next-hop IP address.
A maximum of four next-hop IP addresses can be configured in a
traffic behavior. If multiple next-hop IP addresses are configured, the
switch determines the active and standby links according to the
sequence in which next-hop IP addresses were configured. The next-
hop IP address that was configured first has the highest priority and
the link for this next hop is used as the active link. Links for other
next hops are used as standby links. If the active link goes Down, the
link for the next hop with the highest priority functions as the new
active link to transmit traffic. If the previous active link recovers from
the fault, traffic is switched back to this previous active link.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1045
NOTE
Configuring redirection can implement PBR.
If the low-precedence parameter is specified, the priority of redirection-
based PBR is lowered below that of statically configured routes or routes
generated by dynamic routing protocols (rather than being higher by
default).
▪ Run redirect [ remote ] [ vpn-instance
vpn-instance-name ] ipv6-
nexthop {
ipv6-address | link-local
link-local-address interface
interface-type interface-number } &<1-4> [ forced ]
The switch is configured to redirect IPv6 packets matching traffic
classification rules to the configured next-hop address.
▪ Run redirect [ vpn-instance
vpn-instance-name ] ip-multihop
{ nexthop
ip-address } &<2-4>
Or run redirect [ vpn-instance
vpn-instance-name ] ip-multihop
acl-ip-pool-name
The switch is configured to redirect packets matching traffic
classification rules to one of the configured next hops.
If multiple next hops are specified, the switch redirects packets
through equal-cost routes for load balancing.
If the outbound interface corresponding to a next-hop IP address
goes Down or a route changes, the switch transmits traffic to the
outbound interface corresponding to an available next hop.
If the switch has no ARP entry matching the specified next-hop IP
address, the redirect ip-multihop command can be used but
redirection does not take effect (the switch continues to forward
packets to the original destination) until the switch obtains the
corresponding ARP entry.
▪ Run redirect [ vpn-instance
vpn-instance-name ] ipv6-multihop
{
ipv6-address | link-local
link-local-address interface
interface-type
interface-number } &<2-4>
Or run redirect [ vpn-instance
vpn-instance-name ] ipv6-multihop
acl6-ip-pool-name
The switch is configured to redirect IPv6 packets matching traffic
classification rules to one of the configured next hops.
If multiple next hops are specified, the switch redirects packets
through equal-cost routes for load balancing.
c. (Optional) Run statistic enable
The traffic statistics collection function is enabled.
d. Run quit
Exit from the traffic behavior view.
e. Run quit
Exit from the system view.
3. Configure a traffic policy.
For details about configuring a traffic policy, see Configuring a Traffic Policy in
"MQC Configuration" in the
S300, S500, S2700, S5700, and S6700
V200R024C00 Configuration Guide - QoS.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1046
4. Apply the traffic policy.
– Apply a traffic policy to an interface.
i. Run system-view
The system view is displayed.
ii. Run interface
interface-type interface-number
The interface view is displayed.
iii. Run traffic-policy
policy-name inbound
A traffic policy is applied to the inbound direction of the interface.
– Apply a traffic policy to a VLAN.
i. Run system-view
The system view is displayed.
ii. Run vlan
vlan-id
The VLAN view is displayed.
iii. Run traffic-policy
policy-name inbound
A traffic policy is applied to the VLAN.
The system then applies the policy to the incoming packets that are
sent from the VLAN and match traffic classification rules.
– Apply a traffic policy globally.
i. Run system-view
The system view is displayed.
ii. Run traffic-policy
policy-name global inbound [ slot
slot-id ]
A traffic policy is applied globally.
Verifying the Configuration
● Run the display traffic classifier user-defined [
classifier-name ] command
to check the traffic classifier configuration.
● Run the display traffic behavior user-defined [
behavior-name ] command
to check the traffic behavior configuration.
● Run the display traffic policy user-defined [
policy-name [ classifier
classifier-name ] ] command to check the configuration of a specified user-
defined traffic policy.
● Run the display traffic-applied [ interface [
interface-type interface-
number ] | vlan [
vlan-id ] ] { inbound | outbound } [ verbose ] command to
check information about ACL-based simplified and MQC-based traffic policies
applied to the system, a VLAN, or an interface.
NOTE
The display traffic-applied command cannot be used to check information about
ACL-based simplified and MQC-based traffic policies applied to a sub-interface.
However, traffic policies can be applied to a sub-interface.
● Run the display traffic policy { interface [
interface-type interface-number
[
.subinterface-number ] ] | vlan [
vlan-id ] | ssid-profile [
ssid-profile-name ]
| global } [ inbound | outbound ] command to check the traffic policy
configuration.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1047
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support sub-interfaces.
Only the S5731-H, S5731S-H, S5732-H, S6730S-H, and S6730-H support ssid-profile
[
ssid-profile-name ].
● Run the display traffic-policy applied-record [
policy-name ] command to
check the application records of a specified traffic policy.
12.4 Configuring NQA for PBR
Background
PBR allows switches to select paths and forward packets based on defined policies.
However, PBR lacks a fault detection mechanism. In a scenario where the link for
the redirection next hop becomes faulty, PBR becomes ineffective only after the
ARP entry of the redirection next hop is aged. As a result, services cannot be
immediately switched to another link, causing service interruptions.
Network quality analysis (NQA) for PBR solves this issue by providing a fault
detection mechanism for PBR. In the same scenario, the next hop will become
ineffective immediately without waiting for the aging of its ARP entry. This is
because the NQA test identifies the fault. NQA for PBR helps shorten the service
interruption time and improve QoS.
Pre-configuration Tasks
Before configuring NQA for PBR, complete the following tasks:
● Configure IP addresses and routing protocols for interfaces to ensure
connectivity.
● Configure an ACL if the ACL needs to be used to classify traffic.
Procedure
1. Configure an ICMP NQA test instance.
a. Run system-view
The system view is displayed.
b. Run nqa test-instance
admin-name test-name
An NQA test instance is created, and the test instance view is displayed.
c. Run test-type icmp
The test type is set to ICMP.
NOTE
When NQA is associated with PBR, only an ICMP NQA test instance can be used
to check whether a route from the source to the destination is reachable.
d. Run destination-address ipv4
ip-address
The destination address is set for the NQA test instance.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1048
e. (Optional) Run frequency
interval
The interval at which the NQA test instance automatically runs is set.
By default, no automatic test interval is set. The system performs the test
only once.
f. (Optional) Run probe-count
number
The number of probes to be sent each time is set for the NQA test
instance.
By default, the number of probes to be sent each time is 3.
By sending multiple probes for an NQA test instance, the network quality
can be estimated more accurately based on the collected statistics.
g. (Optional) Run interval { milliseconds
interval | seconds
interval }
The interval at which probe packets are sent is set for the NQA test
instance.
For the default interval at which probe packets are sent, see the
command reference manual.
h. (Optional) Run timeout
time
The timeout period of a probe is set for the NQA test instance.
By default, the timeout period of a probe for FTP test instances is 15s and
that for other test instances is 3s.
i. Set the NQA test instance startup mode as required to start the NQA test
instance.
▪ Run start now [ end { at [
yyyy/
mm/
dd ]
hh:
mm:
ss | delay
{ seconds
second |
hh:
mm:
ss } | lifetime { seconds
second |
hh:
mm:
ss } } ]
The NQA test instance is started immediately.
▪ Run start at [
yyyy/mm/
dd ]
hh:
mm:
ss [ end { at [
yyyy/
mm/
dd ]
hh:mm:
ss | delay { seconds
second |
hh:
mm:
ss } | lifetime { seconds
second |
hh:mm:
ss } } ]
The NQA test instance is started at the specified time.
▪ Run start delay { seconds
second |
hh:
mm:ss } [ end { at [
yyyy/
mm/dd ]
hh:
mm:
ss | delay { seconds
second |
hh:
mm:
ss } | lifetime
{ seconds
second |
hh:
mm:
ss } } ]
The NQA test instance is started after the specified delay.
j. Run quit
Return to the system view.
k. Run quit
Exit from the system view.
2. Configure a traffic classifier.
For details about configuring a traffic classifier, see Configuring a Traffic
Classifier in "MQC Configuration" in the
S300, S500, S2700, S5700, and S6700
V200R024C00 Configuration Guide - QoS.
3. Configure a traffic behavior.
a. Run system-view
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1049
The system view is displayed.
b. Run traffic behavior
behavior-name
A traffic behavior is created and the traffic behavior view is displayed;
alternatively, the existing traffic behavior view is displayed.
c. Run redirect [ remote ] [ vpn-instance
vpn-instance-name ] ip-nexthop
{
ip-address [ track-nqa
admin-name test-name ] } &<1-4> [ forced |
low-precedence ] *
The packets matching traffic classification rules are redirected to the
specified next hop, and association between PBR and the NQA test
instance is configured.
To configure association between PBR and the NQA test instance, specify
the track-nqa
admin-name test-name parameter.
NOTE
In a given traffic behavior, a next-hop IP address can be bound to only one NQA
test instance.
On the switch, a maximum of eight NQA test instances can be bound.
d. (Optional) Run statistic enable
The traffic statistics collection function is enabled.
e. Run quit
Return to the system view.
f. Run quit
Exit from the system view.
4. Configure a traffic policy.
For details about configuring a traffic policy, see Configuring a Traffic Policy in
"MQC Configuration" in the
S300, S500, S2700, S5700, and S6700
V200R024C00 Configuration Guide - QoS.
5. Apply the traffic policy.
– Apply the traffic policy to an interface.
i. Run system-view
The system view is displayed.
ii. Run interface
interface-type interface-number
The interface view is displayed.
iii. Run traffic-policy
policy-name inbound
The traffic policy is applied to the inbound direction of the interface.
– Apply the traffic policy to a VLAN.
i. Run system-view
The system view is displayed.
ii. Run vlan
vlan-id
The VLAN view is displayed.
iii. Run traffic-policy
policy-name inbound
The traffic policy is applied to the VLAN.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1050
Subsequently, the system performs traffic policing on the incoming
packets that are sent from the VLAN and match traffic classification
rules.
– Apply the traffic policy globally.
i. Run system-view
The system view is displayed.
ii. Run traffic-policy
policy-name global inbound [ slot
slot-id ]
The traffic policy is applied globally.
Verifying the Configuration
● Run the display traffic classifier user-defined [
classifier-name ] command
to check the traffic classifier configuration.
● Run the display traffic behavior user-defined [
behavior-name ] command
to check the traffic behavior configuration.
● Run the display traffic policy user-defined [
policy-name [ classifier
classifier-name ] ] command to check the configuration of a specified user-
defined traffic policy.
● Run the display traffic-applied [ interface [
interface-type interface-
number ] | vlan [
vlan-id ] ] { inbound | outbound } [ verbose ] command to
check information about ACL-based simplified and MQC-based traffic policies
applied to the system, a VLAN, or an interface.
NOTE
The display traffic-applied command cannot be used to check information about
ACL-based simplified and MQC-based traffic policies applied to a sub-interface.
However, traffic policies can be applied to a sub-interface.
● Run the display traffic policy { interface [
interface-type interface-number
[
.subinterface-number ] ] | vlan [
vlan-id ] | ssid-profile [
ssid-profile-name ]
| global } [ inbound | outbound ] command to check the traffic policy
configuration.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support sub-interfaces.
Only the S5731-H, S5731S-H, S5732-H, S6730S-H, and S6730-H support ssid-profile
[
ssid-profile-name ].
● Run the display traffic-policy applied-record [
policy-name ] command to
check the application records of a specified traffic policy.
12.5 (Optional) Configuring PBR to Take Precedence
over Blackhole Routes
On the S5731-H, S5731S-H, S5732-H, S5731-S, S5731S-S, S6730-H, S6730S-H,
S6730-S, S6730S-S, PBR has a lower priority than a blackhole route. That is, when
traffic matches both PBR and a blackhole route, the PBR configuration does not
take effect.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1051
To make PBR take effect in this scenario, run the blackhole-route optimize
enable command to enable PBR to take precedence over blackhole routes.
Procedure
1. Run system-view
The system view is displayed.
2. Run blackhole-route optimize enable
PBR is configured to take precedence over blackhole routes.
By default, blackhole routes take precedence over PBR on the devices that
support this command.
NOTE
Only the following device models support this command: S5731-H, S5731S-H, S5732-
H, S5731-S, S5731S-S, S6730-H, S6730S-H, S6730-S, S6730S-S.
12.6 Configuration Examples for PBR
12.6.1 Example for Configuring PBR Based on IP Addresses
Networking Requirements
In Figure 12-1, the Switch on the aggregation layer is a Layer 3 forwarding device,
and an LSW on the access layer serves as the user gateway. There is a reachable
route between the Switch and LSW. The Switch is connected to two core routers
through two links: a high-speed link with the gateway 10.1.20.1/24 and a low-
speed link with the gateway 10.1.30.1/24.
The enterprise requires that the Switch forward packets from 192.168.100.0/24
and 192.168.101.0/24 to the core layer through the high-speed link and low-speed
link, respectively.
Figure 12-1 Networking diagram for configuring PBR
Configuration Roadmap
Implement PBR through redirection so that the Switch can provide differentiated
services. The configuration roadmap is as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1052
1. Create VLANs and configure interfaces to connect the enterprise' devices to
external network devices.
2. Configure ACL rules to separately match packets with source IP addresses
192.168.100.0/24 and 192.168.101.0/24.
3. Configure traffic classifiers and bind them to ACL rules so that the Switch can
differentiate packets.
4. Configure traffic behaviors to redirect the packets matching different rules to
10.1.20.1/24 and 10.1.30.1/24 separately.
5. Configure a traffic policy, bind it to the traffic classifiers and traffic behaviors,
and apply it to the inbound direction of GE0/0/3 to implement PBR.
Procedure
Step 1 Create VLANs and configure interfaces.
# Create VLANs 100 and 200 on the Switch.
<HUAWEI> system-view
[HUAWEI] sysname Switch
[Switch] vlan batch 100 200
Configure GE0/0/1, GE0/0/2, and GE0/0/3 on the Switch as trunk interfaces, and
add them to VLANs 100 and 200.
[Switch] interface gigabitethernet 0/0/1
[Switch-GigabitEthernet0/0/1] port link-type trunk
[Switch-GigabitEthernet0/0/1] port trunk allow-pass vlan 100 200
[Switch-GigabitEthernet0/0/1] quit
[Switch] interface gigabitethernet 0/0/2
[Switch-GigabitEthernet0/0/2] port link-type trunk
[Switch-GigabitEthernet0/0/2] port trunk allow-pass vlan 100 200
[Switch-GigabitEthernet0/0/2] quit
[Switch] interface gigabitethernet 0/0/3
[Switch-GigabitEthernet0/0/3] port link-type trunk
[Switch-GigabitEthernet0/0/3] port trunk allow-pass vlan 100 200
[Switch-GigabitEthernet0/0/3] quit
# Create VLANIF 100 and VLANIF 200, and configure IP addresses for them.
[Switch] interface vlanif 100
[Switch-Vlanif100] ip address 10.1.20.2 24
[Switch-Vlanif100] quit
[Switch] interface vlanif 200
[Switch-Vlanif200] ip address 10.1.30.2 24
[Switch-Vlanif200] quit
Step 2 Configure ACL rules.
# On the Switch, create advanced ACLs 3001 and 3002 to permit packets with
source IP addresses 192.168.100.0/24 and 192.168.101.0/24 respectively.
[Switch] acl 3001
[Switch-acl-adv-3001] rule permit ip source 192.168.100.0 0.0.0.255
[Switch-acl-adv-3001] quit
[Switch] acl 3002
[Switch-acl-adv-3002] rule permit ip source 192.168.101.0 0.0.0.255
[Switch-acl-adv-3002] quit
Step 3 Configure traffic classifiers.
# On the Switch, create traffic classifiers c1 and c2, and bind c1 to ACL 3001 and
c2 to ACL 3002.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1053
[Switch] traffic classifier c1 operator or
[Switch-classifier-c1] if-match acl 3001
[Switch-classifier-c1] quit
[Switch] traffic classifier c2 operator or
[Switch-classifier-c2] if-match acl 3002
[Switch-classifier-c2] quit
Step 4 Configure traffic behaviors.
# On the Switch, create traffic behaviors b1 and b2 to redirect traffic to
10.1.20.1/24 and 10.1.30.1/24, respectively.
[Switch] traffic behavior b1
[Switch-behavior-b1] redirect ip-nexthop 10.1.20.1
[Switch-behavior-b1] quit
[Switch] traffic behavior b2
[Switch-behavior-b2] redirect ip-nexthop 10.1.30.1
[Switch-behavior-b2] quit
Step 5 Configure a traffic policy and apply it to an interface.
# On the Switch, create a traffic policy p1, and bind it to the traffic classifiers and
traffic behaviors.
[Switch] traffic policy p1
[Switch-trafficpolicy-p1] classifier c1 behavior b1
[Switch-trafficpolicy-p1] classifier c2 behavior b2
[Switch-trafficpolicy-p1] quit
# Apply the traffic policy p1 to the inbound direction of GE0/0/3.
[Switch] interface gigabitethernet 0/0/3
[Switch-GigabitEthernet0/0/3] traffic-policy p1 inbound
[Switch-GigabitEthernet0/0/3] return
Step 6 Verify the configuration.
# Check the ACL configuration.
<Switch> display acl 3001
Advanced ACL 3001, 1 rule
Acl's step is 5
rule 5 permit ip source 192.168.100.0 0.0.0.255
<Switch> display acl 3002
Advanced ACL 3002, 1 rule
Acl's step is 5
rule 5 permit ip source 192.168.101.0 0.0.0.255
# Check the traffic classifier configuration.
<Switch> display traffic classifier user-defined
User Defined Classifier Information:
Classifier: c2
Operator: OR
Rule(s) :if-match acl 3002
Classifier: c1
Operator: OR
Rule(s) : if-match acl 3001
Total classifier number is 2
# Check the traffic policy configuration.
<Switch> display traffic policy user-defined p1
User Defined Traffic Policy Information:
Policy: p1
Classifier: c1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1054
Operator: OR
Behavior: b1
Redirect: no forced
Redirect ip-nexthop
10.1.20.1
Classifier: c2
Operator: OR
Behavior: b2
Redirect: no forced
Redirect ip-nexthop
10.1.30.1
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 100 200
#
acl number 3001
rule 5 permit ip source 192.168.100.0 0.0.0.255
acl number 3002
rule 5 permit ip source 192.168.101.0 0.0.0.255
#
traffic classifier c1 operator or
if-match acl 3001
traffic classifier c2 operator or
if-match acl 3002
#
traffic behavior b1
redirect ip-nexthop 10.1.20.1
traffic behavior b2
redirect ip-nexthop 10.1.30.1
#
traffic policy p1 match-order config
classifier c1 behavior b1
classifier c2 behavior b2
#
interface Vlanif100
ip address 10.1.20.2 255.255.255.0
#
interface Vlanif200
ip address 10.1.30.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 100 200
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 100 200
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 100 200
traffic-policy p1 inbound
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1055
12.6.2 Example for Configuring PBR
Networking Requirements
In Figure 12-2, enterprise users are dual-homed to external network devices
through the Switch. The Switch is connected to two core routers through two
links, a high-speed link with the gateway 10.1.30.1/24 and a low-speed link with
the gateway 10.1.20.1/24.
The enterprise requires that outgoing packets with IP precedences 4, 5, 6, and 7 be
transmitted on the high-speed link and outgoing packets with IP precedences 0, 1,
2, and 3 be transmitted on the low-speed link.
Figure 12-2 PBR networking
Configuration Roadmap
Implement PBR through redirection so that the Switch can provide differentiated
services. The configuration roadmap is as follows:
1. Create VLANs and configure interfaces to connect the enterprise' devices to
external network devices.
2. Configure ACL rules to separately match the packets with IP precedences of 4,
5, 6, and 7 and the packets with IP precedences of 0, 1, 2, and 3.
3. Configure traffic classifiers and bind them to ACL rules in the traffic classifiers
so that the Switch can differentiate packets.
4. Configure traffic behaviors to redirect the packets matching traffic
classification rules to 10.1.20.1/24 and 10.1.30.1/24 separately.
5. Configure a traffic policy, bind it to the traffic classifiers and traffic behaviors,
and apply it to the inbound direction of GE0/0/3 to implement PBR.
Procedure
Step 1 Create VLANs and configure interfaces.
# Create VLAN 100 and VLAN 200 on the Switch.
<HUAWEI> system-view
[HUAWEI] sysname Switch
[Switch] vlan batch 100 200
# Configure GE0/0/1, GE0/0/2, and GE0/0/3 on the Switch as trunk interfaces and
add them to VLAN 100 and VLAN 200.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1056
[Switch] interface gigabitethernet 0/0/1
[Switch-GigabitEthernet0/0/1] port link-type trunk
[Switch-GigabitEthernet0/0/1] port trunk allow-pass vlan 100 200
[Switch-GigabitEthernet0/0/1] quit
[Switch] interface gigabitethernet 0/0/2
[Switch-GigabitEthernet0/0/2] port link-type trunk
[Switch-GigabitEthernet0/0/2] port trunk allow-pass vlan 100 200
[Switch-GigabitEthernet0/0/2] quit
[Switch] interface gigabitethernet 0/0/3
[Switch-GigabitEthernet0/0/3] port link-type trunk
[Switch-GigabitEthernet0/0/3] port trunk allow-pass vlan 100 200
[Switch-GigabitEthernet0/0/3] quit
NOTE
Configure the interface connecting the LSW to the Switch as a trunk interface and add it to
VLAN 100 and VLAN 200.
# Create VLANIF 100 and VLANIF 200 and configure IP addresses for them.
[Switch] interface vlanif 100
[Switch-Vlanif100] ip address 10.1.20.2 24
[Switch-Vlanif100] quit
[Switch] interface vlanif 200
[Switch-Vlanif200] ip address 10.1.30.2 24
[Switch-Vlanif200] quit
Step 2 Configure ACLs.
# Create advanced ACLs 3001 and 3002 on the Switch. ACL 3001 permits packets
with IP precedences of 0, 1, 2, and 3 and ACL 3002 permits packets with IP
precedences of 4, 5, 6, and 7.
[Switch] acl 3001
[Switch-acl-adv-3001] rule permit ip precedence 0
[Switch-acl-adv-3001] rule permit ip precedence 1
[Switch-acl-adv-3001] rule permit ip precedence 2
[Switch-acl-adv-3001] rule permit ip precedence 3
[Switch-acl-adv-3001] quit
[Switch] acl 3002
[Switch-acl-adv-3002] rule permit ip precedence 4
[Switch-acl-adv-3002] rule permit ip precedence 5
[Switch-acl-adv-3002] rule permit ip precedence 6
[Switch-acl-adv-3002] rule permit ip precedence 7
[Switch-acl-adv-3002] quit
Step 3 Configure traffic classifiers.
On the Switch, create traffic classifiers c1 and c2, and bind c1 to ACL 3001 and c2
to ACL 3002.
[Switch] traffic classifier c1 operator and
[Switch-classifier-c1] if-match acl 3001
[Switch-classifier-c1] quit
[Switch] traffic classifier c2 operator and
[Switch-classifier-c2] if-match acl 3002
[Switch-classifier-c2] quit
Step 4 Configure traffic behaviors.
# On the Switch, create traffic behaviors b1 and b2 to redirect traffic to
10.1.20.1/24 and 10.1.30.1/24, respectively.
[Switch] traffic behavior b1
[Switch-behavior-b1] redirect ip-nexthop 10.1.20.1
[Switch-behavior-b1] quit
[Switch] traffic behavior b2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1057
[Switch-behavior-b2] redirect ip-nexthop 10.1.30.1
[Switch-behavior-b2] quit
Step 5 Configure a traffic policy and apply it to an interface.
# On the Switch, create a traffic policy p1, and bind it to the traffic classifiers and
traffic behaviors.
[Switch] traffic policy p1
[Switch-trafficpolicy-p1] classifier c1 behavior b1
[Switch-trafficpolicy-p1] classifier c2 behavior b2
[Switch-trafficpolicy-p1] quit
# Apply the traffic policy p1 to the inbound direction of GE0/0/3.
[Switch] interface gigabitethernet 0/0/3
[Switch-GigabitEthernet0/0/3] traffic-policy p1 inbound
[Switch-GigabitEthernet0/0/3] return
Step 6 Verify the configuration.
# Check the ACL configuration.
<Switch> display acl 3001
Advanced ACL 3001, 4 rules
Acl's step is 5
rule 5 permit ip precedence routine
rule 10 permit ip precedence priority
rule 15 permit ip precedence immediate
rule 20 permit ip precedence flash
<Switch> display acl 3002
Advanced ACL 3002, 4 rules
Acl's step is 5
rule 5 permit ip precedence flash-override
rule 10 permit ip precedence critical
rule 15 permit ip precedence internet
rule 20 permit ip precedence network
# Check the traffic classifier configuration.
<Switch> display traffic classifier user-defined
User Defined Classifier Information:
Classifier: c2
Operator: AND
Rule(s) : if-match acl 3002
Classifier: c1
Operator: AND
Rule(s) : if-match acl 3001
Total classifier number is 2
# Check the traffic policy configuration.
<Switch> display traffic policy user-defined p1
User Defined Traffic Policy Information:
Policy: p1
Classifier: c1
Operator: AND
Behavior: b1
Redirect: no forced
Redirect ip-nexthop
10.1.20.1
Classifier: c2
Operator: AND
Behavior: b2
Redirect: no forced
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1058
Redirect ip-nexthop
10.1.30.1
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 100 200
#
acl number 3001
rule 5 permit ip precedence routine
rule 10 permit ip precedence priority
rule 15 permit ip precedence immediate
rule 20 permit ip precedence flash
acl number 3002
rule 5 permit ip precedence flash-override
rule 10 permit ip precedence critical
rule 15 permit ip precedence internet
rule 20 permit ip precedence network
#
traffic classifier c1 operator and
if-match acl 3001
traffic classifier c2 operator and
if-match acl 3002
#
traffic behavior b1
redirect ip-nexthop 10.1.20.1
traffic behavior b2
redirect ip-nexthop 10.1.30.1
#
traffic policy p1 match-order config
classifier c1 behavior b1
classifier c2 behavior b2
#
interface Vlanif100
ip address 10.1.20.2 255.255.255.0
#
interface Vlanif200
ip address 10.1.30.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 100 200
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 100 200
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 100 200
traffic-policy p1 inbound
#
return
12.6.3 Example for Configuring PBR to Import Traffic to the
Firewall in Bypass Mode
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1059
Networking Requirements
In Figure 12-3, enterprise users need to access the Internet through SwitchA (core
switch) and the router (access gateway).
To ensure the security of the enterprise's intranet, traffic entering the intranet
needs to be imported to the firewall in bypass mode.
Figure 12-3 Networking for configuring PBR to import traffic to the firewall in
bypass mode
Configuration Roadmap
The configuration roadmap is as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1060
● Configure an IP address for each interface and configure a routing protocol
between the switch and firewall to ensure that there is a reachable route.
● Configure PBR on SwitchA to redirect traffic to the firewall for security
detection. Traffic that is sent from the external network to the enterprise
intranet will be redirected.
NOTE
This example provides only the switch configuration. For the firewall configuration, see the
firewall documentation.
Procedure
Step 1 Configure an IP address for each interface on SwitchA and the firewall, and
configure a routing protocol on SwitchA.
# Assign an IP address to each interface of SwitchA. By default, a switch interface
is a Layer 2 interface. Before configuring an IP address for a switch interface, run
the undo portswitch command to change the interface to a Layer 3 interface.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] undo portswitch
[SwitchA-GigabitEthernet0/0/1] ip address 10.1.1.2 24
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] undo portswitch
[SwitchA-GigabitEthernet0/0/2] ip address 10.1.20.1 24
[SwitchA-GigabitEthernet0/0/2] quit
[SwitchA] interface gigabitethernet 0/0/3
[SwitchA-GigabitEthernet0/0/3] undo portswitch
[SwitchA-GigabitEthernet0/0/3] ip address 10.1.10.6 24
[SwitchA-GigabitEthernet0/0/3] quit
[SwitchA] interface gigabitethernet 0/0/4
[SwitchA-GigabitEthernet0/0/4] undo portswitch
[SwitchA-GigabitEthernet0/0/4] ip address 10.1.11.6 24
[SwitchA-GigabitEthernet0/0/4] quit
# Configure a routing protocol on SwitchA to ensure Layer 3 connectivity. OSPF is
used as an example.
Generally, two OSPF processes are configured on the firewall to advertise uplink
and downlink network segments. Therefore, two OSPF processes need to be
configured on SwitchA.
[SwitchA] ospf 100
[SwitchA-ospf-100] area 0
[SwitchA-ospf-100-area-0.0.0.0] network 10.1.1.0 0.0.0.255
[SwitchA-ospf-100-area-0.0.0.0] network 10.1.10.0 0.0.0.255
[SwitchA-ospf-100-area-0.0.0.0] quit
[SwitchA-ospf-100] quit
[SwitchA] ospf 200
[SwitchA-ospf-200] area 0
[SwitchA-ospf-200-area-0.0.0.0] network 10.1.11.0 0.0.0.255
[SwitchA-ospf-200-area-0.0.0.0] network 10.1.20.0 0.0.0.255
[SwitchA-ospf-200-area-0.0.0.0] quit
[SwitchA-ospf-200] quit
Step 2 Configure PBR on SwitchA to redirect traffic to the firewall for security detection.
Traffic that is sent from the external network to the enterprise intranet will be
redirected.
# Configure a traffic classifier to match all traffic.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1061
[SwitchA] traffic classifier c1
[SwitchA-classifier-c1] if-match any
[SwitchA-classifier-c1] quit
# Configure a traffic behavior to redirect matching traffic to the firewall (with the
next-hop address 10.1.10.5).
[SwitchA] traffic behavior b1
[SwitchA-behavior-b1] redirect ip-nexthop 10.1.10.5
[SwitchA-behavior-b1] quit
# Configure a traffic policy.
[SwitchA] traffic policy p1
[SwitchA-trafficpolicy-p1] classifier c1 behavior b1
[SwitchA-trafficpolicy-p1] quit
# Apply the traffic policy to the inbound direction of GigabitEthernet0/0/1 on
SwitchA.
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] traffic-policy p1 inbound
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] quit
Step 3 Verify the configuration.
# Check the traffic classifier configuration.
<SwitchA> display traffic classifier user-defined c1
User Defined Classifier Information:
Classifier: c1
Operator: AND
Rule(s) : if-match any
# Check the traffic behavior configuration.
<SwitchA> display traffic behavior user-defined b1
User Defined Behavior Information:
Behavior: b1
Redirect: no forced
Redirect ip-nexthop
10.1.10.5
# Check the traffic policy configuration.
<SwitchA> display traffic policy user-defined p1
User Defined Traffic Policy Information:
Policy: p1
Classifier: c1
Operator: AND
Behavior: b1
Redirect: no forced
Redirect ip-nexthop
10.1.10.5
# Check the traffic policy record.
<SwitchA> display traffic-policy applied-record
#
-------------------------------------------------
Policy Name: p1
Policy Index: 0
Classifier:c1 Behavior:b1
-------------------------------------------------
*interface GigabitEthernet0/0/1
traffic-policy p1 inbound
slot 0 : success
-------------------------------------------------
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1062
Policy total applied times: 1.
#
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
traffic classifier c1 operator and
if-match any
#
traffic behavior b1
redirect ip-nexthop 10.1.10.5
#
traffic policy p1 match-order config
classifier c1 behavior b1
#
interface GigabitEthernet0/0/1
undo portswitch
ip address 10.1.1.2 255.255.255.0
traffic-policy p1 inbound
#
interface GigabitEthernet0/0/2
undo portswitch
ip address 10.1.20.1 255.255.255.0
#
interface GigabitEthernet0/0/3
undo portswitch
ip address 10.1.10.6 255.255.255.0
#
interface GigabitEthernet0/0/4
undo portswitch
ip address 10.1.11.6 255.255.255.0
#
ospf 100
area 0.0.0.0
network 10.1.1.0 0.0.0.255
network 10.1.10.0 0.0.0.255
#
ospf 200
area 0.0.0.0
network 10.1.11.0 0.0.0.255
network 10.1.20.0 0.0.0.255
#
return
12.6.4 Example for Configuring NQA for PBR
Networking Requirements
In Figure 12-4, an enterprise uses SwitchA as an aggregation switch and access
switch LSW as a user gateway. There are reachable routes between SwitchA and
LSW. SwitchA connects to two core switches, SwitchB and SwitchC, through a
high-speed link with the gateway 10.1.20.1/24 and a low-speed link with the
gateway 10.1.30.1/24, respectively. A default route has been configured on
SwitchA to ensure that traffic is transmitted through the high-speed link by
default. The enterprise has the following requirements:
● Use PBR to direct packets with the source IP address 192.168.101.0/24 to the
low-speed link. This is to reduce the bandwidth pressure on the high-speed
link.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1063
● If the low-speed link becomes faulty, packets with the source IP address
192.168.101.0/24 must be rapidly switched back to the high-speed link to
minimize service interruption caused by the link fault.
Figure 12-4 Configuring NQA for PBR
Configuration Roadmap
The configuration roadmap is as follows:
1. Create VLANs and configure interfaces to connect the enterprise' devices to
external network devices.
2. Configure an NQA test instance to detect low-speed link quality. This
configuration provides a fault detection mechanism for PBR.
3. Configure an ACL to match packets with the source address 192.168.101.0/24
that need to be directed to the low-speed link.
4. Configure a traffic classifier and bind it to the ACL so that SwitchA can
differentiate packets.
5. Configure a traffic behavior to redirect packets with the source IP address
192.168.101.0/24 to 10.1.30.1 and configure the NQA test instance for PBR.
6. Configure a traffic policy, bind it to the traffic classifier and traffic behavior,
and apply it to the inbound direction of GE0/0/3 on SwitchA to associate NQA
with PBR.
Procedure
Step 1 Specify the VLANs to which interfaces belong.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar and
are not mentioned here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1064
[SwitchA] vlan batch 100 200
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 100
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 200
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address for each VLANIF interface.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar and
are not mentioned here.
[SwitchA] interface vlanif 100
[SwitchA-Vlanif100] ip address 10.1.20.2 24
[SwitchA-Vlanif100] quit
[SwitchA] interface vlanif 200
[SwitchA-Vlanif200] ip address 10.1.30.2 24
[SwitchA-Vlanif200] quit
Step 3 Configure an NQA test instance on SwitchA.
[SwitchA] nqa test-instance user test
[SwitchA-nqa-user-test] test-type icmp
[SwitchA-nqa-user-test] destination-address ipv4 10.1.30.1
[SwitchA-nqa-user-test] frequency 11
[SwitchA-nqa-user-test] probe-count 2
[SwitchA-nqa-user-test] interval seconds 5
[SwitchA-nqa-user-test] timeout 4
[SwitchA-nqa-user-test] start now
[SwitchA-nqa-user-test] quit
Step 4 Check the NQA test result on SwitchA.
[SwitchA] display nqa results test-instance user test
NQA entry(user, test) :testflag is active ,testtype is icmp
1 . Test 288 result The test is finished
Send operation times: 2 Receive response times: 2
Completion:success RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:0
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:10.1.30.1
Min/Max/Average Completion Time: 3/4/3
Sum/Square-Sum Completion Time: 7/25
Last Good Probe Time: 2014-09-09 09:55:38.2
Lost packet ratio: 0 %
If the command output contains Completion:success and Lost packet ratio: 0 %,
the NQA test is successful and links are normal.
Step 5 Configure an ACL.
# Create an advanced ACL 3001 on SwitchA to permit packets with the source IP
address 192.168.101.0/24.
[SwitchA] acl 3001
[SwitchA-acl-adv-3001] rule permit ip source 192.168.101.0 0.0.0.255
[SwitchA-acl-adv-3001] quit
Step 6 Configure a traffic classifier.
# Create a traffic classifier c1 on SwitchA, and bind c1 to ACL 3001.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1065
[SwitchA] traffic classifier c1 operator or
[SwitchA-classifier-c1] if-match acl 3001
[SwitchA-classifier-c1] quit
Step 7 Configure a traffic behavior.
# Create a traffic behavior b1 on SwitchA to redirect packets to 10.1.30.1, and
configure NQA for PBR.
[SwitchA] traffic behavior b1
[SwitchA-behavior-b1] redirect ip-nexthop 10.1.30.1 track-nqa user test
[SwitchA-behavior-b1] quit
Step 8 Configure a traffic policy and apply it to an interface.
# Create a traffic policy p1 on SwitchA, and bind it to the traffic classifier and
traffic behavior.
[SwitchA] traffic policy p1
[SwitchA-trafficpolicy-p1] classifier c1 behavior b1
[SwitchA-trafficpolicy-p1] quit
# Apply the traffic policy p1 to the inbound direction of GE0/0/3 on SwitchA.
[SwitchA] interface gigabitethernet 0/0/3
[SwitchA-GigabitEthernet0/0/3] traffic-policy p1 inbound
[SwitchA-GigabitEthernet0/0/3] return
Step 9 Verify the configuration.
# Check the ACL configuration.
<SwitchA> display acl 3001
Advanced ACL 3001, 1 rule
Acl's step is 5
rule 5 permit ip source 192.168.101.0 0.0.0.255
# Check the traffic classifier configuration.
<SwitchA> display traffic classifier user-defined
User Defined Classifier Information:
Classifier: c1
Operator: OR
Rule(s) : if-match acl 3001
Total classifier number is 1
# Check the traffic policy configuration.
<SwitchA> display traffic policy user-defined p1
User Defined Traffic Policy Information:
Policy: p1
Classifier: c1
Operator: OR
Behavior: b1
Redirect: no forced
Redirect ip-nexthop
10.1.30.1 track-nqa user test
The preceding command output shows that PBR on SwitchA has been associated
with NQA. If a link becomes faulty, PBR on SwitchA becomes ineffective
immediately without waiting for the aging of ARP entries. Subsequently, traffic is
forwarded according to the IP routing table on SwitchA.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1066
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 100 200
#
acl number 3001
rule 5 permit ip source 192.168.101.0 0.0.0.255
#
traffic classifier c1 operator or
if-match acl 3001
#
traffic behavior b1
redirect ip-nexthop 10.1.30.1 track-nqa user test
#
traffic policy p1 match-order config
classifier c1 behavior b1
#
interface Vlanif100
ip address 10.1.20.2 255.255.255.0
#
interface Vlanif200
ip address 10.1.30.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 100
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 200
#
interface GigabitEthernet0/0/3
traffic-policy p1 inbound
#
nqa test-instance user test
test-type icmp
destination-address ipv4 10.1.30.1
frequency 11
interval seconds 5
timeout 4
probe-count 2
start now
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 100
#
interface Vlanif100
ip address 10.1.20.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 100
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 200
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1067
interface Vlanif200
ip address 10.1.30.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 200
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 12 PBR Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1068
13 Route Monitoring Group
Configuration
13.1 Overview of Route Monitoring Groups
13.2 Application Scenarios for Route Monitoring Groups
13.3 Understanding Route Monitoring Groups
13.4 Licensing Requirements and Limitations for Route Monitoring Group
13.5 Configuring Association Between IPv4 Static Routes and a Route Monitoring
Group
13.6 Example for Configuring Association Between IPv4 Static Routes and a Route
Monitoring Group
13.1 Overview of Route Monitoring Groups
Definition
Route monitoring groups monitor the connectivity of network-side IPv4 routes,
and their status is associated with IPv4 static routes. By leveraging route
monitoring groups, access-side service modules can perform active/standby link
switchovers upon changes to the connectivity status of network-side IP routes,
preventing network congestion or traffic loss.
Purpose
To improve network reliability, device-level redundancy is used on live networks.
This involves two devices that back up each other and operate in load balancing
mode. If one device fails, the other device takes over services from the faulty
device. Inter-device link reliability and load balancing issues need to be resolved
when one device is dual-homed to two devices that operate in active/standby
mode.
In a two-node hot standby scenario, if some or all network-side links fail, the
bandwidth of the network-side links decreases accordingly. Network congestion or
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1069
traffic loss will occur if the access side cannot promptly detect link failures. To
prevent these problems from arising, you can configure a route monitoring group
and associate its status with the status of IPv4 static routes. This allows status
changes of network-side routes to trigger switching between the active and
standby links of access-side service modules.
13.2 Application Scenarios for Route Monitoring
Groups
13.2.1 Preventing Network Congestion
On the network shown in Figure 13-1, AGG_Switch_A and AGG_Switch_B back up
each other, and several ACC_Switches are dual-homed to the two AGG_Switches to
implement load balancing. If some network-side links between AGG_Switch_A and
the core network fail, the available bandwidth of links between them decreases
accordingly. However, ACC_Switches cannot detect link failures and still forward
packets destined for the core network to AGG_Switch_A. In this scenario,
congestion will occur on the links between AGG_Switch_A and the core network.
To prevent network congestion, you can deploy route monitoring groups on
ACC_Switches to quickly detect the connectivity of IP routes on the network. This
will allow ACC_Switches to promptly perform access-side link switching when
there are changes to the status of IP routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1070
Figure 13-1 Typical networking diagram of route monitoring groups
13.2.2 Preventing Traffic Loss
On the network shown in Figure 13-2, AGG_Switch_A and AGG_Switch_B back up
each other, and several ACC_Switches are dual-homed to the two AGG_Switches to
implement load balancing. If all the links between AGG_Switch_A and the core
network fail, only the links between AGG_Switch_B and the core network are
available on the network side. However, ACC_Switches cannot detect link failures
and still forward packets destined for the core network to AGG_Switch_A. In this
scenario, the packets transmitted from ACC_Switches are lost because all the links
between AGG_Switch_A and the core network are unavailable.
To prevent traffic loss, you can configure route monitoring groups on
ACC_Switches to quickly detect the connectivity of IP routes on the network. This
will allow ACC_Switches to promptly perform access-side link switching when
there are changes to the status of IP routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1071
Figure 13-2 Typical networking diagram of route monitoring groups
13.3 Understanding Route Monitoring Groups
Monitored routes of the same type on the network side can be added to a route
monitoring group. Each route monitoring group is identified by a unique name.
The status of a route monitoring group depends on the status of its member
routes. Service modules will switch links if the status of the route monitoring
group changes.
A route monitoring group monitors the status of all its member routes. You can
set the logical relationship between the monitored routes in a group to AND or
OR.
● When the logical relationship between the monitored routes in a route
monitoring group is set to AND, the group status changes to Down as long as
one route in the group goes Down. The route management (RM) module
then instructs the service modules to switch links.
● When the logical relationship between the monitored routes in a route
monitoring group is set to OR, the group status only changes to Down when
all the routes in the group go Down. The RM module then instructs the
service modules to switch links.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1072
13.4 Licensing Requirements and Limitations for Route
Monitoring Group
Involved Network Elements
Other network elements are not required.
Licensing Requirements
Route monitoring group is a basic feature of a switch and is not under license
control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support Route Monitoring Group.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
Feature Limitations
None
13.5 Configuring Association Between IPv4 Static
Routes and a Route Monitoring Group
Context
To quickly detect link quality changes for static routes and ensure timely link
switching, you can associate the IPv4 static routes with a route monitoring group.
If a network-side link fails, the route monitoring group detects the status change
of the corresponding network-side route and triggers switching between the active
and standby links on the access side. This prevents network congestion and traffic
loss and ensures service continuity.
Pre-configuration Tasks
Before configuring association between IPv4 static routes and a route monitoring
group, configure link-layer protocol parameters and IP addresses for interfaces to
ensure that the link-layer protocol status of the interfaces is Up.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1073
Procedure
1. Configure a route monitoring group.
a. Run system-view
The system view is displayed.
b. Run ip route-monitor-group
group-name
A route monitoring group is created and the route monitoring group view
is displayed.
By default, no route monitoring group is created on a switch.
c. Run track ip route [ vpn-instance
vpn-instance-name ]
dest-address
{
mask |
mask-length }
A route is added to the route monitoring group.
By default, no route is added to a route monitoring group.
To add more routes to the route monitoring group, repeat this step. A
route monitoring group can monitor a maximum of 16 routes.
d. (Optional) Run operator and
The relationship between routes in the route monitoring group is set to
AND.
By default, the status of routes in a route monitoring group is of the OR
relationship. That is, the status of the route monitoring group is Up as
long as one route in the group is Up. The status of the monitoring group
is Down only when all routes in the group are Down.
e. (Optional) Run trigger-down-delay
delay-value
A delay after which the RM module instructs the associated service
modules to perform link switchovers is configured.
By default, the delay is 0s.
f. (Optional) Run trigger-up-delay
delay-value
A delay after which the RM module instructs the associated service
modules to perform link switchbacks is configured.
By default, the delay is 5s.
g. Run monitor enable
The route monitoring group is enabled.
2. Configure association between IPv4 static routes and the route monitoring
group.
a. Run system-view
The system view is displayed.
b. Run ip route-static
ip-address {
mask |
mask-length } {
nexthop-address |
interface-type interface-number [
nexthop-address ] | vpn-instance
vpn-
instance-name nexthop-address } [ preference
preference | tag
tag ]
track route-monitor-group
route-monitor-group-name [ description
text ]
Association between IPv4 static routes and the route monitoring group is
configured.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1074
NOTE
The destination address of a route monitored by a route monitoring group cannot be
the destination address of an associated static route.
Verifying the Configuration
● Run the display ip route-monitor-group [
group-name ] command to check
information about the route monitoring group.
● Run the display ip route-monitor-group track-route [ vpn-instance
vpn-
instance-name ]
dest-address {
mask |
mask-length } command to check
information about all route monitoring groups to which a route is added.
● Run the display current-configuration | include track route-monitor-group
command to check the configuration of the association between IPv4 static
routes and route monitoring groups.
13.6 Example for Configuring Association Between IPv4
Static Routes and a Route Monitoring Group
Networking Requirements
On a company's network shown in Figure 13-3, SwitchC at the access layer
connects to SwitchB and SwitchD at the aggregation layer through static routes.
SwitchB and SwitchD work in redundancy mode. The customer requirements are
as follows:
● A link failure detection mechanism is deployed for static routes, so that traffic
can be switched from a faulty link to a normal link in a timely manner to
prevent service interruption for a long time.
● In normal situations, service traffic from the access side is forwarded to the IP
network through SwitchB.
● If the link between SwitchB and SwitchA fails, only the link between SwitchD
and the IP network is available. In this case, service traffic from the access
side is switched to SwitchD to prevent traffic loss.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1075
Figure 13-3 Configuring association between IPv4 static routes and a route
monitoring group
Device Name Interface IP Address
SwitchA
VLANIF 10 192.168.10.1/24
VLANIF 20 192.168.20.1/24
VLANIF 100 192.168.100.1/24
SwitchB
VLANIF 10 192.168.10.2/24
VLANIF 40 192.168.40.1/24
SwitchC
VLANIF 30 192.168.30.2/24
VLANIF 40 192.168.40.2/24
VLANIF 50 192.168.50.1/24
SwitchD VLANIF 20 192.168.20.2/24
VLANIF 30 192.168.30.1/24
Configuration Roadmap
The configuration roadmap is as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1076
1. Create VLANs, add interfaces to the VLANs, and configure IP addresses for
VLANIF interfaces, so that neighboring devices can communicate with each
other.
2. Configure static routes and bind them to a route monitoring group. On
SwitchC, configure static routes, set a low cost for the route corresponding to
the active link, and bind the static routes to a route monitoring group. In this
way, the links can work in active/standby mode, and IPv4 static routes are
associated with the route monitoring group.
Procedure
1. Configure VLANs to which interfaces belong.
# Configure SwitchC. The configurations of other devices are similar to those
of SwitchC.
<HUAWEI> system-view
[HUAWEI] sysname SwitchC
[SwitchC] vlan batch 30 40 50
[SwitchC] interface gigabitethernet 0/0/1
[SwitchC-gigabitethernet0/0/1] port link-type trunk
[SwitchC-gigabitethernet0/0/1] port trunk allow-pass vlan 30
[SwitchC-gigabitethernet0/0/1] quit
[SwitchC] interface gigabitethernet 0/0/2
[SwitchC-gigabitethernet0/0/2] port link-type trunk
[SwitchC-gigabitethernet0/0/2] port trunk allow-pass vlan 40
[SwitchC-gigabitethernet0/0/2] quit
[SwitchC] interface gigabitethernet 0/0/3
[SwitchC-gigabitethernet0/0/3] port link-type trunk
[SwitchC-gigabitethernet0/0/3] port trunk allow-pass vlan 50
[SwitchC-gigabitethernet0/0/3] quit
2. Configure an IP address for each VLANIF interface.
# Configure SwitchC. The configurations of other devices are similar to those
of SwitchC.
[SwitchC] interface vlanif 30
[SwitchC-Vlanif10] ip address 192.168.30.2 24
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] ip address 192.168.40.2 24
[SwitchC-Vlanif40] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] ip address 192.168.50.1 24
[SwitchC-Vlanif50] quit
3. Configure static routes and bind them to a route monitoring group.
# On SwitchC, create the route monitoring group uplink.
[SwitchC] ip route-monitor-group uplink
# On SwitchC, add routes to be monitored to the route monitoring group
uplink.
[SwitchC-route-monitor-group-uplink] track ip route 192.168.100.0 255.255.255.0
# On SwitchC, enable the route monitoring group.
[SwitchC-route-monitor-group-uplink] monitor enable
[SwitchC-route-monitor-group-uplink] quit
# On SwitchC, configure static routes to the external network and bind the
static routes to the route monitoring group uplink.
[SwitchC] ip route-static 0.0.0.0 0.0.0.0 192.168.40.1 preference 50 track route-monitor-group
uplink
[SwitchC] ip route-static 0.0.0.0 0.0.0.0 192.168.30.1
# On SwitchB, configure a static route to Client1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1077
<HUAWEI> system-view
[HUAWEI] sysname SwitchB
[SwitchB] ip route-static 192.168.50.0 255.255.255.0 192.168.40.2
# On SwitchD, configure a static route to Client1.
<HUAWEI> system-view
[HUAWEI] sysname SwitchD
[SwitchD] ip route-static 192.168.50.0 255.255.255.0 192.168.30.2
4. Verify the configuration.
# Check information about the route monitoring group uplink on SwitchC.
The command output shows that the route monitoring group has been
enabled and the route to 192.168.100.0/24 is an active route.
[SwitchC] display ip route-monitor-group uplink
route monitor group uplink
State : Enabled
-------------------------------------------------------
route monitor group tracking route number : 1
-------------------------------------------------------
VPN name : Public
Destination : 192.168.100.0
Mask : 255.255.255.0
State : Active
# Check information about static routes on SwitchC to determine the active
and standby links.
[SwitchC] display ip routing-table protocol static
Route Flags: R - relay, D - download to fib, T - to vpn-
instance
------------------------------------------------------------------------------
Public routing table : Static
Destinations : 1 Routes : 2 Configured Routes : 6
Static routing table status : <Active>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 50 0 D 192.168.40.1 Vlanif40
Static routing table status : <Inactive>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 192.168.30.1 Vlanif30
# Disable gigabitethernet0/0/1 on SwitchB to simulate a link failure.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-gigabitethernet0/0/1] shutdown
[SwitchB-gigabitethernet0/0/1] quit
# Check information about the route monitoring group uplink on SwitchC.
The command output shows that the route status corresponding to the faulty
link is Inactive.
[SwitchC] display ip route-monitor-group uplink
route monitor group uplink
State : Enabled
-------------------------------------------------------
route monitor group tracking route number : 1
-------------------------------------------------------
VPN name : Public
Destination : 192.168.100.0
Mask : 255.255.255.0
State : Inactive
# Check information about static routes on SwitchC. The command output
shows that static routes on SwitchC have been bound to a route monitoring
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1078
group. If the route monitoring group detects a link failure, the RM module
immediately notifies the access device that the corresponding route is
unavailable.
[SwitchC] display ip routing-table protocol static
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Public routing table : Static
Destinations : 1 Routes : 2 Configured Routes : 6
Static routing table status : <Active>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 D 192.168.30.1 Vlanif40
Static routing table status : <Inactive>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 50 0 192.168.40.1 Vlanif30
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20 100
#
interface Vlanif10
ip address 192.168.100.1 255.255.255.0
#
interface Vlanif20
ip address 192.168.20.1 255.255.255.0
#
interface Vlanif100
ip address 192.168.100.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 100
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 40
#
interface Vlanif10
ip address 192.168.10.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.40.1 255.255.255.0
#
interface GigabitEthernet0/0/1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1079
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
ip route-static 192.168.50.0 255.255.255.0 192.168.40.2
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 30 40 50
#
interface Vlanif30
ip address 192.168.30.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.40.2 255.255.255.0
#
interface Vlanif50
ip address 192.168.50.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
ip route-monitor-group uplink
track ip route 192.168.100.0 255.255.255.0
monitor enable
#
ip route-static 0.0.0.0 0.0.0.0 192.168.40.1 preference 50 track route-monitor-group uplink
ip route-static 0.0.0.0 0.0.0.0 192.168.30.1
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 20 30
#
interface Vlanif20
ip address 192.168.20.2 255.255.255.0
#
interface Vlanif30
ip address 192.168.30.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ip route-static 192.168.50.0 255.255.255.0 192.168.30.2
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 13 Route Monitoring Group Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1080