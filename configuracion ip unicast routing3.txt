S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 950
Figure 10-3 Invoking between tools in routing policy
InFigure 10-3, all the tools used in routing policy are classified into the following
types:
● Conditional tool: captures required routes.
● Policy tool: performs an action on the captured routes, for example, permit,
deny, and modify attributes.
● Invoking tool: applies a routing policy to a specific routing protocol to make
the routing policy to take effect.
NOTE
Among the invoking tools, filter-policy and peer have the policy tool function, so they can
directly invoke conditional tools. Other invoking tools must invoke conditional tools through
route-policy.
The invoking tool, peer, can invoke all conditional tools except ACL.
Relevant Information
Technology Forum
Huawei S Series Switches Routing Policy
10.2.2 IP Prefix List
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 951
Filtering Rules
An IP prefix list can contain multiple index entries, each of which corresponds to a
filtering rule. In Figure 10-4, the system matches routes against entries in
ascending order of index number.
● If a route matches a permit entry, this route is permitted. If a route matches a
deny entry, this route is denied.
● If a route does not match any entry in the IP prefix list, this route is denied.
Figure 10-4 Matching principles of an IP prefix list
Route filtering rules of an IP prefix list include: sequential match, unique match,
and deny by default.
● Sequential match: Routes are matched against entries in ascending order of
index number. If different index numbers are configured for multiple entries in
the same IP prefix list, different filtering results may be obtained. Therefore,
exercise caution when configuring index numbers.
● Unique match: If a route matches one entry, it no longer tries to match other
entries.
● Deny by default: By default, all the routes that do not match any entry are
denied. Therefore, after one or multiple deny entries are created in an IP
prefix list, one entry needs to be created to permit all the other routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 952
Mask Matching
One advantage of IP prefix list over ACL is that routes can be matched against
their mask. The following example shows the ip ip-prefix command used to
configure an IPv4 prefix list:
ip ip-prefix
ip-prefix-name [ index
index-number ] { permit | deny }
ipv4-address
mask-length [ greater-equal
greater-equal-value ] [ less-equal
less-equal-value ]
In this command,
ipv4-address mask-length [ greater-equal
greater-equal-value ]
[ less-equal
less-equal-value ] defines the network ID and mask range of routes
to be filtered. Table 10-3 describes parameters in this command.
Table 10-3 An address range in an IP prefix list
Parameter Description
ipv4-address Specifies a network ID.
mask-length Specifies the mask length for exact match.
greater-equal
greater-equal-value
Indicates that the mask length must be greater than or
equal to
greater-equal-value.
less-equal
less-
equal-value
Indicates that the mask length must be less than or
equal to
less-equal-value.
When a route to be filtered has matched a network ID, the mask length can be
matched exactly or within a specified mask length.
● If both greater-equal and less-equal are not configured in the command,
exact match is performed on routes. That is, only the routes with the specified
mask-length are matched.
● If only greater-equal is configured in the command, the mask length range
used for matching routes is [
greater-equal-value, 32].
● If only less-equal is configured in the command, the mask length range used
for matching routes is [
mask-length,
less-equal-value].
● If both greater-equal and less-equal are configured in the command, the
mask length range used for matching routes is [
greater-equal-value,
less-
equal-value].
Differences Between IP Prefix List and ACL
Both IP prefix list and ACL can be used to filter routes. ACLs can match only the
network ID but not the mask (prefix length), but an IP prefix list is more flexible
than ACLs because it can match both the network ID and mask, improving route
matching accuracy.
The following two examples can help differentiate ACL and IP prefix list.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 953
Figure 10-5 Using an IP prefix list to filter imported routes
In Figure 10-5, SwitchB has two static routes, but only the static route
192.168.0.0/16 needs to be imported into OSPF.
Check the IP routing table of SwitchB. The following command output shows that
it has two static routes 192.168.0.0/16 and 192.168.0.0/24. Now only the route
192.168.0.0/16 needs to be re-advertised into OSPF.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.10.12.0/24 Direct 0 0 D 10.10.12.1 Vlanif10
10.10.12.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.0.0/16 Static 60 0 D 0.0.0.0 NULL0
192.168.0.0/24 Static 60 0 D 0.0.0.0 NULL0
First, use an ACL to meet this requirement.
1. 1. Configure a basic ACL 2001.
[SwitchB] acl 2001
[SwitchB-acl-basic-2001] rule permit source 192.168.0.0 0.0.255.255
[SwitchB-acl-basic-2001] quit
2. Configure node 10 in the route-policy RP to permit the route matching the
basic ACL 2001 and deny all the unmatched routes.
[SwitchB] route-policy RP permit node 10
[SwitchB-route-policy] if-match acl 2001
[SwitchB-route-policy] quit
3. Import the static route permitted by the route-policy RP into OSPF.
[SwitchB] ospf
[SwitchB-ospf-1] import-route static route-policy RP
[SwitchB-ospf-1] quit
After the preceding configurations are complete, check the IP routing table of
SwitchC.
<SwitchC> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 954
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.10.12.0/24 Direct 0 0 D 10.10.12.2 Vlanif10
10.10.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.0.0/16 O_ASE 150 1 D 10.10.12.1 Vlanif10
192.168.0.0/24 O_ASE 150 1 D 10.10.12.1 Vlanif10
The command output shows that the two routes to 192.168.0.0 have been
imported. This is because in the ACL 2001 rule permit source 192.168.0.0
0.0.255.255, 0.0.255.255 indicates a wildcard but not the mask length.
After a wildcard is converted into a binary number, 0 indicates that routes need to
match this ACL, while 1 indicates that routes do not. For example, 192.168.0.0
0.0.255.255 specifies a route prefix range: 192.168.0.0 to 192.168.255.255. The two
routes 192.168.0.0/16 and 192.168.0.0/24 both match the ACL 2001. Therefore, the
two routes match node 10 in the route-policy RP and both are imported into
OSPF. ACLs cannot ensure that only the route 192.168.0.0/16 or 192.168.0.0/24 is
matched because ACLs can match only network ID but not mask.
The following uses an IP prefix list to filter the imported routes. Check
whether an IP prefix list can ensure that only the route 192.168.0.0/16 is
imported and the route 192.168.0.0/24 is filtered out.
1. Configure an IP prefix list huawei and configure node 10 to permit the route
192.168.0.0/16.
[SwitchB] ip ip-prefix huawei index 10 permit 192.168.0.0 16
2. Configure a route-policy RP and configure node 10 to permit the route that
matches the IP prefix list huawei and deny all the unmatched routes.
[SwitchB] route-policy RP permit node 10
[SwitchB-route-policy] if-match ip-prefix huawei
[SwitchB-route-policy] quit
3. Import the static route permitted by the route-policy RP into OSPF.
[SwitchB] ospf
[SwitchB-ospf-1] import-route static route-policy RP
[SwitchB-ospf-1] quit
4. After the preceding configurations are complete, check the IP routing table of
SwitchC. The following command output shows that only the route
192.168.0.0/16 is imported into OSPF.
<SwitchC> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 5 Routes : 5
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.10.12.0/24 Direct 0 0 D 10.10.12.2 Vlanif10
10.10.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.0.0/16 O_ASE 150 1 D 10.10.12.1 Vlanif10
Relevant Information
Technology Forum
Huawei S Series Switches Routing Policy
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 955
10.2.3 Route-Policy Implementation and Applications
Components
A route-policy is a complicated filter, which can match route attributes and change
route attributes when conditions are met.
In Figure 10-6, a route-policy consists of node ID, matching mode, if-match clause
(condition statement), and apply clause (action statement).
Figure 10-6 Components of a route-policy
● Node ID
A route-policy can contain multiple nodes. Routes must follow the following
rules when matching a route-policy:
– Sequential match: The system checks routing entries against nodes in
ascending order of node ID. Therefore, you need to specify node IDs in
the required sequence.
– Unique match: The relationship between all nodes in a route-policy is
"OR". This means that if a route matches one node in a route-policy, the
route matches this route-policy and does not need to match the other
nodes in this route-policy.
● Matching mode
Two node matching modes are available: permit and deny.
– permit: If a route matches a node, the actions defined by the apply
clauses of this node are performed on this route, and the system does not
match this route against the next node. If a route does not match a node,
the system matches this route against the next node.
– deny: If a route matches all the if-match clauses of a node, this route is
denied by this node, the system does not match this route against the
next node, and the actions defined by the apply clauses of this node will
not be performed on this route. If a route does not match the if-match
clauses of a node, the system matches this route against the next node.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 956
NOTE
A route-policy in permit mode that does not contain if-match and apply clauses is
often set behind multiple deny nodes to allow all other routes to pass through.
● if-match clause (condition statement)
if-match clauses define matching conditions. Each node in a route-policy can
contain multiple or no if-match clauses. If a permit node does not contain any
if-match clause, this node matches all routes.
● apply clause (action statement)
apply clauses define actions. When routes are filtered against a route-policy,
the system sets attributes for the routes according to the actions defined by
apply clauses. Each node in a route-policy can contain multiple or no apply
clauses. If you only need to filter routes but do not need to set attributes for
routes, apply clauses do not need to be used.
Matching Rules
The matching rules of each node in a route-policy depend on the following
factors:
● Matching mode of the node in the route-policy: permit or deny
● Matching conditions (permit or deny) defined by if-match clauses (for
example, IP prefix list or ACL) of the node
The following table describes possible matching results for each node.
Table 10-4 Matching rules of a route-policy
Rule (Matching
Rule Contained
in if-match
Clauses)
Mode
(Matching
Mode of a
Node)
Matching Result
permit permit ● Routes that match the if-match clauses
of this node are permitted by this route-
policy, and the matching ends.
● The system matches the routes that do
not match the if-match clauses of this
node against the next node of this
route-policy.
deny ● Routes that match the if-match clauses
of this node are denied by this route-
policy, and the matching ends.
● The system matches the routes that do
not match the if-match clauses of this
node against the next node of this
route-policy.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 957
Rule (Matching
Rule Contained
in if-match
Clauses)
Mode
(Matching
Mode of a
Node)
Matching Result
deny permit ● Routes that match the if-match clauses
of this node are denied by this route-
policy, and the system matches these
routes against the next node of this
route-policy.
● The system matches the routes that do
not match the if-match clauses of this
node against the next node of this
route-policy.
deny ● Routes that match the if-match clauses
of this node are denied by this route-
policy, and the system matches these
routes against the next node of this
route-policy.
● The system matches the routes that do
not match the if-match clauses of this
node against the next node of this
route-policy.
NOTE
On the switch, all unmatched routes are denied by the route-policy by default. If more than
one node is defined in a route-policy, at least one node must be in permit mode. The
reason is as follows:
● If a route fails to match any node, the route is denied by the route-policy.
● If all the nodes in the route-policy are set in deny mode, all the routes to be filtered are
denied by the route-policy.
Among the preceding four combinations, the first two combinations are easy to
understand and commonly used. The last two combinations are a little difficult to
understand, and the following example describes the third combination for your
reference.
Assume that the matching condition of if-match clauses in a node is deny and the
matching condition of this node is permit. The configuration is as follows:
#
acl number 2001
rule 5 deny source 172.16.16.0 0 //Deny 172.16.16.0
#
acl number 2002
rule 5 permit source 172.16.16.0 0 //Permit 172.16.16.0
#
route-policy RP permit node 10 //In this node, the route 172.16.16.0 is denied and the system matches
it against the next node.
if-match acl 2001
#
route-policy RP permit node 20 //In this node, the route 172.16.16.0 is permitted.
if-match acl 2002
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 958
The route 172.16.16.0 is denied by node 10, and the system matches this route
against the next node 20. This route is permitted by node 20 and so is permitted
by this route-policy.
Relevant Information
Technology Forum
Huawei S Series Switches Routing Policy
10.2.4 Filter-Policy Implementation and Applications
Overview
A filter-policy is a commonly used routing information filtering tool. In Figure
10-7, SwitchA, SwitchB, and SwitchC run a routing protocol, and routes are
transmitted among these devices. A filter-policy can be used to filter specific
routing information as required.
Figure 10-7 Filter-policy application
NOTE
Filter-policies can only filter routing information and cannot filter LSAs or change route
attributes.
Filtering Rules
Distance-vector routing protocols (such as RIP) and link-state routing protocols
(such as OSPF) vary in principles. Therefore, filter-policy filtering rules vary
between the two types of routing protocols. The following table lists differences in
routing information transmission between distance-vector routing protocols and
link-state routing protocols.
Table 10-5 Differences in routing information transmission between distance-
vector routing protocols and link-state routing protocols
Routing Protocol
Type
Route Transmission Principles
Distance-vector
routing protocols
Routing devices transmit routing information. This routing
information is like roadmap for packets. The devices guide
packet forwarding based on the roadmap.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 959
Routing Protocol
Type
Route Transmission Principles
Link-state routing
protocols
Routing devices transmit link state advertisements (LSAs).
A link state database (LSDB) is a set of LSAs and describes
the entire network topology, which is like a map. The
devices find the optimal forwarding path for packets based
on the map and shortest path algorithm.
Filter-policy in distance-vector routing protocols
Figure 10-8 Filter-policy in distance-vector routing protocols
In Figure 10-8, when using distance-vector routing protocols, devices transmit
routing information. To filter the routing information, use a filter-policy. Figure
10-8 shows where a filter-policy takes effect in the inbound and outbound
directions. To filter the routing information transmitted from an upstream device
to a downstream device, you only need to configure filter-policy export on the
upstream device or configure filter-policy import on the downstream device.
Filter-policy in link-state routing protocols
Figure 10-9 Filter-policy in link-state routing protocols
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 960
In Figure 10-9, when using link-state routing protocols, routing devices transmit
LSAs and then calculate their routing tables based on the LSDB. The following
uses OSPF as an example to describe filter-policy filtering rules:
● The filter-policy import command filters the routes calculated by OSPF but
not the LSAs advertised and received.
● The filter-policy export command filters the imported routes to be advertised
so that only eligible external routes are translated into Type 5 LSAs (AS-
external-LSAs) and advertised. In this manner, imported external routes can
be filtered as required to prevent routing loops.
Using a Filter-Policy to Filter the Routes Advertised by RIP
Requirement Description
In Figure 10-10, three switches exchange routes through RIP. Three static routes
(used as test routes) are imported into the RIP process of SwitchA. It is required
that the filter-policy export command be configured on SwitchB to filter the
routes advertised to SwitchC, that is, deny the route 192.168.3.0/24 and permit
other routes.
Figure 10-10 Using a filter-policy to filter the routes advertised by RIP
Configuration
1. Define an IP prefix list on SwitchB to filter routes as required.
[SwitchB] ip ip-prefix huawei index 10 deny 192.168.3.0 24 //Deny this route.
[SwitchB] ip ip-prefix huawei index 20 permit 0.0.0.0 0 less-equal 32 //Permit all routes.
2. Configure the filter-policy export command in the RIP view of SwitchB.
[SwitchB] rip
[SwitchB-rip-1] filter-policy ip-prefix huawei export Vlanif20
Verification
After the preceding configurations are complete, check the IP routing tables of
SwitchB and SwitchC.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 961
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 9 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.1.0/24 RIP 100 1 D 192.168.10.1 Vlanif10
192.168.2.0/24 RIP 100 1 D 192.168.10.1 Vlanif10
192.168.3.0/24 RIP 100 1 D 192.168.10.1 Vlanif10
192.168.10.0/24 Direct 0 0 D 192.168.10.2 Vlanif10
192.168.10.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.20.0/24 Direct 0 0 D 192.168.20.1 Vlanif20
192.168.20.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
[SwitchC] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 7 Routes : 7
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.1.0/24 RIP 100 2 D 192.168.20.1 Vlanif20
192.168.2.0/24 RIP 100 2 D 192.168.20.1 Vlanif20
192.168.10.0/24 RIP 100 1 D 192.168.20.1 Vlanif20
192.168.20.0/24 Direct 0 0 D 192.168.20.2 Vlanif20
192.168.20.2/32 Direct 0 0 D 127.0.0.1 Vlanif20
The preceding command output shows that after the filter-policy export
command is configured on SwitchB, SwitchB still has a complete IP routing table;
however, SwitchC cannot learn the route 192.168.3.0/24 through RIP because this
route has been filtered out before being advertised by SwitchB.
Using a Filter-Policy to Filter the Routes Received by RIP
Requirement Description
In Figure 10-11, three switches exchange routes through RIP. Three static routes
(used as test routes) are imported into the RIP process of SwitchA. It is required
that the filter-policy import command be configured on SwitchB to deny the
route 192.168.3.0/24 and permit other routes.
Figure 10-11 Using a filter-policy to filter the routes received by RIP
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 962
Configuration
1. Define an IP prefix list on SwitchB to filter routes as required.
[SwitchB] ip ip-prefix huawei index 10 deny 192.168.3.0 24 //Deny this route.
[SwitchB] ip ip-prefix huawei index 20 permit 0.0.0.0 0 less-equal 32 //Permit all routes.
2. Configure the filter-policy import command in the RIP view of SwitchB.
[SwitchB] rip
[SwitchB-rip-1] filter-policy ip-prefix huawei import Vlanif10
Verification
After the preceding configurations are complete, check the IP routing tables of
SwitchB and SwitchC.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 8
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.1.0/24 RIP 100 1 D 192.168.10.1 Vlanif10
192.168.2.0/24 RIP 100 1 D 192.168.10.1 Vlanif10
192.168.10.0/24 Direct 0 0 D 192.168.10.2 Vlanif10
192.168.10.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.20.0/24 Direct 0 0 D 192.168.20.1 Vlanif20
192.168.20.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
[SwitchC] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 7 Routes : 7
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.1.0/24 RIP 100 2 D 192.168.20.1 Vlanif20
192.168.2.0/24 RIP 100 2 D 192.168.20.1 Vlanif20
192.168.10.0/24 RIP 100 1 D 192.168.20.1 Vlanif20
192.168.20.0/24 Direct 0 0 D 192.168.20.2 Vlanif20
192.168.20.2/32 Direct 0 0 D 127.0.0.1 Vlanif20
The preceding command output shows that after the filter-policy import
command is configured on SwitchB, the IP routing tables of SwitchB and SwitchC
do not contain the route 192.168.3.0/24.
RIP is a distance-vector routing protocol and a RIP device advertises its routing
table to its neighbors. When the route 192.168.3.0/24 is filtered out from the IP
routing table of SwitchB, SwitchC can no longer learn this route through RIP. That
is, if routes in an IP routing table of a RIP device are filtered, the IP routing tables
of upstream devices of this RIP device are also affected.
NOTE
Both the filter-policy export and filter-policy import commands are configured in the RIP
process view. If routes are filtered based on interfaces or protocols, only one filter-policy can
be configured for one interface or protocol. If no interface or protocol is specified, a global
filter-policy is configured and similarly, only one filter-policy can be configured. If multiple
filter-policies are configured, only the latest filter-policy takes effect.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 963
Using a Filter-Policy to Filter the Intra-Area Routes Received by OSPF
Requirement Description
In Figure 10-12, three switches belong to OSPF Area 0. SwitchA advertises the test
network segment 10.1.1.0/24. It is required that the filter-policy import command
be configured on SwitchB so that the IP routing table of SwitchB does not contain
the route 10.1.1.0/24.
Figure 10-12 Using a filter-policy to filter the intra-area routes received by OSPF
Configuration
1. Define an IP prefix list on SwitchB to filter routes as required.
[SwitchB] ip ip-prefix huawei index 10 deny 10.1.1.0 24 //Deny this route.
[SwitchB] ip ip-prefix huawei index 20 permit 0.0.0.0 0 less-equal 32 //Permit all routes.
2. Configure the filter-policy import command in the OSPF view of SwitchB.
[SwitchB] ospf
[SwitchB-ospf-1] filter-policy ip-prefix huawei import
Verification
After the preceding configurations are complete, check the IP routing tables of
SwitchB and SwitchC.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.12.0/24 Direct 0 0 D 192.168.12.2 Vlanif12
192.168.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif12
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 964
192.168.23.0/24 Direct 0 0 D 192.168.23.1 Vlanif23
192.168.23.1/32 Direct 0 0 D 127.0.0.1 Vlanif23
[SwitchC] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 OSPF 10 3 D 192.168.23.1 Vlanif23
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.12.0/24 OSPF 10 2 D 192.168.23.1 Vlanif23
192.168.23.0/24 Direct 0 0 D 192.168.23.2 Vlanif23
192.168.23.2/32 Direct 0 0 D 127.0.0.1 Vlanif23
The preceding command output shows that, although the route 10.1.1.0/24 has
been filtered out on SwitchB, its LSA is still transmitted to SwitchC, so the IP
routing table of SwitchC still contains this route. This result also confirms that in
link-state routing protocols, a filter-policy filters only routing information but not
LSAs.
The LSDBs of SwitchB and SwitchC still contain the LSA describing the route
10.1.1.0/24. To verify this, check LSA information on SwitchB and SwitchC.
[SwitchB] display ospf lsdb router
OSPF Process 1 with Router ID 10.10.10.2
Area: 0.0.0.0
Link State Database
………
Type : Router
Ls id : 10.10.10.1
Adv rtr : 10.10.10.1
Ls age : 139
Len : 48
Options : E
seq# : 80000005
chksum : 0x41c4
Link count: 2
* Link ID: 10.1.1.0
Data : 255.255.255.0
Link Type: StubNet
Metric : 1
Priority : Low
* Link ID: 192.168.12.2
Data : 192.168.12.1
Link Type: TransNet
Metric : 1
[SwitchC] display ospf lsdb router
OSPF Process 1 with Router ID 10.10.10.3
Area: 0.0.0.0
Link State Database
…………
Type : Router
Ls id : 10.10.10.1
Adv rtr : 10.10.10.1
Ls age : 81
Len : 48
Options : E
seq# : 80000005
chksum : 0x41c4
Link count: 2
* Link ID: 10.1.1.0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 965
Data : 255.255.255.0
Link Type: StubNet
Metric : 1
Priority : Low
* Link ID: 192.168.12.2
Data : 192.168.12.1
Link Type: TransNet
Metric : 1
The preceding command output shows that the LSDBs of SwitchB and SwitchC still
contain the LSA describing the route 10.1.1.0/24.
Using a Filter-Policy to Filter the Inter-Area Routes Received by OSPF
In Figure 10-13 there are two OSPF areas, Area 0 and Area 1. SwitchB and
SwitchC transmit Type 3 LSAs, which are generated by SwitchB to describe inter-
area routes. The configuration is similar to the configuration in the previous
scenario. The following describes the filtering result.
Figure 10-13 Using a filter-policy to filter the inter-area routes received by OSPF
Before configuring a filter-policy, check the IP routing tables of SwitchB and
SwitchC.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 7 Routes : 7
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 OSPF 10 2 D 192.168.12.1 Vlanif12
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.12.0/24 Direct 0 0 D 192.168.12.2 Vlanif12
192.168.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif12
192.168.23.0/24 Direct 0 0 D 192.168.23.1 Vlanif23
192.168.23.1/32 Direct 0 0 D 127.0.0.1 Vlanif23
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 966
[SwitchC] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 OSPF 10 3 D 192.168.23.1 Vlanif23
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.12.0/24 OSPF 10 2 D 192.168.23.1 Vlanif23
192.168.23.0/24 Direct 0 0 D 192.168.23.2 Vlanif23
192.168.23.2/32 Direct 0 0 D 127.0.0.1 Vlanif23
The preceding command output shows that before a filter-policy is configured, the
IP routing tables of SwitchB and SwitchC contain the route 10.1.1.0/24.
Verification
After the filter-policy import command is configured on SwitchB, check the IP
routing tables of SwitchB and SwitchC.
[SwitchB] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
-----------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.12.0/24 Direct 0 0 D 192.168.12.2 Vlanif12
192.168.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif12
192.168.23.0/24 Direct 0 0 D 192.168.23.1 Vlanif23
192.168.23.1/32 Direct 0 0 D 127.0.0.1 Vlanif23
[SwitchC] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 5 Routes : 5
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.12.0/24 OSPF 10 2 D 192.168.23.1 Vlanif23
192.168.23.0/24 Direct 0 0 D 192.168.23.2 Vlanif23
192.168.23.2/32 Direct 0 0 D 127.0.0.1 Vlanif23
There are two OSPF areas. The route 10.1.1.0/24 on SwitchC is described by the
Type 3 LSA generated by SwitchB, but this route has been filtered out by SwitchB.
Therefore, the Type 3 LSA describing an inter-area route cannot be generated, and
SwitchC cannot learn the route 10.1.1.0/24 again.
Relevant Information
Technology Forum
Huawei S Series Switches Routing Policy
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 967
10.2.5 AS_Path Filter Applications in BGP
Overview
The AS_Path attribute is an ordered list of all the ASs that a route passes through
from the source to the destination. In Figure 10-14, the AS_Path attribute of a
BGP route can be considered as a string containing spaces and can be used to
match routes through a regular expression.
Figure 10-14 AS_Path attributes of BGP routes
A regular expression is a string that describes a characteristic and verifies whether
another string conforms to this characteristic. The AS_Path filter of BGP defines an
AS_Path regular expression to match AS_Path attributes of BGP routes for filtering
BGP routing information.
For example, ip as-path-filter 1 permit 495 defines an AS_Path filter 1 and a
regular expression 495, indicating that any string containing 495 can be matched.
AS_Path Regular Expressions
The core of an AS_Path filter is a regular expression. The content of a regular
expression is complex. The following describes the AS_Path filter.
An AS_Path filter uses a regular expression to define matching rules. A regular
expression consists of the following parts:
● Metacharacter: defines matching rules.
● General character: defines matching objects.
Table 10-6 lists metacharacters supported by BGP AS_Path regular expressions.
Table 10-6 Metacharacters supported by BGP AS_Path regular expressions
Meta
chara
cter
Description Example
. Matches AS_Paths with
any single character
except "\n", including
spaces.
.* matches any AS_Path or route.
NOTE
If you have defined multiple ip as-path-filter
clauses in deny mode, run the ip as-path-filter
as-path-filter-name permit .* command to permit
other routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 968
Meta
chara
cter
Description Example
* Matches AS_Paths with 0
or more sequences of
the character before the
asterisk "*".
See the preceding example.
+ Matches AS_Paths with 1
or more sequences of
the character before the
plus "+".
65+ matches AS_Paths that begin with 6 and
include one 5 or consecutive 5s.
● AS_Path examples that 65+ matches: 65,
655, 6559, 65259, and 65529
● AS_Path examples that 65+ does not
match: 56, 556, 5669, 55269, and 56259
| Matches any AS_Path
with characters on either
side of the vertical bar
"|".
100|65002|65003 matches 100, 65002, or
65003.
^ Matches AS_Paths
beginning with the
characters that follow
the caret "^".
^65 matches AS_Paths beginning with 65.
● AS_Path examples that ^65 matches: 65,
651, 6501, and 65001
● AS_Path examples that ^65 does not
match: 165, 1650, 6650, and 60065
$ Matches AS_Paths
ending with the
characters before the
dollar sign "$".
65$ matches AS_Paths ending with 65.
● AS_Path examples that 65$ matches: 65,
165, 1065, 10065, and 60065
● AS_Path examples that 65$ does not
match: 651, 1650, 6650, 60650, and
65001
NOTE
^$ matches null character strings (null AS_Path)
and can be used to match the locally originated
routes.
(xyz) Defines a subexpression,
which can be null. Both
the expression and the
subexpression should be
matched.
100(200)+ matches "100200" and
"100200200".
[xyz] Matches AS_Paths with
any character in the
brackets "[ ]".
[896] matches AS_Paths with 8, 9, or 6.
[^xyz
]
Matches AS_Paths with
any character except
those in the brackets
"[ ]".
[^896] matches AS_Paths with any character
except 8, 9, and 6.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 969
Meta
chara
cter
Description Example
[a-z] Matches AS_Paths with
any character within the
range specified in the
brackets "[ ]".
[2-4] matches 2, 3, and 4, and [0-9]
matches numbers 0 to 9.
NOTE
The characters in the brackets "[ ]" can only be
numbers 0 to 9. To match AS_Paths within the
range of 735 to 907, use (73[5-9]|7[4-9][0-9]|
8[0-9][0-9]|90[0-7]).
[^a-
z]
Matches AS_Paths
without any character
within the range
specified in the brackets
"[ ]".
[^2-4] matches AS_Paths without 2, 3, or 4,
and [^0-9] matches AS_Paths without
numbers 0 to 9.
_ Matches AS_Paths with a
sign, such as a comma
",", left brace "{", right
brace "}", left
parenthesis "(", right
parenthesis ")", or space.
The underscore "_" can
be used at the beginning
of a regular expression
with the same function
as the caret "^" or at the
end of a regular
expression with the same
function as the dollar
sign "$".
● ^65001_ matches AS_Paths that begin
with 65001 followed by a sign.
Specifically, ^65001_ matches AS_Paths
with 65001 as the leftmost AS number
(the number of the last AS through which
a route passes) or the routes sent by
peers in AS 65001.
● _65001_ matches AS_Paths with 65001 or
matches routes that pass through AS
65001.
● _65001$ matches AS_Paths that end with
a sign followed by 65001. Specifically,
_65001$ matches AS_Paths with 65001 as
the rightmost AS number (the number of
the first AS through which a route
passes) or matches the routes that are
originated in AS 65001.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 970
Meta
chara
cter
Description Example
\ Indicates an escape
character.
A backslash "\" is used to disable special
functions of signs in regular expressions,
such as the left parenthesis "(" and right
parenthesis ")" in an AS_Confed_Sequence,
the left bracket "[" and right bracket "]" in
an AS_Confed_Set, and the left brace "{" and
right brace "}" in an AS_Set.
● \(65002_ matches AS_Confed_Sequences
that begin with (65002 followed by a
sign. Specifically, \(65002_ matches
AS_Confed_Sequences with 65002 as the
leftmost AS number (the number of the
last AS through which a route passes) or
matches the routes sent by peers in AS
65002.
● \(.*_65003_.*\) matches
AS_Confed_Sequences with 65003 or
matches the routes that pass through AS
65003.
● _65004\) matches AS_Confed_Sequences
that end with a sign followed by 65004).
Specifically, _65004\) matches
AS_Confed_Sequences with 65004 as the
rightmost AS number (the number of the
first AS through which a route passes) or
matches the routes that are originated in
AS 65004. _65004\) and 65004\) have the
same function.
Multiple rules (permit or deny) can be specified in an AS_Path filter. The
relationship between theses rules is "OR", which means that if a route meets one
of the matching rules, the route matches the AS_Path filter. The following
demonstrates the functions of AS_Path filters in different scenarios.
Applications
The AS_Path filter defines only a filtering tool, which takes effect only after being
invoked. Two methods are available in BGP to invoke the AS_Path filter:
● Use the peer command.
● Use a route-policy.
Method 1: Invoke the AS_Path filter using the peer command.
#
ip as-path-filter s1 permit ^100$
#
bgp 65100
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 971
peer 10.1.1.2 as-path-filter s1 import
#
In method 1, an AS_Path filter s1 is defined and associated with a regular
expression ^100$. This AS_Path filter can match routes carrying the AS_Path
attribute 100 (this attribute contains only the AS number 100) and is applied in
the peer command. In this situation, only the routes that match AS_Path filter s1
can be advertised to the BGP peer 10.1.1.2.
Method 2: Invoke the AS_Path filter using a route-policy.
#
ip as-path-filter s1 permit ^100$
#
route-policy huawei permit node 10
if-match as-path-filter s1
apply local-preference 100
#
bgp 65100
peer 10.1.1.2 route-policy huawei import
#
In method 2, a defined AS_Path filter s1 is invoked in the if-match command in a
route-policy, and then the Local-Preference attribute is set using the apply
command and applied in the peer command (in the import direction) in BGP
configuration mode. In this situation, among the BGP routes received from the
BGP peer 10.1.1.2, all the routes that match the AS_Path filter s1 have their LP
path attributes set to 100.
AS_Path Filter Examples
In Figure 10-15, an EBGP peer relationship is established between LSW1 and
LSW2, between LSW1 and LSW3, between LSW2 and LSW3, between LSW2 and
LSW4, between LSW3 and LSW4, and between LSW4 and LSW5. Each device uses
the network command to advertise IP addresses of LoopBack0 into BGP and filter
these routes.
Figure 10-15 Using an AS_Path filter to filter BGP routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 972
If no AS_Path filter is used, the original BGP routing table of LSW1 is as follows:
[LSW1] display bgp routing-table
BGP Local router ID is 10.1.1.1
Status codes: * - valid, > - best, d - damped,
h - history, i - internal, s - suppressed, S - Stale
Origin : i - IGP, e - EGP, ? - incomplete
Total Number of Routes: 9
Network NextHop MED LocPrf PrefVal Path/Ogn
*> 1.1.1.9/32 0.0.0.0 0 0 i
*> 2.2.2.9/32 10.1.1.2 0 0 65200i
* 10.1.2.2 0 65300 65200i
*> 3.3.3.9/32 10.1.2.2 0 0 65300i
* 10.1.1.2 0 65200 65300i
*> 4.4.4.9/32 10.1.1.2 0 65200 65400i
* 10.1.2.2 0 65300 65400i
*> 5.5.5.9/32 10.1.1.2 0 65200 65400 65500i
* 10.1.2.2 0 65300 65400 65500i
Case 1: Define an AS_Path filter s1 to receive only the routes originated in
AS65500.
[LSW1] ip as-path-filter s1 permit _65500$ //Define an AS_Path filter s1.
[LSW1] bgp 65100
[LSW1-bgp] ipv4-family unicast
[LSW1-bgp-af-ipv4] peer 10.1.1.2 as-path-filter s1 import //Invoke the AS_Path filter s1 using the peer
command.
[LSW1-bgp-af-ipv4] peer 10.1.2.2 as-path-filter s1 import
After the preceding configurations are complete, the BGP routing table is as
follows:
[LSW1] display bgp routing-table
BGP Local router ID is 10.1.1.1
Status codes: * - valid, > - best, d - damped,
h - history, i - internal, s - suppressed, S - Stale
Origin : i - IGP, e - EGP, ? - incomplete
Total Number of Routes: 3
Network NextHop MED LocPrf PrefVal Path/Ogn
*> 1.1.1.9/32 0.0.0.0 0 0 i
*> 5.5.5.9/32 10.1.1.2 0 65200 65400 65500i
* 10.1.2.2 0 65300 65400 65500i
The preceding command output shows that the routes originated in AS65500 are
permitted and other routes are denied.
Case 2: Define an AS_Path filter s2 to deny the routes originated in AS65500 and
permit other routes.
[LSW1] ip as-path-filter s2 deny _65500$
[LSW1] ip as-path-filter s2 permit .*
[LSW1] bgp 65100
[LSW1-bgp] ipv4-family unicast
[LSW1-bgp-af-ipv4] peer 10.1.1.2 as-path-filter s2 import
[LSW1-bgp-af-ipv4] peer 10.1.2.2 as-path-filter s2 import
After the preceding configurations are complete, the BGP routing table is as
follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 973
[LSW1] display bgp routing-table
BGP Local router ID is 10.1.1.1
Status codes: * - valid, > - best, d - damped,
h - history, i - internal, s - suppressed, S - Stale
Origin : i - IGP, e - EGP, ? - incomplete
Total Number of Routes: 7
Network NextHop MED LocPrf PrefVal Path/Ogn
*> 1.1.1.9/32 0.0.0.0 0 0 i
*> 2.2.2.9/32 10.1.1.2 0 0 65200i
* 10.1.2.2 0 65300 65200i
*> 3.3.3.9/32 10.1.2.2 0 0 65300i
* 10.1.1.2 0 65200 65300i
*> 4.4.4.9/32 10.1.1.2 0 65200 65400i
* 10.1.2.2 0 65300 65400i
The preceding command output shows that the routes originated in AS65500 are
denied and other routes are permitted.
Case 3: Define an AS_Path filter s3 to deny the routes that pass through AS65400.
[LSW1] ip as-path-filter s3 deny _65400_
[LSW1] ip as-path-filter s3 permit .*
[LSW1] bgp 65100
[LSW1-bgp] ipv4-family unicast
[LSW1-bgp-af-ipv4] peer 10.1.1.2 as-path-filter s3 import
[LSW1-bgp-af-ipv4] peer 10.1.2.2 as-path-filter s3 import
After the preceding configurations are complete, the BGP routing table is as
follows:
[LSW1] display bgp routing-table
BGP Local router ID is 10.1.1.1
Status codes: * - valid, > - best, d - damped,
h - history, i - internal, s - suppressed, S - Stale
Origin : i - IGP, e - EGP, ? - incomplete
Total Number of Routes: 5
Network NextHop MED LocPrf PrefVal Path/Ogn
*> 1.1.1.9/32 0.0.0.0 0 0 i
*> 2.2.2.9/32 10.1.1.2 0 0 65200i
* 10.1.2.2 0 65300 65200i
*> 3.3.3.9/32 10.1.2.2 0 0 65300i
* 10.1.1.2 0 65200 65300i
The preceding command output shows that the routes that pass through AS65400
are denied and other routes are permitted.
Case 4: Define an AS_Path filter s4 to deny the routes that pass through AS65400.
AS65400 is not the first or last AS that routes pass through.
[LSW1] ip as-path-filter s4 deny ._65400_.
[LSW1] ip as-path-filter s4 permit .*
[LSW1] bgp 65100
[LSW1-bgp] ipv4-family unicast
[LSW1-bgp-af-ipv4] peer 10.1.1.2 as-path-filter s4 import
[LSW1-bgp-af-ipv4] peer 10.1.2.2 as-path-filter s4 import
After the preceding configurations are complete, the BGP routing table is as
follows:
[LSW1] display bgp routing-table
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 974
BGP Local router ID is 10.1.1.1
Status codes: * - valid, > - best, d - damped,
h - history, i - internal, s - suppressed, S - Stale
Origin : i - IGP, e - EGP, ? - incomplete
Total Number of Routes: 7
Network NextHop MED LocPrf PrefVal Path/Ogn
*> 1.1.1.9/32 0.0.0.0 0 0 i
*> 2.2.2.9/32 10.1.1.2 0 0 65200i
* 10.1.2.2 0 65300 65200i
*> 3.3.3.9/32 10.1.2.2 0 0 65300i
* 10.1.1.2 0 65200 65300i
*> 4.4.4.9/32 10.1.1.2 0 65200 65400i
* 10.1.2.2 0 65300 65400i
The preceding command output shows that the routes carrying the AS_Path
attribute in which AS65400 is neither the first nor last AS number are denied and
other routes are permitted.
Case 5: Define an AS_Path filter s5 to permit locally originated routes and deny
routes of other ASs.
[LSW1] ip as-path-filter s5 permit ^$
[LSW1] bgp 65100
[LSW1-bgp] ipv4-family unicast
[LSW1-bgp-af-ipv4] peer 10.1.1.2 as-path-filter s5 import
[LSW1-bgp-af-ipv4] peer 10.1.2.2 as-path-filter s5 import
After the preceding configurations are complete, the BGP routing table is as
follows:
[LSW1] display bgp routing-table
BGP Local router ID is 10.1.1.1
Status codes: * - valid, > - best, d - damped,
h - history, i - internal, s - suppressed, S - Stale
Origin : i - IGP, e - EGP, ? - incomplete
Total Number of Routes: 1
Network NextHop MED LocPrf PrefVal Path/Ogn
*> 1.1.1.9/32 0.0.0.0 0 0 i
The preceding command output shows that only locally originated routes with
empty AS_Path attribute are permitted and other routes are denied.
Relevant Information
Technology Forum
Huawei S Series Switches Routing Policy
10.2.6 Community Attribute Applications in BGP
Community Attribute
The Community attribute is a set of destination addresses with the same
characteristics. It simplifies routing policy applications and facilitates routing policy
management and maintenance and allows a group of BGP devices in multiple ASs
to share the same routing policies. This attribute is a route attribute and
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 975
transmitted between BGP peers and not restricted within an AS. Before advertising
a route with the Community attribute to peers, a BGP device can change the
original Community attribute of this route.
● The Community attribute is a set of 4-byte values, in the format AA:NN. As
defined in RFC1997, the first two bytes indicate an AS number, and the last
two bytes indicate a community identifier used for management.
● The Community attribute is a BGP route tag that simplifies the
implementation of routing policy. A specific Community attribute can be
assigned to some routes. Based on this Community attribute, these routes can
be managed and routing policy can be performed on these routes.
Figure 10-16 Community attribute application
In Figure 10-16, a large number of routes in AS100 are imported into BGP, and
these routes are used for voice calls and video surveillance. These routes are
advertised to AS200 through BGP. Devices in AS200 need to carry out different
policies on the routes used for voice calls and video surveillance. How to match
these routes? You can use ACLs or IP prefix lists to match the routes one by one.
This method, however, has a heavy workload and is inefficient because a large
number of route prefixes exist.
You can use the Community attribute to address this issue. When these routes are
imported into AS100, respective Community attributes are added to the routes to
differentiate the routes used for voice calls and video surveillance. That is, the
Community attribute 100:1 is added to the routes used for voice calls, and the
Community attribute 100:2 is added to the routes used for video surveillance.
These Community attributes are transmitted to AS200 along with the routes. In
AS200, to carry out different policies for the routes used for voice calls and video
surveillance, match the routes based on their respective Community attributes. For
example, you can match all the routes used for voice calls based on the
Community attribute 100:1.
BGP defines some well-known Community attributes. Table 10-7 lists these
Community attributes.
Table 10-7 BGP well-known Community attributes
Community
Attribute
Description
internet By default, all routes belong to the internet community. A
route with this attribute can be advertised to all BGP peers.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 976
Community
Attribute
Description
no-advertise A route with this attribute cannot be advertised to any
other BGP peers.
no-export A route with this attribute cannot be advertised outside the
local AS. If a confederation is defined, the route with this
attribute cannot be advertised to the ASs outside the
confederation but can be advertised to other sub-ASs in the
confederation.
no-export-
subconfed
A route with this attribute cannot be advertised outside the
local AS or advertised to other sub-ASs in the
confederation.
Setting the Community Attribute for Routes
To use the Community filter, ensure that the Community attribute is carried in
routes. The following describes how to set the Community attribute for routes.
Figure 10-17 Setting the Community attribute for routes
Requirement Description
In Figure 10-17, LSW1 in AS100 advertises two routes 10.1.1.0/24 and 10.1.2.0/24
through BGP. In the BGP process of LSW1, use an export route-policy to modify
the Community attribute of the route 10.1.1.0/24 to 100:1 so that downstream
devices can carry out policies on the route based on this Community attribute.
Configuration
The key configuration of LSW1 is as follows:
#
ip ip-prefix huawei index 10 permit 10.1.1.0 24 //Define an IP prefix list to match the target route.
#
route-policy RP permit node 10 //Define a route-policy to set the Community attribute for the
target route.
if-match ip-prefix huawei
apply community 100:1
route-policy RP permit node 20 //Permit the remaining routes.
#
bgp 100
router-id 1.1.1.1
peer 192.168.12.2 as-number 200
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 977
#
ipv4-family unicast
undo synchronization
network 10.1.1.0 255.255.255.0 //Advertise the route 10.1.1.0/24.
network 10.1.2.0 255.255.255.0 //Advertise the route 10.1.2.0/24.
peer 192.168.12.2 enable
peer 192.168.12.2 route-policy RP export //Apply the route-policy in the export direction of the
specified BGP peer.
peer 192.168.12.2 advertise-community //Advertise the Community attribute to the specified BGP
peer.
#
The key configuration of LSW2 is as follows:
#
bgp 200
router-id 2.2.2.2
peer 192.168.12.1 as-number 100
peer 192.168.23.2 as-number 300
#
ipv4-family unicast
undo synchronization
peer 192.168.12.1 enable
peer 192.168.23.2 enable
peer 192.168.23.2 advertise-community //Advertise the Community attribute to the specified BGP
peer.
#
By default, the Community attribute is not updated to BGP peers along with the
route prefix. Therefore, the peer advertise-community command needs to be
configured on LSW1 and LSW2 to advertise this attribute to BGP peers.
Verification
After the preceding configurations are complete, check the BGP route 10.1.1.0 in
the BGP routing table of LSW3.
<LSW3> display bgp routing-table 10.1.1.0
BGP local router ID : 3.3.3.3
Local AS number : 300
Paths: 1 available, 1 best, 1 select
BGP routing table entry information of 10.1.1.0/24:
From: 192.168.23.1 (2.2.2.2)
Route Duration: 01h08m07s
Direct Out-interface: Vlanif23
Original nexthop: 192.168.23.1
Qos information : 0x0
Community:<100:1> //This Community attribute is set and transmitted to downstream devices using a
route-policy on LSW1.
AS-path 200 100, origin igp, pref-val 0, valid, external, best, select, active,
pre 255
Not advertised to any peer yet
The preceding command output shows that after the Community attribute is set
for the route, this route carries a Community attribute when reaching LSW3, which
then can carry out some policies on the route based on the Community attribute.
Multiple methods are available to set the Community attribute for BGP routes.
Table 10-8 lists common methods to set this attribute.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 978
Table 10-8 Example for setting the Community attribute for BGP routes
Command Description
apply community
100
Changes the community name to 100.
apply community
100 150
Changes the community name to 100 or 150. That is, BGP
routes belong to two communities.
apply community
100 150 additive
Adds two Community attributes 100 and 150. That, BGP
routes belong to three communities.
apply community
none
Deletes the Community attribute of BGP routes.
Using a Community Filter to Match BGP Routes
The previous section describes how to set the Community attribute for BGP routes.
After this attribute is set on an upstream router, it is transmitted along with routes
so that downstream devices can carry out policies based on this attribute. BGP
provides a tool, Community filter, to match BGP routes based on the Community
attribute. The following describes how to use a Community filter to match BGP
routes.
Figure 10-18 Using a Community filter to match BGP routes
Requirement Description
In Figure 10-18, LSW1 in AS100 advertises three BGP routes. The Community
attribute is set for the routes and transmitted along with the routes to LSW3 in
AS300. Before policies are carried out, check the BGP routing table of LSW3.
<LSW3> display bgp routing-table
BGP Local router ID is 3.3.3.3
Status codes: * - valid, > - best, d - damped,
h - history, i - internal, s - suppressed, S - Stale
Origin : i - IGP, e - EGP, ? - incomplete
Total Number of Routes: 3
Network NextHop MED LocPrf PrefVal Path/Ogn
*> 10.1.1.0/24 192.168.23.1 0 200 100i
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 979
*> 10.1.2.0/24 192.168.23.1 0 200 100i
*> 10.1.3.0/24 192.168.23.1 0 200 100i
The preceding command output shows that the BGP routing table of LSW3
contains three routes. Routing policy needs to be carried out on LSW3 to permit
only the routes carrying the Community attribute 100:999.
Configuration
The previous section has described how to set the Community attribute. The
following describes how to use a Community filter to filter routes.
The key configuration of LSW3 is as follows:
#
ip community-filter 1 permit 100:999 //Permit the route carrying the Community attribute 100:999.
#
route-policy huawei permit node 10 //Invoke the Community filter using a route-policy.
if-match community-filter 1
#
bgp 300
router-id 3.3.3.3
peer 192.168.23.1 as-number 200
#
ipv4-family unicast
undo synchronization
peer 192.168.23.1 enable
peer 192.168.23.1 route-policy huawei import //Use the route-policy in the import direction of the
specified BGP peer.
#
Verification
After the preceding configurations are complete, check the BGP routing table of
LSW3.
[LSW3] display bgp routing-table
BGP Local router ID is 3.3.3.3
Status codes: * - valid, > - best, d - damped,
h - history, i - internal, s - suppressed, S - Stale
Origin : i - IGP, e - EGP, ? - incomplete
Total Number of Routes: 2
Network NextHop MED LocPrf PrefVal Path/Ogn
*> 10.1.1.0/24 192.168.23.1 0 200 100i
*> 10.1.2.0/24 192.168.23.1 0 200 100i
The defined Community filter matches the route carrying the Community attribute
100:999. Therefore, the two routes 10.1.1.0/24 and 10.1.2.0/24 are permitted on
LSW3, and other BGP routes are denied.
For this scenario, the following provides three common methods to configure the
Community filter:
Case 1:
ip community-filter 1 permit 100:1 100:999
//Only the routes that carry two Community attributes 100:1 and 100:999 can be matched. Therefore, the
route 10.1.1.0/24 is matched.
Case 2:
ip community-filter 1 permit 100:1
ip community-filter 1 permit 100:2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 980
//The routes that carry the Community attribute 100:1 or 100:2 can be matched. Therefore, the routes
10.1.1.0/24 and 10.1.2.0/24 are matched.
Case 3:
ip community-filter 1 permit internet
//By default, all routes carry the Internet attribute. Therefore, all routes are matched.
Relevant Information
Technology Forum
Huawei S Series Switches Routing Policy
10.3 Summary of Routing Policy Configuration Tasks
Table 10-9 describes the routing policy configuration tasks. After routing policies
are configured, apply them only when using routing protocols to advertise, receive,
or import routes to implement the route filtering and attribute configuration
functions.
Table 10-9 Routing policy configuration tasks
Scenario Description Task
Configuring the filter Routing policy filters
include: ACLs, IP prefix lists,
AS path filters, community
filters, extended community
filters, and RD filters. These
routing policy filters can be
applied to the if-match
clauses of a routing policy
and can also be used
separately in specific
situations.
10.5 Configuring
Filters
Configuring routing
policies
To reduce network burden
and ensure network
security, apply the routing
policies with if-match
clauses in the following
situations:
● Importing routes
● Advertising and receiving
routes
● Filtering using the RT
and RD attributes in the
VPN
10.6 Configuring a
Routing Policy
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 981
Scenario Description Task
Configuring filter-policies If you need to control
receiving and advertisement
of routes in each routing
protocol, use filter-policies:
● filter-policy import
allows receiving only the
routes that meet filtering
criteria.
● filter-policy export
allows advertising only
the routes that meet
filtering criteria.
10.7 Configuring
Filter-Policy
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 982
Scenario Description Task
Configuring the valid
time of a routing policy
In practical applications,
when multiple cooperative
configurations of a routing
policy change, the routing
management (RM) module
immediately informs the
protocols to re-apply the
routing policy after a
configuration is complete. If
routing policies are
incomplete, route flapping
occurs, which results in
network instability.
The processing rules for
routing policy changes are
as follows:
● By default, if a routing
policy changes, the RM
module immediately
informs the protocols to
apply a new routing
policy.
● If the valid time of a
routing policy is
configured, the RM
module does not
immediately inform the
protocols to process the
changes when the
related command
configurations of the
routing policy change.
Instead, routing protocols
wait for the configured
valid time and then apply
a new routing policy.
● If the configuration of
the routing policy
changes again during the
configured valid time, the
RM module resets the
timer.
To configure the valid time,
run the route-policy-
change notify-delay
command.
10.8 Controlling the
Valid Time of
Routing Policies
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 983
10.4 Licensing Requirements and Limitations for
Routing Policies
Involved Network Elements
Other network elements are not required.
Licensing Requirements
Routing policy is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support Routing Policy.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
Feature Limitations
None.
10.5 Configuring Filters
Pre-configuration Tasks
Before configuring filters, configure routing protocols.
Configuration Procedure
Configure each of the filters in any sequence according to network requirements.
10.5.1 Configuring an IP Prefix List
Context
Configuring an IP prefix list controls the advertising and receiving of routes based
on the destination address.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 984
NOTICE
If an IP prefix list is not used together with the if-match clauses in a routing
policy, you must set at least one node to the permit mode in the IP prefix list. If
no node is set to the permit mode, all routes are filtered out.
Procedure
Step 1 Configure an IPv4 prefix list.
1. Run system-view
The system view is displayed.
2. Run ip ip-prefix
ip-prefix-name [ index
index-number ] { permit | deny }
ipv4-address mask-length [ match-network ] [ greater-equal
greater-equal-
value ] [ less-equal
less-equal-value ]
An IPv4 prefix list is configured.
Step 2 Configure an IPv6 prefix list.
1. Run system-view
The system view is displayed.
2. Run ip ipv6-prefix
ipv6-prefix-name [ index
index-number ] { permit | deny }
ipv6-address prefix-length [ match-network ] [ greater-equal
greater-equal-
value ] [ less-equal
less-equal-value ]
An IPv6 prefix list is configured.
----End
Verifying the Configuration
● Run the display ip ip-prefix [
ip-prefix-name ] command to check
information about the IPv4 prefix list.
● Run the display ip ipv6-prefix [
ipv6-prefix-name ] command to check
information about the IPv6 prefix list.
10.5.2 Configuring an AS_Path Filter
Context
An AS_Path filter is used to filter routes based on the AS_Path attributes of BGP
routes. If you do not want to receive routes of a specified AS number, configure an
AS_Path filter based on the specified AS number. On a complex network, multiple
ACLs or IP prefix lists must be configured to filter BGP routes. This can be a
complicated process; configuring an AS_Path filter can simplify the configuration.
Procedure
Step 1 Run system-view
The system view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 985
Step 2 Run ip as-path-filter {
as-path-filter-number |
as-path-filter-name } { permit |
deny }
regular-expression
An AS_Path filter is configured.
In the preceding command,
regular-expression indicates that the AS_Path filter
uses a regular expression to define matching rules.
----End
Verifying the Configuration
● Run the display ip as-path-filter [
as-path-filter-number |
as-path-filter-
name ] command to check information about a configured AS_Path filter.
10.5.3 Configuring a Community Filter
Context
The community attribute identifies routes with the same characteristics without
considering IP prefixes and AS numbers. Configuring community filters and
community attributes simplifies route management when it is inconvenient to use
the IP prefix list or AS_Path filter. For example, a company branch needs to receive
routes only from its headquarters and from branches in adjacent countries. In this
case, you can configure different community attributes for each of the branches.
Routes in the original branch can then be managed based on community
attributes, without considering IP prefixes and AS numbers of routes in different
countries.
Community filters are classified into basic and advanced community filters. An
advanced community filter supports regular expressions and is more flexible than
a basic community filter.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip community-filter
A community filter is configured.
● To configure a basic community filter, run the ip community-filter { basic
comm-filter-name |
basic-comm-filter-num } { permit | deny } [
community-
number |
aa:nn | internet | no-export-subconfed | no-advertise | no-export ]
&<1-20> command.
● To configure an advanced community filter, run the ip community-filter
{ advanced
comm-filter-name |
adv-comm-filter-num } { permit | deny }
regular-expression command.
In the preceding command,
regular-expression indicates that the community filter
uses a regular expression to define matching rules.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 986
Verifying the Configuration
● Run the display ip community-filter [
basic-comm-filter-num |
adv-comm-
filter-num |
comm-filter-name ] command to check information about a
configured community filter.
10.5.4 Configuring an Extended Community Filter
Context
You can use an extended community filter when using the route target (RT)
attribute to filter routes in a VPN.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip extcommunity-filter {
basic-extcomm-filter-num | basic
basic-extcomm-
filter-name } { deny | permit } { rt {
as-number:nn |
4as-number:nn |
ipv4-
address:
nn } } &<1-16>
Or run ip extcommunity-filter {
advanced-extcomm-filter-num | advanced
advanced-extcomm-filter-name } { deny | permit }
regular-expression
An extended community filter is configured.
----End
Verifying the Configuration
Run the display ip extcommunity-filter [
basic-extcomm-filter-num |
advanced-
extcomm-filter-num |
extcomm-filter-name ] command to check information
about a configured extended community filter.
10.5.5 Configuring an RD Filter
Context
You can use an RD filter when using the RD attribute to filter routes in a VPN.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip rd-filter
rd-filter-number { deny | permit }
route-distinguisher &<1-10>
An RD filter is configured.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 987
Verifying the Configuration
● Run the display ip rd-filter [
rd-filter-number ] command to check
information about a configured RD filter.
10.6 Configuring a Routing Policy
Pre-configuration Tasks
Before configuring a routing policy, configure routing protocols.
Configuration Procedure
Before configuring the if-match and apply clauses, you must configure a routing
policy. You can configure the if-match and apply clauses in any sequence
according to network requirements.
10.6.1 Creating a Routing Policy
Context
A routing policy can consist of multiple matching rules and actions.
NOTICE
You must set at least one node to the permit mode in a routing policy; otherwise,
all routes are filtered out.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run route-policy
route-policy-name { permit | deny } node
node
A routing policy is created, and the routing policy view is displayed.
When a routing policy is used to filter a route, the route is matched with nodes in
the routing policy in ascending order of node ID. Therefore, a route is first
matched with the node with the smallest node ID. If a route matches a node in
the routing policy, the system does not continue to match it with other nodes. If a
route fails to match all the nodes in the routing policy, the route is filtered out.
Step 3 (Optional) Run description
text
The description of the routing policy is configured.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 988
NOTE
By default, the system does not allow a nonexistent route-policy to be specified in a
command. To enable the system to allow a nonexistent route-policy to be specified in a
command, run the route-policy nonexistent-config-check disable command.
----End
10.6.2 (Optional) Configuring an if-match Clause
Context
An if-match clause defines matching rules related to route filters and attributes in
a routing policy.
If no if-match clause is configured for a node in a routing policy, routes match the
routing policy in this node. If one or more if-match clauses are configured in a
node, the relationship between the clauses is "AND". This means that a route
matches this node only when they match all the if-match clauses in this node.
This rule does not apply to if-match as-path-filter, if-match community-filter,
if-match extcommunity-filter, if-match interface, or if-match route-type
clauses. The relationship between these clauses is "OR", and the relationship
between these clauses and other if-match clauses is "AND". For example, if
multiple if-match as-path-filter clauses are configured in a node, the relationship
between these clauses is "OR", and the relationship between these clauses and
other if-match clauses is "AND".
NOTE
If an if-match clause defines a filter that is not configured, all routes match this if-match
clause by default.
The if-match acl and if-match ip-prefix commands cannot be used together in the same
node. When both the commands are used in a node, the most recently configured one
overrides the previous one.
NOTICE
When modifying the configurations of cooperative routing policies with multiple
if-match clauses, it is recommended that you also perform the configuration task
of 10.8 Controlling the Valid Time of Routing Policies. Otherwise, an
incomplete routing policy will cause route flapping.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run route-policy
route-policy-name { permit | deny } node
node
The routing policy view is displayed.
Step 3 Configure if-match clauses in any sequence for a routing policy according to your
network requirements.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 989
● Run if-match acl {
acl-number |
acl-name }
An if-match clause is configured to match the basic ACL.
● Run if-match as-path-filter {
as-path-filter-number &<1-16> |
as-path-filter-
name }
An if-match clause is configured to match AS_Path filters.
● Run either of the following commands as required to configure an if-match
clause based on community filters:
– if-match community-filter {
basic-comm-filter-num [ whole-match ] |
adv-comm-filter-num } &<1-16>
– if-match community-filter
comm-filter-name [ whole-match ]
● Run if-match extcommunity-filter { {
basic-extcomm-filter-num |
adv-
extcomm-filter-num } &<1-16> |
extcomm-filter-name }
An if-match clause is configured to match extended community filters.
● Run if-match cost {
cost | greater-equal
greater-equal-value [ less-equal
less-equal-value ] | less-equal
less-equal-value }
An if-match clause is configured to match the route cost of routes.
● Run if-match interface {
interface-type interface-number } &<1-16>
An if-match clause is configured to match the outbound interface of routes.
● Run if-match ip { next-hop | route-source | group-address } { acl {
acl-
number |
acl-name } | ip-prefix
ip-prefix-name }
An if-match clause is configured to match the next hop or source address of
IPv4 routes.
● Run if-match ipv6 { address | next-hop | route-source } prefix-list
ipv6-
prefix-name
An if-match clause is configured to match the destination address, next hop,
or source address of IPv6 routes.
● Run if-match ip-prefix
ip-prefix-name
An if-match clause is configured to match the IP prefix list.
● Run if-match rd-filter
rd-filter-number
An if-match clause is configured to match the RD filter.
● Run the following command as required to match the type of route:
– Run if-match route-type { external-type1 | external-type1or2 |
external-type2 | internal | nssa-external-type1 | nssa-external-
type1or2 | nssa-external-type2 }
An if-match clause is configured to match a specified type of OSPF
routes.
– Run if-match route-type { is-is-level-1 | is-is-level-2 }
An if-match clause is configured to match a specified type of IS-IS routes.
● Run if-match tag
tag
An if-match clause is configured to match the tag of routes.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 990
10.6.3 (Optional) Configuring an apply Clause
Context
An apply clause specifies the action of setting attributes for routes that have
matched a routing policy node. If a node does not have an apply clause
configured, the node will only filter routes. If one or more apply clauses are
configured in a node, all the apply clauses are applied to routes that have
matched the node.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run route-policy
route-policy-name { permit | deny } node
node
The route-policy view is displayed.
Step 3 Run the following commands as required to configure apply clauses. A node can
have multiple or no apply clauses.
● Run apply as-path { {
as-number-plain |
as-number-dot } &<1-10> { additive
| overwrite } | none overwrite }
An apply clause is configured to change the AS_Path attribute of BGP routes.
● Run apply backup-interface
interface-type interface-number
An apply clause is configured to change the backup outbound interface of
routes.
● Run apply backup-nexthop {
ip-address | auto }
An apply clause is configured to change the backup next hop of routes.
● Run apply comm-filter {
basic-comm-filter-number |
adv-comm-filter-
number |
comm-filter-name } delete
An apply clause is configured to delete the specified community attribute of
BGP routes.
NOTE
To delete the community attributes, you can run the ip community-filter command
several times to configure community attributes one by one, and apply the routing
policy containing the apply comm-filter delete command to delete these community
attributes. If multiple community attributes are specified in one community filter, none
of them can be deleted.
● Run apply community none
An apply clause is configured to delete all community attributes of BGP
routes.
● Run apply community {
community-number |
aa:nn | internet | no-advertise
| no-export | no-export-subconfed } &<1-32> [ additive ]
An apply clause is configured to set the community attributes of BGP routes.
● Run apply cost [ + | - ]
cost
The route cost is set.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 991
● Run the following commands as required to set the cost type of a route:
– Run apply cost-type { external | internal }
The IS-IS cost type is set.
– Run apply cost-type { type-1 | type-2 }
The OSPF cost type is set.
● Run apply dampening
half-life-reach reuse suppress ceiling
The dampening parameters of EBGP routes are set.
● Run apply extcommunity { rt {
as-number:nn |
4as-number:nn |
ipv4-
address:nn } }&<1-16> [ additive ]
An extended community attribute (route-target) of BGP is set.
● Run apply ip-address next-hop {
ipv4-address | peer-address }
The next-hop address of the IPv4 route is set.
● Run apply ipv6 next-hop { peer-address |
ipv6-address }
The next-hop address of the IPv6 route is set.
● Run apply isis { level-1 | level-1-2 | level-2 }
The level of the IS-IS route is set.
● Run apply local-preference
preference
The local preference for BGP routes is set.
● Run apply origin { egp {
as-number-plain |
as-number-dot } | igp |
incomplete }
The Origin attribute of BGP routes is set.
● Run apply ospf { backbone | stub-area }
An OSPF area into which routes are imported is set.
● Run apply preference
preference
The preference of the routing protocol is set.
● Run apply preferred-value
preferred-value
A preferred value is set for BGP routes.
● Run apply tag
tag
The route tag is set.
----End
10.6.4 (Optional) Enabling Further Route Matching Against a
Specified Node
Context
The relationship among the matching rules of nodes in the same route-policy is
OR. Specifically, if a route matches a node, it matches the route-policy and is no
longer matched against other nodes. If you want the route to be matched against
two or more nodes, run the goto next-node command so that the route is further
matched against a specified node after the route matches the current node.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 992
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run route-policy
route-policy-name { permit | deny } node
node
The route-policy view is displayed.
Step 3 Run goto next-node [
node ]
The route-policy is configured to further match routes against a specified node
after the routes match the current node.
● If
node is not specified in the command, the route will be further matched
against the next node of the current node by default.
● If the node specified in the command does not exist, the route will be further
matched against the next node of the specified node by default. If the next
node of the specified node does not exist either, the route fails to match the
route-policy, and no apply clause will be applied to the route.
----End
10.6.5 Applying a Route-Policy
Context
A route-policy can be applied to direct, static, RIP/RIPng, IS-IS, OSPF/OSPFv3, BGP/
BGP4+, multicast, and BGP/MPLS IP VPN routes. In addition, a route-policy can be
applied to an FRR scenario. Perform one of the following configurations as
needed:
● Apply a route-policy to direct routes.
● Apply a route-policy to RIP routes.
● Apply a route-policy to RIPng routes.
● Apply a route-policy to IPv4 IS-IS routes.
● Apply a route-policy to IPv6 IS-IS routes.
● Apply a route-policy to OSPF routes.
● Apply a route-policy to OSPFv3 routes.
● Apply a route-policy to BGP routes.
● Apply a route-policy to BGP4+ routes.
● Apply a route-policy to multicast routes.
● Apply a route-policy to BGP/MPLS IP VPN routes.
● Apply a route-policy to an FRR scenario.
NOTE
By default, the system does not allow a nonexistent route-policy to be specified in a
command. To enable the system to allow a nonexistent route-policy to be specified in a
command, run the route-policy nonexistent-config-check disable command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 993
Procedure
● Apply a route-policy to direct routes.
a. Run system-view
The system view is displayed.
b. To apply a route-policy to specific direct routes, see Table 10-10.
Table 10-10 Applying a route-policy to direct routes
Configuration
Task
Command Reference
Configure a
device to
advertise ARP
Vlink direct
routes that
match a route-
policy on the
public network
arp vlink-direct-route
advertise [ route-policy
route-policy-name ]
11.2.7 Configuring
the Advertisement
of IPv4 ARP Vlink
Direct Routes
● Apply a route-policy to RIP routes.
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
A RIP process is enabled, and the RIP view is displayed.
c. To apply a route-policy to specific RIP routes, see Table 10-11.
Table 10-11 Applying a route-policy to RIP routes
Configuration
Task
Command Reference
Configure a
device to
generate a
default route or
advertise a
default route in
the routing table
to neighbors only
when the
matching
conditions of a
route-policy are
met.
default-route originate
[ cost
cost | { match default |
route-policy
route-policy-
name } [ avoid-learning ] ]*
3.10.1 Configuring
RIP to Advertise
Default Routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 994
Configuration
Task
Command Reference
Configure RIP to
import the BGP
routes that match
a route-policy.
import-route bgp [ permit-
ibgp ] [ cost {
cost |
transparent } | route-policy
route-policy-name ] *
3.10.3 Configuring
RIP to Import Routes
Configure RIP to
import routes
that match a
route-policy from
another routing
protocol.
import-route { { static |
direct | unr } | { rip | ospf |
isis } [
process-id ] } [ cost
cost | route-policy
route-
policy-name ] *
3.10.3 Configuring
RIP to Import Routes
Set a priority for
routes that match
a route-policy.
preference {
preference |
route-policy
route-policy-
name } *
3.9.1 Configuring RIP
Preference
● Apply a route-policy to RIPng routes.
a. Run system-view
The system view is displayed.
b. Run ripng [
process-id ]
A RIPng process is enabled, and the RIPng view is displayed.
c. To apply a route-policy to specific RIPng routes, see Table 10-12.
Table 10-12 Applying a route-policy to RIPng routes
Configuration
Task
Command Reference
Configure RIPng
to import routes
that match a
route-policy from
another routing
protocol.
import-route { { ripng | isis |
ospfv3 } [
process-id ] | bgp
[ permit-ibgp ] | unr | direct |
static } [ [ cost
cost | inherit-
cost ] | route-policy
route-
policy-name ] *
4.9.3 Configuring a
RIPng Process to
Import External
Routes
Set a priority for
RIPng routes that
match a route-
policy.
preference {
preference |
route-policy
route-policy-
name } *
4.8.1 Configuring
RIPng Preference
● Apply a route-policy to IPv4 IS-IS routes.
– To apply a route-policy in the IS-IS view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the isis [
process-id ] command to enter the IS-IS view.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 995
iii. To apply a route-policy to IPv4 IS-IS routes in the IS-IS view, see
Table 10-13.
Table 10-13 Applying a route-policy to IPv4 IS-IS routes in the IS-IS view
Configuration
Task
Command Reference
Configure IS-IS
to generate and
advertise default
routes to the IS-
IS domain only
when external
routes that
match a route-
policy exist in
the routing table
of a Level-1-2
router.
default-route-advertise
[ always | match default |
route-policy
route-policy-
name ] [ cost
cost | tag
tag
| [ level-1 | level-1-2 |
level-2 ] ] * [ avoid-
learning ]
7.9.1 Configuring
IS-IS to Advertise a
Default Route
Configure IS-IS
to advertise the
routes that are
imported from
another routing
protocol and
match a route-
policy.
filter-policy route-policy
route-policy-name export
[
protocol [
process-id ] ]
7.9.3 Configuring
IS-IS to Advertise
Specified External
Routes to an IS-IS
Routing Domain
Configure IS-IS
to accept the
routes that
match a route-
policy.
filter-policy route-policy
route-policy-name import
7.9.4 Adding
Specified IS-IS
Routes to the IP
Routing Table
Configure IS-IS
to import routes
that match a
route-policy
from another
routing protocol.
import-route { { rip | isis |
ospf } [
process-id ] | static
| direct | unr | bgp
[ permit-ibgp ] } [ cost-
type { external | internal } |
cost
cost | tag
tag | route-
policy
route-policy-name |
[ level-1 | level-2 |
level-1-2 ] ] *
import-route { { rip | isis |
ospf } [
process-id ] | direct
| unr | bgp } inherit-cost
[ tag
tag | route-policy
route-policy-name |
[ level-1 | level-2 |
level-1-2 ] ] *
7.9.2 Configuring
IS-IS to Import
External Routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 996
Configuration
Task
Command Reference
Leak Level-1
routes that
match a route-
policy to a
Level-2 area.
import-route isis level-1
into level-2 filter-policy
route-policy
route-policy-
name
7.8.4 Configuring
IS-IS Route Leaking
Leak Level-2
routes that
match a route-
policy to a
Level-1 area.
import-route isis level-2
into level-1 filter-policy
route-policy
route-policy-
name
7.8.4 Configuring
IS-IS Route Leaking
Configure a
priority for the
IS-IS routes that
match a route-
policy.
preference {
preference |
route-policy
route-policy-
name } *
7.8.1 Configuring a
Preference Value
for IS-IS
– To apply a route-policy in the IS-IS FRR view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the isis [
process-id ] command to enter the IS-IS view.
iii. Run the frr command to enter the IS-IS FRR view.
iv. Run the frr-policy route route-policy
route-policy-name command
to configure IS-IS to add the backup routes that match a route-policy
to the IP routing table.
For details on how to configure IS-IS Auto FRR (IPv4), see 7.15
Configuring IPv4 IS-IS Auto FRR.
● Apply a route-policy to IPv6 IS-IS routes.
– To apply a route-policy in the IS-IS view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the isis [
process-id ] command to enter the IS-IS view.
iii. To apply a route-policy to IPv6 IS-IS routes in the IS-IS view, see
Table 10-14.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 997
Table 10-14 Applying a route-policy to IPv6 IS-IS routes in the IS-IS view
Configuration
Task
Command Reference
Configure IS-IS
to generate and
advertise default
IPv6 routes to
the IS-IS domain
only when
external routes
that match a
route-policy exist
in the routing
table of a
Level-1-2 router.
ipv6 default-route-
advertise route-policy
route-policy-name [ cost
cost | tag
tag | [ level-1 |
level-1-2 | level-2 ] ] *
[ avoid-learning ]
8.9.1 Configuring
IS-IS to Advertise a
Default Route
Configure IS-IS
to advertise the
IPv6 routes that
are imported
from another
routing protocol
and match a
route-policy.
ipv6 filter-policy route-
policy
route-policy-name
export [
protocol [
process-
id ] ]
8.9.3 Configuring
IS-IS to Advertise
Specified External
Routes to an IS-IS
Routing Domain
Configure IS-IS
to accept the
IPv6 routes that
match a route-
policy.
ipv6 filter-policy route-
policy
route-policy-name
import
8.9.4 Adding
Specified IS-IS
Routes to an IPv6
Routing Table
Configure IS-IS
to import IPv6
routes that
match a route-
policy from
another routing
protocol.
ipv6 import-route { static |
direct | unr | { ospfv3 |
ripng | isis } [
process-id ] |
bgp [ permit-ibgp ] } [ cost
cost | tag
tag | route-policy
route-policy-name |
[ level-1 | level-2 |
level-1-2 ] ] *
ipv6 import-route { direct |
unr | { ospfv3 | ripng | isis }
[
process-id ] | bgp
[ permit-ibgp ] } inherit-
cost [ tag
tag | route-policy
route-policy-name |
[ level-1 | level-2 |
level-1-2 ] ] *
8.9.2 Configuring
IS-IS to Import
External Routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 998
Configuration
Task
Command Reference
Leak Level-1
IPv6 routes that
match a route-
policy to a
Level-2 area.
ipv6 import-route isis
level-1 into level-2 [ filter-
policy route-policy
route-
policy-name | tag
tag ] *
8.8.4 Configuring
IS-IS IPv6 Route
Leaking
Leak Level-2
IPv6 routes that
match a route-
policy to a
Level-1 area.
ipv6 import-route isis
level-2 into level-1 [ filter-
policy route-policy
route-
policy-name | tag
tag ] *
8.8.4 Configuring
IS-IS IPv6 Route
Leaking
Configure a
priority for the
IPv6 IS-IS routes
that match a
route-policy.
ipv6 preference { route-
policy
route-policy-name |
preference } *
8.8.1 Configuring a
Preference Value
for IPv6 IS-IS
● Apply a route-policy to OSPF routes.
– To apply a route-policy in the OSPF view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the ospf [
process-id ] command to enable an OSPF process and
enter the OSPF view.
iii. To apply a route-policy to OSPF routes in the OSPF view, see Table
10-15.
Table 10-15 Applying a route-policy to OSPF routes
Configuration
Task
Command Reference
Configure OSPF
to advertise the
default routes in
the routing table
that are not
generated by
OSPF to a
common area
based on the
parameters of a
route-policy.
default-route-advertise
[ [ always | permit-
calculate-other ] | cost
cost
| type
type | route-policy
route-policy-name [ match-
any ] ] *
5.15.2 Configuring
OSPF to Advertise
Default Routes to
an OSPF Area
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 999
Configuration
Task
Command Reference
Configure OSPF
to advertise the
routes that are
imported from
another routing
protocol and
match a route-
policy.
filter-policy route-policy
route-policy-name export
[
protocol [
process-id ] ]
5.15.5 Configuring
OSPF to Filter the
Routes to Be
Advertised
Configure OSPF
to accept the
routes that
match a route-
policy.
filter-policy route-policy
route-policy-name
[ secondary ] import
5.15.4 Configuring
OSPF to Filter
Received Routes
Configure OSPF
to import the
routes that
match a route-
policy.
import-route { limit
limit-
number | { bgp [ permit-
ibgp ] | direct | unr | rip
[
process-id-rip ] | static |
isis [
process-id-isis ] | ospf
[
process-id-ospf ] } [ cost
cost | type
type | tag
tag |
route-policy
route-policy-
name ] * }
5.15.1 Configuring
OSPF to Import
External Routes
Configure a
priority for OSPF
routes that
match a route-
policy.
preference [ ase ]
{
preference | route-policy
route-policy-name } *
5.20.1 Setting a
Priority for OSPF
Routes
– To apply a route-policy in the OSPF area view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the ospf [
process-id ] command to enable an OSPF process and
enter the OSPF process view.
iii. Run the area
area-id command to enter the OSPF area view.
iv. Perform either of the following operations to apply a route-policy in
the OSPF area view:
○ Run the filter route-policy
route-policy-name export command
to apply a route-policy to outgoing Type 3 LSAs (summary LSAs)
in the area.
○ Run the filter route-policy
route-policy-name import command
to apply a route-policy to incoming Type 3 LSAs in the area.
5.15.7 Configuring OSPF to Filter ABR Type3 LSAs
– To apply a route-policy in the OSPF FRR view, perform the following
operations:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1000
i. Run the system-view command to enter the system view.
ii. Run the ospf [
process-id ] command to enable an OSPF process and
enter the OSPF process view.
iii. Run the frr command to enter the OSPF FRR view.
iv. Run the loop-free-alternate command to enable OSPF IP FRR to
generate a loop-free backup link.
v. Run the frr-policy route route-policy
route-policy-name command
to configure OSPF to add the backup routes that match a route-
policy to the IP routing table.
For details on how to configure OSPF IP FRR, see 5.17.1 Enabling
OSPF IP FRR.
● Apply a route-policy to OSPFv3 routes.
– To apply a route-policy in the OSPFv3 view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the ospfv3 [
process-id ] command to enable an OSPFv3 process
and enter the OSPFv3 process view.
iii. To apply a route-policy to OSPFv3 routes in the OSPFv3 view, see
Table 10-16.
Table 10-16 Applying a route-policy to OSPFv3 routes
Configuration
Task
Command Reference
Configure
OSPFv3 to
advertise the
default routes in
the routing table
that are not
generated by
OSPFv3 to an
OSPFv3 area
based on the
parameters of a
route-policy.
default-route-advertise
[ always | cost
cost | type
type | tag
tag | route-policy
route-policy-name ] *
6.11.3 Configuring
OSPFv3 to Import
External Routes
Configure
OSPFv3 to
import the
routes that
match a route-
policy.
import-route { bgp
[ permit-ibgp ] | unr |
direct | ripng
help-process-
id | static | isis
help-process-
id | ospfv3
help-process-id }
[ { cost
cost | inherit-cost }
| type
type | tag
tag | route-
policy
route-policy-name ]*
6.11.3 Configuring
OSPFv3 to Import
External Routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1001
Configuration
Task
Command Reference
Configure a
priority for
OSPFv3 routes
that match a
route-policy.
preference [ ase ]
{
preference | route-policy
route-policy-name } *
-
– To apply a route-policy in the OSPFv3 area view, perform the following
operations:
i. Run the system-view command to enter the system view.
ii. Run the ospfv3 [
process-id ] command to enable an OSPFv3 process
and enter the OSPFv3 process view.
iii. Run the area
area-id command to enter the OSPFv3 area view.
iv. Perform either of the following operations to apply a route-policy in
the OSPFv3 area view:
○ Run the filter route-policy
route-policy-name export command
to apply a route-policy to outgoing Type 3 LSAs (Inter-Area-
Prefix-LSAs) in the area.
○ Run the filter route-policy
route-policy-name import command
to apply a route-policy to incoming Type 3 LSAs in the area.
For details on how to apply a route-policy to Type 3 LSAs in an
OSPFv3 area, see 6.11.4 (Optional) Configuring OSPFv3 to Filter
LSAs in an Area.
● Apply a route-policy to BGP routes.
a. Run the system-view command to enter the system view.
b. Run the bgp {
as-number-plain |
as-number-dot } command to enter the
BGP view.
c. Run the ipv4-family unicast command to enter the IPv4 unicast address
family view.
d. To apply a route-policy to specific BGP routes, see Table 10-17.
Table 10-17 Applying a route-policy to BGP routes
Configuration
Task
Command Reference
Configure a
summarized BGP
route and apply
a route-policy to
it.
aggregate
ipv4-address
{
mask |
mask-length } [ as-
set | attribute-policy
route-
policy-name1 | detail-
suppressed | origin-policy
route-policy-name2 |
suppress-policy
route-
policy-name3 ] *
9.13 Configuring
BGP Route
Summarization
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1002
Configuration
Task
Command Reference
Configure BGP
route
dampening.
dampening [
half-life-reach
reuse suppress ceiling |
route-policy
route-policy-
name ] *
-
Configure BGP
to import routes
that match a
route-policy
from another
routing protocol.
import-route
protocol
[
process-id ] [ med
med |
route-policy
route-policy-
name ] *
9.6.5 Configuring
BGP to Import
Routes
Import local
routes that
match a route-
policy to the
BGP routing
table and
advertise them
to BGP peers.
network
ipv4-address
[
mask |
mask-length ]
[ route-policy
route-policy-
name ]
9.6.5 Configuring
BGP to Import
Routes
Enable BGP
route recursion
based on a
route-policy.
nexthop recursive-lookup
route-policy
route-policy-
name
9.9.2 Configuring
the Next_Hop
Attribute
Configure a
device to send a
default route to
a peer or a peer
group and use a
route-policy to
modify the
attributes of the
default route.
peer {
group-name |
ipv4-
address } default-route-
advertise [ route-policy
route-policy-name ]
[ conditional-route-match-
all {
ipv4-address1 {
mask1 |
mask-length1 } } &<1-4> |
conditional-route-match-
any {
ipv4-address2 {
mask2
|
mask-length2 } } &<1-4> ]
9.14 Configuring
BGP to Advertise
Default Routes to
Peers
Configure a
device to accept
the routes that
match a route-
policy from a
peer or peer
group or
advertise the
routes that
match a route-
policy to a peer
or peer group.
peer {
group-name |
ipv4-
address } route-policy
route-policy-name { import
| export }
9.10.2 Controlling
the Advertisement
of BGP Routes
9.10.3 Controlling
the Receiving of
BGP Routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 10 Routing Policy Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1003
Configuration
Task
Command Reference
Use a route-
policy to set a
BGP priority.
preference route-policy
route-policy-name
9.9.1 Configuring
the BGP Priority
Prevent the BGP
routes that
match a route-
policy from
being added to
the IP routing
table.
routing-table rib-only
[ route-policy
route-policy-
name ]
-
● Apply a route-policy to BGP4+ routes.
a. Run system-view
The system view is displayed.
b. Run bgp {
as-number-plain |
as-number-dot }
The BGP view is displayed.
c. Run ipv6-family [ unicast ]
The IPv6 unicast address family view is displayed.
d. To apply a route-policy to specific BGP4+ routes, see Table 10-18.
Table 10-18 Applying a route-policy to BGP4+ routes
Configuration