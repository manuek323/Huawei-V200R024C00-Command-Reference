5 OSPF Configuration
5.1 Overview of OSPF
5.2 Understanding OSPF
5.3 Application Scenarios for OSPF
5.4 OSPF Deployment Guide
5.5 Summary of OSPF Configuration Tasks
5.6 Licensing Requirements and Limitations for OSPF
5.7 Default Settings for OSPF
5.8 Configuring Basic OSPF Functions
5.9 Configuring Session Parameters for OSPF Neighbor or Adjacency Relationships
5.10 Configuring OSPF Attributes on Different Types of Networks
5.11 Configuring OSPF Stub Areas
5.12 Configuring an OSPF NSSA
5.13 Configuring Local MT
5.14 Adjusting OSPF Route Selection
5.15 Controlling OSPF Routing Information
5.16 Configuring BFD for OSPF
5.17 Configuring OSPF IP FRR
5.18 Configuring OSPF Fast Convergence
5.19 Configuring OSPF GR
5.20 Improving Stability of an OSPF Network
5.21 Improving the Security of an OSPF Network
5.22 Configuring OSPF Neighbor Relationship Flapping Suppression
5.23 Suppressing the Advertisement of Interface IP Addresses
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 163
5.24 Configuring Network Management for OSPF
5.25 Maintaining OSPF
5.26 Configuration Examples for OSPF
5.27 Troubleshooting OSPF
5.1 Overview of OSPF
Definition
The Open Shortest Path First (OSPF) protocol is a link-state Interior Gateway
Protocol (IGP) developed by the Internet Engineering Task Force (IETF).
OSPF constructs network topologies and routing tables by:
● Dividing an Autonomous System (AS) into one or more logical areas
● Advertising routes by sending Link State Advertisements (LSAs)
● Exchanging OSPF packets between devices in an OSPF area to synchronize
routing information
● Encapsulating OSPF packets into IP packets and sending the packets in
unicast or multicast mode
OSPF Version 2, as defined in RFC 2328, is designed for IPv4. OSPF Version 3, as
defined in RFC 2740, is designed for IPv6. Unless otherwise stated, OSPF in this
document refers to OSPF Version 2.
Advantages
Before the introduction of OSPF, the Routing Information Protocol (RIP) was the
most widely used IGP. The rapid growth and expansion of networks have pushed
RIP to its limits. RIP has certain limitations that can cause problems in large
networks. OSPF can address many issues facing RIP. Table 5-1 compares RIP and
OSPF.
Table 5-1 RIP versus OSPF
RIP OSPF
RIP uses a distance-vector algorithm to
calculate routes and uses the hop
count as the metric, without
considering the bandwidth.
OSPF uses a link-state algorithm to
build and calculate the shortest path
to all known destinations. It uses the
link cost as the metric and considers
the bandwidth while calculating
routes.
RIP has a limit of 15 hops, which limits
the RIP network scale.
OSPF does not have the hop limit and
applies to large networks.
RIP updates and selects routes through
route advertisements. Routers do not
know the entire network topology,
which can easily cause routing loops.
Each router knows the entire network
topology and calculates routes using
the shortest path first (SPF) algorithm,
which can prevent routing loops.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 164
RIP OSPF
RIP converges slower than OSPF. Route
updates go through a period of a
hold-down and garbage collection.
This could cause routing
inconsistencies between routers.
OSPF converges faster than RIP
because route updates are propagated
instantaneously to the entire network.
RIP cannot handle variable length
subnet mask (VLSM).
OSPF can handle VLSM, which is
helpful in IP address allocation.
In addition to the preceding advantages, OSPF has the following characteristics:
● Multicast packet transmission, reducing the load on the switches not running
OSPF
● Classless Inter-Domain Routing (CIDR)
● Load balancing among equal-cost routes
● Packet authentication
5.2 Understanding OSPF
5.2.1 OSPF Fundamentals
5.2.1.1 OSPF Characteristics
In an OSPF network, each router generates a link-state advertisement (LSA) based
on its surrounding network topology and transmits this LSA in an update packet
to other routers in the network.
RIP devices exchange routes, whereas OSPF devices exchange link state
information. That is, in RIP, routers select routes based on routing information of
neighbors, without checking whether the information transmitted by neighbors is
correct. In OSPF, routers calculate routes by themselves and select routes based on
LSAs.
Each router learns about the whole network topology based on its link state
database (LSDB). In Figure 5-1, each router collects LSAs sent from other routers,
and all LSAs form the LSDB of this router. An LSA describes the surrounding
network topology of a router, whereas an LSDB describes the network topology of
the entire AS. A router transforms its LSDB into a weighted and directed graph,
which reflects the topology of the entire AS. When the network topology is stable,
all routers in the same area have the same graph.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 165
Figure 5-1 Obtaining the whole network topology through an LSDB
A router calculates shortest paths to destinations using a shortest path first (SPF)
algorithm instead of obtaining routing information through route advertisements.
In Figure 5-2, based on the weighted and directed graph, each router uses an SPF
algorithm to calculate a shortest path tree (SPT) with itself as the root. The SPT
shows routes to nodes in the AS. This mechanism greatly improves routers'
capabilities in independent route selection and frees routers from selecting routes
based on route advertisements.
Figure 5-2 Calculating shortest paths to destinations using an SPF algorithm
An LSDB ensures that a router can learn about the whole network topology, and
an SPF algorithm ensures that a router can quickly calculate shortest paths to
destinations.
5.2.1.2 OSPF Mechanism
The OSPF mechanism includes the following steps:
1. Exchanging Hello packets to establish OSPF neighbor relationships
In Figure 5-3, after OSPF is run on the four routers, these routers send Hello
packets on all OSPF-enabled interfaces. If two routers share a data link and
successfully negotiate certain parameters specified in their Hello packets, they
establish an OSPF neighbor relationship.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 166
Figure 5-3 Exchanging Hello packets to establish OSPF neighbor relationships
2. Flooding LSAs to advertise link state information
Routers that have established an OSPF neighbor relationship can exchange
LSAs to form an OSPF adjacency, as shown in Figure 5-4. Each router
generates LSAs based on its surrounding network topology. LSAs describe
information about a router, including all links, interfaces, neighbors, and link
state of the router. Routers exchange the link information to learn about the
entire network topology. Because of the link diversity, OSPF defines multiple
LSA types. For details, see 5.2.1.9 OSPF LSA Types.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 167
Figure 5-4 Flooding LSAs to advertise link state information
3. Forming an LSDB to create a weighted and directed graph
A router floods LSAs and records received LSAs in its LSDB. Subsequently, all
routers have the same LSDB, as shown in Figure 5-5. An LSA describes the
surrounding network topology of a router, whereas an LSDB describes the
network topology of the entire AS and is the summary of LSAs.
Figure 5-5 Forming an LSDB to create a weighted and directed graph
4. Using an SPF algorithm to calculate and generate routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 168
In Figure 5-6, after LSDB synchronization is complete, each router uses an
SPF algorithm to calculate a loop-free topology with itself as the root and
describe the shortest path (with the minimum path cost) to each destination.
The topology is the SPT, which shows the optimal paths to nodes in an AS.
Figure 5-6 Using an SPF algorithm to calculate and generate routes
5. Maintaining and updating routing tables
After each router uses an SPF algorithm to calculate the SPT, it installs the
shortest paths in its routing table. These paths are installed as routing entries
to guide data forwarding. The routers then update their routing tables in real
time, as shown in Figure 5-7. Meanwhile, neighbors exchange Hello packets
to maintain their neighbor relationships or adjacencies and periodically
retransmit LSAs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 169
Figure 5-7 Maintaining and updating routing tables
5.2.1.3 OSPF Packet Types
OSPF uses five packet types:
● Hello packet
OSPF uses Hello packets to implement the following functions:
– Neighbor discovery: OSPF routers periodically send Hello packets on
every OSPF-enabled interface, and negotiate the specific parameters in
the Hello packets with other routers that receive Hello packets to
determine whether to establish an OSPF neighbor relationship.
– Bidirectional communications: If a router sees its own router ID in the
neighbor list of a received Hello packet, bidirectional communication has
been established between this receiving router and the router that
originates the packet. An OSPF neighbor relationship has been
established between the two routers.
– Designated router (DR) and backup designated router (BDR) election:
Hello packets contain information about the DR priority and router ID.
Each router writes its selected DR and BDR to the DR and BDR fields of
Hello packets for DR and BDR election. For details, see 5.2.1.5 DR/BDR
Election.
– Keepalives: After an OSPF neighbor relationship is established, OSPF-
enabled interfaces still periodically send Hello packets to maintain the
neighbor relationship. If an interface does not receive a Hello packet from
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 170
a neighbor within a certain period, it terminates the neighbor relationship
with this neighbor.
● Database Description (DD) packet
During adjacency initialization, two routers send DD packets to negotiate
their master/slave relationship. In this phase, the DD packets contain only an
LSA header. When two routers exchange DD packets, one functions as the
master and the other functions as the slave. The master defines a start
sequence number and increments the sequence number by 1 each time it
sends a DD packet. After the slave receives a DD packet, it uses the sequence
number carried in the DD packet for acknowledgement.
After an adjacency is established, routers use DD packets to describe their
own LSDBs for LSDB synchronization. A DD packet contains the header of
each LSA in an LSDB and is the summary of all LSAs. An LSA header uniquely
identifies an LSA. The LSA header occupies only a small portion of the LSA,
which reduces the amount of traffic transmitted between routers. A neighbor
can use the LSA header to check whether it already has the LSA.
● Link State Request (LSR) packet
After two routers have exchanged DD packets, they send LSR packets to
request each other's LSAs. The LSR packets contain the summaries of the
requested LSAs.
● Link State Update (LSU) packet
A router uses an LSU packet to transmit LSAs requested by its neighbors or to
flood its own updated LSAs. The LSU packet contains a set of LSAs. To ensure
reliable LSA flooding, the router uses an LSAck packet to acknowledge the
LSAs contained in an LSU packet that it received from a neighbor. If an LSA
fails to be acknowledged, the router directly retransmits the LSA to the
neighbor.
● Link State Acknowledgement (LSAck) packet
A router uses an LSAck packet to acknowledge the LSAs contained in a
received LSU packet. The LSAs can be acknowledged using LSA headers.
5.2.1.4 OSPF Network Types
OSPF classifies networks into four types, depending on the link layer protocols:
● Broadcast
OSPF defaults networks using Ethernet or Fiber Distributed Data Interface
(FDDI) at the link layer to broadcast networks.
On broadcast networks:
– Hello packets, LSU packets, and LSAck packets are sent in multicast
mode. The address 224.0.0.5 is the IP multicast address reserved for OSPF
DR others. The address 224.0.0.6 is the IP multicast address reserved for
OSPF DRs or BDRs.
– DD and LSR packets are sent in unicast mode.
● Non-Broadcast Multi-Access (NBMA)
OSPF defaults networks using frame relay (FR) or X.25 at the link layer to
NBMA networks.
On NBMA networks, protocol packets such as Hello packets, DD packets, LSR
packets, LSU packets, and LSAck packets are all sent in unicast mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 171
● Point-to-Multipoint (P2MP)
OSPF does not default a network to a P2MP network regardless of the link
layer protocol used by the network. A P2MP network must be changed from
another network type. It is a typical practice to change partial-meshed NBMA
networks to P2MP networks.
On P2MP networks:
– Hello packets are transmitted in multicast mode using the multicast
address 224.0.0.5.
– DD packets, LSR packets, LSU packets, and LSAck packets are sent in
unicast mode.
● Point-to-Point (P2P)
OSPF defaults networks using Point-to-Point Protocol (PPP), High-Level Data
Link Control (HDLC), or Link Access Procedure Balanced (LAPB) at the link
layer to P2P networks.
On P2P networks, protocol packets such as Hello packets, DD packets, LSR
packets, LSU packets, and LSAck packets are all sent in multicast mode using
the multicast address 224.0.0.5.
5.2.1.5 DR/BDR Election
Router ID
During DR/BDR election, if two routers use the same DR priority, they need to
compare their router IDs, and the router with a larger router ID will become the
DR or BDR.
A router ID is a 32-bit integer used to uniquely identify an OSPF router in an AS.
Each OSPF router has a router ID, which is in the same format as an IP address.
An OSPF router ID can be manually configured or automatically selected. To
ensure OSPF stability, you are advised to manually configure the IP address of a
loopback interface as the router ID.
If no OSPF router ID is manually configured for a router, the router selects the
global router ID as its OSPF router ID. If both the OSPF router ID and global router
ID are not configured, the router selects a router ID based on specified rules. For
details, see 1.2.13 Router ID.
In any of the following situations, the router ID is re-selected:
● The ospf router-id
router-id command is run to reconfigure the OSPF router
ID, and the OSPF process is restarted.
● The global router ID is reconfigured, and the OSPF process is restarted.
● The IP address used as the original global router ID is deleted, and the OSPF
process is restarted.
Reason for DR/BDR Election
On broadcast and NBMA networks, any two routers need to exchange routing
information. As shown in Figure 5-8, there are
n routers that need to establish
n x
(
n - 1)/2 adjacencies. A route change on any router is transmitted to the other
routers, which consumes bandwidth resources.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 172
To solve this problem, the concept of DR is defined in OSPF. After a DR is elected,
all the other routers send routing information only to the DR, and the DR
broadcasts LSAs.
To prevent service interruption caused by DR re-election if the DR fails, a BDR is
also elected during DR election. The routers, excluding the DR and BDR, are called
DR others. The DR others do not establish adjacencies or exchange any routing
information with each other. This reduces the number of adjacencies established
between routers on broadcast and NBMA networks.
Figure 5-8 DR/BDR election
DR/BDR Election Principles
To ensure stable DR/BDR election on broadcast and NBMA networks, OSPF defines
three election principles: election, non-preemption, and inheritance.
Election Principle
The DR and BDR are not designated manually, but are elected by all routers on
the local network segment. In Figure 5-9, DR priorities of router interfaces
determine whether the interfaces are qualified for DR/BDR election. Routers with
DR priorities greater than 0 on the local network segment can be considered as
candidates. The ballots in this election are performed using Hello packets. Each
router adds elected DR information to a Hello packet and sends the packet to
other routers on the network segment. When two routers on the same network
segment declare that they are the DR, the router with a higher DR priority is
elected as the DR. If the two routers have the same DR priority, the router with
the greater router ID is elected as the DR. The router whose DR priority is 0
cannot be elected as the DR or BDR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 173
Figure 5-9 Election principle
Non-preemption Principle
A router newly added to a network segment does not initiate a new election.
Instead, it checks whether a DR exists on the network segment. In Figure 5-10, a
DR exists on the network segment. Even if the DR priority of the newly added
router is higher than that of the existing DR, the newly added router does not
declare itself the DR, and acknowledges the existing DR. Routers on a network
segment establish adjacencies only with the DR and BDR. If the DR changes
frequently, all routers on the network segment need to establish adjacencies with
the new DR and BDR accordingly. As a result, a large number of OSPF packets are
transmitted on the network segment within a short period of time, consuming
bandwidth resources. The non-preemption principle improves network stability
and conserves bandwidth resources. On a broadcast or NBMA network, the two
routers that are qualified for DR election and start first become the DR and BDR
respectively.
Figure 5-10 Non-preemption principle
Inheritance Principle
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 174
If the DR on a network segment fails, the BDR is elected as the DR, and the other
routers compete to become the new BDR, as shown in Figure 5-11. This principle
prevents frequent DR elections and enables the BDR to become the new DR when
the DR fails, ensuring the DR stability. Because LSDBs of the DR and BDR are fully
synchronized, the BDR can immediately become the new DR when the DR fails,
providing the DR functions. The time consumed from role change to service
switching is short because adjacencies have been established. Meanwhile, a new
BDR will be elected after the original BDR becomes the DR. The new BDR election
process consumes a relatively long time, but route calculation is not affected.
Figure 5-11 Inheritance principle
DR/BDR Election Process
The DR/BDR election process on a broadcast or NBMA network is as follows:
1. After an interface goes Up, it sends a Hello packet and enters the Waiting
state. In Waiting state, a wait timer is triggered. The wait timer value is the
same as the dead timer value. The default wait timer value is 40 seconds and
cannot be changed. For details about OSPF interface status, see OSPF
Interface State Machine.
2. Before the wait timer is triggered, sent Hello packets do not contain DR or
BDR information. In Waiting state, if a received Hello packet contains DR and
BDR information, the interface directly acknowledges the DR and BDR on the
network, and does not trigger election. The interface directly exits the Waiting
state and starts neighbor synchronization.
3. Assume that a DR and a BDR exist on the network. A router newly connected
to the network acknowledges the existing DR and BDR regardless of its router
ID or DR priority.
4. If the DR fails and goes Down, the BDR takes over the role of the DR. The
other routers with DR priorities greater than 0 then compete to become the
new BDR.
5. DR election rules are used to elect a DR only when routers with different
router IDs or DR priorities are started at the same time. The election rules
state that the device with the highest DR priority is elected as the DR and the
device with the second highest DR priority as the BDR. A router with a DR
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 175
priority of 0 can only be a DR other. If routers have the same DR priority, the
router with the largest router ID is elected as the DR, the router with the
second largest router ID becomes the BDR, and other routers are DR others.
Verifying the DR/BDR Election Process
In Figure 5-12, five routers establish a broadcast network. R5 works as a Layer 2
device, and R1 to R4 work as routers. R1 to R4 are in OSPF area 0.
Figure 5-12 DR/BDR election networking
DR and BDR Are Properly Elected on the Network
Assume that interfaces on R1 to R4 have been configured. Only OSPF
configurations are provided here.
● R1 configuration
#
ospf 1 Router ID 10.1.1.1
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
● R2 configuration
#
ospf 1 Router ID 10.2.2.2
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
● R3 configuration
#
ospf 1 Router ID 10.3.3.3
area 0.0.0.0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 176
network 192.168.1.0 0.0.0.255
#
● R4 configuration
#
ospf 1 Router ID 10.4.4.4
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
After the configurations are complete and the network is stable, check the
DR/BDR election status.
# Check OSPF neighbor information on R1. The following command output shows
that DR/BDR election has been completed. R1 is the DR, R2 is the BDR, and R3
and R4 are DR others. R1 and R2 are elected as the DR and BDR respectively
because of their startup sequence. In this example, R1, R2, R3, and R4 are started
consecutively. Therefore, R1 and R2 complete initialization first and become the
DR and BDR, respectively.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:22:16
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:21:30
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:20:24
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that the neighbor relationships between R1 and the other
three routers and those between R2 and the other three routers are in Full state,
and the neighbor relationship between R3 and R4 is in 2-Way state. The states
indicate that the DR and BDR establish adjacencies with other routers, and DR
others only establish neighbor relationships with each other. For details about
OSPF neighbor status, see OSPF Neighbor State Machine.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 177
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
BDR Cannot Be Elected on the Network
If the ospf dr-priority command is run on GE0/0/1 of R2, R3, and R4 to set the
interface DR priority to 0, the three routers are unqualified for DR/BDR election
and can only work as DR others. Only one router (R1) on the network is qualified
for DR/BDR election.
# Check OSPF neighbor information on R1. The following command output shows
that R1 is the DR. The BDR field is displayed as None, indicating that no BDR
exists on the network.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:04:31
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:03:45
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 178
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:03:36
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that R2, R3, and R4 each establish an adjacency with R1,
the corresponding states are Full, and the states of neighbor relationships among
R2, R3, and R4 are 2-Way.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
In conclusion, if only one router on a broadcast or NBMA network is qualified for
DR/BDR election, the router becomes the DR, no BDR exists on the network, and
all the other routers establish adjacencies only with the DR.
No DR or BDR Can Be Elected on the Network
On the basis of the preceding configuration, if the ospf dr-priority command is
executed on GE0/0/1 of R1 to set the interface DR priority to 0, R1 is also
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 179
unqualified for DR/BDR election. No router on the network is qualified for DR/BDR
election.
# Check OSPF neighbor information on R1. The following command output shows
that both the DR and BDR fields are displayed as None, indicating that no DR or
BDR exists on the network.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that all neighbor relationships are in 2-Way state, no
adjacency can be established on the network, and routers cannot exchange
routing information.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 180
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
In conclusion, if no router on a broadcast or NBMA network is qualified for
DR/BDR election, the network has no DR or BDR, and routers on the network do
not establish adjacencies. In this case, all neighbor relationships among these
routers are in 2-Way state.
5.2.1.6 OSPF State Machine
OSPF Interface State Machine
An OSPF device obtains link information from an interface and then establishes
adjacencies with neighbors to exchange the link information. Before establishing
adjacencies, these devices need to determine their roles to establish connections.
The State field in OSPF interface information (displayed using the display ospf
interface command) indicates the function of an OSPF device on a link.
The OSPF interface state machine has the following states:
● Down: This state is the initial state of an OSPF interface. If an OSPF interface
is Down, it is unavailable and cannot receive or transmit traffic.
● Loopback: An OSPF interface that connects a device to a network is in
Loopback state. A loopback interface cannot transmit data but its IP address
can be advertised using Router-LSAs. Therefore, other devices can learn about
paths to this IP address during a connectivity test.
● Waiting: The device is determining the DR and BDR on the network. Before
the device participates in DR and BDR election, the wait timer starts on an
OSPF interface. Before this timer expires, the Hello packets sent by this device
do not contain DR and BDR information, and the device cannot be elected as
the DR or BDR. This prevents the existing DR and BDR on the link from being
changed unnecessarily and ensures stability. This state exists only on NBMA
and broadcast networks.
● P-2-P: An OSPF interface is connected to a P2P network or virtual link. In this
situation, the device establishes an adjacency with the device on the other
end of the link. This state exists only on P2MP networks.
● DROther: The device is not elected as the DR or BDR. This device will
establish an adjacency with the DR and BDR.
● BDR: The device functions as the BDR on the network and will become the
new DR if the existing DR fails. This device establishes adjacencies with all the
other devices on the network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 181
● DR: The device functions as the DR on the network. This device establishes
adjacencies with all the other devices on the network.
OSPF interfaces alternate among the preceding states based on the InputEvents
(IEs), forming an efficient interface state machine, as shown in Figure 5-13.
Figure 5-13 OSPF interface state machine
Table 5-2 lists the IEs triggering interface state switchovers.
Table 5-2 InputEvents triggering OSPF interface state switchovers
InputEvent Description
IE1 InterfaceUP: Lower-layer protocols indicate that an OSPF interface
is available.
IE2 WaitTimer: The wait timer expires, indicating that the DR/BDR
election waiting time ends.
IE3 BackupSeen: The device with an OSPF interface has detected
whether there is a BDR on the network. This event occurs in either
of the following situations:
● The OSPF interface receives a Hello packet from a neighbor,
and the neighbor declares itself the BDR.
● The OSPF interface receives a Hello packet from a neighbor,
and the neighbor declares itself the DR but no BDR is specified.
Both situations indicate that neighbors have communicated with
each other and the Waiting state ends.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 182
InputEvent Description
IE4 The device is elected as the DR on the network.
IE5 The device is elected as the BDR on the network.
IE6 The device is not elected as the DR or BDR on the network.
IE7 NeighborChange: An interface-related neighbor relationship
change event occurs, indicating that the DR and BDR need to be
elected again. The following neighbor relationship changes may
result in DR/BDR re-election:
● The device implements bidirectional communication with a
neighbor.
● Bidirectional communication between the device and a
neighbor is interrupted.
● The device detects that the neighbor declares itself the DR or
BDR based on the Hello packet received by the neighbor.
● The device detects that the neighbor declares itself not the DR
or BDR based on the Hello packet sent by the neighbor.
● The device detects that the DR priorities of all neighbors have
changed based on the Hello packets sent by the neighbors.
IE8 UnLoopInd: The NMS or lower-layer protocols indicate that the
interface is not in Loopback state any longer.
IE9 InterfaceDown: Lower-layer protocols indicate that the interface is
unavailable. Any state may change to the Down state after this
event is triggered.
IE10 LoopInd: The NMS or lower-layer protocols indicate that the
interface is in Loopback state. Any state may change to the
Loopback state after this event is triggered.
OSPF Neighbor State Machine
On an OSPF network, neighbors establish adjacencies through neighbor state
switchovers, and then exchange LSAs.
The State field in OSPF neighbor information (displayed using the display ospf
peer command) indicates the neighbor status of an OSPF device.
The OSPF neighbor state machine has the following states:
● Down: This is the initial state of a neighbor session. This state occurs when a
device does not receive any Hello packets from its neighbors within a dead
interval. Only OSPF routers on an NBMA network send Hello packets to
neighbors at each poll interval, including the neighbors in Down state.
● Attempt: This state is only used on NBMA networks where neighbors are
manually configured. When the neighbor relationship is in Attempt state, an
OSPF router sends a Hello packet to its manually configured neighbors at
each Hello interval, attempting to establish neighbor relationships.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 183
● Init: This state occurs after the router has received a Hello packet from its
neighbor but has not established a two-way session. In Init state, the
neighbor does not receive any Hello packet from this router, and the neighbor
list in the received Hello packet does not contain the router ID of the local
router.
● 2-Way: This state occurs when a router and its neighbor receive Hello packets
containing their own router IDs from each other and establish an OSPF
neighbor relationship. If no adjacency needs to be established, the two
neighbors remain in 2-Way state. If an adjacency needs to be established, the
neighbor enters the Exstart state. The DR and BDR are elected only when the
neighbor state is 2-Way or higher.
● ExStart: This state occurs when two neighbors start to negotiate their master/
slave roles and determine the sequence numbers of DD packets. Entering the
Exstart state is the first step in setting up an adjacency.
● Exchange: This state occurs when two neighbors exchange DD packets. In this
state, DD packets contain LSDB information.
● Loading: This state occurs when two neighbors are synchronizing their LSDBs.
The two devices send LSR packets to request LSAs from each other to
synchronize their LSDBs.
● Full: This state occurs when two neighbors complete their LSDB
synchronization and establish an adjacency.
Figure 5-14 shows an OSPF neighbor state machine.
Figure 5-14 OSPF neighbor state machine
Table 5-3 lists the IEs triggering neighbor state switchovers.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 184
Table 5-3 InputEvents triggering OSPF neighbor state switchovers
InputEvent Description
IE1 Start: A router sends a Hello packet to its neighbors at each Hello
interval, attempting to establish neighbor relationships. This event
exists only on NBMA networks.
IE2 HelloReceived: The router receives a Hello packet from a neighbor.
IE3 2-WayReceived: The router receives a Hello packet containing its
router ID from a neighbor and implements two-way
communication with this neighbor. The router then determines its
neighbor state:
● IE3(Y): If the router needs to establish an adjacency with the
neighbor, it changes its neighbor state to Exstart.
● IE3(N): If the router does not need to establish an adjacency
with the neighbor, it changes its neighbor state to 2-Way.
IE4 NegotiationDone: The two neighbors have negotiated their
master/slave roles and exchanged sequence numbers of DD
packets.
IE5 ExchangeDone: The two neighbors have exchanged their DD
packets. One of the two routers then determines its neighbor
state:
● IE5(Y): If the link state request list is empty, the router changes
its neighbor state to Full, indicating that all link state data has
been exchanged and an adjacency has been established.
● IE5(N): If the link state request list is not empty, the router
changes its neighbor state to Loading and begins or continues
sending LSR packets to its neighbor, requesting link state data
that the local router does not have.
IE6 LoadingDone: The link state request list is empty.
5.2.1.7 OSPF Adjacency Establishment
OSPF Neighbor Relationship
OSPF routers periodically send Hello packets on every OSPF-enabled interface, and
negotiate the specific parameters, including the area ID, authentication method,
Hello packet interval, and dead interval, in the Hello packets with other routers
that receive Hello packets. If the negotiation succeeds, the receiving router adds
the router ID of the originating router to the neighbor list of the returned Hello
packet. The two routers then establish bidirectional communication and an OSPF
neighbor relationship. If a router does not receive a Hello packet from its neighbor
within the dead interval, the router terminates the neighbor relationship with this
neighbor.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 185
OSPF Adjacency
After establishing an OSPF neighbor relationship, two neighbors need to exchange
DD packets and LSAs to establish an adjacency.
Not all neighbors establish adjacencies. Whether neighbors establish adjacencies
depends on the network type and DR/BDR establishment. On P2P and P2MP links,
all devices need to exchange LSAs and establish only adjacencies. On broadcast
and NBMA links, DR others do not need to exchange LSAs and establish only
neighbor relationships. LSAs need to be exchanged between the DR and BDR, and
between the DR, BDR, and DR others, so they establish adjacencies with each
other. In Figure 5-15, two DR others each have established three neighbor
relationships and two adjacencies.
Figure 5-15 OSPF neighbor relationship and adjacency
A neighbor relationship indicates that two neighbors reach the 2-Way state,
whereas an adjacency indicates that two neighbors reach the Exstart state or
higher.
OSPF Adjacency Establishment
The process of establishing an OSPF adjacency varies depending on the network
type.
Broadcast Network
On a broadcast network, the DR and BDR establish an adjacency with each router
on the same network segment, but DR others establish only neighbor
relationships with each other. Figure 5-16 shows the process of establishing an
OSPF adjacency.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 186
Figure 5-16 Process of establishing an OSPF adjacency on a broadcast network
1. Neighbor relationship establishment
a. RouterA uses the multicast address 224.0.0.5 to send a Hello packet
through the OSPF interface connected to a broadcast network. The
packet carries the DR field of 1.1.1.1 (ID of RouterA) and the Neighbors
Seen field of 0, indicating that a neighbor RouterB has not been
discovered and RouterA regards itself as the DR.
b. After RouterB receives the packet, it returns a Hello packet to RouterA.
The returned packet carries the DR field of 2.2.2.2 (ID of Router B) and
the Neighbors Seen field of 1.1.1.1 (RouterA's router ID). RouterA has
been discovered but its router ID is less than that of RouterB, and
therefore RouterB regards itself as the DR. Then RouterB's neighbor state
changes to Init.
c. After RouterA receives the response, RouterA's neighbor state changes to
2-Way. Then, RouterA and RouterB start to send their LSDB information
to each other, which does not occur between DR others on a broadcast
network.
2. Master/Slave negotiation and DD packet exchange
a. RouterA sends a DD packet to RouterB. The packet carries the following
fields:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 187
▪ Seq: The value X indicates the sequence number of X.
▪ I: The value 1 indicates that the packet is the first DD packet, which
is used to negotiate the master/slave roles and does not carry LSA
summaries.
▪ M: The value 1 indicates that the packet is not the last DD packet.
▪ MS: The value 1 indicates that RouterA declares itself the master.
To improve transmission efficiency, RouterA and RouterB determine which
LSAs in each other's LSDB need to be updated before sending LSR
packets. If one party detects that an LSA of the other party is already in
its own LSDB, it does not send an LSR packet for updating the LSA to its
own LSDB. To achieve the preceding purpose, RouterA and RouterB first
send DD packets, which carry summaries of LSAs in their own LSDBs.
Each summary identifies an LSA. To ensure reliable packet transmission,
the master/slave roles must be determined through DD packet exchange.
The party serving as the master uses the Seq field to define a sequence
number. The master increases the sequence number by 1 each time it
sends a new DD packet. When the other party serving as the slave sends
a DD packet, it sets the Seq field of the packet to the sequence number
carried in the last DD packet received from the master.
b. After RouterB receives the DD packet, RouterB's state changes to Exstart
and RouterB returns a DD packet to RouterA. The returned packet does
not carry LSA summaries. Because RouterB has a larger router ID than
RouterA, RouterB declares itself the master and sets the Seq field to Y.
c. After RouterA receives the DD packet, it agrees that RouterB is the
master and RouterA's state changes to Exchange. Then, RouterA sends a
DD packet to RouterB to transmit LSA summaries. The packet carries the
Seq field of Y and the MS field of 0 indicating that RouterA declares itself
the slave.
d. After RouterB receives the packet, RouterB's state changes to Exchange
and RouterB sends a new DD packet containing its own LSA summaries
to RouterA. The value of the Seq field carried in the new DD packet is
changed to Y+1. RouterA uses the same sequence number as RouterB to
acknowledge that it has received DD packets from RouterB. RouterB uses
the sequence number from RouterA plus 1 to acknowledge that it has
received DD packets from RouterA. When RouterB sends the last DD
packet, it sets the M field in the packet to 0.
3. LSDB synchronization (LSA request, LSA transmission, and LSA response)
a. After RouterA receives the last DD packet, it finds that many LSAs in
RouterB's LSDB do not exist in its own LSDB. Therefore, RouterA's
neighbor state changes to Loading. After RouterB receives the last DD
packet from RouterA, RouterB's neighbor state directly changes to Full
because RouterB's LSDB already contains all LSAs of RouterA.
b. RouterA sends an LSR packet for updating LSAs from RouterB to its own
LSDB. RouterB sends an LSU to After RouterA.
The preceding procedure ends when the LSAs in RouterA's LSDB are the same
as those in RouterB's LSDB. RouterA's neighbor state then changes to Full.
After RouterA and RouterB exchange DD packets and update all LSAs, an
adjacency is established between them.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 188
NBMA Network
On an NBMA network, all routers establish adjacencies only with the DR and BDR.
Figure 5-17 shows the process of establishing an OSPF adjacency.
Figure 5-17 Process of establishing an OSPF adjacency on an NBMA network
1. Neighbor relationship establishment
a. After RouterB sends a Hello packet to a Down interface of RouterA,
RouterB's neighbor state changes to Attempt. The packet carries the DR
field of 2.2.2.2 (ID of RouterB) and the Neighbors Seen field of 0. A
neighbor RouterA has not been discovered, and RouterB regards itself as
the DR.
b. After RouterA receives the packet, RouterA's state changes to Init and
RouterA returns a Hello packet. The returned packet carries the DR and
Neighbors Seen fields of 2.2.2.2. RouterB has been discovered but its
router ID is greater than that of RouterA, and therefore RouterA agrees
that RouterB is the DR. Then, RouterA and RouterB start to exchange DD
packets and LSDB information with each other, which does not occur
between DR others on a broadcast network.
2. The processes of negotiating master/slave roles and exchanging DD packets
on an NBMA network are the same as those on a broadcast network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 189
3. The process of synchronizing LSDBs (LSA request, LSA transmission, and LSA
response) on an NBMA network is the same as that on a broadcast network.
P2P Network and P2MP Network
The process for establishing an adjacency on a P2P/P2MP network is similar to
that on a broadcast network except that no DR or BDR needs to be elected on a
P2P/P2MP network. DD packets are transmitted in multicast mode on P2P
networks and in unicast mode on P2MP networks.
5.2.1.8 OSPF Areas
When networks expand and all routers in a large network are running OSPF, the
following problems may occur:
● Network expansion increases the possibility of network topology changes,
leading to more frequent LSA flooding and reducing network bandwidth
efficiency.
● LSDBs of routers become large, requiring a large amount of storage space
and complicating SPF calculations.
● Routers need to maintain large routing tables.
OSPF resolves these problems by partitioning an AS into different areas. Area
partitioning contains LSA flooding within an area, improving network efficiency
and route convergence. The number of routers in each area becomes less,
reducing the size of routing tables and LSDBs maintained by routers and limiting
SPF calculations to LSAs within the area. Design of multiple areas also improves
network scalability and facilitates the setup of large networks.
An area is regarded as a logical group of routers and is identified by an area ID. A
router, not a link, resides on the border of an area. Each OSPF interface must
belong to an area, meaning that a link (or network segment) belongs to only one
area.
Before understanding OSPF areas, you need to get to know two concepts: router
type and route type.
Router Types
Figure 5-18 shows common router types involved in OSPF.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 190
Figure 5-18 Router types
Table 5-4 Router types
Router Type Description
Internal router A router that has all of its interfaces within the
same OSPF area.
Area Border Router (ABR) A router that has interfaces in two or more areas,
one of which must be a backbone area.
ABRs connect backbone and non-backbone areas
and can be physically or logically connected to a
backbone area.
Backbone router A router that has one or more interfaces within a
backbone area.
Internal routers in Area 0 and all ABRs are
backbone routers.
Autonomous System
Boundary Router (ASBR)
A router that exchanges routing information with
other ASs.
An ASBR is not required to reside on the border of
an AS. It may be an internal router or an ABR. An
OSPF device that imports external routing
information becomes an ASBR.
Route Types
Inter-area and intra-area routes in an AS describe the internal network structure
of the AS. AS external routes describe routes to destinations outside the AS. OSPF
classifies imported AS external routes into Type 1 and Type 2.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 191
Table 5-5 lists route types in descending order of priority.
Table 5-5 Route types
Route Type Description
Intra-area route Routes that are generated from within an area (the
destination belongs to the area).
Inter-area route Routes that originate from other areas.
External route Routes that are imported into OSPF from other
routing protocols or different OSPF processes.
External routes fall into two categories: Type 1 and
Type 2 external routes. The difference between the
two types is the way the cost of a route is
calculated.
● Type 1 external route: The cost of a Type 1
external route is the addition of the external cost
(from the local device to an ASBR) and the
internal cost (from the ASBR to the destination)
used to reach that route.
● Type 2 external route: The cost of a Type 2
external route is always the external cost (from
an ASBR to the destination), irrespective of the
internal cost to reach that route.
A Type 1 external route is always preferred over a
Type 2 external route for the same destination.
Area Types
OSPF areas include common areas, stub areas, and not-so-stubby areas (NSSAs),
as shown in Table 5-6.
Table 5-6 Area types
Area
Type
Function Description
Common
area
By default, OSPF areas are common areas
that include:
● Standard area: transmits intra-area,
inter-area, and external routes.
● Backbone area: connects to all other
OSPF areas and transmits inter-area
routes. The backbone area is
represented by area 0. Routes between
non-backbone areas must be
forwarded through the backbone area.
● The backbone area
must have all its
devices connected.
● All non-backbone
areas must have
themselves
connected to the
backbone area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 192
Area
Type
Function Description
Stub area A stub area is a special area where an ABR
does not flood received AS external routes.
In a stub area, routers maintain fewer
routing entries and transmit less routing
information. Configuring a stub area is
optional and not every area can be
configured as such. A stub area is usually
a non-backbone area containing only one
ABR, located on the AS border. A stub area
is a non-backbone area containing only
one ABR and generally resides on the
border of an AS. The ABR in a stub area
does not transmit received AS external
routes, which significantly decreases the
routing table size on the ABR and the
amount of routing information
transmitted. To ensure the reachability of
AS external routes, the ABR generates a
default route and advertises the route to
non-ABRs in the stub area.
A totally stub area allows only intra-area
routes and ABR-advertised Type 3 LSAs
carrying a default route to be advertised
within the area.
● A backbone area
cannot be
configured as a stub
area.
● Stub area attributes
need to be
configured on all
the routers in the
area that needs to
be configured as a
stub area.
● An ASBR cannot
exist in a stub area.
Therefore, AS
external routes
cannot be
advertised within a
stub area.
● A virtual link cannot
pass through a stub
area.
NSSA An NSSA is similar to a stub area. An
NSSA does not advertise Type 5 LSAs, but
can import AS external routes. ASBRs in
an NSSA generate Type 7 LSAs to carry
the information about the AS external
routes. The Type 7 LSAs are advertised
only within the NSSA. When the Type 7
LSAs reach an ABR in the NSSA, the ABR
translates the Type 7 LSAs into Type 5
LSAs and floods them to the entire AS.
A totally NSSA allows only intra-area
routes to be advertised within the area.
● A backbone area
cannot be
configured as an
NSSA.
● NSSA attributes
need to be
configured on all
the routers in the
area that needs to
be configured as an
NSSA.
● An ABR in an NSSA
advertises default
routes in Type 7
LSAs within the
NSSA.
● All inter-area routes
are advertised by
ABRs.
● A virtual link cannot
pass through an
NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 193
After an OSPF network is partitioned into multiple areas, only LSAs within an area
are used in SPF calculations of this area. For example, in Figure 5-19, the link in
Area 1 is always flapping, and therefore SPF calculations are frequently performed
in Area 1. However, frequent SPF calculations occur only in Area 1 without
affecting other areas, improving network stability.
Figure 5-19 Area partitioning reducing the impact of link flapping
Stub area and totally stub area
In Figure 5-20, an AS is partitioned into Area 0 and Area 2, and external routes
are imported by the ASBR in Area 0. Typically, all routes on the network are
advertised into OSPF to ensure network reachability. In this situation, network
expansion will increase the number of devices and routing entries on each device
and require a large amount of CPU and memory resources to maintain these
entries. In some edge areas, low-performance devices may be deployed, and
therefore maintaining a large number of routing entries brings heavy load on
these devices.
Figure 5-20 Stub area and totally stub area
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 194
To optimize network performance, you often need to minimize the routing table
size to reduce the number of LSAs to be flooded without compromising network
reachability. If Area 2 is a common area, five types of LSAs, Type 1, Type 2, Type 3,
Type 4, and Type 5, may exist in this area. Traffic from routers in Area 2 must first
reach the ABR, regardless of the traffic destination outside Area 2. Therefore, non-
ABR routers in Area 2 do not need to know detailed information about external
networks. To meet this requirement, Area 2 is designed as a stub area.
Routers in Area 2 do not need to know inter-area specific routes and only one
egress is required to transmit traffic of these routers outside Area 2. To meet this
requirement, a totally stub area is designed. In a totally stub area, AS external
routes and inter-area routes cannot be advertised, reducing the number of LSAs
transmitted within this area.
NSSA and totally NSSA
In Figure 5-21, Area 2 is a stub area. An external network needs to connect to the
OSPF network through Area 2. That is, AS external routes need to be imported to
and advertised within the entire AS. One method is to enable RouterA in Area 2 to
import AS external routes into the AS. RouterA then becomes an ASBR, indicating
that Area 2 is no longer a stub area. To meet this requirement, an NSSA is
designed.
Figure 5-21 NSSA and totally NSSA
An NSSA differs from a stub area in that an NSSA allows importing AS external
routes into and advertising them within the entire AS without transmitting routes
learned from other areas in the AS.
To ensure the reachability of AS external routes, the ABR in an NSSA generates a
default route and advertises the route to the other routers in this NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 195
Multiple ABRs may be deployed in an NSSA. To prevent routing loops caused by
default routes, ABRs do not calculate the default routes advertised by each other.
All routers in an area must have the same area type configured. A router uses the
N-bit carried in a Hello packet to specify the area type that it supports. If routers
have different area types, they cannot establish OSPF neighbor relationships.
Some vendors' devices do not comply with this requirement, and the N-bit is also
set in Database Description (DD) packets. You can manually set the N-bit on
switches to enable interworking with these vendors' devices.
Similar to a totally stub area, a totally NSSA is defined to further reduce the
number of LSAs transmitted within an NSSA.
Inter-Area Loop and Loop Prevention
OSPF runs an SPF algorithm within an area, which prevents routing loops within
the area. However, the distance-vector algorithm is used for inter-area route
transmission, which may easily cause routing loops.
To prevent inter-area loops, OSPF prohibits routing information from being
advertised directly between two non-backbone areas and allows advertising
routing information within a single area or between the backbone and non-
backbone areas. Therefore, each ABR must be connected to the backbone area.
If OSPF allows advertising routing information directly between non-backbone
areas, an inter-area loop may occur, as shown in Figure 5-22. The route from the
backbone area to the external network can be transmitted from Area 0 to Area 1.
If transmitting routing information directly between non-backbone areas is
allowed, this route can be transmitted back to Area 0, forming an inter-area
routing loop. To prevent this loop, OSPF allows exchanging routing information
only between the backbone and non-backbone areas. That is, OSPF prohibits
routing information from being exchanged directly between Area 1 and Area 3 or
directly between Area 2 and Area 3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 196
Figure 5-22 OSPF inter-area loop
OSPF Default Route
A default route has an all–0 destination address and an all-0 mask. A device uses
a default route to forward packets when no matching route is discovered.
Hierarchical management of OSPF routes prioritizes the default route carried in
Type 3 LSAs over that carried in Type 5 or Type 7 LSAs.
An OSPF default route is used in the following scenarios:
● An ABR advertises a default route in Type 3 LSAs for instructing routers within
an area to forward packets between areas.
● An ASBR advertises a default route in Type 5 LSAs or Type 7 LSAs for
instructing routers in an AS to forward packets to other ASs.
Advertising an OSPF default route must follow these rules:
● An OSPF router in an area can advertise LSAs carrying a default route only
when the router has an interface connected to a device outside the area.
● If an OSPF router has advertised LSAs carrying a default route, the router no
longer learns the same-type LSAs carrying a default route advertised by other
routers. That is, the router uses only the LSAs advertised by itself to calculate
routes. The LSAs advertised by other routers are still recorded in the LSDB.
● If a router must use a route to advertise LSAs carrying an external default
route, the route cannot be a route learned by the local process. This is
because external default routes guide packet forwarding outside an AS,
whereas routes within an AS have the next hops pointing to the devices
within the AS.
Table 5-7 lists default route advertisement principles in different areas.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 197
Table 5-7 OSPF areas and default route advertisement
Area Type Function
Common area By default, devices in a common OSPF area do not
generate default routes.
When a default route on the network is generated by
another non-OSPF routing process, the device that
generates the default route must advertise it within the
entire OSPF AS. You can use commands to configure an
ASBR to generate a default route. After configuration, the
ASBR generates a Type 5 LSA carrying the default route
and then advertises the LSA within the entire OSPF AS.
Stub area A stub area does not allow AS external routes (carried in
Type 5 LSAs) to be transmitted within the area.
All routers within a stub area must learn AS external routes
from the ABR. The ABR automatically generates a
Summary LSA (Type 3 LSA) carrying a default route and
then advertises it within the entire stub area. This makes
all routes to destinations outside an AS learnable from the
ABR.
Totally stub area A totally stub area does not allow AS external routes
(carried in Type 5 LSAs) or inter-area routes (carried in
Type 3 LSAs) to be transmitted within the area.
All routers within the totally stub area must learn AS
external routes and inter-area routes from the ABR. The
ABR automatically generates a Summary LSA (Type 3 LSA)
carrying a default route and advertises it within the entire
totally stub area. This makes all routes to destinations
outside an AS and to destinations in other areas learnable
from the ABR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 198
Area Type Function
NSSA An NSSA allows its ASBRs to import a small number of AS
external routes. The ASBRs do not advertise Type 5 LSAs
received from other areas within the NSSA. That is, AS
external routes can be learned only from ASBRs in the
NSSA.
Devices in an NSSA do not automatically generate default
routes.
Use either of the following methods to generate default
routes:
● Method 1: To advertise AS external routes through the
ASBR in the NSSA and advertise other external routes
through other areas, configure a Type 7 LSA carrying a
default route on the ABR and advertise this LSA within
the entire NSSA. In this manner, a small number of AS
external routes can be learned from the ASBR in the
NSSA, and other routes can be learned from the ABR in
the NSSA.
● Method 2: To advertise all external routes through the
ASBR in the NSSA, configure a Type 7 LSA carrying a
default route on the ASBR and advertise this LSA within
the entire NSSA.
The difference between the two methods is:
● In method 1, an ABR generates a Type 7 LSA carrying a
default route regardless of whether the routing table
contains a default route.
● An ASBR generates a Type 7 LSA carrying a default
route only when the routing table contains a default
route.
Default routes are flooded only within the local NSSA and
are not flooded within the entire OSPF AS. If routers in the
local NSSA cannot discover routes to the outside of the AS,
the routers can forward packets outside of the AS through
an ASBR. However, packets of other OSPF areas cannot be
sent outside the AS through this ASBR. Type 7 LSAs
carrying default routes are not translated into Type 5 LSAs
to make the default routes be flooded within the entire
OSPF AS.
Totally NSSA A totally NSSA does not allow AS external routes (carried
in Type 5 LSAs) or inter-area routes (carried in Type 3
LSAs) to be transmitted within the area.
All routers within the totally NSSA must learn AS external
routes from the ABR. The ABR automatically generates a
Type 3 LSA carrying a default route and advertises it within
the entire totally NSSA. This allows all external routes
received from other areas and inter-area routes to be
advertised within the totally NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 199
5.2.1.9 OSPF LSA Types
An OSPF network is partitioned into multiple areas. These areas need to maintain
their own LSDBs, and routers in these areas are classified into different types. LSAs
encapsulated with route description can also be classified based on the router
types.
Figure 5-23 shows an OSPF network that is partitioned into three areas. A static
route is configured on R4 and imported into an OSPF process.
Figure 5-23 OSPF network partitioned into three areas
Table 5-8 lists router IDs and interface IP addresses of R1, R2, R3, and R4.
Table 5-8 Data plan
Device Router ID Interface IP Address
R1 10.1.1.1/32 GE0/0/1: 192.168.12.1/24
R2 10.2.2.2/32 GE0/0/2: 192.168.12.2/24
GE0/0/1: 192.168.23.1/24
R3 10.3.3.3/32 GE0/0/2: 192.168.23.2/24
GE0/0/1: 192.168.34.1/24
R4 10.4.4.4/32 GE0/0/2: 192.168.34.2/24
The following describes LSA types based on the network shown in Figure 5-23.
Router-LSA
A Router-LSA is a Type 1 LSA. It describes a router's link state and cost.
Every router on the OSPF network generates Router-LSAs and advertises them
within its areas. In Figure 5-24, R2 advertises a Router-LSA within Area 0 and Area
1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 200
Figure 5-24 Router-LSA (Type 1)
Figure 5-25 shows the information contained in the Router-LSA flooded by
GE0/0/1 on R2.
Figure 5-25 Information in a Router-LSA
An LSA includes the LSA header and LSA information fields. In all types of LSAs,
their LSA header contains the same fields with the only difference of the Link
State ID field meaning. You need to focus on the following fields in an LSA
header:
● Link-State Advertisement Type: indicates the LSA type.
● Link State ID: indicates a link state ID. In a Router-LSA, this field indicates the
router ID of the device that originates this LSA. Here, the value of this field is
the router ID of R2.
● Advertising Router: indicates the router that advertises this LSA.
A Router-LSA contains three information fields, which are used to advertise a
router's link states and costs to other routers in the area where this LSA is flooded.
The LSA shown in Figure 5-25 indicates that: The link type (Type) is a transit
network (Transit), the DR interface's IP address (ID) is 192.168.23.2, the interface
IP address of the advertising router connected to the network is 192.168.23.1
(Data), and the cost (Metric) to this network is 1. Routers that receive this LSA
generate the topology based on the link state information.
Four link types area available, and the ID and Data field values vary depending on
the link type:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 201
● P2P (the field value is 1): The ID field indicates the router ID of a neighbor,
and the Data field indicates the interface IP address of the advertising router
connected to the network.
● Transit (the field value is 2): The ID field indicates the IP address of the DR
interface, and the Data field indicates the interface IP address of the
advertising router connected to the network.
● Stub (the field value is 3): The ID field indicates the IP network or subnet
address, and the Data field indicates the network IP address or subnet mask.
● Virtual Link (the field value is 4): The ID field indicates the router ID of a
neighbor, and the Data field indicates the MIB-II ifIndex of the advertising
router's interface.
Network-LSA
A Network-LSA is a Type 2 LSA. It describes the link states of all routers on the
local network segment. A DR generates Network-LSAs and advertises them within
its area. In Figure 5-26, R3 sends R2 a Network-LSA that contains router IDs of all
the routers that establish adjacencies with the DR.
Figure 5-26 Network-LSA (Type 2)
Figure 5-27 shows the information contained in the Network-LSA.
Figure 5-27 Information in a Network-LSA
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 202
In a Network-LSA, the Link State ID field indicates the IP address of a DR
interface.
Flooding Router-LSAs and Network-LSAs within an area enables each router in this
area to complete LSDB synchronization, which implements intra-area
communication.
Network-summary-LSA
A Network-summary-LSA is a Type 3 LSA. It describes inter-area routing
information. An ABR generates Network-summary-LSAs and advertises them
within its area to notify destination addresses of routes from this area to other
areas. Actually, an ABR generates Network-summary-LSAs by collecting Type 1
and Type 2 LSAs within its area and summarizing related routes. In Figure 5-28,
R2 functions as an ABR to advertise routing information in Area 0 and Area 1 to
Area 1 and Area 0 respectively.
Figure 5-28 Network-summary-LSA (Type 3)
Figure 5-29 shows the information contained in a Network-summary-LSA
advertised by R2 on GE0/0/1.
Figure 5-29 Information in a Network-summary-LSA
In a Network-summary-LSA, the Link State ID field indicates the IP address of the
network described by this LSA. Information in this LSA shows that this LSA is
advertised by R2 (10.2.2.2) and can reach the network with the IP address
192.168.12.0 and the subnet mask 255.255.255.0 at the cost of 1. R2 advertises
the network address of Area 1 to Area 0 so that routers in Area 0 know how to
reach the network in Area 1, implementing inter-area communication.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 203
If an ABR has multiple routes within its area to reach a destination, it originates
only one Network-summary-LSA carrying the route with the lowest cost to the
backbone area.
Network-summary-LSAs will not be advertised within totally stub areas or totally
NSSAs.
ASBR-Summary-LSA
An ASBR-summary-LSA is a Type 4 LSA. It describes routes to an ASBR. An ABR
generates ASBR-summary-LSAs and advertises them to areas except the area to
which the ASBR is located. In Figure 5-30, R3 functions as an ABR to advertise an
ASBR-summary-LSA to Area 0.
Figure 5-30 ASBR-summary-LSA (Type 4)
Figure 5-31 shows information contained in an ASBR-summary-LSA. The Link
State ID field indicates the router ID (10.4.4.4) of the ASBR that this LSA
describes, namely, R4. The router that advertises this LSA is R3 (10.3.3.3), and the
cost of the route from R3 to R4 is 1.
Figure 5-31 Information in an ASBR-summary-LSA
AS-external-LSA
An AS-external-LSA is a Type 5 LSA. It describes routes to destinations outside an
AS. An ASBR generates AS-external-LSAs and advertises them to all areas except
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 204
stub areas and NSSAs. In Figure 5-32, R4 functions as an ASBR to advertise a
route to an external destination network outside the AS.
Figure 5-32 AS-external-LSA (Type 5)
Figure 5-33 shows the information contained in an AS-external-LSA. The Link
State ID field indicates the destination IP address of the external network. The
Forwarding Address field indicates the address to which packets destined for this
external network should be forwarded. Here, the forwarding address 0.0.0.0
indicates that packets will be forwarded to the ASBR that generates this LSA.
Figure 5-33 Information in an AS-external-LSA
NSSA LSA
In addition to the preceding LSAs, there is a special type of LSA, namely, NSSA
LSA. An NSSA LSA is a Type 7 LSA. It describes routes to destinations outside an
AS. An ASBR generates NSSA LSAs and advertises them only in NSSAs. When an
ABR in an NSSA receives NSSA LSAs, the ABR selectively translates them into Type
5 LSAs to advertise imported external routes to other areas on the OSPF network.
If Area 2 in Figure 5-23 is an NSSA, GE0/0/2 of R4 generates an NSSA LSA, as
shown in Figure 5-34.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 205
Figure 5-34 NSSA LSA
NSSA LSAs and AS-external-LSAs have the same fields but are flooded into
different areas. AS-external-LSAs are flooded within an AS, whereas NSSA LSAs
are flooded within NSSAs.
NSSAs allow importing external routes, but NSSA LSAs describing external routes
can only be flooded within NSSAs. To enable external routes to be imported into
all areas except NSSAs, the ABR (R3) translates NSSA LSAs into AS-external-LSAs
and floods the AS-external-LSAs within the entire AS. The following provides more
information about the translation:
● The propagate bit (P-bit) in Type 7 LSAs is used to notify a router of whether
the Type 7 LSAs need to be translated.
● By default, the translator is the ABR with the largest router ID in the NSSA.
● Only NSSA LSAs with the P-bit set to 1 and a non-zero forwarding address
(FA) can be translated into AS-external-LSAs. An FA indicates a specific
address that a packet will be forwarded to before arriving at the destination
address.
● The P-bit is not set for default routes in NSSA LSAs generated by an ABR.
Opaque LSA
Opaque LSAs include Type 9 LSAs, Type 10 LSAs, and Type 11 LSAs. They provide a
universal mechanism for OSPF extensions.
● Type 9 LSAs are advertised only on the network segment where the
originating interface resides. Grace LSAs used to support graceful restart (GR)
are Type 9 LSAs.
● Type 10 LSAs are advertised within an OSPF area. LSAs used to support traffic
engineering (TE) are Type 10 LSAs.
● Type 11 LSAs are advertised within an AS. At present, there are no
applications of Type 11 LSAs.
Table 5-9 describes whether a type of LSA is supported in an area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 206
Table 5-9 Support status of LSAs in different types of areas
Area Type Router
-LSA
(Type
1)
Netwo
rk-LSA
(Type
2)
Netwo
rk-
summ
ary-
LSA
(Type
3)
ASBR-
summa
ry-LSA
(Type
4)
AS-
extern
al-LSA
(Type
5)
NSSA-
LSA
(Type
7)
Common area
(including standard
and backbone
areas)
Suppor
ted
Suppor
ted
Suppor
ted
Suppor
ted
Support
ed
Not
support
ed
Stub area Suppor
ted
Suppor
ted
Suppor
ted
Not
support
ed
Not
support
ed
Not
support
ed
Totally stub area Suppor
ted
Suppor
ted
Not
support
ed
Not
support
ed
Not
support
ed
Not
support
ed
NSSA Suppor
ted
Suppor
ted
Suppor
ted
Not
support
ed
Not
support
ed
Suppor
ted
Totally NSSA Suppor
ted
Suppor
ted
Not
support
ed
Not
support
ed
Not
support
ed
Suppor
ted
5.2.1.10 OSPF Fast Convergence
OSPF fast convergence speeds up the convergence of routes. It includes the
following components:
● Incremental SPF (I-SPF): recalculates only the routes of the changed nodes
rather than all the nodes when the network topology changes, which speeds
up route calculation.
● Partial Route Calculation (PRC): calculates only the changed routes when the
routes on the network change.
● OSPF intelligent timer: can dynamically adjust its value based on the user's
configuration and the frequency of a triggering event, such as route
calculation, which ensures rapid and stable network operation.
The OSPF intelligent timer uses the exponential backoff technology so that
the value of the timer is accurate to milliseconds.
I-SPF
In ISO 10589, the Dijkstra algorithm was adopted to calculate routes. When a
node changes on the network, this algorithm is used to recalculate all routes,
which takes a long time and consumes too many CPU resources, affecting the
convergence speed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 207
I-SPF improves the Dijkstra algorithm. Except for the first time, only changed
nodes instead of all nodes are involved in calculation. The SPT generated at last is
the same as that generated using the Dijkstra algorithm. I-SPF consumes fewer
CPU resources and speeds up network convergence.
PRC
Similar to I-SPF, PRC performs calculation only for the changed routes. The
difference is that PRC does not calculate the shortest paths. It updates routes
based on the SPTs calculated by I-SPF.
In route calculation, a leaf represents a route, and a node represents a router.
Either an SPT change or a leaf change causes a routing information change. The
SPT change is irrelevant to the leaf change. PRC processes routing information as
follows:
● If the SPT changes, PRC processes the routing information of all leaves on a
changed node.
● If the SPT remains unchanged, PRC does not process the routing information
on any node.
● If a leaf changes, RPC processes the routing information on the leaf only.
● If a leaf remains unchanged, PRC does not process the routing information on
any leaf.
For example, if OSPF is enabled on an interface of a node, the SPT calculated by I-
SPF remains unchanged. PRC updates only the routes of this interface, consuming
fewer CPU resources.
PRC improves the SPF algorithm. Working with I-SPF, RPC further improves
network convergence performance.
NOTE
On live networks, only I-SPF and PRC are used to calculate OSPF routes.
OSPF Intelligent Timer
On an unstable network, routes are calculated frequently, which consumes a great
number of CPU resources. In addition, LSAs that describe the unstable topology
are generated and transmitted on the unstable network. Frequent processing of
data such LSAs affects the rapid and stable operation of the entire network.
To speed up route convergence on the entire network, you can use the OSPF
intelligent timer that can control route calculation, LSA generation, and LSA
receipt.
The OSPF intelligent timer works in either of the following modes:
● On a network where routes are calculated repeatedly, the OSPF intelligent
timer dynamically adjusts the interval between two route calculations based
on user's configuration and the exponential backoff technology. In this way,
the number of route calculations can be reduced, and therefore fewer CPU
resources are consumed. Routes will be calculated again after the network
topology stabilizes.
● On an unstable network, a router generates or receives numerous LSAs due to
frequent topology changes. In this case, the OSPF intelligent timer can
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 208
dynamically adjust the interval at which the LSAs are generated or processed.
Within the interval, no LSAs are generated or processed. This prevents invalid
LSAs from being generated and advertised on the entire network.
The OSPF intelligent timer is started by default and has a default value.
5.2.1.11 OSPF Virtual Link
A virtual link is a logical channel set up between two ABRs through a non-
backbone area.
As required in RFC 2328, all non-backbone areas must be connected to the
backbone area to ensure that all areas are reachable. However, it is not true in
some scenarios due to certain restrictions. To resolve this issue, you can configure
an OSPF virtual link.
In Figure 5-35, Area 2 is not connected to Area 0. Therefore, RouterA cannot
function as an ABR to generate routing information of Network1 and advertise the
information to Area 2, and RouterB does not have routes to Network1. A virtual
link can be deployed to resolve this issue.
Figure 5-35 Non-backbone area not connected to the backbone area
In Figure 5-36, two ABRs use a virtual link to directly transmit OSPF packets. The
OSPF device between the two ABRs only forwards packets. Because the
destination of OSPF packets is not the OSPF device, the OSPF device transparently
transmits the OSPF packets as common IP packets.
Figure 5-36 OSPF virtual link implementation principles
A virtual link functions as a point-to-point connection between two ABRs. The
interfaces on both ends of the virtual link can be configured with parameters such
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 209
as the Hello interval in the same way these parameters are configured on physical
interfaces. The transmit area refers to the area that provides an internal route of a
non-backbone area for both ends of the virtual link. A virtual link must be
configured at both ends of the link, or it will not take effect.
A virtual link increases the network complexity and complicates fault locating. You
are not advised to use virtual links during network planning. Virtual links are only
a temporary measure to fix unavoidable network topology problems. When virtual
links are designed, you need to consider whether to re-plan the network.
5.2.1.12 OSPF Route Summarization and Filtering
OSPF Route Summarization
Route summarization allows multiple routes with the same prefix to be
summarized into a single summary route. Only the summary route is advertised to
other areas. This reduces both the routing table size and routing information
transmitted between areas, improving device performance.
OSPF supports two types of route summarization:
● Inter-area route summarization
Inter-area route summarization is performed on ABRs and applies to routes
from within an AS. An ABR generates Network-summary (Type 3) LSAs by
network segment while advertising routing information to other areas. If
network segments are contiguous, the ABR can summarize them into a single
segment. This allows the ABR to send only the summary LSA for all the
specified network segments.
● External route summarization
External route summarization is performed on ASBRs and is specific to
external routes that are imported into OSPF. ASBRs can summarize imported
AS-external (Type 5) LSAs within a summary address range. After an NSSA is
configured, an ASBR must summarize imported NSSA (Type 7) LSAs with the
summary address range.
Devices that are both ABRs and ASBRs summarize the Type 5 LSAs translated
from Type 7 LSAs.
OSPF Route Filtering
OSPF supports route filtering using routing policies, including route-policy, access-
list, and prefix-list. By default, OSPF does not filter routes.
OSPF route filtering can be used to:
● Import routes.
OSPF can import routes learned by other routing protocols. You can configure
routing policies to filter imported routes, allowing OSPF to import only routes
that match specific conditions.
● Advertise imported routes.
An OSPF device advertises imported routes to its neighbors.
You can configure filtering rules to filter the routes to be advertised, but the
rules take effect only on ASBRs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 210
● Learn routes.
Filtering rules can be configured to allow OSPF to filter received intra-area,
inter-area, and AS external routes.
After receiving routes, an OSPF device adds only the routes that match
filtering rules to the local routing table. However, the device can advertise all
routes from the OSPF routing table.
● Learn inter-area LSAs.
You can configure an ABR to filter incoming Summary LSAs. This
configuration takes effect only on ABRs because only ABRs can advertise
Summary LSAs.
Difference between route filtering for inter-area LSA learning and that for
route learning: The former directly filters incoming LSAs but the latter filters
the routes calculated using LSAs to determine the routes to be added to the
local routing table. In route filtering for route learning, all incoming LSAs are
learned.
● Advertise inter-area LSAs.
You can configure an ABR to filter outgoing Summary LSAs. This configuration
takes effect only on ABRs.
5.2.1.13 OSPF Multi-Process
OSPF supports multi-process. This allows multiple OSPF processes to run
independently on the same router. Route exchanges between different OSPF
processes are similar to route exchanges between different routing protocols.
Each router interface belongs to only one OSPF process.
OSPF multi-process typically applies to the scenario where OSPF runs between
provider edges (PEs) and customer edges (CEs) in a VPN whereas OSPF is used as
an IGP on the backbone of the VPN. On the PEs, the two OSPF processes do not
affect each other.
5.2.1.14 OSPF RFC 1583 Compatibility
RFC 1583 is an early version of OSPFv2.
During OSPF external route calculations, routing loops may occur because RFC
2328 and RFC 1583 define different route selection rules. To prevent routing loops,
both communication ends must use the same route selection rules. The
mechanism is as follows:
● When RFC 1583 compatibility is enabled, OSPF uses route selection rules
defined in RFC 1583.
● When RFC 1583 compatibility is disabled, OSPF uses route selection rules
defined in RFC 2328.
OSPF calculates external routes using Type 5 LSAs. If the router with RFC 1583
compatibility enabled receives a Type 5 LSA:
● The router selects a route to the ASBR that originates the LSA or to the
forwarding address (FA) described in the LSA.
● The router selects external routes to the same destination.
By default, OSPF uses route selection rules defined in RFC 1583.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 211
5.2.2 Enhanced OSPF Functions
5.2.2.1 OSPF VPN
Definition
OSPF VPN enables Provider Edges (PEs) and Customer Edges (CEs) within VPNs to
run OSPF. This is useful for interworking and allows OSPF to learn and advertise
VPN routes.
Purpose
As a widely used IGP, in most cases, OSPF runs in VPNs. When OSPF runs between
PEs and CEs and PEs are advertising VPN routes using OSPF, CEs do not need to
support other routing protocols for interworking, simplifying the management and
configuration of CEs.
Running OSPF Between PEs and CEs
In BGP/MPLS VPN, routing information is transmitted between PEs using Multi-
Protocol BGP (MP-BGP), whereas routing information is learned and advertised
between PEs and CEs using OSPF.
Running OSPF between PEs and CEs has the following benefits:
● OSPF is used within a site to learn routes. Running OSPF between PEs and CEs
can reduce the protocol types that CEs must support, lowering the
requirements on the CEs.
● Running OSPF both within a site and between PEs and CEs frees network
administrators from getting familiarity with multiple protocols, simplifying the
workload of them.
● Running OSPF between PEs and CEs facilitates the transition from a non-VPN
backbone network to a BGP/MPLS VPN network.
As shown in Figure 5-37, CE1, CE3, and CE4 belong to VPN 1. The numbers
following OSPF refer to the IDs of OSPF multi-instance processes running on PEs.
Figure 5-37 Running OSPF between PEs and CEs
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 212
To advertise routes of CE1 to CE3 and CE4:
1. PE1 imports OSPF routes of CE1 into BGP and generates BGP VPNv4 routes.
2. PE1 advertises BGP VPNv4 routes to PE2 using MP-BGP.
3. PE2 imports BGP VPNv4 routes into OSPF, and then advertises these routes to
CE3 and CE4.
The process of advertising routes of CE4 or CE3 to CE1 is the same.
Configuring OSPF Areas Between PEs and CEs
OSPF areas between PEs and CEs can be either non-backbones or backbone areas
(Area 0). A PE can only be an area border router (ABR).
In the extended application of OSPF VPN, the MPLS VPN backbone network serves
as Area 0. OSPF requires that backbone areas (Area 0) be contiguous. Therefore,
Area 0 in all VPN sites must be connected to the MPLS VPN backbone network. If
a VPN site has OSPF Area 0, the PEs that CEs access must be connected to the
backbone area of this VPN site through the MPLS VPN backbone network. If no
physical link is available to directly connect PEs to Area 0 in the VPN site, a virtual
link can be used to implement logical connection between them, as shown in
Figure 5-38.
Figure 5-38 Configuring OSPF areas between PEs and CEs
In Figure 5-38, a non-backbone area (Area 1) is configured between PE1 and CE1,
and a backbone area (Area 0) is configured in Site 1. As a result, the backbone
area in Site 1 is isolated from the VPN backbone area. Therefore, a virtual link is
configured between PE1 and CE1 to ensure that the backbone areas are
continuous.
OSPF Domain ID
If inter-area routes are advertised between local and remote OSPF areas, these
areas are considered in the same OSPF domain.
Important characteristics of OSPF domain IDs include:
● Domain IDs identify and differentiate different domains.
● Each OSPF domain has one or more domain IDs, one of which is a primary ID
with the others being secondary IDs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 213
● If an OSPF instance does not have a specific domain ID, NULL is used as its
domain ID.
Before a PE advertises the BGP routes learned from remote PEs to CEs, the PE
checks the domain IDs carried in the BGP routes to determine the type of OSPF
routes (Type 3, Type 5, or Type 7) to be advertised.
If local domain IDs are the same as or compatible with the remote domain IDs
carried in the BGP routes, the PE advertises Type 3 routes. Otherwise, the PE
advertises Type 5 or Type 7 routes.
Table 5-10 Domain ID
Comparison Between Local and Remote
Domain IDs
Advertised Route Type
Both the local and remote domain IDs are null. Inter-area route
The remote domain ID is the same as the local
primary domain ID or one of the local
secondary domain IDs.
Inter-area route
The remote domain ID is different from the
local primary domain ID and all the local
secondary domain IDs.
If the local area is a non-NSSA,
external routes are generated.
If the local area is an NSSA,
NSSA routes are generated.
Routing Loop Prevention
Routing loops may occur between PEs and CEs if OSPF and BGP learn routes from
each other.
Figure 5-39 OSPF VPN routing loop
As shown in Figure 5-39, a routing loop occurs in the following process:
1. PE1 uses OSPF to import a BGP route whose destination address is
10.1.1.1/32.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 214
2. OSPF then generates a Type 5 or Type 7 LSA and advertises it to CE1.
3. CE1 learns an OSPF route with the destination address of 10.1.1.1/32 and the
next hop of PE1 and advertises the route to PE2.
4. PE2 learns an OSPF route with the destination address and next hop being
10.1.1.1/32 and CE1 respectively.
5. Likewise, CE1 learns an OSPF route with the destination address of 10.1.1.1/32
and the next hop of PE2, and PE1 learns an OSPF route with the destination
address of 10.1.1.1/32 and the next hop of CE1.
6. In this way, CE1 has learned two equal-cost routes, with the next hop of one
being PE1 and the other being PE2. The next hops of the routes from PE1 and
PE2 to 10.1.1.1/32 are both CE1. That is, a routing loop occurs.
The preference of an OSPF route is higher than that of a BGP route. Therefore,
BGP routes on PE1 and PE2 to 10.1.1.1/32 are replaced by the OSPF routes. The
OSPF routes with the destination address of 10.1.1.1/32 and the next hop of CE1
are active in the routing tables of PE1 and PE2.
The BGP routes then become inactive, causing the deletion of the LSAs generated
when OSPF imports the routes. As a result, the active OSPF routes are withdrawn,
and the BGP route becomes active again. The above process occurs repeatedly,
leading to route flapping.
OSPF VPN provides a solution to this problem, as described in the following table.
Table 5-11 Routing loop prevention
Feature Definition Function
DN bit The DN bit is a 1-bit flag used by
an OSPF multi-instance process
to prevent routing loops.
When a PE advertises
generated Type 3, Type
5, or Type 7 LSAs to CEs,
it sets the DN bit of
these LSAs to 1 and
retains the default value
0 for the DN bit of other
LSAs.
When calculating routes,
the OSPF multi-instance
process of the PE ignores
LSAs with the DN bit set
to 1. This prevents the PE
from learning the self-
originated LSAs from
CEs, thereby avoiding
routing loops.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 215
Feature Definition Function
VPN route tag The VPN route tag is carried in
Type 5 or Type 7 LSAs generated
by PEs according to received BGP
private routes.
The VPN route tag is valid only
on the PEs that receive BGP
routes and generate OSPF LSAs.
It is not transmitted in BGP
extended community attributes.
When a PE detects that
the VPN route tag in the
received LSA is the same
as that in the local LSA,
the PE ignores this LSA.
This prevents routing
loops.
Default route A default route is a route with an
all-0 destination address and an
all-0 subnet mask.
Default routes are used
to forward traffic from
CEs or from the sites
where CEs reside
.
Disabling Routing Loop Prevention
NOTICE
Exercise caution when disabling routing loop prevention as it increases the
likelihood of routing loops.
After routing loop prevention is enabled, OSPF routing loops will not occur in VPN
sites during BGP/OSPF route exchanges.
In an inter-AS VPN Option A scenario, if OSPF runs between ASBRs to transmit
VPN routes, the remote ASBR will be unable to learn the OSPF routes sent by the
local ASBR due to the routing loop prevention mechanism.
Figure 5-40 illustrates an inter-AS VPN in Option A mode. OSPF runs between PE1
and CE1. Assume that CE1 sends VPN routes to CE3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 216
Figure 5-40 Networking diagram of an inter-AS VPN deployed in Option A mode
In Figure 5-40:
1. PE1 learns routes to CE1 through the OSPF process within a VPN instance,
imports these routes into MP-BGP, and then sends the MP-BGP routes to
ASBR1.
2. ASBR1 receives the MP-BGP routes, imports the routes into the OSPF process
within a VPN instance, and then generates Type 3, Type 5, or Type 7 LSAs with
the DN bit set to 1.
3. When learning these LSAs using OSPF, ASBR2 checks the DN-bit in the LSAs.
When detecting that the DN-bit in the LSAs is 1, ASBR2 ignores these LSAs.
Because ASBR2 cannot learn OSPF routes sent from ASBR1, CE1 cannot
communicate with CE3.
The following methods are provided to solve this problem:
● Method 1: Disable devices from setting the DN bit to 1 when importing BGP
routes into OSPF. For example, ASBR1 is disabled from setting the DN-bit to 1
when importing BGP routes into OSPF. When ASBR2 receives these routes and
detects that the DN-bit in the LSAs carrying these routes is 0, ASBR2 uses
these LSAs to calculate routes.
● Method 2: Disable devices from checking the DN-bit in received LSAs. For
example, ASBR2 is disabled from checking the DN-bit in received LSAs. ASBR1
sets the DN-bit to 1 in LSAs when importing MP-BGP routes into OSPF.
ASBR2, however, does not check the DN-bit when receiving these LSAs and
uses these LSAs to calculate routes.
The two methods can be used more flexibly based on specific types of LSAs. For
Type 3 LSAs, you can configure a sender to determine whether to set the DN bit to
1 or configure a receiver to determine whether to check the DN bit in the Type 3
LSAs based on the router ID of the device that generates the LSAs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 217
In an inter-AS VPN Option A scenario as shown in Figure 5-41, four ASBRs are
fully meshed and run OSPF. ASBR2 may receive Type 3, Type 5, or Type 7 LSAs
generated on ASBR4. If ASBR2 is disabled from checking the DN-bit in the LSAs,
ASBR2 will accept the Type 3 LSAs, and routing loops will occur. ASBR2 will deny
the Type 5 or Type 7 LSAs because the VPN route tags carried in the LSAs are the
same as the default VPN route tag of the OSPF process on ASBR2.
To address the routing loops caused by Type 3 LSAs, you can disable the check of
the DN-bit only for the Type 3 LSAs that are generated by devices with the router
ID 10.1.1.1 or 10.3.3.3. With the check disabled in such a way, if ASBR2 receives
Type 3 LSAs sent by ASBR4 with the router ID 10.4.4.4, ASBR2 will check the DN-
bit and deny these Type 3 LSAs because the DN-bit is set to 1.
Figure 5-41 Networking diagram of fully meshed ASBRs in the inter-AS VPN
Option A scenario
Multi-VPN-Instance CE
OSPF multi-instance generally runs on PEs. Multi-VPN-Instance CEs (MCEs) are
devices that run OSPF multi-instance within user LANs.
Compared with OSPF multi-instance running on PEs, MCEs have the following
characteristics:
● Support of OSPF-BGP synchronization is not required.
● A separate OSPF instance is created for each service. That is, different virtual
CEs transmit traffic for different services. This is a low-cost solution for LAN
security issues.
● Different OSPF multi-instances are implemented on a CE. To implement OSPF
multi-instances, routing loop detection needs to be disabled and route
calculation is performed directly. That is, MCEs also use the received LSAs with
the DN bit set to 1 for route calculations.
5.2.2.2 OSPF TE
Traffic engineering (TE) requires knowledge of the network topology and network
constraints, including the bandwidth, traffic engineering metrics, administrative
groups, and affinity attributes. By itself, OSPF cannot meet these requirements and
needs to be extended by introducing a new type of LSAs to advertise network
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 218
constraints. Then, the Constrained Shortest Path First (CSPF) algorithm can
calculate the path that satisfies defined constraints.
OSPF TE is designed to support MPLS TE and the establishment and maintenance
of the Label Switch Path (LSP). In MPLS TE architecture, OSPF is responsible for
collecting and advertising MPLS TE information.
Figure 5-42 OSPF functions in MPLS TE architecture
OSPF Functions in MPLS TE Architecture
In MPLS TE architecture, OSPF advertises information by collecting and then
flooding traffic engineering information to devices in the same area.
Collected information forms the traffic engineering database (TEDB) and is
utilized by the CSPF to calculate routes.
OSPF does not consider what the specific information is or how MPLS uses the
information.
TE-LSA
OSPF uses Type 10 Opaque LSAs to collect and advertise traffic engineering
information. Type 10 LSAs contain link state information required by traffic
engineering, including:
● Maximum link bandwidth
● Maximum reservable bandwidth
● Current reserved bandwidth
● Link color
Type 10 Opaque LSAs use OSPF flooding to synchronize link state information
among devices in an area. This forms a uniform TEDB for route calculation.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 219
Interaction Between OSPF TE and CSPF
OSPF uses Type 10 LSAs to collect traffic engineering information, including the
bandwidth, priority, and link metric. OSPF then processes and provides the
information for CSPF to calculate routes.
IGP Shortcut and Forwarding Adjacency
OSPF supports IGP shortcuts and forwarding adjacencies. These two features
enable OSPF packets to reach a destination through a tunnel interface as the
outbound interface. The differences between the two features are as follows:
Devices with IGP shortcuts enabled use a tunnel interface as an outbound
interface without advertising the tunnel interface link to neighbors. This prevents
other devices from using this tunnel. IGP shortcuts are unidirectional and need to
be configured only on devices that need to use IGP shortcuts.
Devices with forwarding adjacencies enabled use a tunnel interface as an
outbound interface while advertising the tunnel interface link to neighbors. This
allows other devices to use this tunnel.
OSPF DS-TE
DiffServ Aware Traffic Engineering (DS-TE) combines the advantages of MPLS TE
and Differentiated Services (DiffServ), and therefore it controls and forwards data
differently based on Class of Service (CoS) while precisely controlling data paths.
That is, DS-TE allows for efficient use of network resources while reserving
required resources for different services.
To support DE-TE in MPLS, OSPF TE-LSAs contain local overbooking multiplier
TLVs and bandwidth constraint (BC) TLVs. These TLVs are used to collect and
advertise the information about the reservable bandwidth of each class type (CT)
with a specific priority on the link. A class type refers to the bandwidth set of an
LSP or a group of LSPs sharing the same CoS.
OSPF SRLG
OSPF supports Shared Risk Link Group (SRLG) applications in MPLS by obtaining
information about the SRLG that floods traffic engineering information to devices
in an area.
5.2.2.3 OSPF Security
OSPF GTSM
The Generalized TTL Security Mechanism (GTSM) protects services over the IP
layer against attacks by checking whether the value of the time to live (TTL) in an
IP packet header is within a predefined range. An attacker may simulate real
unicast OSPF packets and continuously send the packets to a router. When the
router finds that these packets are destined for itself, it directly sends the packets
to the control plane for processing without checking the validity of these packets.
As a result, the router will remain busy processing these packets, leading to a high
CPU usage.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 220
GTSM protects a device's TCP/IP-based control plane from certain attacks that
consume CPU resources, for example, the CPU overload attack.
Devices with GTSM enabled check the TTL values in all received packets according
to configured policies. An action is then performed on the packets that do not
match the criteria specified in the policies. (For example, the packets may be
discarded).
A GTSM policy includes:
● Source address of an IP packet sent to the device
● VPN instance to which a packet belongs
● Protocol number of an IP packet (89 for OSPF and 6 for BGP)
● Source interface number and destination interface number of a protocol
above TCP/UDP
● Valid TTL range
GTSM can be implemented for different connections:
● For directly connected neighbors, the TTL of unicast protocol packets is set to
255.
● For multi-hop neighbors, an appropriate TTL range is defined.
The applicability of GTSM is as follows:
● GTSM is applicable to unicast packets instead of multicast packets. The TTL of
multicast packets cannot exceed 255, and therefore GTSM is not required for
multicast packets.
● GTSM does not apply to devices that use a tunnel to communicate with each
other.
OSPF Packet Authentication
On networks requiring high security, OSPF packet authentication can be
configured on routers to improve OSPF network security. During OSPF packet
authentication, routers must use the same authentication mode and can establish
a neighbor relationship to exchange routing information only after they pass the
authentication.
OSPF supports two authentication methods:
● Simple password authentication: uses a password in either plaintext or
ciphertext for authentication.
● Message digest authentication: uses Message Digest5 (MD5), Hash Message
Authentication Code (HMAC) MD5, or HMAC-Secure Hash Algorithm (SHA)
256 for authentication.
Packet Authentication can be configured for all networks in an area or for
individual interfaces in the area. Interface authentication configuration overrides
area authentication.
5.2.2.4 OSPF GR
The control plane and forwarding plane are generally separated on switches.
When the network topology remains stable, a restart of the control plane does not
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 221
affect the forwarding plane, which means that the forwarding plane can continue
to forward data. This separation ensures non-stop service forwarding.
In graceful restart (GR) mode, the forwarding plane continues to direct data
forwarding when a device restart occurs, without being affected by the actions on
the control plane, such as re-establishment of neighbor relationships and route
calculation. In this way, service interruption caused by route flapping is prevented
and the network reliability is improved.
Basic Concepts of OSPF GR
Graceful Restart (GR), also called non-stop forwarding (NSF), is used to ensure
normal traffic forwarding and proper running of key services during a routing
protocol restart.
Unless otherwise stated, GR described in this section refers to the GR technology
defined in RFC 3623.
GR is a fault-tolerant redundancy technology, one of high availability (HA)
technologies that include link protection, faulty node recovery, and traffic
engineering, and is used to ensure non-stop forwarding of key services during
active/standby switchovers and system upgrades.
The following concepts are involved in GR:
● Grace-LSA
OSPF supports GR by flooding Grace-LSAs. Grace-LSAs are used to inform
neighbors of the GR time, cause, and interface address when the GR starts
and ends.
● Role of a switch during GR
– Restarter: is the switch that restarts. The Restarter can be configured to
support full GR or partial GR.
– Helper: is the switch that helps the Restarter. The Helper can be
configured to:
▪ Selectively support GR based on policies.
▪ Support planned GR.
▪ Support unplanned GR.
● GR causes
– Unknown: indicates that GR is triggered by unknown events.
– Software restart: indicates that GR is triggered by commands.
– Software reload/upgrade: indicates that GR is triggered by a software
restart or upgrade.
– Switch to redundant control processor: indicates that GR is triggered by
an abnormal active/standby switchover.
● GR period
The GR period cannot exceed 1800 seconds. OSPF switches can exit GR before
GR timeout regardless of successful or failed GR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 222
Classification of OSPF GR
● Full GR: When a neighbor of a switch does not support GR, the switch exits
GR.
● Partial GR: When a neighbor of a switch does not support GR, only the
interface associated with this neighbor exits GR, whereas the other interfaces
perform GR normally.
● Planned GR: Commands are manually configured to restart a switch or
perform an active/standby switchover for the switch. The Restarter sends a
Grace-LSA before the restart or switchover.
● Unplanned GR: A switch performs an active/standby switchover without
sending a Grace-LSA and then enters GR after the standby board goes Up.
The process of unplanned GR after the standby board goes Up is the same as
that of planned GR.
GR Process
Figure 5-43 shows an OSPF GR process.
Figure 5-43 OSPF GR process
An OSPF GR process includes the following phases:
1. The Restarter (SwitchA) enters the GR state.
a. The Restarter performs an active/standby switchover.
NOTE
In planned GR mode, the Restarter sends a Grace-LSA to notify the Helper of the
GR start, period, and cause before performing the switchover. In unplanned GR
mode, the Restarter does not send any Grace-LSA.
b. Before the Restarter enters the GR state, it sends a Grace-LSA to maintain
OSPF neighbor relationships.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 223
c. When the standby board goes Up, the Restarter immediately sends a
Grace-LSA to notify the Helper (SwitchB) of the GR start, period, and
cause. Then, the Restarter sends five consecutive Grace-LSAs to the
Helper to ensure that the Helper can receive a Grace-LSA.
NOTE
Sending five consecutive Grace-LSAs is proposed by vendors and has not been
defined by OSPF.
During the GR, the Helper retains the neighbor relationship with the Restarter
so that other switches do not detect the active/standby switchover performed
by the Restarter.
2. The Restarter stays in the GR state.
a. The Restarter and Helper establish an OSPF adjacency.
b. The Helper checks the Restarter status. If the Restarter status is Down,
the Helper considers that the Restarter can restore services within a
specified GR period. Before the specified GR period expires, the Helper
does not terminate sessions or delete the topology or routing information
obtained from the Restarter.
c. When the Restarter recovers, it sends a packet to the Helper. After the
Restarter receives a response, it reestablishes the neighbor relationship
list.
d. The Restarter establishes a session with the Helper to obtain topology or
routing information and uses the information to calculate its own routing
table.
An active/standby switchover or restart of the Restarter can be manually
performed or automatically triggered by faults. During the switchover or
restart, the Restarter does not delete the routing information from its routing
table or FIB or reset its interface boards. Therefore, the service continuity can
be implemented.
3. The Restarter exits the GR state.
– If the GR is successful, the Restarter reestablishes the neighbor
relationship with the Helper before the GR period expires. After the
Helper receives a Grace-LSA with an aging time of 3600 seconds from the
Restarter, the status of the neighbor relationship between the Helper and
Restarter changes to Full.
– If the GR fails, packet reception and status change on the Restarter and
Helper are as follows:
On the Restarter:
▪ The Restarter times out the GR and fails to completely recover the
neighbor relationships.
▪ The Restarter fails to perform the bidirectional check due to Type 1
or Type 2 LSAs sent by the Helper.
▪ The interface status of the Restarter changes.
▪ The Restarter receives 1-way Hello packets from the Helper.
▪ The Restarter receives a Grace-LSA generated by another switch on
the same network segment.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 224
NOTE
Only one switch can perform GR on the same network segment at the same
time.
▪ Different DRs or BDRs are elected among the Restarter and
neighbors on the same network segment due to topology changes.
On the Helper:
▪ The Helper fails to receive a Grace-LSA from the Restarter before the
neighbor relationship expires.
▪ The interface status of the Helper changes.
▪ The Helper receives LSAs different from those in its own LSDB from
other switches. You can configure the Helper not to perform a strict
LSA check to avoid this issue.
▪ The Helper receives Grace-LSAs from two switches on the same
network segment at the same time.
▪ The neighbor relationships between the Helper and other switches
change.
Comparison Between GR Mode and Non-GR Mode
Table 5-12 Comparison of an active/standby switchover in GR mode and non-GR
mode
Switchover in Non-GR Mode Switchover in GR Mode
● OSPF neighbor relationships are
re-established.
● Routes are recalculated.
● The forwarding table changes.
● The entire network detects the
route changes, and routes flap for
a short period of time.
● Packets are lost during
forwarding, and services are
interrupted.
● OSPF neighbor relationships are re-
established.
● Routes are recalculated.
● The forwarding table remains
unchanged.
● Except for neighbors of the device on
which an active/standby switchover
occurs, other switches do not detect
route changes.
● No packets are lost during
forwarding, and services are not
affected.
5.2.2.5 OSPF Neighbor Relationship Flapping Suppression
OSPF neighbor relationship flapping suppression works by delaying OSPF neighbor
relationship reestablishment or setting the link cost to the maximum value
(65535).
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 225
Background
If the status of an interface carrying OSPF services alternates between Up and
Down, OSPF neighbor relationship flapping occurs on the interface. During the
flapping, OSPF frequently sends Hello packets to reestablish the neighbor
relationship, synchronizes LSDBs, and recalculates routes. In this process, a large
number of packets are exchanged, adversely affecting the stability of the existing
neighbor relationships, OSPF services, and other OSPF-dependent services, such as
LDP and BGP. Suppression of OSPF neighbor relationship flapping can address this
problem by delaying OSPF neighbor relationship reestablishment or preventing
service traffic from passing through flapping links.
Related Concepts
Flapping_event: A flapping_event occurs when the status of a neighbor
relationship on an interface last changes from Full to a non-Full state. A
flapping_event triggers flapping detection.
Flapping_count: This parameter indicates the number of times flapping has
occurred.
Detect-interval: This parameter indicates the flapping detection interval. The
interval is used to determine whether to trigger a valid flapping_event.
Threshold: This parameter indicates the flapping suppression threshold. When the
flapping_count reaches or exceeds the threshold, flapping suppression takes effect.
Resume-interval: This parameter indicates the resumption interval. If the time
between two valid flapping_events is longer than the resume-interval, flapping
suppression exits.
Implementation
Flapping detection
A flapping counter is started on OSPF interfaces. Each time two consecutive
flapping_events occur within a detect-interval, a valid flapping_event is recorded
and the flapping_count increments by 1. When the flapping_count reaches or
exceeds the threshold, the system determines that flapping occurs, triggers
flapping suppression accordingly, and sets the flapping_count to 0. If two
consecutive valid flapping_events occur within a period longer than the resume-
interval before the flapping_count reaches the threshold again, the system also
sets the flapping_count to 0. Interfaces start the suppression timer when the
neighbor status last changes to ExStart or Down.
The detect-interval, threshold, and resume-interval are configurable.
Flapping suppression
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes,
interfaces prevent neighbor relationships from being reestablished within the
suppression period, which minimizes LSDB synchronization attempts and
packet exchanges.
● Hold-max-cost mode: In the case where the traffic forwarding path changes
frequently, interfaces use 65535 as the cost of the flapping link within the
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 226
suppression period, which prevents traffic from passing through the flapping
link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode after the Hold-down mode exits.
By default, the Hold-max-cost mode takes effect. The suppression mode and
period can be changed manually using command lines.
NOTE
When an interface enters the flapping suppression state, all neighbors of the interface enter
the state accordingly.
Exiting flapping suppression
Interfaces exit flapping suppression in the following scenarios:
● The suppression timer expires.
● The corresponding OSPF process is reset.
● Command lines are configured to force interfaces to exit flapping suppression.
Typical Scenarios
Basic scenario
In Figure 5-44, the traffic forwarding path is Switch A -> Switch B -> Switch C ->
Switch E before a link failure occurs. After the link between Switch B and Switch C
fails, the forwarding path switches to Switch A -> Switch B -> Switch D -> Switch
E. At the early stage of the path switchover, there is a high probability that the
status of the neighbor relationship between Switch B and Switch C flaps
frequently, leading to frequent switchovers of forwarding paths. Each switchover
triggered by faults causes traffic loss. The network stability is affected. In this
scenario, if the devices are configured with flapping suppression, flapping
suppression takes effect when the suppression conditions are met.
● If flapping suppression works in Hold-down mode, the neighbor relationship
between Switch B and Switch C is prevented from being reestablished within
the suppression period so that the traffic is forwarded along the path Switch
A -> Switch B -> Switch D -> Switch E.
● If flapping suppression works in Hold-max-cost mode, 65535 is used as the
cost of the link between Switch B and Switch C within the suppression period
so that the traffic is forwarded along the path Switch A -> Switch B -> Switch
D -> Switch E.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 227
Figure 5-44 Flapping suppression in a basic scenario
Single-forwarding path scenario
If only one forwarding path exists on the network, the neighbor relationship
flapping between any two devices on the path will interrupt traffic forwarding. In
Figure 5-45, the only traffic forwarding path is Switch A -> Switch B -> Switch C -
> Switch E. If the neighbor relationship between Switch B and Switch C flaps and
the flapping meets the suppression conditions, flapping suppression takes effect.
However, if the neighbor relationship between Switch B and Switch C is prevented
from being reestablished, the whole network will be divided. Therefore, the Hold-
max-cost mode (rather than the Hold-down mode) is recommended. If flapping
suppression works in Hold-max-cost mode, 65535 is used as the cost of the link
between Switch B and Switch C within the suppression period. After the network
stabilizes and the suppression timer expires, the link is restored.
NOTE
By default, the Hold-max-cost mode takes effect.
Figure 5-45 Flapping suppression in a single-forwarding path scenario
Broadcast scenario
In Figure 5-46, four devices are deployed on the same broadcast network using
switches, and the devices are broadcast network neighbors. If Switch C flaps due
to a link failure and Switch A and Switch B were deployed at different time
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 228
(Switch A was deployed earlier for example) or the flapping suppression
parameters on Switch A are different from those on Switch B, Switch A first
detects the flapping and suppresses Switch C. Consequently, the Hello packets sent
by Switch A do not carry the Switch ID of Switch C. However, Switch B has not
detected the flapping yet and still considers Switch C as a valid node. As a result,
the DR candidates identified by Switch A are Switch B and Switch D, whereas the
DR candidates identified by Switch B are Switch A, Switch C, and Switch D.
Different DR candidates result in a different DR election result, which may lead to
route calculation errors. To prevent this problem in scenarios where an interface
has multiple neighbors, such as on a broadcast, P2MP, or NBMA network, all
neighbors on the interface are suppressed when the status of a neighbor
relationship last changes to ExStart or Down. Specifically, if Switch C flaps, Switch
A, Switch B, and Switch D on the same broadcast network as Switch C are all
suppressed. After the network stabilizes and the suppression timer expires, Switch
A, Switch B, and Switch D are restored to normal status.
Figure 5-46 Flapping suppression on a broadcast network
Multi-area scenario
In Figure 5-47, Switch A, Switch B, Switch C, Switch E, and Switch F are connected
in area 1, and Switch B, Switch D, and Switch E are connected in backbone area 0.
Traffic from Switch A to Switch F is preferentially forwarded along intra-area
routes, and therefore the forwarding path is Switch A -> Switch B -> Switch C ->
Switch E -> Switch F. When the neighbor relationship between Switch B and
Switch C flaps and the flapping meets suppression conditions, flapping suppression
takes effect in the default mode of Hold-max-cost. Consequently, 65535 is used as
the cost of the link between Switch B and Switch C. However, the forwarding path
remains unchanged because intra-area routes take precedence over inter-area
routes during route selection according to OSPF route selection rules. Therefore,
the Hold-down mode must be used in this scenario to prevent the neighbor
relationship between Switch B and Switch C from being reestablished within the
suppression period. During this period, traffic is forwarded along the path Switch A
-> Switch B -> Switch D -> Switch E -> Switch F.
NOTE
By default, the Hold-max-cost mode takes effect. You can manually configure command
lines to change the mode to Hold-down.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 229
Figure 5-47 Flapping suppression in a multi-area scenario
Scenario with both LDP-IGP synchronization and OSPF neighbor relationship
flapping suppression configured
In Figure 5-48, if the link between PE1 and P1 fails, an LDP LSP switchover is
implemented immediately, causing the original LDP LSP to be deleted before a
new LDP LSP is established. To prevent traffic loss, LDP-IGP synchronization needs
to be configured. With LDP-IGP synchronization configured, 65535 is used as the
cost of the new LSP to be established. After the new LSP is established, the
original cost takes effect. Then, the original LSP is deleted, and LDP traffic is
forwarded along the new LSP.
Both LDP-IGP synchronization and OSPF neighbor relationship flapping
suppression work in either Hold-down or Hold-max-cost mode. If both functions
are configured, the Hold-down mode takes precedence over the Hold-max-cost
mode, followed by the configured link cost. Table 5-13 lists the suppression modes
that take effect in different situations.
Table 5-13 Principles for selecting suppression modes in different situations
LDP-IGP
Synchronization/
OSPF Neighbor
Relationship
Flapping
Suppression
Mode
Hold-down Mode
of LDP-IGP
Synchronization
Hold-max-cost
Mode of LDP-IGP
Synchronization
Exiting LDP-IGP
Synchronization
Suppression
Hold-down mode
of OSPF neighbor
relationship
flapping
suppression
Hold-down Hold-down Hold-down
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 230
LDP-IGP
Synchronization/
OSPF Neighbor
Relationship
Flapping
Suppression
Mode
Hold-down Mode
of LDP-IGP
Synchronization
Hold-max-cost
Mode of LDP-IGP
Synchronization
Exiting LDP-IGP
Synchronization
Suppression
Hold-max-cost
mode of OSPF
neighbor
relationship
flapping
suppression
Hold-down Hold-max-cost Hold-max-cost
Exiting OSPF
Neighbor
Relationship
Flapping
Suppression
Hold-down Hold-max-cost Exiting LDP-IGP
synchronization
and OSPF
neighbor
relationship
flapping
suppression
For example, the link between PE1 and P1 frequently flaps, as shown in Figure
5-48, and both LDP-IGP synchronization and OSPF neighbor relationship flapping
suppression are configured. In this case, the suppression mode is selected based on
the above principles. No matter which mode (Hold-down or Hold-max-cost) is
selected, the forwarding path is switched to PE1 -> P4 -> P3 -> PE2.
Figure 5-48 Scenario with both LDP-IGP synchronization and OSPF neighbor
relationship flapping suppression configured
Scenario with both bit-error-triggered protection switching and OSPF
neighbor relationship flapping suppression configured
If a link has a poor link quality, services transmitted along it may be adversely
affected. If bit-error-triggered protection switching is configured and the bit error
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 231
rate (BER) along a link exceeds a specified value, a bit error event is reported, and
65535 is used as the cost of the link, triggering route reselection. Consequently,
service traffic is switched to the backup link. If both bit-error-triggered protection
switching and OSPF neighbor relationship flapping suppression are configured,
they both take effect. The Hold-down mode takes precedence over the Hold-max-
cost mode, followed by the configured link cost.
5.2.2.6 OSPF Smart-Discover
Definition
Routers periodically send Hello packets through OSPF interfaces at the Hello
interval specified in the Hello timer. This fixed interval slows down the
establishment of OSPF neighbor relationships.
Enabling smart-discover can speed up establishment of OSPF neighbor
relationships in certain scenarios.
Table 5-14 OSPF smart-discover
Scenario Processing
Smart-discover is not
configured.
● Hello packets are sent only when the Hello
timer expires.
● Devices wait to receive Hello packets within
the Hello interval to establish neighbor
relationships.
Smart-discover is configured. ● Hello packets are sent directly regardless of
whether the Hello timer has expired.
● Devices receive packets without delay and
can immediately transmit their status to
establish neighbor relationships.
Principle
In the following scenarios, an interface with smart-discover enabled can send
Hello packets to target devices without waiting for the expiration of the Hello
timer:
● The neighbor status becomes 2-way for the first time.
● The neighbor status changes from 2-way or a higher state to Init.
5.2.2.7 OSPF Database Overflow
Definition
OSPF requires that routers in the same area have the same LSDB.
If the number of routes on a network increases, routers may fail to carry so much
routing information due to limited system resources. This is known as an OSPF
database overflow.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 232
Purpose
Configuring stub areas or NSSAs partially addresses database overflows. However,
stub areas or NSSAs fail to resolve the problem of an unexpected increase in
dynamic routes. To dynamically limit the LSDB capacity and thereby prevent
database overflows, you can set the maximum number of external LSAs allowed in
the LSDB.
Implementation
Setting the maximum number of non-default external routes on a router can
prevent database overflows.
All routers on an OSPF network must be configured with the same upper limit. If
the number of external routes on a router reaches the upper limit, the router
enters the overflow state and starts an overflow timer. The router automatically
exits the overflow state after the timer expires. By default, the timer value is 5
seconds.
Table 5-15 OSPF database overflow phases
Overflow Phase OSPF Processing
Entering the overflow
state
A router deletes all non-default external routes
generated by itself.
Staying in the overflow
state
● The router does not generate non-default
external routes.
● The router discards the newly received non-
default external routes, and does not reply with
LSAck packets.
● When the overflow timer expires, the router
checks whether the number of external routes
still exceeds the upper limit and performs the
following operations accordingly:
– If the number of external routes still exceeds
the upper limit, the router restarts the timer.
– If the number of external routes is less than
the upper limit, the router exits the overflow
state.
Exiting the overflow state ● The router resets the overflow timer.
● The router generates non-default routes.
● The router learns the newly received non-default
external routes, and replies with LSAck packets.
● The router prepares to enter the overflow state
in case of future occurrences.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 233
5.2.2.8 OSPF Mesh-Group
Definition
In scenarios with multiple concurrent links, you can deploy OSPF mesh-group to
classify links into a mesh group. This allows OSPF to flood LSAs to only one link
selected from the mesh group. OSPF mesh-group prevents repetitive flooding that
burdens the system.
The mesh-group feature is disabled by default.
Purpose
After receiving or generating an LSA, an OSPF process floods the LSA. If there are
multiple concurrent links, OSPF floods the LSA to each link and sends Update
messages. Flooding more than one LSA is unnecessary as only one is valid.
To prevent this unnecessary burden on the system, you can enable mesh-group to
classify multiple concurrent links between a router and its neighbor into a group
and then select a primary link for flooding.
Implementation
As shown in Figure 5-49, Router A and Router B are connected through three links
and establish an OSPF neighbor relationship. After receiving a new LSA from
interface 4, Router A floods the LSA to Router B through interfaces 1, 2, and 3.
This flooding causes an unnecessary load on the concurrent links.
Figure 5-49 LSA flooding with OSPF mesh-group disabled
If there are multiple concurrent links between a device with OSPF mesh-group
enabled and its neighbor, the device floods received LSAs only to the primary link,
as shown in Figure 5-50.
Figure 5-50 LSA flooding with OSPF mesh-group enabled
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 234
As defined in OSPF, LSAs can be flooded to a link only when the neighbor status
reaches Exchange or a higher state. When the status of the interface on the
primary link is lower than Exchange, OSPF reselects a primary link from
concurrent links for flooding LSAs. After receiving LSAs flooded by Router A
through link 1, Router B no longer floods the LSAs to Router A through link 2 and
link 3.
The Router ID of a neighbor uniquely identifies a mesh group. Interfaces
connected to the same neighbor with status higher than Exchange belong to the
same mesh group.
In Figure 5-51, a mesh group of Router A resides in Area 0, which contains the
links of interface 1 and interface 2. More than one neighbor of interface 3 resides
on the broadcast link. Therefore, interface 3 cannot be added to the mesh group.
Figure 5-51 Scenario where an interface cannot be added to a mesh group
NOTE
If a router with OSPF mesh-group enabled has the same router ID as its directly connected
neighbor, LSDBs cannot be synchronized and routes cannot be calculated correctly. In such
a scenario, you need to reconfigure the router ID of the neighbor. (The configuration with
the same router ID for two different devices is a configuration error.)
5.2.3 Association Between OSPF and Other Protocols
BFD for OSPF
Bidirectional Forwarding Detection (BFD) is a mechanism for detecting
communication faults between forwarding engines.
BFD detects the connectivity of a data protocol along a path between two
systems. Such a path can be a physical link, a logical link, or a tunnel.
BFD for OSPF allows BFD sessions to be associated with OSPF. If a BFD session
detects a link fault, it notifies OSPF of the fault, allowing OSPF to quickly respond
to the change in the network topology.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 235
Devices recalculate routes in the event of a link fault or a topology change.
Network performance is improved if the route convergence process of routing
protocols is completed faster.
As link faults are inevitable, rapidly detecting these faults and notifying routing
protocols is an effective way to quickly resolve such issues. BFD for OSPF speeds
up OSPF convergence if a fault occurs on the link between neighbors.
Table 5-16 Comparison before and after BFD for OSPF is enabled
BFD
Association
Link Fault Detection Condition Convergence
Speed
Disabled The OSPF dead timer expires. (The
default timeout interval is 40 seconds.)
Measured in
seconds
Enabled A BFD session goes Down. Measured in
milliseconds
Figure 5-52 shows the process of BFD for OSPF.
Figure 5-52 BFD for OSPF
1. OSPF neighbor relationships are established between SwitchA, SwitchB, and
SwitchC.
2. When the neighbor relationships enter the Full state, BFD is instructed to set
up a BFD session.
3. The outbound interface of the route from SwitchA to SwitchB is GE0/0/2. If
the link between SwitchA and SwitchB fails, BFD detects the fault and then
notifies SwitchA of the fault.
4. SwitchA processes the neighbor Down event, and recalculates routes.
Following recalculation, the outbound interface of the route from SwitchA to
SwitchB becomes GE0/0/1, with the route to SwitchB traversing SwitchC.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 236
OSPF-BGP Association
A device restart, or even a new device itself, may cause the loss of network traffic
during BGP route convergence. This happens because OSPF converges faster than
BGP.
The solution to this problem is association between OSPF and BGP.
If there is a backup link, BGP traffic is lost during traffic switchback because BGP
route convergence is slower than OSPF route convergence.
In Figure 5-53, SwitchA, SwitchB, SwitchC, and SwitchD are running OSPF and
have established IBGP connections. SwitchC functions as the backup of SwitchB.
When the network is stable, BGP and OSPF routes converge completely on the
devices.
Traffic from SwitchA to 10.3.1.0/30 normally passes through SwitchB. If SwitchB
becomes faulty, traffic is switched to SwitchC. After SwitchB recovers, traffic is
switched back to SwitchB.
During the switchback process, some packets are lost because OSPF route
convergence is faster than BGP route convergence. This means that the
convergence of OSPF routes is already complete while BGP routes are still
converging. As a result, SwitchB fails to learn the route to 10.3.1.0/30.
In this case, upon receipt of packets from SwitchA to 10.3.1.0/30, SwitchB discards
these packets.
Figure 5-53 OSPF-BGP association
A device with OSPF-BGP association enabled remains as a stub router in the
configured association period. The link metric in the LSAs advertised by the device
is set to the maximum value of 65535. In this way, the device instructs other OSPF
devices not to use it for data forwarding.
In Figure 5-53, OSPF-BGP association is enabled on SwitchB. SwitchA forwards
traffic to the backup device SwitchC before BGP route convergence on SwitchB is
complete.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 237
OSPF-LDP Association
On networks that use primary and backup links, OSPF-LDP association ensures
that, when a faulty primary link recovers, traffic interruptions are minimized.
As shown in Figure 5-54, the primary link travels along the path
PE1→P1→P2→P3→PE2, and the backup link travels along the path
PE1→P1→P4→P3→PE2.
If the primary link is faulty, traffic is switched to the backup link. When the
primary link recovers, traffic is switched back to the primary link, during which
traffic is interrupted for an extended period of time.
Figure 5-54 OSPF-LDP association
Synchronizing LDP and OSPF (IGP) on P1 and P2 can shorten the duration of
traffic interruption caused by traffic switchback to the primary link from seconds
to milliseconds.
Table 5-17 OSPF-LDP association
OSPF-LDP Association Traffic Interruption Time
Disabled Measured in seconds
Enabled Measured in milliseconds
OSPF-LDP association delays route switchback by suppressing the establishment
of OSPF neighbor relationships until LDP convergence is complete. Before an LSP
is established on the primary link, the backup link continues to forward traffic. The
backup link is then deleted following the LSP establishment on the primary link.
OSPF-LDP association involves three timers:
● Hold-down
● Hold-max-cost
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 238
● Delay
When the primary link recovers, a router responds as follows:
1. Starts the Hold-down timer. The OSPF interface does not establish OSPF
neighbor relationships but waits for the establishment of an LDP session. The
hold-down timer specifies the period that the OSPF interface waits.
2. Starts the Hold-max-cost timer after the Hold-down timer expires. The Hold-
max-cost timer specifies the interval for advertising the maximum link metric
of the interface in LSAs to the primary link.
3. Starts the Delay timer to wait for the establishment of an LSP after an LDP
session is re-established on the primary link.
4. Enables LDP to notify OSPF that synchronization is complete regardless of the
OSPF status after the Delay timer expires.
5.3 Application Scenarios for OSPF
5.3.1 OSPF GR
In Figure 5-55, RouterA, RouterB, RouterC, and RouterD run OSPF for
interworking, and RouterA and RouterB have GR enabled. When RouterA restarts,
RouterB helps RouterA perform GR, without notifying other neighbors of RouterA.
OSPF GR ensures service continuity.
Figure 5-55 OSPF GR
5.3.2 OSPF GTSM
In Figure 5-56, OSPF runs between routers, and GTSM is enabled on RouterC. The
valid TTL ranges of the packets sent from routers to RouterC are as follows:
● For RouterA and RouterE (which are neighbors of RouterC): (255 – hops + 1)
to 255.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 239
● For RouterB, RouterD, and RouterF: 254 to 255, 253 to 255, and 252 to 255,
respectively.
Figure 5-56 OSPF GTSM
5.4 OSPF Deployment Guide
5.4.1 OSPF Network Planning and Design
OSPF Network Stability: Router ID Design
Router ID selection is the first task in OSPF network design and implementation.
As a link-state routing protocol, OSPF calculates routes based on LSAs. All OSPF
routers on an OSPF network send and flood LSAs to the entire network. In this
way, each OSPF router on the network collects LSAs received from other routers,
saves the LSAs in its LSDB, and uses an SPF algorithm to calculate an SPT to other
networks with itself as the root. Therefore, ensuring the stability of the LSDB on
each OSPF router is a prerequisite for ensuring the stability of the OSPF network.
In an LSDB, LSAs received from different OSPF routers are distinguished by router
ID. If the router ID of a router changes, the router floods its LSAs again. As a
result, all the other OSPF routers on the network update their LSDBs and perform
SPF calculation again, leading to OSPF network flapping. Therefore, selecting
stable router IDs is the first task in OSPF network design.
Router IDs can be configured manually. If no router ID is specified for a router, the
system automatically selects an interface IP address as the router's router ID. The
router ID selection rules are as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 240
1. The router preferentially selects the largest IP address among loopback
interface addresses as the router ID.
2. If no loopback interface is configured, the router selects the largest IP address
among interface addresses as the router ID.
3. The router reselects a router ID only when the interface address used as the
router ID is deleted or changed.
On actual networks, it is recommended that router IDs of OSPF routers be
specified manually. First, plan a private network segment such as 192.168.1.0/24
for router ID selection. Before starting the OSPF process, create a loopback
interface on each OSPF router, and use a private IP address with a 32-bit mask as
the IP address of the loopback interface. The private IP address is then used as the
router's router ID. If there is no special requirement, the address of this loopback
interface does not need to be advertised to the OSPF network.
Hierarchical Network Design: OSPF Area Design
OSPF is a network protocol that requires hierarchical design. The concept of area
is used on an OSPF network. From a hierarchical perspective, areas on an OSPF
network are classified into backbone and non-backbone areas. The ID of the
backbone area is 0 and that of a non-backbone area is in the range 1 to
4294967295. An OSPF router on the border between the backbone area and a
non-backbone area is called ABR.
Actually, OSPF area design is the process of classifying OSPF routers on the
network. The first consideration in OSPF area design is the network scale. You can
only plan the backbone area for small networks such as a network with several
routers as the core and aggregation devices. However, hierarchical network design
is required on large OSPF networks.
For large OSPF networks, the core, aggregation, and access layers must be
planned in OSPF area design. In addition, OSPF backbone routers are generally
egress routers and core switches. These devices are typically high-end routing
devices such as Huawei NE series high-end routers and Huawei S series modular
switches. Non-backbone area design depends on the geographical locations and
device performance. If many low-end Layer 3 switching devices with product
positioning and performance limitations are deployed in a non-backbone area, the
number of routes should be minimized using small-sized areas or special areas.
The IDs of non-backbone areas on an actual network should not be planned
randomly. Consecutive IDs such as 1, 2, and 3 are not recommended. It is
recommended that IDs in ascending order such as 10, 20, and 30 be used,
facilitating area ID addition in future network capacity expansion.
Routing Entry Optimization for Non-Backbone Areas: Special Areas
Using special areas can optimize routing entries on routers in non-backbone areas.
Generally, the number of routing entries on routers in a non-backbone area needs
to be reduced in the following scenarios:
● The non-backbone area has only one ABR as the egress router and all traffic
for accessing external areas needs to pass through this egress router. In this
case, non-ABR routers in this non-backbone area do not need to obtain
detailed information about external areas, and only an egress is required to
send traffic outside this area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 241
● Low-end Layer 3 switches are deployed in the non-backbone area and their
routing tables cannot contain too many routing entries due to performance
limitations. Special areas can be configured to reduce the number of routing
entries on the devices.
Switches support four types of special areas defined in OSPF: stub area, totally
stub area, NSSA, and totally NSSA.
In most cases, routers in non-backbone areas on a typical OSPF network only need
to know the outbound interface of the default route. Therefore, it is recommended
that non-backbone areas be planned as totally NSSAs. This can significantly
reduce the number of routing entries on internal routers in the non-backbone
areas and the number of OSPF packets to be exchanged among these routers. For
some networks with special requirements, the four types of special areas can be
used flexibly based on actual requirements.
Routing Entry Optimization for the Backbone Area: IP Subnetting and Route
Summarization in Non-Backbone Areas
Because routers in the backbone area are responsible for route exchange among
areas, these routers have large routing tables. You can properly plan IP subnets for
non-backbone areas and summarize routes on the routers residing on area
borders to optimize routing entries on routers in the backbone area.
It is recommended that an IP network facilitating route summarization be used as
a new OSPF network, and that IP addresses be planned again for expanded OSPF
networks. Route summarization can reduce the number of routing entries in the
routing tables of routers in the backbone area and the number of OSPF packets to
be exchanged among these routers. After routes are summarized, a single-point
link failure or network flapping will not affect route update on the entire network.
Therefore, route summarization also improves the network stability.
Uplink Traffic Diversion: Default OSPF Route Import and Route Selection
Optimization
Most service traffic on a large OSPF network is not transmitted inside the
network, but is forwarded to the Internet egress. Therefore, default route design is
a key design point for an OSPF network.
An actual OSPF network may have more than one egress. Configuring multiple
links to load balance egress traffic is a difficult task in OSPF network design.
Although there are many load balancing methods, the most simple and secure
method is to use the internal route selection mechanism of OSPF. An OSPF router
determines whether a route is optimal by calculating its cost, and preferentially
adds a route with a smaller cost to its routing table. Therefore, you can adjust the
costs of OSPF interfaces to make a router select different outbound interfaces for
load balancing.
OSPFv2 was developed earlier and rapid bandwidth development was not
considered at that time. By default, the reference bandwidth for OSPF cost
calculation is 100 Mbit/s. Therefore, by default, OSPF considers that the cost of an
interface with bandwidth greater than 100 Mbit/s is 1. The reference bandwidth is
outdated because the network backbone bandwidth develops towards 10 Tbit/s.
Switches provide the function of changing the reference bandwidth. In OSPF
network construction, you can run the bandwidth-reference command to
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 242
configure a proper reference bandwidth. In summary, to optimize route selection
on an OSPF network, you are advised to select a proper reference bandwidth to
adjust the costs of OSPF interfaces.
Loop Prevention in Route Summarization Scenarios: Blackhole Route
Route summarization can reduce the number of routes and improve the network
stability in many scenarios. However, routing loops may occur in route
summarization. Blackhole routes can solve this problem. A router discards packets
that match a blackhole route, and does not send any error information to the
packet sender. Therefore, route summarization and blackhole routes are often
used together in OSPF network design.
OSPF Network Security: Silent Interface
Security must be the first consideration for large OSPF networks. In OSPF network
design, OSPF packets are often prohibited from being sent to users, preventing
end users from obtaining OSPF packet information. If a user can intercept OSPF
packets, the user will know how to connect to the OSPF network, making the
OSPF network prone to attacks or damages. For example, if the user connects a
router to the OSPF network and makes the router's OSPF process unstable, the
OSPF network will flap or even break down.
To ensure security and stability of an OSPF network, it is recommended that silent
interfaces be configured on edge devices of the OSPF network to prevent OSPF
packets from being sent to users. These silent interfaces are prohibited from
receiving and sending OSPF packets. These interfaces can still advertise direct
routes, but cannot establish neighbor relationships because Hello packets are
blocked on the interfaces.
5.4.2 OSPF Network Design Deployment Case
Figure 5-57 shows a typical campus network topology. This is a large campus
network with the core, aggregation, and access layers and multiple egresses to the
Internet. On this network, dual-link redundancy and cluster protection among core
and aggregation switches have been deployed. Typically, on such a large campus
network, Huawei NE series high-end routers are deployed as egress devices, and
Huawei campus cluster-supporting modular switches are deployed as core and
aggregation switches. User gateways are deployed on the aggregation layer, and
aggregation switches are the boundary between Layer 2 and Layer 3 networks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 243
Figure 5-57 Typical campus network topology
Core and aggregation switches on the typical campus network are deployed in
clusters, and one cluster functions as a single logical device. Multiple links are
bundled together to form a single logical link. The above network topology is
simplified into a logical topology, as shown in Figure 5-58. There may be multiple
buildings in a campus network, and the following example uses three buildings.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 244
Figure 5-58 Logical topology of a typical campus network
OSPF Network Stability: Router ID Design
The primary task of deploying OSPF is to design and deploy router IDs. In most
situations, an appropriate private IP address segment can be used to design router
IDs. This example uses IP addresses on the IP address segment 10.0.0.0/24 as
router IDs.
After router IDs are designed, you need to create loopback interfaces on each
OSPF device and configure an IP address 10.0.0.X/32 for each loopback interface.
The following configures router IDs for a core modular switch cluster:
[HUAWEI] interface LoopBack 0
[HUAWEI-LoopBack0] ip address 10.0.0.3 32 //Configure an IP address with a 32-bit mask for LoopBack0.
[HUAWEI-LoopBack0] quit
[HUAWEI] ospf 1 router-id 10.0.0.3 //Create OSPF process 1 and set the router ID to 10.0.0.3.
NOTE
If there are no special requirements, advertisement of the IP address of Loopback0 into
OSPF processes is not recommended because the advertisement is unnecessary.
Figure 5-59 shows the network topology with router IDs designed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 245
Figure 5-59 Network topology with router IDs designed
Hierarchical Network Design: OSPF Area Design
After router IDs are assigned to routers, you need to partition the OSPF network.
To obtain a hierarchical OSPF network, you can deploy egress routers and core
switches in Area 0 and design non-backbone areas based on geographical
locations. When designing area IDs for non-backbone areas, you need to ensure
that new areas are easy to add for network expansion. Based on geographical
locations involved in this case, egress routers and core switches are deployed in
the backbone area and the aggregation switches in each building are deployed in
a non-backbone area respectively. Figure 5-60 shows the OSPF network topology
after area partitioning.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 246
Figure 5-60 OSPF network topology after area partitioning
The following configures Area 0 and Area 10 for the core switch cluster:
[HUAWEI] ospf 1 //Enter the OSPF process view.
[HUAWEI-ospf-1] area 0 //Enter the view of Area 0.
[HUAWEI-ospf-1-area-0.0.0.0] network 10.200.10.0 0.0.0.3 //Advertise the network segment where the
uplink interface resides to Area 0.
[HUAWEI-ospf-1-area-0.0.0.0] network 10.200.20.0 0.0.0.3 //Advertise the network segment where the
uplink interface resides to Area 0.
[HUAWEI-ospf-1-area-0.0.0.0] quit
[HUAWEI-ospf-1] area 10 //Enter the view of Area 10.
[HUAWEI-ospf-1-area-0.0.0.10] network 10.100.10.0 0.0.0.3 //Advertise the network segment where the
downlink interface resides to Area 10.
[HUAWEI-ospf-1-area-0.0.0.10] quit
The preceding configuration commands show that an OSPF device is located on
the border between OSPF areas. The uplink and downlink interfaces of the core
switch cluster in the topology belong to Area 0 and Area 10 respectively. That is,
this cluster functions as an ABR.
NOTE
It is a bad design to deploy many low-end routers or Layer 3 switches in a single OSPF area,
and it is better to reduce the number of devices in a single OSPF area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 247
Routing Entry Optimization for Non-Backbone Areas: Special Areas
After the OSPF network is partitioned into multiple areas, you may find that the
routing table size of devices in non-backbone areas is large. If devices in non-
backbone areas have low performance and are expected not to maintain a large
routing table, you can use special areas to reduce the number of routing entries in
the table. Figure 5-61 shows the network topology with all non-backbone areas
configured as totally NSSAs.
Figure 5-61 Network topology with non-backbone areas configured as totally
NSSAs
The following provides an example of configuring totally NSSAs by configuring a
core switch cluster and an aggregation switch cluster in Area 10.
The configuration of the core switch cluster is as follows:
[HUAWEI] ospf 1 //Enter the OSPF process view.
[HUAWEI-ospf-1] area 10 //Enter the view of Area 10.
[HUAWEI-ospf-1-area-0.0.0.10] nssa no-summary //Configure nssa no-summary for the ABR.
[HUAWEI-ospf-1-area-0.0.0.10] quit
The configuration of the aggregation switch cluster is as follows:
[HUAWEI] ospf 1 //Enter the OSPF process view.
[HUAWEI-ospf-1] area 10 //Enter the view of Area 10.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 248
[HUAWEI-ospf-1-area-0.0.0.10] nssa //Configure nssa for the non-ABR.
[HUAWEI-ospf-1-area-0.0.0.10] quit
Before a totally NSSA is configured, routing entries from the aggregation switch
cluster to non-backbone areas are as follows:
<HUAWEI> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 21 Routes : 21
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.0.0.4/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.1.0/24 Direct 0 0 D 10.10.1.1 Vlanif100
10.10.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif100
10.10.2.0/24 Direct 0 0 D 10.10.2.1 Vlanif200
10.10.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif200
10.10.3.0/24 Direct 0 0 D 10.10.3.1 Vlanif300
10.10.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif300
10.20.1.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.20.2.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.20.3.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.30.1.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.30.2.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.30.3.0/24 OSPF 10 3 D 10.100.10.1 Vlanif10
10.100.10.0/30 Direct 0 0 D 10.100.10.2 Vlanif10
10.100.10.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.100.20.0/30 OSPF 10 2 D 10.100.10.1 Vlanif10
10.100.30.0/30 OSPF 10 2 D 10.100.10.1 Vlanif10
10.200.10.0/30 OSPF 10 2 D 10.100.10.1 Vlanif10
10.200.20.0/30 OSPF 10 2 D 10.100.10.1 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
After a totally NSSA is configured, routing entries from the aggregation switch
cluster to non-backbone areas are as follows:
<HUAWEI> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 12 Routes : 12
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 OSPF 10 2 D 10.100.10.1 Vlanif10
10.0.0.4/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.1.0/24 Direct 0 0 D 10.10.1.1 Vlanif100
10.10.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif100
10.10.2.0/24 Direct 0 0 D 10.10.2.1 Vlanif200
10.10.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif200
10.10.3.0/24 Direct 0 0 D 10.10.3.1 Vlanif300
10.10.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif300
10.100.10.0/30 Direct 0 0 D 10.100.10.2 Vlanif10
10.100.10.2/32 Direct 0 0 D 127.0.0.1 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
The preceding outputs show that the IP routing table size of Area 10 is reduced
significantly after a totally NSSA is configured. This indicates that configuring a
non-backbone area as a totally NSSA can reduce the routing table size.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 249
Routing Entry Optimization for the Backbone Area: IP Subnetting and Route
Summarization in Non-Backbone Areas
After non-backbone areas are configured as totally NSSAs, the routing table size
of routers in non-backbone areas are reduced significantly and the amount of
information to be exchanged between these routers is also reduced. Reduced
routing table size and information exchange are also required in the backbone
area. To implement this requirement, you need to use IP subnetting and perform
route summarization on ABRs in non-backbone areas.
Figure 5-62 shows summarized routes advertised from Area 10 to Area 0 after IP
subnetting is performed.
Figure 5-62 Using route summarization to optimize routing entries in the
backbone area
Route summarization will prevent specific routes from being advertised. The ABR
in Area 10 advertises only one summarized route 10.10.0.0/16 into Area 0,
reducing the routing entries on the backbone routers and number of OSPF packets
to be exchanged with Area 0 and ensuring the routing table stability. Proper IP
addressing facilitating route summarization is recommended during OSPF network
design.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 250
The following configures route summarization on the ABR (core switch cluster) in
Area 10:
[HUAWEI] ospf 1 //Enter the OSPF process view.
[HUAWEI-ospf-1] area 10 //Enter the view of Area 10.
[HUAWEI-ospf-1-area-0.0.0.10] abr-summary 10.10.0.0 255.255.0.0 //Summarize routes on the ABR.
[HUAWEI-ospf-1-area-0.0.0.10] quit
NOTE
The abr-summary command can be configured only on an ABR. Do not configure this
command on non-ABRs in an area. Otherwise, incorrect routing entries will be generated.
Before routes are summarized, the IP routing table of NE40E-1 is as follows:
<NE40E-1> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 12 Routes : 12
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.0.0.1/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.1.0/24 OSPF 10 3 D 10.200.10.2 GigabitEthernet0/0/1
10.10.2.0/24 OSPF 10 3 D 10.200.10.2 GigabitEthernet0/0/1
10.10.3.0/24 OSPF 10 3 D 10.200.10.2 GigabitEthernet0/0/1
After routes are summarized, the IP routing table of NE40E-1 is as follows:
<NE40E-1> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 12 Routes : 12
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.0.0.1/32 Direct 0 0 D 127.0.0.1 LoopBack0
10.10.0.0/16 OSPF 10 3 D 10.200.10.2 GigabitEthernet0/0/1
The preceding outputs show that NE40E-1 in the backbone area has specific
routes to users' network segments before routes are summarized. After route
summarization is configured on the ABR, NE40E-1 has only one summarized route
with a 16-bit mask to users' network segments. If there are many user network
segments, route summarization can significantly reduce routing entries in the
backbone areas, decrease the number of LSAs to be exchanged between the
backbone and non-backbone areas, and therefore improve the network stability.
Uplink Traffic Diversion: Default OSPF Route Import and Route Selection
Optimization
Most traffic of a campus network is destined for the Internet. Therefore, on a
campus network with multiple egresses, you must consider importing default
routes and load balancing traffic among these egresses.
Multiple methods are available to import default routes. The recommended
method is to configure non-forcible delivery of default routes on an ASBR. Non-
forcible delivery of default routes indicates that a default route can be advertised
only when it exists in the IP routing table of this ASBR. This prevents loops and
suboptimal routes in special scenarios.
In Figure 5-63, after two ASBRs advertise default routes, the core switch cluster
receives two default routes with their next hops pointing to two egress routers
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 251
respectively. The core switch cluster can choose one link as the uplink or two
uplinks for load balancing. You can flexibly configure traffic direction based on
network requirements.
Figure 5-63 Using default routes for uplink traffic direction on the core switch
cluster
The following configures non-forcible delivery of default routes on NE40E-1 (the
configuration of NE40E-2 is similar to that of NE40E-1):
[NE40E-1] ip route-static 0.0.0.0 0.0.0.0 1.1.1.1 //On NE40E-1, configure a default route with the next
hop pointing to the public address of the telecom carrier.
[NE40E-1] ospf 1 //Enter the OSPF process view.
[NE40E-1-ospf-1] default-route-advertise //Advertise the default route without specifying the always
parameter. That is, the default route is delivered non-forcibly.
After the preceding configurations are complete, the core switch cluster learns two
equal-cost default routes. Uplink traffic of the core switch cluster will be
forwarded in load balancing mode.
<HUAWEI> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 23 Routes : 24
Destination/Mask Proto Pre Cost Flags NextHop Interface
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 252
0.0.0.0/0 O_ASE 150 1 D 10.200.10.1 Vlanif40
O_ASE 150 1 D 10.200.20.1 Vlanif50
......
If you want two uplinks of the core switch cluster to work in active/standby mode,
the simplest method is to change their OSPF costs.
To implement route backup, you can change the OSPF cost of the link from the
core switch cluster to NE40-2 to be higher than that of the link from the cluster to
NE40-1. In this way, uplink traffic is preferentially sent to NE40E-1. If NE40E-1 is
faulty, the traffic is automatically switched to NE40E-2.
Configure the core switch cluster.
[HUAWEI] interface vlanif 50 //Enter the OSPF interface view.
[HUAWEI-Vlanif50] ospf cost 10 //Change the OSPF cost of this interface to 10.
Configure NE40E-2.
[NE40E-2] interface gigabitethernet 0/0/1 //Enter the OSPF interface view.
[NE40E-2-GigabitEthernet0/0/1] ospf cost 10 //Change the OSPF cost of this interface to 10.
NOTE
To adjust the cost of a link to affect OSPF route selection, you need to adjust the cost on
the devices on both ends of the link. Otherwise, asymmetric routing occurs, which causes
network faults.
The default OSPF cost of links providing more than 100 Mbit/s bandwidth is 1.
After the OSPF cost of the link from the core switch cluster to NE40-2 is changed
to 10, the cluster transmits its uplink traffic preferentially to NE40-1, and the IP
routing table of the cluster has only one default route pointing to NE40E-1.
<HUAWEI> display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 23 Routes : 23
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 O_ASE 150 1 D 10.200.10.1 Vlanif40
......
Loop Prevention in Route Summarization Scenarios: Blackhole Route
After the preceding design and deployment, this campus network has basic OSPF
functions and routing entries have been optimized. However, this network has the
risk of loops due to route summarization.
It is common that a campus network is under internal network attacks. Assume
that a host in Building 1 is attacked by viruses, which will make the host access all
IP addresses on the network segment 10.0.0.0. In this situation, a loop may easily
occur.
If the host accesses the IP address 10.10.50.1 (this address does not exist in
Building 1), a routing loop occurs:
1. When the host sends a packet, the packet is sent to its gateway, namely,
aggregation switch cluster 1 in Building 1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 253
2. Aggregation switch cluster 1 does not have specific routes to the destination
address of this packet, and therefore it sends this packet to the core switch
cluster through a default route.
3. The IP address 10.10.50.1 does not exist on the entire campus network.
Therefore, after the packet reaches the core switch cluster, it matches only a
default route and then is sent to NE40E-1.
4. The route learned by NE40E-1 is summarized and then advertised by the core
switch cluster, so the packet matches the route 10.10.0.0/16 and is sent back
to the core switch cluster.
A routing loop occurs between the core switch cluster and NE40E-1, as shown in
Figure 5-64. This loop will seriously affect network operation and even cause
network crash. Therefore, you need to avoid routing loops in route summarization
scenarios.
Figure 5-64 Routing loop
The main reason for this routing loop is that the core switch cluster uses a default
route to forward a packet with a destination address that does not exist in the
campus network to the backbone area, and then the backbone area sends the
packet back to the cluster through a summarized return route.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 254
To address this problem, you need to configure a blackhole route on the core
switch cluster to block such a packet. Perform the following configuration:
[HUAWEI] ip route-static 10.10.0.0 255.255.0.0 NULL0
After a blackhole route is configured, the packet to be returned to the network
segment 10.10.0.0 will be directed to the user network segment through a specific
route. If such specific route is not found, this host address does not exist in the
campus network. The packet will match this blackhole route and be dropped to
prevent routing loops. When configuring route summarization in other areas, you
also need to configure a blackhole route to prevent routing loops.
OSPF Network Security: Silent Interface
After the preceding deployment is completed, the entire OSPF network can run
properly. However, this network has a large security vulnerability. That is, user-side
interfaces can receive OSPF Hello packets, so basic network information can be
easily obtained using a network sniffing tool for attack launch.
To ensure OSPF network security, you are advised to configure silent interfaces to
block OSPF packets sent to users, as shown in Figure 5-65.
Figure 5-65 Configuring silent interfaces to block OSPF packets sent to users
The following configures silent interfaces in core switch cluster 1 in Area 10:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 255
[HUAWEI] ospf 1
[HUAWEI-ospf-1] silent-interface vlanif100
[HUAWEI-ospf-1] silent-interface vlanif200
[HUAWEI-ospf-1] silent-interface vlanif300
NOTE
The silent-interface command prohibits specified interfaces from receiving and sending
OSPF packets and is typically configured on user-side interfaces. Configuring this command
on the link between two OSPF routers will cause a failure to establish an OSPF neighbor
relationship between them.
5.5 Summary of OSPF Configuration Tasks
This section provides a summary of OSPF configuration tasks. Perform
configurations according to your particular requirements.
Table 5-18 describes OSPF configuration tasks.
Table 5-18 OSPF configuration tasks
Scenario Description Task
Configuring Basic OSPF
Functions
Basic OSPF functions must be
configured before other OSPF
functions can be implemented.
5.8
Configuring
Basic OSPF
Functions
5.9
Configuring
Session
Parameters
for OSPF
Neighbor or
Adjacency
Relationshi
ps
5.10
Configuring
OSPF
Attributes
on Different
Types of
Networks
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 256
Scenario Description Task
Configuring OSPF Areas ● In a stub area, an area border
router (ABR) does not transmit
autonomous system (AS) external
routes, reducing route entries on
the ABR as well as the amount of
routing information to be
transmitted.
● An NSSA is a special type of OSPF
area. Similar to a stub area, an
NSSA does not transmit external
routes from other areas. Different
from a stub area, an NSSA imports
AS external routes and transmits
them in the entire AS (a stub area
does not import AS external
routes).
5.11
Configuring
OSPF Stub
Areas
5.12
Configuring
an OSPF
NSSA
Configuring OSPF Local-
MT
You can enable OSPF local multicast
topology (Local-MT) to allow TE
tunnel spanned devices to generate
multicast forwarding entries.
5.13
Configuring
Local MT
Adjusting OSPF Route
Selection
To implement flexible application of
OSPF on the live network, you can
adjust OSPF parameters to control
OSPF routing.
5.14
Adjusting
OSPF Route
Selection
Controlling OSPF
Routing Information
To implement network requirements,
you can configure OSPF parameters
to control advertisement and receipt
of OSPF routes.
5.15
Controlling
OSPF
Routing
Information
Controlling the
Convergence Speed of
OSPF Routes
You can increase the convergence
speed of OSPF routes to enable OSPF
to quickly respond to changes in the
network topology, or reduce the
convergence speed to decrease the
impact caused by route flapping over
OSPF networks and relieve loads on
devices.
5.18
Configuring
OSPF Fast
Convergenc
e
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 257
Scenario Description Task
Improving Reliability of
an OSPF Network
● If you configure BFD for OSPF in a
process or on an interface, the link
status can be rapidly detected.
This allows fault detection to
complete in milliseconds, speeding
up OSPF convergence.
● To avoid traffic interruption and
route flapping caused by standby/
active switchovers, you can
configure OSPF GR.
5.16
Configuring
BFD for
OSPF
5.19
Configuring
OSPF GR
Improving Stability of an
OSPF Network
You can improve the stability of an
OSPF network to reduce route
flapping on the network. This enables
the devices to work in a normal state
for an extended period of time.
5.20
Improving
Stability of
an OSPF
Network
Improving the Security of
an OSPF Network
In an OSPF network demanding high
security, you can configure OSPF
authentication and GTSM to improve
the network security.
5.21
Improving
the Security
of an OSPF
Network
5.6 Licensing Requirements and Limitations for OSPF
Involved Network Elements
Other network elements are required to support OSPF.
Licensing Requirements
OSPF is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support OSPF.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 258
Feature Limitations
None.
5.7 Default Settings for OSPF
Table 5-19 describes the default settings for OSPF.
Table 5-19 Default settings for OSPF
Parameter Default Setting
OSPF Disabled
Interval for sending Hello
packets
10 seconds on P2P and broadcast interfaces; 30
seconds on P2MP and NBMA interfaces
Dead interval after which
an OSPF neighbor
relationship expires
40 seconds on P2P and broadcast interfaces; 120
seconds on P2MP and NBMA interfaces
Period during which a
device acts as a stub router
500 seconds
Bandwidth reference value
used to calculate a link cost
100 Mbit/s
5.8 Configuring Basic OSPF Functions
Applicable Environment
When OSPF is configured on multiple switches in the same area, most
configuration data, such as the timer, filter, and aggregation, must be planned
uniformly by area. Incorrect configurations may prevent neighboring switches from
exchanging information or even cause routing information congestion and self-
loops.
OSPF configurations performed in interface views take effect regardless of
whether OSPF is enabled. These configurations remain in place even if OSPF is
disabled.
Pre-configuration Tasks
Before configuring basic OSPF functions, configure IP addresses for interfaces to
ensure that neighboring nodes are reachable at the network layer.
5.8.1 Creating an OSPF Process
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 259
Context
To run OSPF, each switch must have a router ID. A router ID is a 32-bit unsigned
integer, uniquely identifying a switch in an AS. To ensure the stability of OSPF,
manually plan and configure a unique router ID for each device.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id | router-id
router-id | vpn-instance
vpn-instance-name ] *
An OSPF process is created, and the OSPF view is displayed.
● The parameter
process-id specifies the ID of an OSPF process. The default
value is 1.
The switch supports OSPF multi-process. You can create different processes
for different types of services. An OSPF process ID is of local significance.
Different switches can exchange packets even if they have different process
IDs.
● The parameter router-id
router-id specifies the router ID of a switch.
By default, the system automatically selects the largest IP address among
loopback interface addresses as its router ID. The router ID of each device in
an AS must be unique. Using an interface IP address as a router ID is
recommended.
NOTE
The router ID of each OSPF process must be unique on the OSPF network; otherwise,
the OSPF neighbor relationship cannot be set up and routing information is incorrect.
Configuring a unique router ID for each OSPF process on each OSPF device is
recommended to ensure stability.
● The parameter vpn-instance
vpn-instance-name specifies the name of a VPN
instance.
If a VPN instance is specified, the OSPF process belongs to that VPN instance;
otherwise, the OSPF process belongs to a public network instance.
----End
5.8.2 Creating an OSPF Area
Context
Each device on an OSPF network must maintain an LSDB. The size of the LSDB
increases as more devices are deployed on the network, which can become a
burden. OSPF solves this problem by partitioning an AS into areas. An area is a
logical device group identified by an area ID. The borders of an area are devices
rather than links. Each OSPF interface must belong to an area, meaning that a link
(or network segment) belongs to only one area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 260
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id | router-id
router-id | vpn-instance
vpn-instance-name ] *
An OSPF process is created, and the OSPF view is displayed.
Step 3 Run area
area-id
An OSPF area is created, and the OSPF area view is displayed.
The area with ID 0 is the backbone area, which is responsible for forwarding inter-
area routing information. Routing information between non-backbone areas must
be forwarded through the backbone area.
----End
5.8.3 Enabling OSPF
Context
After creating an OSPF process, you need to configure the network segments to
which the IP addresses of OSPF interfaces belong in an area. Each interface that
runs OSPF must belong to an area, meaning that a network segment can belong
to only one area.
OSPF checks the network mask carried in received Hello packets. If the network
mask carried in such a packet is different from that of the local device, OSPF
discards the Hello packet and does not establish any OSPF neighbor relationship.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
OSPF can be enabled in an OSPF area or on a specific interface.
● Enable OSPF in an OSPF area.
1. Run network
ip-address wildcard-mask
A network segment belonging to an area is configured.
OSPF can run on an interface only when the following conditions are met:
– The IP address mask length of the interface is greater than or equal to
the mask length converted from the wildcard mask specified in the
network command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 261
– The primary IP address of the interface resides in the network segment
specified in the network command.
By default, OSPF advertises the IP address of a loopback interface as a 32-bit
host route, which is independent from the mask length configured on the
loopback interface. To advertise routes to the network segment where the
loopback interface resides, configure the network type as NBMA or broadcast
in the interface view. For details, see Configuring Network Types for OSPF
Interfaces.
● Enable OSPF on a specific interface.
1. Run interface
interface-type interface-number
The interface view is displayed.
2. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
3. Run ospf enable [
process-id ] area
area-id
OSPF is enabled on the interface.
A decimal integer or an IPv4 address in dotted-decimal notation can be
entered as the area ID, but the area ID is displayed always as an IPv4 address
in dotted-decimal notation.
----End
5.8.4 (Optional) Creating OSPF Virtual Links
Context
After OSPF areas are defined, OSPF route updates between non-backbone areas
are transmitted through the backbone area. OSPF requires that all non-backbone
areas maintain connectivity with the backbone area and that the backbone areas
in different OSPF areas also maintain connectivity with each other. However, this is
not true in some cases due to certain restrictions. To resolve this problem, you can
configure OSPF virtual links.
Perform the following steps on a switch running OSPF.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 262
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Run vlink-peer
router-id [ smart-discover | hello
hello-interval | retransmit
retransmit-interval | trans-delay
trans-delay-interval | dead
dead-interval |
[ simple [ plain
plain-text | [ cipher ]
cipher-text ] | { md5 | hmac-md5 | hmac-
sha256 } [
key-id { plain
plain-text | [ cipher ]
cipher-text } ] | authentication-
null | keychain
keychain-name ] ] *
A virtual link is created.
The vlink-peer (OSPF area) command must also be configured on the
neighboring switch.
NOTICE
If plain is selected, the password is stored in plaintext in the configuration file. For
security purposes, you are advised to select cipher so that the password is stored
in ciphertext.
Simple authentication, MD5 authentication and HMAC-MD5 authentication have
potential security risks. Therefore, HMAC-SHA256 authentication is recommended.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support the keychain
keychain-name parameter.
----End
Follow-up Procedure
Devices from different vendors may use different default MTUs. Therefore, after
virtual links are created, the MTU needs to be set to the default value 0 for
interfaces to send DD packets, which ensures the compatibility. For details, see
Configuring an Interface to Fill in the DD Packet with the Actual MTU.
5.8.5 (Optional) Restricting the Flooding of LSA Packets
Context
If there are multiple neighboring switches or a large number of LSA packets are
flooded, a neighboring switch may be inundated with LSA packets and become
overwhelmed processing them. This may cause the neighboring switch to discard
Hello packets that are used to maintain the OSPF neighbor relationships, resulting
in interruptions to the neighbor relationships. More packets need to be exchanged
to reestablish the neighbor relationships, which further increases the possibility of
neighbor relationship interruptions. To resolve this problem, you can restrict the
flooding of LSA packets.
Perform the following steps on a switch running OSPF.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 263
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run flooding-control [ number
transmit-number | timer-interval
transmit-
interval ] *
The flooding of LSA packets is restricted.
By default, 50 LSA packets can be flooded at an interval of 30 ms.
The flooding-control command takes effect immediately after execution.
If the flooding-control command is not run, flooding of LSA packets is
automatically restricted when the number of neighboring switches exceeds 256.
----End
5.8.6 Verifying the Basic OSPF Function Configuration
Prerequisites
All configurations of basic OSPF functions are complete.
Procedure
● Run the display ospf [
process-id ] peer command in any view to check
information about OSPF neighbors.
● Run the display ospf [
process-id ] interface command in any view to check
information about OSPF interfaces.
● Run the display ospf [
process-id ] routing command in any view to check
information about an OSPF routing table.
● Run the display ospf [
process-id ] lsdb command in any view to check
information about an OSPF LSDB.
----End
5.9 Configuring Session Parameters for OSPF Neighbor
or Adjacency Relationships
Pre-configuration Tasks
On an OSPF network, all routing information is transmitted and exchanged
between neighboring or adjacent devices. Configuring proper session parameters
for OSPF neighbor or adjacency relationships helps improve network stability.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 264
Before configuring session parameters for OSPF neighbor or adjacency
relationships, complete the following tasks:
● Configure a link layer protocol.
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more of the following configuration tasks (excluding the task of
Verifying the OSPF Session Parameter Configuration) as required.
5.9.1 Setting an OSPF Packet Retransmission Limit
Context
After an OSPF switch sends DD, LSU, or LSR packets but does not receive any
LSAck packet from a neighbor within a specified time, the switch retransmits the
packets. If the number of packet retransmissions reaches a specified limit, the
switch tears down the adjacency relationship with the neighbor.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run retransmission-limit [
max-number ]
An OSPF packet retransmission limit is set.
By default, no OSPF packet retransmission limit is set. If an OSPF packet
retransmission limit is set, the default value of
max-number is 30.
----End
5.9.2 Configuring an Interface to Insert the Actual MTU into
DD Packets
Context
The default maximum transmission unit (MTU) is 0.
To improve compatibility with a non-Huawei device, an OSPF-enabled Huawei
device adds the MTU 0 in DD packets to be sent and does not check the MTUs in
received DD packets, allowing an OSPF neighbor relationship to be set up even if
the two ends have different MTU settings.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 265
However, under the default configuration, the non-Huawei device may discard an
OSPF packet received from the Huawei device if the packet's actual MTU is
greater than the MTU of the non-Huawei device. If the discarded packet is an LSU,
an OSPF neighbor relationship can still be set up, but the route carried in the LSU
fails to be learned, causing service interruptions.
To resolve this issue, run the ospf mtu-enable command to configure an interface
to add the actual MTU in DD packets to be sent and check whether the MTU in a
received DD packet is greater than the local MTU. If the interface MTU settings of
the local and remote ends are different, an OSPF neighbor relationship cannot
enter the Full state. In this manner, MTU inconsistency can then be identified in
time.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf mtu-enable
The interface is configured to insert the actual MTU into DD packets and check
whether the MTU in DD packets from the neighbor exceeds the MTU of the local
end.
By default, the MTU in DD packets sent by an interface is 0.
NOTICE
Performing this procedure causes the re-establishment of neighbor relationships.
----End
5.9.3 Verifying the OSPF Session Parameter Configuration
Prerequisites
All configurations about session parameters of OSPF neighbor or adjacency
relationships are complete.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 266
Procedure
● Run the display ospf [
process-id ] peer command to check information
about OSPF neighbors.
● Run the display ospf [
process-id ] brief command to check brief OSPF
information.
● Run the display ospf [
process-id ] retrans-queue [
interface-type interface-
number ] [
neighbor-id ] [ low-level-of-retrans-times-range
min-time ]
[ high-level-of-retrans-times-range
max-time ] command to check the
OSPF retransmission queue.
----End
5.10 Configuring OSPF Attributes on Different Types of
Networks
Applicable Environment
By setting network types for OSPF interfaces and adjusting the OSPF attributes,
you can flexibly build OSPF networks.
In Table 5-20, OSPF classifies networks into four types based on the types of link
layer protocols.
Table 5-20 Network types supported by OSPF
Network Type Characteristic Default Configuration
Broadcast On a broadcast network,
Hello packets, LSU packets,
and LSAck packets are
transmitted using multicast;
DD packets and LSR packets
are transmitted using unicast.
If the link layer protocol is
Ethernet or Fiber Distributed
Data Interface (FDDI), OSPF
regards the network as a
broadcast network by
default.
Non-broadcast
multiple access
(NBMA)
On an NBMA network, Hello
packets, DD packets, LSR
packets, LSU packets, and
LSAck packets are
transmitted using unicast.
An NBMA network must be
fully meshed. That is, any
two switches on an NBMA
network must be directly
reachable.
If the link layer protocol is
ATM, OSPF regards the
network as an NBMA
network by default.
Point-to-point
(P2P)
On a P2P network, Hello
packets, DD packets, LSR
packets, LSU packets, and
LSAck packets are
transmitted using multicast.
If the link layer protocol is
PPP, HDLC, or Link Access
Procedure Balanced (LAPB),
OSPF regards the network as
a P2P network by default.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 267
Network Type Characteristic Default Configuration
Point-to-
multipoint
(P2MP)
On a P2MP network, Hello
packets are transmitted using
multicast; DD packets, LSR
packets, LSU packets, and
LSAck packets are
transmitted using unicast.
OSPF does not regard a
network as a P2MP network
by default regardless of its
link layer protocol. A P2MP
network must be forcibly
changed from another
network type.
As described in Table 5-20, the difference between OSPF configurations on four
types of networks lies in the packet transmission mode.
Pre-configuration Tasks
Before configuring OSPF attributes on different types of networks, complete the
following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Configuring network types of OSPF interfaces is the prerequisite for configuring
P2MP or NBMA network attributes.
5.10.1 Configuring a Network Type for an OSPF Interface
Context
Configure one of the following network types for an OSPF interface:
● P2MP: A P2MP network does not have an associated link layer protocol.
Therefore, a P2MP network must be forcibly changed from another network
type.
● NBMA: An NBMA network must be fully meshed. That is, any two switches on
an NBMA network must be directly reachable. However, this is not true in
many cases. In such cases, you need to manually change the network type.
● Broadcast: To speed up the establishment of neighbor relationships, you can
change the network type from broadcast to P2P.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 268
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf network-type { broadcast | nbma | p2mp | p2p [ peer-ip-ignore ] }
A network type is configured for the interface.
By default, the network type of an interface depends on the type of the physical
interface. The default network type of an Ethernet interface is broadcast.
When you configure a new network type for an interface, the original network
type of the interface is replaced.
A network type can be configured to suit networking requirements:
● If the network type of an interface is broadcast and a switch on the network
does not support multicast addresses, you can change the network type of
the interface to NBMA.
● If the network type of an interface is NBMA and the network is fully meshed
(any two switches are directly connected), you can change the network type
of the interface to broadcast. Configuring neighboring switch information on
the interface is not required then.
● If the network type of an interface is NBMA but the network is not fully
meshed, you must change the network type of the interface to P2MP. This
allows two indirectly connected switches to communicate through one switch
that directly connects to them both. Configuring neighboring switch
information on the interface is not required then.
● If only two switches run OSPF on the same network segment, you are advised
to change the network type of the interface to P2P.
NOTE
OSPF cannot be configured on a null interface.
----End
5.10.2 Configuring P2MP Network Attributes
Procedure
Step 1 Disable OSPF from checking the network mask.
1. Run system-view
The system view is displayed.
2. Run interface
interface-type interface-number
The interface view is displayed.
3. (Optional) On an Ethernet interface, run undo portswitch
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 269
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
4. Run ospf network-type p2mp
A network type is configured for the OSPF interface.
A P2MP network must be forcibly changed from another network type. For
details, see Configuring Network Types for OSPF Interfaces.
5. Run ospf p2mp-mask-ignore
OSPF is disabled from checking the network mask on the P2MP network.
6. Run quit
Exit the interface view.
Step 2 (Optional) Set the cost for the OSPF route to a specified neighbor on a P2MP
network.
By default, on a P2MP network, the cost of an OSPF route to a neighbor equals
the interface cost. If this default cost is not suitable, run the p2mp-peer command
to set a desired cost.
1. Run ospf [
process-id ]
The OSPF process view is displayed.
2. Run p2mp-peer
ip-address cost
cost
A cost is set for an OSPF route to a specified neighbor on a P2MP network.
Step 3 Configure the switch to filter the LSA packets to be sent.
When multiple links exist between two switches, you can configure the local
switch to filter the LSA packets to be sent. This can reduce unnecessary LSA
retransmission attempts and save bandwidth resources.
1. Run ospf [
process-id ]
The OSPF process view is displayed.
2. Run filter-lsa-out peer
ip-address { all | { summary [ acl {
acl-number |
acl-
name } ] | ase [ acl {
acl-number |
acl-name } ] | nssa [ acl {
acl-number |
acl-name } ] } * }
The local switch is configured to filter the LSA packets to be sent on the P2MP
network.
By default, the LSA packets to be sent are not filtered.
----End
5.10.3 Configuring NBMA Network Attributes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 270
Procedure
Step 1 (Optional) Set the network type to NBMA.
An NBMA network must be fully meshed. That is, any two switches on an NBMA
network must be directly reachable. In most cases, however, this is not true. To
resolve this problem, you can run specific commands to forcibly change the
network type to P2MP. For details, see Configuring Network Types for OSPF
Interfaces.
1. Run system-view
The system view is displayed.
2. Run interface
interface-type interface-number
The interface view is displayed.
3. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
4. Run ospf network-type nbma
The network type of the OSPF interface is set to NBMA.
Step 2 (Optional) Set the interval at which Hello packets for polling are sent on the
NBMA network.
On the NBMA network, after the neighbor relationship becomes invalid, the
switch sends Hello packets at an interval defined in the polling mechanism.
1. Run ospf timer poll
interval
The interval at which Hello packets for polling are sent is set on an NBMA
interface.
The default value is 120, in seconds.
Step 3 Configure a neighboring switch on the NBMA network.
If the network type of an interface is NBMA, the interface cannot broadcast Hello
packets to discover neighboring switches. Therefore, the IP address of a
neighboring switch and whether the neighboring switch can participate in DR
election must be configured manually on the interface.
1. Run quit
Exit the interface view.
2. Run ospf [
process-id ]
The OSPF process view is displayed.
3. Run peer
ip-address [ dr-priority
priority ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 271
A neighboring switch is configured on the NBMA network.
----End
5.10.4 Verifying the OSPF Attribute Configuration
Prerequisites
The configurations for OSPF attributes on the NBMA network and P2MP network
are complete.
Procedure
● Run either of the following commands to check LSDB information:
– display ospf [
process-id ] lsdb [ brief ]
– display ospf [
process-id ] lsdb [ { router | network | summary | asbr |
ase | nssa | opaque-link | opaque-area | opaque-as } [
link-state-id ] ]
[ originate-router [
advertising-router-id ] | self-originate ] [ age { min-
value
min-age-value | max-value
max-age-value } * ]
● Run the display ospf [
process-id ] peer [ [
interface-type interface-number ]
neighbor-id | brief | last-nbr-down ] command to view OSPF neighbor
information.
● Run the display ospf [
process-id ] nexthop command to check OSPF next
hop information.
● Run either of the following commands to check OSPF routing table
information:
– display ospf [
process-id ] routing [
ip-address [
mask |
mask-length ] ]
[ interface
interface-type interface-number ] [ nexthop
nexthop-
address ]
– display ospf [
process-id ] routing router-id [
router-id ]
● Run the display ospf [
process-id ] interface [ all |
interface-type interface-
number ] [ verbose ] command to check OSPF interface information.
----End
5.11 Configuring OSPF Stub Areas
Applicable Environment
Partitioning an AS into different areas reduces the number of LSAs. To further
reduce the number of entries in routing tables and the number of LSAs to be
transmitted in a non-backbone area, configure the non-backbone area on the
border of the AS as a stub area.
Configuring a stub area is optional.
Note the following points when configuring a stub area:
● The backbone area (Area 0) cannot be configured as a stub area.
● If an area is to be configured as a stub area, all the switches in this area must
be configured with stub attributes using the stub command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 272
● An ASBR cannot exist in a stub area to import AS external routes.
● Virtual links cannot exist in stub areas.
Pre-configuration Tasks
Before configuring OSPF stub areas, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Figure 5-66 Flowchart of configuring OSPF stub areas
5.11.1 Configuring an Area as a Stub Area
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Run stub [ no-summary | default-route-advertise backbone-peer-ignore ] *
The area is configured as a stub area.
The parameter no-summary prevents an ABR from sending Type 3 LSAs to the
stub area.
The parameter default-route-advertise enables an ABR to generate default Type
3 LSAs and advertise them to the stub area.
The parameter backbone-peer-ignore prevents an ABR from checking the
neighbor status when the ABR generates default Type 3 LSAs and advertises them
to the stub area. Specifically, the ABR generates default Type 3 LSAs and
advertises them to the stub area if there is an Up interface in the backbone area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 273
NOTE
● Stub attributes must be configured on all switches in a stub area using the stub
command.
● Configuring or deleting stub attributes will update routing information in the area. Stub
attributes can be deleted or reconfigured only after the routing update is complete.
Step 5 (Optional) Run default-cost
cost
The cost of the default Type 3 route to the stub area is set.
The default value is 1.
To ensure the reachability of AS external routes to a stub area, the ABR in the stub
area generates a default route and advertises the route to the non-ABR switches
in the stub area.
----End
5.11.2 Verifying the OSPF Stub Area Configuration
Procedure
Run either of the following commands to check LSDB information:
● display ospf [
process-id ] lsdb [ brief ]
● display ospf [
process-id ] lsdb [ { router | network | summary | asbr | ase |
nssa | opaque-link | opaque-area | opaque-as } [
link-state-id ] ]
[ originate-router [
advertising-router-id ] | self-originate ] [ age { min-
value
min-age-value | max-value
max-age-value } * ]
Run either of the following commands to check OSPF routing table information:
● display ospf [
process-id ] routing [
ip-address [
mask |
mask-length ] ]
[ interface
interface-type interface-number ] [ nexthop
nexthop-address ]
● display ospf [
process-id ] routing router-id [
router-id ]
Run the display ospf [
process-id ] abr-asbr [
router-id ] command to check OSPF
ASBR and ABR information.
5.12 Configuring an OSPF NSSA
Applicable Environment
To import external routes and prevent resource consumption caused by external
routes, configure an NSSA.
An NSSA is a special type of OSPF area. Similar to a stub area, an NSSA does not
transmit external routes from other areas. Different from a stub area, an NSSA
imports AS external routes and transmits them in the entire AS using Type 7 LSAs
(a stub area does not import AS external routes).
Type 7 LSAs are generated by ASBRs of NSSAs and flooded only in the NSSAs
where ASBRs reside. An ABR in an NSSA selectively translates received Type 7 LSAs
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 274
into Type 5 LSAs to advertise AS external routes to the other areas over the OSPF
network.
Pre-configuration Tasks
Before configuring an NSSA, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring switches are
reachable at the network layer.
● Configure basic OSPF functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Run nssa [ { default-route-advertise [ backbone-peer-ignore ] | suppress-
default-route } | flush-waiting-timer
interval-value | no-import-route | no-
summary | set-n-bit | suppress-forwarding-address | translator-always |
translator-interval
interval-value | zero-address-forwarding | translator-strict ]*
The area is configured as an NSSA.
NOTE
● NSSA attributes must be configured on all devices in the NSSA using the nssa
command.
● Configuring or deleting NSSA attributes will update the routing information in the area
and interrupt neighbor relationships. NSSA attributes can be reconfigured or deleted
only after the routing update is complete.
The parameters in the nssa command apply to the following scenarios:
● The default-route-advertise parameter is used to configure an ASBR to
advertise a Type 7 LSA carrying a default route to the NSSA.
On an ABR, a Type 7 LSA carrying a default route is generated regardless of
whether the routing table on the ABR contains a default route. On an ASBR, a
Type 7 LSA carrying a default route is generated only when the routing table
contains a default route.
● When the area to which an ASBR belongs is configured as an NSSA, invalid
Type 5 LSAs from other switches in the area can be deleted only when the
aging time reaches 3600s. These invalid LSAs consume numerous memory
resources, degrading the switch performance. To resolve this problem, you can
set the flush-waiting-timer parameter to generate Type 5 LSAs with the
aging time set to the maximum value (3600s). The generated Type 5 LSAs
with the largest aging time can delete the invalid Type 5 LSAs from other
switches in time.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 275
NOTE
– When the value of the LS age field (aging time) in the header of an LSA generated
using the flush-waiting-timer parameter reaches 3600s, the LSA is deleted.
– If an ASBR also functions as an ABR, the flush-waiting-timer parameter does not
take effect. This prevents Type 5 LSAs in non-NSSAs from being deleted.
● If an ASBR also functions as an ABR, you can configure the no-import-route
parameter to prevent external routes imported using the import-route
command from being advertised to the NSSA.
● The no-summary parameter can be configured on an ABR to prevent an ABR
from transmitting Type 3 LSAs to an NSSA so that the number of LSAs
transmitted to the NSSA can be reduced.
NOTE
After the nssa default-route-advertise backbone-peer-ignore no-summary
command is run, the ABR generates Type 7 and Type 3 LSAs both carrying default
routes if there is an Up interface in the backbone area. The Type 3 LSAs preferentially
take effect.
● If the set-n-bit parameter is configured, the N-bit is set in the DD packets
during the synchronization between the switch and neighboring switches.
● If multiple ABRs are deployed in an NSSA, the system automatically selects an
ABR (generally the switch with the largest router ID) as a translator
converting Type 7 LSAs into Type 5 LSAs. To specify one or two ABRs (in load
balancing scenarios) as all-the-time translators, you can configure the
translator-always parameter on the selected ABRs. You can use this
command to pre-configure a fixed translator to prevent LSA flooding caused
by translator role changes.
● The translator-interval parameter is used to ensure uninterrupted services
when translator roles change. The value of
interval-value must be greater
than the flooding period.
Step 5 (Optional) Run default-cost
cost
The cost of the default route carried in Type 3 LSAs that the ABR sends to the
NSSA is set.
To ensure reachability of AS external routes, the ABR in the NSSA generates a
default route and advertises the route to other switches in the NSSA. You can use
this command to set the cost of the default route to an NSSA and adjust the
selection of the default route.
Type 7 LSAs can also be used to carry a default route to guide traffic to other ASs.
Multiple ABRs may exist in an NSSA. To prevent routing loops, an ABR does not
calculate the default routes advertised by the other ABRs.
By default, the cost of the default route that an ABR sends to the NSSA is 1.
----End
Verifying the Configuration
Run either of the following commands to check LSDB information:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 276
● display ospf [
process-id ] lsdb [ brief ]
● display ospf [
process-id ] lsdb [ { router | network | summary | asbr | ase |
nssa | opaque-link | opaque-area | opaque-as } [
link-state-id ] ]
[ originate-router [
advertising-router-id ] | self-originate ] [ age { min-
value
min-age-value | max-value
max-age-value } * ]
Run either of the following commands to check OSPF routing table information:
● display ospf [
process-id ] routing [
ip-address [
mask |
mask-length ] ]
[ interface
interface-type interface-number ] [ nexthop
nexthop-address ]
● display ospf [
process-id ] routing router-id [
router-id ]
Run the display ospf [
process-id ] interface [ all |
interface-type interface-
number ] [ verbose ] command to check OSPF interface information.
5.13 Configuring Local MT
Applicable Environment
When both multicast and an MPLS TE tunnel are configured and the TE tunnel is
configured with IGP Shortcut, the outbound interface of the route calculated by an
IGP may not a physical interface but a TE tunnel interface. The switch uses the TE
tunnel interface to send multicast Join messages through a unicast route to the
multicast source address. The switch through which the TE tunnel passes, however,
cannot detect the multicast Join messages. As a result, multicast forwarding
entries will not be created.
To resolve this problem, you need to enable local MT. After local MT is enabled, if
the outbound interface of the calculated route is a TE tunnel interface of the IGP
Shortcut type, the route management (RM) module creates a separate MIGP
routing table for the multicast protocol, calculates the physical outbound interface
for the route, and adds the physical interface to the MIGP routing table for
multicast forwarding.
You can configure filtering conditions for local MT to control the number of
routing entries in an MIGP routing table and speed up MIGP routing table lookup.
NOTE
Only the S5731-S, S5731-H, S5731S-H, S5732-H, S6730-S, S6730S-H, and S6730-Hsupport
this function.
Pre-configuration Tasks
Before configuring local MT, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring switches are
reachable at the network layer.
● Configure basic OSPF functions.
● Configure a TE tunnel for the OSPF process.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 277
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run local-mt enable
Local MT is enabled.
NOTE
● Local MT is applicable only to the OSPF process of a public network instance.
● Local MT does not support forwarding adjacency (FA).
Step 4 (Optional) Run local-mt filter-policy { acl {
acl-number |
acl-name } | ip-prefix
ip-prefix-name | route-policy
route-policy-name }
A filtering policy is configured for local MT.
After an MIGP routing table is created, OSPF calculates routes. When the
calculation result shows that the outbound interface is an IGP Shortcut-capable TE
tunnel interface, the switch saves the physical interface where the tunnel interface
resides as the outbound interface in the MIGP routing table for multicast packet
forwarding.
To control the number of entries in the MIGP routing table and speed up the
MIGP routing table lookup, you can configure a filtering policy to allow only the
matched routes to the multicast source address to be added to the MIGP routing
table.
Multiple routes to a non-multicast source address may be added to a MIGP
routing table, causing the number of entries to exceed the upper limit. Therefore,
you are advised to configure a routing policy before enabling local MT.
NOTE
If a named ACL is configured using the acl command and a rule is configured using the rule
command for the ACL, the rule takes effect only on the source address range specified by the
parameter source within the time range specified by the parameter time-range.
----End
Verifying the Configuration
● Run the display ospf [
process-id ] migp-routing [
ip-address [
mask |
mask-
length ] ] [ interface
interface-type interface-number ] [ nexthop
nexthop-
address ] command to check the MIGP routing table information.
● Run the display ospf [
process-id ] routing command to check OSPF routing
table information.
● Run the display ospf [
process-id ] brief command to check brief OSPF
information.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 278
5.14 Adjusting OSPF Route Selection
Applicable Environment
To meet various requirements, such as flexible networking or load balancing
optimization on complex networks, you can adjust OSPF parameters.
Pre-configuration Tasks
Before adjusting OSPF route selection, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more configuration tasks (excluding the task of Verifying the OSPF
Route Selection Adjustment Configuration) as required.
5.14.1 Setting a Link Cost for an OSPF Interface
Context
You can manually set a link cost for an OSPF interface or allow OSPF to
automatically calculate the cost according to the interface bandwidth. The
calculation formula is as follows:
Cost of an interface = Bandwidth reference value/Interface bandwidth.
The integer of the calculated result is used as the cost of the interface. If the
calculated result is smaller than 1, the cost value is 1. Changing the bandwidth
reference value can change the cost of an interface. To manually set the link cost
or change the bandwidth reference value and interface bandwidth, perform the
following steps.
Procedure
● Set a link cost for an OSPF interface.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The OSPF interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 279
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run ospf cost
cost
A cost is set for the OSPF interface.
By default, OSPF automatically calculates its cost based on its interface
bandwidth. The default cost of a loopback interface is 0.
● Configure bandwidth-based automatic OSPF interface cost calculation.
The calculation formula is as follows: Cost of the interface = Bandwidth
reference value/Interface bandwidth. The integer of the calculation result is
used as the cost of the interface. If the result is less than 1, the cost is 1.
NOTE
● To use the bandwidth reference value to determine the interface cost, run the
bandwidth-reference command.
● To use the interface bandwidth to determine the interface cost, run the bandwidth
command to set configuration bandwidth for an interface, and then run the
bandwidth-config enable command to enable the device to calculate the cost for
the interface based on the configuration bandwidth of the interface.
● To use both the bandwidth reference value and interface bandwidth to determine
the interface cost, select the preceding configuration.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The OSPF interface view is displayed.
c. (Option) Run bandwidth
bandwidth
Configuration bandwidth is set for the interface.
By default, if no configuration bandwidth is set for an interface, the OSPF
interface cost is calculated based on the physical bandwidth of the
interface.
d. Run quit
Exit from the interface view.
e. Run ospf [
process-id ]
The OSPF process view is displayed.
f. (Option) Run bandwidth-reference
value
A bandwidth reference value is set.
The default bandwidth reference value is 100 Mbit/s.
NOTE
Ensure that the bandwidth reference values of switches in an OSPF process are the
same.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 280
g. (Option) Run bandwidth-config enable
The device is enabled to use the configuration bandwidth of each OSPF
interface to calculate the cost for the interface.
By default, a device is not enabled to calculate the cost of an OSPF
interface based on the configured interface bandwidth.
----End
5.14.2 Configuring Equal-Cost Routes
Context
If the destinations and costs of multiple routes discovered by one routing protocol
are the same, these routes are equal-cost routes and load balancing can be
implemented among them.
For example, in Figure 5-67, three routes between switchA and switchB that run
OSPF have the same costs. The three routes are equal-cost routes for load
balancing.
Figure 5-67 Networking diagram for configuring equal-cost routes
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run maximum load-balancing
number
The maximum number of equal-cost routes is set.
By default, the maximum number of equal-cost routes on the S5720I-SI, S5735-S,
S5735-S-I, S5735S-H, S6720S-S, and S5736-S is 8, and the maximum number of
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 281
equal-cost routes on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-
S, S6730-H, S6730S-H, S6730-S, and S6730S-S is 16.
Step 4 (Optional) Run nexthop
ip-address weight
value
The route preferences are configured for load balancing.
When the number of equal-cost routes on the live network exceeds the limit
specified in the maximum load-balancing command, valid routes are randomly
selected for load balancing. To specify valid routes for load balancing, you can run
the nexthop command to set the route preferences of the routes to higher values.
A smaller value of weight indicates a higher route preference. The default value
of weight is 255, which indicates that load balancing is implemented regardless of
the route preferences.
----End
5.14.3 Configuring a Route Selection Rule
Context
RFC 2328 and RFC 1583 define route selection rules differently. After OSPF is
enabled on a switch, you need to specify a route selection rule based on the
switch configuration. By default, a switch complies with the route selection rule
defined in RFC 1583. If the neighboring switch complies with the route selection
rule defined in RFC 2328, you need to configure the local switch to comply with
that defined in RFC 2328. This allows all switches in an OSPF area to comply with
the same route selection rule.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run undo rfc1583 compatible
The switch is configured to comply with the route selection rule defined in RFC
2328, instead of RFC 1583.
By default, the switch complies with the route selection rule defined in RFC 1583.
----End
5.14.4 Verifying the OSPF Route Selection Adjustment
Configuration
Prerequisites
All configurations of adjusting OSPF route selection are complete.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 282
Procedure
● Run the display ospf [
process-id ] interface command to check OSPF
interface information.
● Run the display ospf [
process-id ] routing command to check OSPF routing
table information.
----End
5.15 Controlling OSPF Routing Information
Pre-configuration Tasks
Before controlling OSPF routing information, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more of the following configuration tasks (excluding the task of
Verifying the OSPF Route Control Configuration) as required.
5.15.1 Configuring OSPF to Import External Routes
Context
To communicate with a switch running a protocol other than OSPF, an OSPF-
capable switch must import routes of this protocol into the OSPF network.
OSPF can ensure loop-free intra-area and inter-area routes; however, OSPF cannot
prevent external route loops. Therefore, exercise caution to prevent loops caused
by manual configurations when importing external routes to OSPF.
Perform the following steps on the switch functioning as an ASBR running OSPF.
Procedure
● Configure OSPF to import the routes discovered by other protocols.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run import-route { limit
limit-number | { bgp [ permit-ibgp ] | direct |
unr | rip [
process-id-rip ] | static | isis [
process-id-isis ] | ospf [
process-
id-ospf ] } [ cost
cost | type
type | tag
tag | route-policy
route-policy-
name ] * }
The switch is configured to import routes discovered by other protocols.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 283
NOTE
Only the S5720I-SI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, S5731-H,
S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support the bgp [ permit-ibgp ] and isis [
process-id-
isis ] parameters.
● Set parameters for OSPF to import routes.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run default { cost {
cost-value | inherit-metric } | limit
limit | tag
tag |
type
type } *
The parameters (route cost, tag, and type) for route import are set to the
default values.
The tag parameter is used to identify protocol-related information. For
example, it can differentiate AS numbers carried in BGP routes imported
by OSPF.
By default, the cost of the external routes imported by OSPF is 1, the type
of the imported external routes is Type 2, and the tag value of the
imported routes is 1.
NOTE
To set a cost for an imported route, run one of the following commands (listed in
descending order of priority).
● apply cost
● import-route
● default (default cost)
----End
5.15.2 Configuring OSPF to Advertise Default Routes to an
OSPF Area
Context
On an OSPF network, multiple switches often reside on the area border and AS
border for next-hop backup or traffic load balancing. To reduce routing entries and
improve resource usage on the OSPF network, you can configure a default route in
the following scenarios:
1. An ABR advertises a Type 3 LSA carrying a default route for instructing
switches to forward inter-area packets.
2. An ASBR advertises a Type 5 or Type 7 LSA carrying a default route for
instructing switches to forward AS external packets.
When no matching route is discovered, the switch can forward packets through a
default route.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 284
The preference of a default route in Type 3 LSAs is higher than that of the route in
Type 5 or Type 7 LSAs.
Advertisement of a default route is determined by the type of the area to which
the default route needs to be imported. Table 5-21 lists the default route
advertisement by area type.
Table 5-21 Default route advertising mode
Area
Type
Generated By Advertise
d By
LSA Type Flood
ing
Area
Common
area
A default route is generated using
the default-route-advertise
command.
ASBR Type 5 LSA Com
mon
area
Stub area A default route is generated
automatically.
ABR Type 3 LSA Stub
area
NSSA A default route is generated using
the nssa [ default-route-
advertise ] command.
ASBR Type 7 LSA NSSA
Totally
NSSA
A default route is generated
automatically.
ABR Type 3 LSA NSSA
Perform the following steps on an ASBR running OSPF.
Procedure
● Configure OSPF to advertise a default route to an OSPF area.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. Run default-route-advertise [ [ always | permit-calculate-other ] | cost
cost | type
type | route-policy
route-policy-name [ match-any ] ] *
OSPF is configured to advertise a default route to the OSPF area.
▪ The parameter always indicates that an LSA describing a default
route is generated and then advertised regardless of whether there
are active default routes of other OSPF processes in the routing table
of the local device.
▪ The parameter permit-calculate-other indicates that the local
router is allowed to calculate the default routes advertised by other
switches after adverting its own default route.
▪ The parameter route-policy
route-policy-name indicates that the
local device advertises default routes according to the parameters of
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 285
the configured routing policy when there are matched default
routing entries generated by other OSPF processes.
NOTE
● An ASE LSA describing a default route is generated and then advertised only
when there is an active default route of another OSPF process in the routing
table of the local device.
● Before advertising default routes, OSPF compares the preferences of default
routes. Therefore, if a static default route is configured on an OSPF switch,
the default route advertised by OSPF can be added to the current routing
table only when it has a higher preference than the static route.
----End
5.15.3 Configuring OSPF Route Summarization
Context
Route summarization on a large-scale OSPF network reduces the number of
routing entries. This function minimizes system resource consumption while
maintaining system performance. In addition, if a link frequently alternates
between Up and Down, the links not involved in route summarization are not
affected. This prevents route flapping and improves network stability.
OSPF supports two types of route summarization:
● Inter-area route summarization
Inter-area route summarization is performed on ABRs and applies to routes
from within an AS. An ABR generates Network-summary (Type 3) LSAs by
network segment while advertising routing information to other areas. If
network segments are contiguous, the ABR can summarize them into a single
segment. This allows the ABR to send only the summary LSA for all the
specified network segments.
● External route summarization
External route summarization is performed on ASBRs and is specific to
external routes that are imported into OSPF. ASBRs can summarize imported
AS-external (Type 5) LSAs within a summary address range. After an NSSA is
configured, an ASBR must summarize imported NSSA (Type 7) LSAs with the
summary address range.
Devices that are both ABRs and ASBRs summarize the Type 5 LSAs translated
from Type 7 LSAs.
Perform the following steps on a switch running OSPF.
Procedure
● Configure inter-area route summarization on an ABR.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 286
c. Run area
area-id
The OSPF area view is displayed.
d. Run abr-summary
ip-address mask [ [ cost {
cost | inherit-minimum } |
[ advertise [ generate-null0-route ] | not-advertise | generate-null0-
route [ advertise ] ] ] * ]
ABR route summarization is configured.
● Configure external route summarization on an ASBR.
a. Run system-view
The system view is displayed.
b. Run ospf [
process-id ]
The OSPF process view is displayed.
c. (Optional) Run asbr-summary type nssa-trans-type-reference [ cost
nssa-trans-cost-reference ]
OSPF is configured to consider Type 5 LSAs translated from Type 7 LSAs
when setting types and costs for summarized routes.
By default, OSPF does not consider Type 5 LSAs translated from Type 7
LSAs when setting types and costs for summarized routes.
d. Run asbr-summary
ip-address mask [ not-advertise | tag
tag | cost
cost
| distribute-delay
interval ] *
ASBR route summarization is configured.
NOTE
After route summarization is configured, the routing table on the local OSPF
switch remains unchanged, but the routing table on a neighboring OSPF switch
contains only one summarized route. This summarized route is removed only
when all specific routes involved in the summarization are interrupted.
----End
5.15.4 Configuring OSPF to Filter Received Routes
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name [ secondary ] } import
OSPF is configured to filter received routes.
● The parameter
acl-number specifies the number of a basic ACL.
● The parameter acl-name
acl-name specifies the name of an ACL.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 287
● The parameter ip-prefix
ip-prefix-name specifies the name of an IP prefix list.
The filter-policy import command is used to filter the routes calculated by OSPF
but cannot be used to filter advertised or received LSAs. Only the routes that pass
the filtering criteria are added to the routing table. Routes that do not pass the
filtering criteria can still be advertised.
----End
5.15.5 Configuring OSPF to Filter the Routes to Be Advertised
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name } export [
protocol [
process-id ] ]
OSPF is configured to filter the routes imported using the import-route
command. Only the routes that pass the filtering criteria are advertised.
● The parameter
acl-number specifies the number of a basic ACL.
● The parameter acl-name
acl-name specifies the name of an ACL.
● The parameter ip-prefix
ip-prefix-name specifies the name of an IP prefix list.
● The parameter route-policy
route-policy-name specifies the name of a
routing policy.
To filter the routes of a specific routing protocol or process, specify the parameter
protocol [
process-id ]. If this parameter is not specified, OSPF filters all the
imported routes.
NOTE
● The import-route command cannot be used to import external default routes.
● Only for the external routes passing the filtering criteria, OSPF generates Type 5 LSAs to
advertise the routes.
----End
5.15.6 Configuring a Switch to Filter LSAs to Be Sent
Context
When multiple links exist between two switches, you can configure the local
switch to filter the LSAs to be sent over certain links. This prevents unnecessary
retransmission of LSAs and saves bandwidth resources.
Perform the following steps on a switch running OSPF.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 288
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf filter-lsa-out { all | { summary [ acl {
acl-number |
acl-name } ] | ase
[ acl {
acl-number |
acl-name } ] | nssa [ acl {
acl-number |
acl-name } ] } * }
The switch is configured to filter the LSAs to be sent.
By default, a switch does not filter the LSAs to be sent.
----End
5.15.7 Configuring OSPF to Filter ABR Type3 LSAs
Context
After filtering criteria are set for the incoming or outgoing Type 3 LSAs (Summary
LSAs) in an area, only the Type 3 LSAs that pass the filtering criteria can be
received or advertised.
This function applies only to ABRs.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Configure OSPF to filter incoming or outgoing Type 3 LSAs generated by ABRs as
required.
● Run filter {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name } export
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 289
OSPF is configured to filter Type 3 LSAs leaving the local area.
● Run filter {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name |
route-policy
route-policy-name } import
OSPF is configured to filter Type 3 LSAs entering the local area.
----End
5.15.8 (Optional) Enabling the Mesh-Group Function
Context
To reduce the load on concurrent links between two switches, you can enable the
mesh-group function.
A neighboring router ID uniquely identifies a mesh group. A mesh group contains
several concurrent links, and flooding is implemented only once after the group is
created. Interfaces can be added to the same mesh group only when the following
conditions are met:
● The interfaces belong to the same area and OSPF process.
● The status of the interfaces is higher than Exchange.
● The interfaces connect to the same neighboring switch.
Perform the following steps on a switch running OSPF.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run mesh-group enable
The mesh-group function is enabled.
By default, the mesh-group function is disabled.
----End
5.15.9 Setting the Maximum Number of External LSAs in the
LSDB
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 290
Step 3 Run lsdb-overflow-limit
number
The maximum number of external LSAs in the LSDB is set.
----End
5.15.10 Verifying the OSPF Route Control Configuration
Prerequisites
All configurations of controlling OSPF routing information are complete.
Procedure
● Run either of the following commands to check OSPF routing table
information:
– display ospf [
process-id ] routing [
ip-address [
mask |
mask-length ] ]
[ interface
interface-type interface-number ] [ nexthop
nexthop-
address ]
– display ospf [
process-id ] routing router-id [
router-id ]
● Run the display ospf [
process-id ] interface [ all |
interface-type interface-
number ] [ verbose ] command to check OSPF interface information.
● Run the display ospf [
process-id ] asbr-summary [
ip-address mask ]
command to check OSPF ASBR summarization information.
----End
5.16 Configuring BFD for OSPF
Applicable Environment
Fault detection via Hello packets periodically sent to neighboring switches requires
more than 1s. For services such as voice and video, which are sensitive to packet
loss and latency, prolonged fault detection will cause packet loss when traffic is
transmitted at gigabit rates. This detection period cannot meet the high reliability
requirements of carrier-class networks.
BFD for OSPF resolves this problem. After BFD for OSPF is configured in a process
or on an interface, the link status can be rapidly detected. This allows fault
detection to complete in milliseconds, speeding up OSPF convergence.
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support BFD for OSPF.
Pre-configuration Tasks
Before configuring BFD for OSPF, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 291
● Configure basic OSPF functions.
Configuration Procedure
Figure 5-68 Flowchart of configuring BFD for OSPF
5.16.1 Configuring Global BFD
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run bfd
BFD is configured globally, and the global BFD view is displayed.
----End
5.16.2 Configuring BFD for OSPF
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run bfd all-interfaces enable
BFD for OSPF is enabled, and BFD sessions are established.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 292
If all the interfaces in a single process are configured with BFD and their neighbor
relationships are in the Full state, OSPF establishes BFD sessions on all the
interfaces in the process.
Step 4 (Optional) run bfd all-interfaces { min-rx-interval
receive-interval | min-tx-
interval
transmit-interval | detect-multiplier
multiplier-value } *
Parameters are set for the BFD sessions.
● The parameter min-rx-interval
receive-interval specifies the expected
minimum interval for receiving BFD packets from the neighbor.
● The parameter min-tx-interval
transmit-interval specifies the minimum
interval for sending BFD packets to the neighbor.
● The parameter detect-multiplier
multiplier-value specifies the local detection
multiplier.
NOTE
Default values of
receive-interval,
transmit-interval, and
multiplier-value are recommended.
Configure parameters based on the network status and network reliability
requirements. A short interval between BFD packet transmissions can be
configured if high network reliability is required.
NOTE
● Actual interval between BFD packet transmissions on the local switch = Max {value of
transmit-interval configured on the local switch, value of
receive-interval configured on the
neighboring switch }
● Actual interval between BFD packet receipts on the local switch = Max {value of
transmit-
interval configured on the neighboring switch, value of
receive-interval configured on the
local switch }
● Actual BFD packet detection period on the local switch = Actual interval between BFD packet
receipts on the local switch x Value of
multiplier-value configured on the neighboring switch
For example, if:
● On the local switch, the configured interval between BFD packet transmissions is 200 ms; the
configured interval between BFD packet receipts is 300 ms; the detection multiplier is 4.
● On the neighboring switch, the configured interval between BFD packet transmissions is 100
ms; the configured interval between BFD packet receipts is 600 ms; the detection multiplier
is 5.
Then:
● On the local switch, the actual interval between BFD packet transmissions is 600 ms
calculated by using the formula: max {200 ms, 600 ms}; the interval between BFD packet
receipts is 300 ms calculated by using the formula: max {100 ms, 300 ms}; the detection
period is 1500 ms calculated by using the formula: 300 ms x 5.
● On the neighboring switch, the actual interval between BFD packet transmissions is 300 ms
calculated by using the formula: max {100 ms, 300 ms}; the actual interval between BFD
packet receipts is 600 ms calculated by using the formula: max {200 ms, 600 ms}; the
detection period is 2400 ms calculated by using the formula: 600 ms x 4.
----End
5.16.3 (Optional) Preventing an Interface from Dynamically
Setting Up a BFD Session
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 293
Context
After the bfd all-interfaces enable command is run in an OSPF process, BFD
sessions are set up on all the OSPF interfaces under the process whose neighbor
relationships are in Full state. You can prevent an interface from dynamically
setting up a BFD session as required.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The view of the interface enabled with BFD for OSPF is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf bfd block
The interface is prevented from dynamically setting up a BFD session.
----End
5.16.4 (Optional) Configuring BFD on an Interface
Context
To allow a switch to rapidly detect failures occurring on a specific interface, you
can configure BFD for OSPF on the interface. When detecting a failure, the switch
then instructs OSPF to recalculate routes, speeding up OSPF convergence. If the
OSPF neighbor relationship set up on this interface goes Down, the BFD session
between the OSPF neighbors is dynamically deleted.
Before configuring BFD for OSPF on an interface, you need to enable BFD globally.
Perform the following steps on a switch:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 294
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf bfd enable
BFD is enabled on the OSPF interface and a BFD session is set up.
If all the interfaces in a single process are configured with BFD and their neighbor
relationships are in Full state, OSPF creates BFD sessions with default parameter
values on the interfaces with OSPF enabled in the process.
NOTE
The priority of BFD for OSPF configured on an interface is higher than that of BFD for OSPF
configured for a process.
If parameters need to be set for BFD sessions, run the ospf bfd { min-rx-interval
receive-interval | min-tx-interval
transmit- interval | detect-multiplier
multiplier-
value } * command.
Default values of
receive-interval,
transmit-interval, and
multiplier-value are
recommended. That is, the preceding command can be skipped.
The parameters need to be configured based on the network status and network
reliability requirements. A short interval between BFD packet transmissions can be
configured if high network reliability is required.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 295
NOTE
● Actual interval between BFD packet transmissions on the local switch = Max {value of
transmit-interval configured on the local switch, value of
receive-interval configured on the
neighboring switch }
● Actual interval between BFD packet receipts on the local switch = Max {value of
transmit-
interval configured on the neighboring switch, value of
receive-interval configured on the
local switch }
● Actual BFD packet detection period on the local switch = Actual interval between BFD packet
receipts on the local switch x Value of
multiplier-value configured on the neighboring switch
For example, if:
● On the local switch, the configured interval between BFD packet transmissions is 200 ms; the
configured interval between BFD packet receipts is 300 ms; the detection multiplier is 4.
● On the neighboring switch, the configured interval between BFD packet transmissions is 100
ms; the configured interval between BFD packet receipts is 600 ms; the detection multiplier
is 5.
Then:
● On the local switch, the actual interval between BFD packet transmissions is 600 ms
calculated by using the formula: max {200 ms, 600 ms}; the interval between BFD packet
receipts is 300 ms calculated by using the formula: max {100 ms, 300 ms}; the detection
period is 1500 ms calculated by using the formula: 300 ms x 5.
● On the neighboring switch, the actual interval between BFD packet transmissions is 300 ms
calculated by using the formula: max {100 ms, 300 ms}; the actual interval between BFD
packet receipts is 600 ms calculated by using the formula: max {200 ms, 600 ms}; the
detection period is 2400 ms calculated by using the formula: 600 ms x 4.
----End
5.16.5 Verifying the BFD for OSPF Configuration
Prerequisites
All configurations of BFD for OSPF are complete.
Procedure
● Run the following commands to check information about a BFD session or
global BFD sessions:
– display ospf [
process-id ] bfd session
interface-type interface-number
[
router-id ]
– display ospf [
process-id ] bfd session {
router-id | all }
----End
5.17 Configuring OSPF IP FRR
Applicable Environment
With the development of networks, Voice over IP (VoIP) and on-line video services
require high-quality real-time transmission. Nevertheless, if an OSPF fault occurs,
traffic can be switched to a new link only after the following processes: fault
detection at the millisecond level, notifying the fault to the routing control plane
at the millisecond level, generating and flooding new topology information at the
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 296
tens of milliseconds level, triggering SPF calculation at the tens of milliseconds
level, and notifying and installing a new route at the hundreds-of-milliseconds
level. As a result, it takes much more than 50 ms to recovery the link from the
fault, which cannot meet the requirement for real-time services on the network.
With OSPF IP FRR that calculates a backup link in advance, devices can fast switch
traffic to the backup link without interrupting traffic when the primary link
becomes faulty. This protects traffic and therefore greatly improves the reliability
of OSPF networks.
OSPF IP FRR is applicable to the services that are sensitive to packet delay and
packet loss.
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support this function.
5.17.1 Enabling OSPF IP FRR
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id | router-id
router-id | vpn-instance
vpn-instance-name ] *
An OSPF process is started, and the OSPF view is displayed.
Step 3 Run frr
The OSPF IP FRR view is displayed.
Step 4 Run loop-free-alternate
OSPF IP FRR is enabled to generate a loop-free backup link.
By default, this function is disabled. OSPF can generate a loop-free backup link
only when the OSPF IP FRR traffic protection inequality is met.
NOTE
In the following description, Distance_opt(X, Y) indicates the shortest link from node X to
node Y, S stands for a source node, E for the faulty node, N for a node along a backup link,
and D for a destination node.
● Link protection takes effect when the traffic to be protected flows along a
specified link and the link cost meets the inequality: Distance_opt(N, D) <
Distance_opt(N, S) + Distance_opt(S, D).
● Node-and-link protection takes effect when the traffic to be protected flows
along a specified link and passes through a specified node and the following
conditions are met:
– The link cost meets the inequality: Distance_opt(N, D) < Distance_opt(N,
S) + Distance_opt(S, D).
– The interface cost meets the inequality: Distance_opt(N, D) <
Distance_opt(N, E) + Distance_opt(E, D).
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 297
Step 5 (Optional) Run frr-priority static low
The Loop-Free Alternates (LFA) algorithm is configured for calculating the next
hop and outbound interface for a backup link.
The next hop and outbound interface of an OSPF loop-free backup link can be
obtained using either of the following methods:
● Static backup link: After OSPF IP FRR is enabled using the ip frr command in
the system view or VPN instance view, specify a next hop and an outbound
interface for the static backup link.
● Dynamic backup link: After OSPF IP FRR is enabled using the loop-free-
alternate command, configure the device to use the LFA algorithm to
calculate the next hop and outbound interface for the dynamic backup link.
By default, static backup links take preference over dynamic backup links during
route selection. However, static backup links are less flexible than dynamic backup
links. If a link failure occurs, static backup links cannot update automatically, but
dynamic backup links can. Therefore, run the frr-priority static low command to
specify the LFA algorithm for calculating the next hop and outbound interface so
that the dynamic backup links can take preference over static backup links.
Step 6 (Optional) Run frr-policy route route-policy
route-policy-name
An OSPF IP FRR filtering policy is configured.
After an OSPF IP FRR filtering policy is configured, only the OSPF backup routes
that pass the filtering criteria can be delivered to the forwarding table. To protect
the traffic over a specific OSPF route, you can configure a filtering policy that
matches the OSPF route to ensure that the route can be added to the forwarding
table. If this route fails, OSPF can fast switch the traffic to a backup route.
----End
5.17.2 (Optional) Binding OSPF IP FRR and BFD
Context
If OSPF IP FRR is configured, the lower layer needs to fast respond to link changes
so that traffic can be rapidly switched to backup links in the case of a link failure.
You can bind BFD to the link status so that link faults can be detected rapidly. This
ensures that traffic is rapidly switched to the backup link in the case of link
failures.
Binding OSPF IP FRR and BFD can be configured in a specified process or on a
specified interface. The priority of BFD configured on an interface is higher than
that of BFD configured in an OSPF process. If BFD is enabled on an interface, a
BFD session is established according to the BFD parameters set on the interface.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support this function.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 298
Procedure
● Bind OSPF IP FRR and BFD in a specified process.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is globally configured.
c. Run quit
Return to the system view.
d. Run ospf [
process-id | router-id
router-id | vpn-instance
vpn-instance-
name ] *
The OSPF process is enabled, and the OSPF view is displayed.
e. Run bfd all-interfaces enable
BFD is enabled in the OSPF process.
f. Run bfd all-interfaces frr-binding
IP FRR is bound to BFD in an OSPF process.
● Bind OSPF IP FRR and BFD on a specified interface.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is globally configured.
c. Run quit
Return to the system view.
d. Run interface
interface-type interface-number
The interface view is displayed.
e. Run ospf bfd enable
BFD is enabled on the OSPF interface.
f. Run ospf bfd frr-binding
IP FRR is bound to BFD on the OSPF interface.
----End
5.17.3 (Optional) Disabling OSPF IP FRR on an Interface
Context
OSPF IP FRR can be disabled on an interface of a specific device that is running
important services. This prevents the device connected to this interface from
providing a backup link for the local device and therefore being burdened after
FRR switches traffic to the backup link.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 299
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The view of the OSPF IP FRR-enabled interface is displayed.
Step 3 Run ospf frr block
OSPF IP FRR is disabled on the interface.
----End
5.17.4 Verifying the OSPF IP FRR Configuration
Prerequisites
All OSPF IP FRR configurations are complete.
Procedure
● Run the display ospf [
process-id ] routing command to check information
about the primary and backup links after OSPF IP FRR is enabled.
View the routes to the specified OSPF device.
<HUAWEI> display ospf routing 192.168.4.0
OSPF Process 1 with Router ID 192.168.150.11
Destination : 192.168.4.0/24
AdverRouter : 10.4.4.4 Area : 0.0.0.0
Cost : 2 Type : Transit
NextHop : 192.168.2.2 Interface : Vlanif20
Priority : Low Age : 00h00m10s
Backup Nexthop : 192.168.1.2 Backup Interface: Vlanif10
Backup Type : LFA LINK
The preceding information shows that a backup route is generated on the
switch, including information about the backup next hop: Backup NextHop,
Backup Interface, and Backup Type indicating the address, outbound
interface, and type of the backup next hop respectively.
----End
5.18 Configuring OSPF Fast Convergence
Pre-configuration Tasks
Before configuring OSPF fast convergence, complete the following tasks:
● Configure a link layer protocol.
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 300
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more configuration tasks (excluding the task of Verifying the OSPF
Fast Convergence Configuration) as required.
5.18.1 Setting a Convergence Priority for OSPF Routes
Context
A network may bear many different services, such as data, voice, and video. These
services have different requirements for the network.
To ensure that OSPF routes converge preferentially, you can configure convergency
priorities for these routes. This shortens the interruption of key services and
improves the reliability of the entire network.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run prefix-priority { critical | high | medium } ip-prefix
ip-prefix-name
A convergence priority is set for OSPF routes.
OSPF then calculates and floods LSAs and synchronizes LSDBs according to the
priority. This speeds up route convergence. When an LSA meets multiple priorities,
the highest priority takes effect. OSPF calculates routes in the sequence of intra-
area routes, inter-area routes, and AS external routes. This command specifies the
OSPF route convergence priorities. Convergence priorities include critical, high,
medium, and low in descending order. During LSA flooding, LSAs are placed into
the corresponding critical, high, medium, and low queues according to priorities,
which speeds up the processing of high-priority LSAs.
NOTE
This command takes effect only on the public network.
----End
5.18.2 Setting an Interval for Sending Hello Packets
Context
OSPF interfaces periodically send Hello packets to establish and maintain neighbor
relationships. The sending interval must be the same between any two neighbors.
Otherwise, OSPF neighbor relationships cannot be established.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 301
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf timer hello
interval [ conservative ]
An interval at which the OSPF interface sends Hello packets is set.
By default, the interval is 10s on a P2P or broadcast interface, and 30s on a P2MP
or NBMA interface. The dead time after which an OSPF neighbor relationship
expires on an interface is four times the interval for sending Hello packets on the
interface.
----End
5.18.3 Setting a Dead Time for a Neighbor Relationship
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf timer dead
interval
A dead time after which the neighbor relationship expires between two switches is
set.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 302
By default, the dead time is 40s on a P2P or broadcast interface, and 120s on a
P2MP or NBMA interface. The dead time is four times the interval for sending
Hello packets on the same interface.
NOTE
A dead time longer than 20s is recommended. If the dead time is shorter than 20s, the
OSPF neighbor relationship may be disconnected unexpectedly.
Both the Hello timer (interval for sending Hello packets) and the Dead timer (interval after
which a neighbor relationship expires) are restored to their default values upon a change of
the network type.
----End
5.18.4 Configuring Smart-discover
Context
If the neighbor status of a switch changes or the DR/BDR on a multi-access
network (broadcast or NBMA network) changes before Smart-discover is
configured, the switch does not send Hello packets to its neighbor until the Hello
timer expires. This slows down the establishment of neighbor relationships
between devices. To resolve this problem, you can configure Smart-discover to
allow the switch to send Hello packets to its neighbor immediately without
waiting for the expiration of the Hello timer.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf smart-discover
Smart-discover is configured on the interface.
----End
5.18.5 Setting an Interval for Updating LSAs
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 303
Context
OSPF stipulates that LSAs are updated at an interval of 5s to prevent network
connections or frequent route flapping from consuming excessive network
bandwidth or device resources.
On a stable network where routes need to converge fast, you can set the LSA
update interval to 0s so that the topology or route changes can be immediately
advertised over the network through LSAs, thereby speeding up route
convergence.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run lsa-originate-interval { 0 | { intelligent-timer
max-interval start-interval
hold-interval | other-type
interval } * }
An interval for updating LSAs is set.
● The parameter intelligent-timer indicates that an intelligent timer is used to
set the interval for updating Router-LSAs and Network-LSAs.
● The parameter
max-interval specifies the maximum interval for updating
LSAs, in milliseconds.
● The parameter
start-interval specifies the initial interval for updating LSAs, in
milliseconds.
● The parameter
hold-interval specifies the hold interval for updating LSAs, in
milliseconds.
● The parameter other-type
interval indicates an interval for updating LSAs
other than Router-LSAs and Network-LSAs.
By default, an intelligent timer is enabled. After an intelligent timer is enabled, the
default maximum interval for updating LSAs is 5000 ms, the default initial interval
is 500 ms, and the default hold interval is 1000 ms. The mechanism of the
intelligent timer is as follows:
1. The initial interval for updating LSAs is specified by
start-interval.
2. The interval for the
nth (
n ≥ 2) LSA update is equal to
hold-interval x 2(n-2).
3. When the interval specified by
hold-interval x 2(n-2) reaches the maximum
interval specified by
max-interval, the maximum interval is used for the
subsequent three LSA updates. Then, OSPF goes back to step Step 3.1 and
updates LSAs at the initial interval specified by
start-interval.
----End
5.18.6 Setting an Interval for Receiving LSAs
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 304
Context
OSPF stipulates that LSAs are received at an interval of 1s to prevent network
connections or frequent route flapping from consuming excessive network
bandwidth or device resources.
On a stable network where routes need to converge fast, you can set the LSA
receipt interval to 0s so that the topology or route changes can be immediately
advertised over the network through LSAs, thereby speeding up route
convergence.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run lsa-arrival-interval {
interval | intelligent-timer
max-interval start-interval
hold-interval }
The interval for receiving LSAs is set.
● The parameter
interval specifies the interval for receiving LSAs, in
milliseconds.
● The parameter intelligent-timer indicates that an intelligent timer is used to
set the interval for receiving Router-LSAs and Network-LSAs.
● The parameter
max-interval specifies the maximum interval for receiving
LSAs, in milliseconds.
● The parameter
start-interval specifies the initial interval for receiving LSAs, in
milliseconds.
● The parameter
hold-interval specifies the hold interval for receiving LSAs, in
milliseconds.
By default, an intelligent timer is enabled. After an intelligent timer is enabled, the
default maximum interval for receiving LSAs is 1000 ms, the default initial interval
is 500 ms, and the default hold interval is 500 ms. The mechanism of the
intelligent timer is as follows:
1. The initial interval for receiving LSAs is specified by
start-interval.
2. The interval for the
nth (
n ≥ 2) LSA receipt is equal to
hold-interval x 2(n-2).
3. When the interval specified by
hold-interval x 2(n-2) reaches the maximum
interval specified by
max-interval, the maximum interval is used for the
subsequent three LSA receipts. Then, OSPF goes back to step Step 3.1 and
receives LSAs at the initial interval specified by
start-interval.
----End
5.18.7 Setting an Interval for SPF Calculations
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 305
Context
When an OSPF LSDB changes, shortest paths must be recalculated. If a network
changes frequently, shortest paths are recalculated frequently, heavily consuming
system resources and degrading the network performance. To prevent this
problem, you can configure an intelligent timer to set a proper interval for SPF
calculations.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run spf-schedule-interval {
interval1 | intelligent-timer
max-interval start-
interval hold-interval | millisecond
interval2 }
The interval for SPF calculations is set.
● The parameter
interval1 specifies the interval for SPF calculations, in seconds.
● The parameter intelligent-timer indicates that an intelligent timer is used to
set the interval for SPF calculations.
● The parameter
max-interval specifies the maximum interval for SPF
calculations, in milliseconds.
● The parameter
start-interval specifies the initial interval for SPF calculations,
in milliseconds.
● The parameter
hold-interval specifies the hold interval for SPF calculations, in
milliseconds.
● The parameter millisecond
interval2 specifies the interval for SPF
calculations, in milliseconds.
By default, an intelligent timer is enabled. After an intelligent timer is enabled, the
default maximum interval for the SPF calculation is 10000 ms, the initial interval is
500 ms, and the hold interval is 1000 ms. The mechanism of the intelligent timer
is as follows:
1. The initial interval for SPF calculations is specified by
start-interval.
2. The interval for the
nth (
n ≥ 2) SPF calculation is equal to
hold-interval x
2(n-2).
3. When the interval specified by
hold-interval x 2(n-2) reaches the maximum
interval specified by
max-interval, the maximum interval is used for the
subsequent three SPF calculations. Then, OSPF goes back to step Step 3.1 and
performs the SPF calculation at the initial interval specified by
start-interval.
----End
5.18.8 Verifying the OSPF Fast Convergence Configuration
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 306
Prerequisites
All configurations of OSPF fast convergence are complete.
Procedure
● Run the display ospf [
process-id ] brief command to check OSPF brief
information.
----End
5.19 Configuring OSPF GR
Applicable Environment
To avoid traffic interruption and route flapping caused by active/standby
switchovers, you can enable OSPF GR.
After an OSPF process is restarted using GR, the Restarter and the Helper
reestablish a neighbor relationship, exchange routing information, synchronize
their LSDBs, and update their routing tables and forwarding tables. These
operations ensure fast OSPF convergence and network topology stability.
NOTE
Where possible, to prevent service forwarding from being affected by faults on an active
control board, you can configure OSPF GR when dual control boards are deployed.
Pre-configuration Tasks
Before configuring OSPF GR, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring switches are
reachable at the network layer.
● Configure basic OSPF functions.
5.19.1 Enabling the Opaque-LSA Capability of OSPF
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run opaque-capability enable
The opaque-LSA capability is enabled.
The opaque-LSA capability must be enabled because OSPF uses Type 9 LSAs to
support GR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 307
Step 4 Run graceful-restart
The OSPF GR feature is enabled.
----End
5.19.2 (Optional) Configuring GR Session Parameters on the
Restarter
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run graceful-restart [ period
period | planned-only | partial ] *
GR session parameters are set on the Restarter.
● The parameter period indicates the GR period on the Restarter. By default,
the GR period is 120 seconds.
● The parameter planned-only indicates that the Restarter supports only
planned GR. By default, the Restarter supports both planned GR and
unplanned GR.
● The parameter partial indicates that the Restarter supports only partial GR.
By default, the Restarter supports totally GR.
----End
5.19.3 (Optional) Configuring GR Session Parameters on the
Helper
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run graceful-restart helper-role { [ { ip-prefix
ip-prefix-name | acl-number
acl-
number | acl-name
acl-name } | ignore-external-lsa | planned-only ] * | never }
GR session parameters are set on the Helper.
● The parameters
ip-prefix,
acl-number, and
acl-name are used to configure a
filtering policy. A switch enters the Helper mode only when it passes the
filtering criteria in the policy.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 308
● The parameter ignore-external-lsa indicates that the Helper does not check
AS-external LSAs. By default, the Helper checks AS-external LSAs.
● The parameter planned-only indicates that the Helper supports only planned
GR. By default, the Helper supports both planned GR and unplanned GR.
● The parameter never indicates that the switch never enters the Helper mode.
----End
5.19.4 Verifying the OSPF GR Configuration
Prerequisites
All configurations of OSPF GR are complete.
Procedure
● Run the display ospf [
process-id ] graceful-restart [ verbose ] command to
check information about OSPF GR.
----End
5.20 Improving Stability of an OSPF Network
Applicable Environment
To reduce device load and improve network performance, you can configure OSPF
timers to reduce the number of unnecessary packets on the network.
Pre-configuration Tasks
Before performing operations to improve the stability of an OSPF network,
Configure basic OSPF functions.
Configuration Procedure
Perform one or more of the following configuration tasks (excluding the task of
Verifying the OSPF Network Stability Optimization Configuration) as required.
5.20.1 Setting a Priority for OSPF Routes
Context
A priority can be set for each routing protocol running on a switch. When these
protocols discover the same route, the route discovered by the highest-priority
routing protocol takes effect.
Procedure
Step 1 Run system-view
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 309
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run preference [ ase ] {
preference | route-policy
route-policy-name } *
A priority is set for OSPF routes.
● The parameter ase indicates that a priority is set for AS external routes.
● The parameter
preference specifies the priority of OSPF routes. A smaller
value indicates a higher priority.
● The parameter route-policy
route-policy-name indicates that a routing policy
is used to set a priority for specified routes.
The default priority of OSPF routes is 10. If the parameter ase is specified in the
command, the default priority of AS external routes is 150.
----End
5.20.2 Configuring an LSA Transmission Delay on an Interface
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf trans-delay
interval
A delay after which LSAs can be transmitted is set on the interface.
By default, the delay is 1s.
----End
5.20.3 Configuring an Interval for Retransmitting LSAs
Between Adjacent Switches
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 310
Context
After a switch sends an LSA to its neighboring switch, the switch waits for a
response within an interval. If no response is received within the interval, the
switch retransmits the LSA to the neighboring switch.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospf timer retransmit
interval
An interval at which LSAs are retransmitted between adjacent switches is set.
By default, the interval is 5s.
NOTE
Generally, the interval at which LSAs are retransmitted between adjacent switches must be
greater than the round trip time of a packet transmitted between the two switches.
Otherwise, some LSAs are retransmitted unnecessarily.
----End
5.20.4 Configuring a Stub Router
Context
Configuring a switch to function as a stub router ensures an uninterrupted route
on the switch during upgrades and other maintenance operations. This is because
the route cost is set to the maximum value 65535 and therefore the route is no
longer preferentially selected.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 311
The OSPF process view is displayed.
Step 3 Run stub-router [ on-startup [
interval ] ]
The switch is configured as a stub router.
No device functions as a stub router by default.
If a switch is configured as a stub router, it functions as a stub router for 500s by
default.
NOTE
A stub router configured using this command bears no similarity to a switch in a stub area.
----End
5.20.5 Prohibiting an OSPF Interface from Sending and
Receiving Protocol Packets
Context
To prevent devices on other networks from obtaining local OSPF routing
information and to prevent the local device from receiving the routing update
information advertised by other devices on the same network, you can prohibit an
OSPF interface from sending and receiving protocol packets. Such a configured
interface can continue to advertise its direct routes; however, Hello packets will be
blocked. This ensures that no neighbor relationship can be set up through the
interface, which enhances OSPF networking capabilities and reduces network
resource consumption.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF view is displayed.
Step 3 Run silent-interface { all |
interface-type interface-number }
An OSPF interface is prohibited from sending and receiving protocol packets.
By default, an interface is allowed to send and receive protocol packets.
You can prohibit an interface from sending and receiving OSPF packets in different
OSPF processes, but the silent-interface command is valid only for the OSPF
interface in the current process.
----End
5.20.6 Disabling the Function of Triggering Active/Standby
Board Switchover upon Abnormal OSPF LSA Aging
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 312
Context
If the local device clock is faster than usual and the aging timer expires
abnormally, the local device will clear all Router LSAs from the neighboring device,
causing route flapping and service interruptions. To resolve this issue, a device
automatically triggers active/standby switchover upon abnormal OSPF LSA aging.
Active/standby board switchover is triggered to restore network connections and
service traffic when the following condition is met:
(Number of incorrectly cleared Router LSAs/Total number of Router LSAs) x 100%
≥ 80% (Router LSAs here are those sent by the neighboring device to the local
device.)
To disable the function of triggering active/standby board switchover upon
abnormal OSPF LSA aging, run the ospf maxage-lsa auto-protect disable
command.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf maxage-lsa auto-protect disable
The function of triggering active/standby board switchover upon abnormal OSPF
LSA aging is disabled.
By default, this function is enabled.
----End
5.20.7 Verifying the OSPF Network Stability Optimization
Configuration
Prerequisites
All configurations of improving the stability of an OSPF network are complete.
Procedure
● Run the display ospf [
process-id ] brief command to check OSPF brief
information.
● Run the display ip routing-table command to check IP routing table
information.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 313
5.21 Improving the Security of an OSPF Network
Applicable Environment
On an OSPF network demanding high security, you can configure OSPF
authentication and the Generalized TTL Security Mechanism (GTSM) to improve
the security of the OSPF network.
NOTE
GTSM supports only unicast addresses; therefore, in OSPF, GTSM takes effect on virtual links
and sham links.
Pre-configuration Tasks
Before improving the security of an OSPF network, complete the following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● Configure basic OSPF functions.
Configuration Procedure
Perform one or more of the following configuration tasks (excluding the task of
Verifying the OSPF Network Security Optimization Configuration) as required.
5.21.1 Configuring OSPF GTSM
Context
The Generalized TTL Security Mechanism (GTSM) protects a switch by checking
whether the TTL value in an IP packet header is in a pre-defined range to improve
system security.
To make GTSM take effect, you need to enable GTSM on both ends of an OSPF
connection.
The valid TTL range of packets is [255 -
hops + 1, 255].
GTSM checks the TTL value of only the packets that match the GTSM policy. For
the packets that do not match the GTSM policy, you can configure a default action
to pass or drop them. If the default action is drop, you need to configure GTSM for
all switch connections. If GTSM is not configured for a switch, packets from the
switch are dropped. Therefore, the connection to the switch cannot be established.
This ensures security but reduces the ease of use.
You can enable the log function to record information about dropped packets,
facilitating fault locating.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 314
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf valid-ttl-hops
hops [ nonstandard-multicast ] [ vpn-instance
vpn-
instance-name ]
OSPF GTSM is configured.
NOTE
The ospf valid-ttl-hops command has two functions:
● Enabling OSPF GTSM
● Configuring a valid TTL range of packets
The parameter vpn-instance is valid only for the latter function.
Therefore, if only a private network policy or a public network policy is configured, you are
advised to set the default action to be performed on packets that do not match the GTSM
policy as pass. This prevents the OSPF packets of other instances from being discarded
incorrectly.
Step 3 (Optional) Run gtsm default-action { drop | pass }
The default action to be performed on packets that do not match the GTSM policy
is set.
By default, the action is pass.
NOTE
If the default action is configured but no GTSM policy is configured, GTSM does not take
effect.
Step 4 (Optional) Run gtsm log drop-packet all
The log function is enabled on the device in the system view. The information
about the packets dropped by GTSM will be recorded in the log.
----End
5.21.2 Configuring an Area Authentication Mode
Context
In area authentication, all switches in an area must use the same area
authentication mode and password. For example, all switches in Area 0 are
configured to use the simple authentication mode and a password of abc.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 315
NOTICE
If plain is selected in the area authentication configuration, the password is stored
in plaintext in the configuration file. For security purposes, you are advised to
select cipher to store the password in ciphertext.
Simple authentication, MD5 authentication, and HMAC-MD5 ciphertext
authentication have potential security risks. HMAC-SHA256 ciphertext
authentication is recommended.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ]
The OSPF process view is displayed.
Step 3 Run area
area-id
The OSPF area view is displayed.
Step 4 Run any of the following commands to configure an authentication mode for the
OSPF area as required:
● Run authentication-mode simple [ plain
plain-text | [ cipher ]
cipher-text ]
Simple authentication is configured for the OSPF area.
– plain: indicates that the password is stored in plaintext.
– cipher: indicates that the password is stored in ciphertext. For MD5
authentication or HMAC-MD5 authentication, the password is stored in
ciphertext by default.
● Run authentication-mode { md5 | hmac-md5 | hmac-sha256 } [
key-id
{ plain
plain-text | [ cipher ]
cipher-text } ]
An authentication mode is configured for the OSPF area.
– md5: indicates that MD5 ciphertext authentication is used.
– hmac-md5: indicates that HMAC-MD5 ciphertext authentication is used.
– hmac-sha256: indicates that HMAC-SHA256 ciphertext authentication is
used.
–
key-id: specifies the authentication key ID in ciphertext authentication.
● Run authentication-mode keychain
keychain-name
Keychain authentication is configured for the OSPF area.
NOTE
Before using Keychain authentication, you need to configure Keychain information in
the system view. To enable switches to successfully establish an OSPF neighbor
relationship, ensure that key-id, algorithm, and key-string in the local ActiveSendKey
are the same as those in the remote ActiveRecvKey.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support keychain
keychain-name.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 316
5.21.3 Configuring an Interface Authentication Mode
Context
Interface authentication, using an authentication mode and a password, is
performed among neighboring switches. The priority of interface authentication is
higher than that of area authentication.
NOTICE
If plain is selected in the interface authentication configuration, the password is
stored in plaintext in the configuration file. For security purposes, you are advised
to select cipher to store the password in ciphertext.
Simple authentication, MD5 authentication, and HMAC-MD5 ciphertext
authentication have potential security risks. HMAC-SHA256 ciphertext
authentication is recommended.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The OSPF interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run any of the following commands to configure an authentication mode or null
authentication on an interface as required:
● Run ospf authentication-mode simple [ plain
plain-text | [ cipher ]
cipher-
text ]
Simple authentication is configured for the OSPF interface.
– simple: indicates that simple authentication is used.
– plain: indicates that the password is stored in plaintext.
– cipher: indicates that the password is stored in ciphertext. For MD5
authentication or HMAC-MD5 authentication, the password is stored in
ciphertext by default.
● Run ospf authentication-mode { md5 | hmac-md5 | hmac-sha256 } [
key-id
{ plain
plain-text | [ cipher ]
cipher-text } ]
An authentication mode is configured for the OSPF interface.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 317
– md5: indicates that MD5 ciphertext authentication is used.
– hmac-md5: indicates that HMAC-MD5 ciphertext authentication is used.
– hmac-sha256: indicates that HMAC-SHA256 ciphertext authentication is
used.
● Run ospf authentication-mode null
Null authentication is configured on the OSPF interface.
● Run ospf authentication-mode keychain
keychain-name
Keychain authentication is configured for the OSPF interface.
NOTE
Before using Keychain authentication, configure Keychain information in the system
view. To enable switches to successfully establish an OSPF neighbor relationship,
ensure that key-id, algorithm, and key-string in the local ActiveSendKey are the
same as those in the remote ActiveRecvKey.
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support keychain
keychain-name.
----End
5.21.4 Verifying the OSPF Network Security Optimization
Configuration
Prerequisites
The configurations for improving security of an OSPF network are complete.
Procedure
● Run the display gtsm statistics {
slot-id | all } command to check the GTSM
statistics.
● Run the display ospf [
process-id ] request-queue [
interface-type interface-
number ] [
neighbor-id ] command to check the OSPF request queue.
● Run the display ospf [
process-id ] retrans-queue [
interface-type interface-
number ] [
neighbor-id ] command to check the OSPF retransmission queue.
● Run the display ospf [
process-id ] error [ lsa ] command to check OSPF
error information.
----End
5.22 Configuring OSPF Neighbor Relationship Flapping
Suppression
Applicable Environment
If an interface carrying OSPF services frequently alternates between Up and Down,
the OSPF neighbor relationship flaps on the interface. In this case, OSPF frequently
sends Hello packets to reestablish the neighbor relationship, synchronizes LSDBs,
and recalculates routes. In this process, a large number of packets are exchanged,
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 318
adversely affecting stability of existing neighbor relationships, OSPF services, and
other OSPF-dependent services, such as LDP and BGP. To address this problem,
OSPF implements suppression of neighbor relationship flapping to delay OSPF
neighbor relationship reestablishment or prevent service traffic from passing
through flapping links.
NOTE
The following steps are optional.
Pre-configuration Tasks
Before configuring OSPF neighbor relationship flapping suppression, complete the
following tasks:
● Configure IP addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
● 5.8 Configuring Basic OSPF Functions
Procedure
Step 1 Run system-view
The system view is displayed.
By default, suppression of OSPF neighbor relationship flapping is enabled globally.
To disable this function globally, run the suppress-flapping peer disable
command.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
By default, suppression of OSPF neighbor relationship flapping is enabled on all
interfaces in the same OSPF process. To disable this function on an interface, run
the ospf suppress-flapping peer disable command.
Step 3 Run ospf suppress-flapping peer hold-down
interval
The Hold-down mode of flapping suppression is configured, and the suppression
duration is set.
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes
during neighbor relationship establishment in an interface, the interface
prevents the reestablishment of the neighbor relationship, which minimizes
LSDB synchronization attempts and packet exchanges.
● Hold-max-cost mode: If the traffic forwarding path changes frequently, the
interface uses the maximum value 65535 as the cost of the flapping link,
which prevents traffic from passing through the flapping link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode after the Hold-down mode exits.
By default, only the Hold-max-cost mode is enabled.
To disable the Hold-max-cost mode, run the ospf suppress-flapping peer hold-
max-cost disable command.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 319
Step 4 Run ospf suppress-flapping peer { detecting-interval
detecting-interval |
threshold
threshold | resume-interval
resume-interval } *
Detection parameters are configured for OSPF neighbor relationship flapping
suppression.
Each OSPF interface with OSPF neighbor relationship flapping suppression
enabled starts a flapping counter. If the interval between two successive status
changes of a neighbor from Full to a non-Full state is shorter than
detecting-
interval, a valid flapping_event is recorded and the flapping_count increments by
1. When the flapping_count reaches or exceeds
threshold, flapping suppression
takes effect. If the interval between two successive status changes of a neighbor
from Full to a non-Full state is longer than
resume-interval, the flapping_count is
reset.
NOTE

