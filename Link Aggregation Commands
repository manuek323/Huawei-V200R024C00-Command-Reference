Link Aggregation Commands

    Command Support
    authentication-mode (E-Trunk view)
    assign trunk
    collect forward-path
    display eth-trunk
    display trunk configuration
    display eth-trunk load-balance
    display e-trunk
    display e-trunk packet-statistics
    display e-trunk state-change
    display forward-path
    display forward-path report
    display interface eth-trunk
    display lacp brief
    display lacp statistics eth-trunk
    display load-balance-profile
    display load-distribution active-linknumber-change
    display trunk index-map
    display trunk resource
    display trunkfwdtbl eth-trunk
    display trunkmembership eth-trunk
    eth-trunk
    eth-trunk load-balance mpls-l2-switched ip enable
    e-trunk (Eth-Trunk interface view)
    e-trunk mode
    e-trunk port
    e-trunk (system view)
    e-trunk track bfd-session
    interface eth-trunk
    ipv4 field
    ipv6 field
    l2 field
    lacp collector delay
    lacp e-trunk priority
    lacp e-trunk system-id
    lacp force-switch
    lacp force-forward
    lacp optimized-converge enable
    lacp preempt delay
    lacp preempt enable
    lacp priority
    lacp priority-command-mode
    lacp selected
    lacp src-mac
    lacp system-id
    lacp system-priority
    lacp timeout
    lacp track interface
    least active-linknumber
    load-balance
    load-balance-profile
    load-distribution active-linknumber-change
    load-distribution active-linknumber-change global
    local-preference enable
    max active-linknumber
    mixed-rate link enable
    mode
    mpls field
    peer-address source-address
    priority (E-Trunk view)
    reset e-trunk packet-statistics
    reset lacp statistics eth-trunk
    revert disable
    security-key
    sequence enable
    timer hello (E-Trunk view)
    timer hold-on-failure multiplier
    timer revert delay
    trunkport
    unknown-unicast load-balance
    unicast load-balance enhanced

Command Support

Commands provided in this section and all the parameters in the commands are supported by all switch models (except the S5751-L, S5731-L, and S5731S-L), unless otherwise specified. For details, see specific commands.
authentication-mode (E-Trunk view)
Function

The authentication-mode command configures the E-Trunk authentication and encryption mode.

The undo authentication-mode command restores the default E-Trunk authentication and encryption mode.

By default, the E-Trunk authentication and encryption mode is hmac-sha1.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

authentication-mode { hmac-sha1 | hmac-sha256 | enhanced-hmac-sha256 }

undo authentication-mode
Parameters
Parameter 	Description 	Value

hmac-sha1
	

Indicates that the E-Trunk authentication and encryption mode is hmac-sha1.
	

-

hmac-sha256
	

Indicates that the E-Trunk authentication and encryption mode is hmac-sha256.
NOTE:

hmac-sha256 is more secure than hmac-sha1, so you are advised to configure hmac-sha256 as the E-Trunk authentication and encryption mode.
	

-

enhanced-hmac-sha256
	

Indicates that the E-Trunk authentication and encryption mode is enhanced-hmac-sha256.
NOTE:

enhanced-hmac-sha256 is more secure than hmac-sha256 and hmac-sha1, so you are advised to configure enhanced-hmac-sha256 as the E-Trunk authentication and encryption mode.
	

-
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

To improve system security, run the authentication-mode command to configure the E-Trunk authentication and encryption mode.

Precautions

Two devices in an E-Trunk must have the same E-Trunk authentication and encryption mode.
Example

# Configure the E-Trunk authentication and encryption mode as enhanced-hmac-sha256.

<HUAWEI> system-view

[HUAWEI] e-trunk 1

[HUAWEI-e-trunk-1] authentication-mode enhanced-hmac-sha256

assign trunk
Function

The assign trunk command sets the maximum number of link aggregation groups (LAGs) and the maximum number of member interfaces in each LAG.

The undo assign trunk command restores the default maximum number of LAGs and the default maximum number of member interfaces in each LAG.

Table 5-16 describes the default maximum numbers of LAGs and member interfaces in each LAG on a device.
Table 5-16 Default maximum numbers of LAGs and member interfaces in each LAG

Model
	

Default Maximum Number of LAGs
	

Default Maximum Number of Member Interfaces in each LAG

S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S
	

128
	

32

S6735-S
	

128
	

8

This command is supported only on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S.
Format

assign trunk { trunk-group group-number | trunk-member member-number }*

undo assign trunk
Parameters
Parameter 	Description 	Value

trunk-groupgroup-number
	

Specifies the number of LAGs.
	

The value is an integer ranging 32 to 512 for the S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, and 32 to 128 for other models.

The value multiplied by member-number cannot exceed 2048 on the S6735-S. The value multiplied by member-number cannot exceed 8192 on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S.

trunk-membermember-number
	

Specifies the maximum number of member interfaces in each LAG.
	

The value is an integer that can be 8, 16, 32, or 64.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

In most cases, a switch supports a fixed maximum number of LAGs and a fixed maximum number of member interfaces in each LAG. On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the maximum number of LAGs and the maximum number of member interfaces in each LAG, implementing flexible networking and meeting various service requirements.

Precautions

    By default, if the value of member-number configured for an Eth-Trunk using the assign trunk { trunk-group group-number | trunk-member member-number }* command is larger than or equal to 16 on the S6735-S or larger than 32 on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, known unicast packets are load balanced using the enhanced mode, and broadcast, unknown-unicast, and multicast (BUM) packets are load balanced based on their source and destination MAC addresses. Known unicast packets must be load balanced using the enhanced mode (the load balancing mode can be configured using the load-balance command). Otherwise, packet loss or uneven load balancing may occur.

    After the Eth-Trunk specifications are modified, save the configuration and restart the switch to make the modification take effect. The assign trunk command is not recorded in the configuration file. You can run the display trunk configuration command to check the number of LAGs supported by the device and the number of member interfaces in each LAG.

    If you use the assign trunk command to modify Eth-Trunk specifications, the existing Eth-Trunk configuration will become invalid or be lost. Exercise caution when you run the assign trunk command. When the configured Eth-Trunk specifications are reduced and the Eth-Trunks that exceed the specifications are configured, the configuration of excess Eth-Trunks is invalid.

    If an Eth-Trunk interface has been created on a switch and you want to expand the Eth-Trunk specifications, you need to run the load-balance enhanced profile command to configure an enhanced load balancing profile for all Eth-Trunks first. After Eth-Trunk specifications are expanded, you are advised not to delete the configured enhanced load balancing profile because this operation will cause uneven load balancing.
    After the reset netconf db-configuration or reset saved-configuration command is run, the assign trunk command configuration is cleared, that is, the default configuration is restored.

Example

# Set the maximum number of LAGs to 64 and the maximum number of member interfaces in each LAG to 16.

<HUAWEI> system-view
[HUAWEI] assign trunk trunk-group 64 trunk-member 16

collect forward-path
Function

The collect forward-path command configures the device to collect traffic information.

The undo collect forward-path command configures the device not to collect traffic information.

By default, the device does not collect traffic information.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

collect forward-path { { sip source-ip-address dip destination-ip-address [ sport source-port dport destination-port [ protocol { protocol-number | gre | icmp | igmp | ip | ipinip | ospf | tcp | udp } ] ] } | { smac source-mac-address | dmac dest-mac-address | vlan vlan-id | l2-protocol { protocol-value | arp | ip | ipv6 | mpls | rarp } } * } { ingress | egress | both } [ interval interval-time ]

undo collect forward-path { { sip source-ip-address dip destination-ip-address [ sport source-port dport destination-port [ protocol { protocol-number | gre | icmp | igmp | ip | ipinip | ospf | tcp | udp } ] ] } | { smac source-mac-address | dmac dest-mac-address | vlan vlan-id | l2-protocol { protocol-value | arp | ip | ipv6 | mpls | rarp } } * } { ingress | egress | both } [ interval interval-time ]
Parameters

Parameter
	

Description
	

Value

sip source-ip-address
	

Specifies the source IP address.
	

The value is in dotted decimal notation.

dip destination-ip-address
	

Specifies the destination IP address.
	

The value is in dotted decimal notation.

sport source-port
	

Specifies the source port number.
	

The value is an integer that ranges from 0 to 65535.

dport destination-port
	

Specifies the destination port number.
	

The value is an integer that ranges from 0 to 65535.

protocol { protocol-number | gre | icmp | igmp | ip | ipinip | ospf | tcp | udp }
	
Specifies the protocol number or type.

    protocol-number specifies the protocol number.

    gre indicates that the protocol type is GRE.

    icmp indicates that the protocol type is ICMP.

    igmp indicates that the protocol type is IGMP.

    ip indicates that the protocol type is IP.

    ipinip indicates that the protocol type is IPinIP.

    ospf indicates that the protocol type is OSPF.

    tcp indicates that the protocol type is TCP.

    udp indicates that the protocol type is UDP.

	

The value of protocol-number is an integer that ranges from 1 to 255.

smac source-mac-address
	

Specifies the source MAC address.
	

The value is in hexadecimal notation.

dmac dest-mac-address
	

Specifies the destination MAC address.
	

The value is in hexadecimal notation.

vlan vlan-id
	

Specifies the ID of a VLAN.
	

The value is an integer that ranges from 1 to 4094.

l2-protocol { protocol-value | arp | ip | ipv6 | mpls | rarp }
	
Specifies the Layer 2 protocol number or type.

    protocol-value specifies the protocol number.

    arp indicates that the protocol type is ARP and the protocol number is 0x0806.

    ip indicates that the protocol type is IP and the protocol number is 0x0800.

    ipv6 indicates that the protocol type is IPv6 and the protocol number is 0x86dd.

    mpls indicates that the protocol type is MPLS and the protocol number is 0x8847.

    rarp indicates that the protocol type is RARP and the protocol number is 0x8035.

	

The value of protocol-value is in hexadecimal notation and must start with 0x. The value contains three or six digits.

ingress
	

Indicates the inbound direction.
	

-

egress
	

Indicates the outbound direction.
	

-

both
	

Indicates the inbound and outbound directions.
	

-

interval interval-time
	

Indicates the collection duration.
	

The value is an integer that ranges from 0 to 1440, in minutes. The default value is 10. The value 0 indicates that the device continuously collects inbound and outbound interfaces and traffic information in packets with 5-tuple information.
Views

User view, System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The packet information contains the source and destination IP addresses, source and destination port numbers, source and destination MAC addresses, and protocol type. Traffic transmitted on each device interface contains different information. You can run this command to configure the device to collect traffic information, which helps you locate faults and understand the traffic forwarding path.

Precautions

The device can collect inbound and outbound interfaces and traffic information of a maximum of 8 flows.

In the outbound direction, traffic information collection (with the egress or both parameter specified) conflicts with a traffic policy or simplified traffic policy. If traffic information collection, traffic policy, or simplified traffic policy are configured, one of them may not take effect.

When the device restarts or an active/standby switchover occurs in a CSS, the collection information and report configured by the collect forward-path command will be deleted.

If traffic information collection is no longer required after the collection time ends, run the undo collect forward-path command to disable the device from collecting traffic information.

After the undo collect forward-path command is run, the collected traffic statistics will be deleted.
If commands for collecting statistics on traffic with the same packet information are configured and the directions in two consecutive commands are the same or overlap, only the previous command takes effect. Examples are as follows:

    Scenarios where collect forward-path sip 10.1.1.1 dip 10.2.2.2 ingress interval 20 and collect forward-path sip 10.1.1.1 dip 10.2.2.2 ingress interval 30 are configured in sequence: The collect forward-path sip 10.1.1.1 dip 10.2.2.2 ingress interval 30 command does not take effect.
    Scenarios where collect forward-path sip 10.1.1.1 dip 10.2.2.2 ingress and collect forward-path sip 10.1.1.1 dip 10.2.2.2 both are configured in sequence: The collect forward-path sip 10.1.1.1 dip 10.2.2.2 both command does not take effect.
    Scenarios where collect forward-path sip 10.1.1.1 dip 10.2.2.2 both and collect forward-path sip 10.1.1.1 dip 10.2.2.2 ingress are configured in sequence: The collect forward-path sip 10.1.1.1 dip 10.2.2.2 ingress command does not take effect.

Example

# Configure the device to collect traffic information with source IP address 10.1.1.1 and destination IP address 10.2.2.2.

<HUAWEI> system-view
[HUAWEI] collect forward-path sip 10.1.1.1 dip 10.2.2.2 both

display eth-trunk
Function

The display eth-trunk command displays the Eth-Trunk configuration.
Format

display eth-trunk [ trunk-id [ interface interface-type interface-number | verbose ] ]
Parameters
Parameter 	Description 	Value

trunk-id
	

Specifies the ID of an Eth-Trunk.
	
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.

interface interface-type interface-number
	

Specifies a member interface.

interface-type specifies the type of the member interface.

interface-number specifies the number of the member interface.
	

-

verbose
	

Displays the detailed configuration of a specified Eth-Trunk, including the Eth-Trunk traffic statistics.
	

-
Views

All views
Default Level

1 : Monitoring level
Usage Guidelines

Usage Scenario

After configuring an Eth-Trunk on a device, you can run the display eth-trunk command to check whether the Eth-Trunk configuration is correct.

When using the display eth-trunk command, pay attention to the following points:

    If no parameter is specified, the display eth-trunk command displays the configurations of all Eth-Trunks.

    If only trunk-id is specified, the display eth-trunk command displays the configuration of a specified Eth-Trunk.

    If trunk-id and interface interface-type interface-number are specified, the configuration of member interfaces of the specified Eth-Trunk is displayed.

    If trunk-id is specified and verbose is configured, the display eth-trunk command displays detailed configuration of a specified Eth-Trunk, including the Eth-Trunk traffic statistics.

Prerequisites

The Eth-Trunk has been correctly configured. If no Eth-Trunk is configured, when you run this command, the system displays an error message.

Precautions
If there are traffic statistics about many Eth-Trunks, you are advised to specify trunk-id or interface interface-type interface-number to filter output information. Otherwise, the following problems may occur due to excessive output information:

    The displayed information is repeatedly updated, and required information cannot be located.

    The system does not respond because of long-time information traverse and search.

Example

# Display the configurations of all Eth-Trunks.

<HUAWEI> display eth-trunk
Eth-Trunk10's state information is:
Local:
LAG ID: 10                  WorkingMode: LACP 
Preempt Delay Time: 10      Hash arithmetic: According to SIP-XOR-DIP
System Priority: 120        System ID: 0018-82d4-04c3
Least Active-linknumber: 1  Max Active-linknumber: 2
Operate status: up          Number Of Up Port In Trunk: 2
--------------------------------------------------------------------------------
ActorPortName                     Status   PortType     PortPri PortNo PortKey PortState Weight
GigabitEthernet0/0/2              Selected 1GE          10      262    2609    10111100  1
GigabitEthernet0/0/3              Selected 1GE          10      263    2609    10111100  1
GigabitEthernet0/0/4              Unselect 1GE          32768   264    2609    10100000  1

Partner:
--------------------------------------------------------------------------------
ActorPortName                     SysPri  SystemID    PortPri PortNo  PortKey   PortState
GigabitEthernet0/0/2              32768  00e0-fc6e-bb11  32768  262   2609      10111100
GigabitEthernet0/0/3              32768  00e0-fc6e-bb11  32768  263   2609      10111100
GigabitEthernet0/0/4              32768  00e0-fc6e-bb11  32768  264   2609      10110000

Eth-Trunk11's state information is:
WorkingMode: NORMAL         Hash arithmetic: According to SIP-XOR-DIP
Least Active-linknumber: 1  Max Bandwidth-affected-linknumber: 8
Operate status: up          Number Of Up Port In Trunk: 1
--------------------------------------------------------------------------------
PortName                                 Status      Weight
GigabitEthernet0/0/1                     Up          1

# Display the configuration of Eth-Trunk 11 in manual load balancing mode.

<HUAWEI> display eth-trunk 11
Eth-Trunk11's state information is:
WorkingMode: NORMAL         Hash arithmetic: According to SIP-XOR-DIP
Least Active-linknumber: 1  Max Bandwidth-affected-linknumber: 8
Operate status: up          Number Of Up Port In Trunk: 1
--------------------------------------------------------------------------------
PortName                                 Status      Weight
GigabitEthernet0/0/1                     Up          1

# Display the configuration of Eth-Trunk 10 in LACP mode.

<HUAWEI> display eth-trunk 10
Eth-Trunk10's state information is:
Local:
LAG ID: 10                  WorkingMode: LACP
Preempt Delay Time: 10      Hash arithmetic: According to SIP-XOR-DIP
System Priority: 120        System ID: 0018-82d4-04c3
Least Active-linknumber: 1  Max Active-linknumber: 2
Operate status: up          Number Of Up Port In Trunk: 2
--------------------------------------------------------------------------------
ActorPortName                     Status   PortType     PortPri PortNo PortKey PortState Weight
GigabitEthernet0/0/2              Selected 1GE          10      262    2609    10111100  1
GigabitEthernet0/0/3              Selected 1GE          10      263    2609    10111100  1
GigabitEthernet0/0/4              Unselect 1GE          32768   264    2609    10100000  1

Partner:
--------------------------------------------------------------------------------
ActorPortName                     SysPri    SystemID  PortPri PortNo  PortKey   PortState
GigabitEthernet0/0/2              32768  00e0-fc6e-bb11  32768  262   2609      10111100
GigabitEthernet0/0/3              32768  00e0-fc6e-bb11  32768  263   2609      10111100
GigabitEthernet0/0/4              32768  00e0-fc6e-bb11  32768  264   2609      10110000

# Display the detailed configuration of Eth-Trunk 11 in manual load balancing mode.

<HUAWEI> display eth-trunk 11 verbose
Eth-Trunk11's state information is:
WorkingMode: NORMAL         Hash arithmetic: According to SIP-XOR-DIP
Least Active-linknumber: 1  Max Bandwidth-affected-linknumber: 8
Operate status: up          Number Of Up Port In Trunk: 1
--------------------------------------------------------------------------------
PortName                                 Status      Weight
GigabitEthernet0/0/1                     Up          1

Flow statistic
 Interface GigabitEthernet0/0/1,
    Last 300 seconds input rate 0 bits/sec, 0 packets/sec
    Last 300 seconds output rate 0 bits/sec, 0 packets/sec
    0 packets input, 0 bytes, 0 drops
    0 packets output, 0 bytes, 0 drops
 Interface Eth-Trunk11
    Last 300 seconds input rate 0 bits/sec, 0 packets/sec
    Last 300 seconds output rate 0 bits/sec, 0 packets/sec
    0 packets input, 0 bytes, 0 drops
    0 packets output, 0 bytes, 0 drops

# Display the detailed configuration of Eth-Trunk 10 in LACP mode.

<HUAWEI> display eth-trunk 10 verbose
Eth-Trunk10's state information is:
Local:
LAG ID: 10                  WorkingMode: LACP
Preempt Delay Time: 10      Hash arithmetic: According to SIP-XOR-DIP
System Priority: 120        System ID: 0018-82d4-04c3
Least Active-linknumber: 1  Max Active-linknumber: 2
Operate status: up          Number Of Up Port In Trunk: 2
--------------------------------------------------------------------------------
ActorPortName                     Status   PortType     PortPri PortNo PortKey PortState Weight
GigabitEthernet0/0/2              Selected 1GE          10      262    2609    10111100  1
GigabitEthernet0/0/3              Selected 1GE          10      263    2609    10111100  1
GigabitEthernet0/0/4              Unselect 1GE          32768   264    2609    10100000  1

Partner:
--------------------------------------------------------------------------------
ActorPortName                     SysPri    SystemID  PortPri PortNo  PortKey   PortState
GigabitEthernet0/0/2              32768  00e0-fc6e-bb11  32768  262   2609      10111100
GigabitEthernet0/0/3              32768  00e0-fc6e-bb11  32768  263   2609      10111100
GigabitEthernet0/0/4              32768  00e0-fc6e-bb11  32768  264   2609      10110000

Flow statistic
 Interface GigabitEthernet0/0/2,
    Last 300 seconds input rate 32 bits/sec, 0 packets/sec
    Last 300 seconds output rate 32 bits/sec, 0 packets/sec
    148 packets input, 18944 bytes, 0 drops
    246 packets output, 31488 bytes, 0 drops
 Interface GigabitEthernet0/0/3,
    Last 300 seconds input rate 32 bits/sec, 0 packets/sec
    Last 300 seconds output rate 32 bits/sec, 0 packets/sec
    147 packets input, 18816 bytes, 0 drops
    246 packets output, 31488 bytes, 0 drops
 Interface GigabitEthernet0/0/4,
    Last 300 seconds input rate 56 bits/sec, 0 packets/sec
    Last 300 seconds output rate 48 bits/sec, 0 packets/sec
    144 packets input, 18432 bytes, 0 drops
    174 packets output, 22272 bytes, 0 drops
 Interface Eth-Trunk10
    Last 300 seconds input rate 96 bits/sec, 0 packets/sec
    Last 300 seconds output rate 96 bits/sec, 0 packets/sec
    439 packets input, 56192 bytes, 0 drops
    666 packets output, 85248 bytes, 0 drops

Table 5-17 Description of the display eth-trunk command output

Item
	

Description

Local
	

Configuration of the local Eth-Trunk.

LAG ID
	

ID of the Eth-Trunk.

WorkingMode
	

Working mode of the Eth-Trunk:

    NORMAL: manual load balancing mode

    LACP: LACP mode

Preempt Delay Time
	
Preemption delay time:

    If LACP preemption is enabled, the preemption time is displayed and expressed in seconds.
    If LACP preemption is disabled, the value is displayed as Disabled.

Hash arithmetic
	

Hash algorithm used for load balancing among member interfaces of the Eth-Trunk. The hash algorithm is configured by using the load-balance command.

The SS1720GW-E, S1720GWR-E, S5720I-SI, S5720-LI, S5720S-LI, S5735S-H, S5736-S, and S6720S-S use the src-dst-ip, source TCP or UDP port number, and destination TCP or UDP port number in the hash algorithm for load balancing regardless of whether you configure this parameter.

SysPri
	

System LACP priority. To configure the LACP system priority, run the lacp priority command.

SystemID
	

System ID.

Least Active-linknumber
	

Minimum number of active member links in Up state. To configure the minimum number of active member links in Up state, run the least active-linknumber command.

Max Active-linknumber
	

Maximum number of active member links in Up state. To configure the maximum number of active member links in Up state, run the max active-linknumber command.

Max Bandwidth-affected-linknumber
	

Maximum number of connections that affect the Eth-Trunk bandwidth.

Operate status
	
Eth-Trunk status:

    UP

    DOWN

Number Of Up Port In Trunk
	

Number of member interfaces in Up state in the Eth-Trunk.

ActorPortName
	

Name of a member interface.

Status
	
Status of the local member interface in LACP mode:

    Selected: A member interface in Selected state is active.

    Unselect: A member interface in Unselected state is inactive.

    ForceFwd: A member interface can forward Layer 2 traffic.

Status of the local member interface in manual load balancing mode:

    Up: indicates that the interface is properly started.

    Down: indicates that the interface is faulty.

PortType
	

Type of the local member interface.

PortPri
	

LACP priority of the member interface.

PortNo
	

Number of the member interface in LACP mode.

PortKey
	

Key value of the member interface in LACP mode.

PortState
	

Status variable of the member interface.
The status variable is eight bits, such as 10111100. The descriptions of each bit are as follows:

    Bit 1: Whether the member interface is an Actor. This bit has a fixed value 1.

    Bit 2: Whether the member interface uses a long or short timeout interval to receive LACPDUs.

    1: The member interface uses a short timeout interval.

    0: The member interface uses a long timeout interval.

    By default, an Eth-Trunk member interface uses the long timeout interval (90s) to receive LACPDUs. To set the timeout interval, run the lacp timeout command.

    Bit 3: Whether the system allows the member interface to be aggregated.

    1: The system allows the member interface to be aggregated.

    0: The system does not allow the member interface to be aggregated.

    Bit 4: Whether the member interface is added to the link aggregation group (LAG).

    1: The member interface is added to the LAG.

    0: The member interface is not added to the LAG.

    Bit 5: Whether the member interface can receive LACPDUs.

    1: The member interface can receive LACPDUs.

    0: The member interface cannot receive LACPDUs.

    Bit 6: Whether the member interface can send LACPDUs.

    1: The member interface can send LACPDUs.

    0: The member interface cannot send LACPDUs.

    Bit 7: Whether the LACPDUs contain default parameter values.

    1: The LACPDUs contain default parameter values.

    0: The LACPDUs do not contain default parameter values.

    Bit 8: Whether the receive state machine of the Actor is in Expired state.

    1: The receive state machine of the Actor is in Expired state.

    0: The receive state machine of the Actor is not in Expired state.

Weight
	

Weight of the member interface.

Partner
	

Information about member interfaces of the remote Eth-Trunk. The Eth-Trunk must work in LACP mode.

Flow statistic
	

Eth-Trunk traffic statistics.

Last 300 seconds input/output rate
	

Rates for sending and receiving bits and packets on the interface in the last 300 seconds.

input/output
	

Number of packets received or sent by the interface.

packets
	

Total number of packets that the interface receives or sends.

bytes
	

Total number of bytes that the interface receives or sends.

drops
	

Number of packets that the interface drops.
display trunk configuration
Function

The display trunk configuration command displays the maximum number of LAGs and the maximum number of member interfaces in each LAG.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S support this command.
Format

display trunk configuration
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To facilitate flexible networking, run the assign trunk command to set the maximum number of LAGs and the maximum number of member interfaces in each LAG. You can run the display trunk configuration command to view the configuration.
Example

# Display the maximum number of LAGs and the maximum number of member interfaces in each LAG.

<HUAWEI> display trunk configuration
--------------------------------------------------                              
Item            Default    Current    Configured                                
--------------------------------------------------                              
trunk-group     128        64         64                                         
trunk-member    8          16         16                                        
--------------------------------------------------    

Table 5-18 Description of the display trunk configuration command output

Item
	

Description

Item
	

The name of item.

Default
	

Default Eth-Trunk specifications supported by the device.

Current
	

Current Eth-Trunk specifications supported by the device.

Configured
	

Configured Eth-Trunk specifications. If the configured Eth-Trunk specifications are different from the current Eth-Trunk specifications, the configured Eth-Trunk specifications take effect after the device restarts.

To specify the parameter, run the assign trunk command.

trunk-group
	

Maximum number of Eth-Trunks supported by the device.

trunk-member
	

Maximum number of member interfaces in each Eth-Trunk.
display eth-trunk load-balance
Function

The display eth-trunk load-balance command displays the load balancing mode of an Eth-Trunk.
Format

display eth-trunk [ trunk-id ] load-balance
Parameters
Parameter 	Description 	Value

trunk-id
	

Displays the load balancing mode of a specified Eth-Trunk. trunk-id specifies the ID of the Eth-Trunk.
	
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

After the load balancing mode of an Eth-Trunk is configured, you can run this command to view the load balancing mode of the Eth-Trunk. If trunk-id is not specified, the load balancing modes of all Eth-Trunks are displayed.
Example

# Display the load balancing mode of Eth-Trunk 1.

<HUAWEI> display eth-trunk 1 load-balance
Eth-Trunk1's load-balance information:
 Load-balance Configuration: SIP-XOR-DIP
 Load-balance options used per-protocol:
  L2  : Source XOR Destination MAC address, Vlan ID, Ethertype, Ingress-port
  IPv4: Source XOR Destination IP address, Source XOR Destination TCP/UDP port
  IPv6: Source XOR Destination IP address, Source XOR Destination TCP/UDP port
  MPLS: Source XOR Destination IP address, Source XOR Destination TCP/UDP port

Table 5-19 Description of the display eth-trunk load-balance command output

Item
	

Description

Load-balance Configuration
	

Configured load balancing mode. The options are as follows:

    SIP: Eth-Trunk load balancing based on source IP addresses.
    DIP: Eth-Trunk load balancing based on destination IP addresses.
    SIP-XOR-DIP: Eth-Trunk load balancing based on source and destination IP addresses.
    SA: Eth-Trunk load balancing based on source MAC addresses.
    DA: Eth-Trunk load balancing based on destination MAC addresses.
    SA-XOR-DA: Eth-Trunk load balancing based on source and destination MAC addresses.
    ENHANCED: Enhanced Eth-Trunk load balancing.

The SS1720GW-E, S1720GWR-E, S5720I-SI, S5720-LI, S5720S-LI, S5735S-H, S5736-S, and S6720S-S use the src-dst-ip, source TCP or UDP port number, and destination TCP or UDP port number in the hash algorithm for load balancing regardless of whether you configure this parameter.

Unicast load-balance enhanced mode
NOTE:

This information is displayed only when the load balancing mode is set to ENHANCED.
	

Whether traffic is load balanced based on the inner IP address, outer IP address, or both.

    outer: Traffic is load balanced based on the outer IP address.
    inner: Traffic is load balanced based on the inner IP address.
    inner and outer: Traffic is load balanced based on both the inner and outer IP addresses.

Load-balance enhanced profile
NOTE:

This information is displayed only when the load balancing mode is set to ENHANCED.
	

Name of a load balancing profile.

Load-balance options used per-protocol
	

Load balancing parameters of different types of packets.
display e-trunk
Function

The display e-trunk command displays E-Trunk information.
Format

display e-trunk { brief | e-trunk-id }

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Parameters
Parameter 	Description 	Value

brief
	

Displays brief E-Trunk information.
	

-

e-trunk-id
	

Specifies the ID of an E-Trunk.
	

The value is an integer that ranges from 1 to 16.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

After an E-Trunk is configured, you can run the display e-trunk command to view information about the E-Trunk.
Example

# Display information about E-Trunk 1.

<HUAWEI> display e-trunk 1
                           The E-Trunk information  
E-TRUNK-ID : 1                          Revert-Delay-Time (s) : 120
Priority : 10                           System-ID : 00e0-fc12-3456
Peer-IP : 10.1.1.2                      Source-IP : 10.1.1.1
State : Master                          Causation : TIMEOUT
Send-Period (100ms) : 10                Fail-Time (100ms) : 200
Receive : 1                             Send : 1006
RecDrop : 0                             SndDrop : 0
Peer-Priority : -                       Peer-System-ID : -
Peer-Fail-Time (100ms) : -              BFD-Session : 1
Description : -
Sequence : Enable
--------------------------------------------------------------------------------                                                    
                            The Member information                                                                                  
Type      ID  LocalPhyState  Work-Mode     State   Causation        Remote-ID                                                       
Eth-Trunk 10  Up             auto          Master  ETRUNK_INIT      17     

Table 5-20 Description of the display e-trunk command output

Item
	

Description

E-TRUNK-ID
	

E-Trunk ID.

To specify the parameter, run the e-trunk command.

Revert-Delay-Time
	

Revertive switching delay of the E-Trunk.

To specify the parameter, run the timer revert delay command.

Priority
	

Priority of the E-Trunk.

To specify the parameter, run the priority command.

System-ID
	

System ID of the local end.

To specify the parameter, run the lacp e-trunk system-id command.

Peer-IP/Source-IP
	

Local and remote IP addresses of the E-Trunk.

To specify the parameter, run the peer-address source-address command.

State
	
E-Trunk status:

    1: Init

    2: Backup

    3: Master

Causation
	
E-Trunk status change cause:

    PRI(1): The E-Trunk status is determined by the E-Trunk priority.

    TIMEOUT(2): The local device changes from the backup to the master because it does not receive hello packets from the remote device within the timeout interval.

    BFD_DOWN(3): The BFD session on the local device detects that the link between the local device and the remote device is Down.

    PEER_TIMEOUT(4): The remote device changes from the backup to the master because it does not receive hello packets from the local device within the timeout interval.

    PEER_BFD_DOWN(5): The BFD session on the remote device detects that the link between the local device and the remote device is Down.

    ALL_MEMBER_DOWN(6): Both the two member devices of the E-Trunk are Down.

    INIT(7): The E-Trunk is being initialized.

Send-Period
	

Interval for sending hello packets.

To specify the parameter, run the timer hello command.

Fail-Time
	

Timeout interval for the E-Trunk to receive packets.

To specify the parameter, run the timer hold-on-failure multiplier command.

Receive/Send
	

Number of packets received and sent by the E-Trunk.

RecDrop/SndDrop
	

Number of received and sent packets discarded by the E-Trunk.

Peer-Priority
	

Priority of the remote device.

Peer-System-ID
	

System MAC address of the remote device.

Peer-Fail-Time
	

Timeout interval of the remote device.

BFD-Session
	

BFD session bound to the E-Trunk.

To specify the parameter, run the e-trunk track bfd-session command.

Description
	

Description of the E-Trunk.

Sequence
	
E-Trunk sequence number check function status:

    Enable
    Disable

You can run the sequence enable command in the E-Trunk view to configure the E-Trunk sequence number check function or modify its state.

Type
	

Member type. The value is Eth-Trunk.

ID
	

Member ID.

To add Eth-Trunks with different IDs on two devices to the same E-Trunk, run the e-trunk e-trunk-id remote-eth-trunk eth-trunk-id command on the Eth-Trunk interface view of the two devices to specify remote Eth-Trunk IDs to ensure that the E-Trunk works properly.

LocalPhyState
	
Physical status of a member link:

    1: Up

    2: Down

Work-Mode
	
Working mode of a member interface:

    1: auto

    2: force-backup

    3: force-master

To specify the parameter, run the e-trunk mode command.

State
	
Status of a member interface:

    1: Master

    2: Backup

Causation
	
Cause for the member interface status change:

    FORCE_BACKUP(1): The member interface is forcibly to work in backup state.

    FORCE_MASTER(2): The member interface is forcibly to work in master state.

    ETRUNK_INIT(3): The member interface works in automatic state but the E-Trunk is being initialized.

    ETRUNK_BACKUP(4): The member interface works in automatic state but the E-Trunk is in backup state.

    ETRUNK_MASTER(5): The member interface works in automatic state but the E-Trunk is in master state.

    PEER_MEMBER_DOWN(6): The remote device is Down.

    PEER_MEMBER_UP(7): The remote device is Up.

    NO_PEER_MEMBER(8): There is no remote device.

Remote-ID
	

Eth-Trunk ID of the remote device.
display e-trunk packet-statistics
Function

The display e-trunk packet-statistics command displays E-Trunk packet statistics.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

display e-trunk packet-statistics [ e-trunk-id e-trunk-id ]
Parameters
Parameter 	Description 	Value

e-trunk-id e-trunk-id
	

Display packet statistics about an E-Trunk. e-trunk-id specified the ID of the E-Trunk.
	

The value is an integer that ranges from 1 to 16.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

After an E-Trunk is successfully configured, you can run the display e-trunk packet-statistics command to check packet statistics about the E-Trunk. The command output helps you to determine whether data is normal and to locate faults.
Example

# Display E-Trunk packet statistics on the device.

<HUAWEI> display e-trunk packet-statistics

E-Trunk-ID errors : 0
Length errors     : 0

E-TRUNK-ID : 10
  Sent packets                                : 355
  Failed to send packets                      : 355
  Received packets                            : 0
  Received packets with priority errors       : 0
  Received packets with fail-time errors      : 0
  Received packets with state errors          : 0
  Received packets with state reason errors   : 0
  Received packets with peer-ip errors        : 0
  Received packets with authentication errors : 0
  Received packets with TLV check errors      : 0
  Received packets with system-id errors      : 1
  Dropped packets with BFD protection         : 0
  Received packets with member errors         : 53
  Received packets with sequence check errors : 0

Table 5-21 Description of the display e-trunk packet-statistics command output

Item
	

Description

E-Trunk-ID errors
	

Number of packets with incorrect E-Trunk IDs.

Length errors
	

Number of packets with incorrect lengths.

E-TRUNK-ID
	

E-Trunk ID.

Sent packets
	

Number of sent E-Trunk packets.

Failed to send packets
	

Number of E-Trunk packets that fails to be sent.

Received packets
	

Number of received E-Trunk packets.

Received packets with priority errors
	

Number of received E-Trunk packets with incorrect priorities.

Received packets with fail-time errors
	

Number of received E-Trunk packets with timeout errors.

Received packets with state errors
	

Number of received E-Trunk packets with incorrect states.

Received packets with state reason errors
	

Number of received E-Trunk packets with incorrect state reasons.

Received packets with peer-ip errors
	

Number of received E-Trunk packets with incorrect remote IP addresses.

Received packets with authentication errors
	

Number of received E-Trunk packets with authentication errors.

Received packets with TLV check errors
	

Number of received E-Trunk packets with TLV check errors.

Received packets with system-id errors
	

Number of received E-Trunk packets with incorrect system IDs.

Dropped packets with BFD protection
	

Number of E-Trunk packets dropped during the active/standby switchover because BFD is used.

Received packets with member errors
	

Number of packets generated when the switch detects that Eth-Trunk member interfaces at both ends are different.

Received packets with sequence check errors
	

Number of received E-Trunk packets failing the sequence number check.
display e-trunk state-change
Function

The display e-trunk state-change command displays the latest 10 status changes of an E-Trunk member interface.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

display e-trunk e-trunk-id state-change member-interface interface-type interface-number
Parameters
Parameter 	Description 	Value

e-trunk-id
	

Displays the latest 10 status changes of a specified E-Trunk.
	

The value is an integer that ranges from 1 to 16.

member-interface interface-type interface-number
	

Displays the latest 10 status changes of a specified E-Trunk member interface.

interface-type can only be Eth-Trunk.
	

-
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

After an E-Trunk is configured, you can run the display e-trunk state-change command to check the status changes of an E-Trunk member interface.

Prerequisites

An Eth-Trunk has been added to the E-Trunk.
Example

# Display the status changes of Eth-Trunk 10 in E-Trunk 1.

<HUAWEI> display e-trunk 1 state-change member-interface Eth-Trunk 10

Time                           SourceState     DestState   Reason
---------------------------------------------------------------------------
2013-07-25 10:41:30-08:00      Backup          Master      PEER_MEMBER_DOWN

Table 5-22 Description of the display e-trunk state-change command output

Item
	

Description

Time
	

Time when the status of the E-Trunk's member Eth-Trunk changed.

SourceState
	

Status of the E-Trunk's member Eth-Trunk before the status change.

DestState
	

State of the E-Trunk's member Eth-Trunk after the status change

Reason
	
Reason for the status change of the E-Trunk's member Eth-Trunk:

    FORCE_BACKUP: The E-Trunk's member Eth-Trunk is forcibly in backup state.
    FORCE_MASTER: The E-Trunk's member Eth-Trunk is forcibly in master state.
    ETRUNK_INIT: The E-Trunk is in initialization state.
    ETRUNK_BACKUP: The E-Trunk is in backup state.
    ETRUNK_MASTER: The E-Trunk is in master state.
    PEER_MEMBER_DOWN: The remote member Eth-Trunk goes Down.
    PEER_MEMBER_UP: The remote member Eth-Trunk goes Up.
    NO_PEER_MEMBER: There is no remote device.

display forward-path
Function

The display forward-path command displays collected traffic information.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

display forward-path
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

To locate faults and understand the traffic forwarding path, run the collect forward-path command to configure the device to collect traffic information. To check collected packet information, run the display forward-path command.

Prerequisites

The device has been configured to collect traffic information.
Example

# Display collected traffic information.

<HUAWEI> display forward-path
The brief information of forward-path(s) for L3:                                                                                    
Id       : Report id                                                                                                                
SIP      : Source IP address                                                                                                        
DIP      : Destination IP address                                                                                                   
Sport    : Source port                                                                                                              
Dport    : Destination port                                                                                                         
Pro      : Protocol type or protocol number                                                                                         
Dir      : Direction                                                                                                                
Interval : Interval time (in minutes), 0 means that the system keeps collecting                                                     
-------------------------------------------------------------------------------                                                     
Id SIP             DIP             Sport Dport Pro    Dir     Interval   Status                                                     
-------------------------------------------------------------------------------                                                     
1  10.1.1.1        10.2.2.2        -     -     -      both    10         done                                                       
                                                                                                                                    
The brief information of forward-path(s) for L2:                                                                                    
Id       : Report id                                                                                                                
SMAC     : Source MAC address                                                                                                       
DMAC     : Destination MAC address                                                                                                  
VLAN     : VLAN id                                                                                                                  
Pro      : Protocol type or protocol number                                                                                         
Dir      : Direction                                                                                                                
Interval : Interval time (in minutes), 0 means that the system keeps collecting                                                     
-------------------------------------------------------------------------------                                                     
Id SMAC             DMAC             VLAN   Pro    Dir      Interval     Status                                                     
-------------------------------------------------------------------------------                                                     
2  00e0-fc12-3456   00e0-fc12-3456   10     -      both     10           doing 

Table 5-23 Description of the display forward-path command output

Item
	

Description

Id
	

Report ID, that is, number of collected flows. You can run the display forward-path report command to view detailed information about inbound and outbound interfaces according to the specified report ID.

The IDs are displayed according to the sequence in which the collect forward-path command was executed. If an ID is deleted, the existing IDs remain unchanged. The ID configured later is displayed in the position of the deleted ID. For example, IDs 1 and 2 exist on the device. If ID 1 is deleted, ID 2 remains unchanged. If the collect forward-path command is used, the new ID is displayed in the position of deleted ID 1.

The device can collect inbound and outbound interfaces and traffic information of a maximum of 8 flows.

SIP
	

Source IP address of collected packets.

DIP
	

Destination IP address of collected packets.

Sport
	

Source port number of collected packets.

Dport
	

Destination port number of collected packets.

Pro
	

Protocol number or type of collected packets. To configure the protocol number or type of collected packets, run the collect forward-path command.

Dir
	

Direction where packets are collected.

Interval
	

The collection duration.

Status
	

Status of collected packets.

SMAC
	

Source MAC address of collected packets.

DMAC
	

Destination MAC address of collected packets.

VLAN
	

VLAN ID of collected packets.
display forward-path report
Function

The display forward-path report command displays traffic statistics.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

display forward-path report report-id
Parameters
Parameter 	Description 	Value

report-id
	

Specifies the ID of collected traffic.
	

The value is an integer that ranges from 1 to 8.

The IDs are displayed according to the sequence in which the collect forward-path command was executed. If an ID is deleted, the existing IDs remain unchanged. The ID configured later is displayed in the position of the deleted ID. For example, IDs 1 and 2 exist on the device. If ID 1 is deleted, ID 2 remains unchanged. If the collect forward-path command is used, the new ID is displayed in the position of deleted ID 1.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

To locate faults and understand the traffic forwarding path, run the collect forward-path command to configure the device to collect traffic information. Then run the display forward-path report command to check the collection result.

Prerequisites

The device has been configured to collect traffic information.
Example

# Display traffic statistics of the report ID 1.

<HUAWEI> display forward-path report 1
Source IP address      : 10.1.1.1                                                                                                   
Destination IP address : 10.2.2.2                                                                                                   
Source port            : -                                                                                                          
Destination port       : -                                                                                                          
Protocol type          : -                                                                                                          
Direction              : both                                                                                                       
Interval time          : 10 minute(s)                                                                                               
Status                 : doing                                                                                                      
Start time             : 2010-12-30 11:39:11                                                                                        
End time               : -                                                                                                          
--------------------------------------------------------------------------------                                                    
Port            Eth-Trunk        Packets          Bytes          Direction                                                          
-------------------------------------------------------------------------------- 
GE0/0/1         1                 6555             20             ingress
GE0/0/2         -                 6555             20             egress 

# Display traffic statistics of the report ID 2.

<HUAWEI> display forward-path report 2
Source MAC address      : 00e0-fc05-0005
Destination MAC address : 00e0-fc06-0006
L2 protocol type        : arp  
VLAN id                 : 5   
Direction               : both 
Interval time           : 1440 minute(s)
Status                  : doing 
Start time              : 2015-11-23 17:15:33+02:00
End time                : -                        
--------------------------------------------------------------------------------
Port            Eth-Trunk        Packets          Bytes          Direction  
------------------------------------------------------------------------------- 
GE0/0/1         -                46004724         0              ingress     
GE0/0/2         -                45999397         0              ingress    

Table 5-24 Description of the display forward-path report command output

Item
	

Description

Source IP address
	

Source IP address of collected packets.

Destination IP address
	

Destination IP address of collected packets.

Source port
	

Source port number of collected packets.

Destination port
	

Destination port number of collected packets.

Protocol type
	

Protocol number or type of collected packets. To configure the protocol number or type of collected packets, run the collect forward-path command.

Direction
	

Direction where packets are collected.

Interval time
	

The collection duration.

Status
	

Collected packet status.

Start time
	

Start time when packets were collected.

End time
	

End time when packets were collected.

Port
	

Inbound and outbound interfaces of packets.

Eth-Trunk
	

Eth-Trunk that interfaces join.

Source MAC address
	

Source MAC address of collected packets.

Destination MAC address
	

Destination MAC address of collected packets.

L2 protocol type
	

Layer 2 protocol type of collected packets.

VLAN id
	

VLAN ID of collected packets.

Packets
	

Number of forwarded packets.

Bytes
	

Number of forwarded bytes.
display interface eth-trunk
Function

The display interface eth-trunk command displays status and traffic statistics about Eth-Trunk interfaces.
Format

display interface eth-trunk [ trunk-id | main ]

display interface eth-trunk trunk-id.subnumber

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support trunk-id.subnumber parameter.
Parameters
Parameter 	Description 	Value

trunk-id
	

Specifies the ID of an Eth-Trunk.
	
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.

main
	

Displays the status and traffic statistics of an Eth-Trunk main interface.
	

-

trunk-id.subnumber
	

Specifies the number of an Eth-Trunk sub-interface.
	

The value is an integer that ranges from 1 to 4096.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

You can run the display interface eth-trunk command to view the status and weight of each Eth-Trunk member interface.

To monitor the status of an interface or locate an interface fault, you can use the display interface eth-trunk command to collect the status of and traffic statistics on the interface. You can collect traffic statistics and locate faults on the interface according to the command output.
Example

# Display status and traffic statistics about Eth-Trunk 10.

<HUAWEI> display interface Eth-Trunk 10
Eth-Trunk10 current state : UP
Line protocol current state : DOWN                                              
Description:                                                                    
Switch Port, Link-type : trunk(negotiated),   
PVID :    1, Hash arithmetic : According to SIP-XOR-DIP,Maximal BW:
 2G, Current BW: 1000M, The Maximum Frame Length is 9216  
IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fcd4-36f1 
Current system time: 2013-01-14 19:38:12                                        
Last 300 seconds input rate 0 bits/sec, 0 packets/sec                           
Last 300 seconds output rate 0 bits/sec, 0 packets/sec                          
Input:  0 packets, 0 bytes                                                      
  Unicast:                          0,  Multicast:                           0  
  Broadcast:                        0,  Jumbo:                               0  
  Discard:                          0,  Pause:                               0  
  Frames:                           0                                           
                                                                                
  Total Error:                      0                                           
  CRC:                              0,  Giants:                              0  
  Jabbers:                          0,  Fragments:                           0  
  Runts:                            0,  DropEvents:                          0  
  Alignments:                       0,  Symbols:                             0  
  Ignoreds:                         0                                           
                                                                                
Output:  0 packets, 0 bytes                                                     
  Unicast:                          0,  Multicast:                           0  
  Broadcast:                        0,  Jumbo:                               0  
  Discard:                          0,  Pause:                               0  
                                                                                
  Total Error:                      0                                           
  Collisions:                       0,  ExcessiveCollisions:                 0  
  Late Collisions:                  0,  Deferreds:                           0  
  Buffers Purged:                   0                                           
                                                                                
    Input bandwidth utilization  :    0%                                        
    Output bandwidth utilization :    0%                                        
-----------------------------------------------------                           
PortName                      Status      Weight                                
-----------------------------------------------------                           
GigabitEthernet0/0/1    DOWN                1
GigabitEthernet0/0/2    UP                  1
-----------------------------------------------------                           
The Number of Ports in Trunk : 2                                                
The Number of UP Ports in Trunk : 1

Table 5-25 Description of the display interface eth-trunk command output

Item
	

Description

Eth-Trunk10 current state
	
Eth-Trunk status:

    UP: The interface is Up.

    DOWN: The interface becomes faulty.
    UP(E-TRUNK-DOWN): The Eth-Trunk goes Down because of E-Trunk negotiation.

Line protocol current state
	
Link layer protocol status of the Eth-Trunk:

    DOWN: The link layer protocol of the interface fails or no IP address is assigned to the interface.
    UP: The link layer protocol of the interface is running properly.

Description
	

Description of the Eth-Trunk.

To specify the parameter, run the description command.

Switch Port
	

The Eth-Trunk is a Layer 2 interface. Route Port is displayed if the Eth-Trunk is a Layer 3 interface.

Link-type
	
Link type of the Layer 2 interface. The parameter is displayed only in Layer 2 mode. The options are as follows:

    access (configured): The interface is manually configured as an access interface.
    hybrid: The interface is manually configured as a hybrid interface.
    trunk (configured): The interface is manually configured as a trunk interface.
    dot1q-tunnel: The interface is manually configured as a Dot1q-tunnel interface.
    access(negotiated): The interface is used as an access interface through negotiation.
    trunk(negotiated): The interface is used as a trunk interface through negotiation.

To configure the link type of an interface, run the port link-type command.

PVID
	

Default VLAN ID of the Eth-Trunk.

Hash arithmetic
	

Hash algorithm used for load balancing among Eth-Trunk member interfaces. The hash algorithm depends on the load balancing mode configured by using the load-balance command.

The SS1720GW-E, S1720GWR-E, S5720I-SI, S5720-LI, S5720S-LI, S5735S-H, S5736-S, and S6720S-S use the src-dst-ip, source TCP or UDP port number, and destination TCP or UDP port number in the hash algorithm for load balancing regardless of whether you configure this parameter.

Maximal BW
	

Maximum bandwidth.

Current BW
	

Current bandwidth.

The Maximum Frame Length
	

Maximum frame length allowed by the Eth-Trunk.

To specify the parameter, run the jumboframe enable command.

IP Sending Frames' Format
	

Format of frames sent through the IP protocol, which can be PKTFMT_ETHNT_2, Ethernet_802.3, or Ethernet_SNAP.

Hardware address
	

Device MAC address.

Current system time
	

Current system time.

If the time zone is configured and the daylight saving time is used, the time is in the format of YYYY/MM/DD HH:MM:SSHH:MM.

Last 300 seconds input rate
	

Received packet rate (bits per second and packets per second) within the last 300 seconds.

Last 300 seconds output rate
	

Sent packet rate (bits per second and packets per second) within the last 300 seconds.

Input
	

Total number of received packets.

Output
	

Total number of sent packets.

Unicast
	

Number of unicast packets received or sent by an Eth-Trunk.

Multicast
	

Number of multicast packets received or sent by an Eth-Trunk.

Broadcast
	

Number of broadcast packets received or sent by an Eth-Trunk.

Jumbo
	

Number of jumbo frames received or sent by the Eth-Trunk.

Discard
	

Number of packets discarded by the Eth-Trunk during physical layer detection.

Pause
	

Pause frame.

Total Error
	

Number of error packets discovered by the Eth-Trunk during physical layer detection.

CRC
	

Number of CRC error packets received by the Eth-Trunk.

Giants
	

Number of jumbo frames with the correct FCS received by the Eth-Trunk.

Jabbers
	

Number of jumbo frames with incorrect FCS received by the Eth-Trunk.

Fragments
	

Number of fragments received by the Eth-Trunk.

Runts
	

Number of undersized frames with the correct FCS received by the Eth-Trunk.

DropEvents
	

Number of received packets that are discarded due to GBP full or back pressure.

Alignments
	

Number of received frames with alignment errors.

Symbols
	

Number of received frames with coding errors.

Ignoreds
	

Number of received MAC control frames in which the OpCode is not PAUSE.

Frames
	

Number of packets with the incorrect 802.3 length.

Collisions
	

Number of sent packets. During packet transmission, 1 to 15 conflict events were generated.

ExcessiveCollisions
	

Number of packets that fail to be sent. During packet transmission, 16 conflict events were generated.

Late Collisions
	

Number of delayed packets sent by the Eth-Trunk. During packet transmission, conflict events were generated.

Deferreds
	

Number of delayed packets sent by the Eth-Trunk. During packet transmission, no conflict event was generated.

Buffers Purged
	

Number of packets aged in the cache because packets sent by the Eth-Trunk have been stored in the queue buffer for a long time.

Input bandwidth utilization
	

Inbound bandwidth usage.

Output bandwidth utilization
	

Outbound bandwidth usage.

PortName
	

Name of the Eth-Trunk member interface.

Status
	

Status of the Eth-Trunk member interface.
Manual mode:

    Up: indicates that the interface is properly started.

    Down: indicates that the interface becomes faulty.

LACP mode:

    Up: indicates that the interface is selected.

    Down: indicates that the interface is not selected.

Weight
	

Weight of a member interface for load balancing.

The Number of Ports in Trunk
	

Number of Eth-Trunk member interfaces.

The Number of UP Ports in Trunk
	

Number of Eth-Trunk member interfaces in Up state.
display lacp brief
Function

The display lacp brief command displays brief LACP information, including the LACP system priority and system ID.
Format

display lacp brief
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario
Devices at both ends of an Eth-Trunk compare LACP system priorities and system IDs to determine the Actor during LACP negotiation.

    By default, the LACP system priority is 32768, and the device with the smaller LACP system ID is used as the Actor.
    If LACP system priorities are changed using the lacp priority command, the device with the smaller LACP system priority is used as the Actor.

The display eth-trunk command can be used to check the LACP system priority and system ID only after an Eth-Trunk in LACP mode has been configured. This is inconvenient for network planning. To facilitate network planning, you can run the display lacp brief command to check the LACP system priority and system ID when no Eth-Trunk in LACP mode is configured.

Precautions

When two PEs join an E-Trunk, run the lacp e-trunk system-id command on the PEs to configure the same E-Trunk LACP system ID so that the CE considers the PEs to be one device. The E-Trunk LACP system ID configurations do not affect LACP system IDs of Eth-Trunks in LACP mode. The LACP system ID of an Eth-Trunk in LACP mode is the MAC address of the Ethernet interface on the device.

E-Trunk is supported by only the following models: S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S.
Example

# Display brief LACP information.

<HUAWEI> display lacp brief

System Priority:32768
System ID      :00e0-5958-ef00

Table 5-26 Description of the display lacp brief command output

Item
	

Description

System Priority
	

LACP system priority. To configure the LACP system priority, run the lacp priority command.

System ID
	

System ID, which is the bridge MAC address of the device.
display lacp statistics eth-trunk
Function

The display lacp statistics eth-trunk command displays statistics on received and sent Link Aggregation Control Protocol Data Units (LACPDUs) about an Eth-Trunk in LACP mode.
Format

display lacp statistics eth-trunk [ trunk-id [ interface interface-type interface-number ] ]
Parameters

Parameter
	

Description
	

Value

trunk-id
	

Specifies the ID of an Eth-Trunk.
	
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.

interface interface-type interface-number
	
Specifies the type and number of an interface.

    interface-type specifies the type of the interface.
    interface-number specifies the number of the interface.

	

-
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

This command can be used only when the Eth-Trunk works in LACP mode. To change the working mode of an Eth-Trunk to the LACP mode, run the mode lacp command in the Eth-Trunk interface view.

To view the statistics on a specific Eth-Trunk, ensure that the Eth-Trunk has been created. To view the statistics on a specified Eth-Trunk member interface, ensure that the interface is added to the Eth-Trunk.
Example

# Display the statistics on LACPDUs sent and received by member interface GigabitEthernet0/0/1 of Eth-Trunk 4.

<HUAWEI> display lacp statistics eth-trunk 4
 Eth-Trunk4's PDU statistic is:
 ------------------------------------------------------------------------------
 Port                    LacpRevPdu   LacpSentPdu  MarkerRevPdu  MarkerSentPdu
 GigabitEthernet0/0/2    20683        830          0             0
 GigabitEthernet0/0/3    16356        677          0             0
 GigabitEthernet0/0/1    7213         7213         0             0

# Display the statistics on LACPDUs sent and received by member interface GigabitEthernet0/0/1 of Eth-Trunk 4.

<HUAWEI> display lacp statistics eth-trunk 4 interface gigabitethernet 0/0/1
 GigabitEthernet0/0/1's PDU statistic is:
 ------------------------------------------------------------------------------
 Port                    LacpRevPdu   LacpSentPdu  MarkerRevPdu MarkerSentPdu
 GigabitEthernet0/0/1    7673         7673         0            0

Table 5-27 Description of the display lacp statistics eth-trunk command output

Item
	

Description

Port
	

Current member interface of the Eth-Trunk.

LacpRevPdu
	

Number of received LACPDUs.

LacpSentPdu
	

Number of sent LACPDUs.

MarkerRevPdu
	

Number of received MARKER packets.

MarkerSentPdu
	

Number of sent MARKER packets.
display load-balance-profile
Function

The display load-balance-profile command displays detailed information about a specified load balancing profile.

Only the S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

display load-balance-profile [ profile-name ]
Parameters

Parameter
	

Description
	

Value

profile-name
	

Specifies the name of a load balancing profile.
	

The value is a string of 1 to 31 characters.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

This command displays detailed information about a specified load balancing profile, including the load balancing mode of IPv4, IPv6, Layer 2, and MPLS packets.
Example

# Display detailed information about a specified load balancing profile.

<HUAWEI> display load-balance-profile abc
Load-balance-profile : abc
Packet    HashField
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
IPV4      sip         dip
IPV6      sip         dip
L2        smac        l2-protocol vlan        sport
MPLS      top-label   2nd-label

Trunk interface
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Eth-Trunk100

Table 5-28 Description of the display load-balance-profile command output

Item
	

Description

Load-balance-profile
	

Load balancing profile.

To specify the parameter, run the load-balance-profile command.

Packet
	

Packet type.

HashField
	

Load balancing mode in the load balancing profile.

You can run the ipv4 field, ipv6 field, l2 field, and mpls field commands to configure the load balancing mode for IPv4, IPv6, Layer 2, and MPLS packets respectively.

Trunk interface
	

Eth-Trunk that uses the load balancing profile, configured by the load-balance command.
display load-distribution active-linknumber-change
Function

The display load-distribution active-linknumber-change command displays the configuration when the number of interfaces in an Eth-Trunk where load balancing calculation is performed is configured.

Only the SS1720GW-E, S1720GWR-E, S5720-LI, S5720S-LI, and S5720I-SI support this command.
Format

display load-distribution active-linknumber-change [ interface Eth-Trunk trunk-id ]
Parameters
Parameter 	Description 	Value

interface Eth-Trunk trunk-id
	

Specifies the ID of an Eth-Trunk.
	

The ID of an Eth-Trunk must have been created.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

After the load-distribution active-linknumber-change command is used to configure the number of interfaces in an Eth-Trunk where load balancing calculation is performed, you can run the display load-distribution active-linknumber-change command to check the configuration.
Example

# Display the configuration when the number of interfaces in an Eth-Trunk where load balancing calculation is performed is configured.

<HUAWEI> display load-distribution active-linknumber-change interface Eth-Trunk 3
-------------------------------------------------------------------------------
Interface    Pre-linknumber    Post-linknumber
-------------------------------------------------------------------------------
Eth-Trunk3       2                  4
-------------------------------------------------------------------------------

Table 5-29 Description of the display load-distribution active-linknumber-change command output

Item
	

Description

Interface
	

Name of the Eth-Trunk.

Pre-linknumber
	

Number of active interfaces in an Eth-Trunk when the number of interfaces in an Eth-Trunk where load balancing calculation is performed is configured.

To configure the number of active interfaces in an Eth-Trunk when the number of interfaces in an Eth-Trunk where load balancing calculation is performed, run the load-distribution active-linknumber-change or load-distribution active-linknumber-change global command.

Post-linknumber
	

Number of interfaces in an Eth-Trunk where load balancing calculation is performed when the Eth-Trunk has active interfaces.

To configure the number of interfaces in an Eth-Trunk where load balancing calculation is performed when the Eth-Trunk has active interfaces, run the load-distribution active-linknumber-change or load-distribution active-linknumber-change global command.
display trunk index-map
Function

The display trunk index-map command displays the mapping between Eth-Trunk IDs and internal indexes.
Format

display trunk index-map
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

An ID is manually allocated to an Eth-Trunk during Eth-Trunk creation. For example, the ID of Eth-Trunk 1 is 1. In addition, the device also allocates an internal number, also called the index, to each Eth-Trunk. When allocating indexes, the device traverses indexes in ascending order. The unallocated index is used as the index of an Eth-Trunk; therefore, the mapping between Eth-Trunk IDs and indexes is unordered. You can use display trunk index-map to check the mapping between Eth-Trunk IDs and indexes.
Example

# Display the mapping between Eth-Trunk IDs and internal indexes.

<HUAWEI> display trunk index-map

Index   Interface Name

-----------------------------
1       Eth-Trunk10
2       Eth-Trunk20
3       Eth-Trunk5

Table 5-30 Description of the display trunk index-map command output

Item
	

Description

Index
	

Index of the Eth-Trunk.

Interface Name
	

Name of the Eth-Trunk.
display trunk resource
Function

The display trunk resource command displays trunk resources that have been used on a device.
Format

display trunk resource
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To view the number of trunk interfaces configured on a device and the number of member interfaces added to the trunk interfaces, run the display trunk resource command. The command output helps you learn about used trunk resources.
Example

# Display trunk resources used on a device.

<HUAWEI> display trunk resource
Number of configured trunk interfaces is : 4
Interface           Member Count
-----------------------------------------------------------
Eth-Trunk1          2
Eth-Trunk10         0
Eth-Trunk30         0
Eth-Trunk55         0 

Table 5-31 Description of the display trunk resource command output

Item
	

Description

Number of configured trunk interfaces is
	

Number of configured trunk interfaces.

Interface
	
Trunk interface type:

    Eth-Trunk

Member Count
	

Number of member interfaces added to a trunk interface.
display trunkfwdtbl eth-trunk
Function

The display trunkfwdtbl eth-trunk command displays the forwarding table of an Eth-Trunk.
Format

display trunkfwdtbl eth-trunk trunk-id
Parameters

Parameter
	

Description
	

Value

trunk-id
	

Specifies the ID of an Eth-Trunk.
	
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines
By default, an Eth-Trunk supports a maximum of eight physical member interfaces, which correspond to eight entries in the forwarding table. The eight entries correspond to HASH-KEY values 0 to 7. The system searches for outbound interfaces among active links based on HASH-KEY values.

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.
Example

# Display the forwarding table of Eth-Trunk 1. Eth-Trunk 1 has three active links.

<HUAWEI> display trunkfwdtbl eth-trunk 1
 Eth-Trunk1's forwarding table is:
GigabitEthernet0/0/1
GigabitEthernet0/0/2
GigabitEthernet0/0/3
GigabitEthernet0/0/1
GigabitEthernet0/0/2
GigabitEthernet0/0/3
GigabitEthernet0/0/1
GigabitEthernet0/0/2

Table 5-32 Description of the display trunkfwdtbl eth-trunk command output

Item
	

Description

Eth-Trunk1's forwarding table
	

Forwarding entry of an Eth-Trunk.
display trunkmembership eth-trunk
Function

The display trunkmembership eth-trunk command displays information about Eth-Trunk member interfaces.
Format

display trunkmembership eth-trunk trunk-id
Parameters

Parameter
	

Description
	

Value

trunk-id
	

Specifies the ID of an Eth-Trunk.
	
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

After an Eth-Trunk is successfully configured, you can run the display trunkmembership eth-trunk command to view the configuration of the Eth-Trunk and its member interfaces.

To monitor the status of an interface or locate an interface fault, you can use the display trunkmembership eth-trunk command to view detailed information about an Eth-Trunk and its member interfaces. The command output helps you can troubleshoot faults and check the member interface configuration.

Prerequisites

An Eth-Trunk has been correctly configured. If the Eth-Trunk is not created, the system displays an error when you run the display trunkmembership eth-trunk command.

Precautions

Before running the display trunkmembership eth-trunk command to view the configuration of the Eth-Trunk in LACP mode, ensure that the Eth-Trunk has been configured to work in LACP mode using the mode lacp command.
Example

# Display information about member interfaces of Eth-Trunk 2.

<HUAWEI> display trunkmembership eth-trunk 2
Trunk ID: 2
Used status: VALID
TYPE: ethernet
Working Mode : Normal
Number Of Ports in Trunk = 2
Number Of Up Ports in Trunk = 2
Operate status: up
Interface GigabitEthernet0/0/1, valid, operate up, weight=1
Interface GigabitEthernet0/0/2, valid, operate up, weight=1

Table 5-33 Description of the display trunkmembership eth-trunk command output

Item
	

Description

Trunk ID
	

ID of the Eth-Trunk.

Used status
	
Whether the Eth-Trunk is available:

    VALID: The Eth-Trunk is available.

    INVALID: The Eth-Trunk is unavailable.

TYPE
	

Type of an Eth-Trunk.

To specify the parameter, run the port link-type command.

Working Mode
	

Working mode of an Eth-Trunk.

    Normal: manual load balancing mode
    LACP: LACP mode

To specify the parameter, run the mode command.

Number Of Ports in Trunk
	

Number of interfaces that are added to the Eth-Trunk.

Number Of Up Ports in Trunk
	

Number of Up interfaces that are added to the Eth-Trunk.

Operate status
	
Eth-Trunk status:

    up

    down

Interface, valid, operate, weight
	
Detailed information about a member interface:

    Interface: indicates the interface type and number.

    valid: indicates that the interface is available.

    operate: indicates the status of the interface.

    weight: indicates the weight of the interface for load balancing.

eth-trunk
Function

The eth-trunk command adds an interface to an Eth-Trunk.

The undo eth-trunk command removes an interface from an Eth-Trunk.

By default, an interface does not belong to any Eth-Trunk.
Format

eth-trunk trunk-id [ mode { active | passive } ]

undo eth-trunk
Parameters

Parameter
	

Description
	

Value

trunk-id
	

Indicates the ID of an Eth-Trunk.
	

The value is an integer that ranges from 0 to 249.
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.

mode { active | passive }
	
Indicates the mode in which an Eth-Trunk member interface sends packets. This parameter is valid for only the Eth-Trunk in LACP mode. By default, the mode an Eth-Trunk member interface sends packets is active.

    active: indicates that an Eth-Trunk member interface proactively sends negotiation packets.
    passive: indicates that an Eth-Trunk member interface sends packets to negotiate with its remote end only after receiving a packet from its remote end.

	

-
Views

Ethernet interface view, GE interface view, XGE interface view, MultiGE interface view, 40GE interface view, 100GE interface view, 25GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

To improve the connection reliability and increase the bandwidth, you can use the eth-trunk command to bind multiple interfaces into an Eth-Trunk.

You can add an interface to an Eth-Trunk only after you run the interface Eth-Trunk command to create the Eth-Trunk.

An Eth-Trunk contains a maximum of 32 member interfaces on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, 16 member interfaces on the S5735S-H, S5736-S, and S6720S-S, and 8 member interfaces on all other models. Interfaces added to an Eth-Trunk are called member interfaces. On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.

When you add an Ethernet interface to an Eth-Trunk, the interface must use default settings of some attributes. Otherwise, the interface cannot be added to the Eth-Trunk. The attributes include:

    Link type
    VLAN that the interface belongs to
    VLAN mapping
    VLAN stacking
    QinQ protocol number
    Interface priority
    Whether the interface allows BPDUs to pass through
    MAC address learning
    Adding the interface to a multicast group statically
    Discarding broadcast packets
    Discarding unknown multicast packets
    Discarding unknown unicast packets
    Controllable multicast profile bound to the interface

The attributes on all member interfaces of an Eth-Trunk must be consistent and cannot be changed separately. If the preceding attributes of an Eth-Trunk are changed, the attributes of all the member interfaces are changed accordingly.

It is recommended that you run the shutdown (interface view) command to disable an interface before adding the interface to an Eth-Trunk. After adding interfaces at both ends of a link to an Eth-Trunk, run the undo shutdown (interface view) command to enable the interfaces. Otherwise, traffic interruption or broadcast storms may occur.

It is recommended that you run the shutdown (interface view) command to disable a member interface before running the undo eth-trunk command to remove the member interface from an Eth-Trunk.

The number of member interfaces of the Eth-Trunk on devices at both ends must be the same. The interfaces at both ends must be connected with straight-through cables.
Example

# Add GigabitEthernet0/0/1 to Eth-Trunk 2.

<HUAWEI> system-view
[HUAWEI] interface gigabitethernet 0/0/1
[HUAWEI-GigabitEthernet0/0/1] eth-trunk 2

eth-trunk load-balance mpls-l2-switched ip enable
Function

The eth-trunk load-balance mpls-l2-switched ip enable command configures an Eth-Trunk on an L2VPN transparent transmission node to perform load balancing based on the inner source and destination IP addresses of MPLS packets.

The undo eth-trunk load-balance mpls-l2-switched ip enable command restores the default load balancing mode of MPLS packets on an L2VPN transparent transmission node.

By default, an Eth-Trunk on an L2VPN transparent transmission node performs load balancing based on the outer source and destination IP addresses of MPLS packets.

Only the following models support this function: S5731-H, S5731S-H, S5732-H, S5731-S, S5731S-S, S6730-H, S6730S-H, S6730-S, S6730S-S.
Format

eth-trunk load-balance mpls-l2-switched ip enable

undo eth-trunk load-balance mpls-l2-switched ip enable
Parameters

None
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

In an L2VPN Eth-Trunk scenario, a transparent transmission node can load balance MPLS packets only based on the outer source and destination IP addresses of MPLS labels by default. To load balance MPLS packets based on the inner IP addresses of MPLS labels, run the eth-trunk load-balance mpls-l2-switched ip enable command.

Prerequisites

The load balancing mode of MPLS packets has been set to sip or dip in the load balancing profile for enhanced load balancing.

Precautions

After the eth-trunk load-balance mpls-l2-switched ip enable command is run on an L2VPN transparent transmission node, load balancing can be performed based on the inner IP addresses of labels. This command takes effect only on the L2VPN transparent transmission node. An Eth-Trunk on a P node or the egress node of a tunnel performs load balancing based on the load balancing mode specified in the load balancing profile for enhanced load balancing.

Follow-up Procedure

The corresponding Eth-Trunk interface must be bound to the load balancing profile for enhanced load balancing configured in Prerequisites.
Example

# Configure Eth-Trunk 1 to perform load balancing based on the inner source and destination IP addresses in MPLS packets.

<HUAWEI> system-view
[HUAWEI] load-balance-profile a
[HUAWEI-load-balance-profile-a] mpls field sip dip
[HUAWEI-load-balance-profile-a] quit
[HUAWEI] eth-trunk load-balance mpls-l2-switched ip enable
[HUAWEI] interface Eth-Trunk 1
[HUAWEI-Eth-Trunk1] load-balance enhanced profile a

e-trunk (Eth-Trunk interface view)
Function

The e-trunk command adds an Eth-Trunk in LACP mode to a specified E-Trunk.

The undo e-trunk command deletes an Eth-Trunk from a specified E-Trunk.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

e-trunk e-trunk-id [ remote-eth-trunk eth-trunk-id ]

undo e-trunk
Parameters
Parameter 	Description 	Value

e-trunk-id
	

Specifies the ID of an E-Trunk.
	

The value is an integer that ranges from 1 to 16.

remote-eth-trunk eth-trunk-id
	

Specifies the Eth-Trunk ID of the remote PE.

If the ID of the Eth-Trunk created on a PE is different from the ID of the Eth-Trunk created on the other PE, you must configure remote-eth-trunk when adding different Eth-Trunks in LACP mode to an E-Trunk so that the E-Trunk can work properly.
	

The value is an integer that ranges from 0 to 4294967295.
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

Only Eth-Trunks in LACP mode can be added to an E-Trunk, and an Eth-Trunk can be added to only one E-Trunk. If an Eth-Trunk is already added to an E-Trunk, you must delete it from the E-Trunk before adding it to another E-Trunk.

At most 64 Eth-Trunks in LACP mode can be added to an E-Trunk.

Precautions

    Only Eth-Trunk interfaces in LACP mode can be added to an E-Trunk.

    After an Eth-Trunk interface is added to an E-Trunk, to add the Eth-Trunk interface to another E-Trunk or modify the remote Eth-Trunk ID, first run the undo e-trunk command to delete the Eth-Trunk interface from the current E-Trunk and then run the e-trunk command.

    If the master Eth-Trunk interface in an E-Trunk encounters a link failure, the backup Eth-Trunk interface goes Down after the master Eth-Trunk interface is removed from the E-Trunk.

Example

# Add Eth-Trunk 1 to E-Trunk 1.

<HUAWEI> system-view
[HUAWEI] interface Eth-Trunk 1
[HUAWEI-Eth-Trunk1] e-trunk 1

e-trunk mode
Function

The e-trunk mode command configures a working mode of an Eth-Trunk in an E-Trunk.

The undo e-trunk mode command restores the default working mode of an Eth-Trunk in an E-Trunk.

By default, an Eth-Trunk works in automatic mode in an E-Trunk.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

e-trunk mode { auto | force-master | force-backup }

undo e-trunk mode
Parameters
Parameter 	Description 	Value

auto
	

Indicates the automatic mode.
	

-

force-master
	

Indicates the forcible master mode.
	

-

force-backup
	

Indicates the forcible backup mode.
	

-
Views

Eth-Trunk interface view, MultiGE interface view

Default Level

2: Configuration level
Usage Guidelines

The e-trunk mode command is valid only for the Eth-Trunks added to an E-Trunk. When the Eth-Trunk is deleted from the E-Trunk, the configuration is cancelled.

When the E-Trunk works properly, changing the interval for sending packets or timeout of hello packets will cause the E-Trunk to alternate between the master state and the backup state. You are advised to set the working mode of a member Eth-Trunk to forcible master/backup before changing the interval for sending packets or the timeout of hello packets. After the new configuration takes effect, restore the working mode to automatic.
Example

# Set the working mode of Eth-Trunk 1 in an E-Trunk to forcible master.

<HUAWEI> system-view
[HUAWEI] interface Eth-Trunk 1
[HUAWEI-Eth-Trunk1] e-trunk mode force-master

e-trunk port
Function

The e-trunk port command configures the UDP port number used to send and receive E-Trunk packets.

The undo e-trunk port command restores the default value.

By default, UDP port 1025 is used to send and receive E-Trunk packets.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

e-trunk port port-number

undo e-trunk port
Parameters
Parameter 	Description 	Value

port-number
	

Specifies the UDP port number used to send and receive E-Trunk packets.

If the UDP port number in the range of 1025 to 65535 is used by another protocol, the port number cannot be used to send or receive E-Trunk packets.
NOTE:

UDP port numbers 49152 to 65535 are allocated randomly by the socket. Do not configure the UDP port number in this range; otherwise, the E-Trunk cannot work properly.
	

The value is an integer that ranges from 1025 to 65535.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

E-Trunk is a Huawei proprietary protocol. UDP port 1025 used to send and receive E-Trunk packets may conflict with the UDP port used by another protocol. To ensure that E-Trunk packets are forwarded correctly, run the e-trunk port command to change the UDP port number used to send and receive E-Trunk packets.

Precautions

The port numbers at both ends of an E-Trunk must be consistent. When the E-Trunk works properly, you must change the UDP port number within the timeout of E-Trunk negotiation.

If you change the UDP port number during E-Trunk running, devices at both ends of an E-Trunk may be unable to communicate. If E-Trunk negotiation times out, both devices in the E-Trunk may become master devices.
Example

# Configure the UDP port number used to send and receive E-Trunk packets.

<HUAWEI> system-view

[HUAWEI] e-trunk port 1026

e-trunk (system view)
Function

The e-trunk command creates an E-Trunk.

The undo e-trunk command deletes an E-Trunk.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

e-trunk e-trunk-id

undo e-trunk e-trunk-id
Parameters
Parameter 	Description 	Value

e-trunk-id
	

Specifies the ID of an E-Trunk.
	

The value is an integer that ranges from 1 to 16.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

If the specified E-Trunk already exists, this command directly displays the view of the specified E-Trunk.

At most 16 E-Trunks can be created on a device.

After an E-Trunk is created, it does not send protocol packets until the remote IP address is configured.
Example

# Create an E-Trunk with the ID of 1.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1]

e-trunk track bfd-session
Function

The e-trunk track bfd-session command binds a BFD session to an E-Trunk.

The undo e-trunk track bfd-session command unbinds a BFD session from an E-Trunk.

By default, no BFD session is bound to an E-Trunk.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

e-trunk track bfd-session session-name bfd-session-name

undo e-trunk track bfd-session
Parameters
Parameter 	Description 	Value

session-name bfd-session-name
	

Specifies the name of a BFD session.
	

The value is a string of 1 to 15 case-insensitive characters without spaces. When the string is enclosed with double quotation marks (""), spaces are allowed in the string.
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

PE1 and PE2 are connected through an E-Trunk. PE1 is in master state and PE2 is in slave state. When PE1 fails and PE2 does not receive any E-Trunk protocol packets from PE1 after the timer expires, PE2 switches from the slave state to the master state.

The status of PE2 changes after the timer expires. During the timeout, user traffic is interrupted. To enable PE2 to rapidly detect the fault and switch its status, run this command to bind a BFD session to an E-Trunk.

After the BFD session is bound to the E-Trunk, the BFD session can rapidly detect the link between PE1 and PE2. If the link fails, the BFD session becomes Down. PE2 then can detect the BFD session status and switch its status to master so that traffic is correctly forwarded.

In this scenario, the Eth-Trunk on PE1 and PE2 supports only one member interface.

Prerequisites
Before using this command, pay attention to the following points:

    An E-Trunk and a BFD session must have been configured. BFD for IP must be used; otherwise, the E-Trunk cannot rapidly detect the fault through the BFD session.
    The IP addresses of both ends of the E-Trunk must be reachable; otherwise, the BFD session cannot go Up. That is, the BFD session cannot detect the link between PE1 and PE2.

Precautions

After a BFD session is bound to an E-Trunk and AC interfaces on both devices of the E-Trunk are associated with the BFD session, if the AC interface of the master device fails, the BFD session goes Down and traffic is switched to the standby link. If the AC interface recovers within 60 seconds, traffic is immediately switched back to the active link.
Example

# Bind a BFD session named hello to E-Trunk 1.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1] e-trunk track bfd-session session-name hello

interface eth-trunk
Function

The interface eth-trunk command displays the view of an existing Eth-Trunk or creates an Eth-Trunk and displays its view.

The undo interface eth-trunk command deletes an Eth-Trunk.

By default, no Eth-Trunk is created.
Format

interface eth-trunk trunk-id[.subnumber ]

undo interface eth-trunk trunk-id[.subnumber ]
Parameters

Parameter
	

Description
	

Value

trunk-id
	

Specifies the ID of an Eth-Trunk.
	
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.

subnumber
	

Specifies the ID of an Eth-Trunk sub-interface.
	

The value is an integer that ranges from 1 to 4096.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

If the specified Eth-Trunk already exists, the interface eth-trunk command directly displays the view of the specified Eth-Trunk.

You can delete an Eth-Trunk only when the Eth-Trunk does not contain any member interface.

    Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support Ethernet sub-interfaces.
    Only hybrid and trunk interfaces on the preceding switches support Layer 2 Ethernet sub-interface configuration.

    After you run the undo portswitch command to switch Layer 2 interfaces on the preceding series of switches into Layer 3 interfaces, you can configure Layer 3 Ethernet sub-interfaces on the interfaces.

    After an interface is added to an Eth-Trunk, sub-interfaces cannot be configured on the interface.
    VLAN termination sub-interfaces cannot be created on a VCMP client.

Example

# Create Eth-Trunk 2.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 2
[HUAWEI-Eth-Trunk2]

ipv4 field
Function

The ipv4 field command configures a load balancing mode of IPv4 packets in a load balancing profile.

The undo ipv4 field command deletes a load balancing mode of IPv4 packets or restores the default load balancing mode of IPv4 packets.

By default, load balancing of IPv4 packets is based on the source IP address (sip) and destination IP address (dip).

Only the S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

ipv4 field [ dip | l4-dport | l4-sport | protocol | sip | sport | vlan ] *

undo ipv4 field [ dip | l4-dport | l4-sport | protocol | sip | sport | vlan ] *

Only dip, sip, and sport are supported on the S5736-S.
Parameters

Parameter
	

Description
	

Value

dip
	

Performs load balancing based on destination IP addresses in IPv4 packets.
	

-

l4-dport
	

Performs load balancing based on transport-layer destination port numbers in IPv4 packets.
	

-

l4-sport
	

Performs load balancing based on transport-layer source port numbers in IPv4 packets.
	

-

protocol
	

Performs load balancing based on protocol types in IPv4 packets.
	

-

sip
	

Performs load balancing based on source IP addresses in IPv4 packets.
	

-

sport
	

Performs load balancing based on physical-layer source port numbers in IPv4 packets.
	

-

vlan
	

Performs load balancing based on VLAN IDs in IPv4 packets.
	

-
Views

Load balancing profile view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The undo ipv4 field command with no parameter specified restores the default load balancing mode of IPv4 packets. The undo ipv4 field command with a parameter specified deletes a specified load balancing mode of IPv4 packets.

Precautions

If you run the ipv4 field command multiple times, only the latest configuration takes effect.

On S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S switches, if l4-dport or l4-sport is specified for L2TP packets, load balancing is performed based on session id and tunnel id in L2TP packets rather than l4-dport and l4-sport.

On S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S switches, if l4-dport or l4-sport is specified for GTP packets, both outer and inner IP information are parsed when load balancing is performed for GTP packets; if another parameter is specified, only the outer IP information is parsed when load balancing is performed for GTP packets. For other switches, only the outer IP information of GTP packets is parsed when load balancing is performed.
Example

# In the load balancing profile a, set the load balancing mode of IPv4 packets to sip and protocol, that is, load balancing based on source IP addresses and protocol types of IPv4 packets.

<HUAWEI> system-view
[HUAWEI] load-balance-profile a
[HUAWEI-load-balance-profile-a] ipv4 field sip protocol

ipv6 field
Function

The ipv6 field command configures a load balancing mode of IPv6 packets in a load balancing profile.

The undo ipv6 field command deletes the load balancing mode of IPv6 packets or restores the default load balancing mode of IPv6 packets.

By default, load balancing of IPv6 packets is based on the source IP address (sip) and destination IP address (dip).

Only the S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

ipv6 field [ dip | l4-dport | l4-sport | protocol | sip | sport | vlan ] *

undo ipv6 field [ dip | l4-dport | l4-sport | protocol | sip | sport | vlan ] *

Only dip, l4-dport, l4-sport, sip, and sport are supported on the S5735S-H, S5736-S, andS6720S-S.
Parameters

Parameter
	

Description
	

Value

dip
	

Performs load balancing based on destination IP addresses in IPv6 packets.
	

-

l4-dport
	

Performs load balancing based on transport-layer destination port numbers in IPv6 packets.
	

-

l4-sport
	

Performs load balancing based on transport-layer source port numbers in IPv6 packets.
	

-

protocol
	

Performs load balancing based on protocol types in IPv6 packets.
	

-

sip
	

Performs load balancing based on source IP addresses in IPv6 packets.
	

-

sport
	

Performs load balancing based on physical-layer source port numbers in IPv6 packets.
	

-

vlan
	

Performs load balancing based on VLAN IDs in IPv6 packets.
	

-
Views

Load balancing profile view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The undo ipv6 field command with no parameter specified restores the default load balancing mode of IPv6 packets. The undo ipv6 field command with a parameter specified deletes a specified load balancing mode of IPv6 packets.

Precautions

If you run the ipv6 field command multiple times, only the latest configuration takes effect.

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S switches, if l4-dport or l4-sport is specified for L2TP packets, load balancing is performed based on session id and tunnel id in L2TP packets rather than l4-dport and l4-sport.
Example

# In the load balancing profile a, set the load balancing mode of IPv6 packets to sip and protocol, that is, load balancing based on source IP addresses and protocol types of IPv6 packets.

<HUAWEI> system-view
[HUAWEI] load-balance-profile a
[HUAWEI-load-balance-profile-a] ipv6 field sip protocol

l2 field
Function

The l2 field command configures a load balancing mode of Layer 2 packets in a load balancing profile.

The undo l2 field command deletes the load balancing mode of Layer 2 packets or restores the default load balancing mode of Layer 2 packets.

By default, load balancing of Layer 2 packets is based on the source MAC address (smac) and destination MAC address (dmac).

Only the S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

l2 field [ dmac | l2-protocol | smac | sport | vlan ] *

undo l2 field [ dmac | l2-protocol | smac | sport | vlan ] *

Only dmac, smac, and sport are supported on the S5735S-H, S5736-S, and S6720S-S.
Parameters

Parameter
	

Description
	

Value

dmac
	

Performs load balancing based on destination MAC addresses in Layer 2 packets.
	

-

l2-protocol
	

Performs load balancing based on protocol types in Layer 2 packets.
	

-

smac
	

Performs load balancing based on source MAC addresses in Layer 2 packets.
	

-

sport
	

Performs load balancing based on physical-layer source port numbers in Layer 2 packets.
	

-

vlan
	

Performs load balancing based on VLAN IDs in Layer 2 packets.
	

-
Views

Load balancing profile view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The undo l2 field command with no parameter specified restores the default load balancing mode of Layer 2 packets. The undo l2 field command with a parameter specified deletes a specified load balancing mode of Layer 2 packets.

Precautions

If you run the l2 field command multiple times, only the latest configuration takes effect.
Example

# In the load balancing profile a, set the load balancing mode of Layer 2 packets to l2-protocol, that is, load balancing based on protocol types of Layer 2 packets.

<HUAWEI> system-view
[HUAWEI] load-balance-profile a
[HUAWEI-load-balance-profile-a] l2 field l2-protocol

lacp collector delay
Function

The lacp collector delay command configures the value of the CollectorMaxDelay field in an LACPDU.

The undo lacp collector delay command restores the default value of the CollectorMaxDelay field in an LACPDU.

The default value of the CollectorMaxDelay field is 0 in an LACPDU.
Format

lacp collector delay delay-time

undo lacp collector delay
Parameters
Parameter 	Description 	Value

delay-time
	

Specifies the value of the CollectorMaxDelay field in an LACPDU.
	

The value is an integer that ranges from 0 to 65535, in 10 microseconds.
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The default value of the CollectorMaxDelay field in LACPDUs sent by the device of different versions to the connected non-Huawei device is different. This may cause high CPU usage. You can run the lacp collector delay command to set the value of the CollectorMaxDelay field in LACPDUs.

Prerequisites

The Eth-Trunk has been configured to work in LACP mode using the mode lacp command.

Precautions

For a Huawei device, the valid value range of the CollectorMaxDelay field is 0 to 65535. Even though the member interfaces of the same Eth-Trunk receive LACPDUs with different CollectorMaxDelay values, the device can process the LACPDUs without deteriorating its CPU performance.
Example

# Set the value of the CollectorMaxDelay field to 65535.

<HUAWEI> system-view

[HUAWEI] interface eth-trunk 1

[HUAWEI-Eth-Trunk1] mode lacp

[HUAWEI-Eth-Trunk1] lacp collector delay 65535

lacp e-trunk priority
Function

The lacp e-trunk priority command sets the LACP priority of an E-Trunk.

The undo lacp e-trunk priority command cancels the configuration.

By default, the LACP priority of an E-Trunk is 32768.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

lacp e-trunk priority priority

undo lacp e-trunk priority
Parameters
Parameter 	Description 	Value

priority
	

Specifies the LACP priority of an E-Trunk.
	

The value is an integer that ranges from 0 to 65535. A smaller value indicates a higher LACP priority.
Views

System view, Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

The lacp e-trunk priority command sets the LACP priority of an E-Trunk. If the LACP priority is set, a member Eth-Trunk sends LACPDUs by using this LACP priority. If the LACP priority is not set, the default LACP priority 32768 is used.

The master and backup devices in an E-Trunk must use the same LACP priority.

When multiple E-Trunks are configured on the device, different LAGs can use different LACP priorities. You need to set the LACP priorities in the Eth-Trunk interface view.

The LACP priority configured in the system view is valid for all Eth-Trunks added to the E-Trunk. The LACP priority configured in the Eth-Trunk view takes effect only on the corresponding Eth-Trunk. If the LACP priorities are configured in both the Eth-Trunk interface view and system view, the LACP priority configured in the interface view takes effect.

Ensure that the Eth-Trunk has been added to the E-Trunk before you run the lacp e-trunk priority command in the Eth-Trunk interface view.
Example

# Set the LACP priority of the E-Trunk to 1.

<HUAWEI> system-view
[HUAWEI] lacp e-trunk priority 1

lacp e-trunk system-id
Function

The lacp e-trunk system-id command sets the LACP system ID of an E-Trunk.

The undo lacp e-trunk system-id command cancels the configuration.

By default, the LACP system ID in the system view is the MAC address of the Ethernet interface.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

lacp e-trunk system-id mac-address

undo lacp e-trunk system-id
Parameters
Parameter 	Description 	Value

system-id mac-address
	

Specifies the LACP system ID of an E-Trunk.
	

The value is in the format of H-H-H. An H contains 1 to 4 hexadecimal numbers, such as 00e0 and fc01. If you enter fewer than four digits, 0s are prefixed to the input digits. For example, if you enter e0, the system changes e0 to 00e0. The LACP system ID cannot be all 0s or all Fs.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

The lacp e-trunk system-id command sets the LACP system ID of an E-Trunk. If the system ID is set, a member Eth-Trunk sends LACPDUs by using this system ID. If the LACP system ID is not set, the MAC address of the Ethernet interface is used as the system ID.

The master and backup devices in an E-Trunk must use the same LACP system ID.
Example

# Set the LACP system ID of the E-Trunk to 00E0-FC00-0000.

<HUAWEI> system-view
[HUAWEI] lacp e-trunk system-id 00E0-FC00-0000

lacp force-switch
Function

The lacp force-switch command enables forcible switching when no preemption is configured for an Eth-Trunk interface in LACP mode or preemption is enabled but the delay is not reached.

By default, the switch does not enable forcible switching.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

lacp force-switch
Parameters

None
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario
Figure 5-1 Eth-Trunk interface in LACP mode

As shown in Figure 5-1, when no service is bound to the MA (Maintenance Association), an Eth-Trunk interface in LACP mode is configured on two devices. interface1 where the MEP (Maintenance End Point) resides is the interface of the Eth-Trunk interface's primary link. When the delay-measure two-way trigger if-down or loss-measure single-ended-synthetic trigger if-down command is configured on interface1, interface1 is triggered to go ETHOAM down if Y.1731 detects that the primary link has poor quality. To ensure that services are not interrupted, run the lacp track interface command in the Eth-Trunk member interface view to increase the priority of the secondary member interface interface2. The secondary link then preempts the primary state, implementing an automatic primary/secondary link switchover.

When the primary link's quality recovers, run the lacp force-switch command to enable forcible switching if no preemption is configured or preemption is enabled but the delay is not reached.

Prerequisites

The lacp track interface command has been run to associate the secondary member interface of an Eth-Trunk interface in LACP mode with its primary member interface and to dynamically change the priority of the secondary member interface.

Precautions

An Eth-Trunk interface can have only two member interfaces. The maximum number of active links must be 1.
Example

# Enable forcible switching on Eth-Trunk 1.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] lacp force-switch

lacp force-forward
Function

The lacp force-forward command configures an Eth-Trunk member interface in Up state to forward data packets when the remote interface does not join the Eth-Trunk.

The undo lacp force-forward command restores the default setting.

By default, an Eth-Trunk member interface in Up state cannot forward data packets when the remote interface does not join the Eth-Trunk.
Format

lacp force-forward

undo lacp force-forward
Parameters

None
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario
Figure 5-2 A switch directly connects to a server
In Figure 5-2, two interfaces of two network adapters on a server are directly connected to a switch. The switch is configured with an Eth-Trunk in LACP mode. The process on the server is as follows:

    The server configures an IP address for Interface1 based the default configuration during startup, and sends a request to the remote file server through Interface1 and downloads the configuration file from the remote file server.
    After the configuration file is downloaded successfully, the server aggregates two interfaces according to the configuration file. The server uses the two interfaces as Eth-Trunk member interfaces to perform LACP negotiation with the switch.

Before the server obtains the configuration file, Interface1 is an independent physical interface and is not configured with LACP. As a result, LACP negotiation on the switch interface fails. The switch does not forward traffic on the Eth-Trunk, and the server cannot download the configuration file through Interface1. In this case, the server cannot communicate with the switch.

To address this issue, run the lacp force-forward command on the Eth-Trunk of the switch. The Eth-Trunk member interface in Up state can still forward data packets even though the remote device is not enabled with LACP.

Prerequisites

The Eth-Trunk has been configured to work in LACP mode by using the mode lacp command.

Precautions

    With this command configured, an Eth-Trunk interface does not support Layer 3 forwarding and cannot be used to forward packets sent to the CPU. Only member interfaces in the ForceFwd state can forward Layer 2 traffic through hardware forwarding. The ForceFwd state is automatically set when LACP negotiation fails, and cannot be changed manually. You can use the display eth-trunk command to check the value of the Status field.
    This command applies to only the scenario where an Eth-Trunk joins a VLAN as an access, hybrid, trunk, and dot1q-tunnel interfaces.
    When a spanning tree protocol (for example, STP, RSTP, or MSTP) is used, the member interface in ForceFwd state cannot be blocked. That is, the member interface in ForceFwd state can continue to forward data packets. When other loop prevention protocols such as ERPS and RRPP are used, the member interface in ForceFwd state can be blocked. The blocked member interface in ForceFwd state cannot forward data packets.
    This command cannot be used with E-Trunk. That is, this command cannot be used on the Eth-Trunk that joins an E-Trunk.
    This command cannot be used with max active-linknumber or least active-linknumber.

Example

# Configure an Eth-Trunk member interface in Up state to forward data packets when the remote interface does not join the Eth-Trunk.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] mode lacp
[HUAWEI-Eth-Trunk1] lacp force-forward

lacp optimized-converge enable
Function

The lacp optimized-converge enable command enables optimized LACP convergence.

The undo lacp optimized-converge enable command disables optimized LACP convergence.

By default, optimized LACP convergence is disabled.
Format

lacp optimized-converge enable

undo lacp optimized-converge enable
Parameters

None
Views

System view
Default Level

2: Configuration level
Usage Guidelines

When the working mode of an Eth-Trunk interface is set to LACP, Eth-Trunk member interfaces are configured to forward traffic after LACP negotiation and instruct services to reselect a route. Service traffic then can be properly forwarded. However, when multiple cards are restarted at the same time, Eth-Trunk member interfaces negotiate in preemption mode. As a result, Eth-Trunk member interfaces negotiate slowly, causing a large number of service packets to be lost.

After optimized LACP convergence is enabled using the lacp optimized-converge enable command, the device increases the LACP negotiation priority so that services can quickly detect Eth-Trunk member interface changes, accelerating Eth-Trunk traffic convergence.
Example

# Enable optimized LACP convergence.

<HUAWEI> system-view
[HUAWEI] lacp optimized-converge enable

lacp preempt delay
Function

The lacp preempt delay command sets the LACP preemption delay.

The undo lacp preempt delay command restores the default LACP preemption delay.

By default, the LACP preemption delay is 30 seconds.
Format

lacp preempt delay delay-time

undo lacp preempt delay
Parameters

Parameter
	

Description
	

Value

delay-time
	

Specifies the LACP preemption delay.
	

The value is an integer that ranges from 0 to 180 on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, 10 to 180 on other models, in seconds.
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

To use this command, ensure that the following conditions are met:

    The Eth-Trunk has been configured to work in LACP mode using the mode lacp command in the Eth-Trunk interface view.
    Priority preemption has been enabled on the Eth-Trunk using the lacp preempt enable command in the Eth-Trunk interface view.

Link A replaces link B and becomes active after the preemption delay n the following situation:

    LACP priority preemption is enabled and the lacp preempt delay command is used.
    The faulty link (link A) with higher priority than that of the current active link (link B) recovers.
    The number of current active links reaches the upper threshold.

If both devices of an Eth-Trunk use different preemption delays, a longer preemption delay is used. If priority preemption is enabled but the preemption delay is not set, the interface with a higher priority preempts the interface with a lower priority according to the default preemption delay.
Example

# Set the LACP preemption delay of Eth-Trunk 1 to 20 seconds.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] mode lacp
[HUAWEI-Eth-Trunk1] lacp preempt delay 20

lacp preempt enable
Function

The lacp preempt enable command enables priority preemption for an Eth-Trunk in LACP mode.

The undo lacp preempt enable command disables priority preemption for an Eth-Trunk in LACP mode.

By default, priority preemption is disabled.
Format

lacp preempt enable

undo lacp preempt enable
Parameters

None
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenarios

In LACP mode, when one of the active links fails, the system selects the link with the highest priority from backup links to replace the faulty one. When the faulty link recovers, the priority of this link is higher than the priority of the link that replaces itself, and priority preemption is enabled, the link becomes active again.

If priority preemption is disabled, the system does not re-select any active interface. The recovered link functions as the backup one.

When priority preemption is enabled, the system selects an active interface based on the LACP interface priority on the Actor.

Prerequisites

The LACP mode must have been configured using the mode lacp command in the Eth-Trunk interface view.

Precautions

To ensure that an Eth-Trunk works properly, enable or disable LACP preemption on both ends of the Eth-Trunk.
Example

# Enable priority preemption on Eth-Trunk 1.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] mode lacp
[HUAWEI-Eth-Trunk1] lacp preempt enable

lacp priority
Function

The lacp priority command sets the LACP system or interface priority.

The undo lacp priority command restores the default LACP system or interface priority.

By default, the LACP system or interface priority is 32768.
Format

lacp priority priority

undo lacp priority
Parameters

Parameter
	

Description
	

Value

priority
	

Specifies the LACP priority. A smaller value indicates a higher LACP priority.
	

The value is an integer that ranges from 0 to 65535.
Views

System view, Ethernet interface view, GE interface view, 25GE interface view, XGE interface view, MultiGE interface view, 40GE interface view, 100GE interface view, port group view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The LACP system priority is used to differentiate the local device and the remote device. The device of a higher LACP system priority is selected as the Actor of the link aggregate group (LAG), and active interfaces are selected according to interfaces of the Actor.

The LACP interface priority is used to differentiate interfaces on a device. The interface of a higher priority is selected as the active interface.

If devices at both ends of an Eth-Trunk are not configured with LACP system priorities, the devices use the default LACP system priority 32768 and the device with a smaller MAC address is selected as the Actor.

If priorities of different interfaces on a switch are not set, the default priority of interfaces is all 32768. Active interfaces are selected based on interface numbers and interfaces with smaller interface numbers are preferred.

Prerequisites

The interface has been added to the Eth-Trunk in LACP mode.

You can run the mode lacp command in the Eth-Trunk interface view to change the working mode of an Eth-Trunk to LACP.

Precautions

In LACP mode, active interfaces selected by devices at both ends of an Eth-Trunk link must be the same; otherwise, the link aggregation group cannot be set up.

If the max active-linknumber command is executed in LACP mode to set the upper threshold for the number of active interfaces, you need to determine the active interfaces when the number of interfaces manually added to an LAG exceeds the upper threshold. Setting the LACP interface priority ensures that interfaces with higher priorities become active ones in LACP mode.

If the max active-linknumber command is not used, the upper threshold for the number of active interfaces is 8. When the number of interfaces manually added to an LAG is smaller than 8, you do not need to select active interfaces because all interfaces are active.

If the max active-linknumber link-number command is run in the Eth-Trunk interface view, you need to run the lacp preempt enable command to enable LACP preemption on the current Eth-Trunk interface. Otherwise, interfaces with high LACP priorities may fail to be selected as active interfaces.
Example

# Set the LACP system priority to 1.

<HUAWEI> system-view
[HUAWEI] lacp priority 1

# Set the LACP priority of GigabitEthernet0/0/1 to 1.

<HUAWEI> system-view
[HUAWEI] interface gigabitethernet0/0/1
[HUAWEI-GigabitEthernet0/0/1] lacp priority 1

lacp priority-command-mode
Function

The lacp priority-command-mode command sets a Link Aggregation Control Protocol (LACP) system priority configuration mode.

The undo lacp priority-command-mode command restores the default LACP system priority configuration mode.

By default, the LACP system priority configuration mode is default.
Format

lacp priority-command-mode { default | system-priority }

undo lacp priority-command-mode
Parameters
Parameter 	Description 	Value
default 	

Sets the LACP system priority configuration mode to default.

In default mode, the LACP system priority is configured using the lacp priority command in the system view.
	-
system-priority 	

Sets the LACP system priority configuration mode to system-priority.

In system-priority mode, the LACP system priority is configured using the lacp system-priority command in the system view.
	-
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

A change in the LACP system priority will cause LACP renegotiation. During the renegotiation process, Eth-Trunk interfaces in LACP mode will go Down until the renegotiation succeeds, which may interrupt services. If the lacp priority command used to set the LACP interface priority is executed in the system view, the Eth-Trunk in LACP mode may alternate between Up and Down. To prevent this situation, run the lacp priority-command-mode command in the system view to set the configuration mode of the LACP system priority to system-priority. This mode can be used to differentiate the LACP system priority and LACP interface priority.

Precautions
When running the lacp priority-command-mode command, note the following points:

    If you specify default in the command, the LACP system priority and LACP interface priority configurations still use the same command (lacp priority priority).
    If you specify system-priority in the command, run the lacp system-priority priority command to configure the LACP system priority and run the lacp priority priority command to configure the LACP interface priority.

Example

# Set the LACP system priority configuration mode to system-priority.

<HUAWEI> system-view
[HUAWEI] lacp priority-command-mode system-priority

lacp selected
Function

The lacp selected command configures a mode for selecting active interfaces of an Eth-Trunk in LACP mode.

The undo lacp selected command restores the default mode for selecting active interfaces of an Eth-Trunk in LACP mode.

By default, active interfaces are selected based on the LACP interface priority.
Format

lacp selected { priority | speed }

undo lacp selected
Parameters
Parameter 	Description 	Value
priority 	Indicates that active interfaces are selected based on the LACP interface priority. The interfaces with high priorities are preferentially selected as active interfaces. 	-
speed 	Indicates that active interfaces are selected based on the interface rate. High-speed interfaces are preferentially selected as active interfaces. 	-
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

As defined in LACP, active interfaces are selected based on the LACP interface priority by default. If member interfaces of an Eth-Trunk in LACP mode work at different rates, low-speed interfaces may be selected as active interfaces. To enable the device to select high-speed interfaces as active interfaces, run the lacp selected command to set the mode of selecting active interfaces to speed.

To enable the device to select active interface based on the LACP interface priority, run the lacp selected priority command to set the mode of selecting active interfaces to priority.

Prerequisites

The Eth-Trunk has been configured to work in LACP mode using the mode lacp command in the Eth-Trunk interface view.

Precautions

Active interfaces are selected based on the LACP interface priority by default. Changing the mode for selecting active interfaces may cause service interruptions for a short time. You are advised not to change the mode for selecting active interfaces during service transmission.

You are advised not to bundle interfaces working at different rates into an Eth-Trunk in LACP mode because the priority preemption function may become ineffective.
Example

# Configure Eth-Trunk 1 in LACP mode and configure the device to select active interfaces based on the interface rate.

<HUAWEI> system-view

[HUAWEI] interface Eth-Trunk 1

[HUAWEI-Eth-Trunk1] mode lacp

[HUAWEI-Eth-Trunk1] lacp selected speed

lacp src-mac
Function

The lacp src-mac command configures an interface or system MAC address as an LACPDU's source MAC address.

The undo lacp src-mac command restores the default source MAC address.

By default, the system MAC address is used as an LACPDU's source MAC address.
Format

lacp src-mac { bridge | port }

undo lacp src-mac
Parameters
Parameter 	Description 	Value

bridge
	

Configures the system MAC address as an LACPDU's source MAC address.
	

-

port
	

Configures an interface MAC address as an LACPDU's source MAC address.
	

-
Views

System view
Default Level

2: Configuration level
Usage Guidelines

When a Huawei device connects to a non-Huawei device through Eth-Trunk interfaces in static LACP mode, if the Huawei device uses the default system MAC address, whereas the non-Huawei device uses the MAC addresses of the Eth-Trunk member interfaces as LACPDUs' source MAC addresses, the non-Huawei device may consider the received LACPDUs with the same MAC address invalid and therefore discard them, leading to an LACP negotiation failure.

To ensure a successful LACP negotiation, run the lacp src-mac port command to configure the Huawei device to use interface MAC addresses as LACPDUs' source MAC addresses.
Example

# Configure interface MAC addresses as LACPDUs' source MAC addresses.

<HUAWEI> system-view
[HUAWEI] lacp src-mac port

lacp system-id
Function

The lacp system-id command configures a Link Aggregation Control Protocol (LACP) system ID for an Eth-Trunk.

The undo lacp system-id command restores the default configuration.

By default, the system bridge MAC address functions as the LACP system ID of an Eth-Trunk.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

lacp system-id mac-address

undo lacp system-id [ mac-address ]
Parameters
Parameter 	Description 	Value

mac-address
	

Specifies the LACP system ID of an Eth-Trunk.
	

The value is in the format of H-H-H. Each H is a 4-digit hexadecimal number. You can enter 1 to 4 digits, such as 00e0 or fc01. If an H contains fewer than four digits, 0s are added ahead. For example, e0 is equal to 00e0.
NOTE:

The LACP system ID of an Eth-Trunk cannot be all 0s.
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

When multiple E-Trunks are configured on the device, the link aggregation groups can use different LACP system IDs. You need to run the lacp system-id mac-address command to set the LACP system ID.

The LACP system ID configured using the lacp e-trunk system-id command in the system view is valid for all Eth-Trunks that are added to the E-Trunk. The LACP system ID configured using the lacp system-id mac-address command in the Eth-Trunk interface view is valid for only the Eth-Trunk. If the LACP system ID is configured in both the Eth-Trunk interface view and system view, the system ID configured in the Eth-Trunk interface view takes effect.

Prerequisites

The Eth-Trunk has been configured to work in LACP mode using the mode lacp command.
Example
# Configure 00e0-fc00-0000 as the LACP system ID of Eth-Trunk 10.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 10
[HUAWEI-Eth-Trunk10] mode lacp
[HUAWEI-Eth-Trunk10] lacp system-id 00e0-fc00-0000

lacp system-priority
Function

The lacp system-priority command configures a Link Aggregation Control Protocol (LACP) system priority.

The undo lacp system-priority command restores the default LACP system priority.

The default LACP system priority is 32768.
Format

lacp system-priority priority

undo lacp system-priority
Parameters
Parameter 	Description 	Value
priority 	Specifies an LACP system priority. 	The value is an integer ranging from 0 to 65535. A smaller value indicates a higher LACP priority.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The system priority is set to differentiate the priority of the local device and the peer device. The system of a higher priority is selected as the Actor of the link aggregate group (LAG), and active interfaces are selected according to interfaces of the Actor.

If the devices on both ends of the Eth-Trunk are not configured with system priorities, the devices use the default priority 32768. In this case, the Actor is selected according to the system MAC. The system with a smaller MAC is selected as the Actor.

A change in the LACP system priority will cause LACP renegotiation. During the renegotiation process, Eth-Trunk interfaces in LACP mode will go Down until the renegotiation succeeds, which may interrupt services. If the lacp priority command used to set the LACP interface priority is executed in the system view, the Eth-Trunk in LACP mode may alternate between Up and Down. To prevent this situation, run the lacp priority-command-mode command in the system view to set the configuration mode of the LACP system priority to system-priority. This mode can be used to differentiate the LACP system priority and LACP interface priority.
When running the lacp priority-command-mode command, note the following points:

    If you specify default in the command, the LACP system priority and LACP interface priority configurations still use the same command (lacp priority priority).
    If you specify system-priority in the command, run the lacp system-priority priority command to configure the LACP system priority and run the lacp priority priority command to configure the LACP interface priority.

Prerequisites

The lacp priority-command-mode system-priority command has been executed in the system view to set the configuration mode of the LACP system priority to system-priority.
Example

# Set the LACP system priority to 10.

<HUAWEI> system-view
[HUAWEI] lacp priority-command-mode system-priority
[HUAWEI] lacp system-priority 10

lacp timeout
Function

The lacp timeout command configures the timeout interval for an Eth-Trunk in LACP mode to receive LACPDUs.

The undo lacp timeout command restores the default timeout interval.

By default, the timeout interval for an Eth-Trunk to receive LACPDUs is 90s.
Format

lacp timeout { fast [ user-defined user-defined ] | slow }

undo lacp timeout
Parameters
Parameter 	Description 	Value
fast 	Indicates that the timeout interval for an Eth-Trunk in LACP mode to receive LACPDUs is 3 seconds.

If fast is specified, the remote device sends an LACPDU every 1 second. In this mode, the local device can quickly respond to LACPDUs from the remote device but consumes more system resources compared with the slow mode.
	-
user-defined user-defined 	

Specifies the timeout interval for an Eth-Trunk to receive LACPDUs when fast is specified.
	

The value is an integer that ranges from 3 to 90, in seconds.
slow 	Indicates that the timeout interval for an Eth-Trunk in LACP mode to receive LACPDUs is 90 seconds.

If slow is specified, the remote device sends an LACPDU every 30 seconds. In this mode, the local device responds to LACPDUs from the remote device slowly but consumes fewer system resources compared with the fast mode.

The timeout interval on the two ends can be different. To facilitate maintenance, you are advised to set the same timeout interval at both ends.
	-
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

If two devices are connected through three GE interfaces at each end and the three GE interfaces are bundled into an Eth-Trunk, you can run the mode lacp command to configure the Eth-Trunk to work in LACP mode and run the least active-linknumber link-number command to set the lower threshold for the number of active interfaces to 2.

If the Eth-Trunk on the local device cannot detect a self-loop or fault that occurred on a member interface in the LAG on the remote device, the local Eth-Trunk still has three member interfaces in Up state and the three member interfaces still load balance data, causing packet loss. To ensure reliable data transmission, run the lacp timeout command to set the timeout interval for the Eth-Trunk to receive LACPDUs. If a local member interface does not receive any LACPDU within the configured timeout interval, it becomes Down immediately and no longer forwards data.

The number of Up member interfaces does not fall below the configured lower threshold for the number of active interfaces, so the Eth-Trunk is still Up. In this case, data is load balanced between the two member interfaces in Up state and reliably transmitted to the remote end.

Prerequisites

The Eth-Trunk has been configured to work in LACP mode using the mode lacp command in the Eth-Trunk interface view.

Precautions

After the timeout interval is successfully configured, pay attention to the following points:

    If fast is specified, the remote device sends an LACPDU every 1 second.
    If slow is specified, the remote device sends an LACPDU every 30 seconds.

The timeout interval configured on an Eth-Trunk takes effect on all its member interfaces.
Example

# Set the timeout interval for Eth-Trunk 1 to receive LACPDUs to 3 seconds.

<HUAWEI> system-view

[HUAWEI] interface eth-trunk 1

[HUAWEI-Eth-Trunk1] mode lacp

[HUAWEI-Eth-Trunk1] lacp timeout fast

lacp track interface
Function

The lacp track interface command associates the secondary member interface of an Eth-Trunk interface in LACP mode with its primary member interface and dynamically changes the priority of the secondary member interface.

The undo lacp track interface command restores the default configuration.

By default, the secondary member interface of an Eth-Trunk interface in LACP mode is not associated with its primary member interface.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

lacp track interface interface-type interface-number priority-reduced value

undo lacp track interface interface-type interface-number priority-reduced value
Parameters
Parameter 	Description 	Value

interface-type interface-number
	

Specifies the type and number of an associated physical interface.
	

-

priority-reduced value
	

Specifies a value by which the priority is reduced.
NOTE:

The new priority of the secondary member interface is the configured priority minus the value specified by priority-reduced value. The new priority of the secondary member interface must be less than the priority of the primary member interface.
	

The value is an integer ranging from 0 to 65535.
Views

Eth-Trunk member interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario
Figure 5-3 Eth-Trunk interface in LACP mode

As shown in Figure 5-3, when no service is bound to the MA, an Eth-Trunk interface in LACP mode is configured on two devices. interface1 where the MEP resides is the interface of the Eth-Trunk interface's primary link. When the delay-measure two-way trigger if-down or loss-measure single-ended-synthetic trigger if-down command is configured on interface1, interface1 is triggered to go ETHOAM down if Y.1731 detects that the primary link has poor quality.

To ensure that services are not interrupted, run the lacp track interface command in the Eth-Trunk member interface view to increase the priority of the secondary member interface interface2. The secondary link then preempts the primary state, implementing an automatic primary/secondary link switchover.

Prerequisites

An Eth-Trunk interface has been configured to work in LACP mode using the mode lacp command in the Eth-Trunk interface view.

Precautions

An Eth-Trunk interface can have only two member interfaces. The maximum number of active links must be 1.

The lacp track interface command must be configured on the secondary member interface of an Eth-Trunk interface's Actor.

The secondary member interface must not be associated with another interface.

If the lacp track interface command has been run and the primary link has poor quality, the primary interface is triggered to go ETHOAM down. If the secondary link also has poor quality, a primary/secondary switchover is also performed because Y.1731 performance detection is not configured for the secondary link.

If the lacp track interface command has been run and the primary link has poor quality, the primary interface is triggered to go ETHOAM down. If the undo lacp track interface command is run to delete the configuration, two links cannot be selected within the timeout period. As a result, traffic is interrupted. Services can be restored only after the timeout period elapses.
Example
# Associate the secondary member interface GE 0/0/1 of an Eth-Trunk interface in LACP mode with its primary member interface GE 0/0/2, and set a value by which the priority is reduced to 100 when the status of the primary member interface changes to ETHOAM down.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] mode lacp
[HUAWEI-Eth-Trunk1] trunkport GigabitEthernet 0/0/1 to 0/0/2
[HUAWEI-Eth-Trunk1] max active-linknumber 1
[HUAWEI-Eth-Trunk1] quit
[HUAWEI] interface GigabitEthernet 0/0/1
[HUAWEI-GigabitEthernet0/0/1] lacp track interface GigabitEthernet 0/0/2 priority-reduced 100

least active-linknumber
Function

The least active-linknumber command sets the lower threshold for the number of active interfaces in an Eth-Trunk.

The undo least active-linknumber command restores the default lower threshold for the number of active interfaces in an Eth-Trunk.

By default, the lower threshold for the number of active interfaces in an Eth-Trunk is 1.
Format

least active-linknumber link-number

undo least active-linknumber
Parameters
Parameter 	Description 	Value

link-number
	

Specifies the lower threshold for the number of active interfaces in an Eth-Trunk.
	

The value is an integer that ranges from 1 to 32 on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, 1 to 16 on the S5735S-H, S5736-S, and S6720S-S, and 1 to 8 on other models.

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The number of active interfaces in an Eth-Trunk affects the status and bandwidth of the Eth-Trunk. The bandwidth of an Eth-Trunk is equal to the total bandwidth of all member interfaces in Up state.

The number of Up member links affects the status and bandwidth of an Eth-Trunk. To ensure that the Eth-Trunk functions properly and is less affected by member link status changes, set the following thresholds.

    Lower threshold for the number of active interfaces

    When the number of active interfaces falls below this threshold, the Eth-Trunk goes Down. This guarantees the Eth-Trunk a minimum available bandwidth.

    For example, if the Eth-Trunk is required to provide a minimum bandwidth of 2 Gbit/s and each member link's bandwidth is 1 Gbit/s, the lower threshold for the number of active interfaces must be set to 2 or larger.

    Upper threshold for the number of active interfaces

    When the number of active interfaces reaches this threshold, the bandwidth of the Eth-Trunk will not increase even if more member links go Up. This guarantees higher network reliability.

    To set the upper threshold for the number of active interfaces, use the max active-linknumber command.

To delete the configured lower threshold or restore the default lower threshold, use the undo least active-linknumber or least active-linknumber 1 command.

Prerequisites

The Eth-Trunk has been correctly configured.

Precautions

If you run the least active-linknumber command multiple times, only the latest configuration takes effect.

After the lower threshold for the number of active interfaces is configured, the following situations may occur:

    The Eth-Trunk goes Down when the number of active interfaces falls below the configured lower threshold.

    The Eth-Trunk goes Up when the number of active interfaces reaches the configured lower threshold.

If the max active-linknumber command has been configured before you run the least active-linknumber command, ensure that the lower threshold for the number of active interfaces is less than or equal to the upper threshold for the number of active interfaces.
Example

# Set the lower threshold for the number of active interfaces to 3.

<HUAWEI> system-view

[HUAWEI] interface eth-trunk 1

[HUAWEI-Eth-Trunk1] least active-linknumber 3

load-balance
Function

The load-balance command sets a load balancing mode of an Eth-Trunk.

The undo load-balance command restores the default load balancing mode of an Eth-Trunk.

The default load balancing mode is src-dst-ip.
Format

load-balance { dst-ip | dst-mac | src-ip | src-mac | src-dst-ip | src-dst-mac | enhanced profile profile-name }

undo load-balance

Only S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S and S6730S-S support enhanced profile profile-name.
Parameters

Parameter
	

Description
	

Value

dst-ip
	

Indicates load balancing based on destination IP addresses.
	

-

dst-mac
	

Indicates load balancing based on destination MAC addresses.
	

-

src-ip
	

Indicates load balancing based on source IP addresses.
	

-

src-mac
	

Indicates load balancing based on source MAC addresses.
	

-

src-dst-ip
	

Indicates load balancing based on source and destination IP addresses.
	

-

src-dst-mac
	

Indicates load balancing based on source and destination MAC addresses.
	

-

enhanced profile profile-name
	

Indicates the name of the profile used to configure enhanced load balancing.
	

The value is a string of 1 to 31 characters.
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

To ensure proper load balancing between physical links of an Eth-Trunk and avoid link congestion, use the load-balance command to set the load balancing mode of the Eth-Trunk.

Load balancing is valid only for outgoing traffic; therefore, the load balancing modes for the interfaces at both ends of the link can be different and do not affect each other.

You can set the load balancing mode based on traffic models. When a parameter of traffic changes frequently, you can set the load balancing mode based on this parameter to ensure that the traffic is load balanced evenly. For example, if IP addresses in packets change frequently, use the load balancing mode based on dst-ip, src-ip, or src-dst-ip so that traffic can be properly load balanced among physical links. If MAC addresses in packets change frequently and IP addresses are fixed, use the load balancing mode based on dst-mac, src-mac, or src-dst-mac so that traffic can be properly load balanced among physical links.

After the load-balance command is run to configure the load balancing mode for an Eth-Trunk, the hash factors used to calculate the outbound interface vary according to the packet type and device model. For example, after you configure load balancing based on the source and destination IP addresses for an Eth-Trunk, Layer 2 packets are load balanced automatically based on the source and destination MAC addresses because Layer 2 packets do not contain the source and destination IP addresses. You can run the display eth-trunk load-balance command to check the hash factors used when the outbound interface is calculated.

Prerequisites

Ensure that the load-balance-profile profile-name command has been executed to create a load balancing profile before you run the load-balance enhanced profile profile-name command.

Precautions

If you run the load-balance command multiple times, only the latest configuration takes effect.

When an inter-device Eth-Trunk is configured in a stack and the local device has Eth-Trunk member interfaces and the member interfaces function properly, only the Eth-Trunk member interfaces on the local device participate in load balancing. To enable Eth-Trunk member interfaces on other devices participate in load balancing, run the undo local-preference enable command to configure the Eth-Trunk not to preferentially forward local traffic.

When more than 128 Eth-Trunks, or more than 16 member interfaces are configured using the assign trunk { trunk-group group-number | trunk-member member-number }* command, only the enhanced mode can be used for load balancing. If the enhanced mode is not used, problems such as packet loss and uneven load balancing may occur.

If the value of member-number configured for an Eth-Trunk using the assign trunk { trunk-group group-number | trunk-member member-number }* command is larger than 16 on the S6735-S or larger than 32 on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, only the enhanced mode can be used for load balancing. If the enhanced mode is not used, problems such as packet loss and uneven load balancing may occur.

The SS1720GW-E, S1720GWR-E, S5720I-SI, S5720-LI, S5720S-LI, S5735S-H, S5736-S, and S6720S-S use the src-dst-ip, source TCP or UDP port number, and destination TCP or UDP port number in the hash algorithm for load balancing regardless of whether you configure this parameter.

The S1720GW-E, S1720GWR-E, S5720I-SI, S5720-LI, S2730S-S, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5720S-LI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, and S6720S-S support only one load balancing mode globally. If the load balancing mode of an Eth-Trunk is modified, the modification takes effect on all Eth-Trunks. If an Eth-Trunk is created, the load balancing mode of the Eth-Trunk is the same as that of the original Eth-Trunks on the switch.

On the S6735-S, when the load-balance command is run to configure the load balancing mode for an Eth-Trunk, whether the TCP or UDP port number is involved in the hash operation depends on the ecmp load-balance command. If the default setting is used or the port parameter is specified in the ecmp load-balance command, the TCP or UDP port number is involved in the hash operation when the dst-ip, src-ip, or src-dst-ip load balancing mode is configured for an Eth-Trunk.

On the S5731-H, S5731-S, S5731S-S, S5731S-H, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, when you run the load-balance { dst-ip | dst-mac | src-ip | src-mac | src-dst-ip | src-dst-mac } command to configure the load balancing mode for an Eth-Trunk, regardless of which parameter is specified, packets are load balanced based on physical-layer source port numbers in the packets.
Example

# Set the load balancing mode of Eth-Trunk 1 to dst-mac.

<HUAWEI> system-view
[HUAWEI] interface Eth-Trunk 1
[HUAWEI-Eth-Trunk1] load-balance dst-mac

load-balance-profile
Function

The load-balance-profile command creates a load balancing profile and displays the load balancing profile view.

The undo load-balance-profile command deletes a load balancing profile.

By default, there is not a load balancing profile on the device.

Only the S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

load-balance-profile profile-name

undo load-balance-profile profile-name
Parameters

Parameter
	

Description
	

Value

profile-name
	

Specifies the name of a load balancing profile.
	

The value is a string of 1 to 31 characters.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Before setting the load balancing mode, create a load balancing profile.

Only one load balancing profile can be created.

If VLAN mapping, VLAN stacking, or VLAN re-marking of the ACL is configured on an inbound interface, and a load balancing profile is configured on an inter-device Eth-Trunk outbound interface, you are advised not to choose the VLAN-based load balancing mode when running the mpls field, l2 field, ipv4 field, and ipv6 field commands.
Example

# Create a load balancing profile named a.

<HUAWEI> system-view
[HUAWEI] load-balance-profile a
[HUAWEI-load-balance-profile-a] 

load-distribution active-linknumber-change
Function

The load-distribution active-linknumber-change command configures the number of interfaces in an Eth-Trunk where load balancing calculation is performed.

The undo load-distribution active-linknumber-change command cancels the configuration.

By default, the number of interfaces in an Eth-Trunk where load balancing calculation is performed is the number of active interfaces of the device.

Only the SS1720GW-E, S1720GWR-E, S5720-LI, S5720S-LI, and S5720I-SI support this command.
Format

load-distribution active-linknumber-change link-number1 to link-number2

undo load-distribution active-linknumber-change [ link-number1 ]
Parameters
Parameter 	Description 	Value

link-number1
	

Specifies the number of active interfaces in an Eth-Trunk.
	

The value is an integer that ranges from 2 to 7.

link-number2
	

Specifies the number of interfaces in an Eth-Trunk where load balancing calculation is performed.
	

The value is an integer that ranges from 3 to 8.
NOTE:

When this command is used, link-number2 must be larger than link-number1.
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

By default, the number of interfaces in an Eth-Trunk where load balancing calculation is performed is the number of active interfaces of the device. If the number of active interfaces is smaller than 8 and traffic on an Eth-Trunk is unevenly load balanced, you can run the load-distribution active-linknumber-change command to increase the number of interfaces in the Eth-Trunk where load balancing calculation is performed so that traffic can be better load balanced among active links.

The load-distribution active-linknumber-change link-number1 to link-number2 command with different values of link-number1 can be configured repeatedly. When the number of active interfaces is the same as the value of link-number1, the configuration takes effect. If the load-distribution active-linknumber-change link-number1 to link-number2 command with the same value of link-number1 is configured, only the latest configuration takes effect.

Precautions

When an inter-device Eth-Trunk is configured in a iStack and the local-preference enable command is used to configure an Eth-Trunk to preferentially forward local traffic, the number of interfaces in the Eth-Trunk where load balancing calculation is performed is the number of active interfaces.

This command is effective only for known unicast packets.
Example

# Set the number of interfaces in Eth-Trunk 1 where load balancing calculation is performed to 8 when Eth-Trunk 1 has four active interfaces.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] load-distribution active-linknumber-change 4 to 8

load-distribution active-linknumber-change global
Function

The load-distribution active-linknumber-change global command specifies the number of Eth-Trunk interfaces participating in load balancing calculation in the system view.

The undo load-distribution active-linknumber-change global command cancels the configuration.

By default, the number of member interfaces that participate in load balancing calculation in all Eth-Trunks is the number of active interfaces in the Eth-Trunks.

Only the SS1720GW-E, S1720GWR-E, S5720-LI, S5720S-LI, and S5720I-SI support this command.
Format

load-distribution active-linknumber-change link-number1 to link-number2 global

undo load-distribution active-linknumber-change [ link-number1 ] global
Parameters
Parameter 	Description 	Value
link-number1 	Specifies the number of active interfaces in an Eth-Trunk. 	

The value is an integer in the range from 2 to 7.
link-number2 	Specifies the number of interfaces in an Eth-Trunk where load balancing calculation is performed. 	

The value is an integer in the range from 3 to 8.
NOTE:

When this command is used, link-number2 must be larger than link-number1.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

By default, the number of interfaces in an Eth-Trunk where load balancing calculation is performed is the number of active interfaces of the device. If the number of active interfaces is smaller than 8 and traffic on an Eth-Trunk is unevenly load balanced, you can run the load-distribution active-linknumber-change global command to set the number of Eth-Trunk interfaces participating in load balancing calculation to a larger value in the system view to better load balance traffic.

The load-distribution active-linknumber-change link-number1 to link-number2 global command with different values of link-number1 can be configured repeatedly. When the number of active interfaces is the same as the value of link-number1, the configuration takes effect. If the load-distribution active-linknumber-change link-number1 to link-number2 global command with the same value of link-number1 is configured, only the latest configuration takes effect.

Precautions

    When an inter-device Eth-Trunk is configured in an iStack and the local-preference enable command is used to configure an Eth-Trunk to preferentially forward local traffic, the number of interfaces in the Eth-Trunk where load balancing calculation is performed is the number of active interfaces.

    This command is effective only for known unicast packets.

    If the number of Eth-Trunk interfaces participating in load balancing calculation is configured in both the system view and Eth-Trunk interface view, the configuration in the Eth-Trunk interface view takes effect.

Example

# Set the number of Eth-Trunk interfaces participating in load balancing calculation to 8 when the Eth-Trunks have four active interfaces.

<HUAWEI> system-view
[HUAWEI] load-distribution active-linknumber-change 4 to 8 global

local-preference enable
Function

The local-preference enable command configures an Eth-Trunk to preferentially forward local traffic.

The local-preference disable command configures an Eth-Trunk not to preferentially forward local traffic.

The undo local-preference enable command configures an Eth-Trunk not to preferentially forward local traffic.

By default, an Eth-Trunk is enabled to preferentially forward local traffic.
Format

local-preference { enable | disable }

undo local-preference enable

The S2730S-S, 5735-L1, S300, S5735-L, S5735S-L1, S5735-S, S500 do not support the local-preference disable.
Parameters

None
Views

System view (S2730S-S, S5735-L-I, S5735-L1, S300, S5735-L, S5735S-L1, S5735-S, S500)

Eth-Trunk interface view (Other models excluding the S2730S-S, S5735-L-I, S5735-L1, S300, S5735-L, S5735S-L1, S5735-S, S500)
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

In a stack, an Eth-Trunk is configured to be the outbound interface of traffic to ensure reliable transmission. Member interfaces of the Eth-Trunk may be located on different devices. When the stack device forwards traffic, the Eth-Trunk may select an inter-device member interface based on the hash algorithm. This forwarding mode occupies bandwidth resources between devices and reduces traffic forwarding efficiency.

To solve the problem, run the local-preference enable command to enable the Eth-Trunk to preferentially forward local traffic. Then traffic arriving at the local device is preferentially forwarded through member interfaces of the local device. If there is no member interface on the local device, member interfaces on another device are used to forward traffic. This forwarding mode effectively saves inter-device bandwidth resources and improves traffic forwarding efficiency.

    When the local device has Eth-Trunk member interfaces and the member interfaces function properly, the Eth-Trunk forwarding table of the local device contains only local Eth-Trunk member interfaces. Therefore, the hash algorithm selects a local member interface, and traffic is forwarded through the local device.

    When the local device does not have any Eth-Trunk member interfaces or all member interfaces fail, the Eth-Trunk forwarding table of the local device contains all available Eth-Trunk member interfaces. The hash algorithm selects a member interface on another device, and traffic is forwarded through this device.

Precaution

Member interfaces of the local Eth-Trunk have sufficient bandwidth to forward local interface traffic, which prevents packet loss.

This function is only valid for known unicast packets, and is invalid for broadcast, unknown-unicast, and multicast (BUM) packets.
Example

# Configure an Eth-Trunk not to preferentially forward local traffic.

<HUAWEI> system-view
[HUAWEI] interface Eth-Trunk 10
[HUAWEI-Eth-Trunk10] undo local-preference enable

max active-linknumber
Function

The max active-linknumber command sets the upper threshold for the number of active interfaces in an Eth-Trunk.

The undo max active-linknumber command restores the default upper threshold for the number of active interfaces in an Eth-Trunk.

By default, the upper threshold for the number of active interfaces in an Eth-Trunk is 32 on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, 16 on the S5735S-H, S5736-S, and S6720S-S, and 8 on other models.
Format

max active-linknumber link-number

undo max active-linknumber
Parameters

Parameter
	

Description
	

Value

link-number
	

Specifies the upper threshold for the number of active interfaces.
	

The value is an integer that ranges from 1 to 32 on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, 1 to 16 on the S5735S-H, S5736-S, and S6720S-S, and 1 to 8 on other models.

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The number of active interfaces in an Eth-Trunk affects the status and bandwidth of the Eth-Trunk. The bandwidth of an Eth-Trunk is equal to the total bandwidth of all member interfaces in Up state.

The number of Up member links affects the status and bandwidth of an Eth-Trunk. To ensure that the Eth-Trunk functions properly and is less affected by member link status changes, set the following thresholds.

    Lower threshold for the number of active interfaces

    When the number of active interfaces falls below this threshold, the Eth-Trunk goes Down. This guarantees the Eth-Trunk a minimum available bandwidth.

    For example, if the Eth-Trunk is required to provide a minimum bandwidth of 2 Gbit/s and each member link's bandwidth is 1 Gbit/s, the minimum number of Up member links must be set to 2 or larger.

    To set the lower threshold for the number of active interfaces, run the least active-linknumber command.

    Upper threshold for the number of active interfaces

    When the number of active interfaces reaches this threshold, the bandwidth of the Eth-Trunk will not increase even if more member links go Up. The upper threshold is used to improve network reliability with assured bandwidth.

Prerequisites

The Eth-Trunk has been correctly configured.

Precautions

    If you run the max active-linknumber command multiple times, only the latest configuration takes effect.

    The max active-linknumber command is valid only in LACP mode.

    If the number of member interfaces added to an Eth-Trunk is less than the upper threshold, there is no backup interface.

    After you run this command, if the number of current active interfaces reaches the upper threshold, new member interfaces function as the backup interfaces.

    If the least active-linknumber command has been configured before you run the max active-linknumber command, ensure that the maximum number of active member links is greater than or equal to the minimum number of active member links.

    The upper thresholds configured by the max active-linknumber command on both ends must be the same; otherwise, the Eth-Trunk status flaps if an active interface fails.
    In the scenario where the Eth-Trunk in 1:N LACP mode is used, the upper threshold for the number of Eth-Trunk member links in Up state is 1. After the active link becomes Down and before the backup link switches to the active link, the Down event of the original active link is not reported to the Eth-Trunk. To prevent route re-calculation caused by the Eth-Trunk Down event, the Down event of the original active link is reported to the Eth-Trunk in any of the following situations:
        The timeout interval (60s) for reporting the Down event has been expired.
        The backup link goes Up and becomes the active link.
        The backup link fails and cannot go Up.
    The preceding implementation is inapplicable to scenarios where association between Eth-Trunk in E-Trunk or LACP mode and VRRP is configured.

    When a Huawei switch connects to a non-Huawei device, if the maximum number of active links at both ends is smaller than the number of all active interfaces of the Eth-Trunk, a link is interrupted suddenly especially in 1:1 mode. As a result, LACP negotiation results at both ends are different and the Eth-Trunk in Down state cannot be restored. It is recommended that LACP preemption be enabled and the same preemption delay be set at both ends or the maximum number of active links be not set at both ends.

    The 1:1 mode indicates that the maximum number of active links at both ends of an Eth-Trunk is 1 and two member interfaces join an Eth-Trunk at both ends.

Example

# Set the upper threshold for the number of active interfaces in Eth-Trunk 1 to 3.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] mode lacp
[HUAWEI-Eth-Trunk1] max active-linknumber 3

mixed-rate link enable
Function

The mixed-rate link enable command adds interfaces with different interface types to the same Eth-Trunk.

The undo mixed-rate link enable command disables interfaces with different interface types from being added to the same Eth-Trunk.

By default, interfaces with different interface types are not allowed to be added to the same Eth-Trunk.
Format

mixed-rate link enable

undo mixed-rate link enable
Parameters

None
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

You can run the mixed-rate link enable command to add interfaces with different rates to the same Eth-Trunk. If a member interface of an Eth-Trunk is a GE interface and the transmission bandwidth needs to be increased, you can enable this function when the GE interface needs to be changed to an XGE interface. During switching, add the XGE interface to the Eth-Trunk and then delete the GE interface. In this way, the service interruption time during the switching process can be reduced.

Precautions

    In LACP mode, if the peer device does not support this function, interfaces with different rates cannot be successfully added to the same Eth-Trunk even if the local device has the function enabled.
    In LACP mode, when Eth-Trunk negotiation succeeds, modifying the configuration of this command triggers a renegotiation, which can cause an LACP flap.
    In manual mode, if the peer device allows only interfaces with the same rate to be added to the same Eth-Trunk, traffic forwarded by all interfaces of the local device can be received only by the interfaces with the same rate, but not by the other interfaces.
    When an Eth-Trunk performs load balancing calculation, the interface rate cannot be used as the calculation weight. When interfaces with different rates are added to the same Eth-Trunk, traffic is evenly load balanced on all the links. Therefore, the bandwidth of member interfaces is calculated by the minimum rate of the member interfaces in the Eth-Trunk. For example, when a GE interface and a 10GE interface are added to the same Eth-Trunk, the rate of the GE interface is used in calculation and the bandwidth of the Eth-Trunk is 2G.
    When the undo mixed-rate link enable command is executed, ensure that the Eth-Trunk does not contain member interfaces with different rates.

Example

# Set the Eth-Trunk 2 to allow interfaces with different interface types adding.

<HUAWEI> system-view
[HUAWEI] interface Eth-Trunk 2
[HUAWEI-Eth-Trunk2] mixed-rate link enable

mode
Function

The mode command configures a working mode of an Eth-Trunk.

The undo mode command restores the default working mode of an Eth-Trunk.

By default, an Eth-Trunk works in manual load balancing mode.
Format

mode { lacp | manual load-balance }

undo mode
Parameters
Parameter 	Description 	Value
lacp 	Indicates the LACP mode. 	-
manual load-balance 	Indicates the manual load balancing mode. 	-
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenarios
An Eth-Trunk can use the following working modes:

    LACP mode

    When the devices that are directly connected through an Eth-Trunk support LACP, you can run the mode lacp command to configure the Eth-Trunk to work in LACP mode. This mode can implement both load balancing and redundancy.

    In LACP mode, you must manually create an Eth-Trunk and add member interfaces to the Eth-Trunk. The difference between the LACP mode and manual load balancing mode is that active member interfaces are selected by sending LACP data units (LACPDUs). That is, when a group of interfaces are added to an Eth-Trunk, devices at both ends determine active and inactive interfaces by sending LACPDUs to each other.

    Manual load balancing mode

    When one of the devices at the two ends of an Eth-Trunk does not support LACP, run the mode manual load-balance command to configure the Eth-Trunk to work in manual load balancing mode. In addition, you can add multiple member interfaces to the Eth-Trunk to increase the bandwidth between the two devices and improve reliability.

    The manual load balancing mode is a basic link aggregation mode. In this mode, you must manually create an Eth-Trunk and add interfaces to the Eth-Trunk. LACP is not used.

    In manual load balancing mode, all active interfaces of the Eth-Trunk forward data and load balance traffic.

Precautions

If you run the mode command multiple times, only the latest configuration takes effect.

If an Eth-Trunk interface has member interfaces, you can switch the Eth-Trunk interface's working mode between manual mode and LACP mode. However, if the Eth-Trunk interface is added to an E-Trunk, you cannot change its working mode.
Example

# Configure Eth-Trunk 1 to work in LACP mode.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] mode lacp

mpls field
Function

The mpls field command configures a load balancing mode of MPLS packets in a load balancing profile.

The undo mpls field command deletes a specified load balancing mode of MPLS packets or restores the default load balancing modes of MPLS packets.

By default, load balancing of MPLS packets is based on the two outer labels (top-label and 2nd-label) of each packet.

Only the S5735S-H, S5736-S, S5731-H, S5731S-H, S5732-H, S5731-S, S5731S-S, S6730-S, S6730S-S, S6720S-S, S6730S-H, and S6730-H support this command.
Format

mpls field [ 2nd-label | 3rd-label | dip | dmac | l4-dport | l4-sport | protocol | sip | smac | sport | top-label | vlan ] *

undo mpls field [ 2nd-label | 3rd-label | dip | dmac | l4-dport | l4-sport | protocol | sip | smac | sport | top-label | vlan ] *
Parameters

Parameter
	

Description
	

Value

2nd-label
	

Performs load balancing based on the second label of MPLS packets.
	

-

3rd-label
	

Performs load balancing based on the third label of MPLS packets.
	

-

dip
	

Performs load balancing based on destination IP addresses in MPLS packets.
	

-

dmac
	

Performs load balancing based on destination MAC addresses in MPLS packets.
	

-

l4-dport
	

Performs load balancing based on transport-layer destination port numbers in MPLS packets.
	

-

l4-sport
	

Performs load balancing based on transport-layer source port numbers in MPLS packets.
	

-

protocol
	

Performs load balancing based on protocol types in MPLS packets.
	

-

sip
	

Performs load balancing based on source IP addresses in MPLS packets.
	

-

smac
	

Performs load balancing based on source MAC addresses in MPLS packets.
	

-

sport
	

Performs load balancing based on physical-layer source port numbers.
	

-

top-label
	

Performs load balancing based on the top label of MPLS packets.
	

-

vlan
	

Performs load balancing based on VLAN IDs.
	

-
Views

Load balancing profile view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

The undo mpls field command with no parameter specified restores the default load balancing modes of MPLS packets. The undo mpls field command with a parameter specified deletes a specified load balancing mode of MPLS packets.

The mpls field 3rd-label command implements flow label-based load balancing on L2VPN networks.

Precautions

    If you run the mpls field command multiple times, only the latest configuration takes effect.

    Only the S5731-H, S5731S-H, S5732-H, S6730S-H, and S6730-H support the 3rd-label, l4-dport, l4-sport, and protocol load balancing mode.

    Only 2nd-label, dmac, smac, sport, and top-label are supported on the S5735S-H, S5736-S, and S6720S-S.

    Load balancing based on MPLS labels takes effect for only labeled packets on the ingress.
    For the S5731-H, S5731S-H, S5732-H, S5731-S, S5731S-S, S6730-S, S6730S-S, S6730S-H, and S6730-H, MPLS packets can be load balanced based on source or destination IP addresses on the P and tunnel egress on an L2VPN network. If original data packets are Layer 2 packets and the sip or dip parameter is specified, MPLS packets are load balanced based on source or destination MAC addresses. For other models, load balancing based on source or destination IP addresses for MPLS packets does not take effect on the P and tunnel egress on an L2VPN network. You are advised to configure the 2nd-label, 3rd-label, or top-label load balancing mode.

Example

# In the load balancing profile a, set the load balancing mode of MPLS packets to 2nd-label, that is, load balancing based on the second label of MPLS packets.

<HUAWEI> system-view
[HUAWEI] load-balance-profile a
[HUAWEI-load-balance-profile-a] mpls field 2nd-label

peer-address source-address
Function

The peer-address source-address command configures the local and remote IP addresses of an E-Trunk.

The undo peer-address command cancels the configuration.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

peer-address peer-ip-address source-address source-ip-address

undo peer-address
Parameters
Parameter 	Description 	Value

peer-address peer-ip-address
	

Specifies the remote IP address of an E-Trunk.
	

The value is in dotted decimal notation.

source-address source-ip-address
	

Specifies the local IP address of an E-Trunk.
	

The value is in dotted decimal notation.
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

The remote IP address of the local device is the local IP address of the remote device. For example, an E-Trunk is created between device A and device B. On device A, the remote IP address is 10.2.2.2 and the local IP address is 10.1.1.1. On device B, the remote IP address is 10.1.1.1 and the local IP address is 10.2.2.2.

When changing the local or remote IP address on a device, you must change the corresponding address on the remote device. Otherwise, LACPDUs are discarded.
Example

# Set the remote IP address of E-Trunk 1 to 10.2.2.2 and the local IP address to 10.1.1.1.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1] peer-address 10.2.2.2 source-address 10.1.1.1

priority (E-Trunk view)
Function

The priority command sets the priority of an E-Trunk.

The undo priority command restores the default priority of an E-Trunk.

By default, the priority of an E-Trunk is 100.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

priority priority

undo priority
Parameters
Parameter 	Description 	Value

priority priority
	

Specifies the priority of an E-Trunk.
	

The value is an integer that ranges from 1 to 254. The default value is 100. A smaller value indicates a higher priority.
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

An E-Trunk determines the master/backup status of the two devices according to the priority and system ID. The device with a higher priority is the master.

If the two devices have the same priority, the device with a smaller system ID is the master.

If the two devices have the same priority and system ID, the E-Trunk considers the configuration incorrect and discards LACPDUs.
Example

# Set the priority of E-Trunk 1 to 10.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1] priority 10

reset e-trunk packet-statistics
Function

The reset e-trunk packet-statistics command clears packet statistics about an E-Trunk.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

reset e-trunk packet-statistics [ e-trunk-id e-trunk-id ]
Parameters
Parameter 	Description 	Value

e-trunk-id e-trunk-id
	

Specifies the ID of an E-Trunk.
	

The value is an integer that ranges from 1 to 16.
Views

User view
Default Level

3: Management level
Usage Guidelines

Before collecting packet statistics about an E-Trunk in a given period, run the reset e-trunk packet-statistics command to clear the existing statistics. Then run display e-trunk command to view packet statistics.
Example

# Clear packet statistics about E-Trunk 1.

<HUAWEI> reset e-trunk packet-statistics e-trunk-id 1

reset lacp statistics eth-trunk
Function

The reset lacp statistics eth-trunk command clears statistics about LACPDUs on all Eth-Trunks in LACP mode, a specified Eth-Trunk in LACP mode, or a specified member interface.
Format

reset lacp statistics eth-trunk [ trunk-id [ interface interface-type interface-number ] ]
Parameters
Parameter 	Description 	Value

trunk-id
	

Specifies the ID of an Eth-Trunk.
	
The value is an integer. The value varies according to device model:

    SS1720GW-E, S1720GWR-E, S2730S-S, S5720I-SI, S5720-LI, and S5720S-LI: 0-119
    S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S5735-L-I, S5735-L1,S300, S5735-L, S5735S-L1, S5735-S, S500, S5735-S-I, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S: 0-127
    S5735S-H, S5736-S, S6720S-S: 0-249

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.

interface interface-type interface-number
	

Specifies an Eth-Trunk member interface.

interface-type: specifies the type of the interface.

interface-number: specifies the number of the interface.
	

-
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Before collecting statistics about LACPDUs on a specific interface within a given period of time, you need to run the reset lacp statistics eth-trunk command to clear the existing statistics about LACPDUs on the interface.

When using the reset lacp statistics eth-trunk command, pay attention to the following points:

    If no parameter is specified, statistics about LACPDUs on all Eth-Trunks in LACP mode are cleared.

    If only trunk-id is specified, statistics about LACPDUs on the specified Eth-Trunk in LACP mode are cleared.

    If both trunk-id and interface interface-type interface-number are specified, statistics about LACPDUs on the specified member interface of the specified Eth-Trunk in LACP mode are cleared.

Prerequisites

    The Eth-Trunk has been created and configured to work in LACP mode.

    Member interfaces have been added to the Eth-Trunk.

Precautions

The reset lacp statistics eth-trunk command clears statistics about sent and received LACPDUs on all Eth-Trunks in LACP mode, a specified Eth-Trunk in LACP mode, or a specified member interface. The cleared statistics cannot be restored. Exercise caution when you run this command.
Example

# Clear statistics about LACPDUs on all Eth-Trunks in LACP mode.

<HUAWEI> reset lacp statistics eth-trunk

# Clear the statistics about LACPDUs on the member interface GigabitEthernet0/0/1 of Eth-Trunk 1 in LACP mode.

<HUAWEI> reset lacp statistics eth-trunk 1 interface gigabitethernet 0/0/1

revert disable
Function

The revert disable command disables revertive switching on an E-Trunk.

The undo revert disable command enables revertive switching on an E-Trunk.

By default, revertive switching is enabled on an E-Trunk and the revertive switching delay is 120s.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

revert disable

undo revert disable
Parameters

None
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

On devices of an E-Trunk, when the faulty master device recovers, to prevent loss of traffic that is switched back, run the revert disable command to disable revertive switching on the E-Trunk.

Prerequisites

The E-Trunk has been correctly configured.

Follow-up Procedure

Run the undo revert disable command to enable revertive switching on an E-Trunk. When the faulty master device recovers, services are switched back to the original active device after 120s by default. Run the timer revert delay delay-value command to set the revertive switching delay.
Example

# Disable revertive switching on the E-Trunk.

<HUAWEI> system-view

[HUAWEI] e-trunk 1

[HUAWEI-e-trunk-1] revert disable

security-key
Function

The security-key command sets an encrypted password for an E-Trunk.

The undo security-key command restores the default password of an E-Trunk.

By default, no encryption password is configured.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

security-key { simple simple-key | cipher cipher-key }

undo security-key
Parameters

Parameter
	

Description
	

Value

simple simple-key
	

Indicates the password in plain text.
	

The value is a string of 1 to 255 case-sensitive characters without spaces and question mark (?). When double quotation marks are used around the string, spaces are allowed in the string.

cipher cipher-key
	

Indicates the password in cipher text.
	

The value is a case-sensitive character string without spaces and question mark (?).

When double quotation marks are used around the string, spaces are allowed in the string.
When the cipher text is used, the password can be entered in plain or cipher text. The length depends on the input mode:

    The password in plain text is a string of 1 to 255 characters, but the cipher-text password of 32 to 392 characters is displayed during query.
    The password in plain text is a string of 24 or 32 to 392 characters.

NOTE:

    It is recommended that the password in plain text be used. If the password in cipher text is used, the password must comply with the encryption algorithm.
    If the cipher-text password of 24 characters is supported before upgrade, the password is compatible during upgrade.

Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

If simple is specified, the password is saved in the configuration file in plain text. This brings security risks. Therefore, it is recommended that you specify cipher to save the password in cipher text.
You can encrypt the password with the plain text or cipher text.

    When the password is encrypted in plain text, it can be displayed in the configuration file.

    When the password is encrypted in cipher text, it is displayed as unidentifiable characters.

An encrypted password must be configured to enhance the system security. The encrypted passwords configured on the two devices of an E-Trunk must be the same.
Example

# Set the password of E-Trunk 1 to YsHsjx_202206 and encrypt the password in cipher mode.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1] security-key cipher YsHsjx_202206

sequence enable
Function

The sequence enable command enables the E-Trunk sequence number check function.

The undo sequence enable command disables the E-Trunk sequence number check function.

By default, the E-Trunk sequence number check function is disabled.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

sequence enable

undo sequence enable
Parameters

None
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

If the master device in an E-Trunk fails, an attacker can obtain the E-Trunk packet sent by the master device and attack the backup device, causing service interruptions. To resolve this problem, run the sequence enable command to enable the E-Trunk sequence number check function.

Configuration Impact

After the E-Trunk sequence number check function is enabled, the E-Trunk sequence number of packets is checked to protect against attacks and enhance E-Trunk security.

Precautions

The sequence enable command must be run on both the master and backup devices in an E-Trunk. Otherwise, the E-Trunk sequence number check function fails, causing dual master devices in the E-Trunk.
Example

# Enable the E-Trunk sequence number check function on E-Trunk 1.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1] sequence enable

timer hello (E-Trunk view)
Function

The timer hello command sets the interval at which an E-Trunk sends hello packets.

The undo timer hello command restores the default interval for sending hello packets.

By default, the value of hello-times is 10, in 100 ms. That is, the default interval for sending hello packets is 1s.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

timer hello hello-times

undo timer hello
Parameters
Parameter 	Description 	Value

hello hello-times
	

Specifies the interval for sending hello packets.
	

The value is an integer that ranges from 5 to 100. The unit is 100 ms. The default value is 10.
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

The timer hello command sets the interval at which the master and backup devices of an E-Trunk send hello packet. If the backup device receives no hello packet from the master device after certain number of intervals (specified by the timer hold-on-failure multiplier command for detecting hello packets), the backup device becomes the master.

Configuring a timeout period longer than 5 minutes is recommended, so that the Eth-Trunk packets can be sent to the peer device within the timeout period when a master/backup switchover is performed.
Example

# Set the interval for sending hello packets to 9.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1] timer hello 9

timer hold-on-failure multiplier
Function

The timer hold-on-failure multiplier command sets the time multiplier for an E-Trunk to detect hello packets.

The undo timer hold-on-failure multiplier command restores the default time multiplier.

By default, the time multiplier for detecting hello packets is 20.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

timer hold-on-failure multiplier multiplier

undo timer hold-on-failure multiplier
Parameters
Parameter 	Description 	Value

multiplier multiplier
	

Specifies the time multiplier for detecting hello packets.
	

The value is an integer that ranges from 3 to 300. The default value is 20.
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

After the time multiplier for detecting hello packets is set, the local device is triggered to send hello packets. The remote device checks the timeout of the local device according to the timeout interval in the received packet. If the remote device is the backup device and does not receive hello packets from the local device within the timeout interval, the remote device becomes the master device.

Timeout interval = Interval for sending hello packets x Time multiplier

It is recommended that you set the time multiplier to 3 or larger.

The timeout interval configured on the local device is used by the remote device to check the timeout of the local device. If the hello packet from the remote device does not contain the timeout interval, the timeout interval of the local device is used.
Example

# Set the time multiplier for detecting hello packets to 3.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1] timer hold-on-failure multiplier 3

timer revert delay
Function

The timer revert delay command sets the revertive switching delay of an E-Trunk.

The undo timer revert delay command restores the default revertive switching delay of an E-Trunk.

By default, the revertive switching delay of an E-Trunk is 120 seconds.

Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

timer revert delay delay-value

undo timer revert delay
Parameters
Parameter 	Description 	Value

delay-value
	

Specifies the revertive switching delay of an E-Trunk.
	

The value is an integer that ranges from 0 to 3600, in seconds.
Views

E-Trunk view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

When the member Eth-Trunk on the master device goes Down, the member Eth-Trunk on the remote device becomes Up after LACP negotiation. Then the remote device becomes the master device, and the local device becomes the backup device. When the local device recovers, it becomes the master device again in the subsequent LACP negotiation.

If an E-Trunk works with other services, after the master device recovers from a fault, the status of the member Eth-Trunk on the master device may be restored before other services are restored. If traffic is immediately switched back to the master device, service traffic will be interrupted. To solve this problem, you need to set the revertive switching delay for the E-Trunk.

After you run the timer revert delay command to set the revertive switching delay for an E-Trunk, the local Eth-Trunk can become Up only after the delay timer times out. This delays the revertive switching of the service traffic, ensuring nonstop services.

Precautions

The revert delay of an E-Trunk must be greater than the PW recovery time. This ensures that services are not interrupted when traffic is reverted back to the master device.

In E-Trunk B2B scenarios where there are four PE devices and an E-Trunk is configured between each two PEs, to ensure that services can be switched back to the master device when a fault is rectified, configure the master device in one E-Trunk to immediately switch traffic back and the master device in the other E-Trunk to switch traffic back after a delay.
Example

# Set the revertive switching delay of E-Trunk 1 to 100 seconds.

<HUAWEI> system-view
[HUAWEI] e-trunk 1
[HUAWEI-e-trunk-1] timer revert delay 100

trunkport
Function

The trunkport command adds a member interface in the Eth-Trunk interface view.

The undo trunkport command deletes a member interface in the Eth-Trunk interface view.

By default, no member interface is added to an Eth-Trunk.
Format

trunkport interface-type { interface-number1 [ to interface-number2 ] } &<1-16> [ mode { active | passive } ]

undo trunkport interface-type { interface-number1 [ to interface-number2 ] } &<1-16>
Parameters

Parameter
	

Description
	

Value

interface-type interface-number1 [ to interface-number2 ]
	
Specifies the type and number of an interface.

    interface-type specifies the interface type.
    interface-number1 specifies the number of the first interface.
    interface-number2 specifies the number of the last interface. The value of interface-number2 must be larger than the value of interface-number1. interface-number1 and interface-number2 specify the range of interfaces. If to interface-number2 is not specified, only one interface is specified.

	

-

mode { active | passive }
	
Indicates the mode in which an Eth-Trunk member interface sends packets. This parameter is valid for only the Eth-Trunk in LACP mode. By default, the mode an Eth-Trunk member interface sends packets is active.

    active: indicates that an Eth-Trunk member interface proactively sends negotiation packets.
    passive: indicates that an Eth-Trunk member interface sends packets to negotiate with its remote end only after receiving a packet from its remote end.

	

-
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

An Eth-Trunk contains a maximum of 32 member interfaces on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S, 16 member interfaces on the S5735S-H, S5736-S, and S6720S-S and 8 member interfaces on other models.

On the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, S6730S-S, S6735-S, you can run the assign trunk command to set the value, and run the display trunk configuration command to check the configuration.
Example

# Add GigabitEthernet0/0/1 to Eth-Trunk 1.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] trunkport gigabitethernet 0/0/1

unknown-unicast load-balance
Function

The unknown-unicast load-balance command configures a load balancing mode for broadcast, unknown-unicast, and multicast (BUM) traffic.

The undo unknown-unicast load-balance command restores the default load balancing mode for BUM traffic.

By default, BUM traffic is load balanced based on source and destination MAC addresses of packets.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

unknown-unicast load-balance { dmac | smac | smacxordmac | enhanced [ lbid ] }

undo unknown-unicast load-balance
Parameters

Parameter
	

Description
	

Value

dmac
	

Load balances the BUM traffic based on destination MAC addresses of packets.
	

-

smac
	

Load balances BUM traffic based on source MAC addresses of packets.
	

-

smacxordmac
	

Load balances BUM traffic based on source and destination MAC addresses of packets.
	

-

enhanced [ lbid ]
	

Load balances BUM traffic based on the enhanced load balancing profile.
NOTE:

Only the S6735-S support the lbid parameter.
	

-
Views

System view
Default Level

2: Configuration level
Usage Guidelines

If the traffic policy contains a traffic behavior that defines the action of re-marking destination MAC addresses of packets, load balancing of BUM traffic must be based on source MAC addresses of packets.

On a VPLS network or a VXLAN network, when the S6735-S switche form a stack, if the outbound interface of BUM traffic is an inter-device Eth-Trunk interface, you need to configure run the unknown-unicast load-balance enhanced lbid to configure the load balancing mode. Otherwise, packet loss may occur or there may be duplicate packets.
Example

# Configure the device to load balance BUM traffic based on source MAC addresses of packets.

<HUAWEI> system-view
[HUAWEI] unknown-unicast load-balance smac

unicast load-balance enhanced
Function

The unicast load-balance enhanced command configures a load balancing mode for known unicast packets based on the inner or outer IP address.

The undo unicast load-balance enhanced commands restores the default loading balancing mode for known unicast packets.

By default, load balancing for known unicast packets is based on the outer IP address.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

unicast load-balance enhanced { inner-ip | outer-ip } *

undo unicast load-balance enhanced
Parameters
Parameter 	Description 	Value

inner-ip
	

Indicates that load balancing for known unicast packets is based on the inner IP address.
	

-

outer-ip
	

Indicates that load balancing for known unicast packets is based on the outer IP address.
	

-
Views

Eth-Trunk interface view
Default Level

2: Configuration level
Usage Guidelines

When configuring enhanced Eth-Trunk load balancing, you can run the unicast load-balance enhanced command to configure known unicast packets, such as GRE packets, to be load balanced based on the inner IP address, outer IP address, or both.

    In IPv4 over GRE or IPv6 over GRE scenarios, if inner-ip is specified, known unicast packets are load balanced based on the inner source IP address, inner destination IP address, or both. Similarly, you can configure known unicast packets to be load balanced based on the outer source IP address, outer destination IP address, or both. Additionally, known unicast packets can be load balanced based on the inner and outer source IP addresses, inner and outer destination IP addresses, or both.
    In Ethernet over GRE scenarios, if inner-ip is specified, known unicast packets are load balanced based on the inner source MAC address, inner destination MAC address, or both. If outer-ip is specified, known unicast packets are load balanced based on the outer source IP address, outer destination IP address, or both. If both inner-ip and outer-ip are specified, known unicast packets are load balanced based on the outer source IP address and inner source MAC address, outer destination IP address and inner destination MAC address, or both.
    In PPPoE scenarios, if hash calculation needs to be performed based on the source and destination IP addresses of inner IP packets of PPPoE packets, you need to configure an enhanced profile on the Eth-Trunk interface. In the enhanced profile, the l2 field must contain smac and dmac.

Example

# Configure an Eth-Trunk interface to perform load balancing for known unicast packets based on the inner IP address.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 1
[HUAWEI-Eth-Trunk1] unicast load-balance enhanced inner-ip

