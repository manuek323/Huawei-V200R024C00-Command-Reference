● Run the rip authentication-mode hmac-sha256 { plain
plain-text |
[ cipher ]
password-key }
key-id command to set RIP-2 packet authentication
to HMAC-SHA256 authentication.
----End
3.7.3 Verifying the RIP-2 Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to view all the
active routes in the RIP database.
● Run the display rip
process-id route command to view all RIP routes learned
from other devices.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 94
● Run the display rip
process-id interface [
interface-type interface-number ]
[ verbose ] command to view information about the RIP interface.
----End
3.8 Preventing Routing Loops
Pre-configuration Tasks
Before configuring split horizon and poison reverse, configure basic RIP
functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP Routing Loop Prevention Configuration) in any sequence.
3.8.1 Configuring Split Horizon
Context
Split horizon can prevent routing loops.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run rip split-horizon
Split horizon is configured.
NOTE
● By default, split horizon is disabled on an NBMA network.
● If both split horizon and poison reverse are configured, only poison reverse takes effect.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 95
3.8.2 Configuring Poison Reverse
Context
Poison reverse can prevent routing loops.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run rip poison-reverse
Poison reverse is enabled.
NOTE
If both split horizon and poison reverse are configured, only poison reverse takes effect.
----End
3.8.3 Verifying the RIP Routing Loop Prevention Configuration
Procedure
● Run the display rip
process-id interface [
interface-type interface-number ]
[ verbose ] command to view information about the specified RIP interface.
----End
3.9 Controlling RIP Routing
Pre-configuration Tasks
Before configuring RIP route attributes, configure basic RIP functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP Routing Control Configuration) in any sequence.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 96
3.9.1 Configuring RIP Preference
Context
When different routing protocols discover routes to the same destination, set the
RIP preference to select the required route.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run preference {
preference | route-policy
route-policy-name } *
The RIP preference is set.
By default, the RIP preference is 100.
----End
3.9.2 Configuring Additional Metrics of an Interface
Context
Configuring additional metrics on a RIP interface can change the route selection
sequence.
The additional metric is the metric (hop count) to be added to the original metric
of a RIP route. You can use commands to set additional metrics for incoming and
outgoing RIP routes.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 97
Step 4 Run the following commands as required:
● Run the rip metricin {
value | {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name }
value1 } command to set the additional metric for receiving
routes.
● Run the rip metricout {
value | {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name }
value1 } command to set the additional metric for
advertising routes.
NOTE
● The rip metricin command is used to add an additional metric to an incoming route.
After this route is added to the routing table, its metric in the routing table changes.
Running this command affects route selection on the local device and other devices on
the network.
● The rip metricout command is used to add an additional metric to an outgoing route.
When this route is advertised, an additional metric is added to this route, but the metric
of the route in the routing table does not change. Running this command does not
affect route selection on the local device but affects route selection on other devices in
the network.
----End
3.9.3 Setting the Maximum Number of Equal-Cost Routes
Context
By setting the maximum number of equal-cost RIP routes, you can change the
number of routes for load balancing.
NOTE
Only the S5720I-SI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S,
S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and
S6730S-S support this function.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run maximum load-balancing
number
The maximum number of equal-cost routes is set.
By default, the maximum number of equal-cost routes on the S5720I-SI, S5735-S,
S500, S5735-S-I, S5735S-H, or S5736-S is 8, and the maximum number of equal-
cost routes on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S,
S6730-H, S6730S-H, S6730-S, or S6730S-S is 16.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 98
3.9.4 Verifying the RIP Routing Control Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to view all the
active routes in the RIP database.
● Run the display rip
process-id route command to view all RIP routes learned
from other devices.
----End
3.10 Controlling RIP Route Advertisement
Pre-configuration Tasks
Before controlling RIP route advertisement, configure basic RIP functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the Route Advertisement Control Configuration) in any sequence.
3.10.1 Configuring RIP to Advertise Default Routes
Context
In a routing table, a default route is the route to the network segment 0.0.0.0
(with the mask being 0.0.0.0). If the destination address of a packet does not
match any entry in the routing table, the packet is sent along the default route.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run default-route originate [ cost
cost | { { match default | route-policy
route-
policy-name } [ avoid-learning ] } ]*
The device is configured to originate a default route or advertise the default route
in the routing table to neighbors.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 99
3.10.2 Disabling an Interface from Sending Update Packets
Context
Routing loops can be avoided by disabling interfaces from sending Update
packets.
There are two ways to prevent interfaces from sending Update packets:
● Suppress an interface in the RIP process view.
● Disable an interface from sending RIP packets in the interface view.
The configuration in the RIP process view has a higher priority than the
configuration in the interface view.
Procedure
● Configuration in a RIP process view
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Run one of the following commands depending on the site requirements:
Run silent-interface all
All interfaces are disabled from sending Update packets.
Run silent-interface
interface-type interface-number
An interface is disabled from sending Update packets,
You can set an interface to silent so that it only receives Update packets
to update its routing table. The silent-interface command takes
precedence over the undo rip output command in the interface view.
By default, an interface can receive and send Update packets.
● Configuration in the interface view
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 100
d. Run undo rip output
The interface is disabled from sending RIP Update packets.
By running this command, you can determine whether to send RIP
Update packets on an interface. The silent-interface command takes
precedence over the undo rip output command. By default, an interface
is allowed to send RIP Update packets.
----End
3.10.3 Configuring RIP to Import Routes
Context
A RIP process can import the routes learned by other RIP processes or routing
protocols.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 (Optional) Run default-cost
cost
The default metric for imported routes is set.
If the metric of imported routes is not specified in step 4, the default metric is
used.
Step 4 Run import-route bgp [ permit-ibgp ] [ cost {
cost | transparent } | route-policy
route-policy-name ] * or import-route { { static | direct | unr } | { { rip | ospf |
isis } [
process-id ] } } [ cost
cost | route-policy
route-policy-name ] *
External routes are imported to RIP.
NOTE
When RIP imports IBGP routes, routing loops may occur. Configure this function with
caution.
Step 5 (Optional) Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-
prefix-name } export [
protocol [
process-id ] |
interface-type interface-number ]
The imported routes are filtered before being advertised.
The routing information advertised by RIP may contain the routing information
imported from other protocols. You can use the
protocol parameter to filter the
routing information imported from a specified routing protocol. If the
protocol
parameter is not used, all the routes advertised by RIP are filtered, including the
imported routes and the local routes (direct routes).
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 101
NOTE
RIP-2 defines a 16-bit tag, while other routing protocols define 32-bit tags. If the routes of
other protocols are imported to RIP and the tag is used in the routing policy, the tag value
cannot exceed 65535. If the tag value exceeds 65535, the routing policy becomes invalid or
the matching result is incorrect.
----End
3.10.4 Verifying the RIP Route Advertisement Control
Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to view all the
active routes in the RIP database.
● Run the display rip
process-id route command to view all RIP routes learned
from other devices.
----End
3.11 Controlling Receiving of RIP Routing Information
Pre-configuration Tasks
Before controlling receiving of RIP routing information, configure basic RIP
functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP Route Receiving Control Configuration) in any sequence.
3.11.1 Disabling an Interface from Receiving RIP Update
Packets
Context
Routing loops can be avoided by disabling interfaces from receiving Update
packets.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 102
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run undo rip input
The interface is disabled from receiving RIP Update packets.
By default, an interface is allowed to receive RIP update packets.
----End
3.11.2 Configuring RIP to Deny Host Routes
Context
In certain cases, the switch receives a large number of host routes with 32 bits
from the same network segment. These host routes are unnecessary for routing,
and they waste network resources. You can configure the switch to reject all the
host routes it receives.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run undo host-route
Host routes are not added to the RIP routing table.
By default, host routes can be added to the routing table on the switch.
NOTE
The undo host-route command is invalid for RIP-2.
----End
3.11.3 Configuring RIP to Filter Received Routes
Context
The filtering policy can be configured on the inbound interface by configuring the
ACL and IP prefix list to filter received routes. Only the routes not filtered out by
the filtering policy are added to the local routing table.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 103
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Depending on type of desired filtering, run one of following commands to
configure RIP to filter the received routes:
● Run filter-policy {
acl-number | acl-name
acl-name } import [
interface-type
interface-number ]
The learned routing information is filtered based on an ACL.
● Run filter-policy gateway
ip-prefix-name import
The routing information advertised by neighbors is filtered based on the IP
prefix list.
● Run filter-policy ip-prefix
ip-prefix-name [ gateway
ip-prefix-name ] import
[
interface-type interface-number ]
The routes learned by the specified interface are filtered based on the IP
prefix list and neighbors.
----End
3.11.4 Verifying the RIP Route Receiving Control
Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to check the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to check all
activated RIP routes in the database.
● Run the display rip
process-id interface [
interface-type interface-number ]
[ verbose ] command to check information about the RIP interface.
● Run the display rip
process-id neighbor [ verbose ] command to check
information about RIP neighbors.
● Run the display rip
process-id route command to check all the RIP routes
that are learned from other switches.
----End
3.12 Improving RIP Network Performance
Pre-configuration Tasks
Before improving the network performance of RIP, configure basic RIP functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 104
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP Network Performance Optimization Configuration) in any sequence.
3.12.1 Configuring RIP Timers
Context
RIP uses three timers: Update, Age, and Garbage-collect. Changing the timer
values affects the convergence speed of RIP routes.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run timers rip
update age garbage-collect
RIP timers are configured.
NOTE
● RIP timers take effect immediately after being changed.
● Route flapping occurs if the values of the three timers are set improperly. The
relationship between the values is:
update must be smaller than both
age and
garbage-
collect. If the update time is longer than the aging time and, for example, a RIP route
changes within the update time, the switch cannot inform its neighbors of the change
on time.
● Configure RIP timers based on the network performance and ensure that these timers
are consistent on all RIP devices. This avoids unnecessary network traffic or route
flapping.
By default, the Update timer is 30s, the Age timer is 180s, and the Garbage-collect
timer is 120s (four times the Update timer).
In practice, the Garbage-collect timer is not fixed. If the Update timer is set to 30s,
the Garbage-collect timer may range from 90s to 120s.
Before permanently deleting an unreachable route from its RIP routing table, a RIP
device advertises this route (with the metric set to 16) four times by periodically
sending Update packets. Subsequently, all the neighbors learn that this route is
unreachable. Because a route may not always become unreachable at the
beginning of an Update period, the Garbage-collect timer ranges from three to
four times the Update timer.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 105
3.12.2 Setting the Interval for Sending Update Packets and
Maximum Number of Sent Packets
Context
To limit memory resources used to process RIP Update packets, set the interval for
sending RIP Update packets and the maximum number of Update packets to be
sent at a time.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run rip pkt-transmit { interval
interval | number
pkt-count } *
The interval for sending RIP Update packets and the maximum number of Update
packets to be sent at a time are set.
----End
3.12.3 Enabling the Replay Protection Function
Context
If an interface goes Down and then goes Up, RIP routing information on both ends
of a link may be desynchronized or lost. Specifically, if the Identification field in
the last RIP packet sent before a RIP interface goes Down is X, after the interface
goes Up, the Identification field in the subsequent RIP packet sent by this interface
becomes 0. If the peer end does not receive the RIP packet with the Identification
field being 0, the peer end discards subsequent RIP packets until it receives the RIP
packet with the Identification field being X+1. This leads to RIP routing
information on both ends of the link being desynchronized or lost.
To solve this problem, enable the replay protection function so that RIP can obtain
the Identification field in the last RIP packet sent before the RIP interface goes
Down and increase the Identification field in the subsequent RIP packet by 1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 106
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run rip authentication-mode md5 nonstandard
password-key key-id
RIP-2 is configured to use MD5 authentication, and authentication packets use the
nonstandard packet format.
Step 5 Run rip replay-protect
The replay protection function is enabled.
NOTE
If you run the rip replay-protect command in the same view multiple times, only the latest
configuration takes effect.
----End
3.12.4 Configuring RIP to Check the Validity of Update
Packets
Context
Checking the validity of RIP Update packets improves network security. Validity
check includes zero field check for RIP-1 packets and source address check for RIP
Update packets.
● Zero field check
In RIP-1 packets, the values of some fields must be zero. These fields are zero
fields. After zero field check is enabled, a switch checks the zero fields in RIP-1
packets and discards the packets in which the zero field values are not 0.
● Source address check
Source address check for RIP Update packets verifies the source IP address of
received RIP Update packets. Specifically, a switch checks whether the IP
address of the interface that sends the packet is in the same network
segment as that of the interface that receives the packet. If the IP addresses
are not in the same network segment, the switch will not process the RIP
packet.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 107
Procedure
● Configure zero field check for RIP-1 packets.
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Run checkzero
Zero field check is configured for RIP-1 packets.
Zero field check configuration is invalid in RIP-2.
● Configure source address check for RIP Update packets.
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Run verify-source
Source IP address check is configured for RIP Update packets.
----End
3.12.5 Verifying the RIP Network Performance Optimization
Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to view all the
active routes in the RIP database.
● Run the display rip
process-id interface [
interface-type interface-number ]
[ verbose ] command to view information about the specified RIP interface.
● Run the display rip
process-id neighbor [ verbose ] command to view RIP
neighbor configuration.
● Run the display rip
process-id route command to view all RIP routes learned
from other devices.
----End
3.13 Configuring BFD for RIP
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support BFD for RIP.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 108
Pre-configuration Tasks
Before configuring BFD for RIP, configure basic RIP functions.
Configuration Procedure
You can perform the following configuration tasks in any sequence.
3.13.1 Configuring Dynamic BFD for RIP
Applicable Environment
RIP often uses timers to receive and send Update messages to maintain neighbor
relationships. If a RIP device does not receive an Update message from a neighbor
after the Age timer expires, the RIP device will announce that this neighbor goes
Down. The default value of the Age timer is 180s, therefore, if a link fault occurs,
RIP may detect this fault after 180s. If high-rate data services are deployed on a
network, a large amount of data will be lost during the aging time.
BFD provides millisecond-level fault detection. It can rapidly detect faults in
protected links or nodes and report them to RIP. This speeds up RIP processes'
responses to network topology changes and achieves rapid RIP route convergence.
Either of the following methods can be used to configure BFD for RIP:
● Enable BFD in a RIP process.
This method is recommended when BFD for RIP needs to be enabled on most
RIP interfaces.
● Enable BFD on RIP interfaces.
This method is recommended when BFD for RIP needs to be enabled on a
small number of RIP interfaces.
Procedure
● Enable BFD in a RIP process.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is enabled globally.
c. Run quit
Return to the system view.
d. Run rip [
process-id ]
The RIP view is displayed.
e. Run bfd all-interfaces enable
BFD is enabled in the RIP process to establish a BFD session.
If BFD is enabled globally, RIP will use default BFD parameters to
establish BFD sessions on all the interfaces where RIP neighbor
relationships are in Up state.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 109
f. (Optional) Run bfd all-interfaces { min-rx-interval
min-receive-value |
min-tx-interval
min-transmit-value | detect-multiplier
detect-multiplier-
value } *
The values of BFD parameters used to establish the BFD session are set.
BFD parameter values are determined by the actual network situation
and network reliability requirement.
▪ If links have a high reliability requirement, reduce the interval at
which BFD packets are sent.
▪ If links have a low reliability requirement, increase the interval at
which BFD packets are sent.
Running the bfd all-interfaces command changes BFD session
parameters on all RIP interfaces.
g. (Optional) Perform the following operations to prevent an interface in
the RIP process from establishing a BFD session:
▪ Run the quit command to return to the system view.
▪ Run the interface
interface-type interface-number command to
enter the view of a specified interface.
▪ Run the rip bfd block command to prevent the interface from
establishing a BFD session.
● Enable BFD on RIP interfaces.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is enabled globally.
c. Run quit
Return to the system view.
d. Run interface
interface-type interface-number
The view of the specified interface is displayed.
e. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
f. Run rip bfd enable
BFD is enabled on the interface to establish a BFD session.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 110
g. (Optional) Run rip bfd { min-rx-interval
min-receive-value | min-tx-
interval
min-transmit-value | detect-multiplier
detect-multiplier-value }
*
The values of BFD parameters used to establish the BFD session are set.
----End
Verifying the Configuration
After enabling BFD for RIP at both ends of a link:
● Run the display rip
process-id bfd session { interface
interface-type
interface-number |
neighbor-id | all } command. The command output shows
that the BFDState field on the local switch displays Up.
3.13.2 Configuring Static BFD for RIP
Context
BFD provides link failure detection featuring light load and high speed. Static BFD
for RIP is a method to implement the BFD function.
Establishing BFD sessions between RIP neighbors can rapidly detect faults on links
and speed up response of RIP to network topology changes. Static BFD
implements the following functions:
● One-arm BFD
If not all devices on a network support BFD, configure one-arm BFD to
implement fault detection.
● Two-arm BFD
If all the devices on a network support BFD, configure two-arm BFD to
implement fault detection.
To configure a static BFD session, you need to set parameters for the BFD session.
Procedure
Step 1 Enable BFD globally.
1. Run system-view
The system view is displayed.
2. Run bfd
BFD is enabled globally.
3. Run quit
Return to the system view.
NOTE
To configure one-arm BFD, go to Step 2. To configure two-arm BFD, go to Step 3.
Step 2 Configure one-arm BFD.
1. Run bfd
session-name bind peer-ip
peer-ip interface
interface-type interface-
number [ source-ip
source-ip ] one-arm-echo
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 111
BFD is enabled between the specified interface and peer device.
If a peer IP address and a local interface are specified, BFD detects only a
single-hop link, that is, a route with the interface specified in the bfd
command as the outbound interface and with the peer IP address specified in
the peer-ip command as the next-hop address.
NOTE
When configuring the one-arm Echo function on the device, set the source-ip
source-
ip to the IP address of an interface on the device. Ensure that the peer device can ping
this IP address.
2. Run discriminator local
discr-value
The local discriminator is set.
3. (Optional) Run min-echo-rx-interval
interval
The minimum interval at which BFD packets are received is configured.
4. Run commit
The configuration is committed.
5. Run quit
Return to the system view.
Step 3 Configure two-arm BFD.
1. Run bfd
session-name bind peer-ip
ip-address [ interface
interface-type
interface-number ] [ source-ip
ip-address ]
BFD binding is created.
If a peer IP address and a local interface are specified, BFD detects only a
single-hop link, that is, a route with the interface specified in the bfd
command as the outbound interface and with the peer IP address specified in
the peer-ip command as the next-hop address.
2. Set discriminators.
– Run discriminator local
discr-value
The local discriminator is set.
– Run discriminator remote
discr-value
The remote discriminator is set.
The local discriminator must be the remote discriminator of the device on the
other end; otherwise, a BFD session cannot be established. The local and
remote discriminators cannot be modified after being configured.
NOTE
local
discr-value set on the local device is the same as that of remote
discr-value set
on the remote device.remote
discr-value set on the local device is the same as that of
local
discr-value set on the remote device.
3. Run commit
The configuration is committed.
4. Run quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 112
Return to the system view.
Step 4 Enable static BFD on an interface.
1. Run interface
interface-type interface-number
The view of the specified interface is displayed.
2. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
3. Run rip bfd static
Static BFD is enabled on the interface.
4. Run quit
Return to the system view.
----End
Verifying the Configuration
After configuring static BFD for RIP:
● Run the display rip
process-id interface [
interface-type interface-number ]
verbose command to check BFD for RIP configurations on the specified
interface.
3.14 Configuring the Network Management Function
for RIP
Pre-configuration Tasks
Before configuring the network management function for RIP, configure basic RIP
functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip mib-binding
process-id
RIP is bound to the MIB.
This command is used to bind a RIP process ID to MIBs and specify the ID of the
RIP process that accepts Simple Network Management Protocol (SNMP) requests.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 113
Verifying the Configuration
● Run the display current-configuration command to view the binding
relationships of RIP.
3.15 Maintaining RIP
3.15.1 Resetting RIP
Context
To reset RIP connections, run the following reset commands in the user view.
NOTICE
The RIP neighbor relationship is deleted after you reset RIP connections with the
reset rip command. Exercise caution when running this command.
Procedure
● Run the reset rip
process-id configuration command in the user view to reset
the system parameters of a RIP process. When a RIP process restarts, all the
parameters of the process retain the default values.
----End
3.15.2 Clearing RIP Statistics
Context
To clear RIP statistics, run the following reset commands in the user view.
NOTICE
RIP information cannot be restored after it is cleared. Exercise caution when
running the commands.
Procedure
● Run the reset rip
process-id statistics [ interface { all |
interface-type
interface-number [ neighbor
neighbor-ip-address ] } ] command in the user
view to clear the counters of a RIP process.
----End
3.16 Configuration Examples for RIP
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 114
3.16.1 Example for Configuring Basic RIP Functions
Networking Requirements
In Figure 3-11, SwitchA, SwitchB, SwitchC, and SwitchD are located on a small-
sized network and need to communicate with each other.
Figure 3-11 Configuring basic RIP functions
Configuration Roadmap
RIP-2 is recommended if the network size is small. The configuration roadmap is
as follows:
1. Configure VLAN and IP address for each interface to ensure network
reachability.
2. Enable RIP on each switch to implement network connections between
processes.
3. Configure RIP-2 on each switch to improve RIP performance.
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 115
Step 2 Configure an IP address to each VLANIF interface. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure basic RIP functions.
# Configure SwitchA.
[SwitchA] rip
[SwitchA-rip-1] network 192.168.1.0
[SwitchA-rip-1] quit
# Configure SwitchB.
[SwitchB] rip
[SwitchB-rip-1] network 192.168.1.0
[SwitchB-rip-1] network 172.16.0.0
[SwitchB-rip-1] network 10.0.0.0
[SwitchB-rip-1] quit
# Configure SwitchC.
[SwitchC] rip
[SwitchC-rip-1] network 172.16.0.0
[SwitchC-rip-1] quit
# Configure SwitchD.
[SwitchD] rip
[SwitchD-rip-1] network 10.0.0.0
[SwitchD-rip-1] quit
# Check the RIP routing table of SwitchA.
[SwitchA] display rip 1 route
Route Flags : R - RIP
A - Aging, G - Garbage-collect
----------------------------------------------------------------------------
Peer 192.168.1.2 on Vlanif10
Destination/Mask Nexthop Cost Tag Flags Sec
172.16.0.0/16 192.168.1.2 1 0 RA 14
10.0.0.0/8 192.168.1.2 1 0 RA 14
The command output shows that the routes advertised by RIP-1 use natural
masks.
Step 4 Configure the RIP version.
# Configure RIP-2 on SwitchA.
[SwitchA] rip
[SwitchA-rip-1] version 2
[SwitchA-rip-1] quit
# Configure RIP-2 on SwitchB.
[SwitchB] rip
[SwitchB-rip-1] version 2
[SwitchB-rip-1] quit
# Configure RIP-2 on SwitchC.
[SwitchC] rip
[SwitchC-rip-1] version 2
[SwitchC-rip-1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 116
# Configure RIP-2 on SwitchD.
[SwitchD] rip
[SwitchD-rip-1] version 2
[SwitchD-rip-1] quit
Step 5 Verify the configuration.
# Check the RIP routing table of SwitchA.
[SwitchA] display rip 1 route
Route Flags : R - RIP
A - Aging, G - Garbage-collect
----------------------------------------------------------------------------
Peer 192.168.1.2 on Vlanif10
Destination/Mask Nexthop Cost Tag Flags Sec
172.16.1.0/24 192.168.1.2 1 0 RA 32
10.1.1.0/24 192.168.1.2 1 0 RA 32
From the routing table, you can find that the routes advertised by RIP-2 contain
more accurate subnet masks.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
rip 1
version 2
network 192.168.1.0
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 20 30
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif20
ip address 172.16.1.1 255.255.255.0
#
interface Vlanif30
ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 117
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
rip 1
version 2
network 192.168.1.0
network 172.16.0.0
network 10.0.0.0
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20
#
interface Vlanif20
ip address 172.16.1.2 255.255.255.0
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
rip 1
version 2
network 172.16.0.0
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 30
#
interface Vlanif30
ip address 10.1.1.2 255.255.255.0
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
rip 1
version 2
network 10.0.0.0
#
return
3.16.2 Example for Configuring RIP to Import Routes
Networking Requirements
In Figure 3-12, two RIP processes, RIP 100 and RIP 200, run on SwitchB. SwitchA
needs to communicate with network segment 192.168.3.0/24.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 118
Figure 3-12 Configuring RIP to import external routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable RIP on each switch to implement network connections between
processes.
2. Import routes between RIP 100 and RIP 200 on SwitchB and set the default
metric of routes imported from RIP 200 to 3.
3. Configure an ACL on SwitchB to filter route 192.168.4.0/24 imported from RIP
200 so that SwitchA can only communicate with network segment
192.168.3.0/24.
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs. The configurations of Switch B,
and Switch C are similar to the configuration of Switch A, and are not mentioned
here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 50
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 50
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address to each VLANIF interface. The configurations of Switch B,
and Switch C are similar to the configuration of Switch A, and are not mentioned
here.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] ip address 192.168.0.1 24
[SwitchA-Vlanif50] quit
Step 3 Configure basic RIP functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 119
# Enable RIP 100 on SwitchA.
[SwitchA] rip 100
[SwitchA-rip-100] network 192.168.0.0
[SwitchA-rip-100] network 192.168.1.0
[SwitchA-rip-100] quit
# Enable RIP 100 and RIP 200 on SwitchB.
[SwitchB] rip 100
[SwitchB-rip-100] network 192.168.1.0
[SwitchB-rip-100] quit
[SwitchB] rip 200
[SwitchB-rip-200] network 192.168.2.0
[SwitchB-rip-200] quit
# Enable RIP 200 on SwitchC.
[SwitchC] rip 200
[SwitchC-rip-200] network 192.168.2.0
[SwitchC-rip-200] network 192.168.3.0
[SwitchC-rip-200] network 192.168.4.0
[SwitchC-rip-200] quit
# View the routing table on SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.0.0/24 Direct 0 0 D 192.168.0.1 Vlanif50
192.168.0.1/32 Direct 0 0 D 127.0.0.1 Vlanif50
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
The routing table of SwitchA does not contain the routes imported from other
processes.
Step 4 Configure RIP to import external routes.
# On SwitchB, set the default metric of imported routes to 3 in RIP 100 and
configure the two RIP processes to import routes into each other's routing table.
[SwitchB] rip 100
[SwitchB-rip-100] default-cost 3
[SwitchB-rip-100] import-route rip 200
[SwitchB-rip-100] quit
[SwitchB] rip 200
[SwitchB-rip-200] import-route rip 100
[SwitchB-rip-200] quit
# View the routing table of SwitchA after the routes are imported.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 9 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 120
192.168.0.0/24 Direct 0 0 D 192.168.0.1 Vlanif50
192.168.0.1/32 Direct 0 0 D 127.0.0.1 Vlanif50
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.2.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
192.168.3.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
192.168.4.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
The routing table of SwitchA contains routes 192.168.2.0/24, 192.168.3.0/24, and
192.168.4.0/24, which are learned by RIP 200 on SwitchB.
Step 5 Configure RIP to filter imported routes.
# Configure an ACL on SwitchB and add a rule to the ACL. The rule denies the
packets sent from 192.168.4.0/24.
[SwitchB] acl 2000
[SwitchB-acl-basic-2000] rule deny source 192.168.4.0 0.0.0.255
[SwitchB-acl-basic-2000] rule permit
[SwitchB-acl-basic-2000] quit
# Configure SwitchB to filter route 192.168.4.0/24 imported from RIP 200 based
on the preceding ACL.
[SwitchB] rip 100
[SwitchB-rip-100] filter-policy 2000 export
[SwitchB-rip-100] quit
Step 6 Verify the configuration.
# Display the RIP routing table of SwitchA after the routes are filtered.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 8
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.0.0/24 Direct 0 0 D 192.168.0.1 Vlanif50
192.168.0.1/32 Direct 0 0 D 127.0.0.1 Vlanif50
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.2.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
192.168.3.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
The routing table of SwitchA does not contain the route originating from
192.168.4.0/24.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 50
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface Vlanif50
ip address 192.168.0.1 255.255.255.0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 121
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
rip 100
network 192.168.0.0
network 192.168.1.0
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 20
#
acl number 2000
rule 5 deny source 192.168.4.0 0.0.0.255
rule 10 permit
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif20
ip address 192.168.2.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
rip 100
default-cost 3
network 192.168.1.0
filter-policy 2000 export
import-route rip 200
#
rip 200
network 192.168.2.0
import-route rip 100
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 30 40
#
interface Vlanif20
ip address 192.168.2.2 255.255.255.0
#
interface Vlanif30
ip address 192.168.3.1 255.255.255.0
#
interface Vlanif40
ip address 192.168.4.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 122
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
rip 200
network 192.168.2.0
network 192.168.3.0
network 192.168.4.0
#
return
3.16.3 Example for Configuring One-Arm Static BFD for RIP
Networking Requirements
In Figure 3-13, four switches communicate using RIP on a small-sized network.
Services are transmitted through the primary link SwitchA→SwitchB→SwitchD.
Reliability must be improved for data transmitted from SwitchA to SwitchB so that
services can be rapidly switched to another path when the primary link fails.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 3-13 One-arm static BFD for RIP
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP address for each interface to ensure network reachability.
2. Enable RIP on each switch to implement network connections between
processes.
3. Configure one-arm static BFD on SwitchA. BFD can rapidly detect the link
status and help RIP speed up route convergence to implement fast link
switching.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 123
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address to each VLANIF interface. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.2.2.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.3.3.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic RIP functions.
# Configure SwitchA.
[SwitchA] rip 1
[SwitchA-rip-1] version 2
[SwitchA-rip-1] network 10.0.0.0
[SwitchA-rip-1] quit
# Configure SwitchB.
[SwitchB] rip 1
[SwitchB-rip-1] version 2
[SwitchB-rip-1] network 10.0.0.0
[SwitchB-rip-1] network 172.16.0.0
[SwitchB-rip-1] quit
# Configure SwitchC.
[SwitchC] rip 1
[SwitchC-rip-1] version 2
[SwitchC-rip-1] network 10.0.0.0
[SwitchC-rip-1] quit
# Configure SwitchD.
[SwitchD] rip 1
[SwitchD-rip-1] version 2
[SwitchD-rip-1] network 172.16.0.0
[SwitchD-rip-1] quit
# After completing the preceding operations, run the display rip neighbor
command. The command output shows that SwitchA, SwitchB, and SwitchC have
established neighbor relationships with each other. In the following example, the
display on SwitchA is used.
[SwitchA] display rip 1 neighbor
---------------------------------------------------------------------
IP Address Interface Type Last-Heard-Time
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 124
---------------------------------------------------------------------
10.2.2.2 Vlanif10 RIP 0:0:10
Number of RIP routes : 2
10.3.3.2 Vlanif20 RIP 0:0:8
Number of RIP routes : 1
# Run the display ip routing-table command. The command output shows that
the devices have imported routes from each other. In the following example, the
display on SwitchA is used.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.2.2.0/24 Direct 0 0 D 10.2.2.1 Vlanif10
10.2.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.4.4.0/24 RIP 100 1 D 10.2.2.2 Vlanif10
RIP 100 1 D 10.3.3.2 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 RIP 100 1 D 10.2.2.2 Vlanif10
The preceding command output shows that the next-hop address and outbound
interface of the route to destination 172.16.1.0/24 are 10.2.2.2 and VLANIF10, and
traffic is transmitted over the active link SwitchA->SwitchB.
Step 4 Configure one-arm static BFD on SwitchA.
# Configure one-arm BFD on SwitchA.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] bfd 1 bind peer-ip 10.2.2.2 interface vlanif 10 source-ip 10.1.1.1 one-arm-echo
[SwitchA-bfd-session-1] discriminator local 1
[SwitchA-bfd-session-1] min-echo-rx-interval 200
[SwitchA-bfd-session-1] commit
[SwitchA-bfd-session-1] quit
The source IP address 10.1.1.1 can be configured as the IP address of another
interface (such as loopback interface) on the device. This parameter must be
configured. Otherwise, the BFD session cannot be set up.
# Enable static BFD on VLANIF 10.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] rip bfd static
[SwitchA-Vlanif10] quit
# After the configurations are completed, run the display bfd session all
command on SwitchA. The command output shows that a static BFD session has
been set up.
[SwitchA] display bfd session all
--------------------------------------------------------------------------------
Local Remote PeerIpAddr State Type InterfaceName
--------------------------------------------------------------------------------
1 - 10.2.2.2 Up S_IP_IF Vlanif10
--------------------------------------------------------------------------------
Total UP/DOWN Session Number : 1/0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 125
Step 5 Verify the configuration.
# Run the shutdown command on GigabitEthernet0/0/1 of SwitchB to simulate a
fault in the active link.
NOTE
The link fault is simulated to verify the configuration. In actual situations, the operation is
not required.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# Check the routing table of SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.4.4.0/24 RIP 100 1 D 10.3.3.2 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 RIP 100 2 D 10.3.3.2 Vlanif20
The preceding command output shows that the standby link SwitchA->SwitchC-
>SwitchB is used after the active link fails, and the next-hop address and
outbound interface of the route to destination 172.16.1.0/24 are 10.3.3.2 and
VLANIF20.
----End
Configuration files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
bfd
#
interface Vlanif10
ip address 10.2.2.1 255.255.255.0
rip bfd static
#
interface Vlanif20
ip address 10.3.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
bfd 1 bind peer-ip 10.2.2.2 interface Vlanif10 source-ip 10.1.1.1 one-arm-echo
discriminator local 1
min-echo-rx-interval 200
commit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 126
#
rip 1
version 2
network 10.0.0.0
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 30 40
#
interface Vlanif10
ip address 10.2.2.2 255.255.255.0
#
interface Vlanif30
ip address 10.4.4.1 255.255.255.0
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
rip 1
version 2
network 10.0.0.0
network 172.16.0.0
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 30
#
interface Vlanif20
ip address 10.3.3.2 255.255.255.0
#
interface Vlanif30
ip address 10.4.4.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
rip 1
version 2
network 10.0.0.0
#
return
● SwitchD configuration file
#
sysname SwitchD
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 127
#
vlan batch 40
#
interface Vlanif40
ip address 172.16.1.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 40
#
rip 1
version 2
network 172.16.0.0
#
return
3.16.4 Example for Configuring Dynamic BFD for RIP
Networking Requirements
In Figure 3-14, four switches communicate using RIP on a small-sized network.
Services are transmitted through the primary link SwitchA→SwitchB→SwitchD.
Reliability must be improved for data transmitted from SwitchA to SwitchB so that
services can be rapidly switched to another path when the primary link fails.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 3-14 Configuring dynamic BFD for RIP
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP address for each interface to ensure network reachability.
2. Enable RIP on each switch to implement network connections between
processes.
3. Configure BFD for RIP on interfaces at both ends of the link between SwitchA
and SwitchB. BFD can rapidly detect the link status and help RIP speed up
route convergence to implement fast link switching.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 128
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address to each VLANIF interface. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.2.2.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.3.3.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic RIP functions.
# Configure SwitchA.
[SwitchA] rip 1
[SwitchA-rip-1] version 2
[SwitchA-rip-1] network 10.0.0.0
[SwitchA-rip-1] quit
# Configure SwitchB.
[SwitchB] rip 1
[SwitchB-rip-1] version 2
[SwitchB-rip-1] network 10.0.0.0
[SwitchB-rip-1] network 172.16.0.0
[SwitchB-rip-1] quit
# Configure SwitchC.
[SwitchC] rip 1
[SwitchC-rip-1] version 2
[SwitchC-rip-1] network 10.0.0.0
[SwitchC-rip-1] quit
# Configure SwitchD.
[SwitchD] rip 1
[SwitchD-rip-1] version 2
[SwitchD-rip-1] network 172.16.0.0
[SwitchD-rip-1] quit
# After completing the preceding operations, run the display rip neighbor
command. The command output shows that SwitchA, SwitchB, and SwitchC have
established neighbor relationships with each other. In the following example, the
display on SwitchA is used.
[SwitchA] display rip 1 neighbor
---------------------------------------------------------------------
IP Address Interface Type Last-Heard-Time
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 129
---------------------------------------------------------------------
10.2.2.2 Vlanif10 RIP 0:0:14
Number of RIP routes : 2
10.3.3.2 Vlanif20 RIP 0:0:19
Number of RIP routes : 1
# Run the display ip routing-table command. The command output shows that
the switches have imported routes from each other. In the following example, the
display on SwitchA is used.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.2.2.0/24 Direct 0 0 D 10.2.2.1 Vlanif10
10.2.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.4.4.0/24 RIP 100 1 D 10.3.3.2 Vlanif20
RIP 100 1 D 10.2.2.2 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 RIP 100 1 D 10.2.2.2 Vlanif10
The preceding command output shows that the next-hop address and outbound
interface of the route to destination 172.16.1.0/24 are 10.2.2.2 and VLANIF10, and
traffic is transmitted over the active link SwitchA->SwitchB.
Step 4 Configure BFD in RIP processes.
# Configure BFD on all interfaces of SwitchA. The configuration of SwitchB is
similar to that of SwitchA, and is not provided here.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] rip 1
[SwitchA-rip-1] bfd all-interfaces enable
[SwitchA-rip-1] bfd all-interfaces min-tx-interval 100 min-rx-interval 100 detect-multiplier 10
[SwitchA-rip-1] quit
# After completing the preceding operations, run the display rip bfd session
command on SwitchA. The command output shows that SwitchA and SwitchB
have established a BFD session and the BFDState field displays Up. In the
following example, the display on SwitchA is used.
[SwitchA] display rip 1 bfd session all
LocalIp : 10.2.2.1 RemoteIp : 10.2.2.2 BFDState : Up
TX : 100 RX : 100 Multiplier : 10
BFD Local Dis : 8192 Interface : Vlanif10
Diagnostic Info : No diagnostic information
LocalIp : 10.3.3.1 RemoteIp : 10.3.3.2 BFDState : Down
TX : 2800 RX : 2800 Multiplier : 0
BFD Local Dis : 8193 Interface : Vlanif20
Diagnostic Info : No diagnostic information
Step 5 Verify the configuration.
# Run the shutdown command on GigabitEthernet0/0/1 of SwitchB to simulate a
fault in the active link.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 130
NOTE
The link fault is simulated to verify the configuration. In actual situations, the operation is
not required.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# Check the routing table of SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.4.4.0/24 RIP 100 1 D 10.3.3.2 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 RIP 100 2 D 10.3.3.2 Vlanif20
The preceding command output shows that the standby link SwitchA->SwitchC-
>SwitchB is used after the active link fails, and the next-hop address and
outbound interface of the route to destination 172.16.1.0/24 are 10.3.3.2 and
VLANIF20.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
bfd
#
interface Vlanif10
ip address 10.2.2.1 255.255.255.0
#
interface Vlanif20
ip address 10.3.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
rip 1
version 2
network 10.0.0.0
bfd all-interfaces enable
bfd all-interfaces min-tx-interval 100 min-rx-interval 100 detect-multiplier 10
#
return
● SwitchB configuration file
#
sysname SwitchB
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 131
#
vlan batch 10 30 40
#
bfd
#
interface Vlanif10
ip address 10.2.2.2 255.255.255.0
#
interface Vlanif30
ip address 10.4.4.1 255.255.255.0
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
rip 1
version 2
network 10.0.0.0
network 172.16.0.0
bfd all-interfaces enable
bfd all-interfaces min-tx-interval 100 min-rx-interval 100 detect-multiplier 10
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 30
#
interface Vlanif20
ip address 10.3.3.2 255.255.255.0
#
interface Vlanif30
ip address 10.4.4.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
rip 1
version 2
network 10.0.0.0
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 40
#
interface Vlanif40
ip address 172.16.1.2 255.255.255.0
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 132
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 40
#
rip 1
version 2
network 172.16.0.0
#
return
3.17 Troubleshooting RIP
3.17.1 Failed to Receive RIP Update Packets from Neighbors
Fault Description
A device cannot receive RIP Update packets from neighbors when the link runs
properly.
Procedure
Step 1 Run the display current-configuration configuration rip command to check RIP
configurations.
● Check whether RIP has been enabled on the interface. Only the RIP-enabled
interface can receive RIP packets.
● Check whether the version number in the RIP packet sent by the peer
interface matches the version number in the RIP packet received by the local
interface. If not, the two interfaces cannot establish the RIP neighbor
relationship.
Step 2 Run the display current-configuration interface
interface-type interface-number
command to view the interface configuration.
● Check whether the undo rip input command has been executed on the
interface. If the command has been executed, the interface does not receive
RIP packets.
● Check whether the authentication modes on the two ends of the link are the
same. If the authentication modes are different, the interface cannot receive
RIP packets from the peer.
----End
3.17.2 Failed to Send RIP Update Packets to Neighbors
Fault Description
A device cannot send RIP Update packets to neighbors when the link runs
properly.
Procedure
Step 1 Run the display current-configuration configuration rip command to check RIP
configurations.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 133
● Check whether RIP has been enabled on the interface. Only the RIP-enabled
interface can send RIP packets.
● Check whether the silent-interface command has been executed on the
interface. If the command has been executed, the interface does not send RIP
packets.
Step 2 Run the display current-configuration interface
interface-type interface-number
command to view the interface configuration.
● Check whether the undo rip output command has been executed on the
interface. If the command has been executed, the interface does not send RIP
packets.
● Check whether the authentication modes on the two ends of the link are the
same. If the authentication modes are different, the interface cannot send RIP
packets to the peer.
● Check whether split horizon has been enabled on the interface. If split horizon
has been enabled, the interface cannot send the route learned by itself to
neighbors.
NOTE
Split horizon is enabled on all interfaces by default, but the display current-
configuration command output does not show the split horizon option. If the
command output for an interface connected to an NBMA network does not contain
the split horizon option, split horizon is disabled on the interface.
----End
3.17.3 Route Flapping Occurs on a RIP Network
Fault Description
Route flapping occurs on a RIP network when the link runs properly. Some routes
intermittently disappear in the routing table.
Procedure
Step 1 Run the display rip command to check the configuration of RIP timers.
The RIP timers on the entire network must be consistent; otherwise, route flapping
occurs. The relationships between the timer values are
update <
age,
update <
garbage-collect.
Step 2 Run the timers rip
update age garbage-collect command to set the RIP timers.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 134
4 RIPng Configuration
4.1 Overview of RIPng
4.2 Understanding RIPng
4.3 Summary of RIPng Configuration Tasks
4.4 Licensing Requirements and Limitations for RIPng
4.5 Default Settings for RIPng
4.6 Configuring Basic RIPng Functions
4.7 Preventing Routing Loops
4.8 Controlling RIPng Routing
4.9 Controlling RIPng Route Advertisement
4.10 Controlling the Receiving of RIPng Routes
4.11 Improving RIPng Network Performance
4.12 Configuring IPSec Authentication for RIPng
4.13 Clearing RIPng
4.14 Example for Configuring RIPng to Filter the Received Routes
4.1 Overview of RIPng
The Routing Information Protocol Next Generation (RIPng) is a simple Interior
Gateway Protocol (IGP). It is an extension to RIP on IPv6 networks. RIPng applies
to small-scale networks, such as campus networks and regional networks with
simple structure. RIPng is widely used on networks because it is easier to
implement, configure, and manage than OSPFv3 and IPv6 IS-IS.
NOTE
RIPng does not have any security authentication mechanism. For security purposes, use
OSPFv3, IPv6 IS-IS, or BGP4+.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 135
4.2 Understanding RIPng
4.2.1 RIPng
In addition to IPv4 networks, RIP is also applicable to IPv6 networks to provide
accurate route information for IPv6 packets. The IETF has defined RIP next
generation (RIPng) based on RIP for IPv6 networks. RIPng is an important protocol
for IPv6 networks.
Comparison Between RIPng and RIP
RIPng made the following modifications to RIP:
● RIPng uses UDP port 521 to send and receive routing information.
● RIPng uses the destination addresses with 128-bit prefixes (mask length).
● RIPng uses 128-bit IPv6 addresses as next-hop addresses.
● RIPng uses the local-link address FE80::/10 as the source address to send
RIPng Update packets.
● RIPng periodically sends routing information in multicast mode and uses
FF02::9 as multicast address.
● A RIPng packet consists of a header and multiple route table entries (RTEs). In
a RIPng packet, the maximum number of RTEs depends on the MTU of an
interface.
4.3 Summary of RIPng Configuration Tasks
Table 4-1 describes RIPng configuration tasks.
Table 4-1 RIPng configuration tasks
Scenario Description Task
Configuring basic RIPng
functions
Basic RIPng functions
include enabling RIPng
and enabling the RIPng
process on interfaces.
Basic RIPng functions
must be configured
before you use the RIPng
features.
4.6 Configuring Basic
RIPng Functions
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 136
Scenario Description Task
Preventing routing loops RIPng is a distance-
vector routing protocol.
RIPng devices advertise
their local IPv6 routing
tables to neighbors, so
routing loops may occur.
RIPng uses split horizon
and poison reverse to
prevent routing loops:
● Split horizon: A route
learned by RIPng
from an interface is
not sent to neighbors
from this interface.
This reduces
bandwidth
consumption and
prevents routing
loops.
● Poison reverse: RIPng
sets the cost of a
route learned from an
interface to 16
(unreachable), and
sends this route to
neighbors through
this interface. In this
way, RIPng can delete
useless routes from
neighbors' routing
table and prevent
routing loops.
4.7 Preventing Routing
Loops
Controlling RIPng routing To use RIPng more
flexibly on the existing
network and meet
various user
requirements, you can
configure different
parameters to control
RIPng routing.
4.8 Controlling RIPng
Routing
Controlling the
advertising and receiving
of RIPng routes
To meet network
requirements, you can
configure different
parameters to accurately
control the advertising
and receiving of RIPng
routes.
4.9 Controlling RIPng
Route Advertisement
4.10 Controlling the
Receiving of RIPng
Routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 137
Scenario Description Task
Improving RIPng
network performance
You can configure special
RIPng functions to
improve RIPng network
performance.
● Adjust the RIPng
timer to change the
RIPng network
convergence speed.
● Adjust the number
and interval of
Update packets sent
by an interface to
reduce consumption
of device resources
and network
bandwidth.
● Check the zero fields
in RIPng packets to
ensure high network
security.
4.11 Improving RIPng
Network Performance
4.4 Licensing Requirements and Limitations for RIPng
Involved Network Elements
Other network elements are required to support RIPng.
Licensing Requirements
RIPng is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support RIPng.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 138
Feature Limitations
When the maximum number of RIPng routes supported by a switch is fixed, the
maximum number of running RIPng routes supported on the switch is limited by
the CAR value of RIPng protocol packets, interval for sending RIP update packets,
and values of RIPng Age and Garbage-collect timers. To increase the maximum
number of running RIPng routes on a switch if there are large numbers of RIPng
routes running on the network, increase the values of the Age timer, Garbage-
collect timer, or CAR for RIPng protocol packets, as well as reducing the interval
for sending RIPng update packets.
4.5 Default Settings for RIPng
Table 4-2 describes the default settings for RIPng.
Table 4-2 Default settings for RIPng
Parameter Default Setting
Maximum number of equal-cost
routes
8
RIPng function Disabled
4.6 Configuring Basic RIPng Functions
Pre-configuration Tasks
Before configuring basic RIPng functions, complete the following tasks:
● Enable IPv6 on the switch.
● Configure IPv6 addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
Configuration Procedure
Creating RIPng processes is the prerequisite for enabling RIPng on interfaces.
4.6.1 Enabling RIPng
Context
Enabling RIPng is the prerequisite for all RIPng configurations. If you run RIPng
commands in the interface view before enabling RIPng, the configurations take
effect only after RIPng is enabled.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 139
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
A RIPng process is created, RIPng is enabled, and the RIPng view is displayed.
If a VPN instance is specified, the RIPng process belongs to this VPN instance. If no
VPN instance is specified, the RIPng process belongs to a public network instance.
Step 3 (Optional) Run description
text
A description is configured for the RIP process.
----End
4.6.2 Enabling RIPng on Interfaces
Context
After RIPng is enabled on an interface, devices can exchange RIPng routing
information through this interface.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng
process-id enable
RIPng is enabled on the specified interface.
NOTE
If IPv6 is not enabled on this interface, this command does not take effect on this interface.
If RIPng needs to be enabled on multiple interfaces of a switch, repeat steps 2 and
3.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 140
4.6.3 Verifying the Basic RIPng Function Configuration
Procedure
● Run the display ripng [
process-id | vpn-instance
vpn-instance-name ]
command to check the configuration of the specified RIPng process.
● Run the display ripng
process-id route command to check all the RIPng
routes that are learned from other switches.
● Run the display default-parameter ripng command to check the default
RIPng configuration.
● Run the display ripng
process-id statistics interface { all |
interface-type
interface-number [ neighbor
neighbor-ipv6-address | verbose ] } command
to check statistics about RIPng interfaces.
----End
4.7 Preventing Routing Loops
Pre-configuration Tasks
Before configuring split horizon and poison reverse, configure basic RIPng
functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIPng Routing Loop Prevention Configuration) in any sequence as required.
4.7.1 Configuring Split Horizon
Context
Split horizon can prevent routing loops.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 141
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng split-horizon
Split horizon is configured.
NOTE
● By default, split horizon is disabled on a Non-Broadcast Multiple Access (NBMA)
network.
● If both split horizon and poison reverse are configured, only poison reverse takes effect.
----End
4.7.2 Configuring Poison Reverse
Context
Poison reverse can prevent routing loops.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng poison-reverse
Poison reverse is enabled.
NOTE
If both split horizon and poison reverse are configured, only poison reverse takes effect.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 142
4.7.3 Verifying the RIPng Routing Loop Prevention
Configuration
Procedure
● Run the display ripng
process-id interface [
interface-type interface-
number ] [ verbose ] command to check information about the specified
RIPng interface.
----End
4.8 Controlling RIPng Routing
Pre-configuration Tasks
Before configuring RIPng route attributes, configure basic RIPng functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIPng Routing Control Configuration) in any sequence as required.
4.8.1 Configuring RIPng Preference
Context
When different routing protocols discover the routes to the same destination, set
the RIPng preference to select the required route.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
The RIPng view is displayed.
Step 3 Run preference {
preference | route-policy
route-policy-name } *
The RIPng preference value is set.
By default, the RIPng preference value is 100.
----End
4.8.2 Configuring Additional Metrics of an Interface
Context
Configuring the additional metrics of a RIPng interface can change the route
selection sequence.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 143
The additional metric is the metric (hop count) to be added to the original metric
of a RIPng route. You can set additional metrics for incoming and outgoing RIPng
routes using commands.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run the following commands as required:
● Run the ripng metricin
value command to set the additional metric for
receiving routes. By default, an interface does not add the metric to a received
RIPng route.
● Run the ripng metricout {
value | {
acl6-number | acl6-name
acl6-name |
ipv6-prefix
ipv6-prefix-name }
value1 } command to set the additional metric
for advertising routes. By default, the metric that is added to the RIPng route
sent by an interface is 1.
NOTE
● The ripng metricin command adds an additional metric to an incoming route. After this
route is added to the routing table, its metric in the routing table changes. Running this
command affects route selection on the local device and other devices on the network.
● The ripng metricout command adds an additional metric to an outgoing route. When
this route is advertised, an additional metric is added to this route, but the metric of the
route in the routing table does not change. Running this command does not affect route
selection on the local device but other devices on the network.
----End
4.8.3 Setting the Maximum Number of Equal-Cost Routes
Context
By setting the maximum number of equal-cost RIPng routes, you can change the
number of routes for load balancing.
NOTE
Only the S5720I-SI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S,
S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and
S6730S-S support this function.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 144
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
RIPng is enabled and the RIPng view is displayed.
Step 3 Run maximum load-balancing
number
The maximum number of equal-cost routes is set.
The default value is 8.
----End
4.8.4 Verifying the RIPng Routing Control Configuration
Procedure
● Run the display ripng [
process-id | vpn-instance
vpn-instance-name ]
command to check the running status and configurations of RIPng.
● Run the display ripng
process-id database [ verbose ] command to check all
the active routes in the RIPng database.
● Run the display ripng
process-id route command to check all RIPng routes
learned from other devices.
----End
4.9 Controlling RIPng Route Advertisement
Pre-configuration Tasks
Before controlling RIPng route advertisement, configure basic RIPng functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIPng Route Advertisement Control Configuration) in any sequence as
required.
4.9.1 Configuring RIPng Route Summarization
Context
Route summarization can reduce the routing table size and minimize impact of
route flapping on the network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 145
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng summary-address
ipv6-address prefix-length [ avoid-feedback ]
RIPng route summarization is configured.
By default, a RIPng router does not advertise summarized IPv6 addresses.
----End
4.9.2 Advertising a Default Route
Context
In an IPv6 routing table, a default route is a route to network ::/0. If the
destination address of a packet does not match any entry in the routing table, the
packet is sent through a default route.
There are two methods to advertise RIPng default routes. You can configure a
device to advertise RIPng default routes according to networking requirements.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 146
Step 4 Run ripng default-route { only | originate } [ cost
cost ]
The device is configured to advertise RIPng default routes.
By default, there is no default route in the RIPng routing domain.
Configure the device to advertise default routes according to networking
requirements:
● only: configures the device to advertise only IPv6 default routes (::/0),
suppressing the advertisement of other routes. If the local device is located on
the network edge and the details of the local network need to be hidden, you
can set this parameter to enable the devices on other networks to access the
local network only through the local device.
● originate: configures the device to advertise IPv6 default routes (::/0) without
affecting the advertisement of other routes. If the local device is located on
the network edge and some details of the local network need to be hidden,
you can set this parameter to enable the devices on other networks to use the
default route when connecting to certain devices on the local network.
The device advertises generated RIPng default routes using Update packets
through a specified interface regardless of whether these routes exist in the local
IPv6 routing table.
----End
4.9.3 Configuring a RIPng Process to Import External Routes
Context
A RIPng process can import the routes learned by other processes or routing
protocols to enrich its routing information.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
The RIPng view is displayed.
Step 3 (Optional) Run default-cost
cost
The default cost of external routes to be imported is set.
By default, the default cost of RIPng routes is 0.
If no cost is set for external routes to be imported, the default cost is used.
NOTE
When a RIPng process imports IBGP routes, routing loops may occur. Therefore, exercise
caution before you configure this function.
Step 4 Run import-route { { ripng | isis | ospfv3 } [
process-id ] | bgp [ permit-ibgp ] |
unr | direct | static } [ [ cost
cost | inherit-cost ] | route-policy
route-policy-
name ] *
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 147
External routes are imported.
Step 5 (Optional) Run filter-policy {
acl6-number | acl6-name
acl6-name | ipv6-prefix
ipv6-prefix-name | route-policy
route-policy-name } export [
protocol [
process-
id ] ]
The RIPng process is configured to filter imported routes.
A RIPng process can use ACL6, route policy and IPv6 prefix lists to filter imported
routes, allowing only the routes matching ACL6, route policy and IPv6 prefix lists
to be advertised to RIPng neighbors. If
protocol is not specified, the RIPng process
filters all the routes to be advertised, including imported routes and local RIPng
routes (similar to direct routes).
----End
4.9.4 Disabling Sending of RIPng Packets on an Interface
Context
When a device running RIPng is connected to a network running other routing
protocols, you can run the undo ripng output command on the interface that
connects the device to the network to prevent the interface from sending useless
packets to the network.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run undo ripng output
The interface is disabled from sending RIPng packets.
By default, an interface is allowed to send RIPng packets.
----End
4.9.5 Disabling Receiving of RIPng Packets on an Interface
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 148
Context
When a device running RIPng is connected to a network running other routing
protocols, you can run the undo ripng input command on the interface that
connects the device to the network to prevent the interface from receiving useless
packets from the network.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run undo ripng input
The interface is disabled from receiving RIPng packets.
By default, an interface is allowed to receive RIPng packets.
----End
4.9.6 Verifying the RIPng Route Advertisement Control
Configuration
Procedure
● Run the display ripng
process-id database [ verbose ] command to check all
activated routes in the RIPng database.
● Run the display ripng
process-id route command to check all the RIPng
routes that are learned from other switches.
----End
4.10 Controlling the Receiving of RIPng Routes
Pre-configuration Tasks
Before controlling the receiving of RIPng routes, configure basic RIPng functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 149
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ]
The RIPng view is displayed.
Step 3 Run filter-policy {
acl6-number | acl6-name
acl6-name | ipv6-prefix
ipv6-prefix-
name | route-policy
route-policy-name } import
The RIPng process is configured to filter received routes.
You can use ACL6, route policy and IPv6 prefix lists to filter received RIPng routes,
allowing only the routes matching ACL6, route policy and IPv6 prefix lists to be
added to RIPng routing tables.
----End
Verifying the Configuration
● Run the display ripng
process-id database [ verbose ] command to check all
the active routes in the RIPng database.
● Run the display ripng
process-id route command to check all the RIPng
routes learned from other switches.
4.11 Improving RIPng Network Performance
Pre-configuration Tasks
Before improving RIPng network performance, configure basic RIPng functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIPng Network Performance Optimization Configuration) in any sequence as
required.
4.11.1 Configuring RIPng Timers
Context
RIPng uses 3 timers: Update, Age, and Garbage-collect. Changing the timer values
affects the convergence speed of RIPng routes.
Procedure
Step 1 Run system-view
The system view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 150
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
The RIPng process is enabled and the RIPng view is displayed.
Step 3 Run timers ripng
update age garbage-collect
RIPng timers are configured.
NOTE
● RIPng timers take effect immediately after being changed.
● Route flapping occurs if the values of the three timers are set improperly. The
relationship between the values is:
update must be smaller than
age and
garbage-
collect. If the update time is longer than the aging time and for example, a RIPng route
changes within the update time, the switch cannot inform its neighbors of the change
on time.
● Configure RIPng timers based on the network performance ensure that these timers are
consistent on all RIPng devices. This avoids unnecessary network traffic or route
flapping.
By default, the Update timer is 30s; the Age timer is 180s; the Garbage-collect
timer is 120s (four times the Update timer).
In practice, the Garbage-collect timer is not fixed. If the Update timer is set to 30s,
the Garbage-collect timer may range from 90s to 120s.
Before permanently deleting an unreachable route from its RIPng routing table, a
RIPng device advertises this route (with the metric set to 16) four times by
periodically sending Update packets. Subsequently, all the neighbors learn that
this route is unreachable. Because a route may not always become unreachable at
the beginning of an Update period, the Garbage-collect timer ranges from three
or four times the Update timer.
----End
4.11.2 Setting the Interval for Sending Update Packets and
Maximum Number of Sent Packets
Context
To limit memory resources occupied by RIPng Update packets, set the interval for
sending RIPng Update packets and the maximum number of Update packets to be
sent at a time to appropriate values.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 151
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng pkt-transmit { interval
interval | number
pkt-count }*
The interval for sending RIPng Update packets and the maximum number of
Update packets to be sent at a time are set.
----End
4.11.3 Enabling Zero Field Check for RIPng Packets
Context
In a RIPng packet, some fields must be zero. These fields are called zero fields.
When receiving a packet, a RIPng process checks the zero fields of the packet. If
the value of a zero field in the packet is not 0, the RIPng process discards the
packet.
Enabling zero field check on RIPng Update packets can improve network security.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
The RIPng view is displayed.
Step 3 Run checkzero
Zero field check is enabled for RIPng packets.
----End
4.11.4 Verifying the RIPng Network Performance
Optimization Configuration
Procedure
● Run the display ripng [
process-id | vpn-instance
vpn-instance-name ]
command to check the configuration of the RIPng process.
● Run the display ripng
process-id database [ verbose ] command to check all
activated routes in the RIPng database.
● Run the display ripng
process-id interface [
interface-type interface-
number ] [ verbose ] command to check information about the RIPng
interface.
● Run the display ripng
process-id neighbor [ verbose ] command to check
information about RIPng neighbors.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 152
● Run the display ripng
process-id route command to check all the RIPng
routes that are learned from other switches.
----End
4.12 Configuring IPSec Authentication for RIPng
4.12.1 Configuring an IPSec Session for Encryption
Context
Internet Protocol Security (IPSec) can be configured to prevent data theft and
spoofing during data transmission in a network.
A security association (SA) must be established so that IPSec can protect
transmitted data. An SA is a unidirectional logical connection set up for security
purpose and specifies the elements used by two IPSec peers (two parties that use
the IPSec protocol to protect data transmitted between them). The elements of an
SA include the following:
● Security protocol
● Authentication or encryption algorithm supported by the security protocol
● Data encapsulation mode
● Security parameter index (SPI) of the SA
● Authentication key or encryption key of the SA
The first three elements are specified in an IPSec proposal. To configure IPSec
functions, first configure an IPSec proposal on the IPSec peers, and then configure
an SA.
Procedure
Step 1 Configure an IPSec proposal.
1. Run system-view
The system view is displayed.
2. Run ipsec proposal
proposal-name
An IPSec proposal is created and the IPSec proposal view is displayed.
3. Run transform { ah | esp }
A security protocol is specified for the IPSec proposal.
By default, the security protocol used by an IPSec proposal is the
Encapsulation Security Protocol (ESP).
4. An authentication or encryption algorithm is configured.
– If AH is used, you can only configure the AH-specific authentication
algorithm because AH only authenticates packets.
Run the ah authentication-algorithm { sha1 | sha2-256 } command to
specify the authentication algorithm for the AH protocol.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 153
By default, the AH protocol uses the Secure Hash Algorithm 2-256
(SHA2-256) authentication algorithm.
– When ESP is specified, ESP can encrypt/authenticate, or encrypt and
authenticate packets. Configure the ESP-specific authentication or
encryption algorithm.
▪ Run the esp authentication-algorithm { sha1 | sha2-256 }
command to specify the authentication algorithm for the ESP
protocol.
By default, the authentication algorithm SHA2-256 is used for ESP.
▪ Run the esp encryption-algorithm { 3des | aes [ 128 | 192 | 256 ] }
command to specify the encryption algorithm for the ESP protocol.
By default, the encryption algorithm Advanced Encryption
Standard-256 (AES-256) is used for ESP.
The SHA-1 and 3DES algorithm is not recommended because it cannot meet
your security defense requirements.
5. Run encapsulation-mode { transport | tunnel }
A data encapsulation mode is specified for the security protocol.
By default, the data encapsulation mode is tunnel.
NOTE
In transport mode, the packet encryption device and decryption device must be the
originator and receiver of packets.
6. Run quit
Return to the system view.
Step 2 Configure an IPSec SA.
1. Run ipsec sa
sa-name
An IPSec SA is created and the IPSec SA view is displayed.
By default, no IPSec SA exists in the system.
2. Run proposal
proposal-name
The IPSec proposal is bound to the IPSec SA.
By default, an IPSec policy does not reference any IPSec proposal.
NOTE
An IPSec can use only one IPSec proposal. To bind a new IPSec proposal to the IPSec
SA, delete the original IPSec proposal.
3. Run sa spi { inbound | outbound } { ah | esp }
spi-number
An SPI is configured for the SA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 154
NOTE
– An SPI uniquely identifies an SA. Each SA must be configured with an inbound SPI
and an outbound SPI. The outbound SPI on the local end must be the same as the
inbound SPI on the remote end.
– The security protocol (AH or ESP) you select when configuring the SPI must be the
same as that used in the IPSec proposal bound to the SA.
4. Configure a key according to the security protocol used in the IPSec proposal
bound to the SA.
– If the AH protocol is used, you can configure an authentication key that is
a hexadecimal number or a character string.
▪ Run the sa authentication-hex { inbound | outbound } ah
[ cipher ]
hex-cipher-key command to configure a hexadecimal
authentication key.
▪ Run the sa string-key { inbound | outbound } ah [ cipher ]
string-
cipher-key command to configure a character string as the
authentication key.
– If the ESP protocol is used, you can run one of the following commands
to configure the authentication key or the encryption key. You can also
configure both the authentication key and encryption key. If the two keys
are configured at the same time, they can only be hexadecimal keys.
▪ Run the sa authentication-hex { inbound | outbound } esp
[ cipher ]
hex-cipher-key command to configure a hexadecimal
authentication key.
▪ Run the sa string-key { inbound | outbound } esp [ cipher ]
string-
cipher-key command to configure a character string as the
authentication key.
▪ Run the sa encryption-hex { inbound | outbound } esp [ cipher ]
hex-cipher-key command to configure a hexadecimal encryption key.
NOTE
– The security protocol (AH or ESP) you select when configuring the key must be the
same as that used in the IPSec proposal bound to the SA.
– The outbound key on the local end must be the same as the inbound key on the
remote end.
– The IPSec peers must use the authentication or encryption key in the same format.
For example, if the key on one end is a character string but the key on the other
end is a hexadecimal number, the IPSec tunnel cannot be set up.
– If you configure multiple keys in different formats, the last configured key takes
effect.
Step 3 Verify the configuration.
1. Run the display ipsec sa [ name
sa-name ] [ brief ] command to check
information about the SA.
2. Run the display ipsec proposal [ name
proposal-name ] command to check
information about the security proposal.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 155
3. Run the display ipsec statistics [ sa-name
sa-name slot
slot-number ]
command to check statistics about packets processed by IPSec.
----End
4.12.2 Configuring RIPng IPSec Authentication
Context
As networks develop rapidly, network security has become a major concern. If
IPSec authentication is configured on a RIPng network, the sent and received
RIPng packets will be authenticated, and those cannot pass authentication will be
discarded. This can improve the security of the RIPng network.
There are two methods of configuring IPSec authentication for RIPng:
● One method is to configure IPSec authentication in RIPng processes. If IPSec
authentication is enabled in a RIPng process, this configuration takes effect on
all interfaces in this RIPng process. This method is recommended if IPSec
authentication needs to be applied to all interfaces in a RIPng process.
● The other method is to configure IPSec authentication on RIPng interfaces.
This method is recommended if IPSec authentication needs to be applied only
to some interfaces in a RIPng process.
Procedure
● Configuring IPSec authentication in a RIPng process
a. Run system-view
The system view is displayed.
b. Run ripng [
process-id ]
The RIPng view is displayed.
c. Run ipsec sa
sa-name
IPSec authentication is enabled, and the name of an SA is specified.
By default, IPSec authentication is disabled in a RIPng process.
● Configuring IPSec authentication on a RIPng interface
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 156
d. Run ripng ipsec sa
sa-name
IPSec authentication is enabled on the interface, and the name of an SA
is specified.
By default, IPSec authentication is disabled on a RIPng interface.
NOTE
The ripng ipsec sa command takes precedence over the ipsec sa command. If
both commands are run in respective views and different SA names are specified,
only the configuration of the ripng ipsec sa command takes effect.
----End
4.12.3 Verifying the RIPng IPSec Authentication Configuration
Procedure
● Run the display ipsec proposal [ name
proposal-name ] command to check
IPSec proposal information.
● Run the display ipsec sa [ name
sa-name ] [ brief ] command to check
information about a Security Association (SA).
● Run the display ipsec statistics [ sa-name
sa-name slot
slot-number ]
command to check statistics about packets processed by IPSec.
● Run the display ripng
process-id interface [
interface-type interface-
number ] [ verbose ] command to check the SA used in IPSec authentication.
● Run the display ripng
process-id statistics interface { all |
interface-type
interface-number [ verbose | neighbor
neighbor-ipv6-address ] } command
to check the number of RIPng packets that failed authentication.
----End
4.13 Clearing RIPng
Context
NOTICE
RIPng information cannot be restored after it is cleared. Exercise caution before
clearing RIPng information.
Procedure
● Run the reset ripng
process-id statistics [ interface {
interface-type
interface-number [ neighbor
neighbor-ip-address ] } ] command in the user
view to clear statistics about the counter that is maintained by a specified
RIPng process.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 157
4.14 Example for Configuring RIPng to Filter the
Received Routes
Networking Requirements
In Figure 4-1, the prefix length of all the IPv6 addresses is 64 bits, and the VLANIF
interfaces between neighboring Switches are assigned IPv6 link-local addresses.
All the Switches must learn IPv6 routing information on the network using RIPng.
SwitchB should filter the routes received from SwitchC (at FC00:0:0:3::/64). That is,
SwitchB does not add the routes to its own RIPng routing table or advertise the
routes to SwitchA.
Figure 4-1 Configuring RIPng to filter the received routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable RIPng on each Switch so that the Switches can communicate with
each other.
2. Configure an ACL on SwitchB to filter the received routes.
Procedure
Step 1 Add interfaces to VLANs.
# Configure SwitchA. Ensure that the configurations of SwitchB, and SwitchC are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 158
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/2] quit
[SwitchA] vlan 20
[SwitchA-vlan20] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign IP addresses to the VLANIF interfaces.
# Configure SwitchA. Ensure that the configurations of SwitchB, and SwitchC are
similar to the configuration of SwitchA.
[SwitchA] ipv6
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ipv6 enable
[SwitchA-Vlanif10] ipv6 address fc00:0:0:1::1/64
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ipv6 enable
[SwitchA-Vlanif20] ipv6 address auto link-local
[SwitchA-Vlanif20] quit
Step 3 Configure basic RIPng functions.
# Configure SwitchA.
[SwitchA] ripng 1
[SwitchA-ripng-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ripng 1 enable
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ripng 1 enable
[SwitchA-Vlanif20] quit
# Configure SwitchB.
[SwitchB] ripng 1
[SwitchB-ripng-1] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] ripng 1 enable
[SwitchB-Vlanif20] quit
[SwitchB] interface vlanif 30
[SwitchB-Vlanif30] ripng 1 enable
[SwitchB-Vlanif30] quit
# Configure SwitchC.
[SwitchC] ripng 1
[SwitchC-ripng-1] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] ripng 1 enable
[SwitchC-Vlanif30] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] ripng 1 enable
[SwitchC-Vlanif40] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] ripng 1 enable
[SwitchC-Vlanif50] quit
# Check the RIPng routing table of SwitchB.
[SwitchB] display ripng 1 route
Route Flags: R - RIPng
A - Aging, G - Garbage-collect
----------------------------------------------------------------
Peer FE80::D472:0:3C23:1 on Vlanif20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 159
Dest FC00:0:0:1::/64,
via FE80::D472:0:3C23:1, cost 1, tag 0, RA, 4 Sec
Peer FE80::F54C:0:9FDB:1 on Vlanif30
Dest FC00:0:0:2::/64,
via FE80::F54C:0:9FDB:1, cost 1, tag 0, RA, 3 Sec
Dest FC00:0:0:3::/64,
via FE80::F54C:0:9FDB:1, cost 1, tag 0, RA, 3 Sec
The preceding information shows that the RIPng routing table of SwitchB contains
the route of network segment FC00:0:0:3::/64.
# Check the RIPng routing table of SwitchA.
[SwitchA] display ripng 1 route
Route Flags: R - RIPng
A - Aging, G - Garbage-collect
----------------------------------------------------------------
Peer FE80::476:0:3624:1 on Vlanif20
Dest FC00:0:0:2::/64,
via FE80::476:0:3624:1, cost 2, tag 0, RA, 21 Sec
Dest FC00:0:0:3::/64,
via FE80::476:0:3624:1, cost 2, tag 0, RA, 21 Sec
The preceding information shows that the RIPng routing table of SwitchA contains
the route of network segment FC00:0:0:3::/64 advertised by SwitchB.
Step 4 Configure SwitchB to filter the received routes.
[SwitchB] acl ipv6 number 2000
[SwitchB-acl6-basic-2000] rule deny source fc00:0:0:3:: 64
[SwitchB-acl6-basic-2000] rule permit
[SwitchB-acl6-basic-2000] quit
[SwitchB] ripng 1
[SwitchB-ripng-1] filter-policy 2000 import
[SwitchB-ripng-1] quit
Step 5 Verify the configuration.
NOTE
After the aging time of the filtered routing entry expires, check the verification result. The
default aging time is 180 seconds.
# Check the RIPng routing table of SwitchB. The RIPng routing table should not
contain the route of network segment FC00:0:0:3::/64.
[SwitchB] display ripng 1 route
Route Flags: R - RIPng
A - Aging, G - Garbage-collect
----------------------------------------------------------------
Peer FE80::D472:0:3C23:1 on Vlanif20
Dest FC00:0:0:1::/64,
via FE80::D472:0:3C23:1, cost 1, tag 0, RA, 25 Sec
Peer FE80::F54C:0:9FDB:1 on Vlanif30
Dest FC00:0:0:2::/64,
via FE80::F54C:0:9FDB:1, cost 1, tag 0, RA, 14 Sec
# Check the RIPng routing table of SwitchA. The RIPng routing table should not
contain the route of network segment FC00:0:0:3::/64.
[SwitchA] display ripng 1 route
Route Flags: R - RIPng
A - Aging, G - Garbage-collect
----------------------------------------------------------------
Peer FE80::476:0:3624:1 on Vlanif20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 160
Dest FC00:0:0:2::/64,
via FE80::476:0:3624:1, cost 2, tag 0, RA, 7 Sec
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
vlan batch 10 20
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1::1/64
ripng 1 enable
#
interface Vlanif20
ipv6 enable
ipv6 address auto link-local
ripng 1 enable
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
ripng 1
#
return
● SwitchB configuration file
#
sysname SwitchB
#
ipv6
#
vlan batch 20 30
#
acl ipv6 number 2000
rule 0 deny source FC00:0:0:3::/64
rule 1 permit
#
interface Vlanif20
ipv6 enable
ipv6 address auto link-local
ripng 1 enable
#
interface Vlanif30
ipv6 enable
ipv6 address auto link-local
ripng 1 enable
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
ripng 1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 161
filter-policy 2000 import
#
return
● SwitchC configuration file
#
sysname SwitchC
#
ipv6
#
vlan batch 30 40 50
#
interface Vlanif30
ipv6 enable
ipv6 address auto link-local
ripng 1 enable
#
interface Vlanif40
ipv6 enable
ipv6 address FC00:0:0:2::1/64
ripng 1 enable
#
interface Vlanif50
ipv6 enable
ipv6 address FC00:0:0:3::1/64
ripng 1 enable
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
ripng 1
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 162
5 OSPF Configuration
5.1 Overview of OSPF
5.2 Understanding OSPF
5.3 Application Scenarios for OSPF
5.4 OSPF Deployment Guide
5.5 Summary of OSPF Configuration Tasks
5.6 Licensing Requirements and Limitations for OSPF
5.7 Default Settings for OSPF
5.8 Configuring Basic OSPF Functions
5.9 Configuring Session Parameters for OSPF Neighbor or Adjacency Relationships
5.10 Configuring OSPF Attributes on Different Types of Networks
5.11 Configuring OSPF Stub Areas
5.12 Configuring an OSPF NSSA
5.13 Configuring Local MT
5.14 Adjusting OSPF Route Selection
5.15 Controlling OSPF Routing Information
5.16 Configuring BFD for OSPF
5.17 Configuring OSPF IP FRR
5.18 Configuring OSPF Fast Convergence
5.19 Configuring OSPF GR
5.20 Improving Stability of an OSPF Network
5.21 Improving the Security of an OSPF Network
5.22 Configuring OSPF Neighbor Relationship Flapping Suppression
5.23 Suppressing the Advertisement of Interface IP Addresses
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 163
5.24 Configuring Network Management for OSPF
5.25 Maintaining OSPF
5.26 Configuration Examples for OSPF
5.27 Troubleshooting OSPF
5.1 Overview of OSPF
Definition
The Open Shortest Path First (OSPF) protocol is a link-state Interior Gateway
Protocol (IGP) developed by the Internet Engineering Task Force (IETF).
OSPF constructs network topologies and routing tables by:
● Dividing an Autonomous System (AS) into one or more logical areas
● Advertising routes by sending Link State Advertisements (LSAs)
● Exchanging OSPF packets between devices in an OSPF area to synchronize
routing information
● Encapsulating OSPF packets into IP packets and sending the packets in
unicast or multicast mode
OSPF Version 2, as defined in RFC 2328, is designed for IPv4. OSPF Version 3, as
defined in RFC 2740, is designed for IPv6. Unless otherwise stated, OSPF in this
document refers to OSPF Version 2.
Advantages
Before the introduction of OSPF, the Routing Information Protocol (RIP) was the
most widely used IGP. The rapid growth and expansion of networks have pushed
RIP to its limits. RIP has certain limitations that can cause problems in large
networks. OSPF can address many issues facing RIP. Table 5-1 compares RIP and
OSPF.
Table 5-1 RIP versus OSPF
RIP OSPF
RIP uses a distance-vector algorithm to
calculate routes and uses the hop
count as the metric, without
considering the bandwidth.
OSPF uses a link-state algorithm to
build and calculate the shortest path
to all known destinations. It uses the
link cost as the metric and considers
the bandwidth while calculating
routes.
RIP has a limit of 15 hops, which limits
the RIP network scale.
OSPF does not have the hop limit and
applies to large networks.
RIP updates and selects routes through
route advertisements. Routers do not
know the entire network topology,
which can easily cause routing loops.
Each router knows the entire network
topology and calculates routes using
the shortest path first (SPF) algorithm,
which can prevent routing loops.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 164
RIP OSPF
RIP converges slower than OSPF. Route
updates go through a period of a
hold-down and garbage collection.
This could cause routing
inconsistencies between routers.
OSPF converges faster than RIP
because route updates are propagated
instantaneously to the entire network.
RIP cannot handle variable length
subnet mask (VLSM).
OSPF can handle VLSM, which is
helpful in IP address allocation.
In addition to the preceding advantages, OSPF has the following characteristics:
● Multicast packet transmission, reducing the load on the switches not running
OSPF
● Classless Inter-Domain Routing (CIDR)
● Load balancing among equal-cost routes
● Packet authentication
5.2 Understanding OSPF
5.2.1 OSPF Fundamentals
5.2.1.1 OSPF Characteristics
In an OSPF network, each router generates a link-state advertisement (LSA) based
on its surrounding network topology and transmits this LSA in an update packet
to other routers in the network.
RIP devices exchange routes, whereas OSPF devices exchange link state
information. That is, in RIP, routers select routes based on routing information of
neighbors, without checking whether the information transmitted by neighbors is
correct. In OSPF, routers calculate routes by themselves and select routes based on
LSAs.
Each router learns about the whole network topology based on its link state
database (LSDB). In Figure 5-1, each router collects LSAs sent from other routers,
and all LSAs form the LSDB of this router. An LSA describes the surrounding
network topology of a router, whereas an LSDB describes the network topology of
the entire AS. A router transforms its LSDB into a weighted and directed graph,
which reflects the topology of the entire AS. When the network topology is stable,
all routers in the same area have the same graph.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 165
Figure 5-1 Obtaining the whole network topology through an LSDB
A router calculates shortest paths to destinations using a shortest path first (SPF)
algorithm instead of obtaining routing information through route advertisements.
In Figure 5-2, based on the weighted and directed graph, each router uses an SPF
algorithm to calculate a shortest path tree (SPT) with itself as the root. The SPT
shows routes to nodes in the AS. This mechanism greatly improves routers'
capabilities in independent route selection and frees routers from selecting routes
based on route advertisements.
Figure 5-2 Calculating shortest paths to destinations using an SPF algorithm
An LSDB ensures that a router can learn about the whole network topology, and
an SPF algorithm ensures that a router can quickly calculate shortest paths to
destinations.
5.2.1.2 OSPF Mechanism
The OSPF mechanism includes the following steps:
1. Exchanging Hello packets to establish OSPF neighbor relationships
In Figure 5-3, after OSPF is run on the four routers, these routers send Hello
packets on all OSPF-enabled interfaces. If two routers share a data link and
successfully negotiate certain parameters specified in their Hello packets, they
establish an OSPF neighbor relationship.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 166
Figure 5-3 Exchanging Hello packets to establish OSPF neighbor relationships
2. Flooding LSAs to advertise link state information
Routers that have established an OSPF neighbor relationship can exchange
LSAs to form an OSPF adjacency, as shown in Figure 5-4. Each router
generates LSAs based on its surrounding network topology. LSAs describe
information about a router, including all links, interfaces, neighbors, and link
state of the router. Routers exchange the link information to learn about the
entire network topology. Because of the link diversity, OSPF defines multiple
LSA types. For details, see 5.2.1.9 OSPF LSA Types.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 167
Figure 5-4 Flooding LSAs to advertise link state information
3. Forming an LSDB to create a weighted and directed graph
A router floods LSAs and records received LSAs in its LSDB. Subsequently, all
routers have the same LSDB, as shown in Figure 5-5. An LSA describes the
surrounding network topology of a router, whereas an LSDB describes the
network topology of the entire AS and is the summary of LSAs.
Figure 5-5 Forming an LSDB to create a weighted and directed graph
4. Using an SPF algorithm to calculate and generate routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 168
In Figure 5-6, after LSDB synchronization is complete, each router uses an
SPF algorithm to calculate a loop-free topology with itself as the root and
describe the shortest path (with the minimum path cost) to each destination.
The topology is the SPT, which shows the optimal paths to nodes in an AS.
Figure 5-6 Using an SPF algorithm to calculate and generate routes
5. Maintaining and updating routing tables
After each router uses an SPF algorithm to calculate the SPT, it installs the
shortest paths in its routing table. These paths are installed as routing entries
to guide data forwarding. The routers then update their routing tables in real
time, as shown in Figure 5-7. Meanwhile, neighbors exchange Hello packets
to maintain their neighbor relationships or adjacencies and periodically
retransmit LSAs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 169
Figure 5-7 Maintaining and updating routing tables
5.2.1.3 OSPF Packet Types
OSPF uses five packet types:
● Hello packet
OSPF uses Hello packets to implement the following functions:
– Neighbor discovery: OSPF routers periodically send Hello packets on
every OSPF-enabled interface, and negotiate the specific parameters in
the Hello packets with other routers that receive Hello packets to
determine whether to establish an OSPF neighbor relationship.
– Bidirectional communications: If a router sees its own router ID in the
neighbor list of a received Hello packet, bidirectional communication has
been established between this receiving router and the router that
originates the packet. An OSPF neighbor relationship has been
established between the two routers.
– Designated router (DR) and backup designated router (BDR) election:
Hello packets contain information about the DR priority and router ID.
Each router writes its selected DR and BDR to the DR and BDR fields of
Hello packets for DR and BDR election. For details, see 5.2.1.5 DR/BDR
Election.
– Keepalives: After an OSPF neighbor relationship is established, OSPF-
enabled interfaces still periodically send Hello packets to maintain the
neighbor relationship. If an interface does not receive a Hello packet from
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 170
a neighbor within a certain period, it terminates the neighbor relationship
with this neighbor.
● Database Description (DD) packet
During adjacency initialization, two routers send DD packets to negotiate
their master/slave relationship. In this phase, the DD packets contain only an
LSA header. When two routers exchange DD packets, one functions as the
master and the other functions as the slave. The master defines a start
sequence number and increments the sequence number by 1 each time it
sends a DD packet. After the slave receives a DD packet, it uses the sequence
number carried in the DD packet for acknowledgement.
After an adjacency is established, routers use DD packets to describe their
own LSDBs for LSDB synchronization. A DD packet contains the header of
each LSA in an LSDB and is the summary of all LSAs. An LSA header uniquely
identifies an LSA. The LSA header occupies only a small portion of the LSA,
which reduces the amount of traffic transmitted between routers. A neighbor
can use the LSA header to check whether it already has the LSA.
● Link State Request (LSR) packet
After two routers have exchanged DD packets, they send LSR packets to
request each other's LSAs. The LSR packets contain the summaries of the
requested LSAs.
● Link State Update (LSU) packet
A router uses an LSU packet to transmit LSAs requested by its neighbors or to
flood its own updated LSAs. The LSU packet contains a set of LSAs. To ensure
reliable LSA flooding, the router uses an LSAck packet to acknowledge the
LSAs contained in an LSU packet that it received from a neighbor. If an LSA
fails to be acknowledged, the router directly retransmits the LSA to the
neighbor.
● Link State Acknowledgement (LSAck) packet
A router uses an LSAck packet to acknowledge the LSAs contained in a
received LSU packet. The LSAs can be acknowledged using LSA headers.
5.2.1.4 OSPF Network Types
OSPF classifies networks into four types, depending on the link layer protocols:
● Broadcast
OSPF defaults networks using Ethernet or Fiber Distributed Data Interface
(FDDI) at the link layer to broadcast networks.
On broadcast networks:
– Hello packets, LSU packets, and LSAck packets are sent in multicast
mode. The address 224.0.0.5 is the IP multicast address reserved for OSPF
DR others. The address 224.0.0.6 is the IP multicast address reserved for
OSPF DRs or BDRs.
– DD and LSR packets are sent in unicast mode.
● Non-Broadcast Multi-Access (NBMA)
OSPF defaults networks using frame relay (FR) or X.25 at the link layer to
NBMA networks.
On NBMA networks, protocol packets such as Hello packets, DD packets, LSR
packets, LSU packets, and LSAck packets are all sent in unicast mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 171
● Point-to-Multipoint (P2MP)
OSPF does not default a network to a P2MP network regardless of the link
layer protocol used by the network. A P2MP network must be changed from
another network type. It is a typical practice to change partial-meshed NBMA
networks to P2MP networks.
On P2MP networks:
– Hello packets are transmitted in multicast mode using the multicast
address 224.0.0.5.
– DD packets, LSR packets, LSU packets, and LSAck packets are sent in
unicast mode.
● Point-to-Point (P2P)
OSPF defaults networks using Point-to-Point Protocol (PPP), High-Level Data
Link Control (HDLC), or Link Access Procedure Balanced (LAPB) at the link
layer to P2P networks.
On P2P networks, protocol packets such as Hello packets, DD packets, LSR
packets, LSU packets, and LSAck packets are all sent in multicast mode using
the multicast address 224.0.0.5.
5.2.1.5 DR/BDR Election
Router ID
During DR/BDR election, if two routers use the same DR priority, they need to
compare their router IDs, and the router with a larger router ID will become the
DR or BDR.
A router ID is a 32-bit integer used to uniquely identify an OSPF router in an AS.
Each OSPF router has a router ID, which is in the same format as an IP address.
An OSPF router ID can be manually configured or automatically selected. To
ensure OSPF stability, you are advised to manually configure the IP address of a
loopback interface as the router ID.
If no OSPF router ID is manually configured for a router, the router selects the
global router ID as its OSPF router ID. If both the OSPF router ID and global router
ID are not configured, the router selects a router ID based on specified rules. For
details, see 1.2.13 Router ID.
In any of the following situations, the router ID is re-selected:
● The ospf router-id
router-id command is run to reconfigure the OSPF router
ID, and the OSPF process is restarted.
● The global router ID is reconfigured, and the OSPF process is restarted.
● The IP address used as the original global router ID is deleted, and the OSPF
process is restarted.
Reason for DR/BDR Election
On broadcast and NBMA networks, any two routers need to exchange routing
information. As shown in Figure 5-8, there are
n routers that need to establish
n x
(
n - 1)/2 adjacencies. A route change on any router is transmitted to the other
routers, which consumes bandwidth resources.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 172
To solve this problem, the concept of DR is defined in OSPF. After a DR is elected,
all the other routers send routing information only to the DR, and the DR
broadcasts LSAs.
To prevent service interruption caused by DR re-election if the DR fails, a BDR is
also elected during DR election. The routers, excluding the DR and BDR, are called
DR others. The DR others do not establish adjacencies or exchange any routing
information with each other. This reduces the number of adjacencies established
between routers on broadcast and NBMA networks.
Figure 5-8 DR/BDR election
DR/BDR Election Principles
To ensure stable DR/BDR election on broadcast and NBMA networks, OSPF defines
three election principles: election, non-preemption, and inheritance.
Election Principle
The DR and BDR are not designated manually, but are elected by all routers on
the local network segment. In Figure 5-9, DR priorities of router interfaces
determine whether the interfaces are qualified for DR/BDR election. Routers with
DR priorities greater than 0 on the local network segment can be considered as
candidates. The ballots in this election are performed using Hello packets. Each
router adds elected DR information to a Hello packet and sends the packet to
other routers on the network segment. When two routers on the same network
segment declare that they are the DR, the router with a higher DR priority is
elected as the DR. If the two routers have the same DR priority, the router with
the greater router ID is elected as the DR. The router whose DR priority is 0
cannot be elected as the DR or BDR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 173
Figure 5-9 Election principle
Non-preemption Principle
A router newly added to a network segment does not initiate a new election.
Instead, it checks whether a DR exists on the network segment. In Figure 5-10, a
DR exists on the network segment. Even if the DR priority of the newly added
router is higher than that of the existing DR, the newly added router does not
declare itself the DR, and acknowledges the existing DR. Routers on a network
segment establish adjacencies only with the DR and BDR. If the DR changes
frequently, all routers on the network segment need to establish adjacencies with
the new DR and BDR accordingly. As a result, a large number of OSPF packets are
transmitted on the network segment within a short period of time, consuming
bandwidth resources. The non-preemption principle improves network stability
and conserves bandwidth resources. On a broadcast or NBMA network, the two
routers that are qualified for DR election and start first become the DR and BDR
respectively.
Figure 5-10 Non-preemption principle
Inheritance Principle
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 174
If the DR on a network segment fails, the BDR is elected as the DR, and the other
routers compete to become the new BDR, as shown in Figure 5-11. This principle
prevents frequent DR elections and enables the BDR to become the new DR when
the DR fails, ensuring the DR stability. Because LSDBs of the DR and BDR are fully
synchronized, the BDR can immediately become the new DR when the DR fails,
providing the DR functions. The time consumed from role change to service
switching is short because adjacencies have been established. Meanwhile, a new
BDR will be elected after the original BDR becomes the DR. The new BDR election
process consumes a relatively long time, but route calculation is not affected.
Figure 5-11 Inheritance principle
DR/BDR Election Process
The DR/BDR election process on a broadcast or NBMA network is as follows:
1. After an interface goes Up, it sends a Hello packet and enters the Waiting
state. In Waiting state, a wait timer is triggered. The wait timer value is the
same as the dead timer value. The default wait timer value is 40 seconds and
cannot be changed. For details about OSPF interface status, see OSPF
Interface State Machine.
2. Before the wait timer is triggered, sent Hello packets do not contain DR or
BDR information. In Waiting state, if a received Hello packet contains DR and
BDR information, the interface directly acknowledges the DR and BDR on the
network, and does not trigger election. The interface directly exits the Waiting
state and starts neighbor synchronization.
3. Assume that a DR and a BDR exist on the network. A router newly connected
to the network acknowledges the existing DR and BDR regardless of its router
ID or DR priority.
4. If the DR fails and goes Down, the BDR takes over the role of the DR. The
other routers with DR priorities greater than 0 then compete to become the
new BDR.
5. DR election rules are used to elect a DR only when routers with different
router IDs or DR priorities are started at the same time. The election rules
state that the device with the highest DR priority is elected as the DR and the
device with the second highest DR priority as the BDR. A router with a DR
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 175
priority of 0 can only be a DR other. If routers have the same DR priority, the
router with the largest router ID is elected as the DR, the router with the
second largest router ID becomes the BDR, and other routers are DR others.
Verifying the DR/BDR Election Process
In Figure 5-12, five routers establish a broadcast network. R5 works as a Layer 2
device, and R1 to R4 work as routers. R1 to R4 are in OSPF area 0.
Figure 5-12 DR/BDR election networking
DR and BDR Are Properly Elected on the Network
Assume that interfaces on R1 to R4 have been configured. Only OSPF
configurations are provided here.
● R1 configuration
#
ospf 1 Router ID 10.1.1.1
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
● R2 configuration
#
ospf 1 Router ID 10.2.2.2
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
● R3 configuration
#
ospf 1 Router ID 10.3.3.3
area 0.0.0.0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 176
network 192.168.1.0 0.0.0.255
#
● R4 configuration
#
ospf 1 Router ID 10.4.4.4
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
After the configurations are complete and the network is stable, check the
DR/BDR election status.
# Check OSPF neighbor information on R1. The following command output shows
that DR/BDR election has been completed. R1 is the DR, R2 is the BDR, and R3
and R4 are DR others. R1 and R2 are elected as the DR and BDR respectively
because of their startup sequence. In this example, R1, R2, R3, and R4 are started
consecutively. Therefore, R1 and R2 complete initialization first and become the
DR and BDR, respectively.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:22:16
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:21:30
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:20:24
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that the neighbor relationships between R1 and the other
three routers and those between R2 and the other three routers are in Full state,
and the neighbor relationship between R3 and R4 is in 2-Way state. The states
indicate that the DR and BDR establish adjacencies with other routers, and DR
others only establish neighbor relationships with each other. For details about
OSPF neighbor status, see OSPF Neighbor State Machine.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 177
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
BDR Cannot Be Elected on the Network
If the ospf dr-priority command is run on GE0/0/1 of R2, R3, and R4 to set the
interface DR priority to 0, the three routers are unqualified for DR/BDR election
and can only work as DR others. Only one router (R1) on the network is qualified
for DR/BDR election.
# Check OSPF neighbor information on R1. The following command output shows
that R1 is the DR. The BDR field is displayed as None, indicating that no BDR
exists on the network.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:04:31
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:03:45
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 178
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:03:36
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that R2, R3, and R4 each establish an adjacency with R1,
the corresponding states are Full, and the states of neighbor relationships among
R2, R3, and R4 are 2-Way.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
In conclusion, if only one router on a broadcast or NBMA network is qualified for
DR/BDR election, the router becomes the DR, no BDR exists on the network, and
all the other routers establish adjacencies only with the DR.
No DR or BDR Can Be Elected on the Network
On the basis of the preceding configuration, if the ospf dr-priority command is
executed on GE0/0/1 of R1 to set the interface DR priority to 0, R1 is also
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 179
unqualified for DR/BDR election. No router on the network is qualified for DR/BDR
election.
# Check OSPF neighbor information on R1. The following command output shows
that both the DR and BDR fields are displayed as None, indicating that no DR or
BDR exists on the network.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that all neighbor relationships are in 2-Way state, no
adjacency can be established on the network, and routers cannot exchange
routing information.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 180
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
In conclusion, if no router on a broadcast or NBMA network is qualified for
DR/BDR election, the network has no DR or BDR, and routers on the network do
not establish adjacencies. In this case, all neighbor relationships among these
routers are in 2-Way state.
5.2.1.6 OSPF State Machine
OSPF Interface State Machine
An OSPF device obtains link information from an interface and then establishes
adjacencies with neighbors to exchange the link information. Before establishing
adjacencies, these devices need to determine their roles to establish connections.
The State field in OSPF interface information (displayed using the display ospf
interface command) indicates the function of an OSPF device on a link.
The OSPF interface state machine has the following states:
● Down: This state is the initial state of an OSPF interface. If an OSPF interface
is Down, it is unavailable and cannot receive or transmit traffic.
● Loopback: An OSPF interface that connects a device to a network is in
Loopback state. A loopback interface cannot transmit data but its IP address
can be advertised using Router-LSAs. Therefore, other devices can learn about
paths to this IP address during a connectivity test.
● Waiting: The device is determining the DR and BDR on the network. Before
the device participates in DR and BDR election, the wait timer starts on an
OSPF interface. Before this timer expires, the Hello packets sent by this device
do not contain DR and BDR information, and the device cannot be elected as
the DR or BDR. This prevents the existing DR and BDR on the link from being
changed unnecessarily and ensures stability. This state exists only on NBMA
and broadcast networks.
● P-2-P: An OSPF interface is connected to a P2P network or virtual link. In this
situation, the device establishes an adjacency with the device on the other
end of the link. This state exists only on P2MP networks.
● DROther: The device is not elected as the DR or BDR. This device will
establish an adjacency with the DR and BDR.
● BDR: The device functions as the BDR on the network and will become the
new DR if the existing DR fails. This device establishes adjacencies with all the
other devices on the network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 181
● DR: The device functions as the DR on the network. This device establishes
adjacencies with all the other devices on the network.
OSPF interfaces alternate among the preceding states based on the InputEvents
(IEs), forming an efficient interface state machine, as shown in Figure 5-13.
Figure 5-13 OSPF interface state machine
Table 5-2 lists the IEs triggering interface state switchovers.
Table 5-2 InputEvents triggering OSPF interface state switchovers
InputEvent Description
IE1 InterfaceUP: Lower-layer protocols indicate that an OSPF interface
is available.
IE2 WaitTimer: The wait timer expires, indicating that the DR/BDR
election waiting time ends.
IE3 BackupSeen: The device with an OSPF interface has detected
whether there is a BDR on the network. This event occurs in either
of the following situations:
● The OSPF interface receives a Hello packet from a neighbor,
and the neighbor declares itself the BDR.
● The OSPF interface receives a Hello packet from a neighbor,
and the neighbor declares itself the DR but no BDR is specified.
Both situations indicate that neighbors have communicated with
each other and the Waiting state ends.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 182
InputEvent Description
IE4 The device is elected as the DR on the network.
IE5 The device is elected as the BDR on the network.
IE6 The device is not elected as the DR or BDR on the network.
IE7 NeighborChange: An interface-related neighbor relationship
change event occurs, indicating that the DR and BDR need to be
elected again. The following neighbor relationship changes may
result in DR/BDR re-election:
● The device implements bidirectional communication with a
neighbor.
● Bidirectional communication between the device and a
neighbor is interrupted.
● The device detects that the neighbor declares itself the DR or
BDR based on the Hello packet received by the neighbor.
● The device detects that the neighbor declares itself not the DR
or BDR based on the Hello packet sent by the neighbor.
● The device detects that the DR priorities of all neighbors have
changed based on the Hello packets sent by the neighbors.
IE8 UnLoopInd: The NMS or lower-layer protocols indicate that the
interface is not in Loopback state any longer.
IE9 InterfaceDown: Lower-layer protocols indicate that the interface is
unavailable. Any state may change to the Down state after this
event is triggered.
IE10 LoopInd: The NMS or lower-layer protocols indicate that the
interface is in Loopback state. Any state may change to the
Loopback state after this event is triggered.
OSPF Neighbor State Machine
On an OSPF network, neighbors establish adjacencies through neighbor state
switchovers, and then exchange LSAs.
The State field in OSPF neighbor information (displayed using the display ospf
peer command) indicates the neighbor status of an OSPF device.
The OSPF neighbor state machine has the following states:
● Down: This is the initial state of a neighbor session. This state occurs when a
device does not receive any Hello packets from its neighbors within a dead
interval. Only OSPF routers on an NBMA network send Hello packets to
neighbors at each poll interval, including the neighbors in Down state.
● Attempt: This state is only used on NBMA networks where neighbors are
manually configured. When the neighbor relationship is in Attempt state, an
OSPF router sends a Hello packet to its manually configured neighbors at
each Hello interval, attempting to establish neighbor relationships.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 183
● Init: This state occurs after the router has received a Hello packet from its
neighbor but has not established a two-way session. In Init state, the
neighbor does not receive any Hello packet from this router, and the neighbor
list in the received Hello packet does not contain the router ID of the local
router.
● 2-Way: This state occurs when a router and its neighbor receive Hello packets
containing their own router IDs from each other and establish an OSPF
neighbor relationship. If no adjacency needs to be established, the two
neighbors remain in 2-Way state. If an adjacency needs to be established, the
neighbor enters the Exstart state. The DR and BDR are elected only when the
neighbor state is 2-Way or higher.
● ExStart: This state occurs when two neighbors start to negotiate their master/
slave roles and determine the sequence numbers of DD packets. Entering the
Exstart state is the first step in setting up an adjacency.
● Exchange: This state occurs when two neighbors exchange DD packets. In this
state, DD packets contain LSDB information.
● Loading: This state occurs when two neighbors are synchronizing their LSDBs.
The two devices send LSR packets to request LSAs from each other to
synchronize their LSDBs.
● Full: This state occurs when two neighbors complete their LSDB
synchronization and establish an adjacency.
Figure 5-14 shows an OSPF neighbor state machine.
Figure 5-14 OSPF neighbor state machine
Table 5-3 lists the IEs triggering neighbor state switchovers.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 184
Table 5-3 InputEvents triggering OSPF neighbor state switchovers
InputEvent Description
IE1 Start: A router sends a Hello packet to its neighbors at each Hello
interval, attempting to establish neighbor relationships. This event
exists only on NBMA networks.
IE2 HelloReceived: The router receives a Hello packet from a neighbor.
IE3 2-WayReceived: The router receives a Hello packet containing its
router ID from a neighbor and implements two-way
communication with this neighbor. The router then determines its
neighbor state:
● IE3(Y): If the router needs to establish an adjacency with the
neighbor, it changes its neighbor state to Exstart.
● IE3(N): If the router does not need to establish an adjacency
with the neighbor, it changes its neighbor state to 2-Way.
IE4 NegotiationDone: The two neighbors have negotiated their
master/slave roles and exchanged sequence numbers of DD
packets.
IE5 ExchangeDone: The two neighbors have exchanged their DD
packets. One of the two routers then determines its neighbor
state:
● IE5(Y): If the link state request list is empty, the router changes
its neighbor state to Full, indicating that all link state data has
been exchanged and an adjacency has been established.
● IE5(N): If the link state request list is not empty, the router
changes its neighbor state to Loading and begins or continues
sending LSR packets to its neighbor, requesting link state data
that the local router does not have.
IE6 LoadingDone: The link state request list is empty.
5.2.1.7 OSPF Adjacency Establishment
OSPF Neighbor Relationship
OSPF routers periodically send Hello packets on every OSPF-enabled interface, and
negotiate the specific parameters, including the area ID, authentication method,
Hello packet interval, and dead interval, in the Hello packets with other routers
that receive Hello packets. If the negotiation succeeds, the receiving router adds
the router ID of the originating router to the neighbor list of the returned Hello
packet. The two routers then establish bidirectional communication and an OSPF
neighbor relationship. If a router does not receive a Hello packet from its neighbor
within the dead interval, the router terminates the neighbor relationship with this
neighbor.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 185
OSPF Adjacency
After establishing an OSPF neighbor relationship, two neighbors need to exchange
DD packets and LSAs to establish an adjacency.
Not all neighbors establish adjacencies. Whether neighbors establish adjacencies
depends on the network type and DR/BDR establishment. On P2P and P2MP links,
all devices need to exchange LSAs and establish only adjacencies. On broadcast
and NBMA links, DR others do not need to exchange LSAs and establish only
neighbor relationships. LSAs need to be exchanged between the DR and BDR, and
between the DR, BDR, and DR others, so they establish adjacencies with each
other. In Figure 5-15, two DR others each have established three neighbor
relationships and two adjacencies.
Figure 5-15 OSPF neighbor relationship and adjacency
A neighbor relationship indicates that two neighbors reach the 2-Way state,
whereas an adjacency indicates that two neighbors reach the Exstart state or
higher.
OSPF Adjacency Establishment
The process of establishing an OSPF adjacency varies depending on the network
type.
Broadcast Network
On a broadcast network, the DR and BDR establish an adjacency with each router
on the same network segment, but DR others establish only neighbor
relationships with each other. Figure 5-16 shows the process of establishing an
OSPF adjacency.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 186
Figure 5-16 Process of establishing an OSPF adjacency on a broadcast network
1. Neighbor relationship establishment
a. RouterA uses the multicast address 224.0.0.5 to send a Hello packet
through the OSPF interface connected to a broadcast network. The
packet carries the DR field of 1.1.1.1 (ID of RouterA) and the Neighbors
Seen field of 0, indicating that a neighbor RouterB has not been
discovered and RouterA regards itself as the DR.
b. After RouterB receives the packet, it returns a Hello packet to RouterA.
The returned packet carries the DR field of 2.2.2.2 (ID of Router B) and
the Neighbors Seen field of 1.1.1.1 (RouterA's router ID). RouterA has
been discovered but its router ID is less than that of RouterB, and
therefore RouterB regards itself as the DR. Then RouterB's neighbor state
changes to Init.
c. After RouterA receives the response, RouterA's neighbor state changes to
2-Way. Then, RouterA and RouterB start to send their LSDB information
to each other, which does not occur between DR others on a broadcast
network.
2. Master/Slave negotiation and DD packet exchange
a. RouterA sends a DD packet to RouterB. The packet carries the following
fields:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 187
▪ Seq: The value X indicates the sequence number of X.
▪ I: The value 1 indicates that the packet is the first DD packet, which
is used to negotiate the master/slave roles and does not carry LSA
summaries.
▪ M: The value 1 indicates that the packet is not the last DD packet.
▪ MS: The value 1 indicates that RouterA declares itself the master.
To improve transmission efficiency, RouterA and RouterB determine which
LSAs in each other's LSDB need to be updated before sending LSR
packets. If one party detects that an LSA of the other party is already in
its own LSDB, it does not send an LSR packet for updating the LSA to its
own LSDB. To achieve the preceding purpose, RouterA and RouterB first
send DD packets, which carry summaries of LSAs in their own LSDBs.
Each summary identifies an LSA. To ensure reliable packet transmission,
the master/slave roles must be determined through DD packet exchange.
The party serving as the master uses the Seq field to define a sequence
number. The master increases the sequence number by 1 each time it
sends a new DD packet. When the other party serving as the slave sends
a DD packet, it sets the Seq field of the packet to the sequence number
carried in the last DD packet received from the master.
b. After RouterB receives the DD packet, RouterB's state changes to Exstart
and RouterB returns a DD packet to RouterA. The returned packet does
not carry LSA summaries. Because RouterB has a larger router ID than
RouterA, RouterB declares itself the master and sets the Seq field to Y.
c. After RouterA receives the DD packet, it agrees that RouterB is the
master and RouterA's state changes to Exchange. Then, RouterA sends a
DD packet to RouterB to transmit LSA summaries. The packet carries the
Seq field of Y and the MS field of 0 indicating that RouterA declares itself
the slave.
d. After RouterB receives the packet, RouterB's state changes to Exchange
and RouterB sends a new DD packet containing its own LSA summaries
to RouterA. The value of the Seq field carried in the new DD packet is
changed to Y+1. RouterA uses the same sequence number as RouterB to
acknowledge that it has received DD packets from RouterB. RouterB uses
the sequence number from RouterA plus 1 to acknowledge that it has
received DD packets from RouterA. When RouterB sends the last DD
packet, it sets the M field in the packet to 0.
3. LSDB synchronization (LSA request, LSA transmission, and LSA response)
a. After RouterA receives the last DD packet, it finds that many LSAs in
RouterB's LSDB do not exist in its own LSDB. Therefore, RouterA's
neighbor state changes to Loading. After RouterB receives the last DD
packet from RouterA, RouterB's neighbor state directly changes to Full
because RouterB's LSDB already contains all LSAs of RouterA.
b. RouterA sends an LSR packet for updating LSAs from RouterB to its own
LSDB. RouterB sends an LSU to After RouterA.
The preceding procedure ends when the LSAs in RouterA's LSDB are the same
as those in RouterB's LSDB. RouterA's neighbor state then changes to Full.
After RouterA and RouterB exchange DD packets and update all LSAs, an
adjacency is established between them.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 188
NBMA Network
On an NBMA network, all routers establish adjacencies only with the DR and BDR.
Figure 5-17 shows the process of establishing an OSPF adjacency.
Figure 5-17 Process of establishing an OSPF adjacency on an NBMA network
1. Neighbor relationship establishment
a. After RouterB sends a Hello packet to a Down interface of RouterA,
RouterB's neighbor state changes to Attempt. The packet carries the DR
field of 2.2.2.2 (ID of RouterB) and the Neighbors Seen field of 0. A
neighbor RouterA has not been discovered, and RouterB regards itself as
the DR.
b. After RouterA receives the packet, RouterA's state changes to Init and
RouterA returns a Hello packet. The returned packet carries the DR and
Neighbors Seen fields of 2.2.2.2. RouterB has been discovered but its
router ID is greater than that of RouterA, and therefore RouterA agrees
that RouterB is the DR. Then, RouterA and RouterB start to exchange DD
packets and LSDB information with each other, which does not occur
between DR others on a broadcast network.
2. The processes of negotiating master/slave roles and exchanging DD packets
on an NBMA network are the same as those on a broadcast network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 189
3. The process of synchronizing LSDBs (LSA request, LSA transmission, and LSA
response) on an NBMA network is the same as that on a broadcast network.
P2P Network and P2MP Network
The process for establishing an adjacency on a P2P/P2MP network is similar to
that on a broadcast network except that no DR or BDR needs to be elected on a
P2P/P2MP network. DD packets are transmitted in multicast mode on P2P
networks and in unicast mode on P2MP networks.
5.2.1.8 OSPF Areas
When networks expand and all routers in a large network are running OSPF, the
following problems may occur:
● Network expansion increases the possibility of network topology changes,
leading to more frequent LSA flooding and reducing network bandwidth
efficiency.
● LSDBs of routers become large, requiring a large amount of storage space
and complicating SPF calculations.
● Routers need to maintain large routing tables.
OSPF resolves these problems by partitioning an AS into different areas. Area
partitioning contains LSA flooding within an area, improving network efficiency
and route convergence. The number of routers in each area becomes less,
reducing the size of routing tables and LSDBs maintained by routers and limiting
SPF calculations to LSAs within the area. Design of multiple areas also improves
network scalability and facilitates the setup of large networks.
An area is regarded as a logical group of routers and is identified by an area ID. A
router, not a link, resides on the border of an area. Each OSPF interface must
belong to an area, meaning that a link (or network segment) belongs to only one
area.
Before understanding OSPF areas, you need to get to know two concepts: router
type and route type.
Router Types
Figure 5-18 shows common router types involved in OSPF.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 190
Figure 5-18 Router types
Table 5-4 Router types
Router Type Description
Internal router A router that has all of its interfaces within the
same OSPF area.
Area Border Router (ABR) A router that has interfaces in two or more areas,
one of which must be a backbone area.
ABRs connect backbone and non-backbone areas
and can be physically or logically connected to a
backbone area.
Backbone router A router that has one or more interfaces within a
backbone area.
Internal routers in Area 0 and all ABRs are
backbone routers.
Autonomous System
Boundary Router (ASBR)
A router that exchanges routing information with
other ASs.
An ASBR is not required to reside on the border of
an AS. It may be an internal router or an ABR. An
OSPF device that imports external routing
information becomes an ASBR.
Route Types
Inter-area and intra-area routes in an AS describe the internal network structure
of the AS. AS external routes describe routes to destinations outside the AS. OSPF
classifies imported AS external routes into Type 1 and Type 2.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 191
Table 5-5 lists route types in descending order of priority.
Table 5-5 Route types
Route Type Description
Intra-area route Routes that are generated from within an area (the
destination belongs to the area).
Inter-area route Routes that originate from other areas.
External route Routes that are imported into OSPF from other
routing protocols or different OSPF processes.
External routes fall into two categories: Type 1 and
Type 2 external routes. The difference between the
two types is the way the cost of a route is
calculated.
● Type 1 external route: The cost of a Type 1
external route is the addition of the external cost
(from the local device to an ASBR) and the
internal cost (from the ASBR to the destination)
used to reach that route.
● Type 2 external route: The cost of a Type 2
external route is always the external cost (from
an ASBR to the destination), irrespective of the
internal cost to reach that route.
A Type 1 external route is always preferred over a
Type 2 external route for the same destination.
Area Types
OSPF areas include common areas, stub areas, and not-so-stubby areas (NSSAs),
as shown in Table 5-6.
Table 5-6 Area types
Area
Type
Function Description
Common
area
By default, OSPF areas are common areas
that include:
● Standard area: transmits intra-area,
inter-area, and external routes.
● Backbone area: connects to all other
OSPF areas and transmits inter-area
routes. The backbone area is
represented by area 0. Routes between
non-backbone areas must be
forwarded through the backbone area.
● The backbone area
must have all its
devices connected.
● All non-backbone
areas must have
themselves
connected to the
backbone area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 192
Area
Type
Function Description
Stub area A stub area is a special area where an ABR
does not flood received AS external routes.
In a stub area, routers maintain fewer
routing entries and transmit less routing
information. Configuring a stub area is
optional and not every area can be
configured as such. A stub area is usually
a non-backbone area containing only one
ABR, located on the AS border. A stub area
is a non-backbone area containing only
one ABR and generally resides on the
border of an AS. The ABR in a stub area
does not transmit received AS external
routes, which significantly decreases the
routing table size on the ABR and the
amount of routing information
transmitted. To ensure the reachability of
AS external routes, the ABR generates a
default route and advertises the route to
non-ABRs in the stub area.
A totally stub area allows only intra-area
routes and ABR-advertised Type 3 LSAs
carrying a default route to be advertised
within the area.
● A backbone area
cannot be
configured as a stub
area.
● Stub area attributes
need to be
configured on all
the routers in the
area that needs to
be configured as a
stub area.
● An ASBR cannot
exist in a stub area.
Therefore, AS
external routes
cannot be
advertised within a
stub area.
● A virtual link cannot
pass through a stub
area.
NSSA An NSSA is similar to a stub area. An
NSSA does not advertise Type 5 LSAs, but
can import AS external routes. ASBRs in
an NSSA generate Type 7 LSAs to carry
the information about the AS external
routes. The Type 7 LSAs are advertised
only within the NSSA. When the Type 7
LSAs reach an ABR in the NSSA, the ABR
translates the Type 7 LSAs into Type 5
LSAs and floods them to the entire AS.
A totally NSSA allows only intra-area
routes to be advertised within the area.
● A backbone area
cannot be
configured as an
NSSA.
● NSSA attributes
need to be
configured on all
the routers in the
area that needs to
be configured as an
NSSA.
● An ABR in an NSSA
advertises default
routes in Type 7
LSAs within the
NSSA.
● All inter-area routes
are advertised by
ABRs.
● A virtual link cannot
pass through an
NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 193
After an OSPF network is partitioned into multiple areas, only LSAs within an area
are used in SPF calculations of this area. For example, in Figure 5-19, the link in
Area 1 is always flapping, and therefore SPF calculations are frequently performed
in Area 1. However, frequent SPF calculations occur only in Area 1 without
affecting other areas, improving network stability.
Figure 5-19 Area partitioning reducing the impact of link flapping
Stub area and totally stub area
In Figure 5-20, an AS is partitioned into Area 0 and Area 2, and external routes
are imported by the ASBR in Area 0. Typically, all routes on the network are
advertised into OSPF to ensure network reachability. In this situation, network
expansion will increase the number of devices and routing entries on each device
and require a large amount of CPU and memory resources to maintain these
entries. In some edge areas, low-performance devices may be deployed, and
therefore maintaining a large number of routing entries brings heavy load on
these devices.
Figure 5-20 Stub area and totally stub area
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 194
To optimize network performance, you often need to minimize the routing table
size to reduce the number of LSAs to be flooded without compromising network
reachability. If Area 2 is a common area, five types of LSAs, Type 1, Type 2, Type 3,
Type 4, and Type 5, may exist in this area. Traffic from routers in Area 2 must first
reach the ABR, regardless of the traffic destination outside Area 2. Therefore, non-
ABR routers in Area 2 do not need to know detailed information about external
networks. To meet this requirement, Area 2 is designed as a stub area.
Routers in Area 2 do not need to know inter-area specific routes and only one
egress is required to transmit traffic of these routers outside Area 2. To meet this
requirement, a totally stub area is designed. In a totally stub area, AS external
routes and inter-area routes cannot be advertised, reducing the number of LSAs
transmitted within this area.
NSSA and totally NSSA
In Figure 5-21, Area 2 is a stub area. An external network needs to connect to the
OSPF network through Area 2. That is, AS external routes need to be imported to
and advertised within the entire AS. One method is to enable RouterA in Area 2 to
import AS external routes into the AS. RouterA then becomes an ASBR, indicating
that Area 2 is no longer a stub area. To meet this requirement, an NSSA is
designed.
Figure 5-21 NSSA and totally NSSA
An NSSA differs from a stub area in that an NSSA allows importing AS external
routes into and advertising them within the entire AS without transmitting routes
learned from other areas in the AS.
To ensure the reachability of AS external routes, the ABR in an NSSA generates a
default route and advertises the route to the other routers in this NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 195
Multiple ABRs may be deployed in an NSSA. To prevent routing loops caused by
default routes, ABRs do not calculate the default routes advertised by each other.
All routers in an area must have the same area type configured. A router uses the
N-bit carried in a Hello packet to specify the area type that it supports. If routers
have different area types, they cannot establish OSPF neighbor relationships.
Some vendors' devices do not comply with this requirement, and the N-bit is also
set in Database Description (DD) packets. You can manually set the N-bit on
switches to enable interworking with these vendors' devices.
Similar to a totally stub area, a totally NSSA is defined to further reduce the
number of LSAs transmitted within an NSSA.
Inter-Area Loop and Loop Prevention
OSPF runs an SPF algorithm within an area, which prevents routing loops within
the area. However, the distance-vector algorithm is used for inter-area route
transmission, which may easily cause routing loops.
To prevent inter-area loops, OSPF prohibits routing information from being
advertised directly between two non-backbone areas and allows advertising
routing information within a single area or between the backbone and non-
backbone areas. Therefore, each ABR must be connected to the backbone area.
If OSPF allows advertising routing information directly between non-backbone
areas, an inter-area loop may occur, as shown in Figure 5-22. The route from the
backbone area to the external network can be transmitted from Area 0 to Area 1.
If transmitting routing information directly between non-backbone areas is
allowed, this route can be transmitted back to Area 0, forming an inter-area
routing loop. To prevent this loop, OSPF allows exchanging routing information
only between the backbone and non-backbone areas. That is, OSPF prohibits
routing information from being exchanged directly between Area 1 and Area 3 or
directly between Area 2 and Area 3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 196
Figure 5-22 OSPF inter-area loop
OSPF Default Route
A default route has an all–0 destination address and an all-0 mask. A device uses
a default route to forward packets when no matching route is discovered.
Hierarchical management of OSPF routes prioritizes the default route carried in
Type 3 LSAs over that carried in Type 5 or Type 7 LSAs.
An OSPF default route is used in the following scenarios:
● An ABR advertises a default route in Type 3 LSAs for instructing routers within
an area to forward packets between areas.
● An ASBR advertises a default route in Type 5 LSAs or Type 7 LSAs for
instructing routers in an AS to forward packets to other ASs.
Advertising an OSPF default route must follow these rules:
● An OSPF router in an area can advertise LSAs carrying a default route only
when the router has an interface connected to a device outside the area.
● If an OSPF router has advertised LSAs carrying a default route, the router no
longer learns the same-type LSAs carrying a default route advertised by other
routers. That is, the router uses only the LSAs advertised by itself to calculate
routes. The LSAs advertised by other routers are still recorded in the LSDB.
● If a router must use a route to advertise LSAs carrying an external default
route, the route cannot be a route learned by the local process. This is
because external default routes guide packet forwarding outside an AS,
whereas routes within an AS have the next hops pointing to the devices
within the AS.
Table 5-7 lists default route advertisement principles in different areas.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 197
Table 5-7 OSPF areas and default route advertisement
Area Type Function
Common area By default, devices in a common OSPF area do not
generate default routes.
When a default route on the network is generated by
another non-OSPF routing process, the device that
generates the default route must advertise it within the
entire OSPF AS. You can use commands to configure an
ASBR to generate a default route. After configuration, the
ASBR generates a Type 5 LSA carrying the default route
and then advertises the LSA within the entire OSPF AS.
Stub area A stub area does not allow AS external routes (carried in
Type 5 LSAs) to be transmitted within the area.
All routers within a stub area must learn AS external routes
from the ABR. The ABR automatically generates a
Summary LSA (Type 3 LSA) carrying a default route and
then advertises it within the entire stub area. This makes
all routes to destinations outside an AS learnable from the
ABR.
Totally stub area A totally stub area does not allow AS external routes
(carried in Type 5 LSAs) or inter-area routes (carried in
Type 3 LSAs) to be transmitted within the area.
All routers within the totally stub area must learn AS
external routes and inter-area routes from the ABR. The
ABR automatically generates a Summary LSA (Type 3 LSA)
carrying a default route and advertises it within the entire
totally stub area. This makes all routes to destinations
outside an AS and to destinations in other areas learnable
from the ABR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 198
Area Type Function
NSSA An NSSA allows its ASBRs to import a small number of AS
external routes. The ASBRs do not advertise Type 5 LSAs
received from other areas within the NSSA. That is, AS
external routes can be learned only from ASBRs in the
NSSA.
Devices in an NSSA do not automatically generate default
routes.
Use either of the following methods to generate default
routes:
● Method 1: To advertise AS external routes through the
ASBR in the NSSA and advertise other external routes
through other areas, configure a Type 7 LSA carrying a
default route on the ABR and advertise this LSA within
the entire NSSA. In this manner, a small number of AS
external routes can be learned from the ASBR in the
NSSA, and other routes can be learned from the ABR in
the NSSA.
● Method 2: To advertise all external routes through the
ASBR in the NSSA, configure a Type 7 LSA carrying a
default route on the ASBR and advertise this LSA within
the entire NSSA.
The difference between the two methods is:
● In method 1, an ABR generates a Type 7 LSA carrying a
default route regardless of whether the routing table
contains a default route.
● An ASBR generates a Type 7 LSA carrying a default
route only when the routing table contains a default
route.
Default routes are flooded only within the local NSSA and
are not flooded within the entire OSPF AS. If routers in the
local NSSA cannot discover routes to the outside of the AS,
the routers can forward packets outside of the AS through
an ASBR. However, packets of other OSPF areas cannot be
sent outside the AS through this ASBR. Type 7 LSAs
carrying default routes are not translated into Type 5 LSAs
to make the default routes be flooded within the entire
OSPF AS.
Totally NSSA A totally NSSA does not allow AS external routes (carried
in Type 5 LSAs) or inter-area routes (carried in Type 3
LSAs) to be transmitted within the area.
All routers within the totally NSSA must learn AS external
routes from the ABR. The ABR automatically generates a
Type 3 LSA carrying a default route and advertises it within
the entire totally NSSA. This allows all external routes
received from other areas and inter-area routes to be
advertised within the totally NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 199
5.2.1.9 OSPF LSA Types
An OSPF network is partitioned into multiple areas. These areas need to maintain
their own LSDBs, and routers in these areas are classified into different types. LSAs
encapsulated with route description can also be classified based on the router
types.
Figure 5-23 shows an OSPF network that is partitioned into three areas. A static
route is configured on R4 and imported into an OSPF process.
Figure 5-23 OSPF network partitioned into three areas
Table 5-8 lists router IDs and interface IP addresses of R1, R2, R3, and R4.
Table 5-8 Data plan
Device Router ID Interface IP Address
R1 10.1.1.1/32 GE0/0/1: 192.168.12.1/24
R2 10.2.2.2/32 GE0/0/2: 192.168.12.2/24
GE0/0/1: 192.168.23.1/24
R3 10.3.3.3/32 GE0/0/2: 192.168.23.2/24
GE0/0/1: 192.168.34.1/24
R4 10.4.4.4/32 GE0/0/2: 192.168.34.2/24
The following describes LSA types based on the network shown in Figure 5-23.
Router-LSA
A Router-LSA is a Type 1 LSA. It describes a router's link state and cost.
Every router on the OSPF network generates Router-LSAs and advertises them
within its areas. In Figure 5-24, R2 advertises a Router-LSA within Area 0 and Area
1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 200
Figure 5-24 Router-LSA (Type 1)
Figure 5-25 shows the information contained in the Router-LSA flooded by
GE0/0/1 on R2.
Figure 5-25 Information in a Router-LSA
An LSA includes the LSA header and LSA information fields. In all types of LSAs,
their LSA header contains the same fields with the only difference of the Link
State ID field meaning. You need to focus on the following fields in an LSA