S300, S500, S2700, S5700 and S6700 Series
Ethernet Switches
V200R024C00
Configuration Guide - IP Unicast
Routing
Issue 01
Date 2024-09-30
HUAWEI TECHNOLOGIES CO., LTD.
Copyright © Huawei Technologies Co., Ltd. 2024. All rights reserved.
No part of this document may be reproduced or transmitted in any form or by any means without prior
written consent of Huawei Technologies Co., Ltd.
Trademarks and Permissions
and other Huawei trademarks are trademarks of Huawei Technologies Co., Ltd.
All other trademarks and trade names mentioned in this document are the property of their respective
holders.
Notice
The purchased products, services and features are stipulated by the contract made between Huawei and
the customer. All or part of the products, services and features described in this document may not be
within the purchase scope or the usage scope. Unless otherwise specified in the contract, all statements,
information, and recommendations in this document are provided "AS IS" without warranties, guarantees
or representations of any kind, either express or implied.
The information in this document is subject to change without notice. Every effort has been made in the
preparation of this document to ensure accuracy of the contents, but all statements, information, and
recommendations in this document do not constitute a warranty of any kind, express or implied.
Huawei Technologies Co., Ltd.
Address: Huawei Industrial Base
Bantian, Longgang
Shenzhen 518129
People's Republic of China
Website: https://e.huawei.com
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. i
About This Document
Intended Audience
This document is intended for network engineers responsible for switch
configuration and management. You should be familiar with basic Ethernet
knowledge and have extensive experience in network deployment and
management.
Symbol Conventions
The symbols that may be found in this document are defined as follows.
Symbol Description
Indicates a potentially hazardous
situation which, if not avoided, could
result in equipment damage, data loss,
performance deterioration, or
unanticipated results.
NOTICE is used to address practices
not related to personal injury.
Supplements the important
information in the main text.
NOTE is used to address information
not related to personal injury,
equipment damage, and environment
deterioration.
Command Conventions
The command conventions that may be found in this document are defined as
follows.
Convention Description
Boldface The keywords of a command line are in boldface.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing About This Document
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. ii
Convention Description
Italic Command arguments are in
italics.
[ ] Items (keywords or arguments) in brackets [ ] are
optional.
{ x | y | ... } Optional items are grouped in braces and separated
by vertical bars. One item is selected.
[ x | y | ... ] Optional items are grouped in brackets and
separated by vertical bars. One item is selected or
no item is selected.
{ x | y | ... }* Optional items are grouped in braces and separated
by vertical bars. A minimum of one item or a
maximum of all items can be selected.
[ x | y | ... ]* Optional items are grouped in brackets and
separated by vertical bars. Several items or no item
can be selected.
&<1-n> The parameter before the & sign can be repeated 1
to n times.
# A line starting with the # sign is comments.
Interface Numbering Conventions
Interface numbers used in this manual are examples. In device configuration, use
the existing interface numbers on devices.
Security Conventions
● Password setting
– To ensure device security, use ciphertext when configuring a password
and change the password periodically.
– The switch considers all passwords starting and ending with %^%#, %#
%#, %@%@ or @%@% as ciphertext and attempts to decrypt them. If
you configure a plaintext password that starts and ends with %^%#, %#
%#, %@%@ or @%@%, the switch decrypts it and records it into the
configuration file (plaintext passwords are not recorded for the sake of
security). Therefore, do not set a password starting and ending with %^
%#, %#%#, %@%@ or @%@%.
– When you configure passwords in ciphertext, different features must use
different ciphertext passwords. For example, the ciphertext password set
for the AAA feature cannot be used for other features.
● Encryption algorithms
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing About This Document
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. iii
The switch currently supports the 3DES, AES, RSA, SHA1, SHA2, and MD5.
3DES, RSA, and AES are reversible, whereas SHA1, SHA2, and MD5 are
irreversible. Using the encryption algorithms DES, 3DES, RSA (RSA-1024 or
lower), MD5 (in digital signature scenarios and password encryption), or
SHA1 (in digital signature scenarios) is a security risk. If protocols allow, use
more secure encryption algorithms, such as AES, RSA (RSA-2048 or higher),
SHA2, or HMAC-SHA2.
An irreversible encryption algorithm must be used for the administrator
password. SHA2 is recommended for this purpose.
● Personal data
Some personal data (such as MAC or IP addresses of terminals) may be
obtained or used during operation or fault location of your purchased
products, services, features, so you have an obligation to make privacy policies
and take measures according to the applicable law of the country to protect
personal data.
● Mirroring
The terms mirrored port, port mirroring, traffic mirroring, and mirroring in this
document are mentioned only to describe the product's function of
communication error or failure detection, and do not involve collection or
processing of any personal information or communication data of users.
● Reliability design declaration
Network planning and site design must comply with reliability design
principles and provide device- and solution-level protection. Device-level
protection includes planning principles of dual-network and inter-board dual-
link to avoid single point or single link of failure. Solution-level protection
refers to a fast convergence mechanism, such as FRR and VRRP. If solution-
level protection is used, ensure that the primary and backup paths do not
share links or transmission devices. Otherwise, solution-level protection may
fail to take effect.
Reference Standards and Protocols
To obtain reference standards and protocols, log in to Huawei official website,
search for "standard and protocol compliance list", and download the
Huawei S-
Series Switch Standard and Protocol Compliance List. You need to have
permissions to access the document. For any questions, contact technical support.
Disclaimer
● This document is designed as a reference for you to configure your devices. Its
contents, including web pages, command line input and output, are based on
laboratory conditions. It provides instructions for general scenarios, but does
not cover all use cases of all product models. The examples given may differ
from your use case due to differences in software versions, models, and
configuration files. When configuring your device, alter the configuration
depending on your use case.
● The specifications provided in this document are tested in a lab environment
(for example, a certain type of cards have been installed on the tested device
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing About This Document
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. iv
or only one protocol is run on the device). Results may differ from the listed
specifications when you attempt to obtain the maximum values due to factors
such as differences in hardware configurations and carried services.
● In this document, public IP addresses may be used in feature introduction and
configuration examples and are for reference only unless otherwise specified.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing About This Document
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. v
Contents
About This Document................................................................................................................ ii
1 IP Routing.................................................................................................................................. 1
1.1 Overview of IP Routing......................................................................................................................................................... 1
1.2 Understanding IP Routing.................................................................................................................................................... 2
1.2.1 Routers and Routing........................................................................................................................................................... 2
1.2.2 Static Routes and Dynamic Routes................................................................................................................................2
1.2.3 Routing Table and FIB Table............................................................................................................................................ 3
1.2.4 Route Recursion....................................................................................................................................................................6
1.2.5 Routing Protocol Preference.............................................................................................................................................6
1.2.6 Route Metric.......................................................................................................................................................................... 8
1.2.7 Load Balancing and Route Backup................................................................................................................................ 9
1.2.8 IP FRR.................................................................................................................................................................................... 10
1.2.9 Route Convergence........................................................................................................................................................... 12
1.2.10 Default Routes................................................................................................................................................................. 14
1.2.11 Route Importing.............................................................................................................................................................. 14
1.2.12 Autonomous System...................................................................................................................................................... 14
1.2.13 Router ID............................................................................................................................................................................ 15
2 Static Route Configuration................................................................................................. 16
2.1 Overview of Static Routes..................................................................................................................................................16
2.2 Understanding Static Routes............................................................................................................................................ 17
2.2.1 Static Route Basics............................................................................................................................................................ 17
2.2.2 BFD for Static Routes....................................................................................................................................................... 18
2.2.3 NQA for Static Routes......................................................................................................................................................19
2.2.4 Permanent Advertisement of Static Routes............................................................................................................. 20
2.3 Application Scenarios for Static Routes........................................................................................................................ 22
2.3.1 Load Balancing and Route Backup..............................................................................................................................22
2.3.2 Default Static Routes....................................................................................................................................................... 23
2.4 Summary of Static Route Configuration Tasks........................................................................................................... 24
2.5 Default Settings for Static Routes................................................................................................................................... 25
2.6 Configuring IPv4 Static Routes......................................................................................................................................... 25
2.6.1 Creating IPv4 Static Routes............................................................................................................................................ 25
2.6.2 (Optional) Setting the Default Preference Value for IPv4 Static Routes....................................................... 26
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. vi
2.6.3 (Optional) Configuring Permanent Advertisement of IPv4 Static Routes.....................................................27
2.6.4 (Optional) Preventing a Static Route from Being Selected If the Associated BFD Session Is in
AdminDown State........................................................................................................................................................................ 27
2.6.5 (Optional) Preventing Static Routes from Being Recursed to a Blackhole Route...................................... 28
2.6.6 Verifying the IPv4 Static Route Configuration.........................................................................................................29
2.7 Configuring Static BFD for IPv4 Static Routes............................................................................................................ 29
2.8 Configuring NQA for IPv4 Static Routes....................................................................................................................... 30
2.9 Configuring EFM for IPv4 Static Routes........................................................................................................................ 32
2.10 Configuring Association Between IPv4 Static Routes and a Route Monitoring Group.............................. 33
2.11 Configuring IPv6 Static Routes...................................................................................................................................... 34
2.11.1 Creating IPv6 Static Routes......................................................................................................................................... 35
2.11.2 (Optional) Setting the Default Preference Value for IPv6 Static Routes.....................................................36
2.11.3 Verifying the IPv6 Static Route Configuration...................................................................................................... 36
2.12 Configuring Static BFD for IPv6 Static Routes..........................................................................................................36
2.13 Configuring NQA for IPv6 Static Routes.................................................................................................................... 38
2.14 Configuration Examples for Static Routes................................................................................................................. 39
2.14.1 Example for Configuring IPv4 Static Routes.......................................................................................................... 39
2.14.2 Example for Configuring IPv6 Static Routes.......................................................................................................... 43
2.14.3 Example for Configuring Static BFD for IPv4 Static Routes............................................................................. 47
2.14.4 Example for Configuring Static BFD for IPv6 Static Routes............................................................................. 51
2.14.5 Example for Configuring NQA for IPv4 Static Routes........................................................................................ 54
2.14.6 Example for Configuring NQA for IPv6 Static Routes........................................................................................ 58
2.14.7 Example for Configuring EFM for Static IPv4 Routes......................................................................................... 64
2.14.8 Example for Configuring Association Between IPv4 Static Routes and a Route Monitoring Group
............................................................................................................................................................................................................ 67
3 RIP Configuration.................................................................................................................. 74
3.1 Overview of RIP..................................................................................................................................................................... 74
3.2 Understanding RIP................................................................................................................................................................ 75
3.2.1 RIP Fundamentals............................................................................................................................................................. 75
3.2.2 RIP-2 Enhanced Features................................................................................................................................................ 78
3.2.3 Split Horizon and Poison Reverse................................................................................................................................ 80
3.2.4 Multi-Process and Multi-Instance................................................................................................................................ 81
3.2.5 BFD for RIP.......................................................................................................................................................................... 82
3.2.6 Hot Standby........................................................................................................................................................................ 83
3.3 Summary of RIP Configuration Tasks............................................................................................................................ 83
3.4 Licensing Requirements and Limitations for RIP....................................................................................................... 87
3.5 Default Settings for RIP...................................................................................................................................................... 88
3.6 Configuring Basic RIP Functions...................................................................................................................................... 88
3.6.1 Enabling RIP........................................................................................................................................................................ 89
3.6.2 Enabling RIP on the Specified Network Segment.................................................................................................. 89
3.6.3 (Optional) Configuring RIP Neighbors on an NBMA Network......................................................................... 90
3.6.4 (Optional) Configuring the RIP Version.....................................................................................................................90
3.6.5 Verifying the Basic RIP Function Configuration...................................................................................................... 91
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. vii
3.7 Configuring RIP-2.................................................................................................................................................................. 92
3.7.1 Configuring RIP-2 Route Summarization.................................................................................................................. 92
3.7.2 Configuring RIP-2 Packet Authentication..................................................................................................................93
3.7.3 Verifying the RIP-2 Configuration................................................................................................................................ 94
3.8 Preventing Routing Loops.................................................................................................................................................. 95
3.8.1 Configuring Split Horizon............................................................................................................................................... 95
3.8.2 Configuring Poison Reverse........................................................................................................................................... 96
3.8.3 Verifying the RIP Routing Loop Prevention Configuration..................................................................................96
3.9 Controlling RIP Routing...................................................................................................................................................... 96
3.9.1 Configuring RIP Preference............................................................................................................................................ 97
3.9.2 Configuring Additional Metrics of an Interface...................................................................................................... 97
3.9.3 Setting the Maximum Number of Equal-Cost Routes.......................................................................................... 98
3.9.4 Verifying the RIP Routing Control Configuration................................................................................................... 99
3.10 Controlling RIP Route Advertisement.......................................................................................................................... 99
3.10.1 Configuring RIP to Advertise Default Routes........................................................................................................ 99
3.10.2 Disabling an Interface from Sending Update Packets..................................................................................... 100
3.10.3 Configuring RIP to Import Routes...........................................................................................................................101
3.10.4 Verifying the RIP Route Advertisement Control Configuration.................................................................... 102
3.11 Controlling Receiving of RIP Routing Information............................................................................................... 102
3.11.1 Disabling an Interface from Receiving RIP Update Packets.......................................................................... 102
3.11.2 Configuring RIP to Deny Host Routes................................................................................................................... 103
3.11.3 Configuring RIP to Filter Received Routes........................................................................................................... 103
3.11.4 Verifying the RIP Route Receiving Control Configuration.............................................................................. 104
3.12 Improving RIP Network Performance....................................................................................................................... 104
3.12.1 Configuring RIP Timers............................................................................................................................................... 105
3.12.2 Setting the Interval for Sending Update Packets and Maximum Number of Sent Packets............... 106
3.12.3 Enabling the Replay Protection Function............................................................................................................. 106
3.12.4 Configuring RIP to Check the Validity of Update Packets..............................................................................107
3.12.5 Verifying the RIP Network Performance Optimization Configuration....................................................... 108
3.13 Configuring BFD for RIP.................................................................................................................................................108
3.13.1 Configuring Dynamic BFD for RIP.......................................................................................................................... 109
3.13.2 Configuring Static BFD for RIP................................................................................................................................. 111
3.14 Configuring the Network Management Function for RIP..................................................................................113
3.15 Maintaining RIP................................................................................................................................................................ 114
3.15.1 Resetting RIP.................................................................................................................................................................. 114
3.15.2 Clearing RIP Statistics..................................................................................................................................................114
3.16 Configuration Examples for RIP.................................................................................................................................. 114
3.16.1 Example for Configuring Basic RIP Functions..................................................................................................... 115
3.16.2 Example for Configuring RIP to Import Routes..................................................................................................118
3.16.3 Example for Configuring One-Arm Static BFD for RIP.................................................................................... 123
3.16.4 Example for Configuring Dynamic BFD for RIP................................................................................................. 128
3.17 Troubleshooting RIP........................................................................................................................................................ 133
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. viii
3.17.1 Failed to Receive RIP Update Packets from Neighbors................................................................................... 133
3.17.2 Failed to Send RIP Update Packets to Neighbors..............................................................................................133
3.17.3 Route Flapping Occurs on a RIP Network........................................................................................................... 134
4 RIPng Configuration........................................................................................................... 135
4.1 Overview of RIPng............................................................................................................................................................. 135
4.2 Understanding RIPng........................................................................................................................................................ 136
4.2.1 RIPng................................................................................................................................................................................... 136
4.3 Summary of RIPng Configuration Tasks..................................................................................................................... 136
4.4 Licensing Requirements and Limitations for RIPng................................................................................................ 138
4.5 Default Settings for RIPng............................................................................................................................................... 139
4.6 Configuring Basic RIPng Functions............................................................................................................................... 139
4.6.1 Enabling RIPng................................................................................................................................................................. 139
4.6.2 Enabling RIPng on Interfaces...................................................................................................................................... 140
4.6.3 Verifying the Basic RIPng Function Configuration...............................................................................................141
4.7 Preventing Routing Loops............................................................................................................................................... 141
4.7.1 Configuring Split Horizon.............................................................................................................................................141
4.7.2 Configuring Poison Reverse......................................................................................................................................... 142
4.7.3 Verifying the RIPng Routing Loop Prevention Configuration.......................................................................... 143
4.8 Controlling RIPng Routing............................................................................................................................................... 143
4.8.1 Configuring RIPng Preference..................................................................................................................................... 143
4.8.2 Configuring Additional Metrics of an Interface....................................................................................................143
4.8.3 Setting the Maximum Number of Equal-Cost Routes....................................................................................... 144
4.8.4 Verifying the RIPng Routing Control Configuration............................................................................................145
4.9 Controlling RIPng Route Advertisement..................................................................................................................... 145
4.9.1 Configuring RIPng Route Summarization...............................................................................................................145
4.9.2 Advertising a Default Route........................................................................................................................................ 146
4.9.3 Configuring a RIPng Process to Import External Routes................................................................................... 147
4.9.4 Disabling Sending of RIPng Packets on an Interface..........................................................................................148
4.9.5 Disabling Receiving of RIPng Packets on an Interface.......................................................................................148
4.9.6 Verifying the RIPng Route Advertisement Control Configuration..................................................................149
4.10 Controlling the Receiving of RIPng Routes............................................................................................................. 149
4.11 Improving RIPng Network Performance.................................................................................................................. 150
4.11.1 Configuring RIPng Timers.......................................................................................................................................... 150
4.11.2 Setting the Interval for Sending Update Packets and Maximum Number of Sent Packets............... 151
4.11.3 Enabling Zero Field Check for RIPng Packets..................................................................................................... 152
4.11.4 Verifying the RIPng Network Performance Optimization Configuration.................................................. 152
4.12 Configuring IPSec Authentication for RIPng........................................................................................................... 153
4.12.1 Configuring an IPSec Session for Encryption...................................................................................................... 153
4.12.2 Configuring RIPng IPSec Authentication.............................................................................................................. 156
4.12.3 Verifying the RIPng IPSec Authentication Configuration................................................................................ 157
4.13 Clearing RIPng................................................................................................................................................................... 157
4.14 Example for Configuring RIPng to Filter the Received Routes......................................................................... 158
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. ix
5 OSPF Configuration............................................................................................................ 163
5.1 Overview of OSPF.............................................................................................................................................................. 164
5.2 Understanding OSPF......................................................................................................................................................... 165
5.2.1 OSPF Fundamentals....................................................................................................................................................... 165
5.2.1.1 OSPF Characteristics................................................................................................................................................... 165
5.2.1.2 OSPF Mechanism......................................................................................................................................................... 166
5.2.1.3 OSPF Packet Types...................................................................................................................................................... 170
5.2.1.4 OSPF Network Types.................................................................................................................................................. 171
5.2.1.5 DR/BDR Election.......................................................................................................................................................... 172
5.2.1.6 OSPF State Machine................................................................................................................................................... 181
5.2.1.7 OSPF Adjacency Establishment...............................................................................................................................185
5.2.1.8 OSPF Areas.....................................................................................................................................................................190
5.2.1.9 OSPF LSA Types............................................................................................................................................................ 200
5.2.1.10 OSPF Fast Convergence.......................................................................................................................................... 207
5.2.1.11 OSPF Virtual Link...................................................................................................................................................... 209
5.2.1.12 OSPF Route Summarization and Filtering........................................................................................................210
5.2.1.13 OSPF Multi-Process.................................................................................................................................................. 211
5.2.1.14 OSPF RFC 1583 Compatibility............................................................................................................................... 211
5.2.2 Enhanced OSPF Functions........................................................................................................................................... 212
5.2.2.1 OSPF VPN....................................................................................................................................................................... 212
5.2.2.2 OSPF TE...........................................................................................................................................................................218
5.2.2.3 OSPF Security................................................................................................................................................................ 220
5.2.2.4 OSPF GR.......................................................................................................................................................................... 221
5.2.2.5 OSPF Neighbor Relationship Flapping Suppression........................................................................................ 225
5.2.2.6 OSPF Smart-Discover................................................................................................................................................. 232
5.2.2.7 OSPF Database Overflow......................................................................................................................................... 232
5.2.2.8 OSPF Mesh-Group....................................................................................................................................................... 234
5.2.3 Association Between OSPF and Other Protocols................................................................................................. 235
5.3 Application Scenarios for OSPF..................................................................................................................................... 239
5.3.1 OSPF GR............................................................................................................................................................................. 239
5.3.2 OSPF GTSM....................................................................................................................................................................... 239
5.4 OSPF Deployment Guide................................................................................................................................................. 240
5.4.1 OSPF Network Planning and Design........................................................................................................................240
5.4.2 OSPF Network Design Deployment Case............................................................................................................... 243
5.5 Summary of OSPF Configuration Tasks...................................................................................................................... 256
5.6 Licensing Requirements and Limitations for OSPF................................................................................................. 258
5.7 Default Settings for OSPF................................................................................................................................................ 259
5.8 Configuring Basic OSPF Functions................................................................................................................................259
5.8.1 Creating an OSPF Process............................................................................................................................................ 259
5.8.2 Creating an OSPF Area..................................................................................................................................................260
5.8.3 Enabling OSPF.................................................................................................................................................................. 261
5.8.4 (Optional) Creating OSPF Virtual Links.................................................................................................................. 262
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. x
5.8.5 (Optional) Restricting the Flooding of LSA Packets........................................................................................... 263
5.8.6 Verifying the Basic OSPF Function Configuration................................................................................................264
5.9 Configuring Session Parameters for OSPF Neighbor or Adjacency Relationships....................................... 264
5.9.1 Setting an OSPF Packet Retransmission Limit...................................................................................................... 265
5.9.2 Configuring an Interface to Insert the Actual MTU into DD Packets........................................................... 265
5.9.3 Verifying the OSPF Session Parameter Configuration........................................................................................266
5.10 Configuring OSPF Attributes on Different Types of Networks.........................................................................267
5.10.1 Configuring a Network Type for an OSPF Interface.........................................................................................268
5.10.2 Configuring P2MP Network Attributes................................................................................................................. 269
5.10.3 Configuring NBMA Network Attributes................................................................................................................ 270
5.10.4 Verifying the OSPF Attribute Configuration........................................................................................................ 272
5.11 Configuring OSPF Stub Areas...................................................................................................................................... 272
5.11.1 Configuring an Area as a Stub Area...................................................................................................................... 273
5.11.2 Verifying the OSPF Stub Area Configuration...................................................................................................... 274
5.12 Configuring an OSPF NSSA.......................................................................................................................................... 274
5.13 Configuring Local MT..................................................................................................................................................... 277
5.14 Adjusting OSPF Route Selection................................................................................................................................. 279
5.14.1 Setting a Link Cost for an OSPF Interface........................................................................................................... 279
5.14.2 Configuring Equal-Cost Routes................................................................................................................................ 281
5.14.3 Configuring a Route Selection Rule....................................................................................................................... 282
5.14.4 Verifying the OSPF Route Selection Adjustment Configuration...................................................................282
5.15 Controlling OSPF Routing Information.....................................................................................................................283
5.15.1 Configuring OSPF to Import External Routes..................................................................................................... 283
5.15.2 Configuring OSPF to Advertise Default Routes to an OSPF Area................................................................284
5.15.3 Configuring OSPF Route Summarization............................................................................................................. 286
5.15.4 Configuring OSPF to Filter Received Routes....................................................................................................... 287
5.15.5 Configuring OSPF to Filter the Routes to Be Advertised................................................................................ 288
5.15.6 Configuring a Switch to Filter LSAs to Be Sent.................................................................................................. 288
5.15.7 Configuring OSPF to Filter ABR Type3 LSAs........................................................................................................289
5.15.8 (Optional) Enabling the Mesh-Group Function................................................................................................. 290
5.15.9 Setting the Maximum Number of External LSAs in the LSDB...................................................................... 290
5.15.10 Verifying the OSPF Route Control Configuration............................................................................................291
5.16 Configuring BFD for OSPF............................................................................................................................................ 291
5.16.1 Configuring Global BFD..............................................................................................................................................292
5.16.2 Configuring BFD for OSPF......................................................................................................................................... 292
5.16.3 (Optional) Preventing an Interface from Dynamically Setting Up a BFD Session................................ 293
5.16.4 (Optional) Configuring BFD on an Interface...................................................................................................... 294
5.16.5 Verifying the BFD for OSPF Configuration...........................................................................................................296
5.17 Configuring OSPF IP FRR............................................................................................................................................... 296
5.17.1 Enabling OSPF IP FRR................................................................................................................................................. 297
5.17.2 (Optional) Binding OSPF IP FRR and BFD........................................................................................................... 298
5.17.3 (Optional) Disabling OSPF IP FRR on an Interface.......................................................................................... 299
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xi
5.17.4 Verifying the OSPF IP FRR Configuration............................................................................................................. 300
5.18 Configuring OSPF Fast Convergence......................................................................................................................... 300
5.18.1 Setting a Convergence Priority for OSPF Routes............................................................................................... 301
5.18.2 Setting an Interval for Sending Hello Packets.................................................................................................... 301
5.18.3 Setting a Dead Time for a Neighbor Relationship............................................................................................ 302
5.18.4 Configuring Smart-discover...................................................................................................................................... 303
5.18.5 Setting an Interval for Updating LSAs...................................................................................................................303
5.18.6 Setting an Interval for Receiving LSAs.................................................................................................................. 304
5.18.7 Setting an Interval for SPF Calculations............................................................................................................... 305
5.18.8 Verifying the OSPF Fast Convergence Configuration....................................................................................... 306
5.19 Configuring OSPF GR...................................................................................................................................................... 307
5.19.1 Enabling the Opaque-LSA Capability of OSPF................................................................................................... 307
5.19.2 (Optional) Configuring GR Session Parameters on the Restarter............................................................... 308
5.19.3 (Optional) Configuring GR Session Parameters on the Helper.................................................................... 308
5.19.4 Verifying the OSPF GR Configuration.................................................................................................................... 309
5.20 Improving Stability of an OSPF Network................................................................................................................ 309
5.20.1 Setting a Priority for OSPF Routes..........................................................................................................................309
5.20.2 Configuring an LSA Transmission Delay on an Interface................................................................................310
5.20.3 Configuring an Interval for Retransmitting LSAs Between Adjacent Switches....................................... 310
5.20.4 Configuring a Stub Router.........................................................................................................................................311
5.20.5 Prohibiting an OSPF Interface from Sending and Receiving Protocol Packets....................................... 312
5.20.6 Disabling the Function of Triggering Active/Standby Board Switchover upon Abnormal OSPF LSA
Aging.............................................................................................................................................................................................. 312
5.20.7 Verifying the OSPF Network Stability Optimization Configuration............................................................ 313
5.21 Improving the Security of an OSPF Network......................................................................................................... 314
5.21.1 Configuring OSPF GTSM............................................................................................................................................ 314
5.21.2 Configuring an Area Authentication Mode......................................................................................................... 315
5.21.3 Configuring an Interface Authentication Mode................................................................................................. 317
5.21.4 Verifying the OSPF Network Security Optimization Configuration............................................................ 318
5.22 Configuring OSPF Neighbor Relationship Flapping Suppression.................................................................... 318
5.23 Suppressing the Advertisement of Interface IP Addresses.................................................................................321
5.24 Configuring Network Management for OSPF........................................................................................................322
5.24.1 Configuring OSPF MIB Binding................................................................................................................................ 322
5.24.2 Configuring the OSPF Trap Function..................................................................................................................... 322
5.24.3 Configuring the OSPF Log Function.......................................................................................................................323
5.24.4 Verifying the OSPF Network Management Configuration.............................................................................323
5.25 Maintaining OSPF............................................................................................................................................................ 323
5.25.1 Clearing OSPF Information....................................................................................................................................... 323
5.25.2 Resetting OSPF Information..................................................................................................................................... 324
5.26 Configuration Examples for OSPF.............................................................................................................................. 324
5.26.1 Example for Configuring Basic OSPF Functions.................................................................................................325
5.26.2 Example for Configuring OSPF DR Election........................................................................................................ 328
5.26.3 Example for Configuring OSPF Stub Areas.......................................................................................................... 334
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xii
5.26.4 Example for Configuring an OSPF NSSA.............................................................................................................. 338
5.26.5 Example for Configuring OSPF Load Balancing.................................................................................................343
5.26.6 Example for Configuring OSPF-BGP Synchronization...................................................................................... 348
5.26.7 Example for Configuring OSPF GR......................................................................................................................... 356
5.26.8 Example for Configuring BFD for OSPF................................................................................................................ 361
5.26.9 Example for Configuring OSPF IP FRR.................................................................................................................. 366
5.26.10 Example for Configuring Local OSPF MT.......................................................................................................... 370
5.27 Troubleshooting OSPF.................................................................................................................................................... 379
5.27.1 An OSPF Neighbor Relationship Cannot Be Established................................................................................ 379
5.27.2 OSPF Cannot Discover Routes of a Non-Local Area........................................................................................ 381
6 OSPFv3 Configuration........................................................................................................ 383
6.1 Overview of OSPFv3.......................................................................................................................................................... 384
6.2 Understanding OSPFv3.....................................................................................................................................................384
6.2.1 OSPFv3 Fundamentals.................................................................................................................................................. 384
6.2.2 OSPFv3 GR.........................................................................................................................................................................391
6.2.3 OSPFv3-BGP Synchronization..................................................................................................................................... 394
6.2.4 OSPFv3 Neighbor Relationship Flapping Suppression....................................................................................... 395
6.2.5 OSPFv3 and OSPFv2 Comparison..............................................................................................................................400
6.3 Summary of OSPFv3 Configuration Tasks................................................................................................................. 401
6.4 Licensing Requirements and Limitations for OSPFv3............................................................................................ 404
6.5 Default Settings for OSPFv3........................................................................................................................................... 404
6.6 Configuring Basic OSPFv3 Functions........................................................................................................................... 405
6.6.1 Enabling OSPFv3............................................................................................................................................................. 405
6.6.2 Enabling OSPFv3 on an Interface.............................................................................................................................. 406
6.6.3 Entering an OSPFv3 Area View.................................................................................................................................. 407
6.6.4 (Optional) Configuring a Route Selection Rule....................................................................................................408
6.6.5 Verifying the Basic OSPFv3 Function Configuration........................................................................................... 408
6.7 Establishing and Maintaining an OSPFv3 Neighbor Relationship.....................................................................409
6.7.1 Configuring an Interval at Which Hello Packets are Sent................................................................................ 409
6.7.2 Configuring a Dead Time for a Neighbor Relationship..................................................................................... 410
6.7.3 Configuring an LSA Retransmission Interval......................................................................................................... 411
6.7.4 Configuring an LSA Transmission Delay................................................................................................................. 411
6.7.5 Verifying the OSPFv3 Neighbor Relationship Establishment and Maintenance Configuration...........412
6.8 Configuring an OSPFv3 Area.......................................................................................................................................... 412
6.8.1 Configuring an OSPFv3 Stub Area............................................................................................................................ 413
6.8.2 Configuring OSPFv3 Virtual Links............................................................................................................................. 413
6.8.3 Verifying the OSPFv3 Area Configuration.............................................................................................................. 414
6.9 Configuring an OSPFv3 NSSA........................................................................................................................................ 415
6.9.1 Defining an Area as an NSSA..................................................................................................................................... 415
6.9.2 Verifying the OSPFv3 NSSA Configuration.............................................................................................................416
6.10 Configuring OSPFv3 Route Attributes.......................................................................................................................416
6.10.1 Setting a Cost for an OSPFv3 Interface................................................................................................................ 416
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xiii
6.10.2 Setting the Maximum Number of Equal-Cost Routes..................................................................................... 417
6.10.3 Verifying the OSPFv3 Route Attribute Configuration...................................................................................... 417
6.11 Controlling OSPFv3 Routing Information................................................................................................................ 418
6.11.1 Configuring OSPFv3 Route Summarization.........................................................................................................418
6.11.2 Configuring OSPFv3 to Filter the Received Routes........................................................................................... 419
6.11.3 Configuring OSPFv3 to Import External Routes................................................................................................ 420
6.11.4 (Optional) Configuring OSPFv3 to Filter LSAs in an Area............................................................................. 421
6.11.5 Verifying the OSPFv3 Route Control Configuration..........................................................................................421
6.12 Optimizing an OSPFv3 Network................................................................................................................................. 422
6.12.1 Configuring an SPF Timer.......................................................................................................................................... 422
6.12.2 Suppressing an Interface from Sending and Receiving OSPFv3 Packets...................................................423
6.12.3 Configuring a DR Priority for an Interface...........................................................................................................424
6.12.4 Configuring a Stub Router.........................................................................................................................................425
6.12.5 Ignoring MTU Check on DD Packets..................................................................................................................... 425
6.12.6 Verifying the OSPFv3 Network Optimization Configuration.........................................................................426
6.13 Configuring BFD for OSPFv3........................................................................................................................................ 426
6.13.1 Configuring BFD Globally.......................................................................................................................................... 427
6.13.2 Configuring BFD for OSPFv3.................................................................................................................................... 428
6.13.3 (Optional) Preventing an Interface from Dynamically Setting Up a BFD Session................................ 428
6.13.4 (Optional) Configuring BFD for a Specified Interface..................................................................................... 429
6.13.5 Verifying the BFD for OSPFv3 Configuration...................................................................................................... 430
6.14 Configuring OSPFv3 IP FRR.......................................................................................................................................... 430
6.14.1 Enabling OSPFv3 IP FRR............................................................................................................................................. 431
6.14.2 (Optional) Disabling OSPFv3 IP FRR on an Interface...................................................................................... 432
6.14.3 Verifying the OSPFv3 IP FRR Configuration........................................................................................................ 432
6.15 Configuring OSPFv3 GR................................................................................................................................................. 432
6.15.1 Enabling OSPFv3 GR....................................................................................................................................................433
6.15.2 Enabling the OSPFv3 GR Helper............................................................................................................................. 433
6.15.3 Verifying the OSPFv3 GR Configuration............................................................................................................... 434
6.16 Improving OSPFv3 Network Security........................................................................................................................ 434
6.16.1 Configuring OSPFv3 GTSM........................................................................................................................................435
6.16.2 Configuring an Authentication Mode....................................................................................................................436
6.16.3 Verifying the OSPFv3 Network Security Optimization Configuration........................................................437
6.17 Configuring OSPFv3 Neighbor Relationship Flapping Suppression................................................................437
6.18 Configuring OSPFv3 IPSec.............................................................................................................................................440
6.18.1 Configuring an IPSec Session for Encryption...................................................................................................... 440
6.18.2 Configuring OSPFv3 IPSec Authentication...........................................................................................................443
6.18.3 Verifying the OSPFv3 IPSec Configuration...........................................................................................................445
6.19 Configuring the Network Management Function of OSPFv3.......................................................................... 445
6.19.1 Configuring OSPFv3 MIB Binding........................................................................................................................... 446
6.19.2 Configuring OSPFv3 Trap........................................................................................................................................... 446
6.19.3 Verifying the OSPFv3 Network Management Function Configuration......................................................447
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xiv
6.20 Resetting OSPFv3............................................................................................................................................................. 447
6.21 Configuration Examples for OSPFv3......................................................................................................................... 447
6.21.1 Example for Configuring an OSPFv3 Stub Area................................................................................................. 447
6.21.2 Example for Configuring DR Election Through OSPFv3..................................................................................452
6.21.3 Example for Configuring an OSPFv3 Virtual Link............................................................................................. 458
6.21.4 Example for Configuring OSPFv3 GR.....................................................................................................................462
6.21.5 Example for Configuring BFD for OSPFv3........................................................................................................... 466
7 IPv4 IS-IS Configuration.................................................................................................... 473
7.1 Overview of IS-IS................................................................................................................................................................ 474
7.2 Understanding IS-IS........................................................................................................................................................... 474
7.2.1 Basic Concepts of IS-IS.................................................................................................................................................. 474
7.2.2 IS-IS Fundamentals.........................................................................................................................................................481
7.2.3 IS-IS Authentication....................................................................................................................................................... 486
7.2.4 IS-IS Route Leaking........................................................................................................................................................ 488
7.2.5 IS-IS Overload.................................................................................................................................................................. 489
7.2.6 IS-IS Network Convergence......................................................................................................................................... 490
7.2.7 IS-IS Neighbor Relationship Flapping Suppression............................................................................................. 491
7.2.8 IS-IS Administrative Tag................................................................................................................................................ 498
7.2.9 IS-IS Wide Metric............................................................................................................................................................ 499
7.2.10 IS-IS LSP Fragment Extension...................................................................................................................................500
7.2.11 IS-IS Host Name Mapping......................................................................................................................................... 503
7.2.12 IS-IS GR............................................................................................................................................................................ 504
7.2.13 BFD for IS-IS................................................................................................................................................................... 510
7.2.14 IS-IS Auto FRR................................................................................................................................................................ 513
7.2.15 IS-IS TE............................................................................................................................................................................. 517
7.2.16 IS-IS Local MT................................................................................................................................................................ 521
7.2.17 IS-IS Multi-Instance and Multi-Process................................................................................................................. 524
7.3 Default Settings for IPv4 IS-IS........................................................................................................................................525
7.4 Summary of IPv4 IS-IS Configuration Tasks.............................................................................................................. 525
7.5 Licensing Requirements and Limitations for IPv4 IS-IS......................................................................................... 530
7.6 Configure Basic IS-IS Functions..................................................................................................................................... 530
7.6.1 Creating IS-IS Processes................................................................................................................................................ 531
7.6.2 Configuring a NET.......................................................................................................................................................... 531
7.6.3 Configuring the Device Level...................................................................................................................................... 532
7.6.4 Establishing IS-IS Neighbor Relationships.............................................................................................................. 533
7.6.5 Verifying the Basic IS-IS Function Configuration................................................................................................. 537
7.7 Improving IS-IS Network Security.................................................................................................................................537
7.7.1 Configuring Interface Authentication...................................................................................................................... 537
7.7.2 Configuring Area or Domain Authentication........................................................................................................ 539
7.7.3 Configuring the Optional Checksum........................................................................................................................ 540
7.7.4 Verifying the IS-IS Network Security Optimization Configuration................................................................ 541
7.8 Controlling IS-IS Route Selection.................................................................................................................................. 541
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xv
7.8.1 Configuring a Preference Value for IS-IS................................................................................................................ 541
7.8.2 Configuring the Cost of an IS-IS Interface............................................................................................................. 542
7.8.3 Configuring Equal-Cost IS-IS Routes........................................................................................................................ 544
7.8.4 Configuring IS-IS Route Leaking................................................................................................................................ 546
7.8.5 Controlling Whether a Level-1 Device Generates a IPv4 Default Route..................................................... 547
7.8.6 Verifying the IS-IS Route Selection Control Configuration............................................................................... 548
7.9 Controlling IS-IS Route Exchange................................................................................................................................. 548
7.9.1 Configuring IS-IS to Advertise a Default Route.................................................................................................... 548
7.9.2 Configuring IS-IS to Import External Routes......................................................................................................... 549
7.9.3 Configuring IS-IS to Advertise Specified External Routes to an IS-IS Routing Domain..........................550
7.9.4 Adding Specified IS-IS Routes to the IP Routing Table...................................................................................... 550
7.9.5 Verifying the IS-IS Route Exchange Control Configuration.............................................................................. 551
7.10 Configuring IS-IS Route Summarization.................................................................................................................. 551
7.11 Controlling IS-IS Route Convergence........................................................................................................................ 552
7.11.1 Configuring Attributes for Hello Packets..............................................................................................................552
7.11.2 Configuring Attributes for LSPs............................................................................................................................... 553
7.11.3 Configuring Attributes for CSNPs............................................................................................................................559
7.11.4 Setting the SPF Calculation Interval...................................................................................................................... 559
7.11.5 Configuring Convergence Priorities for IS-IS Routes........................................................................................ 560
7.11.6 Verifying the IS-IS Route Convergence Control Configuration..................................................................... 561
7.12 Configuring LSP Fragment Extension........................................................................................................................561
7.13 Configuring a Mesh Group on an NBMA Network.............................................................................................. 563
7.14 Configuring IS-IS Reliability.......................................................................................................................................... 563
7.14.1 Configuring Static BFD for IS-IS.............................................................................................................................. 564
7.14.2 Configuring Dynamic BFD for IS-IS........................................................................................................................ 566
7.14.3 Enabling IS-IS GR.......................................................................................................................................................... 568
7.15 Configuring IPv4 IS-IS Auto FRR................................................................................................................................. 569
7.15.1 Enabling IPv4 IS-IS Auto FRR....................................................................................................................................569
7.15.2 (Optional) Disabling an Interface from Being Involved in IPv4 LFA Calculation................................... 570
7.15.3 Verifying the IPv4 IS-IS Auto FRR Configuration............................................................................................... 570
7.16 Configuring the Overload Bit for an IS-IS Device................................................................................................. 571
7.17 Configuring IS-IS Neighbor Relationship Flapping Suppression...................................................................... 571
7.18 Maintaining IS-IS.............................................................................................................................................................. 574
7.18.1 Resetting IS-IS................................................................................................................................................................ 574
7.18.2 Improving the Maintainability of IS-IS.................................................................................................................. 575
7.18.3 Configuring the Output of IS-IS Adjacency Status............................................................................................576
7.19 Configuration Examples for IPv4 IS-IS...................................................................................................................... 576
7.19.1 Example for Configuring Basic IS-IS Functions.................................................................................................. 576
7.19.2 Example for Configuring IS-IS Route Summarization......................................................................................582
7.19.3 Example for Configuring DIS Election................................................................................................................... 586
7.19.4 Example for Configuring IS-IS Load Balancing.................................................................................................. 592
7.19.5 Example for Configuring IS-IS Auto FRR (IP Protecting IP)........................................................................... 597
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xvi
7.19.6 Example for Configuring Static BFD for IS-IS..................................................................................................... 605
7.19.7 Example for Configuring Dynamic BFD for IS-IS............................................................................................... 610
7.19.8 Example for Configuring IS-IS GR........................................................................................................................... 617
7.20 Troubleshooting IPv4 IS-IS............................................................................................................................................ 620
7.20.1 Failed to Establish IS-IS Neighbor Relationships............................................................................................... 621
7.20.2 A Device Cannot Learn IS-IS Routes from Its Neighbor..................................................................................622
8 IPv6 IS-IS Configuration.................................................................................................... 624
8.1 Overview of IS-IS................................................................................................................................................................ 624
8.2 Understanding IPv6 IS-IS................................................................................................................................................. 625
8.2.1 IPv6 IS-IS............................................................................................................................................................................ 625
8.3 Summary of IPv6 IS-IS Configuration Tasks.............................................................................................................. 625
8.4 Licensing Requirements and Limitations for IPv6 IS-IS......................................................................................... 629
8.5 Default Settings for IPv6 IS-IS........................................................................................................................................630
8.6 Configuring Basic IPv6 IS-IS Functions........................................................................................................................630
8.6.1 Creating an IS-IS Process.............................................................................................................................................. 631
8.6.2 Configuring a NET and Enabling IPv6 IS-IS........................................................................................................... 631
8.6.3 Configuring a Device Level.......................................................................................................................................... 632
8.6.4 Establishing an IS-IS Neighbor Relationship......................................................................................................... 633
8.6.5 Verifying the Basic IPv6 IS-IS Function Configuration........................................................................................636
8.7 Improving IPv6 IS-IS Network Security....................................................................................................................... 636
8.7.1 Configuring Interface Authentication...................................................................................................................... 636
8.7.2 Configuring Area or Domain Authentication........................................................................................................ 638
8.7.3 Configuring the Optional Checksum........................................................................................................................ 640
8.7.4 Verifying the IPv6 IS-IS Network Security Optimization Configuration.......................................................641
8.8 Controlling IPv6 IS-IS Route Selection........................................................................................................................ 641
8.8.1 Configuring a Preference Value for IPv6 IS-IS.......................................................................................................641
8.8.2 Configuring a Cost for IS-IS Interfaces on an IPv6 Network........................................................................... 642
8.8.3 Configuring Equal-Cost IPv6 IS-IS Routes.............................................................................................................. 644
8.8.4 Configuring IS-IS IPv6 Route Leaking...................................................................................................................... 645
8.8.5 Controlling Whether a Level-1 Device Generates an IPv6 Default Route...................................................646
8.8.6 Verifying the IPv6 IS-IS Route Selection Control Configuration..................................................................... 647
8.9 Controlling IPv6 IS-IS Route Exchange........................................................................................................................647
8.9.1 Configuring IS-IS to Advertise a Default Route.................................................................................................... 648
8.9.2 Configuring IS-IS to Import External Routes......................................................................................................... 648
8.9.3 Configuring IS-IS to Advertise Specified External Routes to an IS-IS Routing Domain..........................649
8.9.4 Adding Specified IS-IS Routes to an IPv6 Routing Table................................................................................... 650
8.9.5 Verifying the IPv6 IS-IS Route Exchange Control Configuration.....................................................................650
8.10 Configuring IPv6 IS-IS Route Summarization........................................................................................................ 650
8.11 Controlling IPv6 IS-IS Route Convergence...............................................................................................................651
8.11.1 Configuring Attributes for Hello Packets..............................................................................................................651
8.11.2 Configuring Attributes for LSPs............................................................................................................................... 653
8.11.3 Configuring Attributes for CSNPs............................................................................................................................658
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xvii
8.11.4 Setting an SPF Calculation Interval........................................................................................................................ 659
8.11.5 Configuring Convergence Priorities for IS-IS Routes........................................................................................ 660
8.11.6 Verifying the IPv6 IS-IS Route Convergence Control Configuration............................................................661
8.12 Configuring LSP Fragment Extension........................................................................................................................661
8.13 Configuring a Mesh Group on an NBMA Network.............................................................................................. 662
8.14 Configuring IPv6 IS-IS Reliability................................................................................................................................ 663
8.14.1 Configuring Dynamic BFD for IPv6 IS-IS.............................................................................................................. 663
8.15 Configuring the Overload Bit for an IS-IS Device................................................................................................. 666
8.16 Maintaining IS-IS.............................................................................................................................................................. 666
8.16.1 Resetting IS-IS................................................................................................................................................................ 667
8.16.2 Improving the Maintainability of IS-IS.................................................................................................................. 667
8.16.3 Configuring the Output of IS-IS Adjacency Status............................................................................................668
8.17 Configuration Examples for IPv6 IS-IS...................................................................................................................... 669
8.17.1 Example for Configuring Basic IPv6 IS-IS Functions.........................................................................................669
8.17.2 Example for Configuring Dynamic BFD for IPv6 IS-IS..................................................................................... 675
9 BGP Configuration.............................................................................................................. 682
9.1 Overview of BGP................................................................................................................................................................. 682
9.2 Understanding BGP........................................................................................................................................................... 683
9.2.1 Basic Concepts of BGP................................................................................................................................................... 683
9.2.2 BGP Fundamentals......................................................................................................................................................... 685
9.2.3 Interaction Between BGP and IGPs........................................................................................................................... 688
9.2.4 BGP Security......................................................................................................................................................................690
9.2.5 BGP Route Selection Rules and Load Balancing.................................................................................................. 690
9.2.6 Route Reflector................................................................................................................................................................ 694
9.2.7 BGP Confederation......................................................................................................................................................... 699
9.2.8 Route Summarization.................................................................................................................................................... 700
9.2.9 Route Dampening........................................................................................................................................................... 701
9.2.10 BFD for BGP.................................................................................................................................................................... 701
9.2.11 BGP Tracking.................................................................................................................................................................. 702
9.2.12 BGP GR............................................................................................................................................................................. 703
9.2.13 Dynamic Update Peer-Groups..................................................................................................................................703
9.2.14 MP-BGP and Address Families................................................................................................................................. 706
9.2.15 BGP VPN Route Crossing........................................................................................................................................... 714
9.2.16 Route Processing on the BGP router......................................................................................................................718
9.2.17 BGP Routing Table....................................................................................................................................................... 719
9.2.18 Route Attributes............................................................................................................................................................ 724
9.2.18.1 BGP Route Attributes............................................................................................................................................... 724
9.2.18.2 Next_Hop..................................................................................................................................................................... 728
9.2.18.3 PrefVal........................................................................................................................................................................... 734
9.2.18.4 Local_Pref..................................................................................................................................................................... 739
9.2.18.5 Route Type................................................................................................................................................................... 752
9.2.18.6 AS_Path......................................................................................................................................................................... 755
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xviii
9.2.18.7 Origin.............................................................................................................................................................................763
9.2.18.8 MED............................................................................................................................................................................... 766
9.2.18.9 Peer Type...................................................................................................................................................................... 774
9.2.18.10 IGP Cost...................................................................................................................................................................... 775
9.2.18.11 Cluster_List................................................................................................................................................................ 778
9.2.18.12 Originator_ID............................................................................................................................................................ 780
9.2.18.13 BGP Router ID.......................................................................................................................................................... 783
9.2.18.14 Peer IP Address........................................................................................................................................................ 783
9.3 Summary of BGP Configuration Tasks........................................................................................................................ 785
9.4 Licensing Requirements and Limitations for BGP................................................................................................... 791
9.5 Default Settings for BGP.................................................................................................................................................. 792
9.6 Configuring Basic BGP Functions.................................................................................................................................. 792
9.6.1 Starting a BGP Process.................................................................................................................................................. 792
9.6.2 Configuring BGP Peers.................................................................................................................................................. 793
9.6.3 (Optional) Configuring a BGP Peer Group.............................................................................................................794
9.6.4 (Optional) Configuring Dynamic BGP Peers......................................................................................................... 796
9.6.5 Configuring BGP to Import Routes........................................................................................................................... 798
9.6.6 Verifying the Basic BGP Function Configuration.................................................................................................. 799
9.7 Configuring BGP Security................................................................................................................................................ 799
9.7.1 Configuring MD5 Authentication.............................................................................................................................. 800
9.7.2 Configuring Keychain Authentication...................................................................................................................... 801
9.7.3 Configuring BGP GTSM................................................................................................................................................. 801
9.7.4 Verifying the BGP Security Configuration...............................................................................................................802
9.8 Simplifying IBGP Network Connections......................................................................................................................802
9.8.1 Configuring a BGP Route Reflector.......................................................................................................................... 803
9.8.2 Configuring a BGP Confederation............................................................................................................................. 804
9.9 Configuring BGP Route Selection and Load Balancing......................................................................................... 805
9.9.1 Configuring the BGP Priority....................................................................................................................................... 805
9.9.2 Configuring the Next_Hop Attribute........................................................................................................................ 806
9.9.3 Configuring the PrefVal Attribute............................................................................................................................. 808
9.9.4 Configuring the Default Local_Pref Attribute....................................................................................................... 808
9.9.5 Configuring the AS_Path Attribute........................................................................................................................... 809
9.9.6 Configuring the MED Attribute.................................................................................................................................. 812
9.9.7 Configuring the BGP Community Attribute........................................................................................................... 813
9.9.8 Configuring BGP Load Balancing.............................................................................................................................. 815
9.9.9 Verifying the BGP Route Selection and Load Balancing Configuration....................................................... 816
9.10 Controlling the Receiving and Advertisement of BGP Routes.......................................................................... 817
9.10.1 Configuring a Routing Policy.................................................................................................................................... 817
9.10.2 Controlling the Advertisement of BGP Routes................................................................................................... 818
9.10.3 Controlling the Receiving of BGP Routes............................................................................................................. 819
9.10.4 Configuring BGP Soft Reset...................................................................................................................................... 821
9.10.5 Verifying the BGP Route Receiving and Advertisement Configuration......................................................823
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xix
9.11 Adjusting the BGP Network Convergence Speed..................................................................................................824
9.11.1 Configuring a BGP ConnectRetry Timer............................................................................................................... 824
9.11.2 Configuring BGP Keepalive and Hold Timers..................................................................................................... 825
9.11.3 Configuring an Update Message Timer................................................................................................................ 826
9.11.4 Disabling Rapid EBGP Connection Reset.............................................................................................................. 827
9.11.5 Configuring the BGP Next Hop Delayed Response...........................................................................................828
9.11.6 Configuring BGP Route Dampening...................................................................................................................... 829
9.11.7 Configuring Slow Peer Detection............................................................................................................................ 830
9.11.8 Verifying the BGP Network Convergence Speed Adjustment Configuration........................................... 831
9.12 Configuring BGP Reliability.......................................................................................................................................... 832
9.12.1 Enabling BGP Tracking................................................................................................................................................ 832
9.12.2 Configuring BFD for BGP........................................................................................................................................... 833
9.12.3 Configuring BGP GR.....................................................................................................................................................834
9.13 Configuring BGP Route Summarization................................................................................................................... 835
9.14 Configuring BGP to Advertise Default Routes to Peers...................................................................................... 837
9.15 Configuring MP-BGP....................................................................................................................................................... 838
9.16 Maintaining BGP.............................................................................................................................................................. 839
9.16.1 Configuring Alarm and Clear Alarm Thresholds for the Number of BGP Routes..................................839
9.16.2 Resetting BGP Connections....................................................................................................................................... 840
9.16.3 Clearing BGP Statistics................................................................................................................................................ 841
9.17 Configuration Examples for BGP................................................................................................................................ 841
9.17.1 Example for Configuring Basic BGP Functions................................................................................................... 841
9.17.2 Example for Configuring Basic BGP4+ Functions.............................................................................................. 847
9.17.3 Example for Configuring Basic MBGP Functions............................................................................................... 853
9.17.4 Example for Configuring BGP to Interact with an IGP.................................................................................... 862
9.17.5 Example for Configuring AS_Path Filter............................................................................................................... 866
9.17.6 Example for Configuring MED Attributes to Control BGP Route Selection..............................................871
9.17.7 Example for Configuring a BGP Route Reflector............................................................................................... 876
9.17.8 Example for Configuring a BGP4+ Route Reflector.......................................................................................... 881
9.17.9 Example for Configuring a BGP Confederation..................................................................................................887
9.17.10 Example for Configuring the BGP Community Attribute............................................................................. 894
9.17.11 Example for Configuring BGP Load Balancing.................................................................................................898
9.17.12 Example for Configuring a BGP Routing Policy............................................................................................... 904
9.17.13 Example for Configuring BFD for BGP................................................................................................................ 924
9.17.14 Example for Configuring BFD for BGP4+........................................................................................................... 929
9.17.15 Example for Configuring BGP GTSM................................................................................................................... 935
10 Routing Policy Configuration.........................................................................................945
10.1 Overview of Routing Policies....................................................................................................................................... 945
10.2 Understanding Routing Policies.................................................................................................................................. 947
10.2.1 Routing Policy Fundamentals................................................................................................................................... 947
10.2.2 IP Prefix List.................................................................................................................................................................... 951
10.2.3 Route-Policy Implementation and Applications................................................................................................ 956
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xx
10.2.4 Filter-Policy Implementation and Applications.................................................................................................. 959
10.2.5 AS_Path Filter Applications in BGP......................................................................................................................... 968
10.2.6 Community Attribute Applications in BGP.......................................................................................................... 975
10.3 Summary of Routing Policy Configuration Tasks..................................................................................................981
10.4 Licensing Requirements and Limitations for Routing Policies..........................................................................984
10.5 Configuring Filters........................................................................................................................................................... 984
10.5.1 Configuring an IP Prefix List..................................................................................................................................... 984
10.5.2 Configuring an AS_Path Filter.................................................................................................................................. 985
10.5.3 Configuring a Community Filter..............................................................................................................................986
10.5.4 Configuring an Extended Community Filter........................................................................................................987
10.5.5 Configuring an RD Filter............................................................................................................................................ 987
10.6 Configuring a Routing Policy....................................................................................................................................... 988
10.6.1 Creating a Routing Policy.......................................................................................................................................... 988
10.6.2 (Optional) Configuring an if-match Clause........................................................................................................ 989
10.6.3 (Optional) Configuring an apply Clause.............................................................................................................. 991
10.6.4 (Optional) Enabling Further Route Matching Against a Specified Node................................................. 992
10.6.5 Applying a Route-Policy............................................................................................................................................. 993
10.6.6 Verifying the Routing Policy Configuration.......................................................................................................1007
10.7 Configuring Filter-Policy.............................................................................................................................................. 1007
10.7.1 Applying Filters to Received Routes.....................................................................................................................1007
10.7.2 Applying Filters to Advertised Routes................................................................................................................. 1010
10.8 Controlling the Valid Time of Routing Policies................................................................................................... 1013
10.9 Maintaining Routing Policies..................................................................................................................................... 1014
10.10 Configuration Examples for Routing Policies.................................................................................................... 1014
10.10.1 Example for Filtering the Routes to Be Received or Advertised.............................................................. 1014
10.10.2 Example for Applying a Routing Policy for Importing Routes................................................................. 1019
11 IP Routing Table Management................................................................................... 1025
11.1 Licensing Requirements and Limitations for IP Routing Table Management.......................................... 1025
11.2 Managing IP Routing Tables...................................................................................................................................... 1026
11.2.1 Displaying and Maintaining an IP Routing Table........................................................................................... 1026
11.2.2 Displaying and Maintaining the Routing Management Module...............................................................1027
11.2.3 Displaying and Maintaining FIB Tables.............................................................................................................. 1029
11.2.4 Configuring IP FRR on the Public Network....................................................................................................... 1032
11.2.5 Configuring IPv6 FRR on the Public Network.................................................................................................. 1034
11.2.6 Configuring the ECMP Load Balancing Mode.................................................................................................. 1035
11.2.7 Configuring the Advertisement of IPv4 ARP Vlink Direct Routes..............................................................1036
11.3 Example for Configuring IP FRR on the Public Network................................................................................. 1038
12 PBR Configuration.......................................................................................................... 1043
12.1 Overview of PBR............................................................................................................................................................ 1043
12.2 Licensing Requirements and Limitations for PBR...............................................................................................1044
12.3 Configuring PBR............................................................................................................................................................. 1045
12.4 Configuring NQA for PBR........................................................................................................................................... 1048
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xxi
12.5 (Optional) Configuring PBR to Take Precedence over Blackhole Routes...................................................1051
12.6 Configuration Examples for PBR.............................................................................................................................. 1052
12.6.1 Example for Configuring PBR Based on IP Addresses................................................................................... 1052
12.6.2 Example for Configuring PBR.................................................................................................................................1056
12.6.3 Example for Configuring PBR to Import Traffic to the Firewall in Bypass Mode.................................1059
12.6.4 Example for Configuring NQA for PBR............................................................................................................... 1063
13 Route Monitoring Group Configuration....................................................................1069
13.1 Overview of Route Monitoring Groups.................................................................................................................. 1069
13.2 Application Scenarios for Route Monitoring Groups.........................................................................................1070
13.2.1 Preventing Network Congestion........................................................................................................................... 1070
13.2.2 Preventing Traffic Loss..............................................................................................................................................1071
13.3 Understanding Route Monitoring Groups.............................................................................................................1072
13.4 Licensing Requirements and Limitations for Route Monitoring Group...................................................... 1073
13.5 Configuring Association Between IPv4 Static Routes and a Route Monitoring Group......................... 1073
13.6 Example for Configuring Association Between IPv4 Static Routes and a Route Monitoring Group 1075
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xxii
1 IP Routing
1.1 Overview of IP Routing
1.2 Understanding IP Routing
1.1 Overview of IP Routing
Routing is the basic element of data communications networks. It is the process of
selecting paths on a network along which packets are sent from a source to a
destination.
According to the destination address, routes are classified into one of the
following types:
● Network segment route
The destination is a network segment. In this case, if the destination is an
IPv4 address, the subnet mask is less than 32 bits, and if the destination is an
IPv6 address, the prefix length is less than 128 bits.
● Host route
The destination is a host. In this case, if the destination is an IPv4 address, the
subnet mask is 32 bits, and if the destination is an IPv6 address, the prefix
length is 128 bits.
According to whether the destination directly connects to a router, routes are
classified into one of the following types:
● Direct route
The router directly connects to the network where the destination is located.
● Indirect route
The router indirectly connects to the network where the destination is located.
According to the destination address type, routes are classified into one of the
following types:
● Unicast route
The destination address is a unicast address.
● Multicast route
The destination address is a multicast address.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 1
1.2 Understanding IP Routing
1.2.1 Routers and Routing
On the Internet, network connecting devices such as hubs, bridges, switches, and
routers control traffic and ensure data transmission quality. Each of these devices
serves as a different role, but for a common purpose: forming a functioning
network. The following describes a router's role in a network, and the purpose and
nature of routes.
A router selects routes and forwards packets. Upon receiving a packet, a router
selects a proper path, which may have one or more hops, to send the packet to
the next router according to the destination address in the packet. The last router
is responsible for sending the packet to the destination host.
A route is a path along which packets are sent from the source to the destination.
When multiple routes are available to send packets from a router to the
destination, the router can select the optimal route from an IP routing table.
Optimal route selection depends on routing protocol preferences and metrics of
routes. When multiple routes have the same routing protocol preference and
metric, load balancing can be implemented among these routes to relieve network
pressure. When multiple routes have different routing protocol preferences and
metrics, route backup can be implemented among these routes to improve
network reliability.
1.2.2 Static Routes and Dynamic Routes
Routers support direct, static, and dynamic routes. Dynamic routes include Routing
Information Protocol (RIP) routes, Open Shortest Path First (OSPF) routes,
Intermediate System-to-Intermediate System (IS-IS) routes, and Border Gateway
Protocol (BGP) routes.
Differences Between Static Routes and Dynamic Routes
Routing protocols are the rules used by routers to discover routes, generate
routing tables, and guide packet forwarding. Routes are classified into the
following types according to their origin:
● Direct routes: are discovered by link layer protocols.
● Static routes: are manually configured by network administrators.
● Dynamic routes: are discovered by dynamic routing protocols.
Static routes are easy to configure, have low system requirements, and apply to
simple, stable, and small networks. The disadvantage of static routes is that they
require subsequent maintenance as they cannot automatically adapt to network
topology changes.
Dynamic routing protocols have routing algorithms. Therefore, dynamic routes can
automatically adapt to network topology changes and apply to networks on which
Layer 3 devices are deployed. The disadvantages of dynamic routes are that they
are complex to configure, have higher system requirements than static ones, and
consume network and system resources.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 2
Classification of Dynamic Routing Protocols
Dynamic routing protocols are classified based on the following two criteria.
According to the application range, dynamic routing protocols are classified into
the following types:
● Interior Gateway Protocols (IGPs)
Run inside an autonomous system (AS), including RIP, OSPF, and IS-IS.
● Exterior Gateway Protocols (EGPs)
Run between ASs, including BGP (most widely used EGP).
According to the type of algorithm they use, dynamic routing protocols are
classified into the following types:
● Distance-vector routing protocols
Include RIP and BGP. BGP is also called a path-vector protocol.
● Link-state routing protocols
Include OSPF and IS-IS.
The preceding algorithms differ mainly in route discovery and calculation
methods.
1.2.3 Routing Table and FIB Table
Routers forward packets based on routing tables and forwarding information base
(FIB) tables. Each router maintains at least one routing table and one FIB table.
Routers select routes based on routing tables and forward packets based on FIB
tables.
Routing Table
Each router maintains a local core routing table (namely, an IP routing table), and
each routing protocol maintains its own routing table.
● Local core routing table
A router uses the local core routing table to store preferred routes. The router
then sends the preferred routes to the FIB table to guide packet forwarding.
The router selects routes according to routing protocol preferences and costs
stored in the routing table.
● Protocol routing table
A protocol routing table stores routing information discovered by the protocol.
A routing protocol can import and advertise routes that are discovered by
other routing protocols. For example, a router runs the Open Shortest Path
First (OSPF) protocol. To use OSPF to advertise direct routes, static routes, or
Intermediate System-Intermediate System (IS-IS) routes, the router must
import the routes into the OSPF routing table.
Routing Table Contents
You can run the display ip routing-table command on a router to view basic
information about the routing table of the router. The command output is as
follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 3
<HUAWEI> display ip routing-table
Proto: Protocol Pre: Preference
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 14 Routes : 14
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 RD 10.137.216.1 Vlanif20
10.10.10.0/24 Direct 0 0 D 10.10.10.10 Vlanif20
10.10.10.10/32 Direct 0 0 D 127.0.0.1 InLoopBack0
10.10.10.255/32 Direct 0 0 D 127.0.0.1 InLoopBack0
10.10.11.0/24 Direct 0 0 D 10.10.11.1 LoopBack0
10.10.11.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
10.10.11.255/32 Direct 0 0 D 127.0.0.1 InLoopBack0
10.137.216.0/23 Direct 0 0 D 10.137.217.208 Vlanif20
10.137.217.208/32 Direct 0 0 D 127.0.0.1 InLoopBack0
10.137.217.255/32 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
127.255.255.255/32 Direct 0 0 D 127.0.0.1 InLoopBack0
255.255.255.255/32 Direct 0 0 D 127.0.0.1 InLoopBack0
A routing table contains the following key data for each IP packet:
● Destination: identifies the destination IP address or destination network
address of an IP packet.
● Mask: supplements the destination address to specially identify the address of
the network segment where the destination host or router resides.
The network segment address of a destination host or router is obtained
through the "AND" operation on the destination address and network mask.
For example, if the destination address is 10.1.1.1 and the mask is
255.255.255.0, the address of the network segment where the host or router
resides is 10.1.1.0.
The network mask is composed of several consecutive 1s. These 1s can be
expressed in either the dotted decimal notation or the number of consecutive
1s in the mask. For example, the network mask can be expressed either as
255.255.255.0 or 24.
● Proto: indicates the protocol through which routes are learned.
● Pre: indicates the routing protocol preference of a route. There may be
multiple routes to the same destination, which have different next hops and
outbound interfaces. These routes may be discovered by different routing
protocols or manually configured. A router selects the route with the highest
preference (the smallest value) as the optimal route. For the routing protocol
preference, see 1.2.5 Routing Protocol Preference.
● Cost: indicates the route cost. When multiple routes to the same destination
have the same preference, the route with the lowest cost is selected as the
optimal route.
NOTE
The Preference value is used to compare the preferences of different routing protocols,
while the Cost value is used to compare the preferences of different routes of the
same routing protocol.
● NextHop: indicates the IP address of the next device that an IP packet passes
through.
● Interface: indicates the outbound interface through which an IP packet is
forwarded.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 4
In Figure 1-1, the routing table of RouterA shows that it connects to three
networks, so it has three IP addresses and three outbound interfaces.
Figure 1-1 Routing table
Matching with FIB Table
After selecting an optimal route from the routing table, a router sends it to the FIB
table. When receiving a packet, the router compares it against the FIB table to
find the optimal route to forward the packet.
Each entry in the FIB table contains the physical or logical interface through which
a packet is sent to a network segment or host to reach the next router. An entry
can also indicate whether the packet can be sent to a destination host in a directly
connected network.
The router performs the "AND" operation on the destination address in the packet
and the network mask of each entry in the FIB table. The router then compares
the result of the "AND" operation with the entries in the FIB table to find a match
and chooses the optimal route to forward packets according to the longest match
rule.
For example, assume that a router has the following routing table:
Routing Tables:
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 D 192.168.0.2 GigabitEthernet1/0/0
10.8.0.0/16 Static 60 3 D 192.168.0.2 GigabitEthernet1/0/0
10.9.0.0/16 Static 60 50 D 172.16.0.2 GigabitEthernet3/0/0
10.9.1.0/24 Static 60 4 D 192.168.0.2 GigabitEthernet2/0/0
10.20.0.0/16 Direct 0 0 D 172.16.0.1 GigabitEthernet4/0/0
After receiving a packet carrying the destination address 10.9.1.2, the router
searches the following FIB table:
FIB Table:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 5
Total number of Routes : 5
Destination/Mask Nexthop Flag TimeStamp Interface TunnelID
0.0.0.0/0 192.168.0.2 SU t[37] GigabitEthernet1/0/0 0x0
10.8.0.0/16 192.168.0.2 DU t[37] GigabitEthernet1/0/0 0x0
10.9.0.0/16 172.16.0.2 DU t[9992] GigabitEthernet3/0/0 0x0
10.9.1.0/24 192.168.0.2 DU t[9992] GigabitEthernet2/0/0 0x0
10.20.0.0/16 172.16.0.1 U t[9992] GigabitEthernet4/0/0 0x0
The router performs the "AND" operation on the destination address 10.9.1.2 and
the masks 0, 16, and 24 to obtain the network segment addresses: 0.0.0.0/0,
10.9.0.0/16, and 10.9.1.0/24. The three addresses match three entries in the FIB
table. The router chooses the entry 10.9.1.0/24 according to the longest match
rule, and forwards the packet through GigabitEthernet2/0/0.
1.2.4 Route Recursion
Routes can be used to forward traffic only when they have directly connected next
hops. However, this condition may not be met when routes are generated. The
system then needs to search for directly connected next hops and corresponding
outbound interfaces. This process is called route recursion. In most cases, BGP
routes, static routes, and user network routes (UNRs) do not have directly
connected next hops, and route recursion is required. The following examples
demonstrate how route recursion generates an FIB entry.
A next-hop IP address of a BGP route is often the IP address of an indirectly
connected peer's Loopback interface, and therefore the BGP route needs to be
recursed. The system searches the IP routing table for a direct route (an IGP route
in most cases) that is destined for the next-hop IP address of the BGP route. Then,
the system adds the next-hop IP address and outbound interface of the IGP route
to the IP routing table, generating a FIB entry.
A next-hop IP address of a BGP VPN route is often the IP address of an indirectly
connected PE's Loopback interface, and the BGP route needs torecurse to a tunnel.
The system searches the tunnel list for a tunnel that is destined for this Loopback
IP address. Then, the system adds the tunnel information to the routing table,
generating a FIB entry.
1.2.5 Routing Protocol Preference
Routing protocols (including static routing) may discover different routes to the
same destination, but not all routes are optimal. Only one routing protocol at a
time determines the optimal route to a destination. To select the optimal route,
each routing protocol (including static routing) is assigned a preference (a smaller
value indicates a higher preference). When multiple routing information sources
coexist, the route discovered by the routing protocol with the highest preference is
selected as the optimal route and added to the local routing table.
Routers define external and internal preferences. External preference is manually
configured for each routing protocol. Table 1-1 lists the default external
preferences of routing protocols.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 6
Table 1-1 Routing protocols and their default external preferences
Routing Protocol or
Route Type
Default External Preference
Direct 0
OSPF 10
IS-IS 15
Static 60
RIP 100
OSPF ASE 150
OSPF NSSA 150
IBGP 255
EBGP 255
NOTE
In Table 1-1, the value 0 indicates direct routes and the value 255 indicates routes learned
from unreliable sources. A smaller value indicates a higher preference.
You can manually configure the external preference of all routing protocols except direct
routes. The preference for each static route varies.
Internal preferences of routing protocols cannot be manually configured. Table
1-2 lists the internal preferences of routing protocols.
Table 1-2 Internal preferences of routing protocols
Routing Protocol or
Route Type
Internal Preference
Direct 0
OSPF 10
IS-IS Level-1 15
IS-IS Level-2 18
Static 60
RIP 100
OSPF ASE 150
OSPF NSSA 150
IBGP 200
EBGP 20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 7
During route selection, a router first compares the external preferences of routes.
When the same external preference is set for different routing protocols, the
router selects the optimal route based on the internal preference. For example,
assume that there are two routes to 10.1.1.0/24: a static route and an OSPF route.
Both routes have the same external preference: 5. In this case, the router
determines the optimal route based on the internal preference listed in Table 1-2.
An OSPF route has an internal preference of 10, and a static route has an internal
preference of 60. This indicates that the OSPF route has a higher preference than
the static route, so the router selects the OSPF route as the optimal route.
NOTE
● If multiple OSPFv2 or OSPFv3 processes learn routes to the same destination and the
external and internal preferences of the routes are the same, the system selects the
route with the smallest link cost; if the link costs of the routes are the same, the routes
participate in load balancing.
● If multiple IS-IS processes learn routes to the same destination and the external and
internal preferences of the routes are the same, the system selects the route with the
smallest link cost; if the link costs of the routes are the same, the routes participate in
load balancing.
● If multiple RIP or RIPng processes learn routes to the same destination and the external
and internal preferences of the routes are the same, the system selects the route with
the smallest link cost; if the link costs of the routes are the same, the routes participate
in load balancing.
In addition, policy-based routing (PBR) provides a mechanism for selecting routes
based on user-defined policies. It allows switches to forward packets based on
users even after routing entries are generated. PBR takes precedence over direct
routes, static routes, and routes generated by dynamic routing protocols.
1.2.6 Route Metric
A route metric specifies the cost of a route to a specified destination address. The
following factors often affect the route metric:
● Path length
Path length is the most common factor that affects the route metric. Link-
state routing protocols allow you to assign a link cost for each link to identify
the path length of a link. In this case, the path length is the sum of the link
costs of all the links that packets pass through. Distance-vector routing
protocols use the hop count to identify the path length. The hop count is the
number of devices that packets pass through from the source to the
destination. For example, the hop count from a router to its directly
connected network is 0, and the hop count from a router to a network that
can be reached through just another router is 1. Other lengths can be
deduced in the same manner.
● Network bandwidth
Network bandwidth is the transmission capability of a link. For example, a 10-
Gigabit link has a higher transmission capability than a 1-Gigabit link.
Although bandwidth defines the maximum transmission rate of a link, routes
over high-bandwidth links are not necessarily better than routes over low-
bandwidth links. For example, when a high-bandwidth link is congested,
forwarding packets over this link will require more time.
● Load
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 8
The load is the degree to which a network resource is busy. You can obtain
the load by calculating the CPU usage and packets processed per second.
Continually monitoring the CPU usage and packets processed per second
helps you learn more about network usage.
● Communication cost
The communication cost is the operating cost of a route over a link. The
communication cost is another important indicator, especially if you do not
care about network performance but are concerned about the operating
expenditure.
1.2.7 Load Balancing and Route Backup
When multiple routes have the same routing protocol preference and metric, these
routes are called equal-cost routes, among which load balancing can be
implemented. When multiple routes have different routing protocol preferences
and metrics, route backup can be implemented among these routes.
Load Balancing
Routers support the multi-route mode, which allows you to configure multiple
routes with the same destination and preference. If the destinations and costs of
multiple routes discovered by the same routing protocol are the same, load
balancing can be performed among the routes.
Currently, static routes and routing protocols (such as RIP, OSPF, BGP, and IS-IS)
use per-flow load balancing. During load balancing, a router forwards packets
based on the packets' 5-tuple (source IP address, destination IP address, source
port, destination port, and transmission protocol). When the 5-tuple information is
the same, the router always chooses the next-hop address that is the same as the
last one to send packets. When the 5-tuple information is different, the router
forwards packets over idle paths.
Figure 1-2 Networking diagram of load balancing
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 9
In the example shown in Figure 1-2, RouterA forwards the first packet P1 to
10.1.1.0/24 through GE0/0/1 and needs to forward subsequent packets to
10.1.1.0/24 and 10.2.1.0/24 respectively. The forwarding process is as follows:
● If the 5-tuple information of P2 destined for 10.1.1.0/24 is the same as that of
P1 destined for 10.1.1.0/24, RouterA forwards P2 and subsequent packets
destined for 10.1.1.0/24 through GE0/0/1.
● If the 5-tuple information of P1 destined for 10.2.1.0/24 is different from that
of P1 destined for 10.1.1.0/24, RouterA forwards P1 and subsequent packets
destined for 10.2.1.0/24 through GE0/0/2.
NOTE
The number of equal-cost routes for load balancing varies with product models.
Route Backup
Route backup can improve network reliability. You can configure multiple routes
to the same destination as required. The route with the highest preference
functions as the primary route, and other routes with lower preferences function
as backup routes.
A router generally uses the primary route to forward data. When the primary link
fails, the primary route becomes inactive. The router selects a backup route with
the highest preference to forward data. In this manner, data is switched from the
primary route to a backup route. When the primary link recovers, the router
selects the primary route to forward data again because the primary route has the
highest preference. Data is then switched back from the backup route to the
primary route.
1.2.8 IP FRR
Definition
IP fast reroute (FRR) is a method that implements fast route backup. It enables a
router to immediately use a backup link for packet forwarding if the router detects
a fault at the physical or data link layer. With IP FRR, the router also reports the
fault to the upper-layer routing system.
Purpose
On traditional IP networks, when a fault occurs at the lower layer on a network,
the physical interface on the router becomes Down. After the router detects the
fault, it informs the upper-layer routing system to recalculate routes and then
updates routing information. Usually, it takes the routing system several seconds
to re-select an available route.
Second-level convergence is intolerable to services that are sensitive to delay and
packet loss because it may lead to service interruptions. For example, Voice over
Internet Protocol (VoIP) services are only tolerant of millisecond-level
interruptions.
IP FRR resolves this by ensuring that the forwarding system rapidly detects a link
fault and then uses a backup route to restore services as soon as possible.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 10
IP FRR Classification and Implementation
IP FRR, which is designed for routes on IP networks, is classified into IP FRR on
public networks and IP FRR on private networks.
● Public network IP FRR protects routers on public networks.
● Private network IP FRR protects Customer Edges (CEs).
IP FRR is implemented as follows:
1. If the primary link is available, you can configure an IP FRR policy to provide
the forwarding information of the backup route to the forwarding engine.
2. If the forwarding engine detects a primary link fault, the engine uses the
backup link to forward traffic before the routes on the control plane converge.
Comparison Between IP FRR and VPN FRR
Table 1-3 Comparison Between IP FRR and VPN FRR
Item Description
IP FRR IP FRR is suitable for IP services that
require a low delay and low packet
loss ratio.
● Protects the public network and
CEs.
● Implements FRR through a backup
route.
VPN FRR VPN FRR is suitable for services that
require a low delay and low packet
loss ratio on VPNs.
● Protects provider edges (PEs).
● Implements FRR through a backup
tunnel.
Comparison Between IP FRR and Load Balancing
Table 1-4 Comparison Between IP FRR and Load Balancing
Item Description
IP FRR Implements FRR through a backup
route. IP FRR is applicable to networks
where a primary link and a backup
link exist and load balancing is not
configured.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 11
Item Description
Load Balancing Implements fast route switching
through equal-cost routes. Load
balancing is applicable to multi-link
networking with load balancing.
IP FRR Typical Application
In the example shown in Figure 1-3, IP FRR is configured to improve network
reliability. CE1 is dual-homed to PE1 and PE2 and has two outbound interfaces
and two next hops configured. That is, link B functions as the backup of link A.
When link A fails, traffic can be rapidly switched to link B.
Figure 1-3 IP FRR
1.2.9 Route Convergence
Definition
Route convergence is the action of recalculating routes to replace existing routes
in the case of network topology changes. The integration of multiple network
services urgently requires differentiated services. Routes for key services, such as
Voice over IP (VoIP), video conferences, and multicast services, need to be
converged rapidly, while routes for common services can be converged relatively
slowly. In this case, the system needs to converge routes based on their
convergence priorities to improve network reliability.
Priority-based convergence is a mechanism that allows the system to converge
routes based on the convergence priority. You can set different convergence
priorities for routes: critical, high, medium, and low (in descending order of
priority). The system then converges routes based on the convergence priorities
and certain convergence rules, that is, schedules these routes in proportion, to
guide service forwarding.
Principles
Routing protocols first compute and deliver routes of high convergence priority to
the system. You can reconfigure the scheduling weight values as required. Table
1-5 lists the default convergence priorities of public routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 12
Table 1-5 Default convergence priorities of public routes
Routing Protocol or Route Type Convergence Priority
Direct High
Static Medium
32-bit host routes of OSPF and IS-IS Medium
OSPF routes (excluding 32-bit host
routes)
Low
IS-IS routes (excluding 32-bit host
routes)
Low
RIP Low
BGP Low
NOTE
For private routes, only the convergence priorities of 32-bit OSPF and IS-IS host routes are
identified as medium, and the convergence priorities of the other routes are identified as
low.
Priority-based Route Convergence
Figure 1-4 shows a networking arrangement for multicast services. OSPF and IS-IS
run on the network. The receiver connects to RouterA, and the multicast source
server 10.10.10.10/32 connects to RouterB. The route to the multicast source
server must be converged faster than other routes such as 10.12.10.0/24. You can
set the convergence priority of route 10.10.10.10/32 to be higher than that of
route 10.12.10.0/24. When routes are converged on the network, the route to the
multicast source server 10.10.10.10/32 is converged first. This ensures the
transmission of multicast services.
Figure 1-4 Networking diagram of priority-based route convergence
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 13
1.2.10 Default Routes
Default routes are special routes used only when packets to be forwarded do not
match any routing entry in a routing table. If the destination address of a packet
does not match any entry in the routing table, the packet is sent through a default
route. If no default route exists and the destination address of the packet does not
match any entry in the routing table, the packet is discarded. An Internet Control
Message Protocol (ICMP) packet is then sent, informing the originating host that
the destination host or network is unreachable.
In a routing table, a default route is the route to network 0.0.0.0 (with the mask
0.0.0.0). You can run the display ip routing-table command to check whether a
default route is configured. Generally, administrators can manually configure
default static routes. Default routes can also be generated through dynamic
routing protocols such as OSPF and IS-IS.
1.2.11 Route Importing
Different routing protocols using different algorithms may discover different
routes. If multiple routing protocols run on a large network, the routing protocols
need to re-advertise the routes they discover.
Each routing protocol can import routes discovered by other routing protocols,
direct routes, and static routes.
1.2.12 Autonomous System
An Autonomous System (AS) is a set of IP networks and routers under one
administration entity and with common routing policies.
Each AS supports multiple IGPs. All the networks in an AS are assigned the same
AS number and managed by the same administration group. Two types of AS
numbers are available: a 2-byte AS number (ranges from 1 to 65535) and a 4-byte
AS number (ranges from 1 to 4294967295). Available AS numbers can become
exhausted and thereby 2-byte AS numbers need to be extended to 4-byte AS
numbers. A 4-byte AS number can also be shown in the X.Y format, where X
ranges from 1 to 65535 and Y ranges from 0 to 65535.
AS numbers are classified into public AS numbers and private AS numbers,
depending on the network where they are used. Table 1-6 lists the two types of
AS numbers and their ranges.
Table 1-6 AS number types and ranges
AS Number Type 2-Byte AS Number 4-Byte AS Number
Public AS number 1 to 64511 1 to 64511, 65536 to
4294967295
Private AS number 64512 to 65535 64512 to 65535
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 14
1.2.13 Router ID
A router ID is a 32-bit integer used to uniquely identify a device that uses a
specific dynamic routing protocol for route exchange. A router ID uses the same
format as an IP address. Router IDs are classified into global router IDs of devices
and router IDs of dynamic routing protocols.
A router ID can be manually configured or automatically selected by a device. To
ensure OSPF stability, you are advised to manually configure the IP address of a
loopback interface as a router ID.
Manually Configured Router ID
● If a router ID of a specific dynamic routing protocol is configured, this router
ID takes effect.
● If no router ID of a specific dynamic routing protocol is configured and a
global router ID is configured for the device, the global router ID takes effect.
Router ID Automatically Selected by a Device
If the administrator does not configure a global router ID or configure a router ID
for a specific dynamic routing protocol on the device, the router selects a router ID
based on IP addresses of current interfaces:
● If there are loopback interfaces that have IP addresses configured, the device
selects the largest IP address among loopback interface addresses as the
global router ID.
● If no loopback interface is configured or loopback interfaces do not have IP
addresses configured, the device selects the largest IP address among
interface addresses as the global router ID without considering the Up/Down
state of interfaces.
The device selects a router ID again only when the interface IP address that has
been selected as the router ID is deleted or changed.
When a device is being initialized and there is no interface address on the device,
the first configured IP address on the device, which may be a loopback interface
address or another interface address, will become the global router ID of the
device. This global router ID remains unchanged even if there is a larger interface
IP address on the device. The device selects a new global router ID based on the
preceding rules when the IP address that has been used as the existing global
router ID is deleted.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 1 IP Routing
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 15
2 Static Route Configuration
2.1 Overview of Static Routes
2.2 Understanding Static Routes
2.3 Application Scenarios for Static Routes
2.4 Summary of Static Route Configuration Tasks
2.5 Default Settings for Static Routes
2.6 Configuring IPv4 Static Routes
2.7 Configuring Static BFD for IPv4 Static Routes
2.8 Configuring NQA for IPv4 Static Routes
2.9 Configuring EFM for IPv4 Static Routes
2.10 Configuring Association Between IPv4 Static Routes and a Route Monitoring
Group
2.11 Configuring IPv6 Static Routes
2.12 Configuring Static BFD for IPv6 Static Routes
2.13 Configuring NQA for IPv6 Static Routes
2.14 Configuration Examples for Static Routes
2.1 Overview of Static Routes
Definition
A static route is a fixed route that allows network traffic to reach its target
destination. Typically, static routes are manually configured by network
administrators.
Purpose
Static routes are used in different ways on different types of network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 16
● On simple networks, static routes can be used alone, without the need for
dynamic routes.
● On complex networks, static routes can be used alongside dynamic routes to
improve network performance and ensure that bandwidth is available for
important applications.
● Static routes can be associated with VPN instances to manage VPN routes.
2.2 Understanding Static Routes
2.2.1 Static Route Basics
A router forwards data packets based on routing entries in a routing table. These
routing entries can be manually configured or calculated using dynamic routing
protocols. A static route normally refers to a manually configured route.
In contrast to dynamic routing, static routing is easier to configure, has higher
controllability, uses less bandwidth, and does not use CPU resources for route
calculation and update analysis. When a network fault occurs or the topology
changes, static routes cannot be automatically updated and must be manually
reconfigured to adapt to the network change. Therefore, static routes are not
suitable for large and complex networks. In addition, it is difficult for network
administrators to know the entire network topology. When the network topology
or link state changes, a large amount of static routing information of routers
needs to be adjusted, which is a laborious.
A static route has five parameters: destination IP address, mask, outbound
interface, next-hop IP address, and preference.
Destination Address and Mask
The IPv4 destination address of a static route is expressed in dotted decimal
notation. The mask of the route can be expressed either in dotted decimal
notation or by the mask length. The mask length is the number of consecutive 1s
in the mask. For details about the IPv6 destination address and mask of a static
route, see IPv6 Addresses in "Basic IPv6 Configuration" in the
S300, S500, S2700,
S5700, and S6700 V200R024C00 Configuration Guide - IP Service. Setting the
destination and mask to all 0s configures a default static route. For details about a
default static route, see 2.3.2 Default Static Routes.
Outbound Interface and Next-Hop IP Address
When configuring a static route, depending on the outbound interface type, you
need to specify either an outbound interface or a next-hop IP address.
● For point-to-point (P2P) interfaces, specify an outbound interface. This
automatically sets the IP address of the remote interface connected to the
outbound interface as the next-hop address.
● For non-broadcast multiple access (NBMA) interfaces such as Asynchronous
Transfer Mode (ATM) interfaces, specify a next-hop IP address. This type of
interface supports point-to-multipoint (P2MP) networks, which require
mappings between IP addresses and link-layer addresses to be configured.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 17
Therefore, during the configuration of static routes, only a next-hop IP address
needs to be specified, and no outbound interface needs to be specified.
● For broadcast interfaces (such as Ethernet interfaces), specify a next-hop IP
address. Ethernet interfaces are broadcast interfaces. If an Ethernet interface
is specified as the outbound interface, there will be multiple next hops, and
the system will not be able to decide which next hop to use.
Static Route Preference
Different static routes can have different preference values configured. A smaller
preference value indicates a higher priority. Specifying the same preference value
for static routes with the same destination implements load balancing among
these routes. Conversely, specifying different preference values for static routes
with the same destination implements route backup among the routes. For details,
see 2.3.1 Load Balancing and Route Backup.
2.2.2 BFD for Static Routes
Unlike dynamic routing protocols, static routes do not have a detection
mechanism. When a fault occurs on the network, the administrator needs to
handle it. To assist the administrator, Bidirectional Forwarding Detection (BFD) for
static routes can be introduced into the network to bind a static route to a BFD
session. Then the BFD session can detect the status of the link where the static
route resides.
After BFD for static routes is configured, each static route can be associated with a
BFD session. In addition to route selection rules, whether a static route can be
selected as the optimal route is subject to BFD session status.
● If a BFD session associated with a static route detects a link failure when the
BFD session is Down, the BFD session reports the link failure to the system.
The system then deletes the static route from the IP routing table.
● If a BFD session associated with a static route detects that a faulty link
recovers when the BFD session is Up, the BFD session reports the fault
recovery to the system. The system then adds the static route to the IP
routing table again.
● By default, a static route can still be selected even though the BFD session
associated with it is AdminDown (triggered by the shutdown command run
either locally or remotely). If a device is restarted, the BFD session needs to be
re-negotiated. In this case, whether the static route associated with the BFD
session can be selected as the optimal route is subject to the re-negotiated
BFD session status.
BFD for static routes has two modes:
● Single-hop detection
For a non-recursive static route, the configured outbound interface and next-
hop address provide the information about the directly connected next hop. In
this case, the outbound interface bound to the BFD session is the outbound
interface of the static route, and the peer address is the next-hop address of
the static route.
● Multi-hop detection
For a recursive static route, only the next-hop address is configured. Therefore,
the static route needs to recurse to the directly connected next-hop and the
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 18
outbound interface. In this case, the peer address of the BFD session is the
original next-hop address of the static route, and the outbound interface is
not specified. Generally, the original next hop is an indirect next hop.
Therefore, multi-hop detection is performed on the static routes that support
route recursion.
NOTE
If the next hop of a route is not directly reachable, the route cannot be used for packet
forwarding. Based on information about the current next hop of this route, the system will
calculate an actual outbound interface and an actual next hop. This process is called route
recursion. In the display ip routing-table command output, if the Flags value of a route is
displayed R, the route is a recursive route. Otherwise, the route is not a recursive route.
For more details about BFD, see Understanding BFD in "BFD Configuration" in the
S300, S500, S2700, S5700, and S6700 V200R024C00 Configuration Guide -
Reliability.
2.2.3 NQA for Static Routes
As mentioned previously, static routes do not have a dedicated fault detection
mechanism. If a fault occurs on a non-directly connected link, the corresponding
static route will not be automatically deleted from the IP routing table. This can
interrupt services for a significant amount of time. The network administrator
must delete the corresponding static route to allow traffic to switch to an
available path.
This problem requires an effective solution to detect faults in links for static
routes. BFD for static routes is applicable only in situations where both
communicating devices support it. However, if either of the two communicating
devices supports Network Quality Analysis (NQA), NQA for static routes can be
used to detect faults.
NQA for static routes refers to the association between a static route and an NQA
test instance. The system can use the NQA test instance to check the link status.
Based on the NQA test result, the system can determine an optimal route in time
to prevent communication interruptions and ensure service quality. NQA for static
routes works as follows:
● If NQA detects a fault in the link, the system sets the static route to inactive.
The route becomes unavailable and is deleted from the IP routing table.
● If NQA detects that the link has recovered, the system sets the static route to
active. The route becomes available and is re-added to the IP routing table.
For details about NQA, see NQA Configuration in the
S300, S500, S2700, S5700,
and S6700 V200R024C00 Configuration Guide - Network Management and
Monitoring.
NOTE
When a static route is associated with an NQA test instance, only ICMP test instances are
used to test whether the source and destination can be reached through routes.
Each static route can be associated with only one NQA test instance.
Applications
On the network shown in Figure 2-1, access switches connect to users. Because
dynamic routing protocols are not available for communication between RouterB
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 19
and users, static routes are configured on RouterB. To make the network more
stable, RouterC is configured with static routes to the same destination as
RouterB, providing route backup. RouterA, RouterB, and RouterC run a dynamic
routing protocol to learn routes from each other. RouterB and RouterC import
static routes using a dynamic routing protocol and have different costs configured
for these static routes. After configuration is complete, RouterA can use the
dynamic routing protocol to learn from RouterB and RouterC the routes to users.
RouterA uses the link associated with the static route with the lower cost as the
active link, and the other link as the standby link.
NQA for static routes is also configured on RouterB. NQA tests are performed to
check the active link of RouterB → SwitchA → SwitchC (SwitchD). If the active link
fails, the static route is deleted from the routing table, and traffic diverts to the
standby link of RouterC → SwitchB → SwitchC (SwitchD). If both links are working
properly, traffic travels along the active link.
Figure 2-1 NQA for static routes
2.2.4 Permanent Advertisement of Static Routes
Link connectivity determines the stability and availability of a network. Therefore,
link detection plays an important role in network maintenance. BFD cannot be
used for link detection in all scenarios. For example, a simpler method is required
for link detection between different ISPs.
Permanent advertisement of static routes provides a simple, low-cost link
detection mechanism and improves compatibility between Huawei and non-
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 20
Huawei devices. If service traffic needs to be forwarded along a specified path, you
can ping the destination addresses of static routes to detect link connectivity.
When permanent advertisement of static routes is configured, static routes that
cannot be advertised are still preferred and added to the routing table in the
following cases:
● If an outbound interface configured with an IP address is specified for a static
route, the static route is always preferred and added to the routing table
regardless of whether the outbound interface is Up or Down.
● If no outbound interface is specified for a static route, the static route is
always preferred and added to the routing table regardless of whether the
static route can recurse to an outbound interface.
In addition, you also need to control the priority and prefix length of a static route
to enable ping packets to always be forwarded through this static route. The
permanent advertisement mechanism provides a way for you to monitor services
and detect link connectivity.
NOTICE
A device enabled with this feature always stores static routes in its IP routing
table, regardless of whether the static routes are reachable. If a path is
unreachable, the corresponding static route may become a blackhole route.
Applications
In Figure 2-2, border routers BR1, BR2, and BR3 belong to ISP1, ISP2, and ISP3
respectively. There are two links between BR1 and BR2, Link A and Link B.
However, ISP1 requires that service traffic be forwarded to ISP2 over Link A
without traveling through ISP3.
Figure 2-2 Permanent advertisement of static routes
An External Border Gateway Protocol (EBGP) peer relationship is established
between BR1 and BR2, making them BGP peers. For service monitoring purposes,
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 21
a static route destined for BR2 at 10.1.1.2/24 is configured on BR1, and permanent
advertisement of static routes is enabled on BR1. The interface that connects BR1
to BR2 is specified as the outbound interface of the static route. The network
monitoring system periodically pings 10.1.1.2 to determine the status of Link A.
If Link A is working properly, BR1 forwards ping packets over Link A. If Link A
becomes faulty, the static route is still preferred because permanent advertisement
of static routes is enabled, despite the fact that service traffic can reach BR2 over
Link B. BR1 still attempts to forward ping packets over Link A, but fails. This
scenario also applies to BGP packets, resulting in a link fault that interrupts the
BGP peer relationship. The monitoring system detects service faults as returned in
the ping result and prompts maintenance engineers to rectify the faults before
services are affected.
2.3 Application Scenarios for Static Routes
2.3.1 Load Balancing and Route Backup
Load Balancing Among Static Routes
To implement load balancing, set the same preference value for different routes to
the same destination, as shown in Figure 2-3.
Figure 2-3 Load balancing among static routes
Both static routes from SwitchA to SwitchC have a preference value of 60 and are
stored in the routing table.
Route Backup
To implement route backup, set different preference values for different routes to
the same destination, as shown in Figure 2-4.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 22
Figure 2-4 Route backup
There are two static routes with different preference values from SwitchA to
SwitchC. Static route B with next hop SwitchB has a smaller value, which signifies
a higher preference. The link associated with static route B functions as the active
link. Static route D with next hop SwitchD has a lower preference. The link
associated with static route D functions as the standby link, providing link backup
if a fault occurs on the active link.
● In normal situations, the link associated with static route B is the active link.
Static route B is included in the routing table and is used to forward data.
Static route D is not included in the routing table and is not used to forward
data.
● If a fault occurs on the active link, static route B is deleted from the routing
table. Static route D is added to the routing table and is used to forward data.
● When the fault on the active link is resolved, static route B is reactivated, and
is once again used to forward data. Static route D is deleted from the routing
table and functions as the backup route.
● Static routes used for backup are also known as floating static routes.
2.3.2 Default Static Routes
A default route is a route with the destination IP address set to all 0s. It can be
automatically generated using a routing protocol or manually configured.
Manually configured default routes are called default static routes. Using default
static routes can simplify network configuration. If the destination address of a
packet does not match any entries in a router's routing table, the switch forwards
the packet along the default route instead.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 23
Figure 2-5 Default static routes
In Figure 2-5, if no default static route is configured, static routes destined for
networks 3, 4, and 5 must be configured on SwitchA, static routes destined for
networks 1 and 5 must be configured on SwitchB, and static routes destined for
networks 1, 2, and 3 must be configured on SwitchC. Once all of these static
routes are configured, SwitchA, SwitchB, and SwitchC can communicate with each
other.
The next hop of packets sent by SwitchA to networks 3, 4, and 5 is SwitchB.
Therefore, configuring a single default route on SwitchA can replace the three
static routes destined for networks 3, 4, and 5. Similarly, configuring a single
default route from SwitchC to SwitchB can replace the three static routes destined
for networks 1, 2, and 3.
2.4 Summary of Static Route Configuration Tasks
You can accurately control route selection on a network by configuring static
routes. If static route functions other than route selection control are required,
configure them according to reference sections. Table 2-1 describes static route
configuration tasks.
Table 2-1 Static route configuration tasks
Scenario Description Task
Configuring static routes Static routes are
manually configured by
administrators to ensure
normal operations of
simple networks and
required bandwidth for
important network
applications.
● 2.6 Configuring IPv4
Static Routes
● 2.11 Configuring
IPv6 Static Routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 24
Scenario Description Task
Configuring fault
detection protocols for
static routes
In actual networking,
static routes are
associated with fault
detection protocols to
improve network
performance.
● 2.7 Configuring
Static BFD for IPv4
Static Routes
● 2.8 Configuring NQA
for IPv4 Static
Routes
● 2.9 Configuring EFM
for IPv4 Static
Routes
2.5 Default Settings for Static Routes
Table 2-2 describes the default settings for static routes.
Table 2-2 Default settings for static routes
Parameter Default Setting
Preference of static routes 60
2.6 Configuring IPv4 Static Routes
Pre-configuration Tasks
Before configuring IPv4 static routes, configure link layer parameters and IP
addresses for interfaces to ensure network-layer communication between
neighbor nodes.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the IPv4 Static Route Configuration) as required and in any sequence.
2.6.1 Creating IPv4 Static Routes
Context
When creating static routes, you can specify both the outbound interface and next
hop. Alternatively, you can specify only the outbound interface or next hop,
depending on the interface type:
● For point-to-point (P2P) interfaces, specify the outbound interface.
● For non-broadcast multiple access (NBMA) interfaces, specify the next hop.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 25
● For broadcast interfaces (for example, Ethernet interfaces), specify the next
hop.
Specifying the same preference value for static routes to the same destination
implements load balancing among these routes. Conversely, specifying different
preference values for static routes to the same destination implements route
backup among the routes.
Setting the destination IP address and mask to all 0s configures the default IPv4
static route. By default, no default IPv4 static route is configured.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Configure IPv4 static routes.
● Run ip route-static
ip-address {
mask |
mask-length } {
nexthop-address |
interface-type interface-number [
nexthop-address ] | vpn-instance
vpn-
instance-name nexthop-address } [ preference
preference | tag
tag ] *
[ description
text ]
Or run ip route-static
ip-address {
mask |
mask-length } vpn-instance
vpn-
instance-name [ preference
preference | tag
tag ] * [ description
text ]
An IPv4 static route is configured on the public network.
● Run ip route-static vpn-instance
vpn-source-name destination-address
{
mask |
mask-length } {
nexthop-address [ public ] |
interface-type interface-
number [
nexthop-address ] | vpn-instance
vpn-destination-name nexthop-
address } [ preference
preference | tag
tag ] * [ description
text ]
Or run ip route-static vpn-instance
vpn-source-name destination-address
{
mask |
mask-length } { public | vpn-instance
vpn-destination-name }
[ preference
preference | tag
tag ] * [ description
text ]
An IPv4 static route is configured on a VPN instance.
NOTE
To implement load balancing among an Ethernet interface's static route and other static
routes, configure the outbound interface and next hop.
----End
2.6.2 (Optional) Setting the Default Preference Value for IPv4
Static Routes
Context
The default preference value of IPv4 static routes affects route selection. When an
IPv4 static route is configured without specifying a preference value, the default
preference value is used.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 26
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip route-static default-preference
preference
The default preference value of static routes is set.
The default preference value of static routes is initially set to 60.
NOTE
After the default preference value is reconfigured, the new default preference value is valid
only for new IPv4 static routes.
----End
2.6.3 (Optional) Configuring Permanent Advertisement of
IPv4 Static Routes
Context
Link connectivity directly affects network stability and availability. Monitoring link
status is an important part of network maintenance. If service traffic needs to be
forwarded along a specified path, you can monitor the status of the path by
pinging the destination addresses of static routes. In this manner, you can monitor
services at a very low cost.
Permanent advertisement of static routes can detect link connectivity by pinging
the destination addresses of the static routes. After permanent advertisement of
static routes is configured, static routes always take effect regardless of the
outbound interface status. In this case, the system forwards ping packets along a
specified path only, which helps monitor the link status of the path.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip route-static
ip-address {
mask |
mask-length } {
nexthop-address |
interface-type interface-number [
nexthop-address ] | vpn-instance
vpn-instance-
name nexthop-address } permanent
Permanent advertisement of IPv4 static routes is configured.
By default, permanent advertisement of IPv4 static routes is not configured.
----End
2.6.4 (Optional) Preventing a Static Route from Being
Selected If the Associated BFD Session Is in AdminDown State
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 27
Context
If the BFD session associated with a static route on the switch is in AdminDown
state, you can configure the switch not to select the static route. This ensures that
the switch can work together with non-Huawei devices.
By default, a static route can still be selected by the switch even if the BFD session
associated with it is in AdminDown state. However, this is not the case for non-
Huawei devices. As a result, the switch cannot interwork with non-Huawei devices.
To address this problem, run the ip route-static track bfd-session admindown
invalid command to configure the switch not to select the static route if the
associated BFD session is in AdminDown state.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip route-static track bfd-session session-name
bfd-name admindown
invalid
The switch is configured not to select the static route if the associated BFD session
is in AdminDown state.
By default, a static route can still be selected by the switch even if the associated
BFD session is in AdminDown state.
----End
2.6.5 (Optional) Preventing Static Routes from Being
Recursed to a Blackhole Route
Context
If a link failure occurs on a network with IGP (OSPF for example), static, and
blackhole routes, static routes may be recursed to a blackhole route to remain
active. Static routes are preferentially selected over OSPF routes because they have
a higher priority. Although active, the static routes are unreachable because they
have been recursed to a blackhole route, resulting in service interruptions.
To address this problem, prevent static routes from being recursed to a blackhole
route so that OSPF routes will be preferentially selected.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip route recursive-lookup blackhole protocol static disable
Static routes are prevented from being recursed to a blackhole route.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 28
By default, static routes can be recursed to a blackhole route.
----End
2.6.6 Verifying the IPv4 Static Route Configuration
Procedure
● Run the display ip routing-table command to check brief information about
the IPv4 routing table.
● Run the display ip routing-table verbose command to check detailed
information about the IPv4 routing table.
----End
2.7 Configuring Static BFD for IPv4 Static Routes
Pre-configuration Tasks
Before configuring static BFD for IPv4 static routes, complete the following tasks:
● Configure link layer parameters and IP addresses for interfaces to ensure
network-layer communication between neighbor nodes.
● Configure a BFD session.
For details, see BFD Configuration in the
S300, S500, S2700, S5700, and S6700
V200R024C00 Configuration Guide - Reliability.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip route-static
ip-address {
mask |
mask-length } {
nexthop-address |
interface-type interface-number [
nexthop-address ] } [ preference
preference |
tag
tag ] * track bfd-session
cfg-name [ description
text ]
An IPv4 static route on a public network is associated with a BFD session.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 29
NOTE
● Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-
H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support BFD for IPv4 static routes.
● Before associating a static route with a BFD session, ensure that the BFD session and
static route are on the same link.
● BFD Echo function can be associated with a static route.
● When a BFD session is associated with VRRP or a static route, by default, the system
does not allow the associated BFD session to be deleted. To delete the associated BFD
session, run the bfd session nonexistent-config-check disable command to prevent
the device from checking whether the associated BFD session is deleted. Note that
deleting the BFD session will prevent the configured association function from being
implemented.
----End
Verifying the Configuration
Run the following command to check the previous configuration.
● Run the display bfd session all [ verbose ] command to check information
about the BFD session.
2.8 Configuring NQA for IPv4 Static Routes
Pre-configuration Tasks
Before associating IPv4 static routes with NQA, configure link layer parameters for
interfaces to ensure that the link layer protocol status on the interfaces is Up.
Procedure
Step 1 Configure an NQA ICMP test instance.
1. Run system-view
The system view is displayed.
2. Run nqa test-instance
admin-name test-name
An NQA test instance is created, and its view is displayed.
3. Run test-type icmp
The test type is set to ICMP.
NOTE
When a static route is associated with an NQA test instance, only ICMP test instances
are used to test whether there are reachable routes between the source and
destination.
4. Run destination-address ipv4
ip-address
The destination address is set.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 30
In an NQA test instance, you can specify an NQA server by running the
destination-address command to configure a destination address for the
NQA test instance.
5. (Optional) Run frequency
interval
The interval for automatically performing an NQA test is set.
By default, no interval is set, and only one test is performed.
6. (Optional) Run probe-count
number
The number of probes to be sent each time is set for the NQA test instance.
By default, the number of probes is 3.
By sending probes multiple times in an NQA test instance, you can accurately
estimate network quality based on the collected statistics.
7. Run start
The NQA test instance is started.
The start command can be used to configure an NQA test instance to start
immediately, at a specified time, or after a specified delay period. You can
perform one of the following operations as required:
– Run start now [ end { at [
yyyy/
mm/
dd ]
hh:
mm:
ss | delay { seconds
second |
hh:
mm:
ss } | lifetime { seconds
second |
hh:
mm:
ss } } ]
The NQA test instance starts immediately.
– Run start at [
yyyy/
mm/dd ]
hh:
mm:
ss [ end { at [
yyyy/
mm/
dd ]
hh:
mm:
ss | delay { seconds
second |
hh:
mm:
ss } | lifetime { seconds
second |
hh:
mm:
ss } } ]
The NQA test instance will start at a specified time.
– Run start delay { seconds
second |
hh:
mm:
ss } [ end { at [
yyyy/
mm/
dd ]
hh:
mm:
ss | delay { seconds
second |
hh:
mm:
ss } | lifetime { seconds
second |
hh:
mm:
ss } } ]
The NQA test instance will start after a specified delay period.
8. Run quit
Return to the system view.
Step 2 Associate static routes with an NQA test instance.
1. Run ip route-static
ip-address {
mask |
mask-length } {
nexthop-address |
interface-type interface-number [
nexthop-address ] } [ preference
preference
| tag
tag ] * track nqa
admin-name test-name [ description
text ]
IPv4 static routes are associated with an NQA test instance.
NOTE
The destination address of an NQA test instance cannot be the destination address of
an associated static route.
If the static route to be associated with an NQA test instance is already associated
with a different NQA test instance, the static route is disassociated from the first NQA
test instance once it becomes associated with the new NQA test instance.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 31
Verifying the Configuration
Once IPv4 static routes are associated with NQA, run the following commands to
check the configuration.
● Run the display current-configuration | include nqa command to check the
configuration of association between static routes and NQA.
● Run the display nqa results [ collection ] [ test-instance
admin-name test-
name ] command to check the NQA test result.
The NQA test result cannot be displayed automatically. You must run the
display nqa results command to view the NQA test result. By default, the
command output shows the results of the latest five NQA tests.
2.9 Configuring EFM for IPv4 Static Routes
Background
EFM for static routes can be configured to provide a fault detection mechanism for
static routes so that the static routes can detect the link quality changes in real
time and switch services immediately. You can associate Ethernet in the First Mile
(EFM) with an IPv4 static route so that the associated static route can be deleted
from the IP routing table when the EFM session of a specified interface goes
Down. Traffic is then switched to a route without link faults to prevent lengthy
service interruptions.
Pre-configuration Tasks
Before associating IPv4 static routes with EFM, set link layer protocol parameters
and assign IP addresses to interfaces to ensure that the link layer protocol status
of the interfaces is Up.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ip route-static
ip-address {
mask |
mask-length } {
nexthop-address |
interface-type interface-number [
nexthop-address ] } [ preference
preference ]
track efm-state
interface-type interface-number [ description
text ]
EFM is associated with the IPv4 static route.
----End
Verifying the Configuration
● Run the display efm session { all | interface
interface-type interface-number
command to check information about EFM OAM on a specified interface.
● Run the display current-configuration | include efm command to check
associations between EFM and IPv4 static routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 32
2.10 Configuring Association Between IPv4 Static
Routes and a Route Monitoring Group
Context
To quickly detect link quality changes for static routes and ensure timely link
switching, you can associate the IPv4 static routes with a route monitoring group.
If a network-side link fails, the route monitoring group detects the status change
of the corresponding network-side route and triggers switching between the active
and standby links on the access side. This prevents network congestion and traffic
loss and ensures service continuity.
Pre-configuration Tasks
Before configuring association between IPv4 static routes and a route monitoring
group, configure link-layer protocol parameters and IP addresses for interfaces to
ensure that the link-layer protocol status of the interfaces is Up.
Procedure
1. Configure a route monitoring group.
a. Run system-view
The system view is displayed.
b. Run ip route-monitor-group
group-name
A route monitoring group is created and the route monitoring group view
is displayed.
By default, no route monitoring group is created on a switch.
c. Run track ip route [ vpn-instance
vpn-instance-name ]
dest-address
{
mask |
mask-length }
A route is added to the route monitoring group.
By default, no route is added to a route monitoring group.
To add more routes to the route monitoring group, repeat this step. A
route monitoring group can monitor a maximum of 16 routes.
d. (Optional) Run operator and
The relationship between routes in the route monitoring group is set to
AND.
By default, the status of routes in a route monitoring group is of the OR
relationship. That is, the status of the route monitoring group is Up as
long as one route in the group is Up. The status of the monitoring group
is Down only when all routes in the group are Down.
e. (Optional) Run trigger-down-delay
delay-value
A delay after which the RM module instructs the associated service
modules to perform link switchovers is configured.
By default, the delay is 0s.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 33
f. (Optional) Run trigger-up-delay
delay-value
A delay after which the RM module instructs the associated service
modules to perform link switchbacks is configured.
By default, the delay is 5s.
g. Run monitor enable
The route monitoring group is enabled.
2. Configure association between IPv4 static routes and the route monitoring
group.
a. Run system-view
The system view is displayed.
b. Run ip route-static
ip-address {
mask |
mask-length } {
nexthop-address |
interface-type interface-number [
nexthop-address ] | vpn-instance
vpn-
instance-name nexthop-address } [ preference
preference | tag
tag ]
track route-monitor-group
route-monitor-group-name [ description
text ]
Association between IPv4 static routes and the route monitoring group is
configured.
NOTE
The destination address of a route monitored by a route monitoring group cannot be
the destination address of an associated static route.
Verifying the Configuration
● Run the display ip route-monitor-group [
group-name ] command to check
information about the route monitoring group.
● Run the display ip route-monitor-group track-route [ vpn-instance
vpn-
instance-name ]
dest-address {
mask |
mask-length } command to check
information about all route monitoring groups to which a route is added.
● Run the display current-configuration | include track route-monitor-group
command to check the configuration of the association between IPv4 static
routes and route monitoring groups.
2.11 Configuring IPv6 Static Routes
Pre-configuration Tasks
Before configuring IPv6 static routes, configure link layer parameters and IPv6
addresses for interfaces to ensure network-layer communication between
neighbor nodes.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the IPv6 Static Route Configuration) as required and in any sequence.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 34
2.11.1 Creating IPv6 Static Routes
Context
When creating IPv6 static routes, you can specify both the outbound interface and
next hop. Alternatively, you can specify only the outbound interface or next hop,
depending on the interface type:
● For point-to-point (P2P) interfaces, specify the outbound interface.
● For non-broadcast multiple access (NBMA) interfaces, specify the next hop.
● For broadcast interfaces, specify the next-hop address. If a link-local address is
specified as the next-hop address, you must also specify the outbound
interface.
Specifying the same preference value for IPv6 static routes to the same destination
implements load balancing among these routes. Conversely, specifying different
preference values for IPv6 static routes to the same destination implements route
backup among the routes.
Setting the destination IP address and mask to all 0s configures the default IPv6
static route. By default, no default IPv6 static route is configured.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Configure IPv6 static routes.
● Run ipv6 route-static
dest-ipv6-address prefix-length {
interface-type
interface-number [
nexthop-ipv6-address ] |
nexthop-ipv6-address }
[ preference
preference | tag
tag ] * [ description
text ]
Or run ipv6 route-static
dest-ipv6-address prefix-length vpn-instance
vpn-
destination-name [ preference
preference | tag
tag ] * [ description
text ]
An IPv6 static route is configured on the public network.
● Run ipv6 route-static vpn-instance
vpn-instance-name dest-ipv6-address
prefix-length { [
interface-type interface-number ]
nexthop-ipv6-address |
nexthop-ipv6-address [ public ] | vpn-instance
vpn-destination-name
nexthop-ipv6-address } [ preference
preference | tag
tag ] * [ description
text ]
Or run ipv6 route-static vpn-instance
vpn-instance-name dest-ipv6-address
prefix-length { public | vpn-instance
vpn-destination-name } [ preference
preference | tag
tag ] * [ description
text ]
An IPv6 static route is configured on a VPN instance.
NOTE
To implement load balancing among an Ethernet interface's static route and other static
routes, configure the outbound interface and next hop.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 35
2.11.2 (Optional) Setting the Default Preference Value for
IPv6 Static Routes
Context
The default preference value of IPv6 static routes affects route selection. When an
IPv6 static route is configured without specifying a preference value, the default
preference value is used.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ipv6 route-static default-preference
preference
The default preference value of IPv6 static routes is set.
The default preference value of static routes is initially set to 60.
After the default preference value is reconfigured, the new default preference
value is valid only for new IPv6 static routes.
----End
2.11.3 Verifying the IPv6 Static Route Configuration
Procedure
● Run the display ipv6 routing-table command to check brief information
about the IPv6 routing table.
● Run the display ipv6 routing-table verbose command to check detailed
information about the IPv6 routing table.
----End
2.12 Configuring Static BFD for IPv6 Static Routes
Usage Scenario
To use BFD sessions to provide link detection for IPv6 static routes, you can bind
IPv6 static routes to BFD sessions. One IPv6 static route can be bound to one BFD
session.
Optimal IPv6 static routes are delivered to the forwarding table for packet
forwarding. However, IPv6 static routes cannot detect the status of the link to the
next hop. You can bind IPv6 static routes to BFD sessions. A BFD session can fast
detect changes over a link and inform the routing management system of the
changes. The routing management system immediately deletes the static route
that is bound to the BFD session from the forwarding table and recalculates
another active route. In this manner, fast route convergence is implemented.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 36
Pre-configuration Tasks
Before configuring static BFD for IPv6 static routes, complete the following tasks:
● Configure link layer protocol parameters and IP addresses for interfaces and
ensure that the link layer protocol of the interfaces is Up.
● Configure a BFD session. For details, see BFD Configuration in the
S300, S500,
S2700, S5700, and S6700 V200R024C00 Configuration Guide - Reliability.
.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ipv6 route-static
dest-ipv6-address prefix-length {
interface-type interface-
number [
nexthop-ipv6-address ] |
nexthop-ipv6-address | vpn-instance
vpn-
destination-name nexthop-ipv6-address } [ preference
preference | tag
tag ] *
[ track bfd-session
cfg-name ] [ description
text ]
A BFD session is bound to an IPv6 static route.
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support static BFD for IPv6 static routes.
Before associating a static route with a BFD session, ensure that the BFD session and static
route are on the same link.
When a BFD session is associated with VRRP or a static route, the system does not allow
the associated BFD session to be deleted by default. To delete the associated BFD session,
run the bfd session nonexistent-config-check disable command to prevent the device
from checking whether the associated BFD session is deleted. However, deleting the BFD
session will prevent the configured association function from being implemented.
----End
Verifying the Configuration
Run the following commands to check the previous configuration.
Information about a BFD session can be viewed only after parameters of the BFD
session are set and the BFD session is established.
● Run the display bfd session { all | discriminator
discr-value } [ verbose ]
command to check information about BFD sessions.
● Run the display current-configuration | include bfd command to check
configurations of BFD for IPv6 static routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 37
2.13 Configuring NQA for IPv6 Static Routes
Pre-configuration Tasks
Before associating IPv6 static routes with NQA, configure link layer parameters for
interfaces to ensure that the link layer protocol status on the interfaces is Up.
Procedure
Step 1 Configure an NQA ICMP test instance.
1. Run system-view
The system view is displayed.
2. Run nqa test-instance
admin-name test-name
An NQA test instance is created, and its view is displayed.
3. Run test-type icmp
The test type is set to ICMP.
NOTE
When a static route is associated with an NQA test instance, only ICMP test instances
are used to test whether there are reachable routes between the source and
destination.
4. Run destination-address ipv6
ipv6-address
The destination address is set.
In an NQA test instance, you can specify an NQA server by running the
destination-address command to configure a destination address for the
NQA test instance.
5. (Optional) Run frequency
interval
The interval for automatically performing an NQA test is set.
By default, no interval is set, and only one test is performed.
6. (Optional) Run probe-count
number
The number of probes to be sent each time is set for the NQA test instance.
By default, the number of probes is 3.
By sending probes multiple times in an NQA test instance, you can accurately
estimate network quality based on the collected statistics.
7. Run start
The NQA test instance is started.
The start command can be used to configure an NQA test instance to start
immediately, at a specified time, or after a specified delay period. You can
perform one of the following operations as required:
– Run start now [ end { at [
yyyy/
mm/
dd ]
hh:
mm:
ss | delay { seconds
second |
hh:
mm:
ss } | lifetime { seconds
second |
hh:
mm:
ss } } ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 38
The NQA test instance starts immediately.
– Run start at [
yyyy/mm/dd ]
hh:
mm:
ss [ end { at [
yyyy/
mm/
dd ]
hh:
mm:
ss | delay { seconds
second |
hh:
mm:
ss } | lifetime { seconds
second |
hh:
mm:
ss } } ]
The NQA test instance will start at a specified time.
– Run start delay { seconds
second |
hh:
mm:
ss } [ end { at [
yyyy/
mm/
dd ]
hh:
mm:
ss | delay { seconds
second |
hh:
mm:
ss } | lifetime { seconds
second |
hh:
mm:
ss } } ]
The NQA test instance will start after a specified delay period.
8. Run quit
Return to the system view.
Step 2 Associate static routes with an NQA test instance.
1. Run ipv6 route-static
dest-ipv6-address prefix-length {
interface-type
interface-number [
nexthop-ipv6-address ] |
nexthop-ipv6-address }
[ preference
preference | tag
tag ] * track nqa
admin-name test-name
[ description
text ]
IPv6 static routes are associated with an NQA test instance.
NOTE
The destination address of an NQA test instance cannot be the destination address of
an associated static route.
If the static route to be associated with an NQA test instance is already associated
with a different NQA test instance, the static route is disassociated from the first NQA
test instance once it becomes associated with the new NQA test instance.
----End
Verifying the Configuration
Once IPv6 static routes are associated with NQA, run the following commands to
check the configuration.
● Run the display current-configuration | include nqa command to check the
configuration of association between static routes and NQA.
● Run the display nqa results [ collection ] [ test-instance
admin-name test-
name ] command to check the NQA test result.
The NQA test result cannot be displayed automatically. You must run the
display nqa results command to view the NQA test result. By default, the
command output shows the results of the latest five NQA tests.
2.14 Configuration Examples for Static Routes
2.14.1 Example for Configuring IPv4 Static Routes
Networking Requirements
In Figure 2-6, PC1, PC2, and PC3 are on different network segments, and are
connected through SwitchA, SwitchB, and SwitchC. Any two PCs must be
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 39
connected using static routes to communicate with each other without using
dynamic routing protocols.
Figure 2-6 Configuring IPv4 static routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Create VLANs, add interfaces to VLANs, and assign IPv4 addresses to VLANIF
interfaces so that neighboring devices can communicate with each other.
2. Configure an IPv4 default gateway on each PC, and configure IPv4 static
routes or default static routes on each Switch so that any two PCs on different
network segments can communicate with each other.
Procedure
Step 1 Create VLANs and add interfaces to the VLANs.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 30
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type access
[SwitchA-GigabitEthernet0/0/2] port default vlan 30
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Assign IPv4 addresses to VLANIF interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 40
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.4.1 30
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 30
[SwitchA-Vlanif30] ip address 10.1.1.1 24
[SwitchA-Vlanif30] quit
Step 3 Configure PCs.
Set the default gateway addresses of PC1, PC2, and PC3 to 10.1.1.1, 10.1.2.1, and
10.1.3.1 respectively.
Step 4 Configure IPv4 static routes.
# Configure a default IPv4 static route on SwitchA.
[SwitchA] ip route-static 0.0.0.0 0.0.0.0 10.1.4.2
# Configure two IPv4 static routes on SwitchB.
[SwitchB] ip route-static 10.1.1.0 255.255.255.0 10.1.4.1
[SwitchB] ip route-static 10.1.3.0 255.255.255.0 10.1.4.6
# Configure a default IPv4 static route on SwitchC.
[SwitchC] ip route-static 0.0.0.0 0.0.0.0 10.1.4.5
Step 5 Verify the configuration.
# Check the IP routing table on SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 7 Routes : 7
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 RD 10.1.4.2 Vlanif10
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif30
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif30
10.1.4.0/30 Direct 0 0 D 10.1.4.1 Vlanif10
10.1.4.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
# Run the ping command to verify the connectivity.
[SwitchA] ping 10.1.3.1
PING 10.1.3.1: 56 data bytes, press CTRL_C to break
Reply from 10.1.3.1: bytes=56 Sequence=1 ttl=253 time=62 ms
Reply from 10.1.3.1: bytes=56 Sequence=2 ttl=253 time=63 ms
Reply from 10.1.3.1: bytes=56 Sequence=3 ttl=253 time=63 ms
Reply from 10.1.3.1: bytes=56 Sequence=4 ttl=253 time=62 ms
Reply from 10.1.3.1: bytes=56 Sequence=5 ttl=253 time=62 ms
--- 10.1.3.1 ping statistics ---
5 packet(s) transmitted
5 packet(s) received
0.00% packet loss
round-trip min/avg/max = 62/62/63 ms
# Run the tracert command to verify the connectivity.
[SwitchA] tracert 10.1.3.1
traceroute to 10.1.3.1(10.1.3.1), max hops: 30 ,packet length: 40,press CTRL_C to break
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 41
1 10.1.4.2 31 ms 32 ms 31 ms
2 10.1.3.1 62 ms 63 ms 62 ms
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 30
#
interface Vlanif10
ip address 10.1.4.1 255.255.255.252
#
interface Vlanif30
ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type access
port default vlan 30
#
ip route-static 0.0.0.0 0.0.0.0 10.1.4.2
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 20 40
#
interface Vlanif10
ip address 10.1.4.2 255.255.255.252
#
interface Vlanif20
ip address 10.1.4.5 255.255.255.252
#
interface Vlanif40
ip address 10.1.2.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type access
port default vlan 40
#
ip route-static 10.1.1.0 255.255.255.0 10.1.4.1
ip route-static 10.1.3.0 255.255.255.0 10.1.4.6
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 50
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 42
#
interface Vlanif20
ip address 10.1.4.6 255.255.255.252
#
interface Vlanif50
ip address 10.1.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type access
port default vlan 50
#
ip route-static 0.0.0.0 0.0.0.0 10.1.4.5
#
return
2.14.2 Example for Configuring IPv6 Static Routes
Networking requirements
Figure 2-7 shows an IPv6 network. PC1, PC2, and PC3 are on different network
segments, and are connected through SwitchA, SwitchB, and SwitchC. Any two PCs
must be connected using static routes to communicate with each other without
using dynamic routing protocols.
Figure 2-7 Configuring IPv6 static routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Create VLANs, add interfaces to the VLANs, and assign IPv6 addresses to
VLANIF interfaces so that neighboring devices can communicate with each
other.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 43
2. Configure an IPv6 default gateway on each PC, and configure IPv6 static
routes or default static routes on each Switch so that any two PCs on different
network segments can communicate with each other.
Procedure
Step 1 Add interfaces to VLANs.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type access
[SwitchA-GigabitEthernet0/0/2] port default vlan 10
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Assign IPv6 addresses to VLANIF interfaces.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA.
[SwitchA] ipv6
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ipv6 enable
[SwitchA-Vlanif10] ipv6 address fc00:0:0:2001::1/64
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ipv6 enable
[SwitchA-Vlanif20] ipv6 address fc00:0:0:2010::1/64
[SwitchA-Vlanif20] quit
Step 3 Configure IPv6 addresses for the PCs and default gateway addresses.
Assign IPv6 addresses to the PCs, and set the default gateway address of PC1, PC2,
and PC3 to fc00:0:0:2001::1, fc00:0:0:2002::1, and fc00:0:0:2003::1 respectively.
Step 4 Configure IPv6 static routes.
# Configure a default IPv6 static route on SwitchA.
[SwitchA] ipv6 route-static :: 0 vlanif20 fc00:0:0:2010::2
# Configure two IPv6 static routes on SwitchB.
[SwitchB] ipv6 route-static fc00:0:0:2001:: 64 vlanif20 fc00:0:0:2010::1
[SwitchB] ipv6 route-static fc00:0:0:2003:: 64 vlanif40 fc00:0:0:2020::2
# Configure a default IPv6 static route on SwitchC.
[SwitchC] ipv6 route-static :: 0 vlanif40 fc00:0:0:2020::1
Step 5 Verify the configuration.
# Check the IPv6 routing table on SwitchA.
[SwitchA] display ipv6 routing-table
Routing Table : Public
Destinations : 7 Routes : 7
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 44
Destination : :: PrefixLength : 0
NextHop : FC00:0:0:2010::2 Preference : 60
Cost : 0 Protocol : Static
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif20 Flags : D
Destination : ::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : InLoopBack0 Flags : D
Destination : FC00:0:0:2001:: PrefixLength : 64
NextHop : FC00:0:0:2001::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif10 Flags : D
Destination : FC00:0:0:2001::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif10 Flags : D
Destination : FC00:0:0:2010:: PrefixLength : 64
NextHop : FC00:0:0:2010::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif20 Flags : D
Destination : FC00:0:0:2010::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif20 Flags : D
Destination : FE80:: PrefixLength : 10
NextHop : :: Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : NULL0 Flags : D
# Run the ping command to verify the connectivity.
[SwitchA] ping ipv6 fc00:0:0:2003::1
PING fc00:0:0:2003::1 : 56 data bytes, press CTRL_C to break
Reply from FC00:0:0:2003::1
bytes=56 Sequence=1 hop limit=63 time = 63 ms
Reply from FC00:0:0:2003::1
bytes=56 Sequence=2 hop limit=63 time = 62 ms
Reply from FC00:0:0:2003::1
bytes=56 Sequence=3 hop limit=63 time = 62 ms
Reply from FC00:0:0:2003::1
bytes=56 Sequence=4 hop limit=63 time = 63 ms
Reply from FC00:0:0:2003::1
bytes=56 Sequence=5 hop limit=63 time = 63 ms
--- fc00:0:0:2003::1 ping statistics ---
5 packet(s) transmitted
5 packet(s) received
0.00% packet loss
round-trip min/avg/max = 62/62/63 ms
# Run the tracert command to verify the connectivity.
[SwitchA] tracert ipv6 fc00:0:0:2003::1
traceroute to fc00:0:0:2003::1 30 hops max,60 bytes packet
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 45
1 FC00:0:0:2010::2 31 ms 32 ms 31 ms
2 FC00:0:0:2003::1 62 ms 63 ms 62 ms
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
vlan batch 10 20
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:2001::1/64
#
interface Vlanif20
ipv6 enable
ipv6 address FC00:0:0:2010::1/64
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type access
port default vlan 10
#
ipv6 route-static :: 0 Vlanif20 FC00:0:0:2010::2
#
return
● SwitchB configuration file
#
sysname SwitchB
#
ipv6
#
vlan batch 20 30 40
#
interface Vlanif20
ipv6 enable
ipv6 address FC00:0:0:2010::2/64
#
interface Vlanif30
ipv6 enable
ipv6 address FC00:0:0:2002::1/64
#
interface Vlanif40
ipv6 enable
ipv6 address FC00:0:0:2020::1/64
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type access
port default vlan 30
#
ipv6 route-static FC00:0:0:2001:: 64 Vlanif20 FC00:0:0:2010::1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 46
ipv6 route-static FC00:0:0:2003:: 64 Vlanif40 FC00:0:0:2020::2
#
return
● SwitchC configuration file
#
sysname SwitchC
#
ipv6
#
vlan batch 40 50
#
interface Vlanif40
ipv6 enable
ipv6 address FC00:0:0:2020::2/64
#
interface Vlanif50
ipv6 enable
ipv6 address FC00:0:0:2003::1/64
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/2
port link-type access
port default vlan 50
#
ipv6 route-static :: 0 Vlanif40 FC00:0:0:2020::1
#
return
2.14.3 Example for Configuring Static BFD for IPv4 Static
Routes
Networking Requirements
In Figure 2-8, SwitchA connects to the network management system (NMS)
across a network segment through SwitchB. Static routes need to be configured on
SwitchA so that SwitchA can communicate with the NMS. Link fault detection
between SwitchA and SwitchB must be completed within a few milliseconds to
speed up route convergence.
Figure 2-8 Configuring static BFD for IPv4 static routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure a BFD session between SwitchA and SwitchB to complete link fault
detection within a few milliseconds.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 47
2. Configure a static route from SwitchA to the NMS and bind a BFD session to
the static route to complete link fault detection within a few milliseconds and
speed up route convergence.
Procedure
Step 1 Create VLANs and add interfaces to the VLANs.
# Configure SwitchA. The configurations of SwitchB are similar to the
configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign IP addresses to VLANIF interfaces.
# Configure SwitchA. The configurations of SwitchB are similar to the
configuration of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.1.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure a BFD session between SwitchA and SwitchB.
# Create a BFD session on SwitchA.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] bfd aa bind peer-ip 10.1.1.2
[SwitchA-bfd-session-aa] discriminator local 10
[SwitchA-bfd-session-aa] discriminator remote 20
[SwitchA-bfd-session-aa] commit
[SwitchA-bfd-session-aa] quit
# Create a BFD session on SwitchB.
[SwitchB] bfd
[SwitchB-bfd] quit
[SwitchB] bfd bb bind peer-ip 10.1.1.1
[SwitchB-bfd-session-bb] discriminator local 20
[SwitchB-bfd-session-bb] discriminator remote 10
[SwitchB-bfd-session-bb] commit
[SwitchB-bfd-session-bb] quit
Step 4 Configure a static route and bind it to the BFD session.
# On SwitchA, configure a default static route to the external network and bind it
to the BFD session named aa.
[SwitchA]ip route-static 10.2.2.0 24 10.1.1.2 track bfd-session aa
Step 5 Verify the configuration.
# After the configuration is complete, run the display bfd session all command
on SwitchA and SwitchB. The command output shows that the BFD session has
been established and is Up.
The display on SwitchA is used as an example.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 48
[SwitchA] display bfd session all
--------------------------------------------------------------------------------
Local Remote PeerIpAddr State Type InterfaceName
--------------------------------------------------------------------------------
10 20 10.1.1.2 Up S_IP_PEER -
--------------------------------------------------------------------------------
Total UP/DOWN Session Number : 1/0
# Check the IP routing table on SwitchA. The command output shows that the
static route 10.2.2.0/24 exists in the routing table.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 5 Routes : 5
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.2.2.0/24 Static 60 0 RD 10.1.1.2 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
# Run the shutdown command on GE 0/0/1 of SwitchB to simulate a link fault.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# Check the IP routing table on SwitchA. The command output shows that the
static route 10.2.2.0/24 does not exist. This is because the static route has been
bound to a BFD session, and BFD immediately notifies that the bound static route
becomes unavailable after detecting a link fault.
[SwitchA]display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 2 Routes : 2
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
# Run the undo shutdown command on GE0/0/1 of SwitchB to simulate link
recovery.
[SwitchB-GigabitEthernet0/0/1]undo shutdown
# Check the IP routing table on SwitchA. The command output shows that the
static route 10.2.2.0/24 exists in the routing table. This is because BFD
immediately notifies that the bound static route becomes reachable again after
detecting link recovery.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 5 Routes : 5
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.1.0/24 Direct 0 0 D 10.1.1.1 Vlanif10
10.1.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.2.2.0/24 Static 60 0 RD 10.1.1.2 Vlanif10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 49
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
bfd
#
interface Vlanif10
ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
bfd aa bind peer-ip 10.1.1.2
discriminator local 10
discriminator remote 20
commit
#
ip route-static 10.2.2.0 255.255.255.0 10.1.1.2 track bfd-session aa
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 20
#
bfd
#
interface Vlanif10
ip address 10.1.1.2 255.255.255.0
#
interface Vlanif20
ip address 10.2.2.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
bfd bb bind peer-ip 10.1.1.1
discriminator local 20
discriminator remote 10
commit
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 50
2.14.4 Example for Configuring Static BFD for IPv6 Static
Routes
Networking Requirements
In Figure 2-9, SwitchA and SwitchB connect to each other. An IPv6 static route to
SwitchB needs to be configured on SwitchA. It is required that fast fault detection
be implemented on SwitchA and the IPv6 routing table of SwitchA be updated in a
timely manner.
Figure 2-9 Configuring static BFD for IPv6 static routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure a BFD session between SwitchA and SwitchB for fast fault detection
on SwitchA.
2. Configure an IPv6 static route from SwitchA to SwitchB and bind the static
route to the BFD session so that SwitchA can update its IPv6 routing table
after a fault is detected.
Procedure
Step 1 Configure IPv6 addresses for interfaces of SwitchA and SwitchB.
# Configure SwitchA. The configuration of SwitchB is similar to that of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] ipv6
[SwitchA] interface GigabitEthernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] undo portswitch
[SwitchA-GigabitEthernet0/0/1] ipv6 enable
[SwitchA-GigabitEthernet0/0/1] ipv6 address fc00::1 64
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Configure a BFD session between SwitchA and SwitchB.
# On SwitchA, create a BFD session with SwitchB.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] bfd aa bind peer-ipv6 fc00::2
[SwitchA-bfd-session-aa] discriminator local 10
[SwitchA-bfd-session-aa] discriminator remote 20
[SwitchA-bfd-session-aa] commit
[SwitchA-bfd-session-aa] quit
# On SwitchB, create a BFD session with SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 51
[SwitchB] bfd
[SwitchB-bfd] quit
[SwitchB] bfd bb bind peer-ipv6 fc00::1
[SwitchB-bfd-session-bb] discriminator local 20
[SwitchB-bfd-session-bb] discriminator remote 10
[SwitchB-bfd-session-bb] commit
[SwitchB-bfd-session-bb] quit
Step 3 Configure a default static route and bind the route to the BFD session.
# On SwitchA, configure a default static route to SwitchB and bind the route to
the BFD session named aa.
[SwitchA] ipv6 route-static 0::0 0 fc00::2 track bfd-session aa
Step 4 Verify the configuration.
# After the configuration is complete, run the display bfd session all command
on SwitchA and SwitchB. The display on SwitchA is used as an example:
[SwitchA] display bfd session all
--------------------------------------------------------------------------------
Local Remote PeerIpAddr State Type InterfaceName
--------------------------------------------------------------------------------
10 20 FC00::2
Up S_IP_PEER -
--------------------------------------------------------------------------------
Total UP/DOWN Session Number : 1/0
The command output shows that the BFD session has been established and is Up.
Run the display current-configuration | include bfd command in the system
view on SwitchA. The command output shows that the default static route has
been bound to the BFD session.
[SwitchA] display current-configuration | include bfd
bfd
bfd aa bind peer-ipv6 FC00::2
ipv6 route-static :: 0 FC00::2 track bfd-session aa
# Check the IPv6 routing table on SwitchA. The command output shows that the
default static route exists in the routing table.
[SwitchA] display ipv6 routing-table
Routing Table : Public
Destinations : 5 Routes : 5
Destination : :: PrefixLength : 0
NextHop : FC00::2 Preference : 60
Cost : 0 Protocol : Static
RelayNextHop : :: TunnelID : 0x0
Interface : GigabitEthernet0/0/1 Flags : RD
Destination : ::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : InLoopBack0 Flags : D
Destination : FC00:: PrefixLength : 64
NextHop : FC00::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : GigabitEthernet0/0/1 Flags : D
Destination : FC00::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 52
Interface : GigabitEthernet0/0/1 Flags : D
Destination : FE80:: PrefixLength : 10
NextHop : :: Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : NULL0 Flags : D
# Run the shutdown command on GE0/0/1 of SwitchB to simulate a link fault.
[SwitchB] interface GigabitEthernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# Check the IPv6 routing table on SwitchA. The command output shows that the
default static route 0::0/0 does not exist. This is because the default static route
has been bound to a BFD session, and BFD immediately notifies that the bound
static route becomes unavailable after detecting a link fault.
[SwitchA] display ipv6 routing-table
Routing Table : Public
Destinations : 1 Routes : 1
Destination : ::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : InLoopBack0 Flags : D
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
bfd
#
interface GigabitEthernet0/0/1
undo portswitch
ipv6 enable
ipv6 address FC00::1/64
#
bfd aa bind peer-ipv6 FC00::2
discriminator local 10
discriminator remote 20
commit
#
ipv6 route-static :: 0 FC00::2 track bfd-session aa
#
return
● SwitchB configuration file
#
sysname SwitchB
#
ipv6
#
bfd
#
interface GigabitEthernet0/0/1
undo portswitch
ipv6 enable
ipv6 address FC00::2/64
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 53
bfd bb bind peer-ipv6 FC00::1
discriminator local 20
discriminator remote 10
commit
#
return
2.14.5 Example for Configuring NQA for IPv4 Static Routes
Networking Requirements
As shown in Figure 2-10, SwitchA on a company network is connected to two
egress routers (RouterA and RouterB) through two default static routes to
implement load balancing. The company wants to deploy a link failure detection
mechanism for the default static routes, so that traffic can be switched from a
faulty link to the other functioning link promptly to prevent services from being
interrupted.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 2-10 Configuring NQA for IPv4 static routes
Configuration Roadmap
1. Create VLANs, add interfaces to the VLANs, and configure IP addresses for
VLANIF interfaces, so that neighboring devices can communicate with each
other.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 54
2. Create ICMP NQA test instances to monitor the status of links.
ICMP NQA test instances need to be created on the NQA client SwitchA to
detect the status of links between SwitchA and RouterA and between SwitchA
and RouterB.
3. Configure default static routes and bind them to the NQA test instances.
Default static routes destined for RouterA and RouterB need to be configured
on SwitchA and bound to NQA test instances. In this way, if an NQA test
instance detects a link failure, traffic is switched to the other link.
Procedure
Step 1 On SwitchA, create VLANs and add interfaces to them.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 100 200 300
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 100
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 200
[SwitchA-GigabitEthernet0/0/2] quit
[SwitchA] interface gigabitethernet 0/0/3
[SwitchA-GigabitEthernet0/0/3] port link-type trunk
[SwitchA-GigabitEthernet0/0/3] port trunk allow-pass vlan 300
[SwitchA-GigabitEthernet0/0/3] quit
Step 2 On SwitchA, configure an IP address for each VLANIF interface.
[SwitchA] interface vlanif 100
[SwitchA-Vlanif100] ip address 10.1.10.2 24
[SwitchA-Vlanif100] quit
[SwitchA] interface vlanif 200
[SwitchA-Vlanif200] ip address 10.1.20.2 24
[SwitchA-Vlanif200] quit
[SwitchA] interface vlanif 300
[SwitchA-Vlanif300] ip address 10.1.30.2 24
[SwitchA-Vlanif300] quit
Step 3 On SwitchA, configure NQA test instances.
[SwitchA] nqa test-instance user test1
[SwitchA-nqa-user-test1] test-type icmp
[SwitchA-nqa-user-test1] destination-address ipv4 10.1.10.1
[SwitchA-nqa-user-test1] frequency 11
[SwitchA-nqa-user-test1] probe-count 2
[SwitchA-nqa-user-test1] interval seconds 5
[SwitchA-nqa-user-test1] timeout 4
[SwitchA-nqa-user-test1] start now
[SwitchA-nqa-user-test1] quit
[SwitchA] nqa test-instance user test2
[SwitchA-nqa-user-test2] test-type icmp
[SwitchA-nqa-user-test2] destination-address ipv4 10.1.20.1
[SwitchA-nqa-user-test2] frequency 11
[SwitchA-nqa-user-test2] probe-count 2
[SwitchA-nqa-user-test2] interval seconds 5
[SwitchA-nqa-user-test2] timeout 4
[SwitchA-nqa-user-test2] start now
[SwitchA-nqa-user-test2] quit
Step 4 Configure default static routes and bind them to the NQA test instances.
[SwitchA] ip route-static 0.0.0.0 0.0.0.0 10.1.10.1 track nqa user test1
[SwitchA] ip route-static 0.0.0.0 0.0.0.0 10.1.20.1 track nqa user test2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 55
Step 5 Verify the configuration.
# Check the configuration of NQA for default static routes. The command output
shows that the default static routes have been bound to NQA test instances.
[SwitchA] display current-configuration | include nqa
ip route-static 0.0.0.0 0.0.0.0 10.1.10.1 track nqa user test1
ip route-static 0.0.0.0 0.0.0.0 10.1.20.1 track nqa user test2
nqa test-instance user test1
nqa test-instance user test2
# Check NQA test results.
[SwitchA] display nqa results test-instance user test1
NQA entry(user, test1) :testflag is active ,testtype is icmp
1 . Test 10 result The test is finished
Send operation times: 2 Receive response times: 2
Completion:success RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:0
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:10.1.10.1
Min/Max/Average Completion Time: 30/30/30
Sum/Square-Sum Completion Time: 7/25
Last Good Probe Time: 2014-09-09 09:55:38.2
Lost packet ratio: 0 %
[SwitchA] display nqa results test-instance user test2
NQA entry(user, test2) :testflag is active ,testtype is icmp
1 . Test 11 result The test is finished
Send operation times: 2 Receive response times: 2
Completion:success RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:0
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:10.1.20.1
Min/Max/Average Completion Time: 30/30/30
Sum/Square-Sum Completion Time: 7/25
Last Good Probe Time: 2014-09-09 09:56:38.2
Lost packet ratio: 0 %
Completion:success and Lost packet ratio: 0 % in the command output show
that the links between SwitchA and RouterA and between SwitchA and RouterB
are normal.
# Check the routing table. The command output shows that there are two default
static routes destined for RouterA and RouterB, respectively.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 9 Routes : 10
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 RD 10.1.10.1 Vlanif100
Static 60 0 RD 10.1.20.1 Vlanif200
10.1.10.0/24 Direct 0 0 D 10.1.10.2 Vlanif100
10.1.10.2/32 Direct 0 0 D 127.0.0.1 Vlanif100
10.1.20.0/24 Direct 0 0 D 10.1.20.2 Vlanif200
10.1.20.2/32 Direct 0 0 D 127.0.0.1 Vlanif200
10.1.30.0/24 Direct 0 0 D 10.1.30.2 Vlanif300
10.1.30.2/32 Direct 0 0 D 127.0.0.1 Vlanif300
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 56
# Shut down GigabitEthernet0/0/2 on SwitchA to simulate a link fault.
[SwitchA] interface GigabitEthernet0/0/2
[SwitchA-GigabitEthernet0/0/2] shutdown
[SwitchA-GigabitEthernet0/0/2] quit
# Check NQA test results.
[SwitchA] display nqa results test-instance user test1
NQA entry(user, test1) :testflag is active ,testtype is icmp
1 . Test 12 result The test is finished
Send operation times: 2 Receive response times: 2
Completion:success RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:0
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:10.1.10.1
Min/Max/Average Completion Time: 30/30/30
Sum/Square-Sum Completion Time: 7/25
Last Good Probe Time: 2014-09-09 09:57:38.2
Lost packet ratio: 0 %
[SwitchA] display nqa results test-instance user test2
NQA entry(user, test2) :testflag is active ,testtype is icmp
1 . Test 13 result The test is finished
Send operation times: 2 Receive response times: 0
Completion:failed RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:2
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:10.1.20.1
Min/Max/Average Completion Time: 0/0/0
Sum/Square-Sum Completion Time: 0/0
Last Good Probe Time: 0000-00-00 00:00:00.0
Lost packet ratio: 100 %
Completion:failed and Lost packet ratio: 100 % in the command output show
that the link between SwitchA and RouterB is faulty.
# Check the routing table. Only the default static route to RouterA is available.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 7 Routes : 7
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 RD 10.1.10.1 Vlanif100
10.1.10.0/24 Direct 0 0 D 10.1.10.2 Vlanif100
10.1.10.2/32 Direct 0 0 D 127.0.0.1 Vlanif100
10.1.30.0/24 Direct 0 0 D 10.1.30.2 Vlanif300
10.1.30.2/32 Direct 0 0 D 127.0.0.1 Vlanif300
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
----End
Configuration Files
SwitchA configuration file
#
sysname SwitchA
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 57
vlan batch 100 200 300
#
interface Vlanif100
ip address 10.1.10.2 255.255.255.0
#
interface Vlanif200
ip address 10.1.20.2 255.255.255.0
#
interface Vlanif300
ip address 10.1.30.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 100
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 200
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 300
#
ip route-static 0.0.0.0 0.0.0.0 10.1.10.1 track nqa user test1
ip route-static 0.0.0.0 0.0.0.0 10.1.20.1 track nqa user test2
#
nqa test-instance user test1
test-type icmp
destination-address ipv4 10.1.10.1
frequency 11
interval seconds 5
timeout 4
probe-count 2
start now
#
nqa test-instance user test2
test-type icmp
destination-address ipv4 10.1.20.1
frequency 11
interval seconds 5
timeout 4
probe-count 2
start no
#
return
2.14.6 Example for Configuring NQA for IPv6 Static Routes
Networking Requirements
As shown in Figure 2-11, SwitchA on a company network is connected to two
egress routers (RouterA and RouterB) through two default static routes to
implement load balancing. The company wants to deploy a link failure detection
mechanism for the default static routes, so that traffic can be switched from a
faulty link to the other functioning link promptly to prevent services from being
interrupted.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 58
Figure 2-11 Configuring NQA for IPv6 static routes
Configuration Roadmap
1. Create VLANs, add interfaces to the VLANs, and configure IP addresses for
VLANIF interfaces, so that neighboring devices can communicate with each
other.
2. Create ICMP NQA test instances to monitor the status of links.
ICMP NQA test instances need to be created on the NQA client SwitchA to
detect the status of links between SwitchA and RouterA and between SwitchA
and RouterB.
3. Configure default static routes and bind them to the NQA test instances.
Default static routes destined for RouterA and RouterB need to be configured
on SwitchA and bound to NQA test instances. In this way, if an NQA test
instance detects a link failure, traffic is switched to the other link.
Procedure
Step 1 On SwitchA, create VLANs and add interfaces to them.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 100 200 300
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 100
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 200
[SwitchA-GigabitEthernet0/0/2] quit
[SwitchA] interface gigabitethernet 0/0/3
[SwitchA-GigabitEthernet0/0/3] port link-type trunk
[SwitchA-GigabitEthernet0/0/3] port trunk allow-pass vlan 300
[SwitchA-GigabitEthernet0/0/3] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 59
Step 2 On SwitchA, configure an IP address for each VLANIF interface.
[SwitchA] interface vlanif 100
[SwitchA-Vlanif100] ipv6 enable
[SwitchA-Vlanif100] ip address fc00:0:0:2001::2/64
[SwitchA-Vlanif100] quit
[SwitchA] interface vlanif 200
[SwitchA-Vlanif200] ipv6 enable
[SwitchA-Vlanif200] ip address fc00:0:0:2002::2/64
[SwitchA-Vlanif200] quit
[SwitchA] interface vlanif 300
[SwitchA-Vlanif300] ipv6 enable
[SwitchA-Vlanif300] ip address fc00:0:0:2003::2/64
[SwitchA-Vlanif300] quit
Step 3 On SwitchA, configure NQA test instances.
[SwitchA] nqa test-instance user test1
[SwitchA-nqa-user-test1] test-type icmp
[SwitchA-nqa-user-test1] destination-address ipv6 fc00:0:0:2001::1
[SwitchA-nqa-user-test1] frequency 11
[SwitchA-nqa-user-test1] probe-count 2
[SwitchA-nqa-user-test1] interval seconds 5
[SwitchA-nqa-user-test1] timeout 4
[SwitchA-nqa-user-test1] start now
[SwitchA-nqa-user-test1] quit
[SwitchA] nqa test-instance user test2
[SwitchA-nqa-user-test2] test-type icmp
[SwitchA-nqa-user-test2] destination-address ipv6 fc00:0:0:2002::1
[SwitchA-nqa-user-test2] frequency 11
[SwitchA-nqa-user-test2] probe-count 2
[SwitchA-nqa-user-test2] interval seconds 5
[SwitchA-nqa-user-test2] timeout 4
[SwitchA-nqa-user-test2] start now
[SwitchA-nqa-user-test2] quit
Step 4 Configure default static routes and bind them to the NQA test instances.
[SwitchA] ipv6 route-static :: 0 fc00:0:0:2001::1 track nqa user test1
[SwitchA] ipv6 route-static :: 0 fc00:0:0:2002::1 track nqa user test2
Step 5 Verify the configuration.
# Check the configuration of NQA for default static routes. The command output
shows that the default static routes have been bound to NQA test instances.
[SwitchA] display current-configuration | include nqa
ip route-static :: 0 fc00:0:0:2001::1 track nqa user test1
ip route-static :: 0 fc00:0:0:2002::1 track nqa user test2
nqa test-instance user test1
nqa test-instance user test2
# Check NQA test results.
[SwitchA] display nqa results test-instance user test1
NQA entry(user, test1) :testflag is active ,testtype is icmp
1 . Test 10 result The test is finished
Send operation times: 2 Receive response times: 2
Completion:success RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:0
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:FC00:0:0:2001::1
Min/Max/Average Completion Time: 30/30/30
Sum/Square-Sum Completion Time: 7/25
Last Good Probe Time: 2020-06-17 16:06:28.0
Lost packet ratio: 0 %
[SwitchA] display nqa results test-instance user test2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 60
NQA entry(user, test2) :testflag is active ,testtype is icmp
1 . Test 11 result The test is finished
Send operation times: 2 Receive response times: 2
Completion:success RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:0
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:FC00:0:0:2002::1
Min/Max/Average Completion Time: 30/30/30
Sum/Square-Sum Completion Time: 7/25
Last Good Probe Time: 2020-06-17 16:10:14.2
Lost packet ratio: 0 %
Completion:success and Lost packet ratio: 0 % in the command output show
that the links between SwitchA and RouterA and between SwitchA and RouterB
are normal.
# Check the routing table. The command output shows that there are two default
static routes destined for RouterA and RouterB, respectively.
[SwitchA] display ipv6 routing-table
Routing Table : Public
Destinations :9 Routes : 10
Destination : :: PrefixLength : 0
NextHop : FC00:0:0:2001::1 Preference : 60
Cost : 0 Protocol : Static
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif100 Flags : RD
Destination : :: PrefixLength : 0
NextHop : FC00:0:0:2002::1 Preference : 60
Cost : 0 Protocol : Static
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif200 Flags : RD
Destination : ::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : InLoopBack0 Flags : D
Destination : FC00:0:0:2001:: PrefixLength : 64
NextHop : FC00:0:0:2001::2 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif100 Flags : D
Destination : FC00:0:0:2001::2 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif100 Flags : D
Destination : FC00:0:0:2002:: PrefixLength : 64
NextHop : FC00:0:0:2002::2 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif200 Flags : D
Destination : FC00:0:0:2002::2 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif200 Flags : D
Destination : FC00:0:0:2003:: PrefixLength : 64
NextHop : FC00:0:0:2003::1 Preference : 0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 61
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif300 Flags : D
Destination : FC00:0:0:2003::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif300 Flags : D
Destination : FE80:: PrefixLength : 10
NextHop : :: Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : NULL0 Flags : D
# Shut down GigabitEthernet0/0/2 on SwitchA to simulate a link fault.
[SwitchA] interface GigabitEthernet0/0/2
[SwitchA-GigabitEthernet0/0/2] shutdown
[SwitchA-GigabitEthernet0/0/2] quit
# Check NQA test results.
[SwitchA] display nqa results test-instance user test1
NQA entry(user, test1) :testflag is active ,testtype is icmp
1 . Test 12 result The test is finished
Send operation times: 2 Receive response times: 2
Completion:success RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:0
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:FC00:0:0:2001::1
Min/Max/Average Completion Time: 30/30/30
Sum/Square-Sum Completion Time: 7/25
Last Good Probe Time: 2020-06-17 16:21:41.0
Lost packet ratio: 0 %
[SwitchA] display nqa results test-instance user test2
NQA entry(user, test2) :testflag is active ,testtype is icmp
1 . Test 13 result The test is finished
Send operation times: 2 Receive response times: 0
Completion:failed RTD OverThresholds number: 0
Attempts number:1 Drop operation number:0
Disconnect operation number:0 Operation timeout number:2
System busy operation number:0 Connection fail number:0
Operation sequence errors number:0 RTT Status errors number:0
Destination ip address:FC00:0:0:2002::1
Min/Max/Average Completion Time: 0/0/0
Sum/Square-Sum Completion Time: 0/0
Last Good Probe Time: 0000-00-00 00:00:00.0
Lost packet ratio: 100 %
Completion:failed and Lost packet ratio: 100 % in the command output show
that the link between SwitchA and RouterB is faulty.
# Check the routing table. Only the default static route to RouterA is available.
[SwitchA] display ipv6 routing-table
Routing Table : Public
Destinations :7 Routes : 7
Destination : :: PrefixLength : 0
NextHop : FC00:0:0:2001::1 Preference : 60
Cost : 0 Protocol : Static
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif100 Flags : RD
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 62
Destination : ::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : InLoopBack0 Flags : D
Destination : FC00:0:0:2001:: PrefixLength : 64
NextHop : FC00:0:0:2001::2 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif100 Flags : D
Destination : FC00:0:0:2001::2 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif100 Flags : D
Destination : FC00:0:0:2003:: PrefixLength : 64
NextHop : FC00:0:0:2003::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif300 Flags : D
Destination : FC00:0:0:2003::1 PrefixLength : 128
NextHop : ::1 Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : Vlanif300 Flags : D
Destination : FE80:: PrefixLength : 10
NextHop : :: Preference : 0
Cost : 0 Protocol : Direct
RelayNextHop : :: TunnelID : 0x0
Interface : NULL0 Flags : D
----End
Configuration Files
SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
vlan batch 100 200 300
#
interface Vlanif100
ipv6 enable
ipv6 address fc00:0:0:2001::2/64
#
interface Vlanif200
ipv6 enable
ipv6 address fc00:0:0:2002::2/64
#
interface Vlanif300
ipv6 enable
ipv6 address fc00:0:0:2003::2/64
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 100
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 200
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 63
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 300
#
ipv6 route-static :: 0 fc00:0:0:2001::1 track nqa user test1
ipv6 route-static :: 0 fc00:0:0:2002::1 track nqa user test2
#
nqa test-instance user test1
test-type icmp
destination-address ipv6 fc00:0:0:2001::1
frequency 11
interval seconds 5
timeout 4
probe-count 2
start now
#
nqa test-instance user test2
test-type icmp
destination-address ipv6 fc00:0:0:2002::1
frequency 11
interval seconds 5
timeout 4
probe-count 2
start now
#
return
2.14.7 Example for Configuring EFM for Static IPv4 Routes
Networking Requirements
In Figure 2-12, SwitchA connects to the NMS across a network segment through
SwitchB. SwitchA communicates with the NMS using static routes. SwitchA and
SwitchB need to detect the link quality in real time. When the link between them
becomes faulty, the corresponding static route will be deleted from the IP routing
table. Traffic is then switched from the route using the faulty link to a working
route to improve network reliability.
Figure 2-12 Configuring EFM for IPv4 static routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable Ethernet in the First Mile (EFM) OAM globally and on interfaces of
SwitchA and SwitchB to implement real-time link quality detection.
2. Configure an IPv4 static route from SwitchA to the NMS and bind the static
route to the EFM state to associate the static route with EFM. When a link
where the static route resides becomes faulty, traffic is switched to a route
without link faults.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 64
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs.
# Configure SwitchA. The configuration of SwitchB is similar to that of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Configure IP addresses for VLANIF interfaces.
# Configure SwitchA. The configuration of SwitchB is similar to that of SwitchA.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure an EFM session between SwitchA and SwitchB.
# Enable EFM OAM on SwitchA.
[SwitchA] efm enable
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] efm enable
[SwitchA-GigabitEthernet0/0/1] quit
# Enable EFM OAM on SwitchB.
[SwitchB] efm enable
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] efm enable
[SwitchB-GigabitEthernet0/0/1] quit
Step 4 Configure a static route and bind it to the EFM state.
# Configure a static route from SwitchA to an external network and bind it to the
EFM state of GigabitEthernet0/0/1.
[SwitchA] ip route-static 192.168.2.0 24 192.168.1.2 track efm-state gigabitethernet0/0/1
Step 5 Verify the configuration.
# After the configuration is complete, run the display efm session all command
on SwitchA and SwitchB. The command output shows that an EFM session has
been set up and is in detect mode. That is, the interface is in handshake state. The
following uses the display on SwitchA as an example.
[SwitchA] display efm session all
Interface EFM State Loopback Timeout
----------------------------------------------------------------------
GigabitEthernet0/0/1 detect --
# Check the IP routing table on SwitchA. The IP routing table contains the static
route 192.168.2.0/24.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 5 Routes : 5
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 65
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.2.0/24 Static 60 0 RD 192.168.1.2 Vlanif10
# Run the undo efm enable command in the view of GigabitEthernet0/0/1 on
SwitchB to simulate a link fault.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] undo efm enable
# Run the display efm session all command on SwitchA. The command output
shows that the EFM OAM protocol state is discovery, indicating that the interface
is in OAM discovery state.
[SwitchA] display efm session all
Interface EFM State Loopback Timeout
----------------------------------------------------------------------
GigabitEthernet0/0/1 discovery --
# Check the IP routing table on SwitchA. The IP routing table does not contain the
static route 192.168.2.0/24. This is because the static route has been bound to the
EFM state, and EFM OAM rapidly notifies SwitchA that the static route becomes
unavailable after detecting a link fault.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 4 Routes : 4
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
# Run the efm enable command in the view of GigabitEthernet0/0/1 on SwitchB
to simulate link recovery.
[SwitchB-GigabitEthernet0/0/1]efm enable
# Run the display efm session all command on SwitchA. The command output
shows that the EFM OAM protocol state is detect, indicating that the interface is
in handshake state again.
[SwitchA] display efm session all
Interface EFM State Loopback Timeout
----------------------------------------------------------------------
GigabitEthernet0/0/1 detect --
# Check the IP routing table on SwitchA. The IP routing table contains the static
route 192.168.2.0/24 again. This is because EFM OAM rapidly notifies that the
bound static route becomes reachable again after detecting link recovery.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 5 Routes : 5
Destination/Mask Proto Pre Cost Flags NextHop Interface
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 66
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.2.0/24 Static 60 0 RD 192.168.1.2 Vlanif10
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
efm enable
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
efm enable
#
ip route-static 192.168.2.0 255.255.255.0 192.168.1.2 track efm-state GigabitEthernet0/0/1
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 20
#
efm enable
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif20
ip address 192.168.2.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
efm enable
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
2.14.8 Example for Configuring Association Between IPv4
Static Routes and a Route Monitoring Group
Networking Requirements
On a company's network shown in Figure 2-13, SwitchC at the access layer
connects to SwitchB and SwitchD at the aggregation layer through static routes.
SwitchB and SwitchD work in redundancy mode. The customer requirements are
as follows:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 67
● A link failure detection mechanism is deployed for static routes, so that traffic
can be switched from a faulty link to a normal link in a timely manner to
prevent service interruption for a long time.
● In normal situations, service traffic from the access side is forwarded to the IP
network through SwitchB.
● If the link between SwitchB and SwitchA fails, only the link between SwitchD
and the IP network is available. In this case, service traffic from the access
side is switched to SwitchD to prevent traffic loss.
Figure 2-13 Configuring association between IPv4 static routes and a route
monitoring group
Device Name Interface IP Address
SwitchA
VLANIF 10 192.168.10.1/24
VLANIF 20 192.168.20.1/24
VLANIF 100 192.168.100.1/24
SwitchB
VLANIF 10 192.168.10.2/24
VLANIF 40 192.168.40.1/24
SwitchC VLANIF 30 192.168.30.2/24
VLANIF 40 192.168.40.2/24
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 68
Device Name Interface IP Address
VLANIF 50 192.168.50.1/24
SwitchD VLANIF 20 192.168.20.2/24
VLANIF 30 192.168.30.1/24
Configuration Roadmap
The configuration roadmap is as follows:
1. Create VLANs, add interfaces to the VLANs, and configure IP addresses for
VLANIF interfaces, so that neighboring devices can communicate with each
other.
2. Configure static routes and bind them to a route monitoring group. On
SwitchC, configure static routes, set a low cost for the route corresponding to
the active link, and bind the static routes to a route monitoring group. In this
way, the links can work in active/standby mode, and IPv4 static routes are
associated with the route monitoring group.
Procedure
1. Configure VLANs to which interfaces belong.
# Configure SwitchC. The configurations of other devices are similar to those
of SwitchC.
<HUAWEI> system-view
[HUAWEI] sysname SwitchC
[SwitchC] vlan batch 30 40 50
[SwitchC] interface gigabitethernet 0/0/1
[SwitchC-gigabitethernet0/0/1] port link-type trunk
[SwitchC-gigabitethernet0/0/1] port trunk allow-pass vlan 30
[SwitchC-gigabitethernet0/0/1] quit
[SwitchC] interface gigabitethernet 0/0/2
[SwitchC-gigabitethernet0/0/2] port link-type trunk
[SwitchC-gigabitethernet0/0/2] port trunk allow-pass vlan 40
[SwitchC-gigabitethernet0/0/2] quit
[SwitchC] interface gigabitethernet 0/0/3
[SwitchC-gigabitethernet0/0/3] port link-type trunk
[SwitchC-gigabitethernet0/0/3] port trunk allow-pass vlan 50
[SwitchC-gigabitethernet0/0/3] quit
2. Configure an IP address for each VLANIF interface.
# Configure SwitchC. The configurations of other devices are similar to those
of SwitchC.
[SwitchC] interface vlanif 30
[SwitchC-Vlanif10] ip address 192.168.30.2 24
[SwitchC-Vlanif10] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] ip address 192.168.40.2 24
[SwitchC-Vlanif40] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] ip address 192.168.50.1 24
[SwitchC-Vlanif50] quit
3. Configure static routes and bind them to a route monitoring group.
# On SwitchC, create the route monitoring group uplink.
[SwitchC] ip route-monitor-group uplink
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 69
# On SwitchC, add routes to be monitored to the route monitoring group
uplink.
[SwitchC-route-monitor-group-uplink] track ip route 192.168.100.0 255.255.255.0
# On SwitchC, enable the route monitoring group.
[SwitchC-route-monitor-group-uplink] monitor enable
[SwitchC-route-monitor-group-uplink] quit
# On SwitchC, configure static routes to the external network and bind the
static routes to the route monitoring group uplink.
[SwitchC] ip route-static 0.0.0.0 0.0.0.0 192.168.40.1 preference 50 track route-monitor-group
uplink
[SwitchC] ip route-static 0.0.0.0 0.0.0.0 192.168.30.1
# On SwitchB, configure a static route to Client1.
<HUAWEI> system-view
[HUAWEI] sysname SwitchB
[SwitchB] ip route-static 192.168.50.0 255.255.255.0 192.168.40.2
# On SwitchD, configure a static route to Client1.
<HUAWEI> system-view
[HUAWEI] sysname SwitchD
[SwitchD] ip route-static 192.168.50.0 255.255.255.0 192.168.30.2
4. Verify the configuration.
# Check information about the route monitoring group uplink on SwitchC.
The command output shows that the route monitoring group has been
enabled and the route to 192.168.100.0/24 is an active route.
[SwitchC] display ip route-monitor-group uplink
route monitor group uplink
State : Enabled
-------------------------------------------------------
route monitor group tracking route number : 1
-------------------------------------------------------
VPN name : Public
Destination : 192.168.100.0
Mask : 255.255.255.0
State : Active
# Check information about static routes on SwitchC to determine the active
and standby links.
[SwitchC] display ip routing-table protocol static
Route Flags: R - relay, D - download to fib, T - to vpn-
instance
------------------------------------------------------------------------------
Public routing table : Static
Destinations : 1 Routes : 2 Configured Routes : 6
Static routing table status : <Active>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 50 0 D 192.168.40.1 Vlanif40
Static routing table status : <Inactive>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 192.168.30.1 Vlanif30
# Disable gigabitethernet0/0/1 on SwitchB to simulate a link failure.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-gigabitethernet0/0/1] shutdown
[SwitchB-gigabitethernet0/0/1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 70
# Check information about the route monitoring group uplink on SwitchC.
The command output shows that the route status corresponding to the faulty
link is Inactive.
[SwitchC] display ip route-monitor-group uplink
route monitor group uplink
State : Enabled
-------------------------------------------------------
route monitor group tracking route number : 1
-------------------------------------------------------
VPN name : Public
Destination : 192.168.100.0
Mask : 255.255.255.0
State : Inactive
# Check information about static routes on SwitchC. The command output
shows that static routes on SwitchC have been bound to a route monitoring
group. If the route monitoring group detects a link failure, the RM module
immediately notifies the access device that the corresponding route is
unavailable.
[SwitchC] display ip routing-table protocol static
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Public routing table : Static
Destinations : 1 Routes : 2 Configured Routes : 6
Static routing table status : <Active>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 60 0 D 192.168.30.1 Vlanif40
Static routing table status : <Inactive>
Destinations : 1 Routes : 1
Destination/Mask Proto Pre Cost Flags NextHop Interface
0.0.0.0/0 Static 50 0 192.168.40.1 Vlanif30
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20 100
#
interface Vlanif10
ip address 192.168.100.1 255.255.255.0
#
interface Vlanif20
ip address 192.168.20.1 255.255.255.0
#
interface Vlanif100
ip address 192.168.100.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/3
port link-type trunk
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 71
port trunk allow-pass vlan 100
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 40
#
interface Vlanif10
ip address 192.168.10.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.40.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
ip route-static 192.168.50.0 255.255.255.0 192.168.40.2
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 30 40 50
#
interface Vlanif30
ip address 192.168.30.2 255.255.255.0
#
interface Vlanif40
ip address 192.168.40.2 255.255.255.0
#
interface Vlanif50
ip address 192.168.50.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
ip route-monitor-group uplink
track ip route 192.168.100.0 255.255.255.0
monitor enable
#
ip route-static 0.0.0.0 0.0.0.0 192.168.40.1 preference 50 track route-monitor-group uplink
ip route-static 0.0.0.0 0.0.0.0 192.168.30.1
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 20 30
#
interface Vlanif20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 72
ip address 192.168.20.2 255.255.255.0
#
interface Vlanif30
ip address 192.168.30.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
ip route-static 192.168.50.0 255.255.255.0 192.168.30.2
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 2 Static Route Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 73
3 RIP Configuration
3.1 Overview of RIP
3.2 Understanding RIP
3.3 Summary of RIP Configuration Tasks
3.4 Licensing Requirements and Limitations for RIP
3.5 Default Settings for RIP
3.6 Configuring Basic RIP Functions
3.7 Configuring RIP-2
3.8 Preventing Routing Loops
3.9 Controlling RIP Routing
3.10 Controlling RIP Route Advertisement
3.11 Controlling Receiving of RIP Routing Information
3.12 Improving RIP Network Performance
3.13 Configuring BFD for RIP
3.14 Configuring the Network Management Function for RIP
3.15 Maintaining RIP
3.16 Configuration Examples for RIP
3.17 Troubleshooting RIP
3.1 Overview of RIP
Definition
RIP is a distance-vector protocol that uses hop count to measure the distance to a
destination. It is a simple Interior Gateway Protocol (IGP) that is easier to
implement, configure, and manage than other routing protocols such as OSPF and
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 74
IS-IS. RIP exchanges routing information using UDP packets through UDP port
520.
Two RIP versions are used in IPv4 networks: RIP version 1 (RIP-1) and RIP version
2 (RIP-2). RIP-2 is an extension to RIP-1.
Purpose
RIP is widely used on small-sized networks to discover routes and generate routing
information. It is not suitable for complex or large-sized networks.
3.2 Understanding RIP
3.2.1 RIP Fundamentals
RIP Routing Table
When RIP starts on a switch, the RIP routing table on the switch contains only
direct routes. Neighboring switches on different network segments can
communicate with each other only after they learn routing entries from each
other.
Figure 3-1 shows the process of generating a RIP routing table.
Figure 3-1 RIP routing table generation
1. RIP starts on SwitchA and SwitchB.
2. SwitchA broadcasts a Request packet to neighboring routers.
3. SwitchB receives the Request packet, encapsulates its RIP routing table into a
Response packet, and then broadcasts the Response packet to the network
segment connected to the interface that received the Request packet.
4. SwitchA receives the Response packet and then generates its RIP routing table
based on this packet.
RIP updates and selects routes through route advertisements. In this situation,
switches do not know the entire network topology and just know the distances to
destination networks and the direction or interface used to reach destination
networks. In Figure 3-2, SwitchB receives a route advertisement from SwitchA and
knows that it can reach the network 192.168.1.0/24 through SwitchA with the hop
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 75
count 1. Even though information contained in this advertisement becomes
incorrect, SwitchB still considers that it can reach the network 192.168.1.0/24
through SwitchA with the hop count 1. This is the root cause for routing loops on
a RIP network.
Figure 3-2 RIP route update and selection based on route advertisements
RIP Metric
In RIP, the default hop count from a device to its directly connected network is 0,
and the hop count from a device to a reachable network through another device is
1. That is, the hop count (the metric) equals the number of devices along the path
from the local network to the destination network.
In Figure 3-3, S1 has two paths to the network segment 192.168.10.0/24:
● One path is S1-S2-S5, passing through two devices: S2 and S5. It has a hop
count of 2 and bandwidth of 1.544 Mbit/s.
● The other path is S1-S3-S4-S5, passing through three devices: S3, S4, and S5.
It has a hop count of 3 and bandwidth of 1 Gbit/s.
Figure 3-3 RIP metric
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 76
As required by the RIP metric standards, packets will be forwarded along the path
passing through S2; however, the link bandwidth of this path is not the highest.
This causes low bandwidth efficiency on the RIP network and hinders QoS
management.
To prevent the hop count from becoming infinite when RIP routes are flooded
indefinitely on the network, and to limit the convergence time, RIP allows a
maximum of 15 hops. A hop count of 16 or greater is defined as infinity, making
the destination network or host unreachable. This design limits the network scale
that RIP supports. Therefore, RIP is not suitable for large-scale networks.
RIP Route Update and Maintenance
RIP uses three timers to update and maintain routing information:
● Update timer
When this timer expires, a RIP device immediately sends an Update packet.
● Age timer
If a RIP device does not receive any Update packet of a route from a neighbor
within the Age timer, the RIP device considers this route unreachable.
● Garbage-collect timer
If a RIP device does not receive any Update packet of an unreachable route
within the Garbage-collect timer, the device deletes this route from its RIP
routing table.
The interval for sending Update packets is determined by the Update timer, which
is 30 seconds by default.
Each routing entry has two timers: Age timer and Garbage-collect timer. When a
RIP device adds a learned route to the local RIP routing table, the Age timer starts
for the route. If the RIP device does not receive an Update packet from the
neighbor within the aging time, the RIP device sets the Cost value of the route to
16 (unreachable) and starts the Garbage-collect timer. If the RIP device still does
not receive any Update packet before the Garbage-collect timer expires, the RIP
device deletes the route from the RIP routing table.
Triggered Route Update
When routing information changes, a device immediately sends an Update packet
to its neighbors without waiting for the Update timer to expire. This function
prevents routing loops.
Figure 3-4 shows the process of triggering a route update.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 77
Figure 3-4 Triggered route update
SwitchC first learns that network 10.4.0.0 becomes unreachable.
If SwitchC does not support triggered route update when detecting a network
fault, it must wait until the Update timer expires. Before this timer expires, if
SwitchC receives an Update packet from SwitchB, it learns an incorrect route to
network 10.4.0.0. In this case, SwitchB and SwitchC are each other's next hop to
network 10.4.0.0. This results in a routing loop.
If SwitchC supports triggered route update when detecting a network fault, it
immediately sends to SwitchB an Update packet, preventing a routing loop.
3.2.2 RIP-2 Enhanced Features
RIP has two versions: RIP-1 and RIP-2. RIP-2 is an extension to RIP-1.
Comparison Between RIP-1 and RIP-2
RIP-1 is a classful routing protocol, whereas RIP-2 is a classless routing protocol. In
RIP-1, protocol packets can be advertised only in broadcast mode. Because RIP-1
packets do not carry any mask information, they identify only the routes of
natural network segments (Class A, Class B, and Class C). Therefore, RIP-1 does
not support route summarization or discontiguous subnets.
Figure 3-5 and Figure 3-6 show the RIP-1 and RIP-2 packet formats.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 78
Figure 3-5 RIP-1 packet format
Figure 3-6 RIP-2 packet format
RIP-2 has the following advantages over RIP-1:
● Supports route tag and can flexibly control routes based on the tag in routing
policies.
● Supports mask information and can therefore support route summarization
and Classless Inter-Domain Routing (CIDR).
● Supports a next-hop address and can select the optimal next-hop address on
broadcast networks.
● Supports the sending of update packets in multicast mode. Only RIP-2 devices
can receive RIP-2 packets, saving resources.
● Provides packet authentication to enhance security.
RIP-2 Route Summarization
When different subnet routes within the same natural network segment are
transmitted to other network segments, these routes are summarized into one
route of the same network segment. This process is called route summarization.
RIP-2 route summarization improves scalability and efficiency and reduces the size
of the routing table for large networks.
RIP-2 route summarization is classified into two types:
● RIP process-based classful summarization
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 79
Summarized routes are advertised using natural masks. For example, route
10.1.1.0/24 (metric=2) and route 10.1.2.0/24 (metric=3) are summarized as
one route 10.0.0.0/8 (metric=2) in the natural network segment. RIP-2
supports classful summarization to obtain the optimal metric.
● Interface-based summarization
You can specify a summarized address. For example, configure route
10.1.0.0/16 (metric=2) on an interface as the summarized route of route
10.1.1.0/24 (metric=2) and route 10.1.2.0/24 (metric=3).
3.2.3 Split Horizon and Poison Reverse
Split Horizon
Split horizon prevents a route learned by RIP on an interface from being sent to
neighbors through this interface. This function reduces bandwidth consumption
and avoids routing loops.
Split horizon provides two models for different networks:
● Interface-based split horizon
● Neighbor-based split horizon
Interface-based split horizon is used on broadcast, point-to-point (P2P), and point-
to-multipoint (P2MP) networks.
Figure 3-7 illustrates interface-based split horizon.
Figure 3-7 Interface-based split horizon
RouterA sends routing information destined for 10.0.0.0/8 to RouterB. If split
horizon is not configured, RouterB sends the route learned from RouterA back to
RouterA. Therefore, RouterA learns two routes destined for 10.0.0.0/8: a direct
route with hop count 0 and a route with the next hop RouterB and hop count 2.
However, only the direct route in the RIP routing table of RouterA is active. If the
route from RouterA to network 10.0.0.0 becomes unreachable, RouterB does not
receive the route unreachable message immediately and continues to notify
RouterA that network 10.0.0.0/8 is reachable.
Therefore, RouterA receives incorrect routing information and considers that
network 10.0.0.0/8 is reachable through RouterB, and RouterB considers that
network 10.0.0.0/8 is reachable through RouterA, resulting in a routing loop.
Using the split horizon function, RouterB does not send the route destined for
10.0.0.0/8 back to RouterA, avoiding a routing loop.
On a Non-Broadcast Multiple Access (NBMA) network, an interface connects to
multiple neighbors; therefore, neighbor-based split horizon is used, as shown in
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 80
Figure 3-8. Routes are advertised in unicast mode and the routes received by an
interface are differentiated by neighbors. The route learned from a neighbor will
not be sent back through the same interface.
Figure 3-8 Neighbor-based split horizon
RouterA sends route 172.16.0.0/16 learned from RouterB to RouterC, but does not
send it back to RouterB.
Poison Reverse
Poison reverse enables RIP to set the cost of the route learned through a local
interface from a neighbor to 16 (unreachable) and then send this route through
the same interface back to the neighbor. This function deletes invalid routes from
the neighbor's routing table and prevents routing loops.
In Figure 3-9, after receiving a route from RouterA, RouterB sends a route
unreachable message (with the route cost set to 16) to RouterA, avoiding a
routing loop.
Figure 3-9 Poison reverse
3.2.4 Multi-Process and Multi-Instance
The multi-process feature associates a RIP process with multiple interfaces. This
ensures that a specific process performs all the protocol-related operations only on
designated interfaces. In this situation, multiple RIP processes can run on a device
independently. Route exchange between these RIP processes is similar to route
exchange between different routing protocols.
RIP multi-instance associates a VPN instance with a RIP process so that the VPN
instance can be associated with all the interfaces in this RIP process.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 81
3.2.5 BFD for RIP
Bidirectional Forwarding Detection (BFD) detects faults on links between
neighboring routers. It is often associated with routing protocols so that these
protocols can be notified of link faults in order to quickly trigger route
convergence. Traffic loss caused by topology changes is therefore minimized. After
RIP is associated with BFD, BFD rapidly detects link faults and reports the faults to
RIP. This ensures that RIP quickly responds to network topology changes.
Table 3-1 lists link fault detection mechanisms and the convergence speed before
and after BFD for RIP is enabled.
Table 3-1 BFD speeds up convergence
BFD for RIP Link Fault Detection Mechanism Convergence
Speed
Disabled The RIP Age timer expires. By default,
this timer is 180 seconds.
> 180 seconds
Enabled The BFD session goes Down. < 30 seconds
Implementation
BFD is classified into static BFD and dynamic BFD:
● Static BFD
BFD session setup is manually triggered, and BFD session parameters
(including local and remote discriminators) are manually configured using
commands. A device can implement static BFD even if the peer device does
not support BFD.
● Dynamic BFD
BFD session setup is dynamically triggered by routing protocols. The local
discriminator is dynamically allocated and the remote discriminator is
obtained from the BFD packet of the peer device. Therefore, dynamic BFD is
more flexible than static BFD. After establishing a new neighbor relationship,
a routing protocol notifies BFD of the neighbor parameters (including
destination and source addresses), and then BFD sets up a session based on
the received parameters. When a link fault occurs, the routing protocol
quickly detects that the BFD session is Down and switches traffic to the
backup link, minimizing data loss.
Application
After BFD for RIP is enabled, BFD reports link faults to RIP within several
milliseconds. A RIP router then deletes the route of the faulty link from its RIP
routing table and starts the backup link.
Figure 3-10 illustrates the BFD for RIP process.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 82
Figure 3-10 BFD for RIP
RouterA, RouterB, RouterC, and RouterD establish RIP neighbor relationships.
RouterB is the next hop of the route from RouterA to RouterD. A dynamic BFD
session is set up between RouterA and RouterB, and dynamic BFD for RIP is
enabled on RouterA and RouterB.
When the link between RouterA and RouterB becomes faulty, BFD quickly detects
the fault and notifies RouterA of the fault. RouterA deletes the route with RouterB
as the next hop from its RIP routing table, and then recalculates a route. The new
route passes through RouterC and RouterB to reach RouterD.
When the link between RouterA and RouterB recovers, a dynamic BFD session is
set up again between RouterA and RouterB. RouterA receives routing information
from RouterB and selects the optimal route for packet forwarding.
3.2.6 Hot Standby
The RIP hot standby feature is supported by devices with distributed architecture.
During hot standby, a device backs up RIP data from the active main board (AMB)
to the standby main board (SMB). When the AMB becomes faulty, the SMB
becomes active and takes over AMB tasks. This ensures normal data forwarding.
3.3 Summary of RIP Configuration Tasks
Table 3-2 describes RIP configuration tasks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 83
Table 3-2 RIP configuration tasks
Scenario Description Task
Configuring basic RIP
functions
Basic RIP functions
include enabling RIP,
specifying the network
segment where RIP runs,
and specifying the RIP
version. The basic RIP
functions must be
configured before you
use RIP features.
3.6 Configuring Basic
RIP Functions
Configuring RIP-2
features
RIP-2 is a classless
routing protocol, and
RIP-2 packets carry
subnet masks. Therefore,
deploying a RIP-2
network can save IP
addresses. Only RIP-2
can be deployed on a
network where IP
addresses are
discontinuous, and RIP-1
cannot be used.
RIP-2 supports
authentication for
protocol packets and
provides multiple
authentication modes to
enhance security.
3.7 Configuring RIP-2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 84
Scenario Description Task
Preventing routing loops RIP is a distance-vector
routing protocol. RIP
devices advertise their
local routing tables to
neighbors, so routing
loops may occur.
RIP uses split horizon
and poison reverse to
prevent routing loops:
● Split horizon: A route
learnt by RIP through
an interface is not
sent to neighbors
through the interface.
This saves bandwidth
and prevents routing
loops.
● Poison reverse: RIP
sets the cost of a
route learnt through
an interface to 16
(unreachable), and
sends the route to
neighbors through the
interface. In this way,
RIP deletes useless
routes from the
neighbor's routing
table and prevents
routing loops.
3.8 Preventing Routing
Loops
Controlling RIP routing To use RIP more flexibly
on the existing network
and meet various user
requirements, you can
configure different
parameters to control
RIP routing.
3.9 Controlling RIP
Routing
Controlling the
advertising and receiving
of RIP routes
To meet network
requirements, you can
configure different
parameters to accurately
control the advertising
and receiving of RIP
routes.
3.10 Controlling RIP
Route Advertisement
3.11 Controlling
Receiving of RIP
Routing Information
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 85
Scenario Description Task
Improving RIP network
performance
The following are ways
of improving RIP
network performance:
● Adjust the RIP timer
to change the RIP
network convergence
rate.
● Adjust the number
and interval of
Update packets sent
by an interface to
save device resources
and network
bandwidth.
● Enable the replay-
protect function to
ensure normal
communication
between neighboring
devices after a RIP
process restarts.
● Check packet validity
to ensure high
network security.
3.12 Improving RIP
Network Performance
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 86
Scenario Description Task
Configuring BFD for RIP RIP maintains neighbor
relationships by
periodically sending and
receiving Update
packets. If a device does
not receive any Update
packet from a neighbor
within the aging time, it
considers the neighbor
Down. The default value
of the aging timer is 180
seconds, so RIP can
detect a link fault only
after 180 seconds. If
high-speed data services
are deployed on the
network, a large amount
of data will be lost in
this period.
BFD provides the
millisecond-level fault
detection mechanism. It
can rapidly detect faults
on the protected links or
nodes, and report the
faults to RIP. BFD
improves the RIP
process's response to
network topology
changes, which
implements fast
convergence of RIP
routes.
3.13 Configuring BFD
for RIP
Configuring the network
management function
for RIP
By binding RIP to the
MIB, you can view RIP
information and
configure RIP through
the NMS.
3.14 Configuring the
Network Management
Function for RIP
3.4 Licensing Requirements and Limitations for RIP
Involved Network Elements
Other network elements are required to support RIP.
Licensing Requirements
RIP is a basic feature of a switch and is not under license control.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 87
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support RIP.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
Feature Limitations
When the maximum number of RIP routes supported by a switch is fixed, the
maximum number of running RIP routes supported on the switch is limited by the
CAR value of RIP protocol packets, interval for sending RIP update packets, and
values of RIP Age and Garbage-collect timers. To increase the maximum number
of running RIP routes on a switch if there are large numbers of RIP routes running
on the network, increase the values of the Age timer, Garbage-collect timer, or
CAR for RIP protocol packets, as well as reducing the interval for sending RIP
update packets.
3.5 Default Settings for RIP
Table 3-3 describes the default settings for RIP.
Table 3-3 Default settings for RIP
Parameter Default Setting
Maximum number of equal-cost
routes
By default, the maximum number of
equal-cost routes on the S5720I-SI,
S5735-S, S5735-S-I, S5735S-H,
S6720S-S, and S5736-S is 8, and the
maximum number of equal-cost
routes on the S5731-H, S5731-S,
S5731S-H, S5731S-S, S5732-H, S6735-
S, S6730-H, S6730S-H, S6730-S, and
S6730S-S is 16.
RIP function Disabled
Split horizon Enabled
3.6 Configuring Basic RIP Functions
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 88
Pre-configuration Tasks
Before configuring basic RIP functions, configure IP addresses for interfaces to
ensure network-layer communication between neighbor nodes.
Configuration Procedure
You must enable RIP before specifying the network segment where RIP runs and
configuring RIP neighbors and RIP version on an NBMA network.
3.6.1 Enabling RIP
Context
You must enable RIP before performing any RIP configurations. RIP command
configurations in the interface view take effect only after RIP is enabled.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ] [ vpn-instance
vpn-instance-name ]
RIP is enabled, a RIP process is created, and the RIP view is displayed.
If a VPN instance is specified, the RIP process belongs to this VPN instance. If no
VPN instance is specified, the RIP process belongs to a public network instance.
Step 3 (Optional) Run description
text
A description is configured for the RIP process.
----End
3.6.2 Enabling RIP on the Specified Network Segment
Context
After enabling RIP, specify the network segment where RIP runs. RIP runs only on
the interfaces that reside on the specified network segment. RIP does not receive,
send, or forward routes on the interfaces that do not reside on the specified
network segment.
Procedure
● Enable RIP to send and receive routes on the specified network segment.
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 89
c. (Optional) Run undo verify-source
Source check is disabled for RIP packets.
If IP addresses of devices on both ends of a P2P link belong to different
network segments, the two devices cannot establish a neighbor
relationship unless source check is disabled.
d. Run network
network-address
RIP is enabled on the specified network segment.
NOTE
●
network-address specifies the address of a natural network segment.
● An interface can be associated with only one RIP process.
----End
3.6.3 (Optional) Configuring RIP Neighbors on an NBMA
Network
Context
RIP often uses a broadcast or multicast address to send packets. If the link running
RIP does not support broadcast or multicast packets, specify RIP neighbors on
both ends of the link. This allows packets to be sent between the two ends in
unicast mode.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run peer
ip-address
A RIP neighbor is configured.
----End
3.6.4 (Optional) Configuring the RIP Version
Context
RIP versions include RIP-1 and RIP-2. The RIP version must be configured on the
device running RIP. Configure the global RIP version unless you need to specify a
different RIP version on an interface.
Procedure
● Configure the global RIP version.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 90
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Run version { 1 | 2 }
The global RIP version is configured.
NOTE
By default, an interface sends only RIP-1 packets and receives both RIP-1 and
RIP-2 packets.
● Configure the RIP version on an interface.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run rip version { 1 | 2 [ broadcast | multicast ] }
The RIP version is configured on the interface.
NOTE
● By default, an interface sends only RIP-1 packets and receives both RIP-1 and
RIP-2 packets.
● If no RIP version is configured in the interface view, the global RIP version is
used. The RIP version configured on an interface takes precedence over the
global RIP version.
----End
3.6.5 Verifying the Basic RIP Function Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id route command to view all the RIP routes
learned from other devices.
● Run the display default-parameter rip command to view default RIP
configuration.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 91
● Run the display rip
process-id statistics interface { all |
interface-type
interface-number [ verbose | neighbor
neighbor-ip-address ] } command to
view statistics on RIP interfaces.
----End
3.7 Configuring RIP-2
Pre-configuration Tasks
Before configuring RIP-2, configure basic RIP functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP-2 Configuration) in any sequence.
3.7.1 Configuring RIP-2 Route Summarization
Context
A large RIP network requires significant device memory to maintain large RIP
routing tables. Transmitting and processing routing information requires large
amounts of network resources. Route summarization can reduce the routing table
size and minimize impact of route flapping on a network.
RIP-2 supports automatic summarization and manual summarization. Manual
summarization takes precedence over automatic summarization. To advertise all
subnet routes, disable automatic route summarization.
NOTE
By default, if split horizon or poison reverse has been configured, classful route
summarization becomes invalid. When summarized routes are sent to the natural network
segment border, split horizon or poison reverse must be disabled.
Procedure
● Configure RIP-2 automatic route summarization.
a. Run the system-view command to enter the system view.
b. Run the rip [
process-id ] command to enter the RIP view.
c. Run the version 2 command to set the RIP version to RIP-2.
d. Run the summary command to enable RIP-2 automatic route
summarization.
e. (Optional) Run the summary always command to enable RIP-2
automatic route summarization regardless of whether split horizon and
poison reverse are enabled.
NOTE
The summary command is used in the RIP view to enable RIP-2 classful network-
based route summarization.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 92
● Configure RIP-2 manual route summarization.
a. Run the system-view command to enter the system view.
b. Run the interface
interface-type interface-number command to enter the
interface view.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run the rip summary-address
ip-address mask [ avoid-feedback ]
command to configure RIP-2 to advertise the summarized local IP
address.
NOTE
The rip summary-address
ip-address mask [ avoid-feedback ] command is used
in the interface view to enable RIP-2 classless network-based route
summarization.
----End
3.7.2 Configuring RIP-2 Packet Authentication
Context
Configure RIP-2 packet authentication on a RIP network requiring high security.
RIP-2 supports simple authentication, MD5 authentication, and HMAC-SHA256
ciphertext authentication for protocol packets to enhance security. In simple
authentication, a plaintext authentication key is used. Therefore, simple
authentication has low security.
NOTICE
If plain is selected during the configuration of RIP-2 packet authentication, the
password is saved in the configuration file in plain text. This brings security risks. It
is recommended that you select cipher to save the password in cipher text.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 93
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Configure RIP-2 packet authentication.
● Run the rip authentication-mode simple { plain
plain-text | [ cipher ]
password-key } command to set RIP-2 packet authentication to simple
authentication.
● Run one of the following commands to set RIP-2 packet authentication to
MD5 authentication.
– rip authentication-mode md5 usual { plain
plain-text | [ cipher ]
password-key }
– rip authentication-mode md5 nonstandard { keychain
keychain-name |
{ plain
plain-text | [ cipher ]
password-key }
key-id }
NOTICE
Simple authentication and MD5 authentication have potential security risks.
HMAC-SHA256 ciphertext authentication is recommended.
If MD5 authentication is used, you must set the packet format for MD5
authentication. If the usual keyword is specified, MD5 ciphertext
authentication packets use the universal format (private standard). If the
nonstandard keyword is specified, MD5 ciphertext authentication packets use
the non-standard format (IETF standard).
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support the keychain
keychain-name
parameter.
● Run the rip authentication-mode hmac-sha256 { plain
plain-text |
[ cipher ]
password-key }
key-id command to set RIP-2 packet authentication
to HMAC-SHA256 authentication.
----End
3.7.3 Verifying the RIP-2 Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to view all the
active routes in the RIP database.
● Run the display rip
process-id route command to view all RIP routes learned
from other devices.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 94
● Run the display rip
process-id interface [
interface-type interface-number ]
[ verbose ] command to view information about the RIP interface.
----End
3.8 Preventing Routing Loops
Pre-configuration Tasks
Before configuring split horizon and poison reverse, configure basic RIP
functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP Routing Loop Prevention Configuration) in any sequence.
3.8.1 Configuring Split Horizon
Context
Split horizon can prevent routing loops.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run rip split-horizon
Split horizon is configured.
NOTE
● By default, split horizon is disabled on an NBMA network.
● If both split horizon and poison reverse are configured, only poison reverse takes effect.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 95
3.8.2 Configuring Poison Reverse
Context
Poison reverse can prevent routing loops.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run rip poison-reverse
Poison reverse is enabled.
NOTE
If both split horizon and poison reverse are configured, only poison reverse takes effect.
----End
3.8.3 Verifying the RIP Routing Loop Prevention Configuration
Procedure
● Run the display rip
process-id interface [
interface-type interface-number ]
[ verbose ] command to view information about the specified RIP interface.
----End
3.9 Controlling RIP Routing
Pre-configuration Tasks
Before configuring RIP route attributes, configure basic RIP functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP Routing Control Configuration) in any sequence.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 96
3.9.1 Configuring RIP Preference
Context
When different routing protocols discover routes to the same destination, set the
RIP preference to select the required route.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run preference {
preference | route-policy
route-policy-name } *
The RIP preference is set.
By default, the RIP preference is 100.
----End
3.9.2 Configuring Additional Metrics of an Interface
Context
Configuring additional metrics on a RIP interface can change the route selection
sequence.
The additional metric is the metric (hop count) to be added to the original metric
of a RIP route. You can use commands to set additional metrics for incoming and
outgoing RIP routes.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 97
Step 4 Run the following commands as required:
● Run the rip metricin {
value | {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name }
value1 } command to set the additional metric for receiving
routes.
● Run the rip metricout {
value | {
acl-number | acl-name
acl-name | ip-prefix
ip-prefix-name }
value1 } command to set the additional metric for
advertising routes.
NOTE
● The rip metricin command is used to add an additional metric to an incoming route.
After this route is added to the routing table, its metric in the routing table changes.
Running this command affects route selection on the local device and other devices on
the network.
● The rip metricout command is used to add an additional metric to an outgoing route.
When this route is advertised, an additional metric is added to this route, but the metric
of the route in the routing table does not change. Running this command does not
affect route selection on the local device but affects route selection on other devices in
the network.
----End
3.9.3 Setting the Maximum Number of Equal-Cost Routes
Context
By setting the maximum number of equal-cost RIP routes, you can change the
number of routes for load balancing.
NOTE
Only the S5720I-SI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S,
S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and
S6730S-S support this function.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run maximum load-balancing
number
The maximum number of equal-cost routes is set.
By default, the maximum number of equal-cost routes on the S5720I-SI, S5735-S,
S500, S5735-S-I, S5735S-H, or S5736-S is 8, and the maximum number of equal-
cost routes on the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S,
S6730-H, S6730S-H, S6730-S, or S6730S-S is 16.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 98
3.9.4 Verifying the RIP Routing Control Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to view all the
active routes in the RIP database.
● Run the display rip
process-id route command to view all RIP routes learned
from other devices.
----End
3.10 Controlling RIP Route Advertisement
Pre-configuration Tasks
Before controlling RIP route advertisement, configure basic RIP functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the Route Advertisement Control Configuration) in any sequence.
3.10.1 Configuring RIP to Advertise Default Routes
Context
In a routing table, a default route is the route to the network segment 0.0.0.0
(with the mask being 0.0.0.0). If the destination address of a packet does not
match any entry in the routing table, the packet is sent along the default route.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run default-route originate [ cost
cost | { { match default | route-policy
route-
policy-name } [ avoid-learning ] } ]*
The device is configured to originate a default route or advertise the default route
in the routing table to neighbors.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 99
3.10.2 Disabling an Interface from Sending Update Packets
Context
Routing loops can be avoided by disabling interfaces from sending Update
packets.
There are two ways to prevent interfaces from sending Update packets:
● Suppress an interface in the RIP process view.
● Disable an interface from sending RIP packets in the interface view.
The configuration in the RIP process view has a higher priority than the
configuration in the interface view.
Procedure
● Configuration in a RIP process view
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Run one of the following commands depending on the site requirements:
Run silent-interface all
All interfaces are disabled from sending Update packets.
Run silent-interface
interface-type interface-number
An interface is disabled from sending Update packets,
You can set an interface to silent so that it only receives Update packets
to update its routing table. The silent-interface command takes
precedence over the undo rip output command in the interface view.
By default, an interface can receive and send Update packets.
● Configuration in the interface view
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 100
d. Run undo rip output
The interface is disabled from sending RIP Update packets.
By running this command, you can determine whether to send RIP
Update packets on an interface. The silent-interface command takes
precedence over the undo rip output command. By default, an interface
is allowed to send RIP Update packets.
----End
3.10.3 Configuring RIP to Import Routes
Context
A RIP process can import the routes learned by other RIP processes or routing
protocols.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 (Optional) Run default-cost
cost
The default metric for imported routes is set.
If the metric of imported routes is not specified in step 4, the default metric is
used.
Step 4 Run import-route bgp [ permit-ibgp ] [ cost {
cost | transparent } | route-policy
route-policy-name ] * or import-route { { static | direct | unr } | { { rip | ospf |
isis } [
process-id ] } } [ cost
cost | route-policy
route-policy-name ] *
External routes are imported to RIP.
NOTE
When RIP imports IBGP routes, routing loops may occur. Configure this function with
caution.
Step 5 (Optional) Run filter-policy {
acl-number | acl-name
acl-name | ip-prefix
ip-
prefix-name } export [
protocol [
process-id ] |
interface-type interface-number ]
The imported routes are filtered before being advertised.
The routing information advertised by RIP may contain the routing information
imported from other protocols. You can use the
protocol parameter to filter the
routing information imported from a specified routing protocol. If the
protocol
parameter is not used, all the routes advertised by RIP are filtered, including the
imported routes and the local routes (direct routes).
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 101
NOTE
RIP-2 defines a 16-bit tag, while other routing protocols define 32-bit tags. If the routes of
other protocols are imported to RIP and the tag is used in the routing policy, the tag value
cannot exceed 65535. If the tag value exceeds 65535, the routing policy becomes invalid or
the matching result is incorrect.
----End
3.10.4 Verifying the RIP Route Advertisement Control
Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to view all the
active routes in the RIP database.
● Run the display rip
process-id route command to view all RIP routes learned
from other devices.
----End
3.11 Controlling Receiving of RIP Routing Information
Pre-configuration Tasks
Before controlling receiving of RIP routing information, configure basic RIP
functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP Route Receiving Control Configuration) in any sequence.
3.11.1 Disabling an Interface from Receiving RIP Update
Packets
Context
Routing loops can be avoided by disabling interfaces from receiving Update
packets.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 102
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run undo rip input
The interface is disabled from receiving RIP Update packets.
By default, an interface is allowed to receive RIP update packets.
----End
3.11.2 Configuring RIP to Deny Host Routes
Context
In certain cases, the switch receives a large number of host routes with 32 bits
from the same network segment. These host routes are unnecessary for routing,
and they waste network resources. You can configure the switch to reject all the
host routes it receives.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run undo host-route
Host routes are not added to the RIP routing table.
By default, host routes can be added to the routing table on the switch.
NOTE
The undo host-route command is invalid for RIP-2.
----End
3.11.3 Configuring RIP to Filter Received Routes
Context
The filtering policy can be configured on the inbound interface by configuring the
ACL and IP prefix list to filter received routes. Only the routes not filtered out by
the filtering policy are added to the local routing table.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 103
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Depending on type of desired filtering, run one of following commands to
configure RIP to filter the received routes:
● Run filter-policy {
acl-number | acl-name
acl-name } import [
interface-type
interface-number ]
The learned routing information is filtered based on an ACL.
● Run filter-policy gateway
ip-prefix-name import
The routing information advertised by neighbors is filtered based on the IP
prefix list.
● Run filter-policy ip-prefix
ip-prefix-name [ gateway
ip-prefix-name ] import
[
interface-type interface-number ]
The routes learned by the specified interface are filtered based on the IP
prefix list and neighbors.
----End
3.11.4 Verifying the RIP Route Receiving Control
Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to check the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to check all
activated RIP routes in the database.
● Run the display rip
process-id interface [
interface-type interface-number ]
[ verbose ] command to check information about the RIP interface.
● Run the display rip
process-id neighbor [ verbose ] command to check
information about RIP neighbors.
● Run the display rip
process-id route command to check all the RIP routes
that are learned from other switches.
----End
3.12 Improving RIP Network Performance
Pre-configuration Tasks
Before improving the network performance of RIP, configure basic RIP functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 104
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIP Network Performance Optimization Configuration) in any sequence.
3.12.1 Configuring RIP Timers
Context
RIP uses three timers: Update, Age, and Garbage-collect. Changing the timer
values affects the convergence speed of RIP routes.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip [
process-id ]
The RIP view is displayed.
Step 3 Run timers rip
update age garbage-collect
RIP timers are configured.
NOTE
● RIP timers take effect immediately after being changed.
● Route flapping occurs if the values of the three timers are set improperly. The
relationship between the values is:
update must be smaller than both
age and
garbage-
collect. If the update time is longer than the aging time and, for example, a RIP route
changes within the update time, the switch cannot inform its neighbors of the change
on time.
● Configure RIP timers based on the network performance and ensure that these timers
are consistent on all RIP devices. This avoids unnecessary network traffic or route
flapping.
By default, the Update timer is 30s, the Age timer is 180s, and the Garbage-collect
timer is 120s (four times the Update timer).
In practice, the Garbage-collect timer is not fixed. If the Update timer is set to 30s,
the Garbage-collect timer may range from 90s to 120s.
Before permanently deleting an unreachable route from its RIP routing table, a RIP
device advertises this route (with the metric set to 16) four times by periodically
sending Update packets. Subsequently, all the neighbors learn that this route is
unreachable. Because a route may not always become unreachable at the
beginning of an Update period, the Garbage-collect timer ranges from three to
four times the Update timer.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 105
3.12.2 Setting the Interval for Sending Update Packets and
Maximum Number of Sent Packets
Context
To limit memory resources used to process RIP Update packets, set the interval for
sending RIP Update packets and the maximum number of Update packets to be
sent at a time.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run rip pkt-transmit { interval
interval | number
pkt-count } *
The interval for sending RIP Update packets and the maximum number of Update
packets to be sent at a time are set.
----End
3.12.3 Enabling the Replay Protection Function
Context
If an interface goes Down and then goes Up, RIP routing information on both ends
of a link may be desynchronized or lost. Specifically, if the Identification field in
the last RIP packet sent before a RIP interface goes Down is X, after the interface
goes Up, the Identification field in the subsequent RIP packet sent by this interface
becomes 0. If the peer end does not receive the RIP packet with the Identification
field being 0, the peer end discards subsequent RIP packets until it receives the RIP
packet with the Identification field being X+1. This leads to RIP routing
information on both ends of the link being desynchronized or lost.
To solve this problem, enable the replay protection function so that RIP can obtain
the Identification field in the last RIP packet sent before the RIP interface goes
Down and increase the Identification field in the subsequent RIP packet by 1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 106
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run rip authentication-mode md5 nonstandard
password-key key-id
RIP-2 is configured to use MD5 authentication, and authentication packets use the
nonstandard packet format.
Step 5 Run rip replay-protect
The replay protection function is enabled.
NOTE
If you run the rip replay-protect command in the same view multiple times, only the latest
configuration takes effect.
----End
3.12.4 Configuring RIP to Check the Validity of Update
Packets
Context
Checking the validity of RIP Update packets improves network security. Validity
check includes zero field check for RIP-1 packets and source address check for RIP
Update packets.
● Zero field check
In RIP-1 packets, the values of some fields must be zero. These fields are zero
fields. After zero field check is enabled, a switch checks the zero fields in RIP-1
packets and discards the packets in which the zero field values are not 0.
● Source address check
Source address check for RIP Update packets verifies the source IP address of
received RIP Update packets. Specifically, a switch checks whether the IP
address of the interface that sends the packet is in the same network
segment as that of the interface that receives the packet. If the IP addresses
are not in the same network segment, the switch will not process the RIP
packet.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 107
Procedure
● Configure zero field check for RIP-1 packets.
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Run checkzero
Zero field check is configured for RIP-1 packets.
Zero field check configuration is invalid in RIP-2.
● Configure source address check for RIP Update packets.
a. Run system-view
The system view is displayed.
b. Run rip [
process-id ]
The RIP view is displayed.
c. Run verify-source
Source IP address check is configured for RIP Update packets.
----End
3.12.5 Verifying the RIP Network Performance Optimization
Configuration
Procedure
● Run the display rip [
process-id | vpn-instance
vpn-instance-name ]
command to view the RIP running status and configuration.
● Run the display rip
process-id database [ verbose ] command to view all the
active routes in the RIP database.
● Run the display rip
process-id interface [
interface-type interface-number ]
[ verbose ] command to view information about the specified RIP interface.
● Run the display rip
process-id neighbor [ verbose ] command to view RIP
neighbor configuration.
● Run the display rip
process-id route command to view all RIP routes learned
from other devices.
----End
3.13 Configuring BFD for RIP
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support BFD for RIP.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 108
Pre-configuration Tasks
Before configuring BFD for RIP, configure basic RIP functions.
Configuration Procedure
You can perform the following configuration tasks in any sequence.
3.13.1 Configuring Dynamic BFD for RIP
Applicable Environment
RIP often uses timers to receive and send Update messages to maintain neighbor
relationships. If a RIP device does not receive an Update message from a neighbor
after the Age timer expires, the RIP device will announce that this neighbor goes
Down. The default value of the Age timer is 180s, therefore, if a link fault occurs,
RIP may detect this fault after 180s. If high-rate data services are deployed on a
network, a large amount of data will be lost during the aging time.
BFD provides millisecond-level fault detection. It can rapidly detect faults in
protected links or nodes and report them to RIP. This speeds up RIP processes'
responses to network topology changes and achieves rapid RIP route convergence.
Either of the following methods can be used to configure BFD for RIP:
● Enable BFD in a RIP process.
This method is recommended when BFD for RIP needs to be enabled on most
RIP interfaces.
● Enable BFD on RIP interfaces.
This method is recommended when BFD for RIP needs to be enabled on a
small number of RIP interfaces.
Procedure
● Enable BFD in a RIP process.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is enabled globally.
c. Run quit
Return to the system view.
d. Run rip [
process-id ]
The RIP view is displayed.
e. Run bfd all-interfaces enable
BFD is enabled in the RIP process to establish a BFD session.
If BFD is enabled globally, RIP will use default BFD parameters to
establish BFD sessions on all the interfaces where RIP neighbor
relationships are in Up state.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 109
f. (Optional) Run bfd all-interfaces { min-rx-interval
min-receive-value |
min-tx-interval
min-transmit-value | detect-multiplier
detect-multiplier-
value } *
The values of BFD parameters used to establish the BFD session are set.
BFD parameter values are determined by the actual network situation
and network reliability requirement.
▪ If links have a high reliability requirement, reduce the interval at
which BFD packets are sent.
▪ If links have a low reliability requirement, increase the interval at
which BFD packets are sent.
Running the bfd all-interfaces command changes BFD session
parameters on all RIP interfaces.
g. (Optional) Perform the following operations to prevent an interface in
the RIP process from establishing a BFD session:
▪ Run the quit command to return to the system view.
▪ Run the interface
interface-type interface-number command to
enter the view of a specified interface.
▪ Run the rip bfd block command to prevent the interface from
establishing a BFD session.
● Enable BFD on RIP interfaces.
a. Run system-view
The system view is displayed.
b. Run bfd
BFD is enabled globally.
c. Run quit
Return to the system view.
d. Run interface
interface-type interface-number
The view of the specified interface is displayed.
e. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
f. Run rip bfd enable
BFD is enabled on the interface to establish a BFD session.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 110
g. (Optional) Run rip bfd { min-rx-interval
min-receive-value | min-tx-
interval
min-transmit-value | detect-multiplier
detect-multiplier-value }
*
The values of BFD parameters used to establish the BFD session are set.
----End
Verifying the Configuration
After enabling BFD for RIP at both ends of a link:
● Run the display rip
process-id bfd session { interface
interface-type
interface-number |
neighbor-id | all } command. The command output shows
that the BFDState field on the local switch displays Up.
3.13.2 Configuring Static BFD for RIP
Context
BFD provides link failure detection featuring light load and high speed. Static BFD
for RIP is a method to implement the BFD function.
Establishing BFD sessions between RIP neighbors can rapidly detect faults on links
and speed up response of RIP to network topology changes. Static BFD
implements the following functions:
● One-arm BFD
If not all devices on a network support BFD, configure one-arm BFD to
implement fault detection.
● Two-arm BFD
If all the devices on a network support BFD, configure two-arm BFD to
implement fault detection.
To configure a static BFD session, you need to set parameters for the BFD session.
Procedure
Step 1 Enable BFD globally.
1. Run system-view
The system view is displayed.
2. Run bfd
BFD is enabled globally.
3. Run quit
Return to the system view.
NOTE
To configure one-arm BFD, go to Step 2. To configure two-arm BFD, go to Step 3.
Step 2 Configure one-arm BFD.
1. Run bfd
session-name bind peer-ip
peer-ip interface
interface-type interface-
number [ source-ip
source-ip ] one-arm-echo
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 111
BFD is enabled between the specified interface and peer device.
If a peer IP address and a local interface are specified, BFD detects only a
single-hop link, that is, a route with the interface specified in the bfd
command as the outbound interface and with the peer IP address specified in
the peer-ip command as the next-hop address.
NOTE
When configuring the one-arm Echo function on the device, set the source-ip
source-
ip to the IP address of an interface on the device. Ensure that the peer device can ping
this IP address.
2. Run discriminator local
discr-value
The local discriminator is set.
3. (Optional) Run min-echo-rx-interval
interval
The minimum interval at which BFD packets are received is configured.
4. Run commit
The configuration is committed.
5. Run quit
Return to the system view.
Step 3 Configure two-arm BFD.
1. Run bfd
session-name bind peer-ip
ip-address [ interface
interface-type
interface-number ] [ source-ip
ip-address ]
BFD binding is created.
If a peer IP address and a local interface are specified, BFD detects only a
single-hop link, that is, a route with the interface specified in the bfd
command as the outbound interface and with the peer IP address specified in
the peer-ip command as the next-hop address.
2. Set discriminators.
– Run discriminator local
discr-value
The local discriminator is set.
– Run discriminator remote
discr-value
The remote discriminator is set.
The local discriminator must be the remote discriminator of the device on the
other end; otherwise, a BFD session cannot be established. The local and
remote discriminators cannot be modified after being configured.
NOTE
local
discr-value set on the local device is the same as that of remote
discr-value set
on the remote device.remote
discr-value set on the local device is the same as that of
local
discr-value set on the remote device.
3. Run commit
The configuration is committed.
4. Run quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 112
Return to the system view.
Step 4 Enable static BFD on an interface.
1. Run interface
interface-type interface-number
The view of the specified interface is displayed.
2. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-
H, S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
3. Run rip bfd static
Static BFD is enabled on the interface.
4. Run quit
Return to the system view.
----End
Verifying the Configuration
After configuring static BFD for RIP:
● Run the display rip
process-id interface [
interface-type interface-number ]
verbose command to check BFD for RIP configurations on the specified
interface.
3.14 Configuring the Network Management Function
for RIP
Pre-configuration Tasks
Before configuring the network management function for RIP, configure basic RIP
functions.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run rip mib-binding
process-id
RIP is bound to the MIB.
This command is used to bind a RIP process ID to MIBs and specify the ID of the
RIP process that accepts Simple Network Management Protocol (SNMP) requests.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 113
Verifying the Configuration
● Run the display current-configuration command to view the binding
relationships of RIP.
3.15 Maintaining RIP
3.15.1 Resetting RIP
Context
To reset RIP connections, run the following reset commands in the user view.
NOTICE
The RIP neighbor relationship is deleted after you reset RIP connections with the
reset rip command. Exercise caution when running this command.
Procedure
● Run the reset rip
process-id configuration command in the user view to reset
the system parameters of a RIP process. When a RIP process restarts, all the
parameters of the process retain the default values.
----End
3.15.2 Clearing RIP Statistics
Context
To clear RIP statistics, run the following reset commands in the user view.
NOTICE
RIP information cannot be restored after it is cleared. Exercise caution when
running the commands.
Procedure
● Run the reset rip
process-id statistics [ interface { all |
interface-type
interface-number [ neighbor
neighbor-ip-address ] } ] command in the user
view to clear the counters of a RIP process.
----End
3.16 Configuration Examples for RIP
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 114
3.16.1 Example for Configuring Basic RIP Functions
Networking Requirements
In Figure 3-11, SwitchA, SwitchB, SwitchC, and SwitchD are located on a small-
sized network and need to communicate with each other.
Figure 3-11 Configuring basic RIP functions
Configuration Roadmap
RIP-2 is recommended if the network size is small. The configuration roadmap is
as follows:
1. Configure VLAN and IP address for each interface to ensure network
reachability.
2. Enable RIP on each switch to implement network connections between
processes.
3. Configure RIP-2 on each switch to improve RIP performance.
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 115
Step 2 Configure an IP address to each VLANIF interface. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
Step 3 Configure basic RIP functions.
# Configure SwitchA.
[SwitchA] rip
[SwitchA-rip-1] network 192.168.1.0
[SwitchA-rip-1] quit
# Configure SwitchB.
[SwitchB] rip
[SwitchB-rip-1] network 192.168.1.0
[SwitchB-rip-1] network 172.16.0.0
[SwitchB-rip-1] network 10.0.0.0
[SwitchB-rip-1] quit
# Configure SwitchC.
[SwitchC] rip
[SwitchC-rip-1] network 172.16.0.0
[SwitchC-rip-1] quit
# Configure SwitchD.
[SwitchD] rip
[SwitchD-rip-1] network 10.0.0.0
[SwitchD-rip-1] quit
# Check the RIP routing table of SwitchA.
[SwitchA] display rip 1 route
Route Flags : R - RIP
A - Aging, G - Garbage-collect
----------------------------------------------------------------------------
Peer 192.168.1.2 on Vlanif10
Destination/Mask Nexthop Cost Tag Flags Sec
172.16.0.0/16 192.168.1.2 1 0 RA 14
10.0.0.0/8 192.168.1.2 1 0 RA 14
The command output shows that the routes advertised by RIP-1 use natural
masks.
Step 4 Configure the RIP version.
# Configure RIP-2 on SwitchA.
[SwitchA] rip
[SwitchA-rip-1] version 2
[SwitchA-rip-1] quit
# Configure RIP-2 on SwitchB.
[SwitchB] rip
[SwitchB-rip-1] version 2
[SwitchB-rip-1] quit
# Configure RIP-2 on SwitchC.
[SwitchC] rip
[SwitchC-rip-1] version 2
[SwitchC-rip-1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 116
# Configure RIP-2 on SwitchD.
[SwitchD] rip
[SwitchD-rip-1] version 2
[SwitchD-rip-1] quit
Step 5 Verify the configuration.
# Check the RIP routing table of SwitchA.
[SwitchA] display rip 1 route
Route Flags : R - RIP
A - Aging, G - Garbage-collect
----------------------------------------------------------------------------
Peer 192.168.1.2 on Vlanif10
Destination/Mask Nexthop Cost Tag Flags Sec
172.16.1.0/24 192.168.1.2 1 0 RA 32
10.1.1.0/24 192.168.1.2 1 0 RA 32
From the routing table, you can find that the routes advertised by RIP-2 contain
more accurate subnet masks.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
rip 1
version 2
network 192.168.1.0
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 20 30
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif20
ip address 172.16.1.1 255.255.255.0
#
interface Vlanif30
ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 117
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
rip 1
version 2
network 192.168.1.0
network 172.16.0.0
network 10.0.0.0
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20
#
interface Vlanif20
ip address 172.16.1.2 255.255.255.0
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
rip 1
version 2
network 172.16.0.0
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 30
#
interface Vlanif30
ip address 10.1.1.2 255.255.255.0
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 30
#
rip 1
version 2
network 10.0.0.0
#
return
3.16.2 Example for Configuring RIP to Import Routes
Networking Requirements
In Figure 3-12, two RIP processes, RIP 100 and RIP 200, run on SwitchB. SwitchA
needs to communicate with network segment 192.168.3.0/24.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 118
Figure 3-12 Configuring RIP to import external routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable RIP on each switch to implement network connections between
processes.
2. Import routes between RIP 100 and RIP 200 on SwitchB and set the default
metric of routes imported from RIP 200 to 3.
3. Configure an ACL on SwitchB to filter route 192.168.4.0/24 imported from RIP
200 so that SwitchA can only communicate with network segment
192.168.3.0/24.
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs. The configurations of Switch B,
and Switch C are similar to the configuration of Switch A, and are not mentioned
here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 50
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 50
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address to each VLANIF interface. The configurations of Switch B,
and Switch C are similar to the configuration of Switch A, and are not mentioned
here.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 192.168.1.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 50
[SwitchA-Vlanif50] ip address 192.168.0.1 24
[SwitchA-Vlanif50] quit
Step 3 Configure basic RIP functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 119
# Enable RIP 100 on SwitchA.
[SwitchA] rip 100
[SwitchA-rip-100] network 192.168.0.0
[SwitchA-rip-100] network 192.168.1.0
[SwitchA-rip-100] quit
# Enable RIP 100 and RIP 200 on SwitchB.
[SwitchB] rip 100
[SwitchB-rip-100] network 192.168.1.0
[SwitchB-rip-100] quit
[SwitchB] rip 200
[SwitchB-rip-200] network 192.168.2.0
[SwitchB-rip-200] quit
# Enable RIP 200 on SwitchC.
[SwitchC] rip 200
[SwitchC-rip-200] network 192.168.2.0
[SwitchC-rip-200] network 192.168.3.0
[SwitchC-rip-200] network 192.168.4.0
[SwitchC-rip-200] quit
# View the routing table on SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.0.0/24 Direct 0 0 D 192.168.0.1 Vlanif50
192.168.0.1/32 Direct 0 0 D 127.0.0.1 Vlanif50
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
The routing table of SwitchA does not contain the routes imported from other
processes.
Step 4 Configure RIP to import external routes.
# On SwitchB, set the default metric of imported routes to 3 in RIP 100 and
configure the two RIP processes to import routes into each other's routing table.
[SwitchB] rip 100
[SwitchB-rip-100] default-cost 3
[SwitchB-rip-100] import-route rip 200
[SwitchB-rip-100] quit
[SwitchB] rip 200
[SwitchB-rip-200] import-route rip 100
[SwitchB-rip-200] quit
# View the routing table of SwitchA after the routes are imported.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 9 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 120
192.168.0.0/24 Direct 0 0 D 192.168.0.1 Vlanif50
192.168.0.1/32 Direct 0 0 D 127.0.0.1 Vlanif50
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.2.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
192.168.3.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
192.168.4.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
The routing table of SwitchA contains routes 192.168.2.0/24, 192.168.3.0/24, and
192.168.4.0/24, which are learned by RIP 200 on SwitchB.
Step 5 Configure RIP to filter imported routes.
# Configure an ACL on SwitchB and add a rule to the ACL. The rule denies the
packets sent from 192.168.4.0/24.
[SwitchB] acl 2000
[SwitchB-acl-basic-2000] rule deny source 192.168.4.0 0.0.0.255
[SwitchB-acl-basic-2000] rule permit
[SwitchB-acl-basic-2000] quit
# Configure SwitchB to filter route 192.168.4.0/24 imported from RIP 200 based
on the preceding ACL.
[SwitchB] rip 100
[SwitchB-rip-100] filter-policy 2000 export
[SwitchB-rip-100] quit
Step 6 Verify the configuration.
# Display the RIP routing table of SwitchA after the routes are filtered.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 8
Destination/Mask Proto Pre Cost Flags NextHop Interface
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
192.168.0.0/24 Direct 0 0 D 192.168.0.1 Vlanif50
192.168.0.1/32 Direct 0 0 D 127.0.0.1 Vlanif50
192.168.1.0/24 Direct 0 0 D 192.168.1.1 Vlanif10
192.168.1.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
192.168.2.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
192.168.3.0/24 RIP 100 4 D 192.168.1.2 Vlanif10
The routing table of SwitchA does not contain the route originating from
192.168.4.0/24.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 50
#
interface Vlanif10
ip address 192.168.1.1 255.255.255.0
#
interface Vlanif50
ip address 192.168.0.1 255.255.255.0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 121
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 50
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
rip 100
network 192.168.0.0
network 192.168.1.0
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 20
#
acl number 2000
rule 5 deny source 192.168.4.0 0.0.0.255
rule 10 permit
#
interface Vlanif10
ip address 192.168.1.2 255.255.255.0
#
interface Vlanif20
ip address 192.168.2.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
rip 100
default-cost 3
network 192.168.1.0
filter-policy 2000 export
import-route rip 200
#
rip 200
network 192.168.2.0
import-route rip 100
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 30 40
#
interface Vlanif20
ip address 192.168.2.2 255.255.255.0
#
interface Vlanif30
ip address 192.168.3.1 255.255.255.0
#
interface Vlanif40
ip address 192.168.4.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 122
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
rip 200
network 192.168.2.0
network 192.168.3.0
network 192.168.4.0
#
return
3.16.3 Example for Configuring One-Arm Static BFD for RIP
Networking Requirements
In Figure 3-13, four switches communicate using RIP on a small-sized network.
Services are transmitted through the primary link SwitchA→SwitchB→SwitchD.
Reliability must be improved for data transmitted from SwitchA to SwitchB so that
services can be rapidly switched to another path when the primary link fails.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 3-13 One-arm static BFD for RIP
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP address for each interface to ensure network reachability.
2. Enable RIP on each switch to implement network connections between
processes.
3. Configure one-arm static BFD on SwitchA. BFD can rapidly detect the link
status and help RIP speed up route convergence to implement fast link
switching.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 123
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address to each VLANIF interface. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.2.2.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.3.3.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic RIP functions.
# Configure SwitchA.
[SwitchA] rip 1
[SwitchA-rip-1] version 2
[SwitchA-rip-1] network 10.0.0.0
[SwitchA-rip-1] quit
# Configure SwitchB.
[SwitchB] rip 1
[SwitchB-rip-1] version 2
[SwitchB-rip-1] network 10.0.0.0
[SwitchB-rip-1] network 172.16.0.0
[SwitchB-rip-1] quit
# Configure SwitchC.
[SwitchC] rip 1
[SwitchC-rip-1] version 2
[SwitchC-rip-1] network 10.0.0.0
[SwitchC-rip-1] quit
# Configure SwitchD.
[SwitchD] rip 1
[SwitchD-rip-1] version 2
[SwitchD-rip-1] network 172.16.0.0
[SwitchD-rip-1] quit
# After completing the preceding operations, run the display rip neighbor
command. The command output shows that SwitchA, SwitchB, and SwitchC have
established neighbor relationships with each other. In the following example, the
display on SwitchA is used.
[SwitchA] display rip 1 neighbor
---------------------------------------------------------------------
IP Address Interface Type Last-Heard-Time
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 124
---------------------------------------------------------------------
10.2.2.2 Vlanif10 RIP 0:0:10
Number of RIP routes : 2
10.3.3.2 Vlanif20 RIP 0:0:8
Number of RIP routes : 1
# Run the display ip routing-table command. The command output shows that
the devices have imported routes from each other. In the following example, the
display on SwitchA is used.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.2.2.0/24 Direct 0 0 D 10.2.2.1 Vlanif10
10.2.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.4.4.0/24 RIP 100 1 D 10.2.2.2 Vlanif10
RIP 100 1 D 10.3.3.2 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 RIP 100 1 D 10.2.2.2 Vlanif10
The preceding command output shows that the next-hop address and outbound
interface of the route to destination 172.16.1.0/24 are 10.2.2.2 and VLANIF10, and
traffic is transmitted over the active link SwitchA->SwitchB.
Step 4 Configure one-arm static BFD on SwitchA.
# Configure one-arm BFD on SwitchA.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] bfd 1 bind peer-ip 10.2.2.2 interface vlanif 10 source-ip 10.1.1.1 one-arm-echo
[SwitchA-bfd-session-1] discriminator local 1
[SwitchA-bfd-session-1] min-echo-rx-interval 200
[SwitchA-bfd-session-1] commit
[SwitchA-bfd-session-1] quit
The source IP address 10.1.1.1 can be configured as the IP address of another
interface (such as loopback interface) on the device. This parameter must be
configured. Otherwise, the BFD session cannot be set up.
# Enable static BFD on VLANIF 10.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] rip bfd static
[SwitchA-Vlanif10] quit
# After the configurations are completed, run the display bfd session all
command on SwitchA. The command output shows that a static BFD session has
been set up.
[SwitchA] display bfd session all
--------------------------------------------------------------------------------
Local Remote PeerIpAddr State Type InterfaceName
--------------------------------------------------------------------------------
1 - 10.2.2.2 Up S_IP_IF Vlanif10
--------------------------------------------------------------------------------
Total UP/DOWN Session Number : 1/0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 125
Step 5 Verify the configuration.
# Run the shutdown command on GigabitEthernet0/0/1 of SwitchB to simulate a
fault in the active link.
NOTE
The link fault is simulated to verify the configuration. In actual situations, the operation is
not required.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# Check the routing table of SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.4.4.0/24 RIP 100 1 D 10.3.3.2 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 RIP 100 2 D 10.3.3.2 Vlanif20
The preceding command output shows that the standby link SwitchA->SwitchC-
>SwitchB is used after the active link fails, and the next-hop address and
outbound interface of the route to destination 172.16.1.0/24 are 10.3.3.2 and
VLANIF20.
----End
Configuration files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
bfd
#
interface Vlanif10
ip address 10.2.2.1 255.255.255.0
rip bfd static
#
interface Vlanif20
ip address 10.3.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
bfd 1 bind peer-ip 10.2.2.2 interface Vlanif10 source-ip 10.1.1.1 one-arm-echo
discriminator local 1
min-echo-rx-interval 200
commit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 126
#
rip 1
version 2
network 10.0.0.0
#
return
● SwitchB configuration file
#
sysname SwitchB
#
vlan batch 10 30 40
#
interface Vlanif10
ip address 10.2.2.2 255.255.255.0
#
interface Vlanif30
ip address 10.4.4.1 255.255.255.0
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
rip 1
version 2
network 10.0.0.0
network 172.16.0.0
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 30
#
interface Vlanif20
ip address 10.3.3.2 255.255.255.0
#
interface Vlanif30
ip address 10.4.4.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
rip 1
version 2
network 10.0.0.0
#
return
● SwitchD configuration file
#
sysname SwitchD
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 127
#
vlan batch 40
#
interface Vlanif40
ip address 172.16.1.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 40
#
rip 1
version 2
network 172.16.0.0
#
return
3.16.4 Example for Configuring Dynamic BFD for RIP
Networking Requirements
In Figure 3-14, four switches communicate using RIP on a small-sized network.
Services are transmitted through the primary link SwitchA→SwitchB→SwitchD.
Reliability must be improved for data transmitted from SwitchA to SwitchB so that
services can be rapidly switched to another path when the primary link fails.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
Figure 3-14 Configuring dynamic BFD for RIP
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IP address for each interface to ensure network reachability.
2. Enable RIP on each switch to implement network connections between
processes.
3. Configure BFD for RIP on interfaces at both ends of the link between SwitchA
and SwitchB. BFD can rapidly detect the link status and help RIP speed up
route convergence to implement fast link switching.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 128
Procedure
Step 1 Configure VLANs and add interfaces to the VLANs. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure an IP address to each VLANIF interface. The configurations of SwitchB,
SwitchC, and SwitchD are similar to the configuration of SwitchA, and are not
mentioned here.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ip address 10.2.2.1 24
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ip address 10.3.3.1 24
[SwitchA-Vlanif20] quit
Step 3 Configure basic RIP functions.
# Configure SwitchA.
[SwitchA] rip 1
[SwitchA-rip-1] version 2
[SwitchA-rip-1] network 10.0.0.0
[SwitchA-rip-1] quit
# Configure SwitchB.
[SwitchB] rip 1
[SwitchB-rip-1] version 2
[SwitchB-rip-1] network 10.0.0.0
[SwitchB-rip-1] network 172.16.0.0
[SwitchB-rip-1] quit
# Configure SwitchC.
[SwitchC] rip 1
[SwitchC-rip-1] version 2
[SwitchC-rip-1] network 10.0.0.0
[SwitchC-rip-1] quit
# Configure SwitchD.
[SwitchD] rip 1
[SwitchD-rip-1] version 2
[SwitchD-rip-1] network 172.16.0.0
[SwitchD-rip-1] quit
# After completing the preceding operations, run the display rip neighbor
command. The command output shows that SwitchA, SwitchB, and SwitchC have
established neighbor relationships with each other. In the following example, the
display on SwitchA is used.
[SwitchA] display rip 1 neighbor
---------------------------------------------------------------------
IP Address Interface Type Last-Heard-Time
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 129
---------------------------------------------------------------------
10.2.2.2 Vlanif10 RIP 0:0:14
Number of RIP routes : 2
10.3.3.2 Vlanif20 RIP 0:0:19
Number of RIP routes : 1
# Run the display ip routing-table command. The command output shows that
the switches have imported routes from each other. In the following example, the
display on SwitchA is used.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 8 Routes : 9
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.2.2.0/24 Direct 0 0 D 10.2.2.1 Vlanif10
10.2.2.1/32 Direct 0 0 D 127.0.0.1 Vlanif10
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.4.4.0/24 RIP 100 1 D 10.3.3.2 Vlanif20
RIP 100 1 D 10.2.2.2 Vlanif10
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 RIP 100 1 D 10.2.2.2 Vlanif10
The preceding command output shows that the next-hop address and outbound
interface of the route to destination 172.16.1.0/24 are 10.2.2.2 and VLANIF10, and
traffic is transmitted over the active link SwitchA->SwitchB.
Step 4 Configure BFD in RIP processes.
# Configure BFD on all interfaces of SwitchA. The configuration of SwitchB is
similar to that of SwitchA, and is not provided here.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] rip 1
[SwitchA-rip-1] bfd all-interfaces enable
[SwitchA-rip-1] bfd all-interfaces min-tx-interval 100 min-rx-interval 100 detect-multiplier 10
[SwitchA-rip-1] quit
# After completing the preceding operations, run the display rip bfd session
command on SwitchA. The command output shows that SwitchA and SwitchB
have established a BFD session and the BFDState field displays Up. In the
following example, the display on SwitchA is used.
[SwitchA] display rip 1 bfd session all
LocalIp : 10.2.2.1 RemoteIp : 10.2.2.2 BFDState : Up
TX : 100 RX : 100 Multiplier : 10
BFD Local Dis : 8192 Interface : Vlanif10
Diagnostic Info : No diagnostic information
LocalIp : 10.3.3.1 RemoteIp : 10.3.3.2 BFDState : Down
TX : 2800 RX : 2800 Multiplier : 0
BFD Local Dis : 8193 Interface : Vlanif20
Diagnostic Info : No diagnostic information
Step 5 Verify the configuration.
# Run the shutdown command on GigabitEthernet0/0/1 of SwitchB to simulate a
fault in the active link.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 130
NOTE
The link fault is simulated to verify the configuration. In actual situations, the operation is
not required.
[SwitchB] interface gigabitethernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# Check the routing table of SwitchA.
[SwitchA] display ip routing-table
Route Flags: R - relay, D - download to fib, T - to vpn-instance
------------------------------------------------------------------------------
Routing Tables: Public
Destinations : 6 Routes : 6
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.3.3.0/24 Direct 0 0 D 10.3.3.1 Vlanif20
10.3.3.1/32 Direct 0 0 D 127.0.0.1 Vlanif20
10.4.4.0/24 RIP 100 1 D 10.3.3.2 Vlanif20
127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0
127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0
172.16.1.0/24 RIP 100 2 D 10.3.3.2 Vlanif20
The preceding command output shows that the standby link SwitchA->SwitchC-
>SwitchB is used after the active link fails, and the next-hop address and
outbound interface of the route to destination 172.16.1.0/24 are 10.3.3.2 and
VLANIF20.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
vlan batch 10 20
#
bfd
#
interface Vlanif10
ip address 10.2.2.1 255.255.255.0
#
interface Vlanif20
ip address 10.3.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
rip 1
version 2
network 10.0.0.0
bfd all-interfaces enable
bfd all-interfaces min-tx-interval 100 min-rx-interval 100 detect-multiplier 10
#
return
● SwitchB configuration file
#
sysname SwitchB
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 131
#
vlan batch 10 30 40
#
bfd
#
interface Vlanif10
ip address 10.2.2.2 255.255.255.0
#
interface Vlanif30
ip address 10.4.4.1 255.255.255.0
#
interface Vlanif40
ip address 172.16.1.1 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 40
#
rip 1
version 2
network 10.0.0.0
network 172.16.0.0
bfd all-interfaces enable
bfd all-interfaces min-tx-interval 100 min-rx-interval 100 detect-multiplier 10
#
return
● SwitchC configuration file
#
sysname SwitchC
#
vlan batch 20 30
#
interface Vlanif20
ip address 10.3.3.2 255.255.255.0
#
interface Vlanif30
ip address 10.4.4.2 255.255.255.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
rip 1
version 2
network 10.0.0.0
#
return
● SwitchD configuration file
#
sysname SwitchD
#
vlan batch 40
#
interface Vlanif40
ip address 172.16.1.2 255.255.255.0
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 132
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 40
#
rip 1
version 2
network 172.16.0.0
#
return
3.17 Troubleshooting RIP
3.17.1 Failed to Receive RIP Update Packets from Neighbors
Fault Description
A device cannot receive RIP Update packets from neighbors when the link runs
properly.
Procedure
Step 1 Run the display current-configuration configuration rip command to check RIP
configurations.
● Check whether RIP has been enabled on the interface. Only the RIP-enabled
interface can receive RIP packets.
● Check whether the version number in the RIP packet sent by the peer
interface matches the version number in the RIP packet received by the local
interface. If not, the two interfaces cannot establish the RIP neighbor
relationship.
Step 2 Run the display current-configuration interface
interface-type interface-number
command to view the interface configuration.
● Check whether the undo rip input command has been executed on the
interface. If the command has been executed, the interface does not receive
RIP packets.
● Check whether the authentication modes on the two ends of the link are the
same. If the authentication modes are different, the interface cannot receive
RIP packets from the peer.
----End
3.17.2 Failed to Send RIP Update Packets to Neighbors
Fault Description
A device cannot send RIP Update packets to neighbors when the link runs
properly.
Procedure
Step 1 Run the display current-configuration configuration rip command to check RIP
configurations.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 133
● Check whether RIP has been enabled on the interface. Only the RIP-enabled
interface can send RIP packets.
● Check whether the silent-interface command has been executed on the
interface. If the command has been executed, the interface does not send RIP
packets.
Step 2 Run the display current-configuration interface
interface-type interface-number
command to view the interface configuration.
● Check whether the undo rip output command has been executed on the
interface. If the command has been executed, the interface does not send RIP
packets.
● Check whether the authentication modes on the two ends of the link are the
same. If the authentication modes are different, the interface cannot send RIP
packets to the peer.
● Check whether split horizon has been enabled on the interface. If split horizon
has been enabled, the interface cannot send the route learned by itself to
neighbors.
NOTE
Split horizon is enabled on all interfaces by default, but the display current-
configuration command output does not show the split horizon option. If the
command output for an interface connected to an NBMA network does not contain
the split horizon option, split horizon is disabled on the interface.
----End
3.17.3 Route Flapping Occurs on a RIP Network
Fault Description
Route flapping occurs on a RIP network when the link runs properly. Some routes
intermittently disappear in the routing table.
Procedure
Step 1 Run the display rip command to check the configuration of RIP timers.
The RIP timers on the entire network must be consistent; otherwise, route flapping
occurs. The relationships between the timer values are
update <
age,
update <
garbage-collect.
Step 2 Run the timers rip
update age garbage-collect command to set the RIP timers.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 3 RIP Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 134
4 RIPng Configuration
4.1 Overview of RIPng
4.2 Understanding RIPng
4.3 Summary of RIPng Configuration Tasks
4.4 Licensing Requirements and Limitations for RIPng
4.5 Default Settings for RIPng
4.6 Configuring Basic RIPng Functions
4.7 Preventing Routing Loops
4.8 Controlling RIPng Routing
4.9 Controlling RIPng Route Advertisement
4.10 Controlling the Receiving of RIPng Routes
4.11 Improving RIPng Network Performance
4.12 Configuring IPSec Authentication for RIPng
4.13 Clearing RIPng
4.14 Example for Configuring RIPng to Filter the Received Routes
4.1 Overview of RIPng
The Routing Information Protocol Next Generation (RIPng) is a simple Interior
Gateway Protocol (IGP). It is an extension to RIP on IPv6 networks. RIPng applies
to small-scale networks, such as campus networks and regional networks with
simple structure. RIPng is widely used on networks because it is easier to
implement, configure, and manage than OSPFv3 and IPv6 IS-IS.
NOTE
RIPng does not have any security authentication mechanism. For security purposes, use
OSPFv3, IPv6 IS-IS, or BGP4+.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 135
4.2 Understanding RIPng
4.2.1 RIPng
In addition to IPv4 networks, RIP is also applicable to IPv6 networks to provide
accurate route information for IPv6 packets. The IETF has defined RIP next
generation (RIPng) based on RIP for IPv6 networks. RIPng is an important protocol
for IPv6 networks.
Comparison Between RIPng and RIP
RIPng made the following modifications to RIP:
● RIPng uses UDP port 521 to send and receive routing information.
● RIPng uses the destination addresses with 128-bit prefixes (mask length).
● RIPng uses 128-bit IPv6 addresses as next-hop addresses.
● RIPng uses the local-link address FE80::/10 as the source address to send
RIPng Update packets.
● RIPng periodically sends routing information in multicast mode and uses
FF02::9 as multicast address.
● A RIPng packet consists of a header and multiple route table entries (RTEs). In
a RIPng packet, the maximum number of RTEs depends on the MTU of an
interface.
4.3 Summary of RIPng Configuration Tasks
Table 4-1 describes RIPng configuration tasks.
Table 4-1 RIPng configuration tasks
Scenario Description Task
Configuring basic RIPng
functions
Basic RIPng functions
include enabling RIPng
and enabling the RIPng
process on interfaces.
Basic RIPng functions
must be configured
before you use the RIPng
features.
4.6 Configuring Basic
RIPng Functions
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 136
Scenario Description Task
Preventing routing loops RIPng is a distance-
vector routing protocol.
RIPng devices advertise
their local IPv6 routing
tables to neighbors, so
routing loops may occur.
RIPng uses split horizon
and poison reverse to
prevent routing loops:
● Split horizon: A route
learned by RIPng
from an interface is
not sent to neighbors
from this interface.
This reduces
bandwidth
consumption and
prevents routing
loops.
● Poison reverse: RIPng
sets the cost of a
route learned from an
interface to 16
(unreachable), and
sends this route to
neighbors through
this interface. In this
way, RIPng can delete
useless routes from
neighbors' routing
table and prevent
routing loops.
4.7 Preventing Routing
Loops
Controlling RIPng routing To use RIPng more
flexibly on the existing
network and meet
various user
requirements, you can
configure different
parameters to control
RIPng routing.
4.8 Controlling RIPng
Routing
Controlling the
advertising and receiving
of RIPng routes
To meet network
requirements, you can
configure different
parameters to accurately
control the advertising
and receiving of RIPng
routes.
4.9 Controlling RIPng
Route Advertisement
4.10 Controlling the
Receiving of RIPng
Routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 137
Scenario Description Task
Improving RIPng
network performance
You can configure special
RIPng functions to
improve RIPng network
performance.
● Adjust the RIPng
timer to change the
RIPng network
convergence speed.
● Adjust the number
and interval of
Update packets sent
by an interface to
reduce consumption
of device resources
and network
bandwidth.
● Check the zero fields
in RIPng packets to
ensure high network
security.
4.11 Improving RIPng
Network Performance
4.4 Licensing Requirements and Limitations for RIPng
Involved Network Elements
Other network elements are required to support RIPng.
Licensing Requirements
RIPng is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support RIPng.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 138
Feature Limitations
When the maximum number of RIPng routes supported by a switch is fixed, the
maximum number of running RIPng routes supported on the switch is limited by
the CAR value of RIPng protocol packets, interval for sending RIP update packets,
and values of RIPng Age and Garbage-collect timers. To increase the maximum
number of running RIPng routes on a switch if there are large numbers of RIPng
routes running on the network, increase the values of the Age timer, Garbage-
collect timer, or CAR for RIPng protocol packets, as well as reducing the interval
for sending RIPng update packets.
4.5 Default Settings for RIPng
Table 4-2 describes the default settings for RIPng.
Table 4-2 Default settings for RIPng
Parameter Default Setting
Maximum number of equal-cost
routes
8
RIPng function Disabled
4.6 Configuring Basic RIPng Functions
Pre-configuration Tasks
Before configuring basic RIPng functions, complete the following tasks:
● Enable IPv6 on the switch.
● Configure IPv6 addresses for interfaces to ensure that neighboring nodes are
reachable at the network layer.
Configuration Procedure
Creating RIPng processes is the prerequisite for enabling RIPng on interfaces.
4.6.1 Enabling RIPng
Context
Enabling RIPng is the prerequisite for all RIPng configurations. If you run RIPng
commands in the interface view before enabling RIPng, the configurations take
effect only after RIPng is enabled.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 139
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
A RIPng process is created, RIPng is enabled, and the RIPng view is displayed.
If a VPN instance is specified, the RIPng process belongs to this VPN instance. If no
VPN instance is specified, the RIPng process belongs to a public network instance.
Step 3 (Optional) Run description
text
A description is configured for the RIP process.
----End
4.6.2 Enabling RIPng on Interfaces
Context
After RIPng is enabled on an interface, devices can exchange RIPng routing
information through this interface.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng
process-id enable
RIPng is enabled on the specified interface.
NOTE
If IPv6 is not enabled on this interface, this command does not take effect on this interface.
If RIPng needs to be enabled on multiple interfaces of a switch, repeat steps 2 and
3.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 140
4.6.3 Verifying the Basic RIPng Function Configuration
Procedure
● Run the display ripng [
process-id | vpn-instance
vpn-instance-name ]
command to check the configuration of the specified RIPng process.
● Run the display ripng
process-id route command to check all the RIPng
routes that are learned from other switches.
● Run the display default-parameter ripng command to check the default
RIPng configuration.
● Run the display ripng
process-id statistics interface { all |
interface-type
interface-number [ neighbor
neighbor-ipv6-address | verbose ] } command
to check statistics about RIPng interfaces.
----End
4.7 Preventing Routing Loops
Pre-configuration Tasks
Before configuring split horizon and poison reverse, configure basic RIPng
functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIPng Routing Loop Prevention Configuration) in any sequence as required.
4.7.1 Configuring Split Horizon
Context
Split horizon can prevent routing loops.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 141
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng split-horizon
Split horizon is configured.
NOTE
● By default, split horizon is disabled on a Non-Broadcast Multiple Access (NBMA)
network.
● If both split horizon and poison reverse are configured, only poison reverse takes effect.
----End
4.7.2 Configuring Poison Reverse
Context
Poison reverse can prevent routing loops.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng poison-reverse
Poison reverse is enabled.
NOTE
If both split horizon and poison reverse are configured, only poison reverse takes effect.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 142
4.7.3 Verifying the RIPng Routing Loop Prevention
Configuration
Procedure
● Run the display ripng
process-id interface [
interface-type interface-
number ] [ verbose ] command to check information about the specified
RIPng interface.
----End
4.8 Controlling RIPng Routing
Pre-configuration Tasks
Before configuring RIPng route attributes, configure basic RIPng functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIPng Routing Control Configuration) in any sequence as required.
4.8.1 Configuring RIPng Preference
Context
When different routing protocols discover the routes to the same destination, set
the RIPng preference to select the required route.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
The RIPng view is displayed.
Step 3 Run preference {
preference | route-policy
route-policy-name } *
The RIPng preference value is set.
By default, the RIPng preference value is 100.
----End
4.8.2 Configuring Additional Metrics of an Interface
Context
Configuring the additional metrics of a RIPng interface can change the route
selection sequence.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 143
The additional metric is the metric (hop count) to be added to the original metric
of a RIPng route. You can set additional metrics for incoming and outgoing RIPng
routes using commands.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run the following commands as required:
● Run the ripng metricin
value command to set the additional metric for
receiving routes. By default, an interface does not add the metric to a received
RIPng route.
● Run the ripng metricout {
value | {
acl6-number | acl6-name
acl6-name |
ipv6-prefix
ipv6-prefix-name }
value1 } command to set the additional metric
for advertising routes. By default, the metric that is added to the RIPng route
sent by an interface is 1.
NOTE
● The ripng metricin command adds an additional metric to an incoming route. After this
route is added to the routing table, its metric in the routing table changes. Running this
command affects route selection on the local device and other devices on the network.
● The ripng metricout command adds an additional metric to an outgoing route. When
this route is advertised, an additional metric is added to this route, but the metric of the
route in the routing table does not change. Running this command does not affect route
selection on the local device but other devices on the network.
----End
4.8.3 Setting the Maximum Number of Equal-Cost Routes
Context
By setting the maximum number of equal-cost RIPng routes, you can change the
number of routes for load balancing.
NOTE
Only the S5720I-SI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S,
S5731S-H, S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and
S6730S-S support this function.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 144
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
RIPng is enabled and the RIPng view is displayed.
Step 3 Run maximum load-balancing
number
The maximum number of equal-cost routes is set.
The default value is 8.
----End
4.8.4 Verifying the RIPng Routing Control Configuration
Procedure
● Run the display ripng [
process-id | vpn-instance
vpn-instance-name ]
command to check the running status and configurations of RIPng.
● Run the display ripng
process-id database [ verbose ] command to check all
the active routes in the RIPng database.
● Run the display ripng
process-id route command to check all RIPng routes
learned from other devices.
----End
4.9 Controlling RIPng Route Advertisement
Pre-configuration Tasks
Before controlling RIPng route advertisement, configure basic RIPng functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIPng Route Advertisement Control Configuration) in any sequence as
required.
4.9.1 Configuring RIPng Route Summarization
Context
Route summarization can reduce the routing table size and minimize impact of
route flapping on the network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 145
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng summary-address
ipv6-address prefix-length [ avoid-feedback ]
RIPng route summarization is configured.
By default, a RIPng router does not advertise summarized IPv6 addresses.
----End
4.9.2 Advertising a Default Route
Context
In an IPv6 routing table, a default route is a route to network ::/0. If the
destination address of a packet does not match any entry in the routing table, the
packet is sent through a default route.
There are two methods to advertise RIPng default routes. You can configure a
device to advertise RIPng default routes according to networking requirements.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 146
Step 4 Run ripng default-route { only | originate } [ cost
cost ]
The device is configured to advertise RIPng default routes.
By default, there is no default route in the RIPng routing domain.
Configure the device to advertise default routes according to networking
requirements:
● only: configures the device to advertise only IPv6 default routes (::/0),
suppressing the advertisement of other routes. If the local device is located on
the network edge and the details of the local network need to be hidden, you
can set this parameter to enable the devices on other networks to access the
local network only through the local device.
● originate: configures the device to advertise IPv6 default routes (::/0) without
affecting the advertisement of other routes. If the local device is located on
the network edge and some details of the local network need to be hidden,
you can set this parameter to enable the devices on other networks to use the
default route when connecting to certain devices on the local network.
The device advertises generated RIPng default routes using Update packets
through a specified interface regardless of whether these routes exist in the local
IPv6 routing table.
----End
4.9.3 Configuring a RIPng Process to Import External Routes
Context
A RIPng process can import the routes learned by other processes or routing
protocols to enrich its routing information.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
The RIPng view is displayed.
Step 3 (Optional) Run default-cost
cost
The default cost of external routes to be imported is set.
By default, the default cost of RIPng routes is 0.
If no cost is set for external routes to be imported, the default cost is used.
NOTE
When a RIPng process imports IBGP routes, routing loops may occur. Therefore, exercise
caution before you configure this function.
Step 4 Run import-route { { ripng | isis | ospfv3 } [
process-id ] | bgp [ permit-ibgp ] |
unr | direct | static } [ [ cost
cost | inherit-cost ] | route-policy
route-policy-
name ] *
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 147
External routes are imported.
Step 5 (Optional) Run filter-policy {
acl6-number | acl6-name
acl6-name | ipv6-prefix
ipv6-prefix-name | route-policy
route-policy-name } export [
protocol [
process-
id ] ]
The RIPng process is configured to filter imported routes.
A RIPng process can use ACL6, route policy and IPv6 prefix lists to filter imported
routes, allowing only the routes matching ACL6, route policy and IPv6 prefix lists
to be advertised to RIPng neighbors. If
protocol is not specified, the RIPng process
filters all the routes to be advertised, including imported routes and local RIPng
routes (similar to direct routes).
----End
4.9.4 Disabling Sending of RIPng Packets on an Interface
Context
When a device running RIPng is connected to a network running other routing
protocols, you can run the undo ripng output command on the interface that
connects the device to the network to prevent the interface from sending useless
packets to the network.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run undo ripng output
The interface is disabled from sending RIPng packets.
By default, an interface is allowed to send RIPng packets.
----End
4.9.5 Disabling Receiving of RIPng Packets on an Interface
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 148
Context
When a device running RIPng is connected to a network running other routing
protocols, you can run the undo ripng input command on the interface that
connects the device to the network to prevent the interface from receiving useless
packets from the network.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run undo ripng input
The interface is disabled from receiving RIPng packets.
By default, an interface is allowed to receive RIPng packets.
----End
4.9.6 Verifying the RIPng Route Advertisement Control
Configuration
Procedure
● Run the display ripng
process-id database [ verbose ] command to check all
activated routes in the RIPng database.
● Run the display ripng
process-id route command to check all the RIPng
routes that are learned from other switches.
----End
4.10 Controlling the Receiving of RIPng Routes
Pre-configuration Tasks
Before controlling the receiving of RIPng routes, configure basic RIPng functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 149
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ]
The RIPng view is displayed.
Step 3 Run filter-policy {
acl6-number | acl6-name
acl6-name | ipv6-prefix
ipv6-prefix-
name | route-policy
route-policy-name } import
The RIPng process is configured to filter received routes.
You can use ACL6, route policy and IPv6 prefix lists to filter received RIPng routes,
allowing only the routes matching ACL6, route policy and IPv6 prefix lists to be
added to RIPng routing tables.
----End
Verifying the Configuration
● Run the display ripng
process-id database [ verbose ] command to check all
the active routes in the RIPng database.
● Run the display ripng
process-id route command to check all the RIPng
routes learned from other switches.
4.11 Improving RIPng Network Performance
Pre-configuration Tasks
Before improving RIPng network performance, configure basic RIPng functions.
Configuration Procedure
You can perform the following configuration tasks (excluding the task of Verifying
the RIPng Network Performance Optimization Configuration) in any sequence as
required.
4.11.1 Configuring RIPng Timers
Context
RIPng uses 3 timers: Update, Age, and Garbage-collect. Changing the timer values
affects the convergence speed of RIPng routes.
Procedure
Step 1 Run system-view
The system view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 150
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
The RIPng process is enabled and the RIPng view is displayed.
Step 3 Run timers ripng
update age garbage-collect
RIPng timers are configured.
NOTE
● RIPng timers take effect immediately after being changed.
● Route flapping occurs if the values of the three timers are set improperly. The
relationship between the values is:
update must be smaller than
age and
garbage-
collect. If the update time is longer than the aging time and for example, a RIPng route
changes within the update time, the switch cannot inform its neighbors of the change
on time.
● Configure RIPng timers based on the network performance ensure that these timers are
consistent on all RIPng devices. This avoids unnecessary network traffic or route
flapping.
By default, the Update timer is 30s; the Age timer is 180s; the Garbage-collect
timer is 120s (four times the Update timer).
In practice, the Garbage-collect timer is not fixed. If the Update timer is set to 30s,
the Garbage-collect timer may range from 90s to 120s.
Before permanently deleting an unreachable route from its RIPng routing table, a
RIPng device advertises this route (with the metric set to 16) four times by
periodically sending Update packets. Subsequently, all the neighbors learn that
this route is unreachable. Because a route may not always become unreachable at
the beginning of an Update period, the Garbage-collect timer ranges from three
or four times the Update timer.
----End
4.11.2 Setting the Interval for Sending Update Packets and
Maximum Number of Sent Packets
Context
To limit memory resources occupied by RIPng Update packets, set the interval for
sending RIPng Update packets and the maximum number of Update packets to be
sent at a time to appropriate values.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 151
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ripng pkt-transmit { interval
interval | number
pkt-count }*
The interval for sending RIPng Update packets and the maximum number of
Update packets to be sent at a time are set.
----End
4.11.3 Enabling Zero Field Check for RIPng Packets
Context
In a RIPng packet, some fields must be zero. These fields are called zero fields.
When receiving a packet, a RIPng process checks the zero fields of the packet. If
the value of a zero field in the packet is not 0, the RIPng process discards the
packet.
Enabling zero field check on RIPng Update packets can improve network security.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ripng [
process-id ] [ vpn-instance
vpn-instance-name ]
The RIPng view is displayed.
Step 3 Run checkzero
Zero field check is enabled for RIPng packets.
----End
4.11.4 Verifying the RIPng Network Performance
Optimization Configuration
Procedure
● Run the display ripng [
process-id | vpn-instance
vpn-instance-name ]
command to check the configuration of the RIPng process.
● Run the display ripng
process-id database [ verbose ] command to check all
activated routes in the RIPng database.
● Run the display ripng
process-id interface [
interface-type interface-
number ] [ verbose ] command to check information about the RIPng
interface.
● Run the display ripng
process-id neighbor [ verbose ] command to check
information about RIPng neighbors.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 152
● Run the display ripng
process-id route command to check all the RIPng
routes that are learned from other switches.
----End
4.12 Configuring IPSec Authentication for RIPng
4.12.1 Configuring an IPSec Session for Encryption
Context
Internet Protocol Security (IPSec) can be configured to prevent data theft and
spoofing during data transmission in a network.
A security association (SA) must be established so that IPSec can protect
transmitted data. An SA is a unidirectional logical connection set up for security
purpose and specifies the elements used by two IPSec peers (two parties that use
the IPSec protocol to protect data transmitted between them). The elements of an
SA include the following:
● Security protocol
● Authentication or encryption algorithm supported by the security protocol
● Data encapsulation mode
● Security parameter index (SPI) of the SA
● Authentication key or encryption key of the SA
The first three elements are specified in an IPSec proposal. To configure IPSec
functions, first configure an IPSec proposal on the IPSec peers, and then configure
an SA.
Procedure
Step 1 Configure an IPSec proposal.
1. Run system-view
The system view is displayed.
2. Run ipsec proposal
proposal-name
An IPSec proposal is created and the IPSec proposal view is displayed.
3. Run transform { ah | esp }
A security protocol is specified for the IPSec proposal.
By default, the security protocol used by an IPSec proposal is the
Encapsulation Security Protocol (ESP).
4. An authentication or encryption algorithm is configured.
– If AH is used, you can only configure the AH-specific authentication
algorithm because AH only authenticates packets.
Run the ah authentication-algorithm { sha1 | sha2-256 } command to
specify the authentication algorithm for the AH protocol.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 153
By default, the AH protocol uses the Secure Hash Algorithm 2-256
(SHA2-256) authentication algorithm.
– When ESP is specified, ESP can encrypt/authenticate, or encrypt and
authenticate packets. Configure the ESP-specific authentication or
encryption algorithm.
▪ Run the esp authentication-algorithm { sha1 | sha2-256 }
command to specify the authentication algorithm for the ESP
protocol.
By default, the authentication algorithm SHA2-256 is used for ESP.
▪ Run the esp encryption-algorithm { 3des | aes [ 128 | 192 | 256 ] }
command to specify the encryption algorithm for the ESP protocol.
By default, the encryption algorithm Advanced Encryption
Standard-256 (AES-256) is used for ESP.
The SHA-1 and 3DES algorithm is not recommended because it cannot meet
your security defense requirements.
5. Run encapsulation-mode { transport | tunnel }
A data encapsulation mode is specified for the security protocol.
By default, the data encapsulation mode is tunnel.
NOTE
In transport mode, the packet encryption device and decryption device must be the
originator and receiver of packets.
6. Run quit
Return to the system view.
Step 2 Configure an IPSec SA.
1. Run ipsec sa
sa-name
An IPSec SA is created and the IPSec SA view is displayed.
By default, no IPSec SA exists in the system.
2. Run proposal
proposal-name
The IPSec proposal is bound to the IPSec SA.
By default, an IPSec policy does not reference any IPSec proposal.
NOTE
An IPSec can use only one IPSec proposal. To bind a new IPSec proposal to the IPSec
SA, delete the original IPSec proposal.
3. Run sa spi { inbound | outbound } { ah | esp }
spi-number
An SPI is configured for the SA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 154
NOTE
– An SPI uniquely identifies an SA. Each SA must be configured with an inbound SPI
and an outbound SPI. The outbound SPI on the local end must be the same as the
inbound SPI on the remote end.
– The security protocol (AH or ESP) you select when configuring the SPI must be the
same as that used in the IPSec proposal bound to the SA.
4. Configure a key according to the security protocol used in the IPSec proposal
bound to the SA.
– If the AH protocol is used, you can configure an authentication key that is
a hexadecimal number or a character string.
▪ Run the sa authentication-hex { inbound | outbound } ah
[ cipher ]
hex-cipher-key command to configure a hexadecimal
authentication key.
▪ Run the sa string-key { inbound | outbound } ah [ cipher ]
string-
cipher-key command to configure a character string as the
authentication key.
– If the ESP protocol is used, you can run one of the following commands
to configure the authentication key or the encryption key. You can also
configure both the authentication key and encryption key. If the two keys
are configured at the same time, they can only be hexadecimal keys.
▪ Run the sa authentication-hex { inbound | outbound } esp
[ cipher ]
hex-cipher-key command to configure a hexadecimal
authentication key.
▪ Run the sa string-key { inbound | outbound } esp [ cipher ]
string-
cipher-key command to configure a character string as the
authentication key.
▪ Run the sa encryption-hex { inbound | outbound } esp [ cipher ]
hex-cipher-key command to configure a hexadecimal encryption key.
NOTE
– The security protocol (AH or ESP) you select when configuring the key must be the
same as that used in the IPSec proposal bound to the SA.
– The outbound key on the local end must be the same as the inbound key on the
remote end.
– The IPSec peers must use the authentication or encryption key in the same format.
For example, if the key on one end is a character string but the key on the other
end is a hexadecimal number, the IPSec tunnel cannot be set up.
– If you configure multiple keys in different formats, the last configured key takes
effect.
Step 3 Verify the configuration.
1. Run the display ipsec sa [ name
sa-name ] [ brief ] command to check
information about the SA.
2. Run the display ipsec proposal [ name
proposal-name ] command to check
information about the security proposal.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 155
3. Run the display ipsec statistics [ sa-name
sa-name slot
slot-number ]
command to check statistics about packets processed by IPSec.
----End
4.12.2 Configuring RIPng IPSec Authentication
Context
As networks develop rapidly, network security has become a major concern. If
IPSec authentication is configured on a RIPng network, the sent and received
RIPng packets will be authenticated, and those cannot pass authentication will be
discarded. This can improve the security of the RIPng network.
There are two methods of configuring IPSec authentication for RIPng:
● One method is to configure IPSec authentication in RIPng processes. If IPSec
authentication is enabled in a RIPng process, this configuration takes effect on
all interfaces in this RIPng process. This method is recommended if IPSec
authentication needs to be applied to all interfaces in a RIPng process.
● The other method is to configure IPSec authentication on RIPng interfaces.
This method is recommended if IPSec authentication needs to be applied only
to some interfaces in a RIPng process.
Procedure
● Configuring IPSec authentication in a RIPng process
a. Run system-view
The system view is displayed.
b. Run ripng [
process-id ]
The RIPng view is displayed.
c. Run ipsec sa
sa-name
IPSec authentication is enabled, and the name of an SA is specified.
By default, IPSec authentication is disabled in a RIPng process.
● Configuring IPSec authentication on a RIPng interface
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 156
d. Run ripng ipsec sa
sa-name
IPSec authentication is enabled on the interface, and the name of an SA
is specified.
By default, IPSec authentication is disabled on a RIPng interface.
NOTE
The ripng ipsec sa command takes precedence over the ipsec sa command. If
both commands are run in respective views and different SA names are specified,
only the configuration of the ripng ipsec sa command takes effect.
----End
4.12.3 Verifying the RIPng IPSec Authentication Configuration
Procedure
● Run the display ipsec proposal [ name
proposal-name ] command to check
IPSec proposal information.
● Run the display ipsec sa [ name
sa-name ] [ brief ] command to check
information about a Security Association (SA).
● Run the display ipsec statistics [ sa-name
sa-name slot
slot-number ]
command to check statistics about packets processed by IPSec.
● Run the display ripng
process-id interface [
interface-type interface-
number ] [ verbose ] command to check the SA used in IPSec authentication.
● Run the display ripng
process-id statistics interface { all |
interface-type
interface-number [ verbose | neighbor
neighbor-ipv6-address ] } command
to check the number of RIPng packets that failed authentication.
----End
4.13 Clearing RIPng
Context
NOTICE
RIPng information cannot be restored after it is cleared. Exercise caution before
clearing RIPng information.
Procedure
● Run the reset ripng
process-id statistics [ interface {
interface-type
interface-number [ neighbor
neighbor-ip-address ] } ] command in the user
view to clear statistics about the counter that is maintained by a specified
RIPng process.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 157
4.14 Example for Configuring RIPng to Filter the
Received Routes
Networking Requirements
In Figure 4-1, the prefix length of all the IPv6 addresses is 64 bits, and the VLANIF
interfaces between neighboring Switches are assigned IPv6 link-local addresses.
All the Switches must learn IPv6 routing information on the network using RIPng.
SwitchB should filter the routes received from SwitchC (at FC00:0:0:3::/64). That is,
SwitchB does not add the routes to its own RIPng routing table or advertise the
routes to SwitchA.
Figure 4-1 Configuring RIPng to filter the received routes
Configuration Roadmap
The configuration roadmap is as follows:
1. Enable RIPng on each Switch so that the Switches can communicate with
each other.
2. Configure an ACL on SwitchB to filter the received routes.
Procedure
Step 1 Add interfaces to VLANs.
# Configure SwitchA. Ensure that the configurations of SwitchB, and SwitchC are
similar to the configuration of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 158
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/2] quit
[SwitchA] vlan 20
[SwitchA-vlan20] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign IP addresses to the VLANIF interfaces.
# Configure SwitchA. Ensure that the configurations of SwitchB, and SwitchC are
similar to the configuration of SwitchA.
[SwitchA] ipv6
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ipv6 enable
[SwitchA-Vlanif10] ipv6 address fc00:0:0:1::1/64
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ipv6 enable
[SwitchA-Vlanif20] ipv6 address auto link-local
[SwitchA-Vlanif20] quit
Step 3 Configure basic RIPng functions.
# Configure SwitchA.
[SwitchA] ripng 1
[SwitchA-ripng-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ripng 1 enable
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ripng 1 enable
[SwitchA-Vlanif20] quit
# Configure SwitchB.
[SwitchB] ripng 1
[SwitchB-ripng-1] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] ripng 1 enable
[SwitchB-Vlanif20] quit
[SwitchB] interface vlanif 30
[SwitchB-Vlanif30] ripng 1 enable
[SwitchB-Vlanif30] quit
# Configure SwitchC.
[SwitchC] ripng 1
[SwitchC-ripng-1] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] ripng 1 enable
[SwitchC-Vlanif30] quit
[SwitchC] interface vlanif 40
[SwitchC-Vlanif40] ripng 1 enable
[SwitchC-Vlanif40] quit
[SwitchC] interface vlanif 50
[SwitchC-Vlanif50] ripng 1 enable
[SwitchC-Vlanif50] quit
# Check the RIPng routing table of SwitchB.
[SwitchB] display ripng 1 route
Route Flags: R - RIPng
A - Aging, G - Garbage-collect
----------------------------------------------------------------
Peer FE80::D472:0:3C23:1 on Vlanif20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 159
Dest FC00:0:0:1::/64,
via FE80::D472:0:3C23:1, cost 1, tag 0, RA, 4 Sec
Peer FE80::F54C:0:9FDB:1 on Vlanif30
Dest FC00:0:0:2::/64,
via FE80::F54C:0:9FDB:1, cost 1, tag 0, RA, 3 Sec
Dest FC00:0:0:3::/64,
via FE80::F54C:0:9FDB:1, cost 1, tag 0, RA, 3 Sec
The preceding information shows that the RIPng routing table of SwitchB contains
the route of network segment FC00:0:0:3::/64.
# Check the RIPng routing table of SwitchA.
[SwitchA] display ripng 1 route
Route Flags: R - RIPng
A - Aging, G - Garbage-collect
----------------------------------------------------------------
Peer FE80::476:0:3624:1 on Vlanif20
Dest FC00:0:0:2::/64,
via FE80::476:0:3624:1, cost 2, tag 0, RA, 21 Sec
Dest FC00:0:0:3::/64,
via FE80::476:0:3624:1, cost 2, tag 0, RA, 21 Sec
The preceding information shows that the RIPng routing table of SwitchA contains
the route of network segment FC00:0:0:3::/64 advertised by SwitchB.
Step 4 Configure SwitchB to filter the received routes.
[SwitchB] acl ipv6 number 2000
[SwitchB-acl6-basic-2000] rule deny source fc00:0:0:3:: 64
[SwitchB-acl6-basic-2000] rule permit
[SwitchB-acl6-basic-2000] quit
[SwitchB] ripng 1
[SwitchB-ripng-1] filter-policy 2000 import
[SwitchB-ripng-1] quit
Step 5 Verify the configuration.
NOTE
After the aging time of the filtered routing entry expires, check the verification result. The
default aging time is 180 seconds.
# Check the RIPng routing table of SwitchB. The RIPng routing table should not
contain the route of network segment FC00:0:0:3::/64.
[SwitchB] display ripng 1 route
Route Flags: R - RIPng
A - Aging, G - Garbage-collect
----------------------------------------------------------------
Peer FE80::D472:0:3C23:1 on Vlanif20
Dest FC00:0:0:1::/64,
via FE80::D472:0:3C23:1, cost 1, tag 0, RA, 25 Sec
Peer FE80::F54C:0:9FDB:1 on Vlanif30
Dest FC00:0:0:2::/64,
via FE80::F54C:0:9FDB:1, cost 1, tag 0, RA, 14 Sec
# Check the RIPng routing table of SwitchA. The RIPng routing table should not
contain the route of network segment FC00:0:0:3::/64.
[SwitchA] display ripng 1 route
Route Flags: R - RIPng
A - Aging, G - Garbage-collect
----------------------------------------------------------------
Peer FE80::476:0:3624:1 on Vlanif20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 160
Dest FC00:0:0:2::/64,
via FE80::476:0:3624:1, cost 2, tag 0, RA, 7 Sec
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
vlan batch 10 20
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1::1/64
ripng 1 enable
#
interface Vlanif20
ipv6 enable
ipv6 address auto link-local
ripng 1 enable
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
ripng 1
#
return
● SwitchB configuration file
#
sysname SwitchB
#
ipv6
#
vlan batch 20 30
#
acl ipv6 number 2000
rule 0 deny source FC00:0:0:3::/64
rule 1 permit
#
interface Vlanif20
ipv6 enable
ipv6 address auto link-local
ripng 1 enable
#
interface Vlanif30
ipv6 enable
ipv6 address auto link-local
ripng 1 enable
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
ripng 1
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 161
filter-policy 2000 import
#
return
● SwitchC configuration file
#
sysname SwitchC
#
ipv6
#
vlan batch 30 40 50
#
interface Vlanif30
ipv6 enable
ipv6 address auto link-local
ripng 1 enable
#
interface Vlanif40
ipv6 enable
ipv6 address FC00:0:0:2::1/64
ripng 1 enable
#
interface Vlanif50
ipv6 enable
ipv6 address FC00:0:0:3::1/64
ripng 1 enable
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 40
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 50
#
ripng 1
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 4 RIPng Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 162
5 OSPF Configuration
5.1 Overview of OSPF
5.2 Understanding OSPF
5.3 Application Scenarios for OSPF
5.4 OSPF Deployment Guide
5.5 Summary of OSPF Configuration Tasks
5.6 Licensing Requirements and Limitations for OSPF
5.7 Default Settings for OSPF
5.8 Configuring Basic OSPF Functions
5.9 Configuring Session Parameters for OSPF Neighbor or Adjacency Relationships
5.10 Configuring OSPF Attributes on Different Types of Networks
5.11 Configuring OSPF Stub Areas
5.12 Configuring an OSPF NSSA
5.13 Configuring Local MT
5.14 Adjusting OSPF Route Selection
5.15 Controlling OSPF Routing Information
5.16 Configuring BFD for OSPF
5.17 Configuring OSPF IP FRR
5.18 Configuring OSPF Fast Convergence
5.19 Configuring OSPF GR
5.20 Improving Stability of an OSPF Network
5.21 Improving the Security of an OSPF Network
5.22 Configuring OSPF Neighbor Relationship Flapping Suppression
5.23 Suppressing the Advertisement of Interface IP Addresses
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 163
5.24 Configuring Network Management for OSPF
5.25 Maintaining OSPF
5.26 Configuration Examples for OSPF
5.27 Troubleshooting OSPF
5.1 Overview of OSPF
Definition
The Open Shortest Path First (OSPF) protocol is a link-state Interior Gateway
Protocol (IGP) developed by the Internet Engineering Task Force (IETF).
OSPF constructs network topologies and routing tables by:
● Dividing an Autonomous System (AS) into one or more logical areas
● Advertising routes by sending Link State Advertisements (LSAs)
● Exchanging OSPF packets between devices in an OSPF area to synchronize
routing information
● Encapsulating OSPF packets into IP packets and sending the packets in
unicast or multicast mode
OSPF Version 2, as defined in RFC 2328, is designed for IPv4. OSPF Version 3, as
defined in RFC 2740, is designed for IPv6. Unless otherwise stated, OSPF in this
document refers to OSPF Version 2.
Advantages
Before the introduction of OSPF, the Routing Information Protocol (RIP) was the
most widely used IGP. The rapid growth and expansion of networks have pushed
RIP to its limits. RIP has certain limitations that can cause problems in large
networks. OSPF can address many issues facing RIP. Table 5-1 compares RIP and
OSPF.
Table 5-1 RIP versus OSPF
RIP OSPF
RIP uses a distance-vector algorithm to
calculate routes and uses the hop
count as the metric, without
considering the bandwidth.
OSPF uses a link-state algorithm to
build and calculate the shortest path
to all known destinations. It uses the
link cost as the metric and considers
the bandwidth while calculating
routes.
RIP has a limit of 15 hops, which limits
the RIP network scale.
OSPF does not have the hop limit and
applies to large networks.
RIP updates and selects routes through
route advertisements. Routers do not
know the entire network topology,
which can easily cause routing loops.
Each router knows the entire network
topology and calculates routes using
the shortest path first (SPF) algorithm,
which can prevent routing loops.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 164
RIP OSPF
RIP converges slower than OSPF. Route
updates go through a period of a
hold-down and garbage collection.
This could cause routing
inconsistencies between routers.
OSPF converges faster than RIP
because route updates are propagated
instantaneously to the entire network.
RIP cannot handle variable length
subnet mask (VLSM).
OSPF can handle VLSM, which is
helpful in IP address allocation.
In addition to the preceding advantages, OSPF has the following characteristics:
● Multicast packet transmission, reducing the load on the switches not running
OSPF
● Classless Inter-Domain Routing (CIDR)
● Load balancing among equal-cost routes
● Packet authentication
5.2 Understanding OSPF
5.2.1 OSPF Fundamentals
5.2.1.1 OSPF Characteristics
In an OSPF network, each router generates a link-state advertisement (LSA) based
on its surrounding network topology and transmits this LSA in an update packet
to other routers in the network.
RIP devices exchange routes, whereas OSPF devices exchange link state
information. That is, in RIP, routers select routes based on routing information of
neighbors, without checking whether the information transmitted by neighbors is
correct. In OSPF, routers calculate routes by themselves and select routes based on
LSAs.
Each router learns about the whole network topology based on its link state
database (LSDB). In Figure 5-1, each router collects LSAs sent from other routers,
and all LSAs form the LSDB of this router. An LSA describes the surrounding
network topology of a router, whereas an LSDB describes the network topology of
the entire AS. A router transforms its LSDB into a weighted and directed graph,
which reflects the topology of the entire AS. When the network topology is stable,
all routers in the same area have the same graph.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 165
Figure 5-1 Obtaining the whole network topology through an LSDB
A router calculates shortest paths to destinations using a shortest path first (SPF)
algorithm instead of obtaining routing information through route advertisements.
In Figure 5-2, based on the weighted and directed graph, each router uses an SPF
algorithm to calculate a shortest path tree (SPT) with itself as the root. The SPT
shows routes to nodes in the AS. This mechanism greatly improves routers'
capabilities in independent route selection and frees routers from selecting routes
based on route advertisements.
Figure 5-2 Calculating shortest paths to destinations using an SPF algorithm
An LSDB ensures that a router can learn about the whole network topology, and
an SPF algorithm ensures that a router can quickly calculate shortest paths to
destinations.
5.2.1.2 OSPF Mechanism
The OSPF mechanism includes the following steps:
1. Exchanging Hello packets to establish OSPF neighbor relationships
In Figure 5-3, after OSPF is run on the four routers, these routers send Hello
packets on all OSPF-enabled interfaces. If two routers share a data link and
successfully negotiate certain parameters specified in their Hello packets, they
establish an OSPF neighbor relationship.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 166
Figure 5-3 Exchanging Hello packets to establish OSPF neighbor relationships
2. Flooding LSAs to advertise link state information
Routers that have established an OSPF neighbor relationship can exchange
LSAs to form an OSPF adjacency, as shown in Figure 5-4. Each router
generates LSAs based on its surrounding network topology. LSAs describe
information about a router, including all links, interfaces, neighbors, and link
state of the router. Routers exchange the link information to learn about the
entire network topology. Because of the link diversity, OSPF defines multiple
LSA types. For details, see 5.2.1.9 OSPF LSA Types.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 167
Figure 5-4 Flooding LSAs to advertise link state information
3. Forming an LSDB to create a weighted and directed graph
A router floods LSAs and records received LSAs in its LSDB. Subsequently, all
routers have the same LSDB, as shown in Figure 5-5. An LSA describes the
surrounding network topology of a router, whereas an LSDB describes the
network topology of the entire AS and is the summary of LSAs.
Figure 5-5 Forming an LSDB to create a weighted and directed graph
4. Using an SPF algorithm to calculate and generate routes
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 168
In Figure 5-6, after LSDB synchronization is complete, each router uses an
SPF algorithm to calculate a loop-free topology with itself as the root and
describe the shortest path (with the minimum path cost) to each destination.
The topology is the SPT, which shows the optimal paths to nodes in an AS.
Figure 5-6 Using an SPF algorithm to calculate and generate routes
5. Maintaining and updating routing tables
After each router uses an SPF algorithm to calculate the SPT, it installs the
shortest paths in its routing table. These paths are installed as routing entries
to guide data forwarding. The routers then update their routing tables in real
time, as shown in Figure 5-7. Meanwhile, neighbors exchange Hello packets
to maintain their neighbor relationships or adjacencies and periodically
retransmit LSAs.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 169
Figure 5-7 Maintaining and updating routing tables
5.2.1.3 OSPF Packet Types
OSPF uses five packet types:
● Hello packet
OSPF uses Hello packets to implement the following functions:
– Neighbor discovery: OSPF routers periodically send Hello packets on
every OSPF-enabled interface, and negotiate the specific parameters in
the Hello packets with other routers that receive Hello packets to
determine whether to establish an OSPF neighbor relationship.
– Bidirectional communications: If a router sees its own router ID in the
neighbor list of a received Hello packet, bidirectional communication has
been established between this receiving router and the router that
originates the packet. An OSPF neighbor relationship has been
established between the two routers.
– Designated router (DR) and backup designated router (BDR) election:
Hello packets contain information about the DR priority and router ID.
Each router writes its selected DR and BDR to the DR and BDR fields of
Hello packets for DR and BDR election. For details, see 5.2.1.5 DR/BDR
Election.
– Keepalives: After an OSPF neighbor relationship is established, OSPF-
enabled interfaces still periodically send Hello packets to maintain the
neighbor relationship. If an interface does not receive a Hello packet from
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 170
a neighbor within a certain period, it terminates the neighbor relationship
with this neighbor.
● Database Description (DD) packet
During adjacency initialization, two routers send DD packets to negotiate
their master/slave relationship. In this phase, the DD packets contain only an
LSA header. When two routers exchange DD packets, one functions as the
master and the other functions as the slave. The master defines a start
sequence number and increments the sequence number by 1 each time it
sends a DD packet. After the slave receives a DD packet, it uses the sequence
number carried in the DD packet for acknowledgement.
After an adjacency is established, routers use DD packets to describe their
own LSDBs for LSDB synchronization. A DD packet contains the header of
each LSA in an LSDB and is the summary of all LSAs. An LSA header uniquely
identifies an LSA. The LSA header occupies only a small portion of the LSA,
which reduces the amount of traffic transmitted between routers. A neighbor
can use the LSA header to check whether it already has the LSA.
● Link State Request (LSR) packet
After two routers have exchanged DD packets, they send LSR packets to
request each other's LSAs. The LSR packets contain the summaries of the
requested LSAs.
● Link State Update (LSU) packet
A router uses an LSU packet to transmit LSAs requested by its neighbors or to
flood its own updated LSAs. The LSU packet contains a set of LSAs. To ensure
reliable LSA flooding, the router uses an LSAck packet to acknowledge the
LSAs contained in an LSU packet that it received from a neighbor. If an LSA
fails to be acknowledged, the router directly retransmits the LSA to the
neighbor.
● Link State Acknowledgement (LSAck) packet
A router uses an LSAck packet to acknowledge the LSAs contained in a
received LSU packet. The LSAs can be acknowledged using LSA headers.
5.2.1.4 OSPF Network Types
OSPF classifies networks into four types, depending on the link layer protocols:
● Broadcast
OSPF defaults networks using Ethernet or Fiber Distributed Data Interface
(FDDI) at the link layer to broadcast networks.
On broadcast networks:
– Hello packets, LSU packets, and LSAck packets are sent in multicast
mode. The address 224.0.0.5 is the IP multicast address reserved for OSPF
DR others. The address 224.0.0.6 is the IP multicast address reserved for
OSPF DRs or BDRs.
– DD and LSR packets are sent in unicast mode.
● Non-Broadcast Multi-Access (NBMA)
OSPF defaults networks using frame relay (FR) or X.25 at the link layer to
NBMA networks.
On NBMA networks, protocol packets such as Hello packets, DD packets, LSR
packets, LSU packets, and LSAck packets are all sent in unicast mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 171
● Point-to-Multipoint (P2MP)
OSPF does not default a network to a P2MP network regardless of the link
layer protocol used by the network. A P2MP network must be changed from
another network type. It is a typical practice to change partial-meshed NBMA
networks to P2MP networks.
On P2MP networks:
– Hello packets are transmitted in multicast mode using the multicast
address 224.0.0.5.
– DD packets, LSR packets, LSU packets, and LSAck packets are sent in
unicast mode.
● Point-to-Point (P2P)
OSPF defaults networks using Point-to-Point Protocol (PPP), High-Level Data
Link Control (HDLC), or Link Access Procedure Balanced (LAPB) at the link
layer to P2P networks.
On P2P networks, protocol packets such as Hello packets, DD packets, LSR
packets, LSU packets, and LSAck packets are all sent in multicast mode using
the multicast address 224.0.0.5.
5.2.1.5 DR/BDR Election
Router ID
During DR/BDR election, if two routers use the same DR priority, they need to
compare their router IDs, and the router with a larger router ID will become the
DR or BDR.
A router ID is a 32-bit integer used to uniquely identify an OSPF router in an AS.
Each OSPF router has a router ID, which is in the same format as an IP address.
An OSPF router ID can be manually configured or automatically selected. To
ensure OSPF stability, you are advised to manually configure the IP address of a
loopback interface as the router ID.
If no OSPF router ID is manually configured for a router, the router selects the
global router ID as its OSPF router ID. If both the OSPF router ID and global router
ID are not configured, the router selects a router ID based on specified rules. For
details, see 1.2.13 Router ID.
In any of the following situations, the router ID is re-selected:
● The ospf router-id
router-id command is run to reconfigure the OSPF router
ID, and the OSPF process is restarted.
● The global router ID is reconfigured, and the OSPF process is restarted.
● The IP address used as the original global router ID is deleted, and the OSPF
process is restarted.
Reason for DR/BDR Election
On broadcast and NBMA networks, any two routers need to exchange routing
information. As shown in Figure 5-8, there are
n routers that need to establish
n x
(
n - 1)/2 adjacencies. A route change on any router is transmitted to the other
routers, which consumes bandwidth resources.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 172
To solve this problem, the concept of DR is defined in OSPF. After a DR is elected,
all the other routers send routing information only to the DR, and the DR
broadcasts LSAs.
To prevent service interruption caused by DR re-election if the DR fails, a BDR is
also elected during DR election. The routers, excluding the DR and BDR, are called
DR others. The DR others do not establish adjacencies or exchange any routing
information with each other. This reduces the number of adjacencies established
between routers on broadcast and NBMA networks.
Figure 5-8 DR/BDR election
DR/BDR Election Principles
To ensure stable DR/BDR election on broadcast and NBMA networks, OSPF defines
three election principles: election, non-preemption, and inheritance.
Election Principle
The DR and BDR are not designated manually, but are elected by all routers on
the local network segment. In Figure 5-9, DR priorities of router interfaces
determine whether the interfaces are qualified for DR/BDR election. Routers with
DR priorities greater than 0 on the local network segment can be considered as
candidates. The ballots in this election are performed using Hello packets. Each
router adds elected DR information to a Hello packet and sends the packet to
other routers on the network segment. When two routers on the same network
segment declare that they are the DR, the router with a higher DR priority is
elected as the DR. If the two routers have the same DR priority, the router with
the greater router ID is elected as the DR. The router whose DR priority is 0
cannot be elected as the DR or BDR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 173
Figure 5-9 Election principle
Non-preemption Principle
A router newly added to a network segment does not initiate a new election.
Instead, it checks whether a DR exists on the network segment. In Figure 5-10, a
DR exists on the network segment. Even if the DR priority of the newly added
router is higher than that of the existing DR, the newly added router does not
declare itself the DR, and acknowledges the existing DR. Routers on a network
segment establish adjacencies only with the DR and BDR. If the DR changes
frequently, all routers on the network segment need to establish adjacencies with
the new DR and BDR accordingly. As a result, a large number of OSPF packets are
transmitted on the network segment within a short period of time, consuming
bandwidth resources. The non-preemption principle improves network stability
and conserves bandwidth resources. On a broadcast or NBMA network, the two
routers that are qualified for DR election and start first become the DR and BDR
respectively.
Figure 5-10 Non-preemption principle
Inheritance Principle
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 174
If the DR on a network segment fails, the BDR is elected as the DR, and the other
routers compete to become the new BDR, as shown in Figure 5-11. This principle
prevents frequent DR elections and enables the BDR to become the new DR when
the DR fails, ensuring the DR stability. Because LSDBs of the DR and BDR are fully
synchronized, the BDR can immediately become the new DR when the DR fails,
providing the DR functions. The time consumed from role change to service
switching is short because adjacencies have been established. Meanwhile, a new
BDR will be elected after the original BDR becomes the DR. The new BDR election
process consumes a relatively long time, but route calculation is not affected.
Figure 5-11 Inheritance principle
DR/BDR Election Process
The DR/BDR election process on a broadcast or NBMA network is as follows:
1. After an interface goes Up, it sends a Hello packet and enters the Waiting
state. In Waiting state, a wait timer is triggered. The wait timer value is the
same as the dead timer value. The default wait timer value is 40 seconds and
cannot be changed. For details about OSPF interface status, see OSPF
Interface State Machine.
2. Before the wait timer is triggered, sent Hello packets do not contain DR or
BDR information. In Waiting state, if a received Hello packet contains DR and
BDR information, the interface directly acknowledges the DR and BDR on the
network, and does not trigger election. The interface directly exits the Waiting
state and starts neighbor synchronization.
3. Assume that a DR and a BDR exist on the network. A router newly connected
to the network acknowledges the existing DR and BDR regardless of its router
ID or DR priority.
4. If the DR fails and goes Down, the BDR takes over the role of the DR. The
other routers with DR priorities greater than 0 then compete to become the
new BDR.
5. DR election rules are used to elect a DR only when routers with different
router IDs or DR priorities are started at the same time. The election rules
state that the device with the highest DR priority is elected as the DR and the
device with the second highest DR priority as the BDR. A router with a DR
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 175
priority of 0 can only be a DR other. If routers have the same DR priority, the
router with the largest router ID is elected as the DR, the router with the
second largest router ID becomes the BDR, and other routers are DR others.
Verifying the DR/BDR Election Process
In Figure 5-12, five routers establish a broadcast network. R5 works as a Layer 2
device, and R1 to R4 work as routers. R1 to R4 are in OSPF area 0.
Figure 5-12 DR/BDR election networking
DR and BDR Are Properly Elected on the Network
Assume that interfaces on R1 to R4 have been configured. Only OSPF
configurations are provided here.
● R1 configuration
#
ospf 1 Router ID 10.1.1.1
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
● R2 configuration
#
ospf 1 Router ID 10.2.2.2
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
● R3 configuration
#
ospf 1 Router ID 10.3.3.3
area 0.0.0.0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 176
network 192.168.1.0 0.0.0.255
#
● R4 configuration
#
ospf 1 Router ID 10.4.4.4
area 0.0.0.0
network 192.168.1.0 0.0.0.255
#
After the configurations are complete and the network is stable, check the
DR/BDR election status.
# Check OSPF neighbor information on R1. The following command output shows
that DR/BDR election has been completed. R1 is the DR, R2 is the BDR, and R3
and R4 are DR others. R1 and R2 are elected as the DR and BDR respectively
because of their startup sequence. In this example, R1, R2, R3, and R4 are started
consecutively. Therefore, R1 and R2 complete initialization first and become the
DR and BDR, respectively.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:22:16
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:21:30
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 1
DR: 192.168.1.1 BDR: 192.168.1.2 MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:20:24
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that the neighbor relationships between R1 and the other
three routers and those between R2 and the other three routers are in Full state,
and the neighbor relationship between R3 and R4 is in 2-Way state. The states
indicate that the DR and BDR establish adjacencies with other routers, and DR
others only establish neighbor relationships with each other. For details about
OSPF neighbor status, see OSPF Neighbor State Machine.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 177
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
BDR Cannot Be Elected on the Network
If the ospf dr-priority command is run on GE0/0/1 of R2, R3, and R4 to set the
interface DR priority to 0, the three routers are unqualified for DR/BDR election
and can only work as DR others. Only one router (R1) on the network is qualified
for DR/BDR election.
# Check OSPF neighbor information on R1. The following command output shows
that R1 is the DR. The BDR field is displayed as None, indicating that no BDR
exists on the network.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:04:31
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:03:45
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 178
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 0
DR: 192.168.1.1 BDR: None MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:03:36
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that R2, R3, and R4 each establish an adjacency with R1,
the corresponding states are Full, and the states of neighbor relationships among
R2, R3, and R4 are 2-Way.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 Full
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 Full
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 Full
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
In conclusion, if only one router on a broadcast or NBMA network is qualified for
DR/BDR election, the router becomes the DR, no BDR exists on the network, and
all the other routers establish adjacencies only with the DR.
No DR or BDR Can Be Elected on the Network
On the basis of the preceding configuration, if the ospf dr-priority command is
executed on GE0/0/1 of R1 to set the interface DR priority to 0, R1 is also
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 179
unqualified for DR/BDR election. No router on the network is qualified for DR/BDR
election.
# Check OSPF neighbor information on R1. The following command output shows
that both the DR and BDR fields are displayed as None, indicating that no DR or
BDR exists on the network.
<R1> display ospf peer
OSPF Process 1 with Router ID 10.1.1.1
Neighbors
Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0/0/1)'s neighbors
Router ID: 10.2.2.2 Address: 192.168.1.2
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 38 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
Router ID: 10.3.3.3 Address: 192.168.1.3
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 35 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
Router ID: 10.4.4.4 Address: 192.168.1.4
State: Full Mode:Nbr is Master Priority: 0
DR: None BDR: None MTU: 0
Dead timer due in 33 sec
Retrans timer interval: 5
Neighbor is up for 00:00:00
Authentication Sequence: [ 0 ]
# Check brief OSPF neighbor information on R1, R2, R3, and R4. The following
command output shows that all neighbor relationships are in 2-Way state, no
adjacency can be established on the network, and routers cannot exchange
routing information.
<R1> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.1.1.1
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R2> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.2.2.2
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R3> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.3.3.3
Peer Statistic Information
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 180
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.4.4.4 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
<R4> display ospf 1 peer brief
OSPF Process 1 with Router ID 10.4.4.4
Peer Statistic Information
----------------------------------------------------------------------------
Area Id Interface Neighbor id State
0.0.0.0 GigabitEthernet0/0/1 10.1.1.1 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.2.2.2 2-Way
0.0.0.0 GigabitEthernet0/0/1 10.3.3.3 2-Way
----------------------------------------------------------------------------
Total Peer(s): 3
In conclusion, if no router on a broadcast or NBMA network is qualified for
DR/BDR election, the network has no DR or BDR, and routers on the network do
not establish adjacencies. In this case, all neighbor relationships among these
routers are in 2-Way state.
5.2.1.6 OSPF State Machine
OSPF Interface State Machine
An OSPF device obtains link information from an interface and then establishes
adjacencies with neighbors to exchange the link information. Before establishing
adjacencies, these devices need to determine their roles to establish connections.
The State field in OSPF interface information (displayed using the display ospf
interface command) indicates the function of an OSPF device on a link.
The OSPF interface state machine has the following states:
● Down: This state is the initial state of an OSPF interface. If an OSPF interface
is Down, it is unavailable and cannot receive or transmit traffic.
● Loopback: An OSPF interface that connects a device to a network is in
Loopback state. A loopback interface cannot transmit data but its IP address
can be advertised using Router-LSAs. Therefore, other devices can learn about
paths to this IP address during a connectivity test.
● Waiting: The device is determining the DR and BDR on the network. Before
the device participates in DR and BDR election, the wait timer starts on an
OSPF interface. Before this timer expires, the Hello packets sent by this device
do not contain DR and BDR information, and the device cannot be elected as
the DR or BDR. This prevents the existing DR and BDR on the link from being
changed unnecessarily and ensures stability. This state exists only on NBMA
and broadcast networks.
● P-2-P: An OSPF interface is connected to a P2P network or virtual link. In this
situation, the device establishes an adjacency with the device on the other
end of the link. This state exists only on P2MP networks.
● DROther: The device is not elected as the DR or BDR. This device will
establish an adjacency with the DR and BDR.
● BDR: The device functions as the BDR on the network and will become the
new DR if the existing DR fails. This device establishes adjacencies with all the
other devices on the network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 181
● DR: The device functions as the DR on the network. This device establishes
adjacencies with all the other devices on the network.
OSPF interfaces alternate among the preceding states based on the InputEvents
(IEs), forming an efficient interface state machine, as shown in Figure 5-13.
Figure 5-13 OSPF interface state machine
Table 5-2 lists the IEs triggering interface state switchovers.
Table 5-2 InputEvents triggering OSPF interface state switchovers
InputEvent Description
IE1 InterfaceUP: Lower-layer protocols indicate that an OSPF interface
is available.
IE2 WaitTimer: The wait timer expires, indicating that the DR/BDR
election waiting time ends.
IE3 BackupSeen: The device with an OSPF interface has detected
whether there is a BDR on the network. This event occurs in either
of the following situations:
● The OSPF interface receives a Hello packet from a neighbor,
and the neighbor declares itself the BDR.
● The OSPF interface receives a Hello packet from a neighbor,
and the neighbor declares itself the DR but no BDR is specified.
Both situations indicate that neighbors have communicated with
each other and the Waiting state ends.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 182
InputEvent Description
IE4 The device is elected as the DR on the network.
IE5 The device is elected as the BDR on the network.
IE6 The device is not elected as the DR or BDR on the network.
IE7 NeighborChange: An interface-related neighbor relationship
change event occurs, indicating that the DR and BDR need to be
elected again. The following neighbor relationship changes may
result in DR/BDR re-election:
● The device implements bidirectional communication with a
neighbor.
● Bidirectional communication between the device and a
neighbor is interrupted.
● The device detects that the neighbor declares itself the DR or
BDR based on the Hello packet received by the neighbor.
● The device detects that the neighbor declares itself not the DR
or BDR based on the Hello packet sent by the neighbor.
● The device detects that the DR priorities of all neighbors have
changed based on the Hello packets sent by the neighbors.
IE8 UnLoopInd: The NMS or lower-layer protocols indicate that the
interface is not in Loopback state any longer.
IE9 InterfaceDown: Lower-layer protocols indicate that the interface is
unavailable. Any state may change to the Down state after this
event is triggered.
IE10 LoopInd: The NMS or lower-layer protocols indicate that the
interface is in Loopback state. Any state may change to the
Loopback state after this event is triggered.
OSPF Neighbor State Machine
On an OSPF network, neighbors establish adjacencies through neighbor state
switchovers, and then exchange LSAs.
The State field in OSPF neighbor information (displayed using the display ospf
peer command) indicates the neighbor status of an OSPF device.
The OSPF neighbor state machine has the following states:
● Down: This is the initial state of a neighbor session. This state occurs when a
device does not receive any Hello packets from its neighbors within a dead
interval. Only OSPF routers on an NBMA network send Hello packets to
neighbors at each poll interval, including the neighbors in Down state.
● Attempt: This state is only used on NBMA networks where neighbors are
manually configured. When the neighbor relationship is in Attempt state, an
OSPF router sends a Hello packet to its manually configured neighbors at
each Hello interval, attempting to establish neighbor relationships.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 183
● Init: This state occurs after the router has received a Hello packet from its
neighbor but has not established a two-way session. In Init state, the
neighbor does not receive any Hello packet from this router, and the neighbor
list in the received Hello packet does not contain the router ID of the local
router.
● 2-Way: This state occurs when a router and its neighbor receive Hello packets
containing their own router IDs from each other and establish an OSPF
neighbor relationship. If no adjacency needs to be established, the two
neighbors remain in 2-Way state. If an adjacency needs to be established, the
neighbor enters the Exstart state. The DR and BDR are elected only when the
neighbor state is 2-Way or higher.
● ExStart: This state occurs when two neighbors start to negotiate their master/
slave roles and determine the sequence numbers of DD packets. Entering the
Exstart state is the first step in setting up an adjacency.
● Exchange: This state occurs when two neighbors exchange DD packets. In this
state, DD packets contain LSDB information.
● Loading: This state occurs when two neighbors are synchronizing their LSDBs.
The two devices send LSR packets to request LSAs from each other to
synchronize their LSDBs.
● Full: This state occurs when two neighbors complete their LSDB
synchronization and establish an adjacency.
Figure 5-14 shows an OSPF neighbor state machine.
Figure 5-14 OSPF neighbor state machine
Table 5-3 lists the IEs triggering neighbor state switchovers.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 184
Table 5-3 InputEvents triggering OSPF neighbor state switchovers
InputEvent Description
IE1 Start: A router sends a Hello packet to its neighbors at each Hello
interval, attempting to establish neighbor relationships. This event
exists only on NBMA networks.
IE2 HelloReceived: The router receives a Hello packet from a neighbor.
IE3 2-WayReceived: The router receives a Hello packet containing its
router ID from a neighbor and implements two-way
communication with this neighbor. The router then determines its
neighbor state:
● IE3(Y): If the router needs to establish an adjacency with the
neighbor, it changes its neighbor state to Exstart.
● IE3(N): If the router does not need to establish an adjacency
with the neighbor, it changes its neighbor state to 2-Way.
IE4 NegotiationDone: The two neighbors have negotiated their
master/slave roles and exchanged sequence numbers of DD
packets.
IE5 ExchangeDone: The two neighbors have exchanged their DD
packets. One of the two routers then determines its neighbor
state:
● IE5(Y): If the link state request list is empty, the router changes
its neighbor state to Full, indicating that all link state data has
been exchanged and an adjacency has been established.
● IE5(N): If the link state request list is not empty, the router
changes its neighbor state to Loading and begins or continues
sending LSR packets to its neighbor, requesting link state data
that the local router does not have.
IE6 LoadingDone: The link state request list is empty.
5.2.1.7 OSPF Adjacency Establishment
OSPF Neighbor Relationship
OSPF routers periodically send Hello packets on every OSPF-enabled interface, and
negotiate the specific parameters, including the area ID, authentication method,
Hello packet interval, and dead interval, in the Hello packets with other routers
that receive Hello packets. If the negotiation succeeds, the receiving router adds
the router ID of the originating router to the neighbor list of the returned Hello
packet. The two routers then establish bidirectional communication and an OSPF
neighbor relationship. If a router does not receive a Hello packet from its neighbor
within the dead interval, the router terminates the neighbor relationship with this
neighbor.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 185
OSPF Adjacency
After establishing an OSPF neighbor relationship, two neighbors need to exchange
DD packets and LSAs to establish an adjacency.
Not all neighbors establish adjacencies. Whether neighbors establish adjacencies
depends on the network type and DR/BDR establishment. On P2P and P2MP links,
all devices need to exchange LSAs and establish only adjacencies. On broadcast
and NBMA links, DR others do not need to exchange LSAs and establish only
neighbor relationships. LSAs need to be exchanged between the DR and BDR, and
between the DR, BDR, and DR others, so they establish adjacencies with each
other. In Figure 5-15, two DR others each have established three neighbor
relationships and two adjacencies.
Figure 5-15 OSPF neighbor relationship and adjacency
A neighbor relationship indicates that two neighbors reach the 2-Way state,
whereas an adjacency indicates that two neighbors reach the Exstart state or
higher.
OSPF Adjacency Establishment
The process of establishing an OSPF adjacency varies depending on the network
type.
Broadcast Network
On a broadcast network, the DR and BDR establish an adjacency with each router
on the same network segment, but DR others establish only neighbor
relationships with each other. Figure 5-16 shows the process of establishing an
OSPF adjacency.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 186
Figure 5-16 Process of establishing an OSPF adjacency on a broadcast network
1. Neighbor relationship establishment
a. RouterA uses the multicast address 224.0.0.5 to send a Hello packet
through the OSPF interface connected to a broadcast network. The
packet carries the DR field of 1.1.1.1 (ID of RouterA) and the Neighbors
Seen field of 0, indicating that a neighbor RouterB has not been
discovered and RouterA regards itself as the DR.
b. After RouterB receives the packet, it returns a Hello packet to RouterA.
The returned packet carries the DR field of 2.2.2.2 (ID of Router B) and
the Neighbors Seen field of 1.1.1.1 (RouterA's router ID). RouterA has
been discovered but its router ID is less than that of RouterB, and
therefore RouterB regards itself as the DR. Then RouterB's neighbor state
changes to Init.
c. After RouterA receives the response, RouterA's neighbor state changes to
2-Way. Then, RouterA and RouterB start to send their LSDB information
to each other, which does not occur between DR others on a broadcast
network.
2. Master/Slave negotiation and DD packet exchange
a. RouterA sends a DD packet to RouterB. The packet carries the following
fields:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 187
▪ Seq: The value X indicates the sequence number of X.
▪ I: The value 1 indicates that the packet is the first DD packet, which
is used to negotiate the master/slave roles and does not carry LSA
summaries.
▪ M: The value 1 indicates that the packet is not the last DD packet.
▪ MS: The value 1 indicates that RouterA declares itself the master.
To improve transmission efficiency, RouterA and RouterB determine which
LSAs in each other's LSDB need to be updated before sending LSR
packets. If one party detects that an LSA of the other party is already in
its own LSDB, it does not send an LSR packet for updating the LSA to its
own LSDB. To achieve the preceding purpose, RouterA and RouterB first
send DD packets, which carry summaries of LSAs in their own LSDBs.
Each summary identifies an LSA. To ensure reliable packet transmission,
the master/slave roles must be determined through DD packet exchange.
The party serving as the master uses the Seq field to define a sequence
number. The master increases the sequence number by 1 each time it
sends a new DD packet. When the other party serving as the slave sends
a DD packet, it sets the Seq field of the packet to the sequence number
carried in the last DD packet received from the master.
b. After RouterB receives the DD packet, RouterB's state changes to Exstart
and RouterB returns a DD packet to RouterA. The returned packet does
not carry LSA summaries. Because RouterB has a larger router ID than
RouterA, RouterB declares itself the master and sets the Seq field to Y.
c. After RouterA receives the DD packet, it agrees that RouterB is the
master and RouterA's state changes to Exchange. Then, RouterA sends a
DD packet to RouterB to transmit LSA summaries. The packet carries the
Seq field of Y and the MS field of 0 indicating that RouterA declares itself
the slave.
d. After RouterB receives the packet, RouterB's state changes to Exchange
and RouterB sends a new DD packet containing its own LSA summaries
to RouterA. The value of the Seq field carried in the new DD packet is
changed to Y+1. RouterA uses the same sequence number as RouterB to
acknowledge that it has received DD packets from RouterB. RouterB uses
the sequence number from RouterA plus 1 to acknowledge that it has
received DD packets from RouterA. When RouterB sends the last DD
packet, it sets the M field in the packet to 0.
3. LSDB synchronization (LSA request, LSA transmission, and LSA response)
a. After RouterA receives the last DD packet, it finds that many LSAs in
RouterB's LSDB do not exist in its own LSDB. Therefore, RouterA's
neighbor state changes to Loading. After RouterB receives the last DD
packet from RouterA, RouterB's neighbor state directly changes to Full
because RouterB's LSDB already contains all LSAs of RouterA.
b. RouterA sends an LSR packet for updating LSAs from RouterB to its own
LSDB. RouterB sends an LSU to After RouterA.
The preceding procedure ends when the LSAs in RouterA's LSDB are the same
as those in RouterB's LSDB. RouterA's neighbor state then changes to Full.
After RouterA and RouterB exchange DD packets and update all LSAs, an
adjacency is established between them.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 188
NBMA Network
On an NBMA network, all routers establish adjacencies only with the DR and BDR.
Figure 5-17 shows the process of establishing an OSPF adjacency.
Figure 5-17 Process of establishing an OSPF adjacency on an NBMA network
1. Neighbor relationship establishment
a. After RouterB sends a Hello packet to a Down interface of RouterA,
RouterB's neighbor state changes to Attempt. The packet carries the DR
field of 2.2.2.2 (ID of RouterB) and the Neighbors Seen field of 0. A
neighbor RouterA has not been discovered, and RouterB regards itself as
the DR.
b. After RouterA receives the packet, RouterA's state changes to Init and
RouterA returns a Hello packet. The returned packet carries the DR and
Neighbors Seen fields of 2.2.2.2. RouterB has been discovered but its
router ID is greater than that of RouterA, and therefore RouterA agrees
that RouterB is the DR. Then, RouterA and RouterB start to exchange DD
packets and LSDB information with each other, which does not occur
between DR others on a broadcast network.
2. The processes of negotiating master/slave roles and exchanging DD packets
on an NBMA network are the same as those on a broadcast network.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 189
3. The process of synchronizing LSDBs (LSA request, LSA transmission, and LSA
response) on an NBMA network is the same as that on a broadcast network.
P2P Network and P2MP Network
The process for establishing an adjacency on a P2P/P2MP network is similar to
that on a broadcast network except that no DR or BDR needs to be elected on a
P2P/P2MP network. DD packets are transmitted in multicast mode on P2P
networks and in unicast mode on P2MP networks.
5.2.1.8 OSPF Areas
When networks expand and all routers in a large network are running OSPF, the
following problems may occur:
● Network expansion increases the possibility of network topology changes,
leading to more frequent LSA flooding and reducing network bandwidth
efficiency.
● LSDBs of routers become large, requiring a large amount of storage space
and complicating SPF calculations.
● Routers need to maintain large routing tables.
OSPF resolves these problems by partitioning an AS into different areas. Area
partitioning contains LSA flooding within an area, improving network efficiency
and route convergence. The number of routers in each area becomes less,
reducing the size of routing tables and LSDBs maintained by routers and limiting
SPF calculations to LSAs within the area. Design of multiple areas also improves
network scalability and facilitates the setup of large networks.
An area is regarded as a logical group of routers and is identified by an area ID. A
router, not a link, resides on the border of an area. Each OSPF interface must
belong to an area, meaning that a link (or network segment) belongs to only one
area.
Before understanding OSPF areas, you need to get to know two concepts: router
type and route type.
Router Types
Figure 5-18 shows common router types involved in OSPF.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 190
Figure 5-18 Router types
Table 5-4 Router types
Router Type Description
Internal router A router that has all of its interfaces within the
same OSPF area.
Area Border Router (ABR) A router that has interfaces in two or more areas,
one of which must be a backbone area.
ABRs connect backbone and non-backbone areas
and can be physically or logically connected to a
backbone area.
Backbone router A router that has one or more interfaces within a
backbone area.
Internal routers in Area 0 and all ABRs are
backbone routers.
Autonomous System
Boundary Router (ASBR)
A router that exchanges routing information with
other ASs.
An ASBR is not required to reside on the border of
an AS. It may be an internal router or an ABR. An
OSPF device that imports external routing
information becomes an ASBR.
Route Types
Inter-area and intra-area routes in an AS describe the internal network structure
of the AS. AS external routes describe routes to destinations outside the AS. OSPF
classifies imported AS external routes into Type 1 and Type 2.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 191
Table 5-5 lists route types in descending order of priority.
Table 5-5 Route types
Route Type Description
Intra-area route Routes that are generated from within an area (the
destination belongs to the area).
Inter-area route Routes that originate from other areas.
External route Routes that are imported into OSPF from other
routing protocols or different OSPF processes.
External routes fall into two categories: Type 1 and
Type 2 external routes. The difference between the
two types is the way the cost of a route is
calculated.
● Type 1 external route: The cost of a Type 1
external route is the addition of the external cost
(from the local device to an ASBR) and the
internal cost (from the ASBR to the destination)
used to reach that route.
● Type 2 external route: The cost of a Type 2
external route is always the external cost (from
an ASBR to the destination), irrespective of the
internal cost to reach that route.
A Type 1 external route is always preferred over a
Type 2 external route for the same destination.
Area Types
OSPF areas include common areas, stub areas, and not-so-stubby areas (NSSAs),
as shown in Table 5-6.
Table 5-6 Area types
Area
Type
Function Description
Common
area
By default, OSPF areas are common areas
that include:
● Standard area: transmits intra-area,
inter-area, and external routes.
● Backbone area: connects to all other
OSPF areas and transmits inter-area
routes. The backbone area is
represented by area 0. Routes between
non-backbone areas must be
forwarded through the backbone area.
● The backbone area
must have all its
devices connected.
● All non-backbone
areas must have
themselves
connected to the
backbone area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 192
Area
Type
Function Description
Stub area A stub area is a special area where an ABR
does not flood received AS external routes.
In a stub area, routers maintain fewer
routing entries and transmit less routing
information. Configuring a stub area is
optional and not every area can be
configured as such. A stub area is usually
a non-backbone area containing only one
ABR, located on the AS border. A stub area
is a non-backbone area containing only
one ABR and generally resides on the
border of an AS. The ABR in a stub area
does not transmit received AS external
routes, which significantly decreases the
routing table size on the ABR and the
amount of routing information
transmitted. To ensure the reachability of
AS external routes, the ABR generates a
default route and advertises the route to
non-ABRs in the stub area.
A totally stub area allows only intra-area
routes and ABR-advertised Type 3 LSAs
carrying a default route to be advertised
within the area.
● A backbone area
cannot be
configured as a stub
area.
● Stub area attributes
need to be
configured on all
the routers in the
area that needs to
be configured as a
stub area.
● An ASBR cannot
exist in a stub area.
Therefore, AS
external routes
cannot be
advertised within a
stub area.
● A virtual link cannot
pass through a stub
area.
NSSA An NSSA is similar to a stub area. An
NSSA does not advertise Type 5 LSAs, but
can import AS external routes. ASBRs in
an NSSA generate Type 7 LSAs to carry
the information about the AS external
routes. The Type 7 LSAs are advertised
only within the NSSA. When the Type 7
LSAs reach an ABR in the NSSA, the ABR
translates the Type 7 LSAs into Type 5
LSAs and floods them to the entire AS.
A totally NSSA allows only intra-area
routes to be advertised within the area.
● A backbone area
cannot be
configured as an
NSSA.
● NSSA attributes
need to be
configured on all
the routers in the
area that needs to
be configured as an
NSSA.
● An ABR in an NSSA
advertises default
routes in Type 7
LSAs within the
NSSA.
● All inter-area routes
are advertised by
ABRs.
● A virtual link cannot
pass through an
NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 193
After an OSPF network is partitioned into multiple areas, only LSAs within an area
are used in SPF calculations of this area. For example, in Figure 5-19, the link in
Area 1 is always flapping, and therefore SPF calculations are frequently performed
in Area 1. However, frequent SPF calculations occur only in Area 1 without
affecting other areas, improving network stability.
Figure 5-19 Area partitioning reducing the impact of link flapping
Stub area and totally stub area
In Figure 5-20, an AS is partitioned into Area 0 and Area 2, and external routes
are imported by the ASBR in Area 0. Typically, all routes on the network are
advertised into OSPF to ensure network reachability. In this situation, network
expansion will increase the number of devices and routing entries on each device
and require a large amount of CPU and memory resources to maintain these
entries. In some edge areas, low-performance devices may be deployed, and
therefore maintaining a large number of routing entries brings heavy load on
these devices.
Figure 5-20 Stub area and totally stub area
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 194
To optimize network performance, you often need to minimize the routing table
size to reduce the number of LSAs to be flooded without compromising network
reachability. If Area 2 is a common area, five types of LSAs, Type 1, Type 2, Type 3,
Type 4, and Type 5, may exist in this area. Traffic from routers in Area 2 must first
reach the ABR, regardless of the traffic destination outside Area 2. Therefore, non-
ABR routers in Area 2 do not need to know detailed information about external
networks. To meet this requirement, Area 2 is designed as a stub area.
Routers in Area 2 do not need to know inter-area specific routes and only one
egress is required to transmit traffic of these routers outside Area 2. To meet this
requirement, a totally stub area is designed. In a totally stub area, AS external
routes and inter-area routes cannot be advertised, reducing the number of LSAs
transmitted within this area.
NSSA and totally NSSA
In Figure 5-21, Area 2 is a stub area. An external network needs to connect to the
OSPF network through Area 2. That is, AS external routes need to be imported to
and advertised within the entire AS. One method is to enable RouterA in Area 2 to
import AS external routes into the AS. RouterA then becomes an ASBR, indicating
that Area 2 is no longer a stub area. To meet this requirement, an NSSA is
designed.
Figure 5-21 NSSA and totally NSSA
An NSSA differs from a stub area in that an NSSA allows importing AS external
routes into and advertising them within the entire AS without transmitting routes
learned from other areas in the AS.
To ensure the reachability of AS external routes, the ABR in an NSSA generates a
default route and advertises the route to the other routers in this NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 195
Multiple ABRs may be deployed in an NSSA. To prevent routing loops caused by
default routes, ABRs do not calculate the default routes advertised by each other.
All routers in an area must have the same area type configured. A router uses the
N-bit carried in a Hello packet to specify the area type that it supports. If routers
have different area types, they cannot establish OSPF neighbor relationships.
Some vendors' devices do not comply with this requirement, and the N-bit is also
set in Database Description (DD) packets. You can manually set the N-bit on
switches to enable interworking with these vendors' devices.
Similar to a totally stub area, a totally NSSA is defined to further reduce the
number of LSAs transmitted within an NSSA.
Inter-Area Loop and Loop Prevention
OSPF runs an SPF algorithm within an area, which prevents routing loops within
the area. However, the distance-vector algorithm is used for inter-area route
transmission, which may easily cause routing loops.
To prevent inter-area loops, OSPF prohibits routing information from being
advertised directly between two non-backbone areas and allows advertising
routing information within a single area or between the backbone and non-
backbone areas. Therefore, each ABR must be connected to the backbone area.
If OSPF allows advertising routing information directly between non-backbone
areas, an inter-area loop may occur, as shown in Figure 5-22. The route from the
backbone area to the external network can be transmitted from Area 0 to Area 1.
If transmitting routing information directly between non-backbone areas is
allowed, this route can be transmitted back to Area 0, forming an inter-area
routing loop. To prevent this loop, OSPF allows exchanging routing information
only between the backbone and non-backbone areas. That is, OSPF prohibits
routing information from being exchanged directly between Area 1 and Area 3 or
directly between Area 2 and Area 3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 196
Figure 5-22 OSPF inter-area loop
OSPF Default Route
A default route has an all–0 destination address and an all-0 mask. A device uses
a default route to forward packets when no matching route is discovered.
Hierarchical management of OSPF routes prioritizes the default route carried in
Type 3 LSAs over that carried in Type 5 or Type 7 LSAs.
An OSPF default route is used in the following scenarios:
● An ABR advertises a default route in Type 3 LSAs for instructing routers within
an area to forward packets between areas.
● An ASBR advertises a default route in Type 5 LSAs or Type 7 LSAs for
instructing routers in an AS to forward packets to other ASs.
Advertising an OSPF default route must follow these rules:
● An OSPF router in an area can advertise LSAs carrying a default route only
when the router has an interface connected to a device outside the area.
● If an OSPF router has advertised LSAs carrying a default route, the router no
longer learns the same-type LSAs carrying a default route advertised by other
routers. That is, the router uses only the LSAs advertised by itself to calculate
routes. The LSAs advertised by other routers are still recorded in the LSDB.
● If a router must use a route to advertise LSAs carrying an external default
route, the route cannot be a route learned by the local process. This is
because external default routes guide packet forwarding outside an AS,
whereas routes within an AS have the next hops pointing to the devices
within the AS.
Table 5-7 lists default route advertisement principles in different areas.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 197
Table 5-7 OSPF areas and default route advertisement
Area Type Function
Common area By default, devices in a common OSPF area do not
generate default routes.
When a default route on the network is generated by
another non-OSPF routing process, the device that
generates the default route must advertise it within the
entire OSPF AS. You can use commands to configure an
ASBR to generate a default route. After configuration, the
ASBR generates a Type 5 LSA carrying the default route
and then advertises the LSA within the entire OSPF AS.
Stub area A stub area does not allow AS external routes (carried in
Type 5 LSAs) to be transmitted within the area.
All routers within a stub area must learn AS external routes
from the ABR. The ABR automatically generates a
Summary LSA (Type 3 LSA) carrying a default route and
then advertises it within the entire stub area. This makes
all routes to destinations outside an AS learnable from the
ABR.
Totally stub area A totally stub area does not allow AS external routes
(carried in Type 5 LSAs) or inter-area routes (carried in
Type 3 LSAs) to be transmitted within the area.
All routers within the totally stub area must learn AS
external routes and inter-area routes from the ABR. The
ABR automatically generates a Summary LSA (Type 3 LSA)
carrying a default route and advertises it within the entire
totally stub area. This makes all routes to destinations
outside an AS and to destinations in other areas learnable
from the ABR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 198
Area Type Function
NSSA An NSSA allows its ASBRs to import a small number of AS
external routes. The ASBRs do not advertise Type 5 LSAs
received from other areas within the NSSA. That is, AS
external routes can be learned only from ASBRs in the
NSSA.
Devices in an NSSA do not automatically generate default
routes.
Use either of the following methods to generate default
routes:
● Method 1: To advertise AS external routes through the
ASBR in the NSSA and advertise other external routes
through other areas, configure a Type 7 LSA carrying a
default route on the ABR and advertise this LSA within
the entire NSSA. In this manner, a small number of AS
external routes can be learned from the ASBR in the
NSSA, and other routes can be learned from the ABR in
the NSSA.
● Method 2: To advertise all external routes through the
ASBR in the NSSA, configure a Type 7 LSA carrying a
default route on the ASBR and advertise this LSA within
the entire NSSA.
The difference between the two methods is:
● In method 1, an ABR generates a Type 7 LSA carrying a
default route regardless of whether the routing table
contains a default route.
● An ASBR generates a Type 7 LSA carrying a default
route only when the routing table contains a default
route.
Default routes are flooded only within the local NSSA and
are not flooded within the entire OSPF AS. If routers in the
local NSSA cannot discover routes to the outside of the AS,
the routers can forward packets outside of the AS through
an ASBR. However, packets of other OSPF areas cannot be
sent outside the AS through this ASBR. Type 7 LSAs
carrying default routes are not translated into Type 5 LSAs
to make the default routes be flooded within the entire
OSPF AS.
Totally NSSA A totally NSSA does not allow AS external routes (carried
in Type 5 LSAs) or inter-area routes (carried in Type 3
LSAs) to be transmitted within the area.
All routers within the totally NSSA must learn AS external
routes from the ABR. The ABR automatically generates a
Type 3 LSA carrying a default route and advertises it within
the entire totally NSSA. This allows all external routes
received from other areas and inter-area routes to be
advertised within the totally NSSA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 199
5.2.1.9 OSPF LSA Types
An OSPF network is partitioned into multiple areas. These areas need to maintain
their own LSDBs, and routers in these areas are classified into different types. LSAs
encapsulated with route description can also be classified based on the router
types.
Figure 5-23 shows an OSPF network that is partitioned into three areas. A static
route is configured on R4 and imported into an OSPF process.
Figure 5-23 OSPF network partitioned into three areas
Table 5-8 lists router IDs and interface IP addresses of R1, R2, R3, and R4.
Table 5-8 Data plan
Device Router ID Interface IP Address
R1 10.1.1.1/32 GE0/0/1: 192.168.12.1/24
R2 10.2.2.2/32 GE0/0/2: 192.168.12.2/24
GE0/0/1: 192.168.23.1/24
R3 10.3.3.3/32 GE0/0/2: 192.168.23.2/24
GE0/0/1: 192.168.34.1/24
R4 10.4.4.4/32 GE0/0/2: 192.168.34.2/24
The following describes LSA types based on the network shown in Figure 5-23.
Router-LSA
A Router-LSA is a Type 1 LSA. It describes a router's link state and cost.
Every router on the OSPF network generates Router-LSAs and advertises them
within its areas. In Figure 5-24, R2 advertises a Router-LSA within Area 0 and Area
1.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 5 OSPF Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 200
Figure 5-24 Router-LSA (Type 1)
Figure 5-25 shows the information contained in the Router-LSA flooded by
GE0/0/1 on R2.
Figure 5-25 Information in a Router-LSA
An LSA includes the LSA header and LSA information fields. In all types of LSAs,
their LSA header contains the same fields with the only difference of the Link
State ID field meaning. You need to focus on the following fields in an LSA




