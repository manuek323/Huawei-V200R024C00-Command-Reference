6 OSPFv3 Configuration
6.1 Overview of OSPFv3
6.2 Understanding OSPFv3
6.3 Summary of OSPFv3 Configuration Tasks
6.4 Licensing Requirements and Limitations for OSPFv3
6.5 Default Settings for OSPFv3
6.6 Configuring Basic OSPFv3 Functions
6.7 Establishing and Maintaining an OSPFv3 Neighbor Relationship
6.8 Configuring an OSPFv3 Area
6.9 Configuring an OSPFv3 NSSA
6.10 Configuring OSPFv3 Route Attributes
6.11 Controlling OSPFv3 Routing Information
6.12 Optimizing an OSPFv3 Network
6.13 Configuring BFD for OSPFv3
6.14 Configuring OSPFv3 IP FRR
6.15 Configuring OSPFv3 GR
6.16 Improving OSPFv3 Network Security
6.17 Configuring OSPFv3 Neighbor Relationship Flapping Suppression
6.18 Configuring OSPFv3 IPSec
6.19 Configuring the Network Management Function of OSPFv3
6.20 Resetting OSPFv3
6.21 Configuration Examples for OSPFv3
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 383
6.1 Overview of OSPFv3
Definition
Open Shortest Path First (OSPF) is a link-state Interior Gateway Protocol (IGP)
developed by the Internet Engineering Task Force (IETF).
OSPF Version 3 (OSPFv3), as defined in RFC 2740 and expanded in RFC 5340, is a
modification of OSPFv2 allowing IPv6 support.
Purpose
The primary purpose of OSPFv3 is to develop a routing protocol independent of
any specific network layer. The internal routing information of OSPFv3 has been
redesigned to serve this purpose.
OSPFv3 and OSPFv2 differ as follows:
● OSPFv3 is used in IPv6, while OSPFv2 is used in IPv4.
OSPFv3 does not insert IP-based data in the header of an IP packet or Link
State Advertisement (LSA).
● OSPFv3 uses protocol-independent information to execute crucial tasks that
originally required the use of the data in the IP packet header, for example, to
identify LSAs that advertise routing data.
6.2 Understanding OSPFv3
6.2.1 OSPFv3 Fundamentals
● The working principles of Hello messages, state machines, link-state
databases (LSDBs), flooding, and route calculation are the same in OSPFv3
and OSPFv2.
● OSPFv3 divides an Autonomous System (AS) into one or more logical areas
and advertises routes through LSAs.
● OSPFv3 ensures routing information consistency by exchanging OSPFv3
packets between routers within an OSPFv3 area.
● OSPFv3 packets are encapsulated into IPv6 packets, which can be transmitted
in unicast or multicast mode.
OSPFv3 Packets
Packet Type Description
Hello Sent regularly to discover and maintain OSPFv3
neighbor relationships.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 384
Packet Type Description
Database Description (DD) Contains the summary of the local LSDB. It is
exchanged between two OSPFv3 routers to
update the LSDBs.
Link State Request (LSR) Sent to neighbors to request the required LSAs.
An OSPFv3 router sends LSR packets to its
neighbor only after they exchange DD packets.
Link State Update (LSU) Used to transmit required LSAs to neighbors.
Link State Acknowledgment
(LSAck)
Used to acknowledge the receipt of LSA packets.
LSA Types
LSA Type Description
Router-LSA (Type 1) ● Generated by a router for each area to which an
OSPFv3 interface belongs and advertised in that
area.
● Describes the status and costs of links of the
router.
Network-LSA (Type 2) ● Generated by a designated router (DR) and
broadcast in the area to which the DR belongs.
● Describes the link status.
Inter-Area-Prefix-LSA
(Type 3)
● Generated by an area border router (ABR).
● Describes the route of a network segment within
the local area and is used to inform other areas
of the route.
Inter-Area-Router-LSA
(Type 4)
● Generated by an ABR and advertised to all
related areas, except the area to which the
autonomous system boundary router (ASBR)
belongs.
● Describes the route to the ASBR.
AS-external-LSA (Type 5) ● Generated by an ASBR and advertised to all
areas except the stub area and the not-so-stubby
area (NSSA).
● Describes routes to a destination outside the AS.
NSSA-LSA (Type 7) ● Generated by an ASBR and advertised only in
NSSAs.
● Describes routes to a destination outside the AS.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 385
LSA Type Description
Link-LSA (Type 8) ● Each router generates one for each link.
● Describes the link-local address and IPv6 address
prefix associated with the link, as well as the link
option set in the network LSA. It is transmitted
only on the link.
Intra-Area-Prefix-LSA
(Type 9)
● Each router or DR generates one or more to be
transmitted in the local area.
● An LSA of this type generated on a router
describes the IPv6 address prefix associated with
the router LSA.
● An LSA of this type generated on a DR describes
the IPv6 address prefix associated with the
network LSA.
Router Types
Figure 6-1 Router types
Table 6-1 Router types
Router Type Description
Internal router Routers whose interfaces all belong to the same
OSPFv3 area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 386
Router Type Description
Area border router (ABR) Belongs to two or more areas, one of which must
be a backbone area.
Used to connect backbone and non-backbone areas.
It can be physically or logically connected to the
backbone area.
Backbone router At least one interface on a backbone router must
belong to the backbone area.
All ABRs and internal routers in Area 0 are
backbone routers.
AS boundary router
(ASBR)
Exchanges routing information with other ASs.
May not locate on the boundary of an AS. It can be
an internal router or an ABR.
OSPFv3 Route Types
AS inter-area and intra-area routes describe routes within an AS. External routes
describe routes to destinations outside an AS. OSPFv3 classifies imported AS
external routes into Type 1 routes and Type 2 routes.
Table 6-2 lists route types in descending order of priority.
Table 6-2 Route types
Route Type Description
Intra-area route Routes that are generated from within an area (the
destination belongs to the area).
Inter-area route Routes that originate from other areas.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 387
Route Type Description
External route Routes that are imported into OSPF from other
routing protocols or different OSPF processes.
External routes fall into two categories: Type 1 and
Type 2 external routes. The difference between the
two types is the way the cost of a route is
calculated.
● Type 1 external route: The cost of a Type 1
external route is the addition of the external cost
(from the local device to an ASBR) and the
internal cost (from the ASBR to the destination)
used to reach that route.
● Type 2 external route: The cost of a Type 2
external route is always the external cost (from
an ASBR to the destination), irrespective of the
internal cost to reach that route.
A Type 1 external route is always preferred over a
Type 2 external route for the same destination.
Area Types
Table 6-3 Area types
Area Type Description
Totally stub area Allows Type 3 default routes advertised by the ABR, but
disallows routes outside the AS and inter-area routes.
Stub area Different from a totally stub area, a stub area allows inter-
area routes.
NSSA Different from a stub area, an NSSA allows routes outside
an AS.
An ASBR advertises Type 7 LSAs in the local area. These
Type 7 LSAs are translated into Type 5 LSAs on an ABR,
and are then flooded in the entire OSPFv3 AS.
Network Types Supported by OSPFv3
OSPFv3 classifies networks into different types according to link layer protocols.
The following table describes these network types.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 388
Table 6-4 Network types
Network Type Description
Broadcast Default network type if the link layer protocol is
Ethernet or Fiber Distributed Data Interface (FDDI).
● Hello messages, LSU packets, and LSAck packets are
transmitted in multicast mode (FF02::5 is the reserved
IPv6 multicast address of the OSPFv3 router; FF02::6
is the reserved IPv6 multicast address of the OSPFv3
DR or BDR).
● DD packets and LSR packets are transmitted in
unicast mode.
Non-broadcast
multiple access
(NBMA)
Default network type if the link layer protocol is frame
relay, ATM, or X.25.
Protocol packets, such as Hello messages and DD, LSR,
LSU, and LSAck packets, are transmitted in unicast
mode.
Point-to-multipoint
(P2MP)
Not a default network type for any link layer protocol. A
P2MP network must be forcibly changed from other
network types. It is a common practice to change an
NBMA that is not fully connected to a P2MP network.
● Hello messages are transmitted in multicast mode to
the multicast address FF02::5.
● Other protocol packets, including DD, LSR, LSU, and
LSAck packets, are transmitted in unicast mode.
Point-to-point (P2P) Default network type if the link layer protocol is PPP,
HDLC, or LAPB.
Protocol packets, including Hello messages, DD, LSR,
LSU, and LSAck packets, are transmitted to the multicast
address FF02::5.
Stub Area
In stub areas, ABRs do not flood the received external routes. This reduces both
the size of routers' routing tables and the amount of routing information in
transmission.
Configuring a stub area is optional. Not all areas can be configured as stub areas.
Typically, a non-backbone area located at the AS boundary with only one ABR is
set to be a stub area.
To ensure the reachability of a destination outside the AS, the ABR in the stub
area generates a default route and advertises it to the non-ABR routers in that
stub area.
Note the following when configuring a stub area:
● The backbone area cannot be configured as a stub area.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 389
● All routers in a stub area must be configured with the stub command.
● ASBRs cannot exist in stub areas, because it is not allowed to flood external
routes in stub areas.
● A virtual link cannot pass through a stub area.
OSPFv3 Route Summarization
Routing summarization decreases the amount of routing information and the size
of routing tables, improving the performance of routers.
The following is a description of OSPFv3 route summarization:
● Inter-area route summarization
Inter-area route summarization is performed on ABRs and applies to routes
from within an AS. An ABR generates Network-summary (Type 3) LSAs by
network segment while advertising routing information to other areas. If
network segments are contiguous, the ABR can summarize them into a single
segment. This allows the ABR to send only the summary LSA for all the
specified network segments.
● External route summarization
External route summarization is performed on ASBRs and is specific to
external routes that are imported into OSPF. ASBRs can summarize imported
AS-external (Type 5) LSAs within a summary address range. After an NSSA is
configured, an ASBR must summarize imported NSSA (Type 7) LSAs with the
summary address range.
Devices that are both ABRs and ASBRs summarize the Type 5 LSAs translated
from Type 7 LSAs.
OSPFv3 Virtual Link
A virtual link is a logical channel set up between two ABRs through a non-
backbone area.
● It must be configured on both ends of the link to take effect.
● The non-backbone area that provides an internal route for both the ends of
the virtual link is a transit area.
Non-backbone areas cannot always physically connect to the backbone area in
real-world situations. Configuring OSPFv3 virtual links resolves this problem.
A virtual link functions as a point-to-point connection between two ABRs. The
interfaces on the virtual link can be configured with parameters such as the hello
interval in the same way they are configured on physical interfaces.
Figure 6-2 OSPFv3 virtual link
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 390
Figure 6-2 shows the transmission of OSPFv3 packets between two ABRs. OSPFv3
devices between the two ABRs only transparently forward the OSPFv3 packets as
common IP packets when they detect that they are not the destinations of the
packets.
OSPFv3 Multi-Process
Multiple OSPFv3 processes can run on the same router because they are
independent of each other. Route interaction between different OSPFv3 processes
is similar to that between different routing protocols.
One interface on a router belongs to only one OSPFv3 process.
6.2.2 OSPFv3 GR
Graceful restart (GR) is a high availability (HA) technology used to ensure normal
traffic forwarding when a routing protocol restarts and guarantee that key services
are not affected in the process.
GR comprises a series of comprehensive technologies including fault-tolerant
redundancy, link protection, faulty node recovery, and traffic engineering. As a
redundancy technology, GR is widely used to ensure uninterrupted forwarding of
key data during active/standby switchovers and system upgrades.
If GR is not enabled, an active/standby switchover leads to intermittent
interruption of data forwarding. As a result, route flapping occurs on the whole
network. This is unacceptable on a large-scale network, especially on a carrier
network.
If GR is enabled, the forwarding plane continues to direct data forwarding when a
restart occurs. Then actions on the control plane, such as reestablishment of
neighbor relationships and route calculation, do not affect the forwarding plane.
Service interruption caused by route flapping is therefore prevented, which
improves network reliability.
Basic Concepts
● Grace-LSA
– OSPFv3 supports GR by flooding Grace-LSAs on the link.
– Grace-LSAs are used when GR starts and ends to inform neighbors of the
GR time, cause, and interface instance ID.
● Router role
– A router can function as a GR restarter, which has the GR capability and
restarts in GR mode.
– A router can function as a GR helper, which also has the GR capability
and helps the GR restarter to complete the GR process.
● GR implementation
– Planned GR: This refers to a graceful restart of OSPFv3 through the reset
ospfv3 graceful-restart command. In this mode, a Grace-LSA is sent to
the neighbor before the restart.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 391
– Unplanned GR: This refers to an active/standby switchover triggered by
router faults, such as loss of power, dead loops, exceptions, or master
resets.
Unlike planned GR, a Grace-LSA is not sent before the active/standby
switchover. Instead, the switchover is performed directly. When the
standby board becomes Up, a Grace-LSA is sent, and the GR process
starts.
GR Process
Figure 6-3 OSPFv3 planned GR process (reset ospfv3 graceful-restart)
Figure 6-4 OSPFv3 unplanned GR process (active/standby switchover)
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 392
● On the GR restarter:
1. In planned GR mode, the GR restarter sends a Grace-LSA to all neighbors to
inform them of the restart of a GR process and the duration and cause of this
process.
In unplanned GR mode, a Grace-LSA is sent to each neighbor immediately
after the standby board is Up. This informs the neighbors of the restart of a
GR process and the duration and cause of this process.
2. The GR restarter sets up new neighbor relationships by negotiating with
neighbors again.
3. When all neighbor relationships between the GR restarter and the original
neighbors enter the Full state:
– The GR restarter exits the GR process and OSPFv3 recalculates routes.
– The GR restarter updates its routing table on the main control board and
the forwarding information bases (FIBs) on interface boards. It also
deletes invalid routing entries.
– The GR restarter sends a Grace-LSA with an aging time of 3600 seconds
to instruct the GR helper to exit the GR process.
The GR process is now complete.
4. If errors occur during a GR process, the GR timer expires, or a neighbor
relationship fails to enter the Full state during the GR process, the GR
restarter exits the process and OSPFv3 is restarted in non-GR mode. This
causes packets loss.
● On the GR helper:
1. A router that is configured to support the GR process on its neighbor enters
the helper mode after receiving a Grace-LSA.
2. The GR helper maintains its neighbor relationship with the GR restarter, and
the status of the neighbor relationship does not change.
3. If the GR helper continues to receive Grace-LSAs whose GR period differs from
its own GR period, the GR helper updates its GR period to match that of the
received Grace-LSAs.
4. After the GR restarter informs the helper of the success of the GR process
through a Grace-LSA with an aging time of 3600 seconds, the GR helper exits
the GR process.
5. If errors occur during the GR process, the GR helper exits the helper state and
deletes invalid routes after route calculation.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 393
Comparison of OSPFv3 GR and Non-GR Modes
Table 6-5 Comparison of OSPFv3 GR and non-GR modes
Active/Standby Switchover in Non-
GR Mode
Active/Standby Switchover in GR
Mode
● OSPFv3 neighbor relationships are
reestablished.
● Routes are recalculated.
● The forwarding table changes.
● Route changes are sensed on the
network and route flapping
occurs over a short period of
time.
● Packets are lost during
forwarding, and services are
interrupted.
● OSPFv3 neighbor relationships are
reestablished.
● Routes are recalculated.
● The forwarding table does not
change.
● Route changes are not sensed, except
on the neighbor of the device where
the active/standby switchover occurs.
● Packets are not lost during
forwarding, and services are not
affected.
6.2.3 OSPFv3-BGP Synchronization
When a router is restarted or a new router is deployed on a network, network
traffic may be lost during Border Gateway Protocol (BGP) convergence. This is
because IGP convergence is faster than BGP convergence. OSPFv3-BGP
synchronization can solve this problem.
When a router on a BGP network recovers from a fault, BGP convergence is
performed again. Packets may be lost during the convergence.
Figure 6-5 shows traffic traversing a BGP network, passing through Router C from
RouterA to RouterD.
Figure 6-5 Traffic traversing a BGP network
If a fault occurs on RouterC, traffic is redirected to RouterB after rerouting. Packets
are lost when RouterC is restored to normal operating status.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 394
This is because OSPFv3 convergence is already complete when RouterC recovers,
and RouterC becomes the next hop on the route from RouterA to RouterD.
However, at this point, BGP convergence on RouterC is not complete, so RouterC
does not yet know the route to RouterD.
For this reason, when packets destined for RouterD are transmitted from RouterA
to RouterC, they are discarded by RouterC because it has no route to RouterD. This
is shown in Figure 6-6.
Figure 6-6 Packet loss upon device restart without OSPFv3-BGP synchronization
Process of OSPFv3-BGP synchronization
When a router enabled with OSPFv3-BGP synchronization restarts, it advertises a
message in the local OSPFv3 area instructing other routers not to use it as a
transit router.
At the same time, the router sets the cost value in its LSAs to 65535, the largest
value. This ensures that it is not used by other routers as a transit router. The BGP
route, however, can still reach the router.
6.2.4 OSPFv3 Neighbor Relationship Flapping Suppression
OSPFv3 neighbor relationship flapping suppression works by delaying OSPFv3
neighbor relationship reestablishment or setting the link cost to the maximum
value (65535).
Background
If the status of an interface carrying OSPFv3 services alternates between Up and
Down, OSPFv3 neighbor relationship flapping occurs on the interface. During the
flapping, OSPFv3 frequently sends Hello packets to reestablish the neighbor
relationship, synchronizes LSDBs, and recalculates routes. In this process, a large
number of packets are exchanged, adversely affecting neighbor relationship
stability, OSPFv3 services, and other OSPFv3-dependent services, such as LDP and
BGP. OSPFv3 neighbor relationship flapping suppression can address this problem
by delaying OSPFv3 neighbor relationship reestablishment or preventing service
traffic from passing through flapping links.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 395
Related Concepts
Flapping_event: reported when the status of a neighbor relationship on an
interface last changes from Full to a non-Full state. The flapping_event triggers
flapping detection.
Flapping_count: number of times flapping has occurred.
Detect-interval: detection interval. The interval is used to determine whether to
trigger a valid flapping_event.
Threshold: flapping suppression threshold. When the flapping_count reaches or
exceeds threshold, flapping suppression takes effect.
Resume-interval: interval for exiting from OSPFv3 neighbor relationship flapping
suppression. If the interval between two successive valid flapping_events is longer
than resume-interval, the flapping_count is reset.
Implementation
Flapping detection
Each OSPFv3 interface on which OSPFv3 neighbor relationship flapping
suppression is enabled starts a flapping counter. If the interval between two
flapping_events is shorter than the detect-interval, a valid flapping_event is
recorded, and the flapping_count is incremented by 1. When the flapping_count
reaches or exceeds threshold, flapping suppression takes effect. If the interval
between two successive neighbor status changes from Full to a non-Full state is
longer than resume-interval, the flapping_count is reset.
The detecting-interval, threshold, and resume-interval are configurable.
NOTE
The value of resume-interval must be greater than that of detecting-interval.
Flapping suppression
Flapping suppression works in either Hold-down or Hold-max-cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes
during neighbor relationship establishment, interfaces prevent neighbor
relationships from being reestablished during the suppression period, which
minimizes LSDB synchronization attempts and packet exchanges.
● Hold-max-cost mode: If the traffic forwarding path changes frequently,
interfaces use 65535 as the cost of the flapping link during Hold-max-cost
suppression, which prevents traffic from passing through the flapping link.
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode.
By default, the Hold-max-cost mode takes effect. The mode and suppression
duration can be changed manually.
If an attack causes frequent neighbor relationship flapping, Hold-down mode can
minimize the impact of the attack.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 396
NOTE
When an interface enters the flapping suppression state, all neighbor relationships on the
interface enter the state accordingly.
Exiting from flapping suppression
Interfaces exit from flapping suppression in the following scenarios:
● The suppression timer expires.
● The corresponding OSPFv3 process is reset.
● An OSPFv3 neighbor is reset.
● OSPFv3 neighbor relationship flapping suppression is disabled globally.
● A command is run to exit from flapping suppression.
Typical Scenarios
Basic scenario
In Figure 6-7, the traffic forwarding path is SwitchA -> SwitchB -> SwitchC ->
SwitchE before a link failure occurs. After the link between SwitchB and SwitchC
fails, the forwarding path switches to SwitchA -> SwitchB -> SwitchD -> SwitchE. If
the neighbor relationship between SwitchB and SwitchC frequently flaps at the
early stage of the path switchover, the forwarding path will be switched
frequently, causing traffic loss and affecting network stability. If the neighbor
relationship flapping meets suppression conditions, flapping suppression takes
effect.
● If flapping suppression works in Hold-down mode, the neighbor relationship
between SwitchB and SwitchC is prevented from being reestablished during
the suppression period, in which traffic is forwarded along the path SwitchA -
> SwitchB -> SwitchD -> SwitchE.
● If flapping suppression works in Hold-max-cost mode, 65535 is used as the
cost of the link between SwitchB and SwitchC during the suppression period,
and traffic is forwarded along the path SwitchA -> SwitchB -> SwitchD ->
SwitchE.
Figure 6-7 Flapping suppression in a basic scenario
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 397
Single-forwarding path scenario
When only one forwarding path exists on the network, the flapping of the
neighbor relationship between any two switches on the path will interrupt traffic
forwarding. In Figure 6-8, the traffic forwarding path is SwitchA -> SwitchB ->
SwitchC -> SwitchE. If the neighbor relationship between SwitchB and SwitchC
flaps, and the flapping meets suppression conditions, flapping suppression takes
effect. However, if the neighbor relationship between SwitchB and SwitchC is
prevented from being reestablished, the whole network will be divided. Therefore,
Hold-max-cost mode (rather than Hold-down mode) is recommended. If flapping
suppression works in Hold-max-cost mode, 65535 is used as the cost of the link
between SwitchB and SwitchC during the suppression period. After the network
stabilizes and the suppression timer expires, the link is restored.
NOTE
By default, the Hold-max-cost mode takes effect.
Figure 6-8 Flapping suppression in a single-forwarding path scenario
Broadcast scenario
In Figure 6-9, four switches are deployed on the same broadcast network using
switches, and the switches are broadcast network neighbors. If SwitchC flaps due
to a link failure, and SwitchA and SwitchB were deployed at different time
(SwitchA was deployed earlier for example) or the flapping suppression
parameters on SwitchA and SwitchB are different, SwitchA first detects the
flapping and suppresses SwitchC. Consequently, the Hello packets sent by SwitchA
do not carry SwitchC's Switch ID. However, SwitchB has not detected the flapping
yet and still considers SwitchC a valid node. As a result, the DR candidates
identified by SwitchA are SwitchB and SwitchD, whereas the DR candidates
identified by SwitchB are SwitchA, SwitchC, and SwitchD. Different DR candidates
result in a different DR election result, which may lead to route calculation errors.
To prevent this problem in scenarios where an interface has multiple neighbors,
such as on a broadcast, P2MP, or NBMA network, all neighbors on the interface
are suppressed when the status of a neighbor relationship last changes to ExStart
or Down. Specifically, if SwitchC flaps, SwitchA, SwitchB, and SwitchD on the
broadcast network are all suppressed. After the network stabilizes and the
suppression timer expires, SwitchA, SwitchB, and SwitchD are restored to normal
status.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 398
Figure 6-9 Flapping suppression on a broadcast network
Multi-area scenario
In Figure 6-10, SwitchA, SwitchB, SwitchC, SwitchE, and SwitchF are connected in
area 1, and SwitchB, SwitchD, and SwitchE are connected in backbone area 0.
Traffic from SwitchA to SwitchF is preferentially forwarded along an intra-area
route, and the forwarding path is SwitchA -> SwitchB -> SwitchC -> SwitchE ->
SwitchF. When the neighbor relationship between SwitchB and SwitchC flaps and
the flapping meets suppression conditions, flapping suppression takes effect in the
default mode (Hold-max-cost). However, the forwarding path remains unchanged
because intra-area routes take precedence over inter-area routes during route
selection according to OSPFv3 route selection rules. To prevent traffic loss in
multi-area scenarios, configure Hold-down mode to prevent the neighbor
relationship between SwitchB and SwitchC from being reestablished during the
suppression period. During this period, traffic is forwarded along the path SwitchA
-> SwitchB -> SwitchD -> SwitchE -> SwitchF.
NOTE
By default, the Hold-max-cost mode takes effect. The mode can be changed to Hold-down
manually.
Figure 6-10 Flapping suppression in a multi-area scenario
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 399
6.2.5 OSPFv3 and OSPFv2 Comparison
The following aspects of OSPFv3 and OSPFv2 are the same:
● Network type and interface type
● Interface state machine and neighbor state machine
● LSDB
● Flooding mechanism
● Hello, DD, LSR, LSU, and LSAck packets
● Route calculation
The following aspects of OSPFv3 and OSPFv2 are different:
● OSPFv3 runs on IPv6, which is based on links rather than network segments.
This means that there is no need to configure OSPFv3 on interfaces in the
same network segment. It is only necessary that the interfaces enabled with
OSPFv3 are on the same link. Interfaces can also set up OSPFv3 sessions
without IPv6 global addresses.
● OSPFv3 does not depend on IP addresses.
This separates topology calculation from IP addresses. OSPFv3 calculates a
topology without knowing the IPv6 global address, which only applies to
virtual link interfaces for packet forwarding.
● OSPFv3 packets and the LSA format have the following changes:
– OSPFv3 packets do not contain IP addresses.
– OSPFv3 router LSAs and network LSAs do not contain IP addresses, which
are advertised by Type 8 LSAs and Type 9 LSAs.
– In OSPFv3, router IDs, area IDs, and LSA link state IDs no longer indicate
IP addresses, but the IPv4 address format is still reserved.
– In broadcast, NBMA, or P2MP networks, neighbors are identified by
router IDs instead of IP addresses.
● In OSPFv3, information about the flooding scope is added in the LSA Type
field.
This allows OSPFv3 routers to process LSAs of unidentified types, which
makes processing more flexible.
– OSPFv3 stores or floods unidentified packets, whereas OSPFv2 discards.
– OSPFv3 floods packets in an OSPF area or on a link. It sets the U flag bit
of packets (the flooding area is based on the link local) so that
unidentified packets are stored or forwarded to the stub area.
For example, RouterA and RouterB can identify LSA of a certain type. They are
connected through RouterC, which cannot identify this type of LSA. When
RouterA floods an LSA of this type, RouterC still floods it to RouterB even
though it cannot identify the LSA itself. RouterB then processes the LSA
normally.
If this occurred over OSPFv2, RouterC would discard the unidentified LSA, and
it would not reach RouterB.
● OSPFv3 supports multi-process on a link.
Only one OSPFv2 process can be configured on a physical interface, but
multiple OSPFv3 processes can be configured a single physical interface.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 400
These processes are identified by different instance IDs. They establish
neighbor relationships with the other end of the link and transmit packets to
the other end without interfering with each other.
The resources of a link can therefore be shared among OSPFv3 instances that
simulate multiple OSPFv3 routers. This allows more efficient use of limited
router resources.
● OSPFv3 uses IPv6 link-local addresses.
IPv6 implements neighbor discovery and automatic configuration based on
link-local addresses. Routers running IPv6 do not forward IPv6 packets whose
destination address is a link-local address. Those packets can only be
exchanged on the same link. The unicast link-local address starts from
FE80::/10.
As a routing protocol running on IPv6, OSPFv3 uses link-local addresses to
maintain neighbor relationships and update LSDBs. All OSPFv3 interfaces,
except Vlink interfaces, use link-local addresses as the source address and the
next hop address to transmit OSPFv3 packets.
The advantages are as follows:
– The OSPFv3 can calculate the topology without knowing the global IPv6
addresses.
– The packets flooded on a link are not transmitted to other links, which
prevents unnecessary flooding and saves bandwidth.
● OSPFv3 supports the following two new LSAs:
– Type 8 (Link) LSA: A router floods a link LSA on the link where it resides
to advertise its link-local address and the configured global IPv6 address.
– Type 9 (Intra-Area-Prefix) LSA: A router advertises an intra-area-prefix
LSA in the local OSPF area to inform other routers in the area or network
of its IPv6 global address. The network can be a broadcast network or an
NBMA network.
● OSPFv3 identifies neighbors based only on router IDs.
OSPF identifies neighbors based on IPv4 interface addresses in broadcast,
NBMA, P2P, and P2MP networks and identifies neighbors based on router IDs
in Vlink networks.
Since OSPFv3 identifies neighbors based only on router IDs, it can establish
and maintain neighbor relationships even when global IPv6 addresses are not
configured or are configured in different network segments. Topology
calculation is not based on IP addresses.
6.3 Summary of OSPFv3 Configuration Tasks
Table 6-6 describes the OSPFv3 configuration tasks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 401
Table 6-6 OSPFv3 configuration tasks
Scenario Description Task
Constructing a basic
OSPFv3 network
Enable the OSPFv3
process and specify the
router ID before
configuring OSPFv3.
After this is complete,
other OSPFv3 functions
can be configured or
take effect.
● 6.6 Configuring Basic
OSPFv3 Functions
● 6.7 Establishing and
Maintaining an
OSPFv3 Neighbor
Relationship
Configuring OSPFv3
special area attributes
You can flexibly use
OSPFv3 special area
attributes to deploy the
network according to
actual requirements. The
special areas are as
follows:
● 6.8 Configuring an
OSPFv3 Area
● 6.9 Configuring an
OSPFv3 NSSA
Configuring OSPFv3
route attributes
You can configure the
OSPFv3 route attributes
to change OSPFv3 route
selection policies. This
can help meet the
requirements of complex
network environments.
6.10 Configuring
OSPFv3 Route
Attributes
Controlling OSPFv3
routing information
You can configure route
summarization as well as
the filtering of received
and advertised routes.
Route summarization
lowers the number of
external routes in the
LSDB and provides
accurate control of
OSPFv3 routing
information.
6.11 Controlling
OSPFv3 Routing
Information
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 402
Scenario Description Task
Adjusting and optimizing
OSPFv3 networks
You can change the
OSPFv3 packet timer to
adjust the OSPFv3
network convergence
rate and network load
caused by protocol
packets. On some low-
rate links, the delay of
LSA transmission by
interfaces must be taken
into account. You can
adjust the Shortest Path
First (SPF) calculation
interval to restrict
resource consumption
caused by frequent
network changes.
6.12 Optimizing an
OSPFv3 Network
Configuring OSPFv3 GR You can enable OSPFv3
GR features to prevent
route flapping and
interruption of traffic
forwarding caused by an
OSPFv3 restart.
After OSPFv3 is
restarted, the GR
restarter and the GR
helper reestablish
neighbor relationships,
exchange routing
information, synchronize
the database, and
update the routing and
forwarding tables. This
implements fast OSPFv3
convergence.
6.15 Configuring
OSPFv3 GR
Improving OSPFv3
network security
On networks that require
high security, you can
configure the OSPFv3
Generalized TTL Security
Mechanism (GTSM) and
authentication mode to
improve network
security.
6.16 Improving OSPFv3
Network Security
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 403
Scenario Description Task
Configuring the OSPFv3
network management
function
OSPFv3 supports the
network management
function as well as fault
and log functions. You
can bind the OSPFv3
management
information base (MIB)
to a process to use these
functions.
6.19 Configuring the
Network Management
Function of OSPFv3
6.4 Licensing Requirements and Limitations for OSPFv3
Involved Network Elements
Other network elements are required to support OSPFv3.
Licensing Requirements
OSPFv3 is a basic feature of a switch and is not under license control.
Feature Support in V200R024C00
All models of S300, S500, S2700, S5700, and S6700 series switches (except the
S5751-L, S5731-L and S5731S-L) support OSPFv3.
NOTE
For details about the hardware specifications and matched parts of the switch, visit
Hardware Center. For details about the key specifications and full software specifications of
the switch, visit Specifications Query.
The S5751-L, S5731-L, and S5731S-L are remote units and do not support web-based
management, YANG, or commands. They can be configured only through configuration
delivery by the central device. For details, see "Simplified Architecture Configuration (the
Solar System Solution)" in the
S300, S500, S2700, S5700, and S6700 V200R024C00
Configuration Guide - Device Management.
Feature Limitations
None.
6.5 Default Settings for OSPFv3
Table 6-7 describes the default settings for OSPFv3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 404
Table 6-7 Default settings for OSPFv3
Parameter Default Setting
OSPFv3 Disabled
Interval at which Hello
packets are sent
● 10 seconds for the interfaces on the P2P and
broadcast networks
● 30 seconds for the interfaces on P2MP and
NBMA networks
Dead interval after which
OSPFv3 neighbor
relationships expire
● 40 seconds for the interfaces on the P2P and
broadcast networks
● 120 seconds for the interfaces on P2MP and
NBMA networks
Period during which a
switch acts as a stub router
500 seconds
Bandwidth reference value
used to calculate a link cost
100 Mbit/s
6.6 Configuring Basic OSPFv3 Functions
Applicable Environment
Configure basic OSPFv3 functions before building OSPFv3 networks. Enable
OSPFv3 and specify the interface, area ID, and router ID before configuring other
functions.
Pre-configuration Tasks
Before configuring basic OSPFv3 functions, complete the following tasks:
● Enable IPv6 capabilities.
● Make the network layers of the adjacent nodes accessible.
6.6.1 Enabling OSPFv3
Context
OSPFv3 supports multiple processes on a switch. These processes are
differentiated by process IDs. A process ID is set when OSPFv3 is enabled and is
only locally valid. It does not affect packet exchange with other switches.
A router ID is a 32-bit unsigned integer that uniquely identifies a switch within an
AS. It is expressed in the IPv4 address format. OSPFv3 router IDs must be
manually set. If the router ID is not set, OSPFv3 cannot function normally.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 405
Ensure that the router IDs of switches in an AS are all different. When multiple
OSPFv3 processes are enabled on a switch, specify a unique router ID for each
process.
Plan router IDs and manually configure them to ensure the stable operation of
OSPFv3.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ] [ vpn-instance
vpn-instance-name ]
OSPFv3 is enabled, and the OSPFv3 view is displayed.
Step 3 Run router-id
router-id
A router ID is set.
When configuring a router ID, ensure that the router ID is unique in an AS. You
can select the IP address of an interface as the router ID.
NOTE
If router IDs conflict in an OSPFv3 process, routers cannot establish OSPFv3 neighbor
relationships, and the routing information is incorrect.
If a router ID conflict occurs, perform either of the following operations:
● Reconfigure a router ID.
● Run the undo ospfv3 router-id auto-recover disable command to enable the
switch to automatically change the conflicted router ID to its own IP address.
NOTE
– After the undo ospfv3 router-id auto-recover disable command is run, the conflicting
router ID will be changed.
– After the router ID is changed, if the new router ID still conflicts with another one, the
switch is allowed to reconfigure one for a maximum of three times.
----End
6.6.2 Enabling OSPFv3 on an Interface
Context
After enabling OSPFv3 in the system view, enable OSPFv3 on an interface.
Because an interface has multiple instances, specify in which instance OSPFv3 is
enabled. If no instance ID is specified, the value defaults to 0. The same instance
must be enabled on interfaces between which the neighbor relationship is set up.
Perform the following operations on the switch that runs OSPFv3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 406
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3
process-id area
area-id [ instance
instance-id ]
OSPFv3 is enabled on the interface.
The area ID can be entered as a decimal integer or in the IPv4 address format, but
it is always displayed in the IPv4 address format.
Step 5 (Optional) Run the ospfv3 network-type { broadcast | nbma | p2mp [ non-
broadcast ] | p2p } [ instance
instance-id ] command to configure a network type
for the interface.
NOTE
When an interface supports multi-instances, you must specify the value of
instance-id when
enabling OSPFv3 on the interface. If the value of
instance-id is not specified, the default value 0
is used. In this case, the configured network type of an interface may not match the actual
network type of the interface. This step is mandatory in such a case.
----End
6.6.3 Entering an OSPFv3 Area View
Context
When configuring OSPFv3 switches in the same area, uniformly plan the
configuration data. Otherwise, neighbor switches cannot exchange information
with each other. This causes congestion of routing information or routing loops.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ] [ vpn-instance
vpn-instance-name ]
The OSPFv3 view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 407
Step 3 Run area
area-id
The OSPFv3 area view is displayed.
The area ID can be entered as a decimal integer or in the IPv4 address format.
However, it is displayed in the IPv4 address format.
An OSPFv3 area cannot be manually deleted. It is automatically deleted only after
all the configurations in the area view are cleared.
----End
6.6.4 (Optional) Configuring a Route Selection Rule
Context
RFC 5340 and RFC 1583 define route selection rules differently. After OSPFv3 is
enabled on a switch, you need to specify a route selection rule based on the
switch configuration. By default, a switch complies with the route selection rule
defined in RFC 5340. If the neighboring switch complies with the route selection
rule defined in RFC 1583, you need to configure the local switch to comply with
that defined in RFC 1583. This allows all switches in an OSPFv3 area to comply
with the same route selection rule.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospf [
process-id ] [ vpn-instance
vpn-instance-name ]
The OSPF process view is displayed.
Step 3 Run rfc1583 compatible
The device is configured to comply with the route selection rules defined in RFC
1583, rather than RFC 5340.
By default, the switch complies with the route selection rules defined in RFC 5340.
----End
6.6.5 Verifying the Basic OSPFv3 Function Configuration
Prerequisites
Configuring basic OSPFv3 functions is complete.
Procedure
● Run the display ospfv3 [
process-id ] command to check the summary
information about the OSPFv3 process.
● Run the display ospfv3 [
process-id ] interface [ area
area-id ] [
interface-
type interface-number ] command to check the OSPFv3 interface information.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 408
● Run the following commands to check OSPFv3 LSDB information:
– display ospfv3 [
process-id ] lsdb [ area
area-id ] [ originate-router
advertising-router-id | self-originate ] [ { router | network | inter-router
[ asbr-router
asbr-router-id ] | { inter-prefix | nssa } [
ipv6-address
prefix-length ] | link | intra-prefix | grace } [
link-state-id ] ]
– display ospfv3 [
process-id ] lsdb [ originate-router
advertising-router-
id | self-originate ] external [
ipv6-address prefix-length ] [
link-state-
id ]
● Run the display ospfv3 [
process-id ] [ area
area-id ] peer [
interface-type
interface-number ] [ verbose ] command or display ospfv3 [
process-id ]
[ area
area-id ] peer
neighbor-id [ verbose ] command to check the
information about the OSPFv3 neighbor.
● Run the display ospfv3 [
process-id ] routing [ abr-routes | asbr-routes |
statistics |
ipv6-address prefix-length | intra-routes | inter-routes | ase-
routes | nssa-routes ] command to check the OSPFv3 routing table:
● Run the display ospfv3 [
process-id ] path command to check the paths to a
destination address.
● Run the display default-parameter ospfv3 command to check the default
OSPFv3 configuration.
----End
6.7 Establishing and Maintaining an OSPFv3 Neighbor
Relationship
Applicable Environment
Establishing and maintaining OSPFv3 neighbor relationships is necessary for the
construction of an OSPFv3 network. The configurations in this section allow you
to:
● Modify OSPFv3 timers to adjust the convergence speed of the OSPFv3
network and the network load caused by protocol packets.
● Configure the OSPFv3 retransmission limitation to prevent non-stop packet
retransmissions if the neighbor does not receive packets.
● Adjust the intervals for updating and receiving LSAs to speed up the
convergence of an OSPFv3 network.
Pre-configuration Tasks
Before establishing or maintaining an OSPFv3 neighbor relationship, configure
basic OSPFv3 functions.
6.7.1 Configuring an Interval at Which Hello Packets are Sent
Context
Hello packets are sent periodically to the neighbor switch to establish and
maintain a neighbor relationship and to elect a designated router (DR) and a
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 409
backup DR (BDR). RFC 2328 requires that the Hello timer values of neighbors be
consistent. The value of the Hello timer is inversely proportional to the route
convergence speed and network load.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 timer hello
interval [ conservative ] [ instance
instance-id ]
The interval at which Hello packets are sent is set on the interface.
----End
6.7.2 Configuring a Dead Time for a Neighbor Relationship
Context
A neighbor switch is considered invalid if a switch receives no Hello packets it for a
specified period of time. The period is called the dead time. The dead time on an
interface must be at least four times its Hello interval.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 410
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 timer dead
interval [ instance
instance-id ]
A dead time is specified for a neighbor relationship.
----End
6.7.3 Configuring an LSA Retransmission Interval
Context
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 timer retransmit
interval [ instance
instance-id ]
The interval for retransmitting LSAs to adjacent switches is set.
The value of
interval must be greater than the round trip time of one packet
transmitted between two switches.
NOTE
An excessively small LSA retransmission can cause unnecessary retransmissions.
----End
6.7.4 Configuring an LSA Transmission Delay
Context
LSAs age in the LSDB of a local switch but do not age in the transmission process.
Set a delay for LSA transmission. This is a necessary configuration for low-speed
networks.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 411
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 trans-delay
interval [ instance
instance-id ]
A delay for LSA transmission is set on the interface.
----End
6.7.5 Verifying the OSPFv3 Neighbor Relationship
Establishment and Maintenance Configuration
Prerequisites
The configurations for establishing and maintaining an OSPFv3 neighbor
relationship have been completed.
Procedure
● Run the display ospfv3 [
process-id ] interface [ area
area-id ] [
interface-
type interface-number ] command to check the OSPFv3 interface information.
----End
6.8 Configuring an OSPFv3 Area
Applicable Environment
Define OSPFv3 areas to reduce the number of LSAs in the network and enhance
OSPFv3 extensibility. To further reduce the size of routing tables and number of
LSAs, specify some non-backbone areas at the edge of ASs as stub areas.
Pre-configuration Tasks
Before configuring OSPFv3 area attributes, configure basic OSPFv3 functions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 412
6.8.1 Configuring an OSPFv3 Stub Area
Context
Perform the following operations on each switch that runs OSPFv3 in the area
that will be configured as a stub area:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
Step 3 Run area
area-id
The OSPFv3 area view is displayed.
Step 4 Run stub [ no-summary ]
The area is configured as a stub area.
Step 5 (Optional) Run default-cost
cost
The cost of the default route sent to the stub area is set.
By default, this cost is 1.
Perform this step only on the ABR in the stub area.
The parameter no-summary takes effect only when the stub command is
configured on the ABR. If this parameter is configured, the ABR only sends the
summary-LSA of a default route to the stub area. It does not generate other
summary-LSAs, such as AS-external-LSAs or Summary-LSAs. This area is called a
totally stub area.
----End
6.8.2 Configuring OSPFv3 Virtual Links
Context
After an OSPFv3 area is defined, OSPFv3 route updates between non-backbone
areas are implemented through a backbone area. OSPFv3 requires all non-
backbone areas to maintain connectivity with the backbone area and the
backbone area to maintain its own connectivity as well. If this requirement cannot
be met, configure OSPFv3 virtual links.
A virtual link must be configured at both ends of the link, or it will not take effect.
Perform the following operations on the switch that runs OSPFv3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 413
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
Step 3 Run area
area-id
The OSPFv3 area view is displayed.
Step 4 Run vlink-peer
router-id [ hello
hello-interval | retransmit
retransmit-interval |
trans-delay
trans-delay-interval | dead
dead-interval | instance
instance-id |
{ authentication-mode { hmac-sha256 key-id
key-id { plain
plain-text |
[ cipher ]
cipher-text } | keychain
keychain-name } | ipsec sa
sa-name } ] *
A virtual link is created and configured.
NOTICE
If plain is selected, the password is saved in the configuration file in plain text.
This brings security risks. It is recommended that you select cipher to save the
password in cipher text.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support the keychain
keychain-name parameter.
----End
6.8.3 Verifying the OSPFv3 Area Configuration
Prerequisites
The configurations for an OSPFv3 area have been completed.
Procedure
● Run the following commands to check OSPFv3 LSDB information:
– display ospfv3 [
process-id ] lsdb [ area
area-id ] [ originate-router
advertising-router-id | self-originate ] [ { router | network | inter-router
[ asbr-router
asbr-router-id ] | { inter-prefix | nssa } [
ipv6-address
prefix-length ] | link | intra-prefix | grace } [
link-state-id ] ]
– display ospfv3 [
process-id ] lsdb [ originate-router
advertising-router-
id | self-originate ] external [
ipv6-address prefix-length ] [
link-state-
id ]
● Run the following commands to check the OSPFv3 routing table:
– display ospfv3 [
process-id ] routing uninstalled
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 414
– display ospfv3 [
process-id ] routing [
ipv6-address prefix-length | abr-
routes | asbr-routes | intra-routes | inter-routes | ase-routes | nssa-
routes | [ statistics ] [ uninstalled ] ]
● Run the display ospfv3 [
process-id ] vlink command to check information
about OSPFv3 virtual links.
● Run the display ospfv3 [
process-id ] vlink command to check information
about OSPFv3 virtual links.
----End
6.9 Configuring an OSPFv3 NSSA
Applicable Environment
Configure a non-backbone area on the border of an AS as a not-so-stubby area
(NSSA) to reduce entries in routing tables and the amount of routing information
transmitted. An NSSA allows the transmission of Type 7 LSAs, which are generated
by ASBRs in an NSSA. These LSAs are converted into Type 5 LSAs in the NSSA and
advertised to other areas.
Pre-configuration Tasks
Before configuring an OSPFv3 NSSA, configure basic OSPFv3 functions.
6.9.1 Defining an Area as an NSSA
Context
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 process view is displayed.
Step 3 (Optical) Run lsa-forwarding-address { standard | zero-translate }
The OSPFv3 forwarding address (FA) function is enabled.
Step 4 Run area
area-id
The OSPFv3 area view is displayed.
Step 5 Run nssa [ default-route-advertise [ cost
cost | type
type | tag
tag ] * | no-
import-route | no-summary | translator-always | translator-interval
translator-
interval | set-n-bit | suppress-forwarding-address ] *
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 415
An area is configured as an NSSA.
----End
Follow-up Procedure
If an area is configured as an NSSA, all switches in the area must be configured
with the NSSA attribute.
The area may be updated after NSSA attributes are configured or deleted.
Therefore, the NSSA attributes can be re-configured or deleted only after the last
update to the area is complete.
6.9.2 Verifying the OSPFv3 NSSA Configuration
Prerequisites
The configurations for an OSPFv3 NSSA are complete.
Procedure
● Run the display ospfv3 [
process-id ] area [
area-id ] command to check
information about an OSPFv3 area.
● Run the following commands to check the OSPFv3 routing table:
– display ospfv3 [
process-id ] routing uninstalled
– display ospfv3 [
process-id ] routing [ abr-routes | asbr-routes |
statistics [ uninstalled ] |
ipv6-address prefix-length | intra-routes |
inter-routes | ase-routes | nssa-routes ]
----End
6.10 Configuring OSPFv3 Route Attributes
Applicable Environment
To meet the requirements of complex networks, change OSPFv3 routing policies
by setting OSPFv3 route attributes. You can:
● Set a cost for an OSPFv3 interface.
● Configure load balancing among equal-cost routes.
Pre-configuration Tasks
Before configuring OSPFv3 route attributes, configure basic OSPFv3 functions.
6.10.1 Setting a Cost for an OSPFv3 Interface
Context
You can control route calculation by setting link costs for OSPFv3 interfaces.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 416
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 cost
cost [ instance
instance-id ]
A cost is set for the OSPFv3 interface.
By default, this cost is 1.
----End
6.10.2 Setting the Maximum Number of Equal-Cost Routes
Context
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
Step 3 Run maximum load-balancing
number
The maximum number of equal-cost routes is set.
The default value is 8.
----End
6.10.3 Verifying the OSPFv3 Route Attribute Configuration
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 417
Prerequisites
The configurations for OSPFv3 route attributes are complete.
Procedure
● Run the display ospfv3 [
process-id ] interface [ area
area-id ] [
interface-
type interface-number ] command to check the OSPFv3 interface information.
● Run the following commands to check OSPFv3 LSDB information:
– display ospfv3 [
process-id ] lsdb [ area
area-id ] [ originate-router
advertising-router-id | self-originate ] [ { router | network | inter-router
[ asbr-router
asbr-router-id ] | { inter-prefix | nssa } [
ipv6-address
prefix-length ] | link | intra-prefix | grace } [
link-state-id ] ]
– display ospfv3 [
process-id ] lsdb [ originate-router
advertising-router-
id | self-originate ] external [
ipv6-address prefix-length ] [
link-state-
id ]
● Run the following commands to check the OSPFv3 routing table:
– display ospfv3 [
process-id ] routing uninstalled
– display ospfv3 [
process-id ] routing [
ipv6-address prefix-length | abr-
routes | asbr-routes | intra-routes | inter-routes | ase-routes | nssa-
routes | [ statistics ] [ uninstalled ] ]
----End
6.11 Controlling OSPFv3 Routing Information
Applicable Environment
Control the advertisement and receipt of OSPFv3 routing information and
configure OSPFv3 to import external routes. Detailed operations include
configuring route summarization, filtering the received routes, and importing
external routes.
Pre-configuration Tasks
Before controlling OSPFv3 routing information, configure basic OSPFv3
functions.
6.11.1 Configuring OSPFv3 Route Summarization
Context
Route summarization on a large-scale OSPFv3 network reduces the number of
routing entries. This function minimizes system resource consumption while
maintaining system performance. In addition, if a link in the summarized IPv6
address segment frequently alternates between Up and Down, the devices outside
this address segment will not be affected by the link status transition. Route
summarization therefore prevents route flapping and improves network stability.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 418
Procedure
● Configure inter-area route summarization on an ABR.
Perform the following operations on the ABR that runs OSPFv3.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
c. Run area
area-id
The OSPFv3 area view is displayed.
d. Run abr-summary
ipv6-address prefix-length [ cost
cost | not-
advertise ] *
Route summarization for inter-area routes is configured.
● Configure external route summarization on an ASBR.
Perform the following operations on the ASBR that runs OSPFv3.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
c. Run asbr-summary
ipv6-address prefix-length [ cost
cost | tag
tag |
distribute-delay
dist-delay-interval | not-advertise ] *
Route summarization for imported routes is configured.
----End
6.11.2 Configuring OSPFv3 to Filter the Received Routes
Context
Configuring a filtering policy allows OSPFv3 to determine whether to add the
calculated routes to the local routing table when receiving LSAs.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
Step 3 Run filter-policy {
acl6-number | acl6-name
acl6-name | ipv6-prefix
ipv6-prefix-
name | route-policy
route-policy-name } import
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 419
OSPFv3 is configured to filter the imported routes.
Using the filter-policy command, you can only filter the routes calculated by
OSPFv3. Routes that do not pass the filtering criteria are neither added to the
OSPFv3 routing table nor advertised.
----End
6.11.3 Configuring OSPFv3 to Import External Routes
Context
Because OSPFv3 is a link-state routing protocol and cannot filter advertised LSAs
directly, it must filter routes when importing them. After filtering, only the routes
that pass the filtering criteria are advertised.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
Step 3 Run default { cost
cost | tag
tag | type
type }*
Default parameters are set for imported routes.
Step 4 Run import-route { bgp [ permit-ibgp ] | unr | direct | ripng
help-process-id |
static | isis
help-process-id | ospfv3
help-process-id } [ { cost
cost | inherit-cost } |
type
type | tag
tag | route-policy
route-policy-name ]*
External routes are imported.
NOTE
Importing IBGP routes in an OSPFv3 process may lead to routing loops.
After the import-route command is executed on an OSPFv3 switch to import external
routes, the switch becomes an ASBR.
Step 5 (Optional) Run default-route-advertise [ always | cost
cost | type
type | tag
tag |
route-policy
route-policy-name ]*
Default routes are advertised to the OSPFv3 routing area.
Step 6 (Optional) Run filter-policy {
acl6-number | acl6-name
acl6-name | ipv6-prefix
ipv6-prefix-name | route-policy
route-policy-name } export [
protocol [
process-
id ] ]
Imported external routes are filtered.
To filter a certain type of route, you must specify
protocol. Otherwise, OSPFv3
filters all imported routes.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 420
NOTE
The filter-policy command takes effect only for the routes imported by an ASBR using the
import-route command. The ASBR filters routes when importing the routes. The routes
that are filtered out do not generate LSAs and cannot be advertised by OSPFv3. If the
import-route command is not run to import other external routes (including OSPFv3
routes in different processes), the filter-policy command does not take effect.
----End
6.11.4 (Optional) Configuring OSPFv3 to Filter LSAs in an
Area
Context
After filtering criteria are set for the incoming or outgoing Type 3 LSAs (Inter-
Area-Prefix LSAs) in an area, only the Type 3 LSAs that meet the criteria are
received or advertised. This filters unnecessary LSAs, reduces the LSDB size, and
increases network convergence.
This function is applicable only to the ABR.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 process view is displayed.
Step 3 Run area
area-id
The OSPFv3 area view is displayed.
Step 4 Filter incoming or outgoing Type 3 LSAs in the area.
● Run the filter {
acl6-number | acl6-name
acl6-name | ipv6-prefix
ipv6-prefix-
name | route-policy
route-policy-name } import command to filter incoming
Type 3 LSAs in the area.
● Run the filter {
acl6-number | acl6-name
acl6-name | ipv6-prefix
ipv6-prefix-
name | route-policy
route-policy-name } export command to filter outgoing
Type 3 LSAs in the area.
----End
6.11.5 Verifying the OSPFv3 Route Control Configuration
Procedure
● Run the following commands to view the OSPFv3 routing table:
– display ospfv3 [
process-id ] routing uninstalled
– display ospfv3 [
process-id ] routing [
ipv6-address prefix-length | abr-
routes | asbr-routes | intra-routes | inter-routes | ase-routes | nssa-
routes | [ statistics ] [ uninstalled ] ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 421
● Run the following commands to view OSPFv3 LSDB information:
– display ospfv3 [
process-id ] lsdb [ area
area-id ] [ originate-router
advertising-router-id | self-originate ] [ { router | network | inter-router
[ asbr-router
asbr-router-id ] | { inter-prefix | nssa } [
ipv6-address
prefix-length ] | link | intra-prefix | grace } [
link-state-id ] ]
– display ospfv3 [
process-id ] lsdb [ originate-router
advertising-router-
id | self-originate ] external [
ipv6-address prefix-length ] [
link-state-
id ]
● Run the following commands to view OSPFv3 route summarization
information:
– display ospfv3 [
process-id ] abr-summary-list [
ipv6-address prefix-
length ]
– display ospfv3 [
process-id ] asbr-summary [
ipv6-address prefix-
length ] [ verbose ]
----End
6.12 Optimizing an OSPFv3 Network
Applicable Environment
Adjust the OSPFv3 timer to change the convergence speed of an OSPFv3 network
and the network overload caused by protocol packets. On low-speed links, take
into account the delay in transmitting LSAs on the interface. Adjust the SPF
calculation interval to mitigate resource consumption caused by frequent network
changes.
Specify the DR priority of an interface to affect DR and BDR election in a
broadcast network.
Pre-configuration Tasks
Before optimizing an OSPFv3 network, configure basic OSPFv3 functions.
6.12.1 Configuring an SPF Timer
Context
When the OSPFv3 LSDB changes, SPF calculation must be performed again. A
shorter SPF calculation interval can increase network convergence speed, but also
occupies more resources. In addition, frequent network changes can cause
excessive bandwidth use. A longer SPF calculation interval occupies fewer
resources, which prevents the bandwidth use due to frequent network changes.
However, this also decreases network convergence speed. Set the interval based
on actual network conditions.
Perform the following operations on the switch that runs OSPFv3.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 422
Procedure
● Configure an SPF normal timer.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
c. Run spf timers
delay-interval hold-interval
Or run spf-schedule-interval
delay-interval hold-interval
An SPF normal timer is configured.
● Configure an SPF intelligent timer.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
c. Run spf-schedule-interval intelligent-timer
max-interval start-interval
hold-interval-1
An SPF intelligent timer is configured.
NOTE
The configurations of the spf timers
delay-interval hold-interval, spf-schedule-
interval
delay-interval hold-interval, and spf-schedule-interval intelligent-
timer
max-interval start-interval hold-interval-1 commands will override each
other, and only the configuration of the last executed command takes effect.
----End
6.12.2 Suppressing an Interface from Sending and Receiving
OSPFv3 Packets
Context
To prevent a switch from advertising routes to the switch on a certain network
and from importing the routes of other switches, suppress the interface on which
OSPFv3 is enabled from receiving and sending OSPFv3 packets.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 423
Step 3 Run silent-interface { all |
interface-type interface-number }
The interface is suppressed from sending and receiving OSPFv3 packets.
----End
Follow-up Procedure
Different processes can suppress the same interface from sending and receiving
OSPFv3 packets, but the silent-interface command is valid only for the OSPFv3
interface on which the specified process is enabled. It does not take effect on the
interface of other processes.
After an OSPFv3 interface is set to silent, the interface can still advertise its direct
routes using the Intra-Area-Prefix-LSA of the same switch. No OSPFv3 neighbor
relationship can be set up on the interface. This enhances OSPFv3 adaptability.
6.12.3 Configuring a DR Priority for an Interface
Context
The DR priority on a switch interface determines whether the interface is qualified
for the DR election. If the DR priority is 0, the switch cannot be elected as a DR or
BDR.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 dr-priority
priority [ instance
instance-id ]
A DR priority is set for the interface.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 424
Follow-up Procedure
After the DR priority is changed, you can re-elect a DR or BDR. However, this will
interrupt OSPFv3 neighbor relationships between switches and is therefore only
used when necessary. The methods to re-elect a DR or BDR are as follows:
● Restart all switches.
● Run the shutdown and undo shutdown commands on the interface on
which the OSPFv3 neighbor relationship is set up.
6.12.4 Configuring a Stub Router
Context
A stub router is used to control traffic and instructs other OSPFv3 routers not to
use it to forward data. Other OSPFv3 routers can have a route to the stub router.
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 process view is displayed.
Step 3 Run stub-router [ on-startup [
interval ] ]
The switch is configured as a stub router.
NOTE
A stub router configured using this command bears no similarity to a switch in a stub area.
----End
6.12.5 Ignoring MTU Check on DD Packets
Context
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 425
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 mtu-ignore [ instance
instance-id ]
MTU check on DD packets is ignored.
----End
6.12.6 Verifying the OSPFv3 Network Optimization
Configuration
Prerequisites
The configurations for optimizing an OSPFv3 network are complete.
Procedure
● Run the display ospfv3 [
process-id ] interface [ area
area-id ] [
interface-
type interface-number ] command to check the OSPFv3 interface information.
● Run the following commands to check OSPFv3 LSDB information:
– display ospfv3 [
process-id ] lsdb [ area
area-id ] [ originate-router
advertising-router-id | self-originate ] [ { router | network | inter-router
[ asbr-router
asbr-router-id ] | { inter-prefix | nssa } [
ipv6-address
prefix-length ] | link | intra-prefix | grace } [
link-state-id ] ]
– display ospfv3 [
process-id ] lsdb [ originate-router
advertising-router-
id | self-originate ] external [
ipv6-address prefix-length ] [
link-state-
id ]
● Run the following commands to check the OSPFv3 routing table:
– display ospfv3 [
process-id ] routing uninstalled
– display ospfv3 [
process-id ] routing [
ipv6-address prefix-length | abr-
routes | asbr-routes | intra-routes | inter-routes | ase-routes | nssa-
routes | [ statistics ] [ uninstalled ] ]
----End
6.13 Configuring BFD for OSPFv3
Applicable Environment
To speed up OSPFv3 convergence when link status changes, configure BFD for
OSPFv3 links.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 426
BFD detects links much faster than keepalive protocols do. If OSPFv3 is bound to
BFD sessions, BFD can notify OSPFv3 of link failures immediately. OSPFv3 then
performs route calculation and convergence based on the new network topology.
Pre-configuration Tasks
Before configuring BFD for OSPFv3, configure basic OSPFv3 functions.
Configuration Procedure
Figure 6-11 Flowchart for configuring BFD for OSPFv3
6.13.1 Configuring BFD Globally
Context
On the two devices that need to establish a BFD session, configure BFD for all the
interfaces in a certain OSPFv3 process.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3
process-id
The OSPFv3 view is displayed.
Step 3 Run bfd all-interfaces enable
BFD for OSPFv3 is enabled to establish a BFD session.
By default, BFD is disabled in an OSPFv3 process.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 427
6.13.2 Configuring BFD for OSPFv3
Context
After enabling BFD for OSPFv3, you need to configure BFD parameters in the
OSPFv3 process.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3
process-id
The OSPFv3 view is displayed.
Step 3 Run bfd all-interfaces { min-transmit-interval
min-transmit-value | min-receive-
interval
min-receive-value | detect-multiplier
detect-multiplier-value }*
OSPFv3 BFD parameters are configured.
Using the default
min-transmit-value,
min-receive-value, and detect-multiplier
values is recommended. As such, this step can be skipped.
The parameters are configured based on the network status and network
reliability requirements. A short interval at which BFD packets are transmitted can
be configured for a link that has a higher requirement for reliability. A long
interval at which BFD packets are transmitted can be configured for a link that has
a lower requirement for reliability.
----End
6.13.3 (Optional) Preventing an Interface from Dynamically
Setting Up a BFD Session
Context
After the bfd all-interfaces enable command is run in an OSPFv3 process, the
following situations occur:
● On a P2P network, all OSPFv3 interfaces whose neighbor status is Up set up
dynamic BFD sessions.
● On a broadcast network, all OSPFv3 interfaces whose neighbor status is Up
set up dynamic sessions between DRs and non-DRs.
To prevent certain interfaces from setting up dynamic BFD sessions, perform the
following steps on the interfaces:
Procedure
Step 1 Run system-view
The system view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 428
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 bfd block
The interface is prevented from dynamically setting up BFD sessions.
----End
6.13.4 (Optional) Configuring BFD for a Specified Interface
Context
To configure BFD only on a specified interface or enable an interface to detect link
failures faster after BFD for OSPFv3 is enabled globally, perform the following
steps on the interface:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
Step 3 (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support switching between Layer 2 and Layer 3 modes.
Step 4 Run ospfv3 bfd enable
BFD is enabled on the interface to establish a BFD session.
When BFD is configured globally and the neighbor status is Full, OSPFv3
establishes BFD sessions on all the neighbors in the process using default BFD
parameters.
You can run the ospfv3 bfd { min-transmit-interval
min-transmit-value | min-
receive-interval
min-receive-value | detect-multiplier
detect-multiplier-value }*
[ instance
instance-id ] } command to set parameters for BFD sessions.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 429
Using the default
min-transmit-value,
min-receive-value, and detect-multiplier
values is recommended. Therefore, the ospfv3 bfd { min-transmit-interval
min-
transmit-value | min-receive-interval
min-receive-value | detect-multiplier
detect-multiplier-value }* [ instance
instance-id ] } command can be skipped.
The parameters are configured based on the network status and network
reliability requirements. A short interval at which BFD packets are transmitted can
be configured for a link that has a higher requirement for reliability. A long
interval at which BFD packets are transmitted can be configured for a link that has
a lower requirement for reliability.
NOTE
● The BFD configured on an interface takes precedence over that configured in a process.
Specifically, if BFD is enabled on an interface, BFD parameters on the interface are used
to establish BFD sessions.
● If the parameters of a BFD session are set but the ospfv3 bfd enable command is not
run, BFD cannot be enabled.
----End
6.13.5 Verifying the BFD for OSPFv3 Configuration
Procedure
● Run the display ospfv3 [
process-id ] bfd session [
interface-type interface-
number ] [
neighbor-id ] [ verbose ] command to check information about
the BFD session.
----End
6.14 Configuring OSPFv3 IP FRR
Usage Scenario
With the development of networks, Voice over IP (VoIP) and on-line video services
require high-quality real-time transmission. Nevertheless, if an OSPFv3 fault
occurs, traffic can be switched to a new link only after the following processes:
fault detection at the millisecond level, notifying the fault to the routing control
plane at the millisecond level, generating and flooding new topology information
at the tens of milliseconds level, triggering SPF calculation at the tens of
milliseconds level, and notifying and installing a new route at the hundreds-of-
milliseconds level. As a result, it takes much more than 50 ms to recovery the link
from the fault, which cannot meet the requirement for real-time services on the
network.
With OSPFv3 IP FRR that calculates a backup link in advance, devices can fast
switch traffic to the backup link without interrupting traffic when the primary link
becomes faulty. This protects traffic and therefore greatly improves the reliability
of OSPFv3 networks.
OSPFv3 IP FRR is applicable to the services that are sensitive to packet delay and
packet loss.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 430
NOTE
Only the S5720I-SI, S5735-S, S5735-S-I, S5735S-H, S5736-S, S5731-H, S5731-S, S5731S-H,
S5731S-S, S5732-H, S6735-S, S6720S-S, S6730-H, S6730S-H, S6730-S, and S6730S-S
support this function.
6.14.1 Enabling OSPFv3 IP FRR
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ] [ vpn-instance
vpn-instance-name ]
An OSPFv3 process is started, and the OSPFv3 view is displayed.
Step 3 Run frr
The OSPFv3 IP FRR view is displayed.
Step 4 Run loop-free-alternate
OSPFv3 IP FRR is enabled to generate a loop-free backup link.
By default, this function is disabled. OSPFv3 can generate a loop-free backup link
only when the OSPFv3 IP FRR traffic protection inequality is met.
NOTE
In the following description, Distance_opt(X, Y) indicates the shortest link from node X to
node Y, S stands for a source node, E for the faulty node, N for a node along a backup link,
and D for a destination node.
● Link protection takes effect when the traffic to be protected flows along a
specified link and the link cost meets the inequality: Distance_opt(N, D) <
Distance_opt(N, S) + Distance_opt(S, D).
● Node-and-link protection takes effect when the traffic to be protected flows
along a specified link and passes through a specified node and the following
conditions are met:
– The link cost meets the inequality: Distance_opt(N, D) < Distance_opt(N,
S) + Distance_opt(S, D).
– The interface cost meets the inequality: Distance_opt(N, D) <
Distance_opt(N, E) + Distance_opt(E, D).
Step 5 (Optional) Run frr-policy route route-policy
route-policy-name
An OSPFv3 IP FRR filtering policy is configured.
After an OSPFv3 IP FRR filtering policy is configured, only the OSPFv3 backup
routes that pass the filtering criteria can be delivered to the forwarding table. To
protect the traffic over a specific OSPFv3 route, you can configure a filtering policy
that matches the OSPFv3 route to ensure that the route can be added to the
forwarding table. If this route fails, OSPFv3 can fast switch the traffic to a backup
route.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 431
6.14.2 (Optional) Disabling OSPFv3 IP FRR on an Interface
Context
OSPFv3 IP FRR can be disabled on an interface of a specific device that is running
important services. This prevents the device connected to this interface from
providing a backup link for the local device and therefore being burdened after
FRR switches traffic to the backup link.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run interface
interface-type interface-number
The view of the OSPFv3 IP FRR-enabled interface is displayed.
Step 3 Run ospfv3 frr block
OSPFv3 IP FRR is disabled on the interface.
----End
6.14.3 Verifying the OSPFv3 IP FRR Configuration
Prerequisites
All OSPFv3 IP FRR configurations are complete.
Procedure
● Run the display ospfv3 [
process-id ] routing command to check information
about the primary and backup links after OSPFv3 IP FRR is enabled.
View the routes to the specified OSPFv3 device.
<HUAWEI> display ospfv3 routing verbose
Codes : E2 - Type 2 External, E1 - Type 1 External, IA - Inter-Area,
N - NSSA, U - Uninstalled, D - Denied by Import Policy
Destination : CC:: Prefix Length : 64
Metric : 21 Type : INTRA-AREA
Nexthop : FE80::2E0:50FF:FE79:8242 Nexthop Interface: GigabitEthernet0/0/1
Backup Nexthop: FE80::2E0:D0FF:FE02:8142 Backup Interface : GigabitEthernet0/0/2
Backup Type : LINK PROTECT
The preceding information shows that a backup route is generated on the
switch, including information about the backup next hop: Backup NextHop,
Backup Interface, and Backup Type indicating the address, outbound
interface, and type of the backup next hop respectively.
----End
6.15 Configuring OSPFv3 GR
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 432
Applicable Environment
Configure OSPFv3 Graceful Restart (GR) to avoid route flapping and packet loss
after an OSPFv3 switch restarts.
After OSPFv3 restarts, the GR restarter and GR helper maintain the neighbor
relationship, exchange routing information, synchronize the database, and update
the routing table and the forwarding table. This ensures OSPFv3 fast convergence.
Pre-configuration Tasks
Before configuring OSPFv3 GR, configure basic OSPFv3 functions.
6.15.1 Enabling OSPFv3 GR
Context
Perform the following operations on the switch that runs OSPFv3.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
Step 3 Run graceful-restart [ period
period | ack-time
time | retransmit-interval
interval | lsa-checking-ignore | planned-only ] *
OSPFv3 GR is enabled.
By default, OSPFv3 GR is disabled.
ack-time is optional. After ack-time is specified, the restarter can discover more
neighbors in the
ack-time period.
----End
6.15.2 Enabling the OSPFv3 GR Helper
Context
Perform the following operations on the switch that runs OSPFv3:
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 [
process-id ]
The OSPFv3 view is displayed.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 433
Step 3 Run helper-role [ { ip-prefix
ip-prefix-name | acl-number
acl-number | acl-name
acl-name } | max-grace-period
period | planned-only | lsa-checking-ignore ] *
The OSPFv3 GR helper is enabled.
By default, the OSPFv3 GR helper is disabled.
----End
6.15.3 Verifying the OSPFv3 GR Configuration
Prerequisites
The configurations for the OSPFv3 GR are complete.
Procedure
● Run the display ospfv3 [
process-id ] graceful-restart-information
command to check the status of OSPFv3 GR.
----End
6.16 Improving OSPFv3 Network Security
Usage Scenario
If an OSPFv3 network requires high security, you can configure OSPFv3
generalized TTL security mechanism (GTSM) and an authentication mode to
improve network security.
● During network attacks, attackers may simulate OSPFv3 unicast packets and
continuously send them to the switch. If the packets are destined for the
switch, it directly forwards them to the control plane for processing without
validating them. As a result, the increased processing workload on the control
plane leads to high CPU usage. GTSM protects the switch against potential
attacks and improves system security by checking whether Hop Limit value in
each IP packet header is within a pre-defined range.
NOTE
OSPFv3 GTSM takes effect only on unicast packets and therefore applies to virtual
links and sham links.
● In OSPFv3 authentication, an authentication field is added to each OSPFv3
packet for encryption. When a local device receives an OSPFv3 packet from a
remote device, the local device discards the packet if the authentication
password carried in the packet is different from the local one, which protects
the local device against potential attacks. Therefore, OSPFv3 authentication
improves network security.
Pre-configuration Tasks
Before improving OSPFv3 network security, complete the following tasks:
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 434
● Configure an IP address for each interface to ensure that neighboring routers
can use the IP addresses to communicate with each other.
● Configure basic OSPFv3 functions.
6.16.1 Configuring OSPFv3 GTSM
Context
GTSM only checks the TTL values of packets that match a GTSM policy. You can
configure a switch to allow mismatched packets to pass through the filter or be
discarded. If you configure the switch to discard mismatched packets, enable
GTSM on the switches with which the switch may communicate. Otherwise,
connections cannot be established, because the switch discards all packets from
non-GTSM switches.
In addition, you can configure the switch to log discarded packets. This facilitates
future fault locating.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 valid-ttl-hops
valid-ttl-hops-value [ vpn-instance
vpn-instance-
name ]
OSPFv3 GTSM is configured.
GTSM must be enabled at both ends of an OSPFv3 connection.
The ospfv3 valid-ttl-hops command both enables OSPFv3 GTSM and sets a TTL
value. If you specify the vpn-instance parameter, the switch sets only the TTL
values of packets in this VPN but does not enable OSPFv3. Therefore, if you want
to apply the configured TTL value only to packets in a VPN instance or a public
network instance, set the default action to pass for packets that does not match
the GTSM policy. This prevents OSPFv3 packets in other instances from being
discarded.
NOTE
The range of valid TTL value is from (255 –
valid-ttl-hops-value + 1) to 255.
Step 3 (Optional) Run gtsm default-action { drop | pass }
An action is configured for the switch to perform on the packets that do not
match the GTSM policy.
By default, pass is executed on these packets.
NOTE
If an action is configured but a GTSM policy is not, GTSM does not take effect.
Step 4 (Optional) Run gtsm log drop-packet all
The switch is configured to log the packets discarded on the switch.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 435
6.16.2 Configuring an Authentication Mode
Context
OSPFv3 supports keychain and HMAC-SHA256 authentication modes. The
following procedure uses keychain authentication as an example.
Before you configure keychain authentication, run the keychain command to
configure a keychain, the key-id command to configure a key ID, the key-string
command to configure a password, and the algorithm command to configure an
algorithm. If these commands are not run, OSPFv3 authentication will fail.
NOTICE
If plain is selected during the authentication mode configuration, the password is
saved in the configuration file in plain text. This is a security risk. It is
recommended that you select cipher to save the password in cipher text.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H,
S6730-S, and S6730S-S support the keychain
keychain-name parameter.
Procedure
● Configure OSPFv3 area authentication.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 process view is displayed.
c. Run area
area-id
The OSPFv3 area view is displayed.
d. Run authentication-mode { hmac-sha256 key-id
key-id { plain
plain-
text | [ cipher ]
cipher-text } | keychain
keychain-name }
OSPFv3 area authentication is configured.
NOTE
If you use OSPFv3 area authentication, the authentication and password
configurations on all switch in the same area must be the same.
● Configure OSPFv3 process authentication.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 process view is displayed.
c. Run authentication-mode { hmac-sha256 key-id
key-id { plain
plain-
text | [ cipher ]
cipher-text } | keychain
keychain-name }
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 436
OSPFv3 process authentication is configured.
● Configure OSPFv3 interface authentication.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run ospfv3 authentication-mode { hmac-sha256 key-id
key-id { plain
plain-text | [ cipher ]
cipher-text } | keychain
keychain-name [ instance
instance-id ] }
OSPFv3 interface authentication is configured.
OSPFv3 interface authentication takes precedence over OSPFv3 area
authentication.
If you use HMAC-SHA256 authentication, the authentication and
password configurations on all the interfaces on the same network
segment must be the same.
----End
6.16.3 Verifying the OSPFv3 Network Security Optimization
Configuration
Prerequisites
Improvements on OSPFv3 network security have been made.
Procedure
● Run the display gtsm statistics {
slot-id | all } command to check GTSM
statistics.
----End
6.17 Configuring OSPFv3 Neighbor Relationship
Flapping Suppression
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 437
Usage Scenario
If an interface carrying OSPFv3 services alternates between Up and Down, OSPFv3
neighbor relationship flapping occurs on the interface. During the flapping,
OSPFv3 frequently sends Hello packets to reestablish the neighbor relationship,
synchronizes LSDBs, and recalculates routes. In this process, a large number of
packets are exchanged, adversely affecting neighbor relationship stability, OSPFv3
services, and other OSPFv3-dependent services. OSPFv3 neighbor relationship
flapping suppression can address this problem by delaying OSPFv3 neighbor
relationship reestablishment or preventing service traffic from passing through
flapping links.
NOTE
The following steps are optional, choose them as required.
Pre-configuration Tasks
Before configuring OSPFv3 neighbor relationship flapping suppression, complete
the following tasks:
● Configure an IP address for each interface to ensure that neighboring routers
are reachable at the network layer.
● Configure basic OSPFv3 functions.
Procedure
Step 1 Run system-view
The system view is displayed.
By default, OSPFv3 neighbor relationship flapping suppression is enabled globally.
To disable this function globally, run the suppress-flapping peer disable
command.
Step 2 Run interface
interface-type interface-number
The interface view is displayed.
By default, OSPFv3 neighbor relationship flapping suppression is enabled on all
interfaces in the same OSPFv3 process. To disable the function from one of the
interfaces, run the ospfv3 suppress-flapping peer disable command.
Step 3 Run ospfv3 suppress-flapping peer hold-down
interval [ instance
instance-id ]
The Hold-down mode is configured, and its duration is set.
OSPFv3 neighbor flapping suppression works in either Hold-down or Hold-max-
cost mode.
● Hold-down mode: In the case of frequent flooding and topology changes
during neighbor relationship establishment, interfaces prevent neighbor
relationship reestablishment during Hold-down suppression, which minimizes
LSDB synchronization attempts and packet exchanges.
● Hold-max-cost mode: If the traffic forwarding path changes frequently,
interfaces use 65535 as the cost of the flapping link during Hold-max-cost
suppression, which prevents traffic from passing through the flapping link.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 438
Flapping suppression can also work first in Hold-down mode and then in Hold-
max-cost mode.
By default, the Hold-max-cost mode takes effect.
To disable the Hold-max-cost mode, run the ospfv3 suppress-flapping peer hold-
max-cost disable [ instance
instance-id ] command.
Step 4 Run ospfv3 suppress-flapping peer { detecting-interval
detecting-interval |
threshold
threshold | resume-interval
resume-interval } * [ instance
instance-id ]
Detection parameters are configured for OSPFv3 neighbor relationship flapping
suppression.
Each OSPFv3 interface on which OSPFv3 neighbor relationship flapping
suppression is enabled starts a flapping counter. If the interval between two
successive neighbor status changes from Full to a non-Full state is shorter than
detecting-interval, a valid flapping_event is recorded, and the flapping_count is
incremented by 1. When the flapping_count reaches or exceeds
threshold, flapping
suppression takes effect. If the interval between two successive neighbor status
changes from Full to a non-Full state is longer than
resume-interval, the
flapping_count is reset.
NOTE
The value of
resume-interval must be greater than that of
detecting-interval.
By default, the detection interval of OSPFv3 neighbor relationship flapping
suppression is 3s, the suppression threshold is 30, and the interval for exiting from
suppression is 10s. Using the default detection parameters is recommended.
Step 5 Run quit
The system view is displayed.
Step 6 Run quit
The user view is displayed.
Step 7 Run reset ospfv3
process-id suppress-flapping peer [
interface-type interface-
number [ instance
instance-id ] ]
Interfaces are forced to exit from OSPFv3 neighbor relationship flapping
suppression.
NOTE
Interfaces exit from flapping suppression in the following scenarios:
● The suppression timer expires.
● The corresponding OSPFv3 process is reset.
● An OSPFv3 neighbor is reset.
● OSPFv3 neighbor relationship flapping suppression is disabled globally using the
suppress-flapping peer disable command in the OSPFv3 view.
● The reset ospfv3 suppress-flapping peer command is run.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 439
Verifying the Configuration
Run the display ospfv3 [
process-id ] interface [ area
area-id ] [
interface-type
interface-number ] command to check the status of OSPFv3 neighbor relationship
flapping suppression.
<HUAWEI> display ospfv3 interface vlanif 100
VLANIF100 is up, line protocol is up
Interface ID 0x7
Interface MTU 1500
IPv6 Prefixes
FE80::2E0:74FF:FE00:8201 (Link-Local Address)
FC00:3::1/64
OSPFv3 Process (1), Area 0.0.0.0, Instance ID 0
Router ID 1.1.1.1, Network Type BROADCAST, Cost: 1
Transmit Delay is 1 sec, State Backup, Priority 1
Designated Router (ID) 4.4.4.4
Interface Address FE80::2E0:4FF:FE09:8201
Backup Designated Router (ID) 1.1.1.1
Interface Address FE80::2E0:74FF:FE00:8201
Timer interval configured, Hello 10, Dead 40, Wait 40, Retransmit 5
Hello due in 00:00:09
Neighbor Count is 1, Adjacent neighbor count is 1
Interface Event 3, Lsa Count 2, Lsa Checksum 0x15084
Interface Physical BandwidthHigh 0, BandwidthLow 100000000
Suppress flapping peer: enable(start: 2016-01-29 12:09:36-08:00, remain-interval: 500s)
Suppress flapping peer in the command output indicates the current suppression
mode (enable), time when the flapping suppression started, and the remaining
time of the flapping suppression.
6.18 Configuring OSPFv3 IPSec
Pre-configuration Tasks
Before configuring OSPFv3 IPSec, configure basic OSPFv3 functions.
6.18.1 Configuring an IPSec Session for Encryption
Context
Internet Protocol Security (IPSec) can be configured to prevent data theft and
spoofing during data transmission in a network.
A security association (SA) must be established so that IPSec can protect
transmitted data. An SA is a unidirectional logical connection set up for security
purpose and specifies the elements used by two IPSec peers (two parties that use
the IPSec protocol to protect data transmitted between them). The elements of an
SA include the following:
● Security protocol
● Authentication or encryption algorithm supported by the security protocol
● Data encapsulation mode
● Security parameter index (SPI) of the SA
● Authentication key or encryption key of the SA
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 440
The first three elements are specified in an IPSec proposal. To configure IPSec
functions, first configure an IPSec proposal on the IPSec peers, and then configure
an SA.
Procedure
Step 1 Configure an IPSec proposal.
1. Run system-view
The system view is displayed.
2. Run ipsec proposal
proposal-name
An IPSec proposal is created and the IPSec proposal view is displayed.
3. Run transform { ah | esp }
A security protocol is specified for the IPSec proposal.
By default, the security protocol used by an IPSec proposal is the
Encapsulation Security Protocol (ESP).
4. An authentication or encryption algorithm is configured.
– If AH is used, you can only configure the AH-specific authentication
algorithm because AH only authenticates packets.
Run the ah authentication-algorithm { sha1 | sha2-256 } command to
specify the authentication algorithm for the AH protocol.
By default, the AH protocol uses the Secure Hash Algorithm 2-256
(SHA2-256) authentication algorithm.
– When ESP is specified, ESP can encrypt/authenticate, or encrypt and
authenticate packets. Configure the ESP-specific authentication or
encryption algorithm.
▪ Run the esp authentication-algorithm { sha1 | sha2-256 }
command to specify the authentication algorithm for the ESP
protocol.
By default, the authentication algorithm SHA2-256 is used for ESP.
▪ Run the esp encryption-algorithm { 3des | aes [ 128 | 192 | 256 ] }
command to specify the encryption algorithm for the ESP protocol.
By default, the encryption algorithm Advanced Encryption
Standard-256 (AES-256) is used for ESP.
The SHA-1 and 3DES algorithm is not recommended because it cannot meet
your security defense requirements.
5. Run encapsulation-mode { transport | tunnel }
A data encapsulation mode is specified for the security protocol.
By default, the data encapsulation mode is tunnel.
NOTE
In transport mode, the packet encryption device and decryption device must be the
originator and receiver of packets.
6. Run quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 441
Return to the system view.
Step 2 Configure an IPSec SA.
1. Run ipsec sa
sa-name
An IPSec SA is created and the IPSec SA view is displayed.
By default, no IPSec SA exists in the system.
2. Run proposal
proposal-name
The IPSec proposal is bound to the IPSec SA.
By default, an IPSec policy does not reference any IPSec proposal.
NOTE
An IPSec can use only one IPSec proposal. To bind a new IPSec proposal to the IPSec
SA, delete the original IPSec proposal.
3. Run sa spi { inbound | outbound } { ah | esp }
spi-number
An SPI is configured for the SA.
NOTE
– An SPI uniquely identifies an SA. Each SA must be configured with an inbound SPI
and an outbound SPI. The outbound SPI on the local end must be the same as the
inbound SPI on the remote end.
– The security protocol (AH or ESP) you select when configuring the SPI must be the
same as that used in the IPSec proposal bound to the SA.
4. Configure a key according to the security protocol used in the IPSec proposal
bound to the SA.
– If the AH protocol is used, you can configure an authentication key that is
a hexadecimal number or a character string.
▪ Run the sa authentication-hex { inbound | outbound } ah
[ cipher ]
hex-cipher-key command to configure a hexadecimal
authentication key.
▪ Run the sa string-key { inbound | outbound } ah [ cipher ]
string-
cipher-key command to configure a character string as the
authentication key.
– If the ESP protocol is used, you can run one of the following commands
to configure the authentication key or the encryption key. You can also
configure both the authentication key and encryption key. If the two keys
are configured at the same time, they can only be hexadecimal keys.
▪ Run the sa authentication-hex { inbound | outbound } esp
[ cipher ]
hex-cipher-key command to configure a hexadecimal
authentication key.
▪ Run the sa string-key { inbound | outbound } esp [ cipher ]
string-
cipher-key command to configure a character string as the
authentication key.
▪ Run the sa encryption-hex { inbound | outbound } esp [ cipher ]
hex-cipher-key command to configure a hexadecimal encryption key.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 442
NOTE
– The security protocol (AH or ESP) you select when configuring the key must be the
same as that used in the IPSec proposal bound to the SA.
– The outbound key on the local end must be the same as the inbound key on the
remote end.
– The IPSec peers must use the authentication or encryption key in the same format.
For example, if the key on one end is a character string but the key on the other
end is a hexadecimal number, the IPSec tunnel cannot be set up.
– If you configure multiple keys in different formats, the last configured key takes
effect.
Step 3 Verify the configuration.
1. Run the display ipsec sa [ name
sa-name ] [ brief ] command to check
information about the SA.
2. Run the display ipsec proposal [ name
proposal-name ] command to check
information about the security proposal.
3. Run the display ipsec statistics [ sa-name
sa-name slot
slot-number ]
command to check statistics about packets processed by IPSec.
----End
6.18.2 Configuring OSPFv3 IPSec Authentication
Context
Perform the following operations on the switch that runs OSPFv3.
NOTE
To ensure device forwarding, configure OSPFv3 IPSec on all devices running OSPFv3.
Procedure
● Use an SA to authenticate packets in a specified OSPFv3 process.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 process view is displayed.
c. Run ipsec sa
sa-name
An SA is configured in the OSPFv3 process.
By default, no SA is configured in the OSPFv3 process.
An OSPFv3 process can be associated with multiple OSPFv3 areas. An SA
configured in an OSPFv3 process can be used in the associated areas.
● Use an SA to authenticate packets in a specified OSPFv3 area.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 443
The OSPFv3 process view is displayed.
c. Run area
area-id
The OSPFv3 area view is displayed.
d. Run ipsec sa
sa-name
An SA is configured in the OSPFv3 area.
By default, no SA is configured in the OSPFv3 area.
NOTE
The SA configured on an OSPFv3 area takes precedence over that configured in
an OSPFv3 process.
● Use an SA to authenticate packets sent and received by an interface.
a. Run system-view
The system view is displayed.
b. Run interface
interface-type interface-number
The interface view is displayed.
c. (Optional) On an Ethernet interface, run undo portswitch
The interface is switched to Layer 3 mode.
By default, an Ethernet interface works in Layer 2 mode.
NOTE
Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H,
S6730S-H, S6730-S, and S6730S-S support switching between Layer 2 and Layer
3 modes.
d. Run ospfv3 ipsec sa
sa-name
An SA is configured on the interface.
By default, no SA is configured on the OSPFv3 interface.
NOTE
The SA configured on an OSPFv3 interface takes precedence over that configured
in an OSPFv3 process or an OSPFv3 area.
● Use an SA to authenticate packets sent and received on a virtual link.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 process view is displayed.
c. Run area
area-id
The OSPFv3 area view is displayed.
d. Run vlink-peer
router-id ipsec sa
sa-name
An SA is configured on the virtual link.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 444
NOTE
The SA configured on a virtual link takes precedence over that configured in an
OSPFv3 process or OSPFv3 area 0.
● Use an SA to authenticate packets sent and received on a sham link.
a. Run system-view
The system view is displayed.
b. Run ospfv3 [
process-id ]
The OSPFv3 process view is displayed.
c. Run area
area-id
The OSPFv3 area view is displayed.
d. Run sham-link
source-address destination-address ipsec sa
sa-name
An SA is configured on the sham link.
NOTE
The SA configured on a sham link takes precedence over that configured in an
OSPFv3 process or OSPFv3 area 0.
----End
6.18.3 Verifying the OSPFv3 IPSec Configuration
Procedure
● Run the display ipsec proposal [ name
proposal-name ] command to check
IPSec proposal information.
● Run the display ipsec sa [ name
sa-name ] [ brief ] command to check
information about a Security Association (SA).
● Run the display ipsec statistics [ sa-name
sa-name slot
slot-number ]
command to check statistics about packets processed by IPSec.
● Run the display ospfv3 [
process-id ] command to check the SA applied in a
specified process.
● Run the display ospfv3 [
process-id ] interface command to check the SA
applied on a specified interface.
● Run the display ospfv3 [
process-id ] area [
area-id ] command to check the
SA applied in a specified area.
● Run the display ospfv3 [
process-id ] vlink command to check the SA applied
on the peer end of a virtual link.
● Run the display ospfv3 [
process-id ] sham-link command to check the SA
applied on the peer end of a sham link.
----End
6.19 Configuring the Network Management Function
of OSPFv3
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 445
Applicable Environment
OSPFv3 supports the network management function. You can bind OSPFv3 MIB
and a certain OSPFv3 process. In addition, OSPFv3 also supports the trap function
and the log function.
Pre-configuration Tasks
Before configuring the network management function of OSPFv3, configure basic
OSPFv3 functions.
6.19.1 Configuring OSPFv3 MIB Binding
Context
When multiple OSPFv3 processes are enabled, you can configure OSPFv3 MIB to
select the process to which it is bound.
Perform the following operations on the OSPFv3 switch.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run ospfv3 mib-binding
process-id
OSPFv3 MIB binding OSPFv3 process is configured.
----End
6.19.2 Configuring OSPFv3 Trap
Context
Perform the following operations on the OSPFv3 switch.
Procedure
Step 1 Run system-view
The system view is displayed.
Step 2 Run snmp-agent trap enable feature-name ospfv3 [ trap-name { ifconfigerror |
ifrxbadpacket | ifstatechange | nbrrestarthelperstatuschange | nbrstatechange
| nssatranslatorstatuschange | restartstatuschange | virtifconfigerror |
virtifrxbadpacket | virtifstatechange | virtnbrrestarthelperstatuschange |
virtnbrstatechange } ]
The trap function for the OSPFv3 module is enabled.
----End
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 446
6.19.3 Verifying the OSPFv3 Network Management Function
Configuration
Prerequisites
The configurations of the Network Management Function of OSPFv3 are
complete.
Procedure
● Run the display current-configuration command to check the configuration
currently validated on the switch.
----End
6.20 Resetting OSPFv3
Context
NOTICE
OSPFv3 adjacency relationships are removed when you reset OSPFv3 connections.
Exercise caution when running the reset ospfv3 command.
After modifying an OSPFv3 routing policy or protocol, reset the OSPFv3
connections to validate the modification.
Procedure
● To reset OSPFv3 connections and validate the new configuration, run the
following commands in the user view:
– reset ospfv3 {
process-id | all } [ graceful-restart [ extend-period
period ] ]
– reset ospfv3 {
process-id | all } counters [ neighbor [
interface-type
interface-number ] [
router-id ] ]
----End
6.21 Configuration Examples for OSPFv3
6.21.1 Example for Configuring an OSPFv3 Stub Area
Networking Requirements
In Figure 6-12, OSPFv3 is running among the three switches, and the entire
OSPFv3 network is divided into Area0 and Area1. SwitchA functions as an ABR and
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 447
connects to Area0 and Area1, and SwitchB functions as an ASBR and connects to
an OSPFv3 external network. The OSPFv3 routing table size of SwitchC needs to
be reduced without affecting communication.
Figure 6-12 Networking diagram for configuring an OSPFv3 area
Configuration Roadmap
1. Create VLANs, add interfaces to the VLANs, and assign IPv6 addresses to
VLANIF interfaces so that neighboring devices can communicate with each
other.
2. Configure basic OSPFv3 functions on SwitchA, SwitchB, and SwitchC to ensure
that there are reachable routes between OSPFv3 devices.
3. Configure a static route to the external network on SwitchB and import the
route into the OSPFv3 routing table to ensure that there are reachable routes
from the OSPFv3 network to the external network.
4. Configure Area1 as a stub area to reduce the OSPFv3 routing table size of
SwitchC.
5. Configure Area1 as a totally stub area. That is, prohibit SwitchA (an ABR) in
Area1 from advertising Type3 LSAs within Area1, which minimizing the
OSPFv3 routing table size of SwitchC.
Procedure
Step 1 Create VLANs and add interfaces to the VLANs.
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA, and are not mentioned here.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10 20
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface gigabitethernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] port link-type trunk
[SwitchA-GigabitEthernet0/0/2] port trunk allow-pass vlan 20
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure IPv6 addresses for VLANIF interfaces to ensure that neighboring devices
can communicate with each other.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 448
# Configure SwitchA. The configurations of SwitchB and SwitchC are similar to the
configuration of SwitchA, and are not mentioned here.
[SwitchA] ipv6
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ipv6 enable
[SwitchA-Vlanif10] ipv6 address fc00:0:0:1000::1/64
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ipv6 enable
[SwitchA-Vlanif20] ipv6 address fc00:0:0:1001::1/64
[SwitchA-Vlanif20] quit
Step 3 Configure basic OSPFv3 functions to ensure that there are reachable routes
between OSPFv3 devices.
# Configure SwitchA.
[SwitchA] ospfv3
[SwitchA-ospfv3-1] router-id 10.1.1.1
[SwitchA-ospfv3-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ospfv3 1 area 0
[SwitchA-Vlanif10] quit
[SwitchA] interface vlanif 20
[SwitchA-Vlanif20] ospfv3 1 area 1
[SwitchA-Vlanif20] quit
# Configure SwitchB.
[SwitchB] ospfv3
[SwitchB-ospfv3-1] router-id 10.2.2.2
[SwitchB-ospfv3-1] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] ospfv3 1 area 0
[SwitchB-Vlanif10] quit
# Configure SwitchC.
[SwitchC] ospfv3
[SwitchC-ospfv3-1] router-id 10.3.3.3
[SwitchC-ospfv3-1] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] ospfv3 1 area 1
[SwitchC-Vlanif20] quit
# Check the OSPFv3 neighbor status of SwitchA. The following command output
shows that SwitchA has established an OSPFv3 neighbor relationship with SwitchB
and SwitchC.
[SwitchA] display ospfv3 peer
OSPFv3 Process (1)
OSPFv3 Area (0.0.0.0)
Neighbor ID Pri State Dead Time Interface Instance ID
10.2.2.2 1 Full/Backup 00:00:35 Vlanif10 0
OSPFv3 Area (0.0.0.1)
Neighbor ID Pri State Dead Time Interface Instance ID
10.3.3.3 1 Full/DR 00:00:31 Vlanif20 0
Step 4 Configure a static route to the external network on SwitchB and import the route
into the OSPFv3 routing table to ensure that there are reachable routes from the
OSPFv3 network to the external network.
[SwitchB] ipv6 route-static fc01::1 64 null 0
[SwitchB] ospfv3
[SwitchB-ospfv3-1] import-route static type 1
[SwitchB-ospfv3-1] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 449
#Check the OSPFv3 routing table of SwitchC. The following command output
shows that the OSPFv3 routing table contains an AS external route.
[SwitchC] display ospfv3 routing
Codes : E2 - Type 2 External, E1 - Type 1 External, IA - Inter-Area,
N - NSSA, U - Uninstalled, D - Denied by Import Policy
OSPFv3 Process (1)
Destination Metric
Next-hop
IA FC00:0:0:1000::/64 2
via FE80::4E1F:CCFF:FE43:5A9E, Vlanif20
FC00:0:0:1001::/64 1
directly connected, Vlanif20
E1 FC01::/64 3
via FE80::4E1F:CCFF:FE43:5A9E, Vlanif20
Step 5 Configure Area1 as a stub area to reduce the OSPFv3 routing table size of
SwitchC.
# Configure the stub area of SwitchA, and set the cost of the default route
advertised to the stub area to 10.
[SwitchA] ospfv3
[SwitchA-ospfv3-1] area 1
[SwitchA-ospfv3-1-area-0.0.0.1] stub
[SwitchA-ospfv3-1-area-0.0.0.1] default-cost 10
# Configure the stub area of SwitchC.
[SwitchC] ospfv3
[SwitchC-ospfv3-1] area 1
[SwitchC-ospfv3-1-area-0.0.0.1] stub
[SwitchC-ospfv3-1-area-0.0.0.1] quit
[SwitchC-ospfv3-1] quit
Step 6 Verify the configuration.
# View the OSPFv3 routing table of SwitchC. The following command output
shows that the AS external route on SwitchC is suppressed and there is a new
default route in the routing table. The cost of the default route is the sum of the
direct route cost and the configured cost.
[SwitchC] display ospfv3 routing
Codes : E2 - Type 2 External, E1 - Type 1 External, IA - Inter-Area,
N - NSSA, U - Uninstalled, D - Denied by Import Policy
OSPFv3 Process (1)
Destination Metric
Next-hop
IA ::/0 11
via FE80::4E1F:CCFF:FE43:5A9E, Vlanif20
IA FC00:0:0:1000::/64 2
via FE80::4E1F:CCFF:FE43:5A9E, Vlanif20
FC00:0:0:1001::/64 1
directly connected, Vlanif20
Step 7 Configure Area1 as a totally stub area. That is, prohibit SwitchA (an ABR) in Area1
from advertising Type3 LSAs within Area1, which minimizing the OSPFv3 routing
table size of SwitchC.
# On SwitchA, configure Area1 as a totally stub area.
[SwitchA-ospfv3-1-area-0.0.0.1] stub no-summary
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 450
Step 8 Verify the configuration.
# View the OSPFv3 routing table of SwitchC. The following command output
shows that the OSPFv3 routing table size of SwitchC is further reduced because
both the AS external route and inter-area route are suppressed.
[SwitchC] display ospfv3 routing
Codes : E2 - Type 2 External, E1 - Type 1 External, IA - Inter-Area,
N - NSSA, U - Uninstalled, D - Denied by Import Policy
OSPFv3 Process (1)
Destination Metric
Next-hop
IA ::/0 11
via FE80::4E1F:CCFF:FE43:5A9E, Vlanif20
FC00:0:0:1001::/64 1
directly connected, Vlanif20
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
vlan batch 10 20
#
ospfv3 1
router-id 10.1.1.1
area 0.0.0.1
stub no-summary
default-cost 10
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1000::1/64
ospfv3 1 area 0.0.0.0
#
interface Vlanif20
ipv6 enable
ipv6 address FC00:0:0:1001::1/64
ospfv3 1 area 0.0.0.1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchB configuration file
#
sysname SwitchC
#
ipv6
#
vlan batch 10
#
ospfv3 1
router-id 10.2.2.2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 451
import-route static type 1
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1000::2/64
ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchC configuration file
#
sysname SwitchC
#
ipv6
#
vlan batch 20
#
ospfv3 1
router-id 10.3.3.3
area 0.0.0.1
stub
#
interface Vlanif20
ipv6 enable
ipv6 address FC00:0:0:1001::2/64
ospfv3 1 area 0.0.0.1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
return
6.21.2 Example for Configuring DR Election Through OSPFv3
Networking Requirements
On the network shown in Figure 6-13, SwitchA has the highest priority (100) on
the network and is elected as the DR. SwitchC has the second highest priority and
is elected as the BDR. SwitchB has the priority of 0 and cannot be elected as a DR.
SwitchD uses the default priority (1).
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 452
Figure 6-13 Networking diagram for configuring DR election through OSPFv3
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IPv6 addresses for interfaces.
2. Configure a router ID for each switch, enable OSPFv3, and specify the
network segments.
3. Check the DR and BDR status of each switch when the default priority is used.
4. Set a DR priority for the interface on each switch and check whether the
switch has become the DR or BDR.
Procedure
Step 1 Add interfaces to VLANs.
# Configure SwitchA. Ensure that the configurations of Switch, SwitchB, SwitchC,
and SwitchD are the same as that of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign IPv6 addresses to the VLANIF interfaces.
# Configure SwitchA. Ensure that the configurations of SwitchB, SwitchC, and
SwitchD are the same as that of SwitchA.
[SwitchA] ipv6
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ipv6 enable
[SwitchA-Vlanif10] ipv6 address fc00:0:0:1001::1/64
[SwitchA-Vlanif10] quit
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 453
Step 3 Configure the basic OSPFv3 functions.
# On SwitchA, enable OSPFv3 and set the router ID to 10.1.1.1.
[SwitchA] ospfv3
[SwitchA-ospfv3-1] router-id 10.1.1.1
[SwitchA-ospfv3-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ospfv3 1 area 0
[SwitchA-Vlanif10] quit
# On SwitchB, enable OSPFv3 and set the router ID to 10.2.2.2.
[SwitchB] ospfv3
[SwitchB-ospfv3-1] router-id 10.2.2.2
[SwitchB-ospfv3-1] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] ospfv3 1 area 0
[SwitchB-Vlanif10] quit
# On SwitchC, enable OSPFv3 and set the router ID to 10.3.3.3.
[SwitchC] ospfv3
[SwitchC-ospfv3-1] router-id 10.3.3.3
[SwitchC-ospfv3-1] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] ospfv3 1 area 0
[SwitchC-Vlanif10] quit
# On SwitchD, enable OSPFv3 and set the router ID to 10.4.4.4.
[SwitchD] ospfv3
[SwitchD-ospfv3-1] router-id 10.4.4.4
[SwitchD-ospfv3-1] quit
[SwitchD] interface vlanif 10
[SwitchD-Vlanif10] ospfv3 1 area 0
[SwitchD-Vlanif10] quit
Check the neighbor information of SwitchA. The command output shows that all
the neighbors have the same default priority 1 and that SwitchD functions as the
DR and SwitchC as the BDR.
NOTE
When two Switches have the same priority, the Switch that has a larger router ID is elected
as the DR. If the VLANIF interface of a Switch becomes the DR, the other broadcast
interfaces of this Switch have a high priority in the future DR election. This means that the
Switch still functions as the DR, and the DR cannot be preempted.
[SwitchA] display ospfv3 peer
OSPFv3 Process (1)
OSPFv3 Area (0.0.0.0)
Neighbor ID Pri State Dead Time Interface Instance ID
10.2.2.2 1 Full/DROther 00:00:32 Vlanif10 0
10.3.3.3 1 Full/Backup 00:00:36 Vlanif10 0
10.4.4.4 1 Full/DR 00:00:38 Vlanif10 0
# Check the neighbor information of SwitchD. The command output shows that
the status of the neighbor relationship between SwitchD and other devices is Full.
[SwitchD] display ospfv3 peer
OSPFv3 Process (1)
OSPFv3 Area (0.0.0.0)
Neighbor ID Pri State Dead Time Interface Instance ID
10.1.1.1 1 Full/DROther 00:00:32 Vlanif10 0
10.2.2.2 1 Full/DROther 00:00:35 Vlanif10 0
10.3.3.3 1 Full/Backup 00:00:30 Vlanif10 0
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 454
Step 4 Set DR priorities for interfaces.
# Set the DR priority of SwitchA to 100.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ospfv3 dr-priority 100
[SwitchA-Vlanif10] quit
# Set the DR priority of SwitchB to 0.
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] ospfv3 dr-priority 0
[SwitchB-Vlanif10] quit
# Set the DR priority of SwitchC to 2.
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] ospfv3 dr-priority 2
[SwitchC-Vlanif10] quit
# Check the neighbor information of SwitchA. The command output shows that
the DR priorities of SwitchA's neighbors have been updated but the DR and BDR
are unchanged.
[SwitchA] display ospfv3 peer
OSPFv3 Process (1)
OSPFv3 Area (0.0.0.0)
Neighbor ID Pri State Dead Time Interface Instance ID
10.2.2.2 0 Full/DROther 00:00:34 Vlanif10 0
10.3.3.3 2 Full/Backup 00:00:38 Vlanif10 0
10.4.4.4 1 Full/DR 00:00:31 Vlanif10 0
# Check the neighbor information of SwitchD. The command output shows that
the DR priorities of SwitchD's neighbors have been updated.
[SwitchD] display ospfv3 peer
OSPFv3 Process (1)
OSPFv3 Area (0.0.0.0)
Neighbor ID Pri State Dead Time Interface Instance ID
10.1.1.1 100 Full/DROther 00:00:36 Vlanif10 0
10.2.2.2 0 Full/DROther 00:00:30 Vlanif10 0
10.3.3.3 2 Full/Backup 00:00:36 Vlanif10 0
Step 5 Perform DR and BDR election again.
# Run the shutdown and undo shutdown commands on the VLANIF interface
that establishes the OSPFv3 neighbor relationship.
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] shutdown
[SwitchA-Vlanif10] undo shutdown
[SwitchA-Vlanif10] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] shutdown
[SwitchB-Vlanif10] undo shutdown
[SwitchB-Vlanif10] quit
[SwitchC] interface vlanif 10
[SwitchC-Vlanif10] shutdown
[SwitchC-Vlanif10] undo shutdown
[SwitchC-Vlanif10] quit
[SwitchD] interface vlanif 10
[SwitchD-Vlanif10] shutdown
[SwitchD-Vlanif10] undo shutdown
[SwitchD-Vlanif10] quit
Step 6 Verify the configuration.
# Check the neighbors of SwitchA. The command output shows that SwitchC is
now the BDR.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 455
[SwitchA] display ospfv3 peer
OSPFv3 Process (1)
OSPFv3 Area (0.0.0.0)
Neighbor ID Pri State Dead Time Interface Instance ID
10.2.2.2 0 Full/DROther 00:00:31 Vlanif10 0
10.3.3.3 2 Full/Backup 00:00:36 Vlanif10 0
10.4.4.4 1 Full/DROther 00:00:39 Vlanif10 0
# Check the neighbors of SwitchD. The command output shows that SwitchA is
now the DR.
[SwitchD] display ospfv3 peer
OSPFv3 Process (1)
OSPFv3 Area (0.0.0.0)
Neighbor ID Pri State Dead Time Interface Instance ID
10.1.1.1 100 Full/DR 00:00:39 Vlanif10 0
10.2.2.2 0 2-Way/DROther 00:00:35 Vlanif10 0
10.3.3.3 2 Full/Backup 00:00:39 Vlanif10 0
----End
Configuration Files
● Switch configuration file
#
sysname Switch
#
vlan batch 10
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/3
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/4
port link-type trunk
port trunk allow-pass vlan 10
#
return
● Switch configuration file
#
sysname SwitchA
#
ipv6
#
vlan batch 10
#
ospfv3 1
router-id 10.1.1.1
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1001::1/64
ospfv3 1 area 0.0.0.0
ospfv3 dr-priority 100
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 456
#
return
● SwitchB configuration file
#
sysname SwitchB
#
ipv6
#
vlan batch 10
#
ospfv3 1
router-id 10.2.2.2
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1001::2/64
ospfv3 1 area 0.0.0.0
ospfv3 dr-priority 0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchC configuration file
#
sysname SwitchC
#
ipv6
#
vlan batch 10
#
ospfv3 1
router-id 10.3.3.3
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1001::3/64
ospfv3 1 area 0.0.0.0
ospfv3 dr-priority 2
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchD configuration file
#
sysname SwitchD
#
ipv6
#
vlan batch 10
#
ospfv3 1
router-id 10.4.4.4
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1001::4/64
ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 457
6.21.3 Example for Configuring an OSPFv3 Virtual Link
Networking Requirements
In Figure 6-14, OSPFv3 is enabled on all Switches, and the AS is divided into three
areas. SwitchB and SwitchC serve as ABRs to forward inter-area routes. Area 2 is
not directly connected to the Area 0, the backbone area. Area 1 is the area
between Area 0 and Area 2.
Configure a virtual link in Area 1 where SwitchB and SwitchC are located so that
SwitchA and SwitchD can communicate with each other.
Figure 6-14 Networking diagram for configuring an OSPFv3 virtual link
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IPv6 addresses for interfaces.
2. Enable basic OSPFv3 functions on each switch.
3. Configure a virtual link between SwitchB and SwitchC to connect the non-
backbone areas to the backbone area.
Procedure
Step 1 Add interfaces to VLANs.
# Configure SwitchA. Ensure that the configurations of SwitchB, SwitchC, and
SwitchD are the same as that of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan batch 10
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign IPv6 addresses to the VLANIF interfaces.
# Configure SwitchA. Ensure that the configurations of SwitchB, SwitchC, and
SwitchD are the same as that of SwitchA.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 458
[SwitchA] ipv6
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ipv6 enable
[SwitchA-Vlanif10] ipv6 address fc00:0:0:1001::2/64
[SwitchA-Vlanif10] quit
Step 3 Configure basic OSPFv3 functions.
# On SwitchA, enable OSPFv3 and set the router ID to 10.1.1.1.
[SwitchA] ospfv3
[SwitchA-ospfv3-1] router-id 10.1.1.1
[SwitchA-ospfv3-1] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ospfv3 1 area 2
[SwitchA-Vlanif10] quit
# On SwitchB, enable OSPFv3 and set the router ID to 10.2.2.2.
[SwitchB] ospfv3
[SwitchB-ospfv3-1] router-id 10.2.2.2
[SwitchB-ospfv3-1] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] ospfv3 1 area 2
[SwitchB-Vlanif10] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] ospfv3 1 area 1
[SwitchB-Vlanif20] quit
# On SwitchC, enable OSPFv3 and set the router ID to 10.3.3.3.
[SwitchC] ospfv3
[SwitchC-ospfv3-1] router-id 10.3.3.3
[SwitchC-ospfv3-1] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] ospfv3 1 area 1
[SwitchC-Vlanif20] quit
[SwitchC] interface vlanif 30
[SwitchC-Vlanif30] ospfv3 1 area 0
[SwitchC-Vlanif30] quit
# On SwitchD, enable OSPFv3 and set the router ID to 10.4.4.4.
[SwitchD] ospfv3
[SwitchD-ospfv3-1] router-id 10.4.4.4
[SwitchD-ospfv3-1] quit
[SwitchD] interface vlanif 30
[SwitchD-Vlanif30] ospfv3 1 area 0
[SwitchD-Vlanif30] quit
# Check the OSPFv3 routing table of SwitchC. The command output shows that
the routing table of SwitchC does not contain the routes of Area 2. This is because
Area 2 is not directly connected to Area 0.
[SwitchC] display ospfv3 routing
Codes : E2 - Type 2 External, E1 - Type 1 External, IA - Inter-Area,
N - NSSA, U - Uninstalled, D - Denied by Import Policy
OSPFv3 Process (1)
Destination Metric
Next-hop
FC00:0:0:1000::/64 1
directly connected, Vlanif20
FC00:0:0:1002::/64 1
directly connected, Vlanif30
Step 4 Configure a virtual link in Area 1 where SwitchB and SwitchC are located.
# Configure SwitchB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 459
[SwitchB] ospfv3
[SwitchB-ospfv3-1] area 1
[SwitchB-ospfv3-1-area-0.0.0.1] vlink-peer 10.3.3.3
[SwitchB-ospfv3-1-area-0.0.0.1] return
# Configure SwitchC.
[SwitchC] ospfv3
[SwitchC-ospfv3-1] area 1
[SwitchC-ospfv3-1-area-0.0.0.1] vlink-peer 10.2.2.2
[SwitchC-ospfv3-1-area-0.0.0.1] return
Step 5 Verify the configuration.
# Check the OSPFv3 routing table of SwitchC.
<SwitchC> display ospfv3 routing
Codes : E2 - Type 2 External, E1 - Type 1 External, IA - Inter-Area,
N - NSSA, U - Uninstalled, D - Denied by Import Policy
OSPFv3 Process (1)
Destination Metric
Next-hop
FC00:0:0:1000::/64 1
directly connected, Vlanif20
FC00:0:0:1000::1/128 1
via FE80::4D67:0:EB7D:2, Vlanif20
FC00:0:0:1000::2/128 0
directly connected, Vlanif20
IA FC00:0:0:1001::/64 2
via FE80::4D67:0:EB7D:2, Vlanif20
FC00:0:0:1002::/64 1
directly connected, Vlanif30
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
vlan batch 10
#
ospfv3 1
router-id 10.1.1.1
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1001::2/64
ospfv3 1 area 0.0.0.2
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchB configuration file
#
sysname SwitchB
#
ipv6
#
vlan batch 10 20
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 460
#
ospfv3 1
router-id 10.2.2.2
area 0.0.0.1
vlink-peer 10.3.3.3
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1001::1/64
ospfv3 1 area 0.0.0.2
#
interface Vlanif20
ipv6 enable
ipv6 address FC00:0:0:1000::1/64
ospfv3 1 area 0.0.0.1
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchC configuration file
#
sysname SwitchC
#
ipv6
#
vlan batch 20 30
#
ospfv3 1
router-id 10.3.3.3
area 0.0.0.1
vlink-peer 10.2.2.2
#
interface Vlanif20
ipv6 enable
ipv6 address FC00:0:0:1000::2/64
ospfv3 1 area 0.0.0.1
#
interface Vlanif30
ipv6 enable
ipv6 address FC00:0:0:1002::1/64
ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchD configuration file
#
sysname SwitchD
#
ipv6
#
vlan batch 30
#
ospfv3 1
router-id 10.4.4.4
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 461
interface Vlanif30
ipv6 enable
ipv6 address FC00:0:0:1002::2/64
ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 30
#
return
6.21.4 Example for Configuring OSPFv3 GR
Networking Requirements
In Figure 6-15, SwitchA, SwitchB, and SwitchC belong to the same OSPFv3 area.
They communicate with each other through the OSPFv3 protocol and are enabled
with GR.
When OSPFv3 adjacencies are set up between SwitchA, SwitchC, and SwitchB, the
three switches exchange routing information. If the OSPFv3 protocol restarts on
SwitchA, SwitchA synchronizes data with neighboring switches through GR.
Figure 6-15 Networking diagram for configuring OSPFv3 GR
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure IPv6 addresses for interfaces.
2. Enable basic OSPFv3 functions on each switch.
3. Enable the OSPFv3 GR helper in the OSPFv3 view of SwitchB.
4. Enable the OSPFv3 GR in the OSPFv3 view of SwitchA.
Procedure
Step 1 Add interfaces to VLANs.
# Configure SwitchA. Ensure that the configurations of SwitchB and SwitchC are
the same as that of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] vlan 10
[SwitchA-vlan10] quit
[SwitchA] interface gigabitethernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] port link-type trunk
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 462
[SwitchA-GigabitEthernet0/0/1] port trunk allow-pass vlan 10
[SwitchA-GigabitEthernet0/0/1] quit
Step 2 Assign IPv6 addresses to the VLANIF interfaces.
# Configure SwitchA. Ensure that the configurations of SwitchB and SwitchC are
the same as that of SwitchA.
[SwitchA] ipv6
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ipv6 enable
[SwitchA-Vlanif10] ipv6 address fc00:0:0:1000::1/64
[SwitchA-Vlanif10] quit
Step 3 Configure basic OSPFv3 functions.
# On SwitchA, enable OSPFv3 and set the router ID to 10.1.1.1.
[SwitchA] ospfv3 100
[SwitchA-ospfv3-100] router-id 10.1.1.1
[SwitchA-ospfv3-100] quit
[SwitchA] interface vlanif 10
[SwitchA-Vlanif10] ospfv3 100 area 0
[SwitchA-Vlanif10] quit
# On SwitchB, enable OSPFv3 and set the router ID to 10.2.2.2.
[SwitchB] ospfv3 100
[SwitchB-ospfv3-100] router-id 10.2.2.2
[SwitchB-ospfv3-100] quit
[SwitchB] interface vlanif 10
[SwitchB-Vlanif10] ospfv3 100 area 0
[SwitchB-Vlanif10] quit
[SwitchB] interface vlanif 20
[SwitchB-Vlanif20] ospfv3 100 area 0
[SwitchB-Vlanif20] quit
# On SwitchC, enable OSPFv3 and set the router ID to 10.3.3.3.
[SwitchC] ospfv3 100
[SwitchC-ospfv3-100] router-id 10.3.3.3
[SwitchC-ospfv3-100] quit
[SwitchC] interface vlanif 20
[SwitchC-Vlanif20] ospfv3 100 area 0
[SwitchC-Vlanif20] quit
Step 4 Enable OSPFv3 GR on SwitchA.
[SwitchA] ospfv3 100
[SwitchA-ospfv3-100] graceful-restart
[SwitchA-ospfv3-100] return
Step 5 Enable OSPFv3 helper on SwitchB.
[SwitchB] ospfv3 100
[SwitchB-ospfv3-100] helper-role
[SwitchB-ospfv3-100] return
Step 6 Verify the configuration.
# Run the display ipv6 fib command on SwitchA to view the FIB information.
<SwitchA> display ipv6 fib
IPv6 FIB Table:
Total number of Routes : 5
Destination: ::1 PrefixLength: 128
Nexthop : ::1 Flag : HU
Interface : InLoopBack0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 463
Destination: FE80:: PrefixLength: 10
Nexthop : :: Flag : BU
Interface : NULL0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FC00:0:0:1000::1 PrefixLength: 128
Nexthop : ::1 Flag : HU
Interface : InLoopBack0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FC00:0:0:1000:: PrefixLength: 64
Nexthop : FC00:0:0:1000::1 Flag : U
Interface : Vlanif10 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FC00:0:0:2000:: PrefixLength: 64
Nexthop : FE80::200:1FF:FE00:200 Flag : DGU
Interface : Vlanif10 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
# Restart OSPFv3 process 100 on SwitchA without using the GR mechanism.
<SwitchA> reset ospfv3 100
# Immediately run the display ipv6 fib command on SwitchA to view the FIB
information.
<SwitchA> display ipv6 fib
IPv6 FIB Table:
Total number of Routes : 4
Destination: ::1 PrefixLength: 128
Nexthop : ::1 Flag : HU
Interface : InLoopBack0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FE80:: PrefixLength: 10
Nexthop : :: Flag : BU
Interface : NULL0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FC00:0:0:1000::1 PrefixLength: 128
Nexthop : ::1 Flag : HU
Interface : InLoopBack0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FC00:0:0:1000:: PrefixLength: 64
Nexthop : FC00:0:0:1000::1 Flag : U
Interface : Vlanif10 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
This information shows that the FIB information on SwitchA has been modified
and the forwarding service is affected.
# Restart OSPFv3 process 100 on SwitchA using the GR mechanism.
<SwitchA> reset ospfv3 100 graceful-restart
# Immediately run the display ipv6 fib command on SwitchA to view the FIB
information. Check whether GR is functioning normally. If so, the FIB information
is not modified and the forwarding is not affected when you restart the OSPFv3
process using GR on SwitchA.
<SwitchA> display ipv6 fib
IPv6 FIB Table:
Total number of Routes : 5
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 464
Destination: ::1 PrefixLength: 128
Nexthop : ::1 Flag : HU
Interface : InLoopBack0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FE80:: PrefixLength: 10
Nexthop : :: Flag : BU
Interface : NULL0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FC00:0:0:1000::1 PrefixLength: 128
Nexthop : ::1 Flag : HU
Interface : InLoopBack0 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FC00:0:0:1000:: PrefixLength: 64
Nexthop : FC00:0:0:1000::1 Flag : U
Interface : Vlanif10 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
Destination: FC00:0:0:2000:: PrefixLength: 64
Nexthop : FE80::200:1FF:FE00:200 Flag : DGU
Interface : Vlanif10 Tunnel ID : 0x0
TimeStamp : 2007-06-25 17:31:46
This information shows that the FIB information on SwitchA has not been
modified and the forwarding is not affected.
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
vlan batch 10
#
ospfv3 100
router-id 10.1.1.1
graceful-restart
#
interface Vlanif10
ipv6 enable
ipv6 address FC00:0:0:1000::1/64
ospfv3 100 area 0.0.0.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
return
● SwitchB configuration file
#
sysname SwitchB
#
ipv6
#
vlan batch 10 20
#
ospfv3 100
router-id 10.2.2.2
helper-role
#
interface Vlanif10
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 465
ipv6 enable
ipv6 address FC00:0:0:1000::2/64
ospfv3 100 area 0.0.0.0
#
interface Vlanif20
ipv6 enable
ipv6 address FC00:0:0:2000::1/64
ospfv3 100 area 0.0.0.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 10
#
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 20
#
return
● SwitchC configuration file
#
sysname SwitchC
#
ipv6
#
vlan batch 20
#
ospfv3 100
router-id 10.3.3.3
#
interface Vlanif20
ipv6 enable
ipv6 address FC00:0:0:2000::2/64
ospfv3 100 area 0.0.0.0
#
interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 20
#
return
6.21.5 Example for Configuring BFD for OSPFv3
Networking Requirements
In Figure 6-16, OSPFv3 is run among SwitchA, SwitchB, and SwitchC. Service
traffic is forwarded along the primary link SwitchA→SwitchB. The link
SwitchA→SwitchC→SwitchB is used as a backup. Customers require that service
traffic be fast switched to the backup link if the primary link fails.
NOTE
In this scenario, ensure that all connected interfaces have STP disabled. If STP is enabled
and VLANIF interfaces of switches are used to construct a Layer 3 ring network, an
interface on the network will be blocked. As a result, Layer 3 services on the network
cannot run normally.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 466
Figure 6-16 Networking diagram for configuring BFD for OSPFv3
Configuration Roadmap
The configuration roadmap is as follows:
1. Configure basic OSPFv3 functions on each switch to make the primary link
transmit service traffic properly.
2. Configure OSPFv3 BFD so that traffic can be fast switched to the backup link
if the primary link fails.
Procedure
Step 1 Configure IPv6 addresses for interfaces of all switches.
# Configure SwitchA. Ensure that the configurations of SwitchB and SwitchC are
the same as that of SwitchA.
<HUAWEI> system-view
[HUAWEI] sysname SwitchA
[SwitchA] ipv6
[SwitchA] interface GigabitEthernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] undo portswitch
[SwitchA-GigabitEthernet0/0/1] ipv6 enable
[SwitchA-GigabitEthernet0/0/1] ipv6 address FC00:3::1 64
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface GigabitEthernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] undo portswitch
[SwitchA-GigabitEthernet0/0/2] ipv6 enable
[SwitchA-GigabitEthernet0/0/2] ipv6 address FC00:1::1 64
[SwitchA-GigabitEthernet0/0/2] quit
Step 2 Configure basic OSPFv3 functions.
# Configure SwitchA.
[SwitchA] ospfv3
[SwitchA-ospfv3-1] router-id 10.1.1.1
[SwitchA-ospfv3-1] quit
[SwitchA] interface GigabitEthernet 0/0/1
[SwitchA-GigabitEthernet0/0/1] ospfv3 1 area 0.0.0.0
[SwitchA-GigabitEthernet0/0/1] quit
[SwitchA] interface GigabitEthernet 0/0/2
[SwitchA-GigabitEthernet0/0/2] ospfv3 1 area 0.0.0.0
[SwitchA-GigabitEthernet0/0/2] quit
# Configure SwitchB.
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 467
[SwitchB] ospfv3
[SwitchB-ospfv3-1] router-id 10.2.2.2
[SwitchB-ospfv3-1] quit
[SwitchB] interface GigabitEthernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] ospfv3 1 area 0.0.0.0
[SwitchB-GigabitEthernet0/0/1] quit
[SwitchB] interface GigabitEthernet 0/0/2
[SwitchB-GigabitEthernet0/0/2] ospfv3 1 area 0.0.0.0
[SwitchB-GigabitEthernet0/0/2] quit
[SwitchB] interface GigabitEthernet 0/0/3
[SwitchB-GigabitEthernet0/0/3] ospfv3 1 area 0.0.0.0
[SwitchB-GigabitEthernet0/0/3] quit
# Configure SwitchC.
[SwitchC] ospfv3
[SwitchC-ospfv3-1] router-id 10.3.3.3
[SwitchC-ospfv3-1] quit
[SwitchC] interface GigabitEthernet 0/0/1
[SwitchC-GigabitEthernet0/0/1] ospfv3 1 area 0.0.0.0
[SwitchC-GigabitEthernet0/0/1] quit
[SwitchC] interface GigabitEthernet 0/0/2
[SwitchC-GigabitEthernet0/0/2] ospfv3 1 area 0.0.0.0
[SwitchC-GigabitEthernet0/0/2] quit
# After the preceding configurations are complete, run the display ospfv3 peer
command. The following example uses the command output on SwitchA. The
command output shows that neighbor relationships are established between
SwitchA and SwitchB, and between SwitchB and SwitchC.
[SwitchA] display ospfv3 peer verbose
OSPFv3 Process (1)
Neighbor 10.3.3.3 is Full, interface address FE80::225:9EFF:FEFB:BFF1
In the area 0.0.0.0 via interface GE0/0/2
DR Priority is 1 DR is 10.1.1.1 BDR is 10.3.3.3
Options is 0x000013 (-|-|-|-|-|-|R|-|-|E|V6)
Dead timer due in 00:00:31
Neighbour is up for 00:13:24
Database Summary Packets List 0
Link State Request List 0
Link State Retransmission List 0
Neighbour Event: 5
Neighbour If Id : 0xd0
Neighbor 10.2.2.2 is Full, interface address FE80::201:FF:FE01:1
In the area 0.0.0.0 via interface GE0/0/1
DR Priority is 1 DR is 10.1.1.1 BDR is 10.2.2.2
Options is 0x000013 (-|-|-|-|-|-|R|-|-|E|V6)
Dead timer due in 00:00:38
Neighbour is up for 00:13:38
Database Summary Packets List 0
Link State Request List 0
Link State Retransmission List 0
Neighbour Event: 5
Neighbour If Id : 0x28
# Check information about the OSPFv3 routing table on SwitchA. The command
output shows the routing entries to SwitchB and SwitchC.
[SwitchA] display ospfv3 routing
Codes : E2 - Type 2 External, E1 - Type 1 External, IA - Inter-Area,
N - NSSA, U - Uninstalled, D - Denied by Import Policy
OSPFv3 Process (1)
Destination Metric
Next-hop
FC00:1::/64 1
directly connected, GigabitEthernet0/0/2
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 468
FC00:2::/64 2
via FE80::225:9EFF:FEFB:BFF1, GigabitEthernet0/0/2
via FE80::201:FF:FE01:1, GigabitEthernet0/0/1
FC00:3::/64 1
directly connected, GigabitEthernet0/0/1
FC00:4::/64 2
via FE80::201:FF:FE01:1, GigabitEthernet0/0/1
In the OSPFv3 routing table, the next hop of the route to FC00:4::1/64 is GE0/0/1,
and traffic is transmitted along the primary link SwitchA→SwitchB.
Step 3 Configure OSPFv3 BFD.
# Configure BFD for OSPFv3 on SwitchA.
[SwitchA] bfd
[SwitchA-bfd] quit
[SwitchA] ospfv3
[SwitchA-ospfv3-1] bfd all-interfaces enable
[SwitchA-ospfv3-1] bfd all-interfaces min-transmit-interval 100 min-receive-interval 100 detect-
multiplier 4
[SwitchA-ospfv3-1] quit
# Configure BFD for OSPFv3 on SwitchB.
[SwitchB] bfd
[SwitchB-bfd] quit
[SwitchB] ospfv3
[SwitchB-ospfv3-1] bfd all-interfaces enable
[SwitchB-ospfv3-1] bfd all-interfaces min-transmit-interval 100 min-receive-interval 100 detect-
multiplier 4
[SwitchB-ospfv3-1] quit
# Configure BFD for OSPFv3 on SwitchC.
[SwitchC] bfd
[SwitchC-bfd] quit
[SwitchC] ospfv3
[SwitchC-ospfv3-1] bfd all-interfaces enable
[SwitchC-ospfv3-1] bfd all-interfaces min-transmit-interval 100 min-receive-interval 100 detect-
multiplier 4
[SwitchC-ospfv3-1] quit
After the preceding configurations are complete, run the display ospfv3 bfd
session command on SwitchA or SwitchB.
The following example uses the command output on SwitchB as an example. The
command output shows that the status of the BFD session is Up.
[SwitchB] display ospfv3 bfd session verbose
* - STALE
OSPFv3 Process (1)
Neighbor-Id: 10.3.3.3
BFD Status: Up
Interface: GE0/0/2
IPv6-Local-Address: FE80::201:FF:FE01:1
IPv6-Remote-Address: FE80::225:9EFF:FEFB:BFF1
BFD Module preferred timer values
Transmit-Interval(ms): 100
Receive-Interval(ms): 100
Detect-Multiplier: 4
OSPFv3 Module preferred timer values
Transmit-Interval(ms): 100
Receive-Interval(ms): 100
Detect-Multiplier: 4
Configured timer values
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 469
Transmit-Interval(ms): 100
Receive-Interval(ms): 100
Detect-Multiplier: 4
Neighbor-Id: 10.1.1.1
BFD Status: Up
Interface: GE0/0/1
IPv6-Local-Address: FE80::201:FF:FE01:1
IPv6-Remote-Address: FE80::200:13FF:FE82:4569
BFD Module preferred timer values
Transmit-Interval(ms): 100
Receive-Interval(ms): 100
Detect-Multiplier: 4
OSPFv3 Module preferred timer values
Transmit-Interval(ms): 100
Receive-Interval(ms): 100
Detect-Multiplier: 4
Configured timer values
Transmit-Interval(ms): 100
Receive-Interval(ms): 100
Detect-Multiplier: 4
Step 4 Verify the configuration.
# Run the shutdown command on GE0/0/1 of SwitchB to simulate a primary link
fault.
[SwitchB] interface GigabitEthernet 0/0/1
[SwitchB-GigabitEthernet0/0/1] shutdown
# Check the routing table on SwitchA. In the routing table, the backup link
SwitchA-SwitchC-SwitchB transmits traffic after the primary link fails, and the next
hop of the route to FC00:4::1/64 becomes GE0/0/2.
[SwitchA] display ospfv3 routing
Codes : E2 - Type 2 External, E1 - Type 1 External, IA - Inter-Area,
N - NSSA, U - Uninstalled, D - Denied by Import Policy
OSPFv3 Process (1)
Destination Metric
Next-hop
FC00:1::/64 1
directly connected, GigabitEthernet0/0/2
FC00:2::/64 2
via FE80::225:9EFF:FEFB:BFF1, GigabitEthernet0/0/2
FC00:4::/64 3
via FE80::225:9EFF:FEFB:BFF1, GigabitEthernet0/0/2
----End
Configuration Files
● SwitchA configuration file
#
sysname SwitchA
#
ipv6
#
bfd
#
ospfv3 1
router-id 10.1.1.1
bfd all-interfaces enable
bfd all-interfaces min-transmit-interval 100 min-receive-interval 100 detect-multiplier 4
#
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 470
interface GigabitEthernet0/0/1
undo portswitch
ipv6 enable
ipv6 address FC00:3::1/64
ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet0/0/2
undo portswitch
ipv6 enable
ipv6 address FC00:1::1/64
ospfv3 1 area 0.0.0.0
#
return
● SwitchB configuration file
#
sysname SwitchB
#
ipv6
#
bfd
#
ospfv3 1
router-id 10.2.2.2
bfd all-interfaces enable
bfd all-interfaces min-transmit-interval 100 min-receive-interval 100 detect-multiplier 4
#
interface GigabitEthernet0/0/1
undo portswitch
ipv6 enable
ipv6 address FC00:3::2/64
ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet0/0/2
undo portswitch
ipv6 enable
ipv6 address FC00:2::2/64
ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet0/0/3
undo portswitch
ipv6 enable
ipv6 address FC00:4::1/64
ospfv3 1 area 0.0.0.0
#
return
● SwitchC configuration file
#
sysname SwitchC
#
ipv6
#
bfd
#
ospfv3 1
router-id 10.3.3.3
bfd all-interfaces enable
bfd all-interfaces min-transmit-interval 100 min-receive-interval 100 detect-multiplier 4
#
interface GigabitEthernet0/0/1
undo portswitch
ipv6 enable
ipv6 address FC00:2::1/64
ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet0/0/2
undo portswitch
ipv6 enable
ipv6 address FC00:1::2/64
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 471
ospfv3 1 area 0.0.0.0
#
return
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing 6 OSPFv3 Configuration
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. 472