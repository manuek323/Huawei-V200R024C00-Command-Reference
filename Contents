Contents
About This Document................................................................................................................ ii
1 IP Routing.................................................................................................................................. 1
1.1 Overview of IP Routing......................................................................................................................................................... 1
1.2 Understanding IP Routing.................................................................................................................................................... 2
1.2.1 Routers and Routing........................................................................................................................................................... 2
1.2.2 Static Routes and Dynamic Routes................................................................................................................................2
1.2.3 Routing Table and FIB Table............................................................................................................................................ 3
1.2.4 Route Recursion....................................................................................................................................................................6
1.2.5 Routing Protocol Preference.............................................................................................................................................6
1.2.6 Route Metric.......................................................................................................................................................................... 8
1.2.7 Load Balancing and Route Backup................................................................................................................................ 9
1.2.8 IP FRR.................................................................................................................................................................................... 10
1.2.9 Route Convergence........................................................................................................................................................... 12
1.2.10 Default Routes................................................................................................................................................................. 14
1.2.11 Route Importing.............................................................................................................................................................. 14
1.2.12 Autonomous System...................................................................................................................................................... 14
1.2.13 Router ID............................................................................................................................................................................ 15
2 Static Route Configuration................................................................................................. 16
2.1 Overview of Static Routes..................................................................................................................................................16
2.2 Understanding Static Routes............................................................................................................................................ 17
2.2.1 Static Route Basics............................................................................................................................................................ 17
2.2.2 BFD for Static Routes....................................................................................................................................................... 18
2.2.3 NQA for Static Routes......................................................................................................................................................19
2.2.4 Permanent Advertisement of Static Routes............................................................................................................. 20
2.3 Application Scenarios for Static Routes........................................................................................................................ 22
2.3.1 Load Balancing and Route Backup..............................................................................................................................22
2.3.2 Default Static Routes....................................................................................................................................................... 23
2.4 Summary of Static Route Configuration Tasks........................................................................................................... 24
2.5 Default Settings for Static Routes................................................................................................................................... 25
2.6 Configuring IPv4 Static Routes......................................................................................................................................... 25
2.6.1 Creating IPv4 Static Routes............................................................................................................................................ 25
2.6.2 (Optional) Setting the Default Preference Value for IPv4 Static Routes....................................................... 26
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. vi
2.6.3 (Optional) Configuring Permanent Advertisement of IPv4 Static Routes.....................................................27
2.6.4 (Optional) Preventing a Static Route from Being Selected If the Associated BFD Session Is in
AdminDown State........................................................................................................................................................................ 27
2.6.5 (Optional) Preventing Static Routes from Being Recursed to a Blackhole Route...................................... 28
2.6.6 Verifying the IPv4 Static Route Configuration.........................................................................................................29
2.7 Configuring Static BFD for IPv4 Static Routes............................................................................................................ 29
2.8 Configuring NQA for IPv4 Static Routes....................................................................................................................... 30
2.9 Configuring EFM for IPv4 Static Routes........................................................................................................................ 32
2.10 Configuring Association Between IPv4 Static Routes and a Route Monitoring Group.............................. 33
2.11 Configuring IPv6 Static Routes...................................................................................................................................... 34
2.11.1 Creating IPv6 Static Routes......................................................................................................................................... 35
2.11.2 (Optional) Setting the Default Preference Value for IPv6 Static Routes.....................................................36
2.11.3 Verifying the IPv6 Static Route Configuration...................................................................................................... 36
2.12 Configuring Static BFD for IPv6 Static Routes..........................................................................................................36
2.13 Configuring NQA for IPv6 Static Routes.................................................................................................................... 38
2.14 Configuration Examples for Static Routes................................................................................................................. 39
2.14.1 Example for Configuring IPv4 Static Routes.......................................................................................................... 39
2.14.2 Example for Configuring IPv6 Static Routes.......................................................................................................... 43
2.14.3 Example for Configuring Static BFD for IPv4 Static Routes............................................................................. 47
2.14.4 Example for Configuring Static BFD for IPv6 Static Routes............................................................................. 51
2.14.5 Example for Configuring NQA for IPv4 Static Routes........................................................................................ 54
2.14.6 Example for Configuring NQA for IPv6 Static Routes........................................................................................ 58
2.14.7 Example for Configuring EFM for Static IPv4 Routes......................................................................................... 64
2.14.8 Example for Configuring Association Between IPv4 Static Routes and a Route Monitoring Group
............................................................................................................................................................................................................ 67
3 RIP Configuration.................................................................................................................. 74
3.1 Overview of RIP..................................................................................................................................................................... 74
3.2 Understanding RIP................................................................................................................................................................ 75
3.2.1 RIP Fundamentals............................................................................................................................................................. 75
3.2.2 RIP-2 Enhanced Features................................................................................................................................................ 78
3.2.3 Split Horizon and Poison Reverse................................................................................................................................ 80
3.2.4 Multi-Process and Multi-Instance................................................................................................................................ 81
3.2.5 BFD for RIP.......................................................................................................................................................................... 82
3.2.6 Hot Standby........................................................................................................................................................................ 83
3.3 Summary of RIP Configuration Tasks............................................................................................................................ 83
3.4 Licensing Requirements and Limitations for RIP....................................................................................................... 87
3.5 Default Settings for RIP...................................................................................................................................................... 88
3.6 Configuring Basic RIP Functions...................................................................................................................................... 88
3.6.1 Enabling RIP........................................................................................................................................................................ 89
3.6.2 Enabling RIP on the Specified Network Segment.................................................................................................. 89
3.6.3 (Optional) Configuring RIP Neighbors on an NBMA Network......................................................................... 90
3.6.4 (Optional) Configuring the RIP Version.....................................................................................................................90
3.6.5 Verifying the Basic RIP Function Configuration...................................................................................................... 91
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. vii
3.7 Configuring RIP-2.................................................................................................................................................................. 92
3.7.1 Configuring RIP-2 Route Summarization.................................................................................................................. 92
3.7.2 Configuring RIP-2 Packet Authentication..................................................................................................................93
3.7.3 Verifying the RIP-2 Configuration................................................................................................................................ 94
3.8 Preventing Routing Loops.................................................................................................................................................. 95
3.8.1 Configuring Split Horizon............................................................................................................................................... 95
3.8.2 Configuring Poison Reverse........................................................................................................................................... 96
3.8.3 Verifying the RIP Routing Loop Prevention Configuration..................................................................................96
3.9 Controlling RIP Routing...................................................................................................................................................... 96
3.9.1 Configuring RIP Preference............................................................................................................................................ 97
3.9.2 Configuring Additional Metrics of an Interface...................................................................................................... 97
3.9.3 Setting the Maximum Number of Equal-Cost Routes.......................................................................................... 98
3.9.4 Verifying the RIP Routing Control Configuration................................................................................................... 99
3.10 Controlling RIP Route Advertisement.......................................................................................................................... 99
3.10.1 Configuring RIP to Advertise Default Routes........................................................................................................ 99
3.10.2 Disabling an Interface from Sending Update Packets..................................................................................... 100
3.10.3 Configuring RIP to Import Routes...........................................................................................................................101
3.10.4 Verifying the RIP Route Advertisement Control Configuration.................................................................... 102
3.11 Controlling Receiving of RIP Routing Information............................................................................................... 102
3.11.1 Disabling an Interface from Receiving RIP Update Packets.......................................................................... 102
3.11.2 Configuring RIP to Deny Host Routes................................................................................................................... 103
3.11.3 Configuring RIP to Filter Received Routes........................................................................................................... 103
3.11.4 Verifying the RIP Route Receiving Control Configuration.............................................................................. 104
3.12 Improving RIP Network Performance....................................................................................................................... 104
3.12.1 Configuring RIP Timers............................................................................................................................................... 105
3.12.2 Setting the Interval for Sending Update Packets and Maximum Number of Sent Packets............... 106
3.12.3 Enabling the Replay Protection Function............................................................................................................. 106
3.12.4 Configuring RIP to Check the Validity of Update Packets..............................................................................107
3.12.5 Verifying the RIP Network Performance Optimization Configuration....................................................... 108
3.13 Configuring BFD for RIP.................................................................................................................................................108
3.13.1 Configuring Dynamic BFD for RIP.......................................................................................................................... 109
3.13.2 Configuring Static BFD for RIP................................................................................................................................. 111
3.14 Configuring the Network Management Function for RIP..................................................................................113
3.15 Maintaining RIP................................................................................................................................................................ 114
3.15.1 Resetting RIP.................................................................................................................................................................. 114
3.15.2 Clearing RIP Statistics..................................................................................................................................................114
3.16 Configuration Examples for RIP.................................................................................................................................. 114
3.16.1 Example for Configuring Basic RIP Functions..................................................................................................... 115
3.16.2 Example for Configuring RIP to Import Routes..................................................................................................118
3.16.3 Example for Configuring One-Arm Static BFD for RIP.................................................................................... 123
3.16.4 Example for Configuring Dynamic BFD for RIP................................................................................................. 128
3.17 Troubleshooting RIP........................................................................................................................................................ 133
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. viii
3.17.1 Failed to Receive RIP Update Packets from Neighbors................................................................................... 133
3.17.2 Failed to Send RIP Update Packets to Neighbors..............................................................................................133
3.17.3 Route Flapping Occurs on a RIP Network........................................................................................................... 134
4 RIPng Configuration........................................................................................................... 135
4.1 Overview of RIPng............................................................................................................................................................. 135
4.2 Understanding RIPng........................................................................................................................................................ 136
4.2.1 RIPng................................................................................................................................................................................... 136
4.3 Summary of RIPng Configuration Tasks..................................................................................................................... 136
4.4 Licensing Requirements and Limitations for RIPng................................................................................................ 138
4.5 Default Settings for RIPng............................................................................................................................................... 139
4.6 Configuring Basic RIPng Functions............................................................................................................................... 139
4.6.1 Enabling RIPng................................................................................................................................................................. 139
4.6.2 Enabling RIPng on Interfaces...................................................................................................................................... 140
4.6.3 Verifying the Basic RIPng Function Configuration...............................................................................................141
4.7 Preventing Routing Loops............................................................................................................................................... 141
4.7.1 Configuring Split Horizon.............................................................................................................................................141
4.7.2 Configuring Poison Reverse......................................................................................................................................... 142
4.7.3 Verifying the RIPng Routing Loop Prevention Configuration.......................................................................... 143
4.8 Controlling RIPng Routing............................................................................................................................................... 143
4.8.1 Configuring RIPng Preference..................................................................................................................................... 143
4.8.2 Configuring Additional Metrics of an Interface....................................................................................................143
4.8.3 Setting the Maximum Number of Equal-Cost Routes....................................................................................... 144
4.8.4 Verifying the RIPng Routing Control Configuration............................................................................................145
4.9 Controlling RIPng Route Advertisement..................................................................................................................... 145
4.9.1 Configuring RIPng Route Summarization...............................................................................................................145
4.9.2 Advertising a Default Route........................................................................................................................................ 146
4.9.3 Configuring a RIPng Process to Import External Routes................................................................................... 147
4.9.4 Disabling Sending of RIPng Packets on an Interface..........................................................................................148
4.9.5 Disabling Receiving of RIPng Packets on an Interface.......................................................................................148
4.9.6 Verifying the RIPng Route Advertisement Control Configuration..................................................................149
4.10 Controlling the Receiving of RIPng Routes............................................................................................................. 149
4.11 Improving RIPng Network Performance.................................................................................................................. 150
4.11.1 Configuring RIPng Timers.......................................................................................................................................... 150
4.11.2 Setting the Interval for Sending Update Packets and Maximum Number of Sent Packets............... 151
4.11.3 Enabling Zero Field Check for RIPng Packets..................................................................................................... 152
4.11.4 Verifying the RIPng Network Performance Optimization Configuration.................................................. 152
4.12 Configuring IPSec Authentication for RIPng........................................................................................................... 153
4.12.1 Configuring an IPSec Session for Encryption...................................................................................................... 153
4.12.2 Configuring RIPng IPSec Authentication.............................................................................................................. 156
4.12.3 Verifying the RIPng IPSec Authentication Configuration................................................................................ 157
4.13 Clearing RIPng................................................................................................................................................................... 157
4.14 Example for Configuring RIPng to Filter the Received Routes......................................................................... 158
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. ix
5 OSPF Configuration............................................................................................................ 163
5.1 Overview of OSPF.............................................................................................................................................................. 164
5.2 Understanding OSPF......................................................................................................................................................... 165
5.2.1 OSPF Fundamentals....................................................................................................................................................... 165
5.2.1.1 OSPF Characteristics................................................................................................................................................... 165
5.2.1.2 OSPF Mechanism......................................................................................................................................................... 166
5.2.1.3 OSPF Packet Types...................................................................................................................................................... 170
5.2.1.4 OSPF Network Types.................................................................................................................................................. 171
5.2.1.5 DR/BDR Election.......................................................................................................................................................... 172
5.2.1.6 OSPF State Machine................................................................................................................................................... 181
5.2.1.7 OSPF Adjacency Establishment...............................................................................................................................185
5.2.1.8 OSPF Areas.....................................................................................................................................................................190
5.2.1.9 OSPF LSA Types............................................................................................................................................................ 200
5.2.1.10 OSPF Fast Convergence.......................................................................................................................................... 207
5.2.1.11 OSPF Virtual Link...................................................................................................................................................... 209
5.2.1.12 OSPF Route Summarization and Filtering........................................................................................................210
5.2.1.13 OSPF Multi-Process.................................................................................................................................................. 211
5.2.1.14 OSPF RFC 1583 Compatibility............................................................................................................................... 211
5.2.2 Enhanced OSPF Functions........................................................................................................................................... 212
5.2.2.1 OSPF VPN....................................................................................................................................................................... 212
5.2.2.2 OSPF TE...........................................................................................................................................................................218
5.2.2.3 OSPF Security................................................................................................................................................................ 220
5.2.2.4 OSPF GR.......................................................................................................................................................................... 221
5.2.2.5 OSPF Neighbor Relationship Flapping Suppression........................................................................................ 225
5.2.2.6 OSPF Smart-Discover................................................................................................................................................. 232
5.2.2.7 OSPF Database Overflow......................................................................................................................................... 232
5.2.2.8 OSPF Mesh-Group....................................................................................................................................................... 234
5.2.3 Association Between OSPF and Other Protocols................................................................................................. 235
5.3 Application Scenarios for OSPF..................................................................................................................................... 239
5.3.1 OSPF GR............................................................................................................................................................................. 239
5.3.2 OSPF GTSM....................................................................................................................................................................... 239
5.4 OSPF Deployment Guide................................................................................................................................................. 240
5.4.1 OSPF Network Planning and Design........................................................................................................................240
5.4.2 OSPF Network Design Deployment Case............................................................................................................... 243
5.5 Summary of OSPF Configuration Tasks...................................................................................................................... 256
5.6 Licensing Requirements and Limitations for OSPF................................................................................................. 258
5.7 Default Settings for OSPF................................................................................................................................................ 259
5.8 Configuring Basic OSPF Functions................................................................................................................................259
5.8.1 Creating an OSPF Process............................................................................................................................................ 259
5.8.2 Creating an OSPF Area..................................................................................................................................................260
5.8.3 Enabling OSPF.................................................................................................................................................................. 261
5.8.4 (Optional) Creating OSPF Virtual Links.................................................................................................................. 262
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. x
5.8.5 (Optional) Restricting the Flooding of LSA Packets........................................................................................... 263
5.8.6 Verifying the Basic OSPF Function Configuration................................................................................................264
5.9 Configuring Session Parameters for OSPF Neighbor or Adjacency Relationships....................................... 264
5.9.1 Setting an OSPF Packet Retransmission Limit...................................................................................................... 265
5.9.2 Configuring an Interface to Insert the Actual MTU into DD Packets........................................................... 265
5.9.3 Verifying the OSPF Session Parameter Configuration........................................................................................266
5.10 Configuring OSPF Attributes on Different Types of Networks.........................................................................267
5.10.1 Configuring a Network Type for an OSPF Interface.........................................................................................268
5.10.2 Configuring P2MP Network Attributes................................................................................................................. 269
5.10.3 Configuring NBMA Network Attributes................................................................................................................ 270
5.10.4 Verifying the OSPF Attribute Configuration........................................................................................................ 272
5.11 Configuring OSPF Stub Areas...................................................................................................................................... 272
5.11.1 Configuring an Area as a Stub Area...................................................................................................................... 273
5.11.2 Verifying the OSPF Stub Area Configuration...................................................................................................... 274
5.12 Configuring an OSPF NSSA.......................................................................................................................................... 274
5.13 Configuring Local MT..................................................................................................................................................... 277
5.14 Adjusting OSPF Route Selection................................................................................................................................. 279
5.14.1 Setting a Link Cost for an OSPF Interface........................................................................................................... 279
5.14.2 Configuring Equal-Cost Routes................................................................................................................................ 281
5.14.3 Configuring a Route Selection Rule....................................................................................................................... 282
5.14.4 Verifying the OSPF Route Selection Adjustment Configuration...................................................................282
5.15 Controlling OSPF Routing Information.....................................................................................................................283
5.15.1 Configuring OSPF to Import External Routes..................................................................................................... 283
5.15.2 Configuring OSPF to Advertise Default Routes to an OSPF Area................................................................284
5.15.3 Configuring OSPF Route Summarization............................................................................................................. 286
5.15.4 Configuring OSPF to Filter Received Routes....................................................................................................... 287
5.15.5 Configuring OSPF to Filter the Routes to Be Advertised................................................................................ 288
5.15.6 Configuring a Switch to Filter LSAs to Be Sent.................................................................................................. 288
5.15.7 Configuring OSPF to Filter ABR Type3 LSAs........................................................................................................289
5.15.8 (Optional) Enabling the Mesh-Group Function................................................................................................. 290
5.15.9 Setting the Maximum Number of External LSAs in the LSDB...................................................................... 290
5.15.10 Verifying the OSPF Route Control Configuration............................................................................................291
5.16 Configuring BFD for OSPF............................................................................................................................................ 291
5.16.1 Configuring Global BFD..............................................................................................................................................292
5.16.2 Configuring BFD for OSPF......................................................................................................................................... 292
5.16.3 (Optional) Preventing an Interface from Dynamically Setting Up a BFD Session................................ 293
5.16.4 (Optional) Configuring BFD on an Interface...................................................................................................... 294
5.16.5 Verifying the BFD for OSPF Configuration...........................................................................................................296
5.17 Configuring OSPF IP FRR............................................................................................................................................... 296
5.17.1 Enabling OSPF IP FRR................................................................................................................................................. 297
5.17.2 (Optional) Binding OSPF IP FRR and BFD........................................................................................................... 298
5.17.3 (Optional) Disabling OSPF IP FRR on an Interface.......................................................................................... 299
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xi
5.17.4 Verifying the OSPF IP FRR Configuration............................................................................................................. 300
5.18 Configuring OSPF Fast Convergence......................................................................................................................... 300
5.18.1 Setting a Convergence Priority for OSPF Routes............................................................................................... 301
5.18.2 Setting an Interval for Sending Hello Packets.................................................................................................... 301
5.18.3 Setting a Dead Time for a Neighbor Relationship............................................................................................ 302
5.18.4 Configuring Smart-discover...................................................................................................................................... 303
5.18.5 Setting an Interval for Updating LSAs...................................................................................................................303
5.18.6 Setting an Interval for Receiving LSAs.................................................................................................................. 304
5.18.7 Setting an Interval for SPF Calculations............................................................................................................... 305
5.18.8 Verifying the OSPF Fast Convergence Configuration....................................................................................... 306
5.19 Configuring OSPF GR...................................................................................................................................................... 307
5.19.1 Enabling the Opaque-LSA Capability of OSPF................................................................................................... 307
5.19.2 (Optional) Configuring GR Session Parameters on the Restarter............................................................... 308
5.19.3 (Optional) Configuring GR Session Parameters on the Helper.................................................................... 308
5.19.4 Verifying the OSPF GR Configuration.................................................................................................................... 309
5.20 Improving Stability of an OSPF Network................................................................................................................ 309
5.20.1 Setting a Priority for OSPF Routes..........................................................................................................................309
5.20.2 Configuring an LSA Transmission Delay on an Interface................................................................................310
5.20.3 Configuring an Interval for Retransmitting LSAs Between Adjacent Switches....................................... 310
5.20.4 Configuring a Stub Router.........................................................................................................................................311
5.20.5 Prohibiting an OSPF Interface from Sending and Receiving Protocol Packets....................................... 312
5.20.6 Disabling the Function of Triggering Active/Standby Board Switchover upon Abnormal OSPF LSA
Aging.............................................................................................................................................................................................. 312
5.20.7 Verifying the OSPF Network Stability Optimization Configuration............................................................ 313
5.21 Improving the Security of an OSPF Network......................................................................................................... 314
5.21.1 Configuring OSPF GTSM............................................................................................................................................ 314
5.21.2 Configuring an Area Authentication Mode......................................................................................................... 315
5.21.3 Configuring an Interface Authentication Mode................................................................................................. 317
5.21.4 Verifying the OSPF Network Security Optimization Configuration............................................................ 318
5.22 Configuring OSPF Neighbor Relationship Flapping Suppression.................................................................... 318
5.23 Suppressing the Advertisement of Interface IP Addresses.................................................................................321
5.24 Configuring Network Management for OSPF........................................................................................................322
5.24.1 Configuring OSPF MIB Binding................................................................................................................................ 322
5.24.2 Configuring the OSPF Trap Function..................................................................................................................... 322
5.24.3 Configuring the OSPF Log Function.......................................................................................................................323
5.24.4 Verifying the OSPF Network Management Configuration.............................................................................323
5.25 Maintaining OSPF............................................................................................................................................................ 323
5.25.1 Clearing OSPF Information....................................................................................................................................... 323
5.25.2 Resetting OSPF Information..................................................................................................................................... 324
5.26 Configuration Examples for OSPF.............................................................................................................................. 324
5.26.1 Example for Configuring Basic OSPF Functions.................................................................................................325
5.26.2 Example for Configuring OSPF DR Election........................................................................................................ 328
5.26.3 Example for Configuring OSPF Stub Areas.......................................................................................................... 334
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xii
5.26.4 Example for Configuring an OSPF NSSA.............................................................................................................. 338
5.26.5 Example for Configuring OSPF Load Balancing.................................................................................................343
5.26.6 Example for Configuring OSPF-BGP Synchronization...................................................................................... 348
5.26.7 Example for Configuring OSPF GR......................................................................................................................... 356
5.26.8 Example for Configuring BFD for OSPF................................................................................................................ 361
5.26.9 Example for Configuring OSPF IP FRR.................................................................................................................. 366
5.26.10 Example for Configuring Local OSPF MT.......................................................................................................... 370
5.27 Troubleshooting OSPF.................................................................................................................................................... 379
5.27.1 An OSPF Neighbor Relationship Cannot Be Established................................................................................ 379
5.27.2 OSPF Cannot Discover Routes of a Non-Local Area........................................................................................ 381
6 OSPFv3 Configuration........................................................................................................ 383
6.1 Overview of OSPFv3.......................................................................................................................................................... 384
6.2 Understanding OSPFv3.....................................................................................................................................................384
6.2.1 OSPFv3 Fundamentals.................................................................................................................................................. 384
6.2.2 OSPFv3 GR.........................................................................................................................................................................391
6.2.3 OSPFv3-BGP Synchronization..................................................................................................................................... 394
6.2.4 OSPFv3 Neighbor Relationship Flapping Suppression....................................................................................... 395
6.2.5 OSPFv3 and OSPFv2 Comparison..............................................................................................................................400
6.3 Summary of OSPFv3 Configuration Tasks................................................................................................................. 401
6.4 Licensing Requirements and Limitations for OSPFv3............................................................................................ 404
6.5 Default Settings for OSPFv3........................................................................................................................................... 404
6.6 Configuring Basic OSPFv3 Functions........................................................................................................................... 405
6.6.1 Enabling OSPFv3............................................................................................................................................................. 405
6.6.2 Enabling OSPFv3 on an Interface.............................................................................................................................. 406
6.6.3 Entering an OSPFv3 Area View.................................................................................................................................. 407
6.6.4 (Optional) Configuring a Route Selection Rule....................................................................................................408
6.6.5 Verifying the Basic OSPFv3 Function Configuration........................................................................................... 408
6.7 Establishing and Maintaining an OSPFv3 Neighbor Relationship.....................................................................409
6.7.1 Configuring an Interval at Which Hello Packets are Sent................................................................................ 409
6.7.2 Configuring a Dead Time for a Neighbor Relationship..................................................................................... 410
6.7.3 Configuring an LSA Retransmission Interval......................................................................................................... 411
6.7.4 Configuring an LSA Transmission Delay................................................................................................................. 411
6.7.5 Verifying the OSPFv3 Neighbor Relationship Establishment and Maintenance Configuration...........412
6.8 Configuring an OSPFv3 Area.......................................................................................................................................... 412
6.8.1 Configuring an OSPFv3 Stub Area............................................................................................................................ 413
6.8.2 Configuring OSPFv3 Virtual Links............................................................................................................................. 413
6.8.3 Verifying the OSPFv3 Area Configuration.............................................................................................................. 414
6.9 Configuring an OSPFv3 NSSA........................................................................................................................................ 415
6.9.1 Defining an Area as an NSSA..................................................................................................................................... 415
6.9.2 Verifying the OSPFv3 NSSA Configuration.............................................................................................................416
6.10 Configuring OSPFv3 Route Attributes.......................................................................................................................416
6.10.1 Setting a Cost for an OSPFv3 Interface................................................................................................................ 416
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xiii
6.10.2 Setting the Maximum Number of Equal-Cost Routes..................................................................................... 417
6.10.3 Verifying the OSPFv3 Route Attribute Configuration...................................................................................... 417
6.11 Controlling OSPFv3 Routing Information................................................................................................................ 418
6.11.1 Configuring OSPFv3 Route Summarization.........................................................................................................418
6.11.2 Configuring OSPFv3 to Filter the Received Routes........................................................................................... 419
6.11.3 Configuring OSPFv3 to Import External Routes................................................................................................ 420
6.11.4 (Optional) Configuring OSPFv3 to Filter LSAs in an Area............................................................................. 421
6.11.5 Verifying the OSPFv3 Route Control Configuration..........................................................................................421
6.12 Optimizing an OSPFv3 Network................................................................................................................................. 422
6.12.1 Configuring an SPF Timer.......................................................................................................................................... 422
6.12.2 Suppressing an Interface from Sending and Receiving OSPFv3 Packets...................................................423
6.12.3 Configuring a DR Priority for an Interface...........................................................................................................424
6.12.4 Configuring a Stub Router.........................................................................................................................................425
6.12.5 Ignoring MTU Check on DD Packets..................................................................................................................... 425
6.12.6 Verifying the OSPFv3 Network Optimization Configuration.........................................................................426
6.13 Configuring BFD for OSPFv3........................................................................................................................................ 426
6.13.1 Configuring BFD Globally.......................................................................................................................................... 427
6.13.2 Configuring BFD for OSPFv3.................................................................................................................................... 428
6.13.3 (Optional) Preventing an Interface from Dynamically Setting Up a BFD Session................................ 428
6.13.4 (Optional) Configuring BFD for a Specified Interface..................................................................................... 429
6.13.5 Verifying the BFD for OSPFv3 Configuration...................................................................................................... 430
6.14 Configuring OSPFv3 IP FRR.......................................................................................................................................... 430
6.14.1 Enabling OSPFv3 IP FRR............................................................................................................................................. 431
6.14.2 (Optional) Disabling OSPFv3 IP FRR on an Interface...................................................................................... 432
6.14.3 Verifying the OSPFv3 IP FRR Configuration........................................................................................................ 432
6.15 Configuring OSPFv3 GR................................................................................................................................................. 432
6.15.1 Enabling OSPFv3 GR....................................................................................................................................................433
6.15.2 Enabling the OSPFv3 GR Helper............................................................................................................................. 433
6.15.3 Verifying the OSPFv3 GR Configuration............................................................................................................... 434
6.16 Improving OSPFv3 Network Security........................................................................................................................ 434
6.16.1 Configuring OSPFv3 GTSM........................................................................................................................................435
6.16.2 Configuring an Authentication Mode....................................................................................................................436
6.16.3 Verifying the OSPFv3 Network Security Optimization Configuration........................................................437
6.17 Configuring OSPFv3 Neighbor Relationship Flapping Suppression................................................................437
6.18 Configuring OSPFv3 IPSec.............................................................................................................................................440
6.18.1 Configuring an IPSec Session for Encryption...................................................................................................... 440
6.18.2 Configuring OSPFv3 IPSec Authentication...........................................................................................................443
6.18.3 Verifying the OSPFv3 IPSec Configuration...........................................................................................................445
6.19 Configuring the Network Management Function of OSPFv3.......................................................................... 445
6.19.1 Configuring OSPFv3 MIB Binding........................................................................................................................... 446
6.19.2 Configuring OSPFv3 Trap........................................................................................................................................... 446
6.19.3 Verifying the OSPFv3 Network Management Function Configuration......................................................447
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xiv
6.20 Resetting OSPFv3............................................................................................................................................................. 447
6.21 Configuration Examples for OSPFv3......................................................................................................................... 447
6.21.1 Example for Configuring an OSPFv3 Stub Area................................................................................................. 447
6.21.2 Example for Configuring DR Election Through OSPFv3..................................................................................452
6.21.3 Example for Configuring an OSPFv3 Virtual Link............................................................................................. 458
6.21.4 Example for Configuring OSPFv3 GR.....................................................................................................................462
6.21.5 Example for Configuring BFD for OSPFv3........................................................................................................... 466
7 IPv4 IS-IS Configuration.................................................................................................... 473
7.1 Overview of IS-IS................................................................................................................................................................ 474
7.2 Understanding IS-IS........................................................................................................................................................... 474
7.2.1 Basic Concepts of IS-IS.................................................................................................................................................. 474
7.2.2 IS-IS Fundamentals.........................................................................................................................................................481
7.2.3 IS-IS Authentication....................................................................................................................................................... 486
7.2.4 IS-IS Route Leaking........................................................................................................................................................ 488
7.2.5 IS-IS Overload.................................................................................................................................................................. 489
7.2.6 IS-IS Network Convergence......................................................................................................................................... 490
7.2.7 IS-IS Neighbor Relationship Flapping Suppression............................................................................................. 491
7.2.8 IS-IS Administrative Tag................................................................................................................................................ 498
7.2.9 IS-IS Wide Metric............................................................................................................................................................ 499
7.2.10 IS-IS LSP Fragment Extension...................................................................................................................................500
7.2.11 IS-IS Host Name Mapping......................................................................................................................................... 503
7.2.12 IS-IS GR............................................................................................................................................................................ 504
7.2.13 BFD for IS-IS................................................................................................................................................................... 510
7.2.14 IS-IS Auto FRR................................................................................................................................................................ 513
7.2.15 IS-IS TE............................................................................................................................................................................. 517
7.2.16 IS-IS Local MT................................................................................................................................................................ 521
7.2.17 IS-IS Multi-Instance and Multi-Process................................................................................................................. 524
7.3 Default Settings for IPv4 IS-IS........................................................................................................................................525
7.4 Summary of IPv4 IS-IS Configuration Tasks.............................................................................................................. 525
7.5 Licensing Requirements and Limitations for IPv4 IS-IS......................................................................................... 530
7.6 Configure Basic IS-IS Functions..................................................................................................................................... 530
7.6.1 Creating IS-IS Processes................................................................................................................................................ 531
7.6.2 Configuring a NET.......................................................................................................................................................... 531
7.6.3 Configuring the Device Level...................................................................................................................................... 532
7.6.4 Establishing IS-IS Neighbor Relationships.............................................................................................................. 533
7.6.5 Verifying the Basic IS-IS Function Configuration................................................................................................. 537
7.7 Improving IS-IS Network Security.................................................................................................................................537
7.7.1 Configuring Interface Authentication...................................................................................................................... 537
7.7.2 Configuring Area or Domain Authentication........................................................................................................ 539
7.7.3 Configuring the Optional Checksum........................................................................................................................ 540
7.7.4 Verifying the IS-IS Network Security Optimization Configuration................................................................ 541
7.8 Controlling IS-IS Route Selection.................................................................................................................................. 541
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xv
7.8.1 Configuring a Preference Value for IS-IS................................................................................................................ 541
7.8.2 Configuring the Cost of an IS-IS Interface............................................................................................................. 542
7.8.3 Configuring Equal-Cost IS-IS Routes........................................................................................................................ 544
7.8.4 Configuring IS-IS Route Leaking................................................................................................................................ 546
7.8.5 Controlling Whether a Level-1 Device Generates a IPv4 Default Route..................................................... 547
7.8.6 Verifying the IS-IS Route Selection Control Configuration............................................................................... 548
7.9 Controlling IS-IS Route Exchange................................................................................................................................. 548
7.9.1 Configuring IS-IS to Advertise a Default Route.................................................................................................... 548
7.9.2 Configuring IS-IS to Import External Routes......................................................................................................... 549
7.9.3 Configuring IS-IS to Advertise Specified External Routes to an IS-IS Routing Domain..........................550
7.9.4 Adding Specified IS-IS Routes to the IP Routing Table...................................................................................... 550
7.9.5 Verifying the IS-IS Route Exchange Control Configuration.............................................................................. 551
7.10 Configuring IS-IS Route Summarization.................................................................................................................. 551
7.11 Controlling IS-IS Route Convergence........................................................................................................................ 552
7.11.1 Configuring Attributes for Hello Packets..............................................................................................................552
7.11.2 Configuring Attributes for LSPs............................................................................................................................... 553
7.11.3 Configuring Attributes for CSNPs............................................................................................................................559
7.11.4 Setting the SPF Calculation Interval...................................................................................................................... 559
7.11.5 Configuring Convergence Priorities for IS-IS Routes........................................................................................ 560
7.11.6 Verifying the IS-IS Route Convergence Control Configuration..................................................................... 561
7.12 Configuring LSP Fragment Extension........................................................................................................................561
7.13 Configuring a Mesh Group on an NBMA Network.............................................................................................. 563
7.14 Configuring IS-IS Reliability.......................................................................................................................................... 563
7.14.1 Configuring Static BFD for IS-IS.............................................................................................................................. 564
7.14.2 Configuring Dynamic BFD for IS-IS........................................................................................................................ 566
7.14.3 Enabling IS-IS GR.......................................................................................................................................................... 568
7.15 Configuring IPv4 IS-IS Auto FRR................................................................................................................................. 569
7.15.1 Enabling IPv4 IS-IS Auto FRR....................................................................................................................................569
7.15.2 (Optional) Disabling an Interface from Being Involved in IPv4 LFA Calculation................................... 570
7.15.3 Verifying the IPv4 IS-IS Auto FRR Configuration............................................................................................... 570
7.16 Configuring the Overload Bit for an IS-IS Device................................................................................................. 571
7.17 Configuring IS-IS Neighbor Relationship Flapping Suppression...................................................................... 571
7.18 Maintaining IS-IS.............................................................................................................................................................. 574
7.18.1 Resetting IS-IS................................................................................................................................................................ 574
7.18.2 Improving the Maintainability of IS-IS.................................................................................................................. 575
7.18.3 Configuring the Output of IS-IS Adjacency Status............................................................................................576
7.19 Configuration Examples for IPv4 IS-IS...................................................................................................................... 576
7.19.1 Example for Configuring Basic IS-IS Functions.................................................................................................. 576
7.19.2 Example for Configuring IS-IS Route Summarization......................................................................................582
7.19.3 Example for Configuring DIS Election................................................................................................................... 586
7.19.4 Example for Configuring IS-IS Load Balancing.................................................................................................. 592
7.19.5 Example for Configuring IS-IS Auto FRR (IP Protecting IP)........................................................................... 597
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xvi
7.19.6 Example for Configuring Static BFD for IS-IS..................................................................................................... 605
7.19.7 Example for Configuring Dynamic BFD for IS-IS............................................................................................... 610
7.19.8 Example for Configuring IS-IS GR........................................................................................................................... 617
7.20 Troubleshooting IPv4 IS-IS............................................................................................................................................ 620
7.20.1 Failed to Establish IS-IS Neighbor Relationships............................................................................................... 621
7.20.2 A Device Cannot Learn IS-IS Routes from Its Neighbor..................................................................................622
8 IPv6 IS-IS Configuration.................................................................................................... 624
8.1 Overview of IS-IS................................................................................................................................................................ 624
8.2 Understanding IPv6 IS-IS................................................................................................................................................. 625
8.2.1 IPv6 IS-IS............................................................................................................................................................................ 625
8.3 Summary of IPv6 IS-IS Configuration Tasks.............................................................................................................. 625
8.4 Licensing Requirements and Limitations for IPv6 IS-IS......................................................................................... 629
8.5 Default Settings for IPv6 IS-IS........................................................................................................................................630
8.6 Configuring Basic IPv6 IS-IS Functions........................................................................................................................630
8.6.1 Creating an IS-IS Process.............................................................................................................................................. 631
8.6.2 Configuring a NET and Enabling IPv6 IS-IS........................................................................................................... 631
8.6.3 Configuring a Device Level.......................................................................................................................................... 632
8.6.4 Establishing an IS-IS Neighbor Relationship......................................................................................................... 633
8.6.5 Verifying the Basic IPv6 IS-IS Function Configuration........................................................................................636
8.7 Improving IPv6 IS-IS Network Security....................................................................................................................... 636
8.7.1 Configuring Interface Authentication...................................................................................................................... 636
8.7.2 Configuring Area or Domain Authentication........................................................................................................ 638
8.7.3 Configuring the Optional Checksum........................................................................................................................ 640
8.7.4 Verifying the IPv6 IS-IS Network Security Optimization Configuration.......................................................641
8.8 Controlling IPv6 IS-IS Route Selection........................................................................................................................ 641
8.8.1 Configuring a Preference Value for IPv6 IS-IS.......................................................................................................641
8.8.2 Configuring a Cost for IS-IS Interfaces on an IPv6 Network........................................................................... 642
8.8.3 Configuring Equal-Cost IPv6 IS-IS Routes.............................................................................................................. 644
8.8.4 Configuring IS-IS IPv6 Route Leaking...................................................................................................................... 645
8.8.5 Controlling Whether a Level-1 Device Generates an IPv6 Default Route...................................................646
8.8.6 Verifying the IPv6 IS-IS Route Selection Control Configuration..................................................................... 647
8.9 Controlling IPv6 IS-IS Route Exchange........................................................................................................................647
8.9.1 Configuring IS-IS to Advertise a Default Route.................................................................................................... 648
8.9.2 Configuring IS-IS to Import External Routes......................................................................................................... 648
8.9.3 Configuring IS-IS to Advertise Specified External Routes to an IS-IS Routing Domain..........................649
8.9.4 Adding Specified IS-IS Routes to an IPv6 Routing Table................................................................................... 650
8.9.5 Verifying the IPv6 IS-IS Route Exchange Control Configuration.....................................................................650
8.10 Configuring IPv6 IS-IS Route Summarization........................................................................................................ 650
8.11 Controlling IPv6 IS-IS Route Convergence...............................................................................................................651
8.11.1 Configuring Attributes for Hello Packets..............................................................................................................651
8.11.2 Configuring Attributes for LSPs............................................................................................................................... 653
8.11.3 Configuring Attributes for CSNPs............................................................................................................................658
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xvii
8.11.4 Setting an SPF Calculation Interval........................................................................................................................ 659
8.11.5 Configuring Convergence Priorities for IS-IS Routes........................................................................................ 660
8.11.6 Verifying the IPv6 IS-IS Route Convergence Control Configuration............................................................661
8.12 Configuring LSP Fragment Extension........................................................................................................................661
8.13 Configuring a Mesh Group on an NBMA Network.............................................................................................. 662
8.14 Configuring IPv6 IS-IS Reliability................................................................................................................................ 663
8.14.1 Configuring Dynamic BFD for IPv6 IS-IS.............................................................................................................. 663
8.15 Configuring the Overload Bit for an IS-IS Device................................................................................................. 666
8.16 Maintaining IS-IS.............................................................................................................................................................. 666
8.16.1 Resetting IS-IS................................................................................................................................................................ 667
8.16.2 Improving the Maintainability of IS-IS.................................................................................................................. 667
8.16.3 Configuring the Output of IS-IS Adjacency Status............................................................................................668
8.17 Configuration Examples for IPv6 IS-IS...................................................................................................................... 669
8.17.1 Example for Configuring Basic IPv6 IS-IS Functions.........................................................................................669
8.17.2 Example for Configuring Dynamic BFD for IPv6 IS-IS..................................................................................... 675
9 BGP Configuration.............................................................................................................. 682
9.1 Overview of BGP................................................................................................................................................................. 682
9.2 Understanding BGP........................................................................................................................................................... 683
9.2.1 Basic Concepts of BGP................................................................................................................................................... 683
9.2.2 BGP Fundamentals......................................................................................................................................................... 685
9.2.3 Interaction Between BGP and IGPs........................................................................................................................... 688
9.2.4 BGP Security......................................................................................................................................................................690
9.2.5 BGP Route Selection Rules and Load Balancing.................................................................................................. 690
9.2.6 Route Reflector................................................................................................................................................................ 694
9.2.7 BGP Confederation......................................................................................................................................................... 699
9.2.8 Route Summarization.................................................................................................................................................... 700
9.2.9 Route Dampening........................................................................................................................................................... 701
9.2.10 BFD for BGP.................................................................................................................................................................... 701
9.2.11 BGP Tracking.................................................................................................................................................................. 702
9.2.12 BGP GR............................................................................................................................................................................. 703
9.2.13 Dynamic Update Peer-Groups..................................................................................................................................703
9.2.14 MP-BGP and Address Families................................................................................................................................. 706
9.2.15 BGP VPN Route Crossing........................................................................................................................................... 714
9.2.16 Route Processing on the BGP router......................................................................................................................718
9.2.17 BGP Routing Table....................................................................................................................................................... 719
9.2.18 Route Attributes............................................................................................................................................................ 724
9.2.18.1 BGP Route Attributes............................................................................................................................................... 724
9.2.18.2 Next_Hop..................................................................................................................................................................... 728
9.2.18.3 PrefVal........................................................................................................................................................................... 734
9.2.18.4 Local_Pref..................................................................................................................................................................... 739
9.2.18.5 Route Type................................................................................................................................................................... 752
9.2.18.6 AS_Path......................................................................................................................................................................... 755
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xviii
9.2.18.7 Origin.............................................................................................................................................................................763
9.2.18.8 MED............................................................................................................................................................................... 766
9.2.18.9 Peer Type...................................................................................................................................................................... 774
9.2.18.10 IGP Cost...................................................................................................................................................................... 775
9.2.18.11 Cluster_List................................................................................................................................................................ 778
9.2.18.12 Originator_ID............................................................................................................................................................ 780
9.2.18.13 BGP Router ID.......................................................................................................................................................... 783
9.2.18.14 Peer IP Address........................................................................................................................................................ 783
9.3 Summary of BGP Configuration Tasks........................................................................................................................ 785
9.4 Licensing Requirements and Limitations for BGP................................................................................................... 791
9.5 Default Settings for BGP.................................................................................................................................................. 792
9.6 Configuring Basic BGP Functions.................................................................................................................................. 792
9.6.1 Starting a BGP Process.................................................................................................................................................. 792
9.6.2 Configuring BGP Peers.................................................................................................................................................. 793
9.6.3 (Optional) Configuring a BGP Peer Group.............................................................................................................794
9.6.4 (Optional) Configuring Dynamic BGP Peers......................................................................................................... 796
9.6.5 Configuring BGP to Import Routes........................................................................................................................... 798
9.6.6 Verifying the Basic BGP Function Configuration.................................................................................................. 799
9.7 Configuring BGP Security................................................................................................................................................ 799
9.7.1 Configuring MD5 Authentication.............................................................................................................................. 800
9.7.2 Configuring Keychain Authentication...................................................................................................................... 801
9.7.3 Configuring BGP GTSM................................................................................................................................................. 801
9.7.4 Verifying the BGP Security Configuration...............................................................................................................802
9.8 Simplifying IBGP Network Connections......................................................................................................................802
9.8.1 Configuring a BGP Route Reflector.......................................................................................................................... 803
9.8.2 Configuring a BGP Confederation............................................................................................................................. 804
9.9 Configuring BGP Route Selection and Load Balancing......................................................................................... 805
9.9.1 Configuring the BGP Priority....................................................................................................................................... 805
9.9.2 Configuring the Next_Hop Attribute........................................................................................................................ 806
9.9.3 Configuring the PrefVal Attribute............................................................................................................................. 808
9.9.4 Configuring the Default Local_Pref Attribute....................................................................................................... 808
9.9.5 Configuring the AS_Path Attribute........................................................................................................................... 809
9.9.6 Configuring the MED Attribute.................................................................................................................................. 812
9.9.7 Configuring the BGP Community Attribute........................................................................................................... 813
9.9.8 Configuring BGP Load Balancing.............................................................................................................................. 815
9.9.9 Verifying the BGP Route Selection and Load Balancing Configuration....................................................... 816
9.10 Controlling the Receiving and Advertisement of BGP Routes.......................................................................... 817
9.10.1 Configuring a Routing Policy.................................................................................................................................... 817
9.10.2 Controlling the Advertisement of BGP Routes................................................................................................... 818
9.10.3 Controlling the Receiving of BGP Routes............................................................................................................. 819
9.10.4 Configuring BGP Soft Reset...................................................................................................................................... 821
9.10.5 Verifying the BGP Route Receiving and Advertisement Configuration......................................................823
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xix
9.11 Adjusting the BGP Network Convergence Speed..................................................................................................824
9.11.1 Configuring a BGP ConnectRetry Timer............................................................................................................... 824
9.11.2 Configuring BGP Keepalive and Hold Timers..................................................................................................... 825
9.11.3 Configuring an Update Message Timer................................................................................................................ 826
9.11.4 Disabling Rapid EBGP Connection Reset.............................................................................................................. 827
9.11.5 Configuring the BGP Next Hop Delayed Response...........................................................................................828
9.11.6 Configuring BGP Route Dampening...................................................................................................................... 829
9.11.7 Configuring Slow Peer Detection............................................................................................................................ 830
9.11.8 Verifying the BGP Network Convergence Speed Adjustment Configuration........................................... 831
9.12 Configuring BGP Reliability.......................................................................................................................................... 832
9.12.1 Enabling BGP Tracking................................................................................................................................................ 832
9.12.2 Configuring BFD for BGP........................................................................................................................................... 833
9.12.3 Configuring BGP GR.....................................................................................................................................................834
9.13 Configuring BGP Route Summarization................................................................................................................... 835
9.14 Configuring BGP to Advertise Default Routes to Peers...................................................................................... 837
9.15 Configuring MP-BGP....................................................................................................................................................... 838
9.16 Maintaining BGP.............................................................................................................................................................. 839
9.16.1 Configuring Alarm and Clear Alarm Thresholds for the Number of BGP Routes..................................839
9.16.2 Resetting BGP Connections....................................................................................................................................... 840
9.16.3 Clearing BGP Statistics................................................................................................................................................ 841
9.17 Configuration Examples for BGP................................................................................................................................ 841
9.17.1 Example for Configuring Basic BGP Functions................................................................................................... 841
9.17.2 Example for Configuring Basic BGP4+ Functions.............................................................................................. 847
9.17.3 Example for Configuring Basic MBGP Functions............................................................................................... 853
9.17.4 Example for Configuring BGP to Interact with an IGP.................................................................................... 862
9.17.5 Example for Configuring AS_Path Filter............................................................................................................... 866
9.17.6 Example for Configuring MED Attributes to Control BGP Route Selection..............................................871
9.17.7 Example for Configuring a BGP Route Reflector............................................................................................... 876
9.17.8 Example for Configuring a BGP4+ Route Reflector.......................................................................................... 881
9.17.9 Example for Configuring a BGP Confederation..................................................................................................887
9.17.10 Example for Configuring the BGP Community Attribute............................................................................. 894
9.17.11 Example for Configuring BGP Load Balancing.................................................................................................898
9.17.12 Example for Configuring a BGP Routing Policy............................................................................................... 904
9.17.13 Example for Configuring BFD for BGP................................................................................................................ 924
9.17.14 Example for Configuring BFD for BGP4+........................................................................................................... 929
9.17.15 Example for Configuring BGP GTSM................................................................................................................... 935
10 Routing Policy Configuration.........................................................................................945
10.1 Overview of Routing Policies....................................................................................................................................... 945
10.2 Understanding Routing Policies.................................................................................................................................. 947
10.2.1 Routing Policy Fundamentals................................................................................................................................... 947
10.2.2 IP Prefix List.................................................................................................................................................................... 951
10.2.3 Route-Policy Implementation and Applications................................................................................................ 956
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xx
10.2.4 Filter-Policy Implementation and Applications.................................................................................................. 959
10.2.5 AS_Path Filter Applications in BGP......................................................................................................................... 968
10.2.6 Community Attribute Applications in BGP.......................................................................................................... 975
10.3 Summary of Routing Policy Configuration Tasks..................................................................................................981
10.4 Licensing Requirements and Limitations for Routing Policies..........................................................................984
10.5 Configuring Filters........................................................................................................................................................... 984
10.5.1 Configuring an IP Prefix List..................................................................................................................................... 984
10.5.2 Configuring an AS_Path Filter.................................................................................................................................. 985
10.5.3 Configuring a Community Filter..............................................................................................................................986
10.5.4 Configuring an Extended Community Filter........................................................................................................987
10.5.5 Configuring an RD Filter............................................................................................................................................ 987
10.6 Configuring a Routing Policy....................................................................................................................................... 988
10.6.1 Creating a Routing Policy.......................................................................................................................................... 988
10.6.2 (Optional) Configuring an if-match Clause........................................................................................................ 989
10.6.3 (Optional) Configuring an apply Clause.............................................................................................................. 991
10.6.4 (Optional) Enabling Further Route Matching Against a Specified Node................................................. 992
10.6.5 Applying a Route-Policy............................................................................................................................................. 993
10.6.6 Verifying the Routing Policy Configuration.......................................................................................................1007
10.7 Configuring Filter-Policy.............................................................................................................................................. 1007
10.7.1 Applying Filters to Received Routes.....................................................................................................................1007
10.7.2 Applying Filters to Advertised Routes................................................................................................................. 1010
10.8 Controlling the Valid Time of Routing Policies................................................................................................... 1013
10.9 Maintaining Routing Policies..................................................................................................................................... 1014
10.10 Configuration Examples for Routing Policies.................................................................................................... 1014
10.10.1 Example for Filtering the Routes to Be Received or Advertised.............................................................. 1014
10.10.2 Example for Applying a Routing Policy for Importing Routes................................................................. 1019
11 IP Routing Table Management................................................................................... 1025
11.1 Licensing Requirements and Limitations for IP Routing Table Management.......................................... 1025
11.2 Managing IP Routing Tables...................................................................................................................................... 1026
11.2.1 Displaying and Maintaining an IP Routing Table........................................................................................... 1026
11.2.2 Displaying and Maintaining the Routing Management Module...............................................................1027
11.2.3 Displaying and Maintaining FIB Tables.............................................................................................................. 1029
11.2.4 Configuring IP FRR on the Public Network....................................................................................................... 1032
11.2.5 Configuring IPv6 FRR on the Public Network.................................................................................................. 1034
11.2.6 Configuring the ECMP Load Balancing Mode.................................................................................................. 1035
11.2.7 Configuring the Advertisement of IPv4 ARP Vlink Direct Routes..............................................................1036
11.3 Example for Configuring IP FRR on the Public Network................................................................................. 1038
12 PBR Configuration.......................................................................................................... 1043
12.1 Overview of PBR............................................................................................................................................................ 1043
12.2 Licensing Requirements and Limitations for PBR...............................................................................................1044
12.3 Configuring PBR............................................................................................................................................................. 1045
12.4 Configuring NQA for PBR........................................................................................................................................... 1048
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xxi
12.5 (Optional) Configuring PBR to Take Precedence over Blackhole Routes...................................................1051
12.6 Configuration Examples for PBR.............................................................................................................................. 1052
12.6.1 Example for Configuring PBR Based on IP Addresses................................................................................... 1052
12.6.2 Example for Configuring PBR.................................................................................................................................1056
12.6.3 Example for Configuring PBR to Import Traffic to the Firewall in Bypass Mode.................................1059
12.6.4 Example for Configuring NQA for PBR............................................................................................................... 1063
13 Route Monitoring Group Configuration....................................................................1069
13.1 Overview of Route Monitoring Groups.................................................................................................................. 1069
13.2 Application Scenarios for Route Monitoring Groups.........................................................................................1070
13.2.1 Preventing Network Congestion........................................................................................................................... 1070
13.2.2 Preventing Traffic Loss..............................................................................................................................................1071
13.3 Understanding Route Monitoring Groups.............................................................................................................1072
13.4 Licensing Requirements and Limitations for Route Monitoring Group...................................................... 1073
13.5 Configuring Association Between IPv4 Static Routes and a Route Monitoring Group......................... 1073
13.6 Example for Configuring Association Between IPv4 Static Routes and a Route Monitoring Group 1075
S300, S500, S2700, S5700 and S6700 Series Ethernet
Switches
Configuration Guide - IP Unicast Routing Contents
Issue 01 (2024-09-30) Copyright © Huawei Technologies Co., Ltd. xxii
