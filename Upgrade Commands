Upgrade Commands

    Command Support
    check startup
    display device group-speed license-usage
    display last startup information
    display license
    display license esn
    display license information
    display license resource usage
    display license revoke-ticket
    display license state
    display module-information
    display paf
    display patch-information
    display rollback
    display virtual license
    install-module
    license active
    license emergency
    virtual-license emergency
    license revoke
    license verify
    patch active all
    patch configuration-synchronize
    patch deactive all
    patch delete all
    patch load
    patch run all
    reset patch-configure
    rollback
    uninstall-module

Command Support

Commands provided in this section and all the parameters in the commands are supported by all switch models (except the S5751-L, S5731-L, and S5731S-L), unless otherwise specified. For details, see specific commands.
check startup
Function

The check startup command checks the correctness of various resource files, including the PAF file, the patch package, the startup software, and the configuration file.
Format

check startup [ crc ] [ next ]
Parameters
Parameter 	Description 	Value
crc 	Performs a CRC check on various resource files. 	-
next 	Checks various resource files used for next startup. 	-
Views

User view
Default Level

1: Monitoring level
Usage Guidelines

After configuring the resource files for next startup, you can run this command to check whether the resource files are complete and whether the formats and versions of the resource files are correct.
Example

# Check the correctness of the resource files.

<HUAWEI> check startup

Main board:
Check startup software.......ok                                                 
Check configuration file.....ok                                                 
Check PAF....................ok                                                 
Check Patch..................ok                                                 
PAF is fitted with startup software                                             
Info: Slave board is not existing. 

# Performs a CRC check on various resource files.

<HUAWEI> check startup crc

Warning: This operation will take several minutes! Continue?[Y/N]:y
Check startup software CRC....................................................  
ok                                                                              
Info: Slave board is not existing.  

display device group-speed license-usage
Function

The display device group-speed license-usage command displays the usage of license control items.

This command takes effect only on the following devices that have license control items loaded:

S5732-H24UM2CC, S5732-H48UM2CC, and S5736-S24UM4XC
Format

display device group-speed license-usage
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To check the usage of license control items, run the display device group-speed license-usage command.

For details about license control items, see License Control Items.
Example

# Display the usage of license control items.

<HUAWEI> display device group-speed license-usage
Slot LicenseItem      ResourceCount ResourceUsed                                                                                    
------------------------------------------------                                                     
 0   1G->2.5G         4             0                                                                                               
     1G->5G           4             0                                                                                               
     1G->10G          4             3                                                                                               
     2.5G->5G         1             0                                                                                               
     2.5G->10G        1             0                                                                                               
     5G->10G          1             0

Table 2-64 Description of the display device group-speed license-usage command output

Item
	

Description

Slot
	

Slot ID.

LicenseItem
	

Control item name.

ResourceCount
	

Number of control Items.

ResourceUsed
	

Number of used control items.
display last startup information
Function

The display last startup information command displays the version of the system software used for the last startup.
Format

display last startup information slot slot-id
Parameters
Parameter 	Description 	Value

slot slot-id
	

Displays the version of the system software used for the last startup in the MPU slot.
	

The value must be set according to the device configuration.
Views

All view
Default Level

1: Monitoring level
Usage Guidelines

You can run the display last startup information command to check the version of the system software used for the last startup.

Precautions

    If the device is upgraded from V200R020C10SPC100 or an earlier version to V200R020C10SPC500 or a later version, because the source version does not support this command, the system displays a message "Info: The file that records information about the last startup system software is empty." after this command is executed.
    If the device version is V200R020C10SPC500 or later and the system software remains unchanged, the system displays a message "Info: The file that records information about the last startup system software is empty." after this command is executed.

Example

# Display the version of the system software used for the last startup.

<HUAWEI> system-view
[HUAWEI] display last startup information slot 0
Startup system software : flash:/basicsoft.cc
Software version        : V200R021C01SPC100B236
Software compile time   : Oct 30 2021, 19:32:02

display license
Function

The display license command displays information about the license file in the system.

This command takes effect only on the device that loads the license control item.
Format

display license [ file-name | verbose ]
Parameters
Parameter 	Description 	Value

file-name
	

Displays summary information about the license file with a specified file name.
file-name supports file name association. The disk where the file resides can be automatically associated.

    Full help: All the disks of the device can be associated and displayed.
    Partial help: The related disk and file can be associated and displayed after you enter a specified character string.

	

The value is a string of 5 to 64 case-insensitive characters without spaces.

verbose
	

Displays detailed information about the current active license file.
	

-
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

A license file dynamically controls the availability of some features. Only one license file is active in the system. Run this command to view detailed information about the active license in the system, including license file name, version, validity period, and control item. Based on the information, you can determine whether to upgrade the system version to support more features.

Precautions

The license of an N1 software package is activated on iMaster NCE-Campus. Therefore, you cannot view the license control items of the N1 software package by running this command on the device.

On the S5732-H24UM2CC, S5732-H48UM2CC, and S5736-S24UM4XC, if these devices set up a stack and the master and non-master devices have inconsistent license control items, run the display device group-speed license-usage command to check the usage of license control items in the stack.
Example
# Display information about the active license file of the device.

<HUAWEI> display license
 Active license    : flash:/LICORTF163673-554BEF51E8.dat
 License state     : Trial
 Revoke ticket     : No ticket

 RD of Huawei Technologies Co., Ltd.

 Product name      : S5700
 Product version   : V200R0012
 License Serial No : LIC20210401UV9K50
 Creator           : Huawei Technologies Co., Ltd.
 Created Time      : 2021-04-01 21:22:06
 Sns End Data      : 2021-07-01
 Feature name      : EHFEA1
 Authorize type    : DEMO
 Expired date      : PERMANENT
 Trial days        : 60

 Item name          Item type  Value    Description
 -------------------------------------------------------------
 ES5SF4512K00       Resource   2        FIB512K
 ES5SF4128K00       Resource   6        FIB128K
 ES5SWL16AP00       Resource   64       WL16AP
 ES5SWL64AP00       Resource   16       WL64AP
 ES5SWL128AP0       Resource   8        WL128AP
 ES5SWL512AP0       Resource   2        WL512AP

 Master board license state: Trial. The trial days remains 60 days. Apply for authentic license before the current license expires.

Table 2-65 Description of the display license command output

Item
	

Description

Active license
	

Name and path of the active license file.

License state
	
Status of a license file:

    Normal

    This state value indicates that a license file is working properly. If the status of the license file on the live network is not Normal, check the license file.

    Trial

        A license file enters the Trial state if the ESN does not match the device. A license file in Trial state can be used only for 60 days.

        To continue to use a license file after the Trial state, apply for a new license file using the correct ESN.

        A temporary license file expires and enters the Trial state.

        To continue to use a license file after the Trial state, apply for a new license file and activate it.

        A license file is revoked and enters the Trial state.

        To continue to use a license file after the Trial state, apply for a new license file based on the revocation code and activate it.

    Demo

    When you activate a temporary license file, it enters the Demo state. The Demo state exists only for a demo license file used for test and deployment.

    A license file in Demo state allows you to use normal functions within a specified period. Before the expiration of the license file in Demo state, replace it with a commercial license file.

    Emergency

    In emergency conditions like earthquakes, volcano explosions, and tsunamis, run the license emergency command to trigger a license file to enter the emergency state. The emergency state stays for seven days, and a license file can enter the emergency state three times.

    Default: No license file is activated or a license file expires.

    If a license file enters the Default state, services will be interrupted.

    If you want to use services after a license file expires or becomes invalid, apply for a new license file and activate it.

Revoke ticket
	

License revocation code. no ticket indicates that the license is permanently valid.

Product name
	

Name of the product that runs the license.

Product version
	

Product version.

License Serial No
	

Serial number of the license file.

Creator
	

Creator of the file.

Created Time
	

Time when the file was created.

Sns End Data
	

SnS end date in the N1 business model.

Only the following models support this field:

    S5700 series: S300, S500, S5720-LI, S5720-SI, S5720-HI, S5720-EI, S5720I-SI, S5730-SI, S5730-HI, S5731-S, S5731-H, , S5732-H, S5735-L, S5735-L-I, S5735-L1, S5735-S, S5735-S-I, S5736-S
    S6700 series: S6720-LI, S6720-SI, S6735-S, S6720-HI, S6730-S, S6730-H, 

Feature name
	

Feature name.

Authorize type
	
Authorization type.

    demo: trial authorization.
    comm: commercial authorization.

Expired date
	

License expiration date. PERMANENT indicates that the license is permanently valid.
A license file enters the trial period after it expires. This does not affect services. When the trial period expires, a license file will be invalid. The services and functions under its control revert to the default values.
NOTE:

You need to apply for a new license file and activate it during the trial period. After activation, the new license file replaces the one in the trial period automatically.

Trial days
	
Trial period of an expired license.

    For a license file in the trail state, the trial period is 60 days. The value of this field is displayed as 60.
    For a license file that is not in the trail state, this field is meaningless, and its value is displayed as --.

Item name
	

Name of a control item.

Item type
	
Type of a control item.

    Function: function items controlled by a license file
    Resource: resource items controlled by a license file

Value
	
Value of a control item.

    When Item type displays Function, Value displays Yes, indicating that this function is enabled.
    When Item type displays Resource, Value displays a specified value, indicating the maximum number of this resource item.

NOTE:

This parameter is displayed in the display license command output.

Control value
	

Values supported by a control item.
NOTE:

This parameter is displayed in the display license verbose command output.

Used value
	

Actual used value.
NOTE:

This parameter is displayed in the display license verbose command output.

Description
	

Description of a control item.
display license esn
Function

The display license esn command displays the equipment serial number (ESN) used for applying a license.

This command takes effect only on the device that loads the license control item.
Format

display license esn
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

When you need to use licensed resource items or function items, apply for a license file. When applying for a license, you need to provide the device ESN.

ESN is the only identifier of device components, run the display license esn command to display the ESN of the current device, and then use the ESN to apply a license file for the device.

The ESN of the chassis must be the same as the ESN in the license to be activated. If they are different, the license file cannot be activated.
Example

# Display the ESN used for applying a license.

<HUAWEI> display license esn

ESN: 2102113090P0xxxxxxxx

Table 2-66 Description of the display license esn command output

Item
	

Description

ESN
	

ESN of the device.
display license information
Function

The display license information command displays license information about the master, standby, and slave switches in a stack system.

This command takes effect only on the device that loads the license control item.
Format

display license information
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

    If the control items of the license files on the standby/slave and master switches are the same, the standby/slave switch uses its own license file and does not synchronize the license file of the master switch. You can run the display license command to check the license control items. An active/standby switchover has no impact on the license files loaded on the master, standby, and slave switches.
    If the control items of the license files on the standby/slave and master switches are different, the standby/slave switch synchronizes the license file of the master switch. The ESN in the synchronized license file will differ from the standby/slave switch's ESN. If so, the license changes to the Trial state and enters the trial period. After an active/standby switchover, the license on the new master switch enters the trial period. You can run the display license information command on the master switch to check whether the switch's ESN is the same as the ESN in the license file.

Precautions

The display license command displays license information about the master switch only, whereas the display license information command displays license information about the master, standby, and slave switches in the stack system.

If a switch is not in a stack system, the display license information command displays license information about the switch only. If a stack system contains the master, standby, and slave switches, the display license information command displays license information about the master, standby, and slave switches.

Follow-up Procedure

If the ESN of the standby/slave switch differs from the ESN in the synchronized license file, the license enters the trial period. Apply for a new license file before the trial period expires according to the following process.

    Run the license revoke command on the master switch to obtain the revocation code of the license file on the switch.
    Run the display esn command on the master switch to collect ESNs of the master, standby, and slave switches.
    Log in to the license application website, and use the revocation code and ESNs of the master, standby, and slave switches to apply for a new license file for the stack system.
    Run the license active license-name command on the master switch to activate the new license file.

Example

# Display license information about the master, standby, and slave switches in a stack system.

<HUAWEI> display license information

Slot 0:
Current license file           : flash:/s5720-hi_slot0_full.datSynchronize from master board  : NO
Current license file esn       : 210235859810ECxxxxxxxx
Current slot esn               : 210235859810ECxxxxxxxx
License esn match with device  : YES

Slot 1:
Current license file           : flash:/s5720-hi_slot2_full.dat
Synchronize from master board  : YES
Current license file esn       : 210235859810xxxxxxxx
Current slot esn               : 210235859810xxxxxxxx
License esn match with device  : NO

Slot 2:
Current license file           : flash:/s5720-hi_slot2_full.dat
Synchronize from master board  : YES
Current license file esn       : 210235859810xxxxxxxx
Current slot esn               : 210235859810xxxxxxxx
License esn match with device  : YES

Table 2-67 Description of the display license information command output

Item
	

Description

Slot
	

Slot ID.

Current license file
	

Current license file.

Synchronize from master board
	

Whether the license file is synchronized from the master switch.

For the master switch, the value is YES.

Current license file esn
	

ESN in the current license file.

Current slot esn
	

ESN of the switch.

License esn match with device
	

Whether the ESN in the license file matches the switch's ESN.
display license resource usage
Function

The display license resource usage command displays the usage of the resource items defined in a license file.

This command takes effect only on the device that loads the license control item.
Format

display license resource usage
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

You can use the display license resource usage command to check the usage of the resource items defined in the license file, including the number of remaining licenses and the resource usage.

Resource usage refers to the percentage of resources used out of resources defined by the license file. For details about license control items, see License Control Items.
Example

# Display the usage of licensed resources.

<HUAWEI> display license resource usage

Info: Active License on master board: flash:/LICORTF163673-554BEF51E8.dat
 FeatureName    | ConfigureItemName       | ResourceUsage

 ES5FEA1           ES5SF4512K00                0/2
 ES5FEA1           ES5SF4128K00                0/6
 ES5FEA1           ES5SWL16AP00                0/64
 ES5FEA1           ES5SWL64AP00                0/16
 ES5FEA1           ES5SWL128AP0                0/8
 ES5FEA1           ES5SWL512AP0                0/2

Table 2-68 Description of the display license resource usage command output

Item
	

Description

Active License on master board
	

File name and path of an active license name.

FeatureName
	

Name of the feature controlled by the license.

ConfigureItemName
	

Name of a control item.

ResourceUsage
	

Percentage of used resources.
display license revoke-ticket
Function

The display license revoke-ticket command displays the revocation code of the current license file of the device.

This command takes effect only on the device that loads the license control item.
Format

display license revoke-ticket
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

The display license revoke-ticket command enables you to check the revocation code of a license file that has become invalid on the device. This code proves that the current license file is invalid and is used to apply for a new license.

Precautions

This command displays information only when the license file in current device system is invalid. Otherwise, no command output is displayed.
Example

# Display the revocation code of the current invalid license file.

<HUAWEI> display license revoke-ticket
 Info: The revoke ticket is: LIC20091103006100:27C1B773ED11D9F877855CDAEE74ABFE60E07126.

display license state
Function

The display license state command displays the license status on the device.

This command takes effect only on the device that loads the license control item.
Format

display license state
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

To check the status of the running license, run this command. The command displays the current status of the license and the number of days before the license in this status will expire.

The system supports the following license states:

    Normal: normal license
    Demo: demonstration license
    Trial: trial license that has expired but is still valid during the trial period
    Emergency: emergency license
    Default: default license

This command helps you locate license problems and verify the license status on the device.

Prerequisites

A license file has been stored on the main control board of the device and has been activated. This ensures that valid entries are displayed after the execution of the command. If the license file is not activated, no command output is displayed.
Example

# Display the status of the license on the device.

<HUAWEI> display license state

Info: Current license state is Trial. 60 days remain.

display module-information
Function

The display module-information command displays information about dynamically uploaded modules.
Format

display module-information [ verbose | next-startup ]
Parameters
Parameter 	Description 	Value

verbose
	

Displays detailed information about dynamically uploaded modules.
	

-

next-startup
	

Displays information about the module packages to be uploaded at the next startup.
	

-
Views

All views
Default Level

3: Management level
Usage Guidelines

After modules are uploaded, you can run the display module-information command to check information about these modules.
Example

# Display information about dynamically uploaded modules.

<HUAWEI> display module-information

                           Module Information
------------------------------------------------------------------------
Module     Version   InstallTime                     PackageName
------------------------------------------------------------------------
MACSEC     SPH       2011-01-16 16:39:18+00:00       s5720hi.mod

Total = 1

# Display detailed information about dynamically uploaded modules.

<HUAWEI> display module-information verbose

                           Module Information
------------------------------------------------------------------------
Module     Version   InstallTime                     PackageName
------------------------------------------------------------------------
MACSEC     SPH       2011-01-16 16:39:18+00:00       s5720hi.mod

Total = 1
Board Info:

------------------------------------------------------------------------
Slot       Module         State     Count Time(YYYY-MM-DD HH:MM:SS)
------------------------------------------------------------------------
0          MACSEC         Using     1     2011-01-16 16:39:17+00:00

Total = 1

Table 2-69 Description of the display module-information command output

Item
	

Description

Module Information
	

Module information.

Module
	

Name of a dynamically uploaded module.

Version
	

Module package version.

PackageName
	

Module package name.

InstallTime
	

Time when the module package was uploaded to the memory.

Total
	

The Total field under Module Information displays the number of module packages that take effect. The Total field under Board Info displays the number of boards that have modules installed.

Board Info
	

Board information.

Slot
	

Slot ID of the board where a module resides.

State
	

Status of the module.

Count
	

Number of modules that take effect on the board.

Time(YYYY-MM-DD HH:MM:SS)
	

Time when the module took effect, that is, time when the current module was loaded to the current state.

# Display information about the next startup modules configured in the system.

<HUAWEI> display module-information next-startup
Info: The result will be shown in several minutes. Please wait for a moment......

                      Next startup module packages
Total = 1
------------------------------------------------------------------------
No.  PackageName
------------------------------------------------------------------------
1    flash:/$_install_mod/s5720hi.mod

Table 2-70 Description of the display module-information next-startup command output

Item
	

Description

Next startup module packages
	

Information about module packages to be installed at the next startup.

Total
	

Number of module packages to be installed at the next startup.

No.
	

Sequence number of a module package to be installed at the next startup.

PackageName
	

Name of a module package to be installed at the next startup.
display paf
Function

The display paf command displays information about the product adaptive file (PAF) in the system.
Format

display paf { all | { resource | service } item-name }
Parameters

Parameter
	

Description
	

Value

all
	

Displays all information about the PAF file.
	

-

resource
	

Specifies the value set for a resource item in the PAF file.
	

-

service
	

Specifies the value set for a service item in the PAF file.
	

-

item-name
	

Specifies the name of a resource item or a service item.
	

The value is a string of 1 to 64 characters.
Views

All views
Default Level

3: Management level
Usage Guidelines

A PAF file provides only required resources and features. This command can display all the specification information about the PAF file.
Example

# Display the value set for a resource item in the PAF file.

<HUAWEI> display paf resource PAF_LCS_NQA_SPECS_NUM_ENTRY
 PAF_LCS_NQA_SPECS_NUM_ENTRY = 1, 32, 32, 0

# Display the value set for a service item in the PAF file.

<HUAWEI> display paf service PAF_LCS_IPV6_BASE_SPECS_ENABLED
 PAF_LCS_IPV6_BASE_SPECS_ENABLED = 1, 1

Table 2-71 Description of the display paf resource command output

Item
	

Description

PAF_LCS_NQA_SPECS_NUM_ENTRY
	

Resource item name in the PAF file.

1
	
Whether a resource item is controlled by a license.

    1: yes
    0: no

32
	

Default value of the resource item in the PAF file.

32
	

Maximum value of the resource item in the PAF file.

0
	

Minimum value of the resource item in the PAF file.
Table 2-72 Description of the display paf service command output

Item
	

Description

PAF_LCS_IPV6_BASE_SPECS_ENABLED
	

Service item name in the PAF file.

1
	
Whether a service item is controlled by a license.

    1: yes
    0: no

1
	
Service status.

    1: enabled
    0: disabled

display patch-information
Function

The display patch-information command displays information about the patch in the current system.
Format

display patch-information [ history ]
Parameters
Parameter 	Description 	Value

history
	

Displays historical information about the patch in the current system.
	

-
Views

All views
Default Level

3: Management level
Usage Guidelines

After a patch is loaded or deleted, run this command to view information about the patch, including its version, name, and status.
Example

# Display current information about the patch in the system.

<HUAWEI> display patch-information

Patch Package Name   :flash:/patch_pack.pat                              
Patch Package Version:V200R013SPH                                               
The state of the patch state file is: Running                                   
The current state is: Running                                                   
                                                                                
************************************************************************        
*           Information about hot patch errors is as follows:          *        
************************************************************************        
                                                                                
     Slot            CurrentVersion                                             
------------------------------------------------------------                    
                                                                                
No hot patch error occurs on any board.                                         
                                                                                
                                                                                
************************************************************************        
*                The hot patch information, as follows:                *        
************************************************************************        
                                                                                
 Slot       Type           State     Count Time(YYYY-MM-DD HH:MM:SS)            
------------------------------------------------------------------------        
 3          C              Running   1     2018-12-03 18:34:25+00:00            
 4          C              Running   1     2018-12-04 09:51:43+00:00            
                                                                                
                                                                                
************************************************************************        
*              The Kernel patch information, as follows:               *        
************************************************************************        
                                                                                
     Slot           Type           State          Count                         
------------------------------------------------------------                    
     3              Kernel         Running        1                             
     4              Kernel         Running        1                             
                                                                                
                                                                                
************************************************************************        
*              The firmware patch information, as follows:             *        
************************************************************************        
                                                                                
     Slot           Type           State          Count                         
------------------------------------------------------------                    
     4              BOOTLOAD       Running        1                             

# Display historical information about the patch in the system.

<HUAWEI> display patch-information history

************************************************************************        
*                The patch command history, as follows:                *        
************************************************************************        
                                                                                
 time(Y.M.D/HH:MM:SS)   state         size     patch-package name               
 -----------------------------------------------------------------------        
 2014.01.29/14:07:39  Startup       827318      patch_all_pack.pat       
 2014.10.13/11:33:12  Running         8404      patch_all_pack1.pat       
 2014.10.13/10:48:36     Idle       827318      patch_all_pack2.pat

Table 2-73 Description of the display patch-information command output

Item
	

Description

Patch Package Name
	

Name of the patch file.

Patch Package Version
	

Version of the patch.

The state of the patch state file is
	

Status of the patch file.

The current state is
	

Current status of the patch.

Slot
	

Slot ID.

Type
	

Patch type.

    C: single-core patch.

    BOOTLOAD, CPLD, BOOTROOM, KERNEL, DTB, OSPKG, RAMDISK, FPGA, MCU_POE, or SUBCARD_CPLD: indicates a firmware patch.
    SEFU: multi-core patch type.

    ENP: indicates an ENP patch. (Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S support this patch type.)

    Kernel: indicates a kernel patch. (Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S support this patch type.)

    BIN: indicates a process patch.

    C-WMP: multi-core WMP patch. (Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S support this patch type.)

    C-NAC: multi-core NAC patch. (Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S support this patch type.)

State
	

Running status of the patch.

    Deactive

    Active

    Running

    Idle: no patch in the system
    Startup: indicates the Startup state after the patch to be loaded at the next startup is set. If the next state change is recorded, the current Startup state is overwritten.

Count
	

Number of patch units.

For kernel patches, the number of kernel patches in Active and Running states is displayed.

Time(YYYY-MM-DD HH:MM:SS)
	

Time when the patch takes effect.

size
	

Size of the patch.
display rollback
Function

The display rollback { information | result } command displays rollback information in the system.
Format

display rollback { information | result }
Parameters

Parameter
	

Description
	

Value
information 	

Displays version information after the system is rolled back.
	

-
result 	

Checks whether the rollback is successful.
	

-
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

If an error occurs during an upgrade and you need to cancel the upgrade, run the rollback command to roll back the system to the previous version.

    Before performing a rollback, you can run the display rollback information command to preview the version status after the rollback, including the system software, configuration file, and patch file used after the rollback, as well as the remaining time for the rollback function to take effect.
    After completing the rollback, you can run the display rollback result command to check whether the rollback is successful.

Example

# Display rollback information in the system.

<HUAWEI> display rollback information
--------------------------------------------------------------------
MainBoard:
 Software package:        flash:/basicsoft.cc
 Configuration file:      flash:/vrpcfg201506011523.zip
 Patch file:              NULL
 Rollback remain time:    00:16:49
--------------------------------------------------------------------

Table 2-74 Description of the display rollback information command output

Item
	

Description

Software package
	

System software used after the rollback.

Configuration file
	

Configuration file used after the rollback.
This configuration file is the backup configuration file automatically generated by the system after the upgrade. The file name is in the format of filenameYYYYMMDDhhmm.zip.

    filename: indicates the name of the configuration file before the upgrade.
    YYYY: indicates the year.
    MM: indicates the month.
    DD: indicates the day.
    hh: indicates the hour.
    mm: indicates the minute.

If the file name is too long, the system automatically shortens the file name length to the required length.

Patch file
	

Patch file used after the rollback.

Rollback remain time
	

Remaining time for the rollback function to take effect.

# Check whether the rollback is successful after the rollback is complete.

<HUAWEI> display rollback result
Rollback result: Success.

Table 2-75 Description of the display rollback result command output

Item
	

Description

Rollback result
	

Rollback result:

    Success: The rollback is successful.

    Fail: The rollback fails.
    If the rollback fails, the system displays specific rollback failure information:
        Software rollback fail: The system software fails to be rolled back.
        Configuration rollback fail: The configuration file fails to be rolled back.
        Patch rollback fail: The patch file fails to be rolled back.

display virtual license
Function

The display virtual license command displays information about the virtual license file in the current system.
Format

display virtual license [ slot slot-id ]
Parameters

Parameter
	

Description
	

Value

slot slot-id
	

    Specifies the slot ID if stacking is not configured.
    Specifies the stack ID if stacking is configured.

	

The value must be set according to the device configuration.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

The controller delivers a virtual license to perform management. You do not need to load the entity license for the switch. This facilitates the management and control of the functions related to the entity license.

You can run this command to check detailed information about the virtual license file in the current system, including the name of the virtual control item, status of the virtual license, and expiration date of the virtual license.
Example
# Display information about the virtual license file on the device.

<HUAWEI> display virtual license

                                                                                
Slot 0                                                                         
------------------------------------------------------------------------------- 
Item       Resource  License     Expired     Trial days  Item                   
Name       Value     Status      Date        Total       Description            
------------------------------------------------------------------------------- 
VXLAN      1         Demo        2019-08-16  -           VXLAN Control Function 

Table 2-76 Description of the display virtual license command output

Item
	

Description

Slot
	

    Specifies the slot ID if stacking is not configured.
    Specifies the stack ID if stacking is configured.

Item Name
	

Name of a control item in the virtual license.

VXLAN: Control over the enhanced VXLAN functions. The enhanced VXLAN functions include the distributed VXLAN gateway function and the BGP EVPN function.
NOTE:

The license does not control route exchange between devices, but controls the status of the dynamic VXLAN tunnel established using BGP EVPN. If no license is loaded or the license becomes invalid, the dynamic VXLAN tunnel cannot be established using BGP EVPN.

Resource Value
	

Resource value of the control item.

License Status
	

Status of the virtual license.

    Default: By default, no virtual license is installed on a device and the dynamic VXLAN tunnel is in Down status.
    Normal: The commercial virtual license is activated. The device status is changed to Normal after the controller delivers a commercial virtual license to the device. The status can be restored to Default only through online retrieving.
    Demo: The temporary virtual license is activated. The device status is changed to Demo after the controller delivers a temporary virtual license to the device. The status can be restored to Default through online retrieving, and trial keepalive.
    Trial: The license is in keepalive status, indicating that the device status is automatically changed to trial keepalive after the validity period for the device in Demo status expires. The keepalive period is 90 days. After the keepalive period expires, the status is restored to Default and the dynamic VXLAN tunnel is in Down status.

Expired Date
	

Expiration date of the virtual license.

Trial days Total
	

Total trial period of the virtual license.

Item Description
	

Description of a control item in the virtual license.
install-module
Function

The install-module command installs module packages.

By default, no module package is installed.
Format

install-module file-name [ next-startup ]
Parameters
Parameter 	Description 	Value

file-name
	

Specifies the name of a module package to be installed.

file-name supports file name association. The related file can be associated and displayed after you enter a specified character string.
	

The value is a string of 5 to 64 case-insensitive characters without spaces.

next-startup
	

Specifies the name of the module package to be installed during next startup.
	

-
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Software upgrade is a common method to add new services on a network. This method, however, is complex and affects services. To solve these problems, you can run the install-module command to install the module package of a desired function, without upgrading or powering off your device.

    Run the install-module file-name command to load a module in the module package to the device. The module directly takes effect after being loaded. If the device is in a stack, the module is loaded to all the devices in the stack, including the master, standby, and slave switches.
    Run the install-module file-name next-startup command to add the module package to the next startup module list. The device automatically loads the module next time it starts. Before a module package is installed dynamically, the system checks the module package validity. In the next startup module list, one module can exist in only one module package.

Precautions

    The file name extension of the module package must be .MOD, and the file must be saved in the directory $_install_mod on the device.
    The module package version must match the current system software version. Otherwise, the module package will fail to be installed.
    The system allows you to install up to 16 modules.

Example

# Load the module package s5720hi.mod.

<HUAWEI> install-module s5720hi.mod
Info: Installing the module flash:/$_install_mod/s5720hi.mod..
.
Info: Succeeded in installing the module on the master board....

# Configure the module package to be loaded during next startup.

<HUAWEI> install-module s5720hi.mod next-startup
Info: The result will be shown in several minutes. Please wait for a moment.....
...
Info: Succeeded in setting the next-startup module.

license active
Function

The license active command activates the license file saved in the storage of the device.

This command takes effect only on the device that loads the license control item.
Format

license active file-name
Parameters

Parameter
	

Description
	

Value

file-name
	

Specifies the name of a license file.
file-name supports file name association. The disk where the file resides can be automatically associated.

    Full help: All the disks of the device can be associated and displayed.
    Partial help: The related disk and file can be associated and displayed after you enter a specified character string.

	

The value is a string of 5 to 64 characters without spaces.
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Change or upgrade the license file when the current license file is outdated or needs higher specifications and more features. The initial state of a license file is inactive and the license file does not take effect in the system. Run this command to activate the new or updated license file.

The license active command can be used to activate a license file in the following situations:

    The license needs to be activated for the first time.

    You can directly run this command to activate a license.

    The current license file needs to be updated.

    If the specifications of the new license file are lower than those of the current license file, the system displays a message asking you whether to continue. If you choose No, the system retains the current license file. If you choose Yes, the master switch activates the current license file and the system uses the new license file.

    If the configuration items of the new license file are lower than those of the current license file, check whether the configuration items required by services exist in the new license file. If not, apply for a correct license file and activate it. Otherwise, services may be interrupted due to lack of dependent license configuration items after the board or the device is restarted.

Prerequisites

The new license file has been uploaded to the device.

Follow-up Procedure

When the system restarts, the system activates the license file that was activated last time to ensure the license files are the same before and after restart.

Precautions

    The license file must use .dat as file name extension and be saved to the default root directory in the storage of the device.
    If no path is specified, the license file in the working path is activated by default.
    If the specifications of the new license file are lower than those of the current license file (some functions are authorized in the current license file, but not in the new license file, or the new license file allows fewer resources than the current one), the system displays a message asking you whether to continue.
    When the switch is stacked, if the ESN in the license file does not match the ESN of each stack member, activating the license file will prompt that the license file is abnormal. There is a risk that the license file will enter the grace period when the stack master changes.

Example

# Activate license.dat in the storage of the device.

<HUAWEI> license active license.dat

# Activate the license file license.dat in the storage of the stacked device.

<HUAWEI> license active license.dat
Verify license passed with minor errors:
    ESN is mismatched with node esn of slot 0.
    ESN is mismatched with node esn of slot 1.
Info: This operation maybe use the trial license instead of current licnese, may be reduce current resource or functions. Continue?[Y/N]:y
Warning: The ESN in board is different from that in the license file, Update the license file in time. Continue? [Y/N]y
Info: The license is being activated. Please wait for a moment.

license emergency
Function

The license emergency command enables the emergency state for the license.

This command takes effect only on the device that loads the license control item.
Format

license emergency
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

The system configuration is classified into maximum configuration, authorized configuration, and minimum configuration.

    In maximum configuration, the maximum number of resource items are configured. Function items are configured according to license configuration.
    Authorization configuration means the functions and resources of the software configured on the basis of contract or special authorization. Authorized configuration depends on feature authorization of license files.
    The minimum configuration is the default configuration when no activated license file exists in the system. The minimum configuration varies according to products.

Configurations are classified to limit the bearer capability of the system in different running status.

When you run the license emergency command to enable the emergency state for the license, the system is free from license control. In this case, the system can run with the maximum configuration of resources and the license-defined configuration of functions. When the validity period of the emergency state expires, resources are controlled by the license again. One version is provided with three validity periods of emergency state, each lasting for seven days.

The purpose for enabling the emergency state for the GTL license is disaster tolerance. If an earthquake takes place, for example, this mechanism protects users' services from being affected.

Precautions

    After the license enters the Emergency state, only resource license control items are available in versions earlier than V200R021C00, and both function and resource license control items are available in V200R021C00 and later versions.
    The emergency state cannot be disabled manually.
    The emergency state can only be enabled three times for each license, and the license can keep in emergency state for 7 days each time.
    The next emergency state can be enabled only on the last day when the last emergency state expires.
    After the emergency state is enabled, the device provides maximum number of resource control items contained in the loaded license. The device does not provide resource control items that are not contained in the loaded license even through the emergency state is enabled.

Example

# Enable the license emergency state.

<HUAWEI> license emergency
Warning: This operation will cause LCS into the EMERGENCY state. Continue? [Y/N]:y
Info: Emergency started cannot be stopped.

virtual-license emergency
Function

The virtual-license emergency command enables the emergency state of the virtual license.
Format

virtual-license emergency
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

You can run the virtual-license emergency command to enable the emergency state of the virtual license. After the emergency state is enabled, the VXLAN and AP cloud license control items are not controlled by the virtual license. After the validity period of the emergency state expires, the VXLAN and AP cloud license control items are controlled by the license. A version provides three validity periods of the emergency state, each of which lasts for seven days.

Precautions

    The emergency state cannot be disabled manually.
    The emergency state can only be enabled three times for each license, and the license can keep in emergency state for seven days each time.

Example

# Enable the emergency state of the virtual license.

<HUAWEI> virtual-license emergency

license revoke
Function

The license revoke command revokes a license file.

This command takes effect only on the device that loads the license control item.
Format

license revoke
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

License is an authorization file. You can apply for, upgrade, or activate the license file to get corresponding user rights.

If new devices are deployed, you can purchase new licenses as needed to enable license-controlled features and functions on the devices. This reduces purchase costs. If the capacities of the existing devices need to be expanded, you can update the licenses used on the devices to enable more license-controlled features and functions.

You can upgrade a license file to:

    Add new features.
    Optimizes device performance.
    Fix bugs in the current version.

Before updating a license file, run the license revoke command to revoke the existing license. The system then returns a license revocation code. This code is the evidence for license invalidation and is used to apply for a new license.

A license revocation code is a character string generated after a license file becomes invalid. You can determine that a license file is invalid based on the corresponding revocation code.

Precautions

    When the existing license is going to expire, apply for a new license, upgrade, and activate the license. If the license has expired, the service modules are disabled and services are interrupted.

    After you run the license revoke command, the license file enters the Trial state and cannot be activated again regardless of how long the license file will expire.

Example

# Revoke the current license file.

<HUAWEI> license revoke
Warning: The license will enter the Trial state and will not be activated again.
 Continue?[Y/N]: y

license verify
Function

The license verify command verifies the license file of the device.

This command takes effect only on the device that loads the license control item.
Format

license verify file-name
Parameters
Parameter 	Description 	Value
file-name 	Specifies the name of a license file.
file-name supports file name association. The disk where the file resides can be automatically associated.

    Full help: All the disks of the device can be associated and displayed.
    Partial help: The related disk and file can be associated and displayed after you enter a specified character string.

	The value is a string of characters without spaces.
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Before running the license active command to activate a license file, verify the license file.
The result of the license verify command can be the following:

    Major error

    The license file cannot be activated.

    Minor error

    The license file may be unable to be activated.

    Success

    The license file can be activated.

Prerequisites

The license file has been saved on the device.
Example
# Verify the license file license.dat.

<HUAWEI> license verify license.dat
Info: Verify license succeeded.

patch active all
Function

The patch active all command activates the patches on the current system.

By default, the loaded patches on the current system are inactive.
Format

patch active all
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

If you do not specify the active or run keyword when running the patch load command, run the patch active all command to activate all the loaded patches to make them effect.

Prerequisites

Patches have been loaded using the patch load command.

Configuration Impact

    After a non-incremental patch is loaded and the patch active all command is run, the patches in the current system are activated.

    If an incremental patch is loaded and the previous patch package is running, the previous patch package is still in running state after you run the patch active all command. The new patch package is activated.

Follow-up Procedure

After running the patch active all command, use the patch run all command to run the activated patch.

Precautions
After you run the patch active all command:

    If the device is restarted, all the active patches become inactive. To reactivate the patches, run the patch active all command.

To make the patches become active, run the patch active all command again.

The active state can prevent a patch error from causing continuous faults of the system. If a patch has a bug and the patch is in the active state, restart the device to prevent the patch from taking effect.
Example

# Activate all patches.

<HUAWEI> patch active all

patch configuration-synchronize
Function

The patch configuration-synchronize command synchronizes the patch configuration and patch file of the master switch to other member switches in a stack.
Format

patch configuration-synchronize
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

After you replace or add a member switch in a stack and start the new member switch, run this command to synchronize the patch configuration and patch file from the master switch if the patch file of the new member switch is incorrect.
Example

# Run the following commands on the new member switch to synchronize the patch configurations and patch files to the new member switch.

<HUAWEI> patch configuration-synchronize
Info: Finished synchronizing the patch package file and the patch configuration.

patch deactive all
Function

The patch deactive all command deactivates the patches on the current system.
Format

patch deactive all
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

This command does not take effect in the current version. During the operation, if a bug is detected in a patch and the system software problem cannot be solved, run the patch delete all command to delete the patches in the patch area in the memory.
Example

# Deactivate patches on the current system.

<HUAWEI> patch deactive all
Warning: This function is no longer supported in the current version.

patch delete all
Function

The patch delete all command deletes patches on the current system.
Format

patch delete all
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

    If you find errors in patches that have been loaded to the system, run this command to delete the patches to prevent patch errors from affecting system operating.
    Before loading a non-incremental patch, run this command to delete the existing patches (if any). Otherwise, the non-incremental patch cannot be loaded.
    After the patch is deleted, it is recommended that you restart the switch.

Example

# Delete all patches.

<HUAWEI> patch delete all
Warning: The device needs to restart after the patch is deleted.
This will delete the patch. Are you sure? [Y/N]

patch load
Function

The patch load command loads the patches to the patch areas in the system.
Format

patch load filename all [ active | run ]
Parameters

Parameter
	

Description
	

Value

filename
	

Specifies the path and file name of a patch package. The path can be an absolute path or a relative path.
file-name supports file name association. The disk where the file resides can be automatically associated.

    Full help: All the disks of the device can be associated and displayed.
    Partial help: The related disk and file can be associated and displayed after you enter a specified character string.

	

The value is a string of 5 to 64 case-insensitive characters without spaces. The file name must have an extension of .pat.

all
	

Loads the patches of all member switches in a stack.
	

-

active
	

Activates loaded patches.
	

-

run
	

Runs loaded patches.
	

-
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario
When you load a patch to the current system, the system searches the patch package for a matching patch file according to the attributes of the patch file.

    If a matching patch file is found in the patch package, the system loads the patch.
    If no matching patch file is found in the patch package, the system does not load any patch.

Prerequisites

The patch package has been uploaded to the root directory of the storage device.

Before loading a patch, the system must resolve the patch package, check the validity of the patch files in the patch package, and obtain the attributes such as the patch type and version of the patch file.

Precautions

The patch file cannot be reloaded. When you reload a patch, the system displays an error message.
After this command is run, the system loads all types of patches in the patch package.

    If the active parameter is specified, the system activates the loaded patches directly. Then you can use the patch run all command to run the patches.
    If the run parameter is specified, the system runs the loaded patches directly.

Example

# Load the patches to the patch area of the device and run the patches directly.

<HUAWEI> patch load patch.pat all run

patch run all
Function

The patch run all command runs the patches on the current system.
Format

patch run all
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

When the device is restarted, the active patches become deactivated and need to be activated again. To enable the active patches to retain in running start after a device restart, use this command to run these active patches.

Prerequisites

Patches have been loaded and activated on the system.

Configuration Impact

After you run this command to run patches on the current system, the patches remain in the running state if a device restart occurs.

After the patch run all command is run, the patches enter running state and cannot be restored to the previous state. Confirm the action before you run the command.
Example

# Run active patches on the current system.

<HUAWEI> patch run all

reset patch-configure
Function

The reset patch-configure command deletes the configuration of the patch file for next startup.
Format

reset patch-configure [ next-startup ]
Parameters
Parameter 	Description 	Value
next-startup 	Deletes the configuration of the patch file for next startup. 	-
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

After you run the startup patch command to specify the patch file for next startup, you can use the reset patch-configure command to delete the configuration.

Precautions

If you run the reset patch-configure command, the patch file for next startup is empty. When the device restarts, the system does not load and run the patch file.
Example

# Delete the configuration of the patch file for next startup.

<HUAWEI> reset patch-configure next-startup

Info: The result will be shown in several minutes. Please wait for a moment.....
...                                                                             
Info: Succeeded in resetting the next-startup patch state. 

rollback
Function

The rollback command rolls back the system to the previous version.
Format

rollback
Parameters

None
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

If an error occurs during an upgrade and you need to cancel the upgrade, run the rollback command to roll back the system to the previous version. After the rollback, the configuration of the device is the same as the previous configuration.

Precautions

    The rollback function takes effect only for an upgrade during which the reboot command is run to restart the device, and does not support other upgrade modes, such as the EasyDeploy upgrade and smooth stack upgrade. If the reboot command is run to complete an upgrade and then the system is upgraded using another mode, you can only run the rollback command to roll back the system to the latest version before the upgrade during which the reboot command is run. For example, if you run the reboot command to restart the device and upgrade the system from V1.0 to V1.1, and then upgrade the system to V1.2 using EasyDeploy, the system can only be rolled back to V1.0 when you run the rollback command to perform a system rollback.

    If a device runs continuously for more than 48 hours after being upgraded, the rollback function does not take effect. If the device runs continuously for less than 48 hours and restarts, the system sets the remaining time to zero and the rollback function does not take effect. You can run the display rollback information command to check the remaining time for the rollback function to take effect.

    If the system software, configuration file, or patch file required in the rollback is deleted using the delete (user view) command, the system prompts that the rollback function cannot be used when you run the rollback command.

If you run the rollback command to roll back the system software, the current configuration of the device will be lost. Therefore, exercise caution when deciding to run this command.

Prerequisites

The device contains the system software, configuration file, and patch file that are used after the rollback and displayed in the display rollback information command output.
Example

# Roll back the system to the previous version.

<HUAWEI> rollback
Info: Checking rollback version information...
Rollback software: flash:/basicsoft.cc
Rollback configuration: flash:/vrpcfg.zip
Rollback patch: NULL
Warning: The version running before the last reboot/reboot fast operation is performed will be restored, and the current configuration will be lost. Continue? [Y/N]:y

uninstall-module
Function

The uninstall-module command uninstalls module packages.
Format

uninstall-module file-name [ next-startup ]

uninstall-module next-startup all
Parameters
Parameter 	Description 	Value

file-name
	

Specifies the name of a module package to be uninstalled.
	

The value is a string of 5 to 64 case-insensitive characters without spaces.

next-startup
	

Clears the module list for next startup.
	

-

all
	

Clears the module list for next startup.
	

-
Views

User view
Default Level

3: Management level
Usage Guidelines

If some services or functions are not required, run the uninstall-module command to uninstall the corresponding modules running in the system.
Example

# Uninstall the module package s5720hi.mod from the system.

<HUAWEI> uninstall-module s5720hi.mod
This will uninstall the module. Are you sure? [Y/N]y....
Info: Succeeded in uninstalling the module on the master board.

# Clear a specified module package in the next startup module list.

<HUAWEI> uninstall-module s5720hi.mod next-startup
Info: The result will be shown in several minutes. Please wait for a moment.....
...
Info: Succeeded in resetting the next-startup module.

