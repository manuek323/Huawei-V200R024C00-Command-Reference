Stack Configuration Commands

    Command Support
    display mad
    display stack
    display stack peers
    display stack port
    display stack port auto-cable-info
    display stack port speed
    display stack-port load-balance
    display stack configuration
    display stack channel
    display upgrade area
    display upgrade state
    interface stack-port
    mad backup ip address
    mad detect mode direct
    mad detect mode relay
    mad domain
    mad exclude
    mad relay
    mad relay legacy enable
    mad restore
    port interface enable
    reset stack configuration
    reset stack port statistics
    save stack configuration
    set l2-traffic fast-recover
    shutdown interface
    stack authentication
    stack led enable
    stack-port load-balance mode
    stack port speed
    stack port { crc | link-flap } trigger
    stack port { crc | link-flap } trigger error-down
    stack reserved-vlan
    stack slot priority
    stack slot renumber
    stack timer mac-address switch-delay
    upgrade backup-area slot
    upgrade start

Command Support
Table 3-48 Applicable product models and versions

Product
	

Software Version
	

Stack Connection Mode
	

Product Model

S200
	

Not supported
	

-
	

All S200 switches do not support stacking.

S300
	

V200R020C10, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S300 switches support stacking.

S300
	

V200R020C10, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S500 switches support stacking.

S1720 and S1730
	

Not supported
	

-
	

All S1720 and S1730 switches do not support stacking.

S2700-SI
	

Not supported
	

-
	

All S2700-SI switches do not support stacking.

S2710-SI
	

V100R006(C03&C05)
	

Service port connection using ordinary cables
	

All S2710-SI switches support stacking.

S2700-EI
	

V100R005C01, V100R006(C00&C01&C03&C05)
	

Service port connection using ordinary cables
	

S2700-9TP-EI-AC, S2700-9TP-EI-DC, S2700-9TP-PWR-EI, S2700-18TP-EI-AC, S2700-26TP-EI-AC, S2700-26TP-EI-DC, and S2700-26TP-PWR-EI do not support stacking, whereas other models support.

S2720-EI
	

Versions supporting service port connection using ordinary cables:

V200R006C10, V200R009C00, V200R010C00, V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00

Versions supporting service port connection using dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00
	

Service port connections using ordinary and dedicated cables
	

All S2720-EI switches support stacking.

S2730S-S
	

Versions supporting service port connection using ordinary cables:

V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S2730S-S switches support stacking.

S2750-EI
	

Versions supporting service port connection using ordinary cables:

V200R003C00, V200R005C00SPC300, V200R006C00, V200R007C00, V200R008C00, V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00

Versions supporting service port connection using dedicated cables:

V200R011C10 and V200R012C00
	

Service port connections using ordinary and dedicated cables
	

All S2750-EI switches support stacking.

S3700-SI
	

V100R005C01, V100R006(C00&C01&C03&C05)
	

Service port connection using ordinary cables
	

All S3700-SI switches support stacking.

S3700-EI
	

V100R005C01, V100R006(C00&C01&C03&C05)
	

Service port connection using ordinary cables
	

All S3700-EI switches support stacking.

S3700-HI
	

Not supported
	

-
	

All S3700-HI switches do not support stacking.

S5700-EI
	

V100R005C01, V100R006(C00&C01), V200R001(C00&C01), V200R002C00, V200R003C00, V200R005(C00&C01&C02&C03)
	

Stack card connection
	

All S5700-EI switches support stacking.

S5700-SI
	

V100R005C01, V100R006C00, V200R001C00, V200R002C00, V200R003C00, V200R005C00
	

Stack card connection
	

S5700-26X-SI-12S-AC does not support stacking, whereas other models support.

S5700-HI
	

V200R003C00, V200R005C00
	

Service port connection using ordinary cables
	

All S5700-HI switches support stacking.

S5700-LI
	

Versions supporting service port connection using ordinary cables:

V200R001C00, V200R002C00, V200R003(C00&C02&C10), V200R005C00SPC300, V200R006C00, V200R007C00, V200R008C00, V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00

Versions supporting service port connection using dedicated cables:

V200R011C10 and V200R012C00
	

Service port connections using ordinary and dedicated cables
	

S5700-10P-LI-AC, S5700-10P-PWR-LI-AC, S5700-28P-LI-BAT, and S5700-28P-LI-24S-BAT do not support stacking, whereas other models support.

S5700S-LI
	

Versions supporting service port connection using ordinary cables:

V200R008C00, V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00

Versions supporting service port connection using dedicated cables:

V200R011C10 and V200R012C00
	

Service port connections using ordinary and dedicated cables
	

S5700S-28P-LI-AC and S5700S-52P-LI-AC do not support stacking, whereas other models support.

S5710-EI
	

V200R001C00, V200R002C00, V200R003C00, V200R005(C00&C02)
	

Service port connection using ordinary cables
	

All S5710-EI switches support stacking.

S5710-HI
	

V200R005C03
	

Service port connection using ordinary cables
	

All S5710-HI switches support stacking.

S5710-C-LI
	

V200R001C00
	

Stack card connection
	

All S5710-C-LI switches support stacking.

S5710-X-LI
	

Versions supporting service port connection using ordinary cables:

V200R008C00, V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00

Versions supporting service port connection using dedicated cables:

V200R011C10 and V200R012C00
	

Service port connections using ordinary and dedicated cables
	

All S5710-X-LI switches support stacking.

S5720-LI and S5720S-LI
	

Versions supporting service port connection using ordinary cables:

V200R010C00, V200R011C00, V200R011C10, V200R012(C00&C20), V200R013C00, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00

Versions supporting service port connection using dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S5720-LI and S5720S-LI switches support stacking.

S5720-SI and S5720S-SI
	

Versions supporting service port connection using ordinary cables:

V200R008C00, V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10

Versions supporting service port connection using dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables
	

All S5720-SI and S5720S-SI switches support stacking.

S5720I-SI
	

V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables
	

S5720I-6X-PWH-SI-AC and S5720I-10X-PWH-SI-AC do not support stacking, whereas other models support.

S5720-EI
	

V200R007C00, V200R008C00, V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connection using ordinary cables: S5720-C-EI, S5720-PC-EI

Stack card connection: S5720-P-EI, S5720-C-EI, S5720-X-EI, S5720-PC-EI
When using the stack card connection mode, note the following:

    S5720-C-EI and S5720-PC-EI series switches use dedicated stack cards to set up stacks.
    S5720-X-EI and S5720-P-EI series switches use stack ports fixed on cards to set up stacks.

	

All S5720-EI switches support stacking.

S5720-HI
	

Versions supporting service port connection using ordinary cables:

V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10

Versions supporting service port connection using dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables
	

All S5720-HI switches support stacking.

S5730-HI
	

V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables
	

All S5730-HI switches support stacking.

S5731-H
	

V200R013C02, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S5731-H switches support stacking.

S5731S-H
	

V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S5731S-H switches support stacking.

S5731-L and

S5731S-L
	

Not supported
	

-
	

All S5731-L and S5731S-L switches do not support stacking.

S5731-S and S5731S-S
	

V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S5731-S and S5731S-S switches support stacking.

S5732-H
	

Versions supporting service port connection using ordinary cables:

V200R019C00, V200R019C10, V200R019C20, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00

Versions supporting service port connection using dedicated cables:

V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S5732-H switches support stacking.

S5730-SI
	

Versions supporting service port connection using ordinary cables and dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10

Versions supporting stack card connection:

V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables, and stack card connection
	

All S5730-SI switches support stacking.

S5730S-EI
	

Versions supporting service port connection using ordinary cables and dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10

Versions supporting stack card connection:

V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables, and stack card connection
	

All S5730S-EI switches support stacking.

S5735-L
	

V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S5735-L switches support stacking.

S5735S-L and S5735S-L-M
	

V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00
	

Service port connections using ordinary and dedicated cables
	

All S5735S-L and S5735S-L-M switches support stacking.

S5735-L-I
	

V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S5735-L-I switches support stacking.

S5735-L1 and S5735S-L1
	

V200R020C10, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

S5735-L8T4S-A1(98011284-001), S5735-L8P4S-A1(98011295-001), S5735-L24T4S-A1(98011306-001), and S5735-L24P4S-A1(98011321-001) do not support stacking, whereas other models support.

S5735-S
	

V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S5735-S switches support stacking.

S5735S-S
	

V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00
	

Service port connections using ordinary and dedicated cables
	

All S5735S-S switches support stacking.

S5735-S-I
	

V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

Only the S5735-S24T4X-I switch supports stacking.

S5735S-H
	

V200R020C00, V200R020C10, V200R020C30, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connection using ordinary cables
	

All S5735S-H switches support stacking.

S5736-S
	

V200R020C00, V200R020C10, V200R020C30, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connection using ordinary cables
	

All S5736-S switches support stacking.

S5751-L
	

Not supported
	

-
	

All S5751-L switches do not support stacking.

S6700-EI
	

V100R006C00, V200R001(C00&C01), V200R002C00, V200R003C00, V200R005(C00&C01&C02)
	

Service port connection using ordinary cables
	

All S6700-EI switches support stacking.

S6720-EI
	

Versions supporting service port connection using ordinary cables:

V200R008C00, V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00

Versions supporting service port connection using dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00
	

Service port connections using ordinary and dedicated cables
	

All S6720-EI switches support stacking.

S6720-HI
	

V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables
	

All S6720-HI switches support stacking.

S6720S-EI
	

Versions supporting service port connection using ordinary cables:

V200R009C00, V200R010C00, V200R011C00, V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00

Versions supporting service port connection using dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00
	

Service port connections using ordinary and dedicated cables
	

All S6720S-EI switches support stacking.

S6720S-S
	

V200R020C00, V200R020C10, V200R020C30, V200R021C00, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connection using ordinary cables
	

All S6720S-S switches support stacking.

S6720-SI and S6720S-SI
	

Versions supporting service port connection using ordinary cables:

V200R011C00, V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10

Versions supporting service port connection using dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables
	

All S6720-SI and S6720S-SI switches support stacking.

S6720-LI and S6720S-LI
	

Versions supporting service port connection using ordinary cables:

V200R011C00, V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10

Versions supporting service port connection using dedicated cables:

V200R011C10, V200R012C00, V200R013C00, V200R019C00, V200R019C10
	

Service port connections using ordinary and dedicated cables
	

All S6720-LI and S6720S-LI switches support stacking.

S6730-H
	

V200R013C02, V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S6730-H switches support stacking.

S6730S-H
	

V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S6730S-H switches support stacking.

S6730-S and S6730S-S
	

V200R019C00, V200R019C10, V200R020C00, V200R020C10, V200R021C00, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S6730-S and S6730S-S switches support stacking.

S6735-S
	

V200R021C00SPC600, V200R021C01, V200R021C10, V200R022C00, V200R022C10, V200R023C00, V200R023C10, V200R024C00
	

Service port connections using ordinary and dedicated cables
	

All S6735-S switches support stacking.
display mad
Function

The display mad command displays the multi-active detection (MAD) configuration.
Format

display mad [ proxy | verbose ]
Parameters
Parameter 	Description 	Value

proxy
	

Displays information about the proxy device.
	

-

verbose
	

Displays detailed MAD configuration.
	

-
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To check the MAD configuration, run the display mad command. If the verbose parameter is specified, detailed MAD configuration is displayed, including MAD-enabled interfaces and interfaces excluded from shutdown.

When MAD in relay mode is configured, you can run the display mad proxy command on the proxy device to check its MAD configuration.
Example
# Display MAD configuration.

<HUAWEI> display mad
Current MAD domain: 0 
MAD direct detection enabled: YES                                       
MAD relay detection enabled: NO 

# Display detailed MAD configuration.

<HUAWEI> display mad verbose
Current MAD domain: 0 
Current MAD status: Detect                                                      
Mad direct detect interfaces configured:                                
 GigabitEthernet2/0/8
 GigabitEthernet2/0/9
Mad relay detect interfaces configured:                                 
Excluded ports(configurable):                                                   
 GigabitEthernet2/0/4
Excluded ports(can not be configured): 

# Display information about the specified proxy device.

<HUAWEI> display mad proxy
Mad relay interfaces configured:
 Eth-Trunk1 

Table 3-49 Description of the display mad command output

Item
	

Description

Current MAD domain
	

MAD domain configured in the system. To configure this parameter, run the mad domain command.

MAD direct detection enabled
	

MAD in direct mode is configured. To configure MAD in direct mode, run the mad detect mode direct command.

MAD relay detection enabled
	

MAD in relay mode is configured. To configure MAD in relay mode, run the mad detect mode relay command.

Current MAD status
	
Current MAD status:

    Detect: The stack is running properly.

    Recovery: The switch that fails master switch election in a MAD scenario enters the Recovery state and blocks all of its service ports except those excluded from shutdown.

Mad direct detect interfaces configured
	

Interface on which MAD in direct mode is configured. To configure MAD in direct mode on an interface, run the mad detect mode direct command.

Mad relay detect interfaces configured
	

Interface on which MAD in relay mode is configured. To configure MAD in relay mode on an interface, run the mad detect mode relay command.

Excluded ports(configurable)
	

Interfaces excluded from shutdown. To configure interfaces excluded from shutdown, run the mad exclude command.

Excluded ports(can not be configured)
	

Interfaces that are excluded from shutdown in the system by default.

Mad relay interfaces configured
	

Interface on which the relay function is configured. To configure the relay function on an interface, run the mad relay command.
display stack
Function

The display stack command displays information about the member switches in a stack.
Format

display stack
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To check stack information, including stack topology and stack member switches, run the display stack command.

This command can be used only after the stack function is enabled (default status).
Example

# Display stack information.

<HUAWEI> display stack
Stack mode: Service-port                                                      
Stack topology type: Link                                                       
Stack system MAC: xxxx-xxxx-xxxx                                                
MAC switch delay time: 10 min                                                    
Stack reserved VLAN: 4093                                                       
Slot of the active management port: 0
Slot    Role        MAC address       Priority   Device type
-------------------------------------------------------------
    0   Master      xxxx-xxxx-xxxx   200          S5735-L24P4S-A
    1   Standby     xxxx-xxxx-xxxx   150          S5735-L24P4S-A

Table 3-50 Description of the display stack command output

Item
	

Description

Stack mode
	

Stack connection mode supported by the switch:

    Service-port: Service port connection

    Card: Stack card connection

Stack topology type
	
Stack topology type:

    Link: chain topology

    Ring: ring topology

Stack system MAC
	

Stack system MAC address.

MAC switch delay time
	

Time after which the system MAC address of the stack is switched. To configure this parameter, run the stack timer mac-address switch-delay command.

Stack reserved VLAN
	

Stack reserved VLAN.

To configure this parameter, run the stack reserved-vlan command.

Active management slot
	
Slot ID of the effective management interface in the stack. If no member switch in the stack has a management interface or all the management interfaces are Down, this field displays --.
NOTE:

After a stack is set up, you can log in to the stack through any member switch's management interface or console interface. A stack can have only one effective management interface at a time.

Slot
	

Stack ID of the member switch.

Role
	
Member switch role:

    Master

    Standby

    Slave

MAC address
	

MAC address of the member switch.

Priority
	

Stack priority.

To configure this parameter, run the stack slot priority command.

Device Type
	

Device model of the member switch.
display stack peers
Function

The display stack peers command displays information about the neighbors of a member switch.
Format

display stack peers
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To check information about the neighbors of a member switch, run the display stack peers command.

This command can be used only after the stack function is enabled (default status).
Example

# Display information about the neighbors of a member switch.

<HUAWEI> display stack peers
(B): Block all
Slot      Port1                   Peer1       Port2                   Peer2     
---------------------------------------------------------------------------     
0         STACK 1                   1         STACK 2                 None      
1         STACK 1                 None        STACK 2                   0  

Table 3-51 Description of the display stack peers command output

Item
	

Description

(B): Block all
	

Indicates that the stack port is blocked.

Slot
	

Stack ID of a member switch.

Port1
	

Stack port 1.

Peer1
	

Stack ID of the switch to which stack port 1 connects. If this field displays ID(B), stack port 1 is blocked. If this field displays None, there is no peer device.

Port2
	

Stack port 2.

Peer2
	

Stack ID of the switch to which stack port 2 connects. If this field displays ID(B), stack port 2 is blocked. If this field displays None, there is no peer device.
display stack port
Function

The display stack port command displays information about stack ports.
Format

display stack port [ brief | slot slot-id ]
Parameters

Parameter
	

Description
	

Value

brief
	

Displays summary of stack ports.
	

-

slot slot-id
	

Displays configuration of stack ports on a specified switch. slot-id specifies the stack ID of a switch.
	

Set the value according to the device configuration.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

You can run the display stack port command to check summary and detailed information about stack ports.
Example
# Display summary of stack ports (service port connection).

<HUAWEI> display stack port brief
PHY     :Physical state                                                                                                             
Protocol:Stack link protocol state                                                                                                  
*down   :administratively down                                                                                                      
(r)     :Runts trigger error down                                                                                                   
(c)     :CRC trigger error down                                                                                                     
(l)     :Link-flapping trigger error down                                                                                           
(m)     :Media mismatch trigger error down                                                                                          
Stack Port               PHY    Protocol  InUti  OutUti    InErrors   OutErrors                                                     
-------------------------------------------------------------------------------
stack-port0/1            up     up        0.00%  0.00%     0          0
  XGigabitEthernet0/0/1  up     up        0.00%  0.00%     0          0
  XGigabitEthernet0/0/2  up     up        0.00%  0.00%     0          0
stack-port0/2            up     up        0.00%  0.00%     0          0
  XGigabitEthernet0/0/3  up     up        0.00%  0.00%     0          0
  XGigabitEthernet0/0/4  up     up        0.00%  0.00%     0          0

<HUAWEI> display stack port brief
PHY     :Physical state                                                                                                             
Protocol:Stack link protocol state                                                                                                  
*down   :administratively down                                                                                                      
(r)     :Runts trigger error down                                                                                                   
(c)     :CRC trigger error down                                                                                                     
(l)     :Link-flapping trigger error down                                                                                           
(m)     :Media mismatch trigger error down                                                                                          
Stack Port               PHY    Protocol  InUti  OutUti    InErrors   OutErrors                                                     
-------------------------------------------------------------------------------                                                     
stack-port0/1                                                                                                                       
  XGigabitEthernet0/0/1  down   down      0.00%   0.00%           0           0                                                     
unAllocated                                                                                                                         
  XGigabitEthernet0/0/2  down   --        0.00%   0.00%           0           0                                                     
  XGigabitEthernet0/0/3  down   --        0.00%   0.00%           0           0                                                     
  XGigabitEthernet0/0/4  down   --        0.00%   0.00%           0           0  

Table 3-52 Description of the display stack port brief command output

Item
	

Description

Stack Port
	

Number of a stack port.

unAllocated indicates that a service port has become a stack member port but has not been bound to a logical stack port.

PHY
	
Physical status of an interface:

    down: The interface is physically disabled.
    up: The interface is physically enabled.
    *down: The interface is manually shut down.
    down(r): Runts error continuously occurs on a stack port.
    down(c): There are CRC error packets on a stack port.
    down(l): A stack port repeatedly alternates between Up and Down states.
    down(m): The rate of the optical module installed in a stack member port is not the rate required by the member port.
    down(s): A self-loop occurs on a stack port.
    NOTE:

    Only the S5736-S, S5735-L, S5735-L-I, S5735-L1,S5735S-L1, S5735-S, S5735-S-I, S5735S-H, and S6720S-S support this status.

Protocol
	
Link layer protocol status of the interface:

    down: A stack port does not receive stack link packets.
    up: A stack port can receive stack link detection packets.

InUti
	

Average inbound bandwidth usage of an interface within the last 300 seconds.

OutUti
	

Average outbound bandwidth usage within the last 300 seconds.

InErrors
	

Number of error packets received by an interface.

OutErrors
	

Number of error packets sent by an interface.
# Display detailed information about stack ports (stack card connection).

<HUAWEI> display stack port
stack-port1/1:          
---------------------------------------------                                 
Current state : DOWN    
Speed : NA              
                        
Input:  0 packets, 0 bytes                                                    
  Unicast:                          0,  Multicast:                           0
  Broadcast:                        0,  Jumbo:                               0
  Discard:                          0,  Frames:                              0
                        
  Total Error:                      0                                         
  CRC:                              0,  Giants:                              0
  Jabbers:                          0,  Fragments:                           0
  Runts:                            0,  DropEvents:                          0
  Alignments:                       0,  Symbols:                             0
  Ignoreds:                         0                                         
                        
Output:  0 packets, 0 bytes                                                   
  Unicast:                          0,  Multicast:                           0
  Broadcast:                        0,  Jumbo:                               0
  Discard:                          0                                         
                        
  Total Error:                      0                                         
  Collisions:                       0,  ExcessiveCollisions:                 0
  Late Collisions:                  0,  Deferreds:                           0
  Buffers Purged:                   0                                         
                        
                        
stack-port1/2:          
---------------------------------------------                                 
Current state : DOWN    
Speed : NA              
                        
Input:  0 packets, 0 bytes                                                    
  Unicast:                          0,  Multicast:                           0
  Broadcast:                        0,  Jumbo:                               0
  Discard:                          0,  Frames:                              0
                        
  Total Error:                      0                                         
  CRC:                              0,  Giants:                              0
  Jabbers:                          0,  Fragments:                           0
  Runts:                            0,  DropEvents:                          0
  Alignments:                       0,  Symbols:                             0
  Ignoreds:                         0                                         
                        
Output:  0 packets, 0 bytes                                                   
  Unicast:                          0,  Multicast:                           0
  Broadcast:                        0,  Jumbo:                               0
  Discard:                          0                                         
                        
  Total Error:                      0                                         
  Collisions:                       0,  ExcessiveCollisions:                 0
  Late Collisions:                  0,  Deferreds:                           0
  Buffers Purged:                   0                                           

Table 3-53 Description of the display stack port command output (stack card connection)

Item
	

Description

stack-port1/1
	

Stack port 1 in slot 1.

Speed
	

Interface forwarding rate.

current state
	
Stack port status:

    DOWN: The stack port is disabled.
    UP: The stack port is enabled.

Input
	

Total number of packets received by the stack port.

Output
	

Total number of packets sent by the stack port.

Unicast
	

Number of unicast packets sent or received by the stack port.

Multicast
	

Number of multicast packets sent or received by the stack port.

Broadcast
	

Number of broadcast packets sent or received by the stack port.

Jumbo
	

Number of jumbo frames sent or received by the stack port.

Discard
	

Number of packets discarded by the stack port during physical layer detection.

Total Error
	

Total number of error packets found by the stack port during physical layer detection.

CRC
	

Number of CRC error packets received by the stack port.

Giants
	

Number of jumbo frames with correct FCS received by the stack port.

Jabbers
	

Number of jumbo frames with incorrect FCS received by the stack port.

Fragments
	

Number of undersized frames with incorrect FCS received by the stack port.

Runts
	

Number of undersized frames with correct FCS received by the stack port.

DropEvents
	

Number of received packets that are discarded because the GBP is full or there is back pressure.

Alignments
	

Number of frames with alignment errors received by the stack port.

Symbols
	

Number of coding error frames received by the stack port.

Ignoreds
	

Number of received MAC control frames whose OpCode is not PAUSE.

Frames
	

Number of packets with an incorrect 802.3 length received by the stack port.

Collisions
	

Number of packets that encountered 1 to 15 conflicts and sent by the stack port.

ExcessiveCollisions
	

Number of packets that encountered 16 conflicts and fail to be sent by the stack port.

Late Collisions
	

Number of packets sent by the stack port after a delay due to conflicts.

Deferreds
	

Number of packets sent by the stack port after a delay without any conflict.

Buffers Purged
	

Number of packets aged due to existence in the buffer for an extended time before being sent out by the stack port.
# Display detailed information about stack ports (service port connection).

<HUAWEI> display stack port
*down : administratively down                                                   
Logic Port         Phy Port                     Online       Status             
----------------------------------------------------------------------------    
stack-port0/1      XGigabitEthernet0/0/1        present      up                 
                   XGigabitEthernet0/0/2        present      down               
                   XGigabitEthernet0/0/4        present      down               
stack-port0/2      XGigabitEthernet0/0/3        present      up                 
stack-port3/1      XGigabitEthernet3/0/1        present      up                 
stack-port3/2      XGigabitEthernet3/0/3        present      up                 
stack-port4/1      XGigabitEthernet4/0/1        present      up                 
stack-port4/2      XGigabitEthernet4/0/3        present      up                 
stack-port8/1      XGigabitEthernet8/0/1        present      up                 
stack-port8/2      XGigabitEthernet8/0/3        present      up                 

Table 3-54 Description of the display stack port command output (service port connection)

Item
	

Description

Logic Port
	

Number of a stack port.

Phy Port
	

Type and number of a physical member port.

Online
	
Presence of a physical member port.

    present: The current installed service card type is consistent with that configured on the switch.
    absent: The current installed service card type is inconsistent with that configured on the switch.

Status
	
Physical status of an interface:

    down: The interface is physically disabled.
    up: The interface is physically enabled.
    *down: The interface is manually shut down.
    down(r): Runts error continuously occurs on a stack port.
    down(c): There are CRC error packets on a stack port.
    down(l): A stack port repeatedly alternates between Up and Down states.
    down(m): The rate of the optical module installed in a stack member port is not the rate required by the member port.
    down(s): A self-loop occurs on a stack port.
    NOTE:

    Only the S5736-S, S5735-L, S5735-L-I, S5735-L1,S5735S-L1, S5735-S, S5735-S-I, S5735S-H, and S6720S-S support this status.

display stack port auto-cable-info
Function

The display stack port auto-cable-info command displays information about dedicated stack cables.
Format

display stack port auto-cable-info slot slot-id
Parameters

Parameter
	

Description
	

Value

slot slot-id
	

Specifies the stack ID of a member switch.
	

The value range depends on the device.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

You can run the display stack port auto-cable-info command to check interfaces supporting dedicated stack cables and whether dedicated stack cables have been connected to interfaces.
Example

# Display information about dedicated stack cables on the switch with the slot ID 0.

<HUAWEI> display stack port auto-cable-info slot 0
Logic Port         Phy Port                     Cable-role                                                                          
----------------------------------------------------------                                                                          
stack-port0/1      XGigabitEthernet0/0/1        Slave                                                                               
stack-port0/1      XGigabitEthernet0/0/2        --                                                                                  
stack-port0/2      XGigabitEthernet0/0/3        --                                                                                  
stack-port0/2      XGigabitEthernet0/0/4        Master           

Table 3-55 Description of the display stack port auto-cable-info command output

Item
	

Description

Logic Port
	

Logical stack port.

Phy Port
	

Physical member port.

Cable-role
	
Role of a dedicated stack cable:

    Master: The installed dedicated stack cable is the master end.
    Slave: The installed dedicated stack cable is the slave end.
    --: No dedicated stack cable is connected to the current port.

display stack port speed
Function

The display stack port speed command displays the stack port working speed.

Only the S5720-X-LI, S5720I-SI, S5732-H, and S5720S-X-LI support this command.

The S5720-P-LI does not support this command before the license is loaded and supports this command after the license is loaded and it restarts.
Format

display stack port speed
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

You can run the display stack port speed command to check the stack port's current working speed and working speed taking effect after a restart. To set the stack port working speed, run the stack port speed command.
Example

# Display the stack port's current working speed and working speed taking effect after a restart.

<HUAWEI> display stack port speed
Stack Port                 Current Speed    Next Speed                                                                              
------------------------------------------------------                                                 
stack-port2/1                                                                                                                       
  XGigabitEthernet2/0/1    10G              12G                                                   
stack-port2/2                                                                                                                       
  XGigabitEthernet2/0/4    10G              12G                                                              
stack-port3/1                                                                                                                       
  XGigabitEthernet3/0/1    10G              12G                                                           
  XGigabitEthernet3/0/3    10G              12G                                                      
stack-port3/2                                                                                                                       
  XGigabitEthernet3/0/28   10G              12G                                                    
  XGigabitEthernet3/0/30   10G              12G                                                   

Table 3-56 Description of the display stack port speed command output

Item
	

Description

Stack Port
	

Stack port.

Current Speed
	

Stack port's current working speed.

Next Speed
	

Stack port's working speed taking effect after a restart.

To configure the parameter, run the stack port speed command.
display stack-port load-balance
Function

The display stack-port load-balance command displays the load balancing modes of stack ports.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

display stack-port { global load-balance | load-balance [ slot-id/port-id ] }
Parameters

Parameter
	

Description
	

Value

slot-id
	

Specifies the stack ID of a member switch.
	

The value is an integer that ranges from 0 to 8.

port-id
	

Specifies the ID of a stack port.
	

The value is 1 or 2.

global
	

Displays the global load balancing mode.
NOTE:

The S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S only support this parameter.
	

-
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

You can run the display stack-port load-balance command to check the load balancing modes of stack ports and then locate data transmission failures between stack links.
Example

# Display the load balancing modes of stack ports.

<HUAWEI> display stack-port load-balance
Global load balance mode: ENHANCED                                              
Stack-port0/1 load balance mode: ENHANCED                             
Stack-port0/2 load balance mode: ENHANCED                             
Stack-port1/1 load balance mode: DST-MAC                              
Stack-port1/2 load balance mode: SRC-MAC                              
Stack-port2/1 load balance mode: DST-IP                               
Stack-port2/2 load balance mode: SRC-DST-IP

Table 3-57 Description of the display stack-port load-balance command output

Item
	

Description

Global load balance mode
	
Global load balancing mode:

    DST-IP: performs load balancing based on destination IP addresses.

    DST-MAC: performs load balancing based on destination MAC addresses.

    SRC-IP: performs load balancing based on source IP addresses.

    SRC-MAC: performs load balancing based on source MAC addresses.

    SRC-DST-IP: performs load balancing based on the Exclusive-OR result of source and destination IP addresses.

    SRC-DST-MAC: performs load balancing based on the Exclusive-OR result of source and destination MAC addresses.

    ENHANCED: enhanced load balancing mode, that is, load balancing based on the Exclusive-OR result of the source and destination MAC addresses.

To set the global load balancing mode, run the stack-port load-balance mode command in the system view.

Stack-port0/1 load balance mode

Stack-port0/2 load balance mode

Stack-port1/1 load balance mode

Stack-port1/2 load balance mode

Stack-port2/1 load balance mode

Stack-port2/2 load balance mode
	
Load balancing mode of a stack port:

    DST-IP: performs load balancing based on destination IP addresses.

    DST-MAC: performs load balancing based on destination MAC addresses.

    SRC-IP: performs load balancing based on source IP addresses.

    SRC-MAC: performs load balancing based on source MAC addresses.

    SRC-DST-IP: performs load balancing based on the Exclusive-OR result of source and destination IP addresses.

    SRC-DST-MAC: performs load balancing based on the Exclusive-OR result of source and destination MAC addresses.

    ENHANCED: enhanced load balancing mode, that is, load balancing based on the Exclusive-OR result of the source and destination MAC addresses.

To set the load balancing mode for a stack port, run the stack-port load-balance mode command in the stack port view.
display stack configuration
Function

The display stack configuration command displays stack configuration commands configured in a stack.
Format

display stack configuration [ slot slot-id ]
Parameters
Parameter 	Description 	Value

slot slot-id
	

Displays the stack commands configured on a stack member switch. slot-id specifies the stack ID of the member switch.
	

The value range depends on the device configuration.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

Usage Scenario

Stack configuration will only be written to the flash memory instead of the configuration file. As a result, Stack configuration cannot be obtained through the configuration file. To view stack configuration, run the display stack configuration command.

Precautions

    This command is valid only when the stack function is enabled and has taken effect. By default, the stack function is enabled.

    This command displays only the stack commands that have been executed. The displayed command configuration is not necessarily the running stack configuration, because most stack configuration commands take effect after a system restart.

Example

# Display the stack configuration commands that have been executed in a stack.

<HUAWEI> display stack configuration
*    : Invalid-configuration                                                                                                        
#    : Unsaved configuration                                                                                                  
---------------Configuration on slot 2 Begin---------------                                                                                                                                                                                
stack enable                                                                                                                        
stack slot 0 renumber 2                                                                                                             
stack slot 2 priority 150                                                                                                           
stack reserved-vlan 4093                                                                                                            
stack timer mac-address switch-delay 10                                                                                             
                                                                                                                                    
interface stack-port 2/1                                                                                                            
 *port interface XGigabitEthernet2/0/1 enable
                                                                                                                                   
interface stack-port 2/2                                                                                                            
 #port interface XGigabitEthernet2/0/4 enable                                                                                       
---------------Configuration on slot 2 End-----------------  

    If a stack member port is marked with an asterisk (*), the current configuration does not take effect because of the following reasons:
        The current configuration is the preconfiguration that has not taken effect.
        Insert different types of subcards.
        The stack member port is located on a subcard that is not available.
        When ports on the device panel and ports on subcards cannot be used together, one of the two port types is configured as stack member ports but not configured as the ports that take effect on the device, and the device is restarted.
    If a stack member port is marked with a number sign (#), the current configuration is automatically generated for dedicated cable stacking but not saved to the flash memory using the save stack configuration or save command.
    If a stack member port is marked with *#, the switch is using stack card stacking. In this case, the display stack configuration command displays the stack configuration that is automatically generated after dedicated stack cables are installed. To change stack card stacking to dedicated stack cable stacking, run the save stack configuration or save command to save the stack configuration to the flash memory and then restart the switch.

display stack channel
Function

The display stack channel all command displays stack link connections and status.
Format

display stack channel [ all | slot slot-id ]
Parameters
Parameter 	Description 	Value

all
	

Displays stack link connections and status of all the member switches.
	

-

slot slot-id
	

Displays stack link connections and status of the member switch with a specified stack ID.
	

The value range depends on the device configuration.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To check stack link connections and status, run the display stack channel all command. If you do not specify all or slot slot-id in the command, this command displays the stack link connections and status of the master switch.
Example

# Display stack link connections and status of all the member switches.

<HUAWEI> display stack channel all
!     : Port have received packets with CRC error.                                                                                  
L-Port: Logic stack port                                                                                                            
P-Port: Physical port                                                                                                               
Slot  L-Port  P-Port    Speed  State  ||  P-Port    Speed  State  L-Port  Slot                                                      
-------------------------------------------------------------------------------                                                     
1     1/2     GE1/0/28  2.5G   UP         GE2/0/27  2.5G   UP     2/1     2                                                         
2     2/1     GE2/0/27  2.5G   UP         GE1/0/28  2.5G   UP     1/2     1                                                         
------------------------------------------------------------------------------  

The following output information shows that the physical member port GE1/0/28 works at 2.5 Gbit/s and is in Up state; it is bound to stack port 1/2 and belongs to the member switch with stack ID 1; GE1/0/28 is connected to the physical member port GE2/0/27; GE2/0/27 works at 2.5 Gbit/s and is in Up state; It is bound to stack port 2/1 and belongs to member switch with stack ID 2.

1     1/2     GE1/0/28  2.5G   UP         GE2/0/27  2.5G   UP     2/1     2

Table 3-58 Description of the display stack channel command output

Item
	

Description

!
	

A physical member port has received CRC error packets.
NOTE:

If a physical member port receives CRC error packets, its Speed field displays the speed value and an exclamation mark (!), for example, 2.5G!.

Slot
	

Stack ID of a device.

L-Port
	

Number of a stack port.

P-Port
	

Number of a physical member port.

Speed
	

Speed of a physical member port.

Status
	

Status of a physical member port.
display upgrade area
Function

The display upgrade area command displays area status and whether a smooth upgrade can start.
Format

display upgrade area
Parameters

None
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

If the stack topology changes after the areas for smooth upgrade are divided, members in the active and backup areas may change, resulting in a smooth upgrade failure. To check whether a smooth upgrade can start in these areas, run the display upgrade area command.

If the areas fail the check, re-define the active and backup areas according to the current stack topology.

The active area contains the master switch.
Example

# Display the current area status and whether a smooth upgrade can start.

<HUAWEI> display upgrade area
Slot      Area         Upgrade-Check                                            
------------------------------------                                            
   0      backup       passed                                                   
   3      active       passed                                                   
   4      active       passed                                                   
   8      active       passed

Table 3-59 Description of the display upgrade area command output

Item
	

Description

Slot
	

Stack ID of a device.

Area
	
Area to which a device belongs.

    active
    backup
    unknown: The device does not belong to any area.

Upgrade-Check
	
Upgrade check result.

    passed
    failed

display upgrade state
Function

The display upgrade state command displays the smooth upgrade status of member switches in a stack.
Format

display upgrade state [ slot slot-id ]
Parameters

Parameter
	

Description
	

Value

slot slot-id
	

Specifies the stack ID of a member switch.
	

The value is an integer that ranges from 0 to 8.
Views

All views
Default Level

1: Monitoring level
Usage Guidelines

To check the status of member switches in the active and backup areas before or after a smooth upgrade, run the display upgrade state command.

If you specify the slot slot-id parameter in the command, you can check whether the member switch with this slot ID has been upgraded successfully.

If the master switch of a stack restarts or experiences a master/standby switchover after a smooth upgrade, area information will be deleted from the master switch, and the Area field of the master switch will be displayed as unknown.
Example

# Display the smooth upgrade status of member switches in a stack.

<HUAWEI> display upgrade state
Slot      Area         Status                                                   
-----------------------------                                                   
   0      backup       backup rebooting                                             
   3      backup       backup rebooting                                         
   4      active       backup rebooting                                         
   8      active       backup rebooting

# Display the smooth upgrade status of the member switch with stack ID 4.

<HUAWEI> display upgrade state slot 4
--------------------------------------                                          
  Slot        : 4                                                                      
  Area        : backup 
  Status      : successful
  ErrorCode   : 0
  Description : 
--------------------------------------

Table 3-60 Description of the display upgrade state command output

Item
	

Description

Slot
	

Stack ID of a device.

Area
	
Area to which a device belongs.

    active
    backup
    unknown: The device does not belong to any area.

Status
	
Upgrade progress of a device.

    idle: The upgrade has not been performed yet.
    backup rebooting: The backup area is upgrading.
    active rebooting: The active area is upgrading.
    failed: The upgrade failed.
    successful: The upgrade succeeded.

ErrorCode
	

Error code of an upgrade failure. For details, see upgrade start. The value 0 indicates that the upgrade succeeded.

Description
	

Description about the failure if an upgrade fails.
interface stack-port
Function

The interface stack-port command displays the stack port view.

Only devices supporting service port stacking support this command.
Format

interface stack-port member-id/port-id
Parameters
Parameter 	Description 	Value

member-id
	

Specifies the stack ID of a member switch.
	

The value is an integer that ranges from 0 to 8.

port-id
	

Specifies a stack port number.
	

The value is 1 or 2.
Views

System view
Default Level

3: Management level
Usage Guidelines

Each member switch has two stack ports, which are named Stack-Portn/1 and Stack-Portn/2. n specifies the stack ID of a member switch. After you run the interface stack-port command to enter the view of a stack port, you can configure attributes for the stack port.
Example

# Display the view of Stack-Port1/1.

<HUAWEI> system-view
[HUAWEI] interface stack-port 1/1
[HUAWEI-stack-port1/1]

mad backup ip address
Function

The mad backup ip address command configures a backup IP address for the management interface in a stack.

The undo backup ip address command deletes the backup IP address for the management interface in a stack.

By default, no backup IP address is configured for the management interface in a stack.
Format

mad backup ip address ip-address { mask | mask-length }

undo mad backup ip address
Parameters
Parameter 	Description 	Value

ip-address
	

Specifies the backup IP address for the management interface.
	

The value is in dotted decimal notation.

mask
	

Specifies the subnet mask of the backup IP address for the management interface.
	

The value is in dotted decimal notation.

mask-length
	

Specifies the mask length of the backup IP address for the management interface.
	

The value is an integer that ranges from 0 to 32.
Views

MEth0/0/1 management interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

When MAD detects a stack split fault, all interfaces (including the management interface) of the member device that fails in the election are shut down to prevent network flapping caused by identical MAC and IP addresses, reducing the impact on the network. After the management interface of the member device is shut down, you cannot remotely log in to and manage the device, and can only log in to the device through the console interface, which is inconvenient for device maintenance.

To prevent this problem, you can configure a backup IP address for the management interface on the device. If the stack splits, the IP address of the management interface on the member device that fails in the election is set to the configured backup IP address. This prevents packet forwarding from being affected due to conflicting management IP addresses upon the stack split. In addition, you can remotely log in to and manage the device, which facilitates device maintenance.

If the stack splits after a backup IP address is configured for the management interface on the device, the management interface on the member device that fails in the election is not shut down, and only the backup IP address is configured as the IP address of the management interface. Other non-reserved service interfaces are still shut down.
Precautions

    This command does not take effect if the device does not have a management interface.
    The backup IP address cannot be on the same network segment as the IP addresses used by other interfaces on the device. Otherwise, the function does not take effect due to address conflicts.
    This command can only be used to configure the IP address of the management interface, regardless of the Up/Down status of the management interface. For example, if the management interface is shut down using a command or the management interface is not connected using a cable, the management interface is Down.

Example

# Configure a backup IP address for the management interface in a stack.

<HUAWEI> system-view
[HUAWEI] interface meth 0/0/1
[HUAWEI-MEth0/0/1] mad backup ip address 10.1.1.1 24

mad detect mode direct
Function

The mad detect mode direct command configures multi-active detection (MAD) in direct mode on an interface.

The undo mad detect command cancels the configuration.

By default, MAD in direct mode is disabled on an interface.
Format

mad detect mode direct

undo mad detect [ mode direct ]
Parameters

None
Views

GE interface view, XGE interface view, 25GE interface view, 40GE interface view, port group view, MultiGE interface view, 100GE interface view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

To ensure that only one switch becomes the master switch after a stack splits, thereby enhancing stack stability, run the mad detect mode direct command to configure MAD in direct mode on an interface.

Configuration Impact

Configuring MAD in direct mode on an interface blocks the interface. Disabling MAD in direct mode on an interface restores the forwarding function of the interface. If a loop exists on the network, a broadcast storm occurs.

Precautions

The undo mad detect command is not supported in the port group view. You can only run the undo mad detect mode direct command in the port group view to disable MAD in direct mode.
Example

# Configure MAD in direct mode on GigabitEthernet0/0/1.

<HUAWEI> system-view
[HUAWEI] interface gigabitethernet 0/0/1
[HUAWEI-GigabitEthernet0/0/1] mad detect mode direct
Warning: This command will block the port, and no other configuration running on this port is recommended. Continue? [Y/N]:y

mad detect mode relay
Function

The mad detect mode relay command configures multi-active detection (MAD) in relay mode on an interface.

The undo mad detect command cancels the configuration.

By default, MAD in relay mode is disabled on an interface.
Format

mad detect mode relay

undo mad detect [ mode relay ]
Parameters

None
Views

Eth-Trunk interface view, port group view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

To ensure that only one switch becomes the master switch after a stack splits, thereby enhancing stability of the stack, run the mad detect mode relay command to configure MAD in relay mode on an Eth-trunk.

Precautions

The undo mad detect command is not supported in the port group view. You can only run the undo mad detect mode relay command in the port group view to disable MAD in relay mode.
Example

# Configure MAD in relay mode on Eth-Trunk 10.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 10
[HUAWEI-Eth-Trunk10] mad detect mode relay

mad domain
Function

The mad domain command sets a MAD domain ID for a stack.

The undo mad domain command restores the default MAD domain ID for a stack.

By default, the MAD domain ID of a stack is 0.
Format

mad domain domain-id

undo mad domain
Parameters
Parameter 	Description 	Value
domain-id 	

Specifies the MAD domain ID for a stack.
	

The value is an integer that ranges from 0 to 255.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

In most MAD scenarios, configuring a MAD domain ID for a stack is unnecessary. When two stack systems function as a proxy of each other to implement MAD, configure different MAD domain IDs for the stack systems.
Example

# Set the MAD domain ID for a stack to 1.

<HUAWEI> system-view
[HUAWEI] mad domain 1

mad exclude
Function

The mad exclude command excludes specified interfaces of a stack from shutdown.

The undo mad exclude command cancels excluding specified interfaces of a stack from shutdown.

By default, only physical member ports are excluded from shutdown.
Format

mad exclude interface { interface-type interface-number1 [ to interface-type interface-number2 ] } &<1-10>

undo mad exclude interface { interface-type interface-number1 [ to interface-type interface-number2 ] } &<1-10>
Parameters
Parameter 	Description 	Value
interface { interface-type interface-number1 [ to interface-type interface-number2 ] } 	
Specifies the type and number of an interface:

    interface-type specifies the type of the interface.

    interface-number1 specifies the number of the first interface.

    interface-number2 specifies the number of the second interface.

	

The value of interface-number2 must be larger than that of interface-number1.
Views

System view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

If MAD detects a stack split, all service ports of the member switch that fails master switch election must be shut down to prevent network flapping caused by MAC or IP address flapping. If some interfaces only transparently transmit packets, they do not affect network operation in a dual-active condition. You can run the mad exclude command to exclude these interfaces from shutdown before a stack split occurs.
Precautions

    After an interface is shut down because of MAD, it cannot be enabled if the mad exclude command is executed to exclude it from shutdown.
    When the to parameter is specified to exclude multiple ports from shutdown, these ports must reside on the same card and the port number following this parameter must be larger than the port number followed by this parameter.

Example

# Exclude GigabitEthernet0/0/2 and GigabitEthernet0/0/3 from shutdown.

<HUAWEI> system-view
[HUAWEI] mad exclude interface gigabitethernet 0/0/2 to gigabitethernet 0/0/3

mad relay
Function

The mad relay command enables the relay function on an interface of a proxy device.

The undo mad relay command disables the relay function on an interface of a proxy device.

By default, the relay function is disabled on an interface.
Format

mad relay

undo mad relay
Parameters

None
Views

Eth-Trunk interface view, port group view
Default Level

2: Configuration level
Usage Guidelines

For MAD working in relay mode, run the mad relay command to configure the relay function on an Eth-Trunk interface of a proxy device. Member interfaces of the Eth-Trunk interface exchange MAD packets between member switches.
Example

# Enable the relay function on Eth-Trunk 10 of a proxy device.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 10
[HUAWEI-Eth-Trunk10] mad relay

mad relay legacy enable
Function

The mad relay legacy enable command configures an interface to transparently transmit LACP stack split detection packets.

The undo mad relay legacy enable command disables an interface from transparently transmitting LACP stack split detection packets.

By default, an interface is not configured to transparently transmit LACP stack split detection packets.
Format

mad relay legacy enable

undo mad relay legacy enable
Parameters

None
Views

Eth-Trunk interface view, port group view
Default Level

2: Configuration level
Usage Guidelines

Usage Scenario

In Figure 3-1, an S series switch (standalone switch or stack) is connected to a stack of third-party devices through an Eth-Trunk interface. The third-party stack performs multi-active detection (MAD) by sending LACP packets carrying the stack split detection TLV.

To ensure that member switches in the third-party stack can receive LACP stack split detection packets, the S series switch needs to transparently transmit these packets. You can run this command on the Eth-Trunk interface that connects the S series switch to the third-party stack to enable the Eth-Trunk interface to transparently transmit LACP stack split detection packets.
Figure 3-1 Networking

Precautions

You can run this command to configure an Eth-Trunk interface to transparently transmit LACP stack split detection packets only after it is configured to work in LACP mode using the mode lacp command.
Example

# Configure an interface to transparently transmit LACP stack split detection packets.

<HUAWEI> system-view
[HUAWEI] interface eth-trunk 10
[HUAWEI-Eth-Trunk10] mode lacp
[HUAWEI-Eth-Trunk10] mad relay legacy enable

mad restore
Function

The mad restore command restores all the blocked interfaces of a standby switch that enters the Recovery state after its stack splits.
Format

mad restore
Parameters

None
Views

System view
Default Level

2: Configuration level
Usage Guidelines

When MAD detects a multi-active event, the member switch elected as the master switch remains in the Detect state. The elected standby switch enters the Recovery state, shuts down all its service ports except those excluded from shutdown, and stops forwarding service packets.

If the switch in the Detect state fails or is removed before the split stack is restored, run the mad restore command on the switch in the Recovery state to restore the interfaces in shutdown state. The switch in the Recovery state then goes to the Detect state. You can then restore the original switch in the Detect state and rectify the faulty stack links. After the faults are rectified, the two switches form a stack again.
Example

# Restore all the blocked interfaces of the standby switch that enters the Recovery state after its stack splits.

<HUAWEI> system-view
[HUAWEI] mad restore

port interface enable
Function

The port interface enable command configures a service interface as a physical member port and adds it to a stack port.

The undo port interface enable command restores a physical member port to being a service interface.

By default, service interfaces are not used as physical member ports of a stack port.

Only the switches supporting service port stacking support this command.
Format

port interface { interface-type interface-number1 [ to interface-type interface-number2 ] } &<1-10> enable

undo port interface { interface-type interface-number1 [ to interface-type interface-number2 ] } &<1-10> enable
Parameters
Parameter 	Description 	Value

interface-type interface-number1 [ to interface-type interface-number2 ]
	
Specifies the type and number of an interface:

    interface-type specifies the type of the interface.

    interface-number1 specifies the number of the first interface.

    interface-number2 specifies the number of the second interface.

	

The value of interface-number2 must be larger than that of interface-number1.
Views

Stack interface view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

In service interface connection mode, run the port interface enable command to configure a service interface as a physical member port to implement the stack function.

Configuration Impact

A stack physical member port supports only stack-related functions, and other functions cannot be configured on the interface. All the commands irrelevant to the stack function are masked in the interface view, and only basic configuration commands, such as description, are retained.

After configuring a service port of a switch as a physical stack member port, you are advised to save the configuration if this service port has been referenced by other commands. Otherwise, the commands that reference this service port may be retained after the switch restarts.

On the S5720I-SI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, and S6720S-S the electrical or optical port stack configuration on the front panel is mutually exclusive with the SVF client mode configuration. If electrical or optical ports on the front panel have been configured as stack physical member ports, SVF management VLAN cannot be configured. If an SVF management VLAN has been configured, electrical or optical ports on the front panel cannot be configured as stack physical member ports.

On the S6735-S, every four of XGE interfaces from the left are added to one group. For example, XGE interfaces numbered 1 to 4 can be added to one group, but XGE interfaces numbered 2 to 5 cannot. That is, the number of the last XGE interface in each group must be the multiple of 4. If you configure any interface in each group as a physical member port, configurations on the other three interfaces in the group will be lost and the three interfaces cannot be used as service ports.

Precautions

    The stack member ports of a logical stack port must be the same type.
    After a UCL group is created on the S5720I-SI, S5720-LI, S5720S-LI, or S5720-SI, using the ucl-group command, the port interface enable command cannot be used to configure a service interface as a stack member port.
    To restore a physical member port as a service interface, run the shutdown interface command in the stack port view and then run the undo port interface enable command.

    On the S5720I-SI, S5720-LI, S2730S-S, S5735-L-I, S5735-L1, S300, S5735-L, S5735S-L1, S5720S-LI, S5735-S, S500, S5735-S-I, S5735S-H, S5736-S, and S6720S-S, after a service interface is configured as a stack member port, the following priority mapping rules apply to packets on this interface:
        Packets sent to the CPU are mapped to queue 7.
        Packets with priority 0 or 1 are mapped to queue 0.
        Packets with priorities 2 to 7 are mapped to queues 1 to 6, respectively.

    If the switch functions as an AS in an SVF system and its downlink service ports have been configured as member ports of an uplink fabric port, all the downlink ports of the AS cannot be configured as stack member ports.

Example

# Configure XGigabitEthernet0/0/28 as a physical member port and add it to stack port 0/1.

<HUAWEI> system-view
[HUAWEI] interface stack-port 0/1
[HUAWEI-stack-port0/1] port interface xgigabitethernet 0/0/28 enable
Warning: Enabling stack function may cause configuration loss on the interface. Continue? [Y/N]:y
Info: This operation may take a few seconds. Please wait....

reset stack configuration
Function

The reset stack configuration command clears all stack configuration. That is, this command restores the default stack configuration.
Format

reset stack configuration
Parameters

None
Views

System view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

The cleared stack configuration includes: switch slot ID, stack priority, stack reserved VLAN, stack MAC address switching delay, stack port configuration, and stack port rate configuration. For example, when switches are stacked using dedicated stack cables, to ensure that slot IDs are automatically generated for the switches based on the sequence in which dedicated stack cables are connected, run the reset stack configuration command to clear all stack configuration.

Precautions

    Running this command will cause the stack to split and member switches to restart.
    If there is no device in the slot where an interface resides, running this command automatically clears all configurations on the interface. For example, if the slot ID of the current device is 0 and there is interface 1/0/1 in the configuration file, all configurations on interface 1/0/1 are cleared.

Example

# Clear all stack configuration.

<HUAWEI> system-view
[HUAWEI] reset stack configuration
Warning: This operation will clear all stack configurations and may lead to the loss of the slot ID configuration and cause the device to reset immediately. Are you sure you want to continue? [Y/N]:y 

reset stack port statistics
Function

The reset stack port statistics command clears stack port statistics.
Format

reset stack port statistics [ slot-id/port-id ]
Parameters

Parameter
	

Description
	

Value

slot-id
	

Specifies the stack ID of a member switch.
	

The value is an integer that ranges from 0 to 8.

port-id
	

Specifies the number of a stack port.
	

The value is 1 or 2.
Views

User view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Before collecting interface traffic statistics in a certain period of time, run the reset stack port statistics command to clear existing traffic statistics. If you do not specify the port number, statistics on all stack ports are cleared. If you specify the port number, only statistics on the specified port are cleared.

Precautions

The cleared statistics cannot be restored. Therefore, exercise caution when you run the reset stack port statistics command.

This command can be used only after the stack function is enabled (default status).
Example

# Clear the statistics from all stack ports.

<HUAWEI> reset stack port statistics

save stack configuration
Function

The save stack configuration command saves the stack configuration automatically generated for dedicated cable stacking to the flash memory.

By default, the stack configuration automatically generated for dedicated cable stacking is not saved to the flash memory.
Format

save stack configuration
Parameters

None
Views

System view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

After dedicated stack cables are connected to ports, stack configuration is automatically generated but not saved to the flash memory. If these cables are removed or other cables are connected, the stack configuration is automatically deleted. To ensure that the stack configuration still takes effect when these cables are removed or other cables are connected, run the save stack configuration command.

Precautions

    Removing dedicated stack cables from ports after this command is executed will cause these ports unable to automatically become service ports.
    No stack configurations can be manually modified before the stack configuration automatically generated for dedicated cable stacking is saved to the flash memory.

Example

# Save the stack configuration that is automatically generated for dedicated cable stacking to the flash memory.

<HUAWEI> system-view
[HUAWEI] save stack configuration 
Warning: This operation will save all stack configurations to flash. Are you sure you want to continue? [Y/N]:y

set l2-traffic fast-recover
Function

The set l2-traffic fast-recover enable command enables fast recovery of Layer 2 traffic.

The undo set l2-traffic fast-recover enable command disables fast recovery of Layer 2 traffic.

By default, fast recovery of Layer 2 traffic is disabled.
Format

set l2-traffic fast-recover enable

undo set l2-traffic fast-recover enable
Parameters

None
Views

System view
Default Level

2: Configuration level
Usage Guidelines

After fixed switches set up a stack and the standby switch starts, the standby switch restores configurations and then implements batch backup from the master switch.

By default, interfaces on the standby switch become Up when batch backup is complete. In this case, Layer 2 and Layer 3 traffic can be normally forwarded but there is a delay in Layer 2 traffic recovery. To enable fast recovery of Layer 2 traffic, run the set l2-traffic fast-recover enable command. Interfaces on the standby switch then immediately go Up when configuration restoration is complete. This way, however, cannot ensure Layer 3 traffic forwarding through the Up interfaces.
Example

# Enable fast recovery of Layer 2 traffic.

<HUAWEI> system-view
[HUAWEI] set l2-traffic fast-recover enable

shutdown interface
Function

The shutdown interface command shuts down a physical member interface.

The undo shutdown interface command enables a physical member interface.

By default, a physical member interface is enabled after being configured.

Only devices supporting service port stacking support this command.
Format

shutdown interface { interface-type interface-number1 [ to interface-type interface-number2 ] } &<1-10>

undo shutdown interface { interface-type interface-number1 [ to interface-type interface-number2 ] } &<1-10>
Parameters
Parameter 	Description 	Value

interface-type interface-number1 [ to interface-type interface-number2 ]
	
Specifies the type and number of an interface:

    interface-type specifies the type of the interface.

    interface-number1 specifies the number of the first interface.

    interface-number2 specifies the number of the second interface.

	

The value of interface-number2 must be larger than that of interface-number1.
Views

Stack interface view
Default Level

3: Management level
Usage Guidelines

To restore a physical member interface to being a service interface, run the shutdown interface command in the stack interface view and then run the undo port interface enable command.

If there is only one available link on a stack interface, running the shutdown interface command will change the stack status or split the stack. After you run the undo shutdown interface command on the stack interface, the stack will be set up again when a link on the stack interface becomes available.
Example

# Shut down physical member interface XGigabitEthernet0/0/3.

<HUAWEI> system-view
[HUAWEI] interface stack-port 0/1
[HUAWEI-stack-port0/1] shutdown interface XGigabitEthernet0/0/3
Warning: Shutting down the last active stack-port will cause a topology change. Continue? [Y/N]:y
Info: This operation may take a few seconds. Please wait...succeeded.

stack authentication
Function

The stack authentication command configures the authentication mode and authentication information used when a switch needs to join a stack.

The undo stack authentication command deletes the authentication mode and authentication information used when a switch needs to join a stack.

By default, a switch does not need to be authenticated when joining a stack.
Format

stack authentication slot slot-id { mac-address mac-address | esn esn-value | shared-key cipher shared-key }

undo stack authentication slot slot-id
Parameters

Parameter
	

Description
	

Value

slot slot-id
	

Specifies the stack ID of a switch.
	

The value is an integer that ranges from 0 to 8.

mac-address mac-address
	

Configures MAC-based authentication.
	

The value is in H-H-H format, where H is a hexadecimal number of 1 to 4 digits.

esn esn-value
	

Configures ESN-based authentication.
	

The value is a string of 10 to 32 characters.

shared-key cipher shared-key
	

Configures shared key-based authentication.
	

The value is a string of case-sensitive characters without spaces. A plain text key contains 1 to 64 characters, and a cipher text key contains 48 to 108 characters.
NOTE:

It is recommended that a shared key contains at least seven characters, including at least two types of lowercase letters, uppercase letters, digits, and special characters.

The master switch and the specified slot must configure the same shared key.

If a shared key is used for authentication, the master switch and the member switch specified in this command must be configured with the same shared key.
Views

System view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

A switch can join a stack without being authenticated. In this situation, an attacker can add any switch to a stack to obtain the configuration file of the stack master switch, resulting in information leak. To solve this problem, configure authentication when a switch needs to join a stack. This configuration ensures that this switch joins the stack only when it is authenticated successfully.

A switch will be authenticated only when its stack ID is the same as that specified in the stack authentication command. Otherwise, this switch can join a stack without being authenticated. Therefore, before adding a switch to a stack, you are advised to change the slot ID of the switch to an unused stack ID in the stack and then configure an authentication mode for this stack ID.

Precautions

    This command can be executed only after the stacking function is enabled.
    Only one authentication mode can be configured for a stack ID, and the latest configuration takes effect.
    If a switch to join a stack fails the authentication, this switch will restart repeatedly.

Example

# Configure MAC-based authentication to be used when a switch with the stack ID 4 needs to join a stack.

<HUAWEI> system-view
[HUAWEI] stack authentication slot 4 mac-address 3-3-3

stack led enable
Function

The stack led enable command enables a service port indicator to indicate the stack ID of a stack switch.

The stack led disable command disables a service port indicator from indicating the stack ID of a stack switch.

By default, a service port indicator does not indicate the stack ID of a stack switch.

S6735-S does not support this command.
Format

stack led enable [ duration duration-value ]

stack led disable
Parameters

Parameter
	

Description
	

Value

duration duration-value
	

Specifies how long a service port indicator indicates the stack ID of a stack switch.
	

The value is an integer that ranges from 30 to 600, in seconds. By default, a stack ID indicator stays on for 45 seconds.
Views

All views
Default Level

2: Configuration level
Usage Guidelines

Stack IDs can be allocated by the master switch when a stack is set up, or you can configure them yourself. If stack IDs are allocated by the master switch, you cannot identify which ID a device maps to. To enable a service port indicator to indicate the stack ID of a stack switch, run the stack led enable command.
A service port indicator indicates the stack ID of a stack switch as follows:

    For a switch whose stack ID ranges from 1 to 8: Only the indicator whose serial number matches the stack ID is on. For example, if the stack ID is 1, the first indicator is on. If the stack ID is 2, the second indicator is on.
    For a switch whose stack ID is 0: If the stack contains N stack switches, the first N indicators are on. For example, if the stack contains 9 stack switches, the first 9 indicators are on, indicating the stack ID is 0.
    After service port indicators are configured to indicate the stack IDs, the service port indicator of the master switch blinks, and that of the slave switch is steady on.

The configuration of this command becomes invalid when port indicators show stack IDs of member switches for the specified time.
Example

# Enable a service port indicator to indicate the stack ID of a stack device for a period of 30s.

<HUAWEI> stack led enable duration 30

stack-port load-balance mode
Function

The stack-port load-balance mode command sets a load balancing mode for the physical member ports of a stack port.

The undo stack-port load-balance mode command restores the default load balancing mode.

By default, the physical member ports of a stack port perform load balancing in enhanced mode, that is, load balancing based on the Exclusive-OR result of the source and destination MAC addresses.

Only the S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6735-S, S6730-H, S6730S-H, S6730-S, and S6730S-S support this command.
Format

stack-port load-balance mode { dst-ip | dst-mac | src-dst-ip | src-dst-mac | src-ip | src-mac }

undo stack-port load-balance mode
Parameters

Parameter
	

Description
	

Value

dst-ip
	

Performs load balancing based on destination IP addresses.
	

-

dst-mac
	

Performs load balancing based on destination MAC addresses.
	

-

src-dst-ip
	

Performs load balancing based on the Exclusive-OR result of the source and destination IP addresses.
	

-

src-dst-mac
	

Performs load balancing based on the Exclusive-OR result of the source and destination MAC addresses.
	

-

src-ip
	

Performs load balancing based on source IP addresses.
	

-

src-mac
	

Performs load balancing based on source MAC addresses.
	

-
Views

System view

Logical stack port view (The S5731-H, S5731-S, S5731S-H, S5731S-S, S5732-H, S6730-H, S6730S-H, S6730-S, and S6730S-S do not support the stack-port load-balance mode command in this view.)
Default Level

3: Management level
Usage Guidelines

Use Scenario

To transmit traffic from a stack port to a destination over different links, run the stack-port load-balance mode command to configure an appropriate load balancing mode for the physical member ports of the stack port. Outgoing traffic is then properly balanced among the physical links, preventing congestion on these links. If you run this command multiple times to set different load balancing modes, the last configuration takes effect. The load balancing mode configured in the system view takes effect globally, and the load balancing mode configured in a stack port view takes effect only on the specified stack port. You can run the display stack-port command to view the load balancing mode on a stack port.
Precautions

    If a non-default load balancing mode is configured on a stack port, the configured load balancing mode takes effect. If a stack port uses the default load balancing mode and the global load balancing mode is not the default one, the global load balancing mode takes effect.
    If the source MAC address-based load balancing mode is used, Layer 3 packets forwarded to a downstream device may fail to be balanced among the stack links because the source MAC address of the packets is the fixed system MAC address. If the traffic rate exceeds the bandwidth of a single stack link, some packets may be dropped.

Example

# Set the global load balancing mode to src-ip.

<HUAWEI> system-view
[HUAWEI] stack-port load-balance mode src-ip

# Set the load balancing mode on stack port 0/1 to dst-ip.

<HUAWEI> system-view
[HUAWEI] interface stack-port 0/1
[HUAWEI-stack-port0/1] stack-port load-balance mode dst-ip

stack port speed
Function

The stack port speed command sets the working speed for stack member ports.

The undo stack port speed command restores the working speed of stack member ports to the default value.

For the default working speeds of stack member ports on different switch models, see "Stack Support and Version Requirements" in Stack Configuration in the S300, S500, S2700, S5700, and S6700 V200R024C00 Configuration Guide - Device Management.

Only the S5720-X-LI, S5720I-SI, S5732-H, and S5720S-X-LI support this command.

The S5720-P-LI does not support this command before the license is loaded and supports this command after the license is loaded and it restarts.
Format

stack port speed { 12G | 2.5G | 40GE }

undo stack port speed
Parameters

Parameter
	

Description
	

Value

12G
	

Sets the working speed of stack member ports to 12 Gbit/s.

This speed can be set only on the S5720-P-LI, S5720-X-LI, S5720I-SI, and S5720S-X-LI,.
	

-

2.5G
	

Sets the working speed of stack member ports to 2.5 Gbit/s.

This speed can be set only on the S5720-P-LI, S5720-X-LI, and S5720S-X-LI.
	

-

40GE
	

Sets the working speed of stack member ports to 40 Gbit/s.

This speed can be set only on the S5732-H.
	

-
Views

System view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

On the S5720-P-LI, S5720-X-LI, S5720I-SI, and S5720S-X-LI,, if optical ports are used as stack member ports and are connected using 1 m or 3 m SFP+ passive copper cables, you can use this command to increase their working speed from 10 Gbit/s to 12 Gbit/s, expanding the stack bandwidth. After their working speed is increased to 12 Gbit/s, switches using these ports cannot set up a stack with switches using ports with the working speed 10 Gbit/s.

If S5720-P-LI, S5720-X-LI, and S5720S-X-LI switches use XGE optical ports to stack with other switches that have GE optical ports, use this command to reduce the working speed of the XGE optical ports from 10 Gbit/s to 2.5 Gbit/s, so that the XGE optical ports can work with the remote GE optical ports.

On the S5732-H, if 100GE and 40GE ports need to be connected using 2 m QSFP28 dedicated stack cables for stack setup, run this command to reduce the working speed of the 100GE ports that function as stack member ports to 40 Gbit/s.

You can run the display stack port speed command to check the working speed of stack member ports.

Precautions

After changing the working speed of stack member ports, you need to restart the switch for the new speed to take effect.
Example

# Set the working speed of stack member ports to 12 Gbit/s.

<HUAWEI> system-view
[HUAWEI] stack port speed 12G

stack port { crc | link-flap } trigger
Function

The stack port { crc | link-flap } trigger command sets the stack port error-down parameters.

The undo stack port { crc | link-flap } trigger command restores the default settings of the stack port error-down parameters.

By default, the stack port receives 20 CRC error packets (include Symbols error packets) per minute or alternates between Up and Down states 10 times per minute, the error-down check interval is 3 minutes, and the alarm clearance interval is 0 (not cleared automatically).
Format

stack port { crc | link-flap } trigger { threshold threshold | interval interval } *

undo stack port { crc | link-flap } trigger { threshold | interval }

stack port { crc | link-flap } trigger error-down auto-recovery-interval auto-recovery-interval

undo stack port { crc | link-flap } trigger error-down auto-recovery-interval
Parameters

Parameter
	

Description
	

Value

crc
	

Sets the parameters for stack port error-down alarms triggered by CRC error packets (include Symbols error packets).
	

-

link-flap
	

Sets the parameters for stack port error-down alarms triggered by port Up/Down transitions.
	

-

threshold threshold
	

Specifies the error-down alarm threshold.
	

The value is an integer. It ranges from 1 to 10000 for error-down alarms triggered by CRC error packets (include Symbols error packets) and ranges from 3 to 30 for error-down alarms triggered by port Up/Down transitions. The unit is times per minute.

interval interval
	

Specifies the error-down check interval.
	

The value is an integer that ranges from 3 to 30, in minutes.

auto-recovery-interval auto-recovery-interval
	

Specifies the error-down alarm clearance interval.
	

The value is an integer that ranges from 3 to 30, in minutes.
Views

System view
Default Level

3: Management level
Usage Guidelines

After the stack port error-down function is enabled, you can run the stack port { crc | link-flap } trigger command to adjust the related parameters.
Example

# Set the clearance interval of stack port error-down alarms triggered by CRC error packets (include Symbols error packets) to 3 minutes. That is, if the rate of received CRC error packets (include Symbols error packets) stays below the threshold for 3 minutes, the stack port changes to Up state and the error-down alarm is cleared.

<HUAWEI> system-view
[HUAWEI] stack port crc trigger error-down auto-recovery-interval 3

stack port { crc | link-flap } trigger error-down
Function

The stack port { crc | link-flap } trigger error-down command enables the stack port error-down function.

The undo stack port { crc | link-flap } trigger error-down command disables the stack port error-down function.

By default, the stack port error-down function is enabled.
Format

stack port { crc | link-flap } trigger error-down

undo stack port { crc | link-flap } trigger error-down
Parameters

Parameter
	

Description
	

Value

crc
	

Enables stack port error-down triggered by CRC error packets (include Symbols error packets).
	

-

link-flap
	

Enables stack port error-down triggered by port Up/Down transitions.
	

-
Views

System view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

In a stack system, if a stack port continuously receives CRC error packets (include Symbols error packets) or flaps between Up and Down states, the corresponding stack link cannot forward traffic normally, thereby affecting network services. This command enables the stack port error-down function. This function can shut down a stack port and switch traffic to other stack links if the rate of received CRC error packets (include Symbols error packets) or the number of Up/Down transitions on the stack port reaches the specified threshold, reducing the impact on services. Additionally, the system generates stack port error-down alarms to help in fault location.

Follow-up Procedure

Run the stack port { crc | link-flap } trigger command to set stack port error-down parameters.

Precautions

    When one end is a stack port and the other end is a service port, the system does not set the stack port to error-down state or generate an error-down alarm even if this stack port continuously receives CRC error packets (include Symbols error packets).
    The stack port error-down alarm OID is 1.3.6.1.4.1.2011.5.25.183.1.22.59.
    The stack port error-down alarm clearance OID is 1.3.6.1.4.1.2011.5.25.183.1.22.60.

Example

# Enable stack port error-down triggered by CRC error packets (include Symbols error packets).

<HUAWEI> system-view
[HUAWEI] stack port crc trigger error-down

stack reserved-vlan
Function

The stack reserved-vlan command configures a reserved VLAN for a stack.

By default, a stack uses VLAN 4093 as the reserved VLAN.
Format

stack reserved-vlan vlan-id
Parameters

Parameter
	

Description
	

Value

vlan-id
	

Specifies the ID of a reserved VLAN.
	

The value is an integer that ranges from 1 to 4094.
Views

System view
Default Level

3: Management level
Usage Guidelines

By default, a stack uses VLAN 4093 as the reserved VLAN. A reserved VLAN is used only to exchange stack protocol packets.

To deploy services in VLAN 4093, run the stack reserved-vlan command to change the reserved VLAN of the stack.

If the reserved VLAN is used for other services, the stack cannot be set up. You must specify an unused VLAN as the reserved VLAN for a stack.
Example

# Configure VLAN 4000 as the reserved VLAN of a stack.

<HUAWEI> system-view
[HUAWEI] stack reserved-vlan 4000
Warning: Do not frequently modify the stack reserved VLAN because it will make the stack split. Continue? [Y/N]:y

stack slot priority
Function

The stack slot priority command sets a stack priority for a member switch in a stack.

By default, the stack priority of a member switch is 100.
Format

stack slot slot-id priority priority
Parameters

Parameter
	

Description
	

Value

slot-id
	

Specifies the stack ID of a member switch.
	

The value is an integer that ranges from 0 to 8.

priority
	

Specifies a stack priority.
	

The value is an integer that ranges from 1 to 255.
Views

System view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

To set a stack priority for a member switch in a stack, run the stack slot priority command. A larger priority indicates a higher priority, meaning that a switch is more likely to be selected as a master switch.
Example

# Set the stack priority of the member switch with stack ID 4 to 150.

<HUAWEI> system-view
[HUAWEI] stack slot 4 priority 150
Warning: Do not frequently modify the priority because it will make the stack split. Continue? [Y/N]:y

stack slot renumber
Function

The stack slot renumber command changes the stack ID of a specified stack member switch.
Format

stack slot slot-id renumber new-slot-id
Parameters

Parameter
	

Description
	

Value

slot-id
	

Specifies the current stack ID.
	

The value is an integer that ranges from 0 to 8.

new-slot-id
	

Specifies a new stack ID.
	

The value is an integer that ranges from 0 to 8.
Views

System view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

To change the stack ID of a stack member switch, run the stack slot renumber command.

Precautions

    After changing the stack ID of a switch, if you do not restart the switch, the switch continues to use the original stack ID, and all physical resources are identified by the original stack ID.
    After changing the stack ID of a switch, if you restarts the switch, the new stack ID takes effect and all physical resources are identified by the new stack ID. In the configuration file, only the global stack configuration and stack priority of the switch continue to take effect. All other configurations related to the old stack ID (such as interface configuration) become invalid and must be reconfigured.
    After a UCL group is created on the S5720I-SI, S5720-LI, S5720S-LI, or S5720-SI, using the ucl-group command, the stack slot renumber command cannot be used to change the stack ID of a specified stack member switch.

Example

# Change the stack ID of a stack member switch from 4 to 5.

<HUAWEI> system-view
[HUAWEI] stack slot 4 renumber 5
Warning: All the configurations related to the slot ID will be lost after the slot ID is modified.                                  
Do not frequently modify the slot ID because it will make the stack split. Continue? [Y/N]:y                                        
Info: Stack configuration has been changed, and the device needs to restart to make the configuration effective. 

stack timer mac-address switch-delay
Function

The stack timer mac-address switch-delay command sets a period after which a stack changes its system MAC address.

The undo stack timer mac-address switch-delay command configures a stack to change the system MAC address immediately after the owner of the original system MAC address leaves the stack.

By default, a stack changes the system MAC address after 10 minutes.

When a stack is configured to switch the system MAC address immediately, the system begins using the MAC address of the new master switch the moment the previous master switch fails or leaves the stack. This may cause protocols such as LACP and STP to flap, thereby affecting services.
Format

stack timer mac-address switch-delay delay-time

undo stack timer mac-address switch-delay
Parameters

Parameter
	

Description
	

Value

delay-time
	

Specifies a period after which a stack changes the system MAC address.
	

The value ranges from 0 to 60, in minutes.
Views

System view
Default Level

3: Management level
Usage Guidelines

When a member switch leaves a stack, if you specify the MAC address of the leaving switch as the stack MAC address and it does not rejoin the stack within the time specified by delay-time, the master switch changes the stack MAC address to its own MAC address.

The stack MAC address switchover delay time of any member switch in a stack is the same as that of the master switch.

If the value of the MAC address switchover timer is set to 0, no stack MAC address switchover will be performed.

This command can be used only after the stack function is enabled (default status).
Example

# Set the MAC address switchover delay of the local switch to 4 minutes.

<HUAWEI> system-view
[HUAWEI] stack timer mac-address switch-delay 4
Warning: Do not frequently modify the MAC switching time because it will make the stack split. Continue? [Y/N]:y

upgrade backup-area slot
Function

The upgrade backup-area slot command defines the active and backup areas in a stack in preparation for a smooth upgrade.
Format

upgrade backup-area slot slot-id to slot-id
Parameters

Parameter
	

Description
	

Value

slot-id
	

Specifies the stack ID of a member switch.
	

The value is an integer that ranges from 0 to 8.
Views

System view
Default Level

3: Management level
Usage Guidelines

Usage Scenario

Before upgrading a reliable stack with uplinks and downlinks working in redundancy mode, you can divide the stack into an active area and a backup area for redundancy. After an upgrade is started, member switches in the two areas are upgraded in sequence, shortening the service interruption duration and reducing the impact of the upgrade on the network.

Precautions

    Member switches in the active and backup areas form the entire stack. When dividing active and backup areas, note that:
        The active and backup areas cannot have the same member switch, and both areas must have at least one member switch.
        The backup area cannot contain the master switch of the stack.
        Member switches in each area must be directly connected.

    After this command is run, the member switches with specified stack IDs join the backup area. The other member switches automatically join the active area.

    To ensure mutual backup, it is recommended that the two areas have similar quantities of member switches.

Example

# Add member switches with stack IDs 0 to 3 to the backup area.

<HUAWEI> system-view
[HUAWEI] upgrade backup-area slot 0 to 3

upgrade start
Function

The upgrade start command starts a smooth upgrade.
Format

upgrade start
Parameters

None
Views

System view
Default Level

3: Management level
Usage Guidelines

Before running this command, run the upgrade backup-area slot command to define the active and backup areas and ensure that all member switches in the stack are running the same system software and support smooth upgrades.

If an upgrade fails, error codes and displayed message help locate the cause. Table 3-61 lists the error codes and displayed messages in different upgrade failure scenarios.
Table 3-61 Error codes and displayed messages in different upgrade failure scenarios

Upgrade Failure Scenario
	

Error Code
	

Displayed Message

Record in the backup area: The upgrade in the backup area times out and rolls back.
	

1
	

Rollback due to timeout.

Record in the active area: The upgrade in the backup area times out and rolls back.
	

2

Record in the backup area: The upgrade in the active area times out and rolls back.
	

3

Record in the active area: The upgrade in the active area times out and rolls back.
	

4

Record in the backup area: Rollback occurs due to a topology change in the backup area.
	

257
	

Rollback due to topology changes.

Record in the active area: Rollback occurs due to a topology change in the backup area.
	

258

Record in the backup area: Rollback occurs due to a topology change in the active area.
	

259

Record in the active area: Rollback occurs due to a topology change in the active area.
	

260

A member switch records that the master switch is not upgraded.
	

512
	

Master is not upgraded.

During a backup area upgrade, the master switch instructs switches in the backup area to roll back (after the active area instructs the backup area to upgrade and switches in the backup area restart).
	

769
	

Master notifies others of rollback.

During a backup area upgrade, the master switch instructs switches in the backup area to roll back (after the active area instructs the backup area to upgrade and before switches in the backup area restart).
	

770

During an active area upgrade, the master switch instructs switches in the active area to roll back (after the backup area instructs the active area to upgrade and before switches in the active area restart).
	

771

During an active area upgrade, the master switch instructs switches in the active area to roll back (after the backup area instructs the active area to upgrade and switches in the active area restart).
	

772

During a backup area upgrade, the master switch in the active area instructs switches in the backup area to roll back (after switches in the backup area restart).
	

1025
	

Master of the active area notifies others of rollback.

During a backup area upgrade, the master switch in the active area instructs switches in the backup area to roll back (before switches in the backup area restart).
	

1026

During an active area upgrade, the master switch in the active area instructs switches in the active area to roll back (before switches in the active area restart).
	

1027

During an active area upgrade, the master switch in the active area instructs switches in the active area to roll back (after switches in the active area restart).
	

1028

During a backup area upgrade, the master switch in the backup area instructs switches in the backup area to roll back (after switches in the backup area restart).
	

1281
	

Master of the backup area notifies others of rollback.

During a backup area upgrade, the master switch in the backup area instructs switches in the backup area to roll back (before switches in the backup area restart).
	

1282

During an active area upgrade, the master switch in the backup area instructs switches in the active area to roll back (before switches in the active area restart).
	

1283

During an active area upgrade, the master switch in the backup area instructs switches in the active area to roll back (after switches in the active area restart).
	

1284

A load event occurs, and switches in the backup area roll back.
	

1537
	

Rollback due to a load event.

A load event occurs, and switches in the active area roll back.
	

1549

The system software package is incorrect in the active area.
	

5
	

Active startup file is incorrect.

The system software package is incorrect in the backup area.
	

6
	

Backup startup file is incorrect.
Example

# Start a smooth upgrade.

<HUAWEI> system-view
[HUAWEI] upgrade start
Warning: Upgrade will begin. Continue? [Y/N]:y

